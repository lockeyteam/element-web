/*! For license information please see index-b1x4OMLd.js.LICENSE.txt */
const __vite__mapDeps=(e,t=__vite__mapDeps,n=t.f||(t.f=["./index-vmZlFGtO.js","./matrix-sdk-crypto-wasm-DlvlUyhf.js","./polyfill-force-BvayG45o.js","./index-268eoxTG.js","./polyfill-force-CyUv_FTa.js"]))=>e.map(e=>n[e]);var Mge=Object.defineProperty,Dge=(e,t,n)=>t in e?Mge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,De=(e,t,n)=>Dge(e,"symbol"!=typeof t?t+"":t,n);try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a2cb6ee3-1657-4c1d-a949-62b336583c4e",e._sentryDebugIdIdentifier="sentry-dbid-a2cb6ee3-1657-4c1d-a949-62b336583c4e")}catch{}function Nge(e,t){for(var n=0;n<t.length;n++){const r=t[n];if("string"!=typeof r&&!Array.isArray(r))for(const t in r)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(r,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>r[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{}).SENTRY_RELEASE={id:"embedded-v0.15.0"};!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var bot=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ac(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function _ot(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),n}var lF,uF,nk={exports:{}},a0={};function Uge(){if(lF)return a0;lF=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(t,n,r){var i=null;if(void 0!==r&&(i=""+r),void 0!==n.key&&(i=""+n.key),"key"in n)for(var o in r={},n)"key"!==o&&(r[o]=n[o]);else r=n;return n=r.ref,{$$typeof:e,type:t,key:i,ref:void 0!==n?n:null,props:r}}return a0.Fragment=t,a0.jsx=n,a0.jsxs=n,a0}function jge(){return uF||(uF=1,nk.exports=Uge()),nk.exports}var w=jge();function dF(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function B(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){dF(o,r,i,s,a,"next",e)}function a(e){dF(o,r,i,s,a,"throw",e)}s(void 0)})}}function Zy(e){return(Zy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fge(e,t){if("object"!=Zy(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=Zy(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function $ge(e){var t=Fge(e,"string");return"symbol"==Zy(t)?t:t+""}function P(e,t,n){return(t=$ge(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Bge="l",Hge="rn",Vge={0:"O",1:"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕",゛:"ﾞ",゜:"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ",ﱞ:"ﹲّ","ࣲ":"ٍ",ﱟ:"ﹴّ",ﳲ:"ﹷّ",ﱠ:"ﹶّ",ﳳ:"ﹹّ",ﱡ:"ﹸّ","ؚ":"ِ","̗":"ِ",ﳴ:"ﹻّ",ﱢ:"ﹺّ",ﱣ:"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ",ߺ:"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-",Ⲻ:"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",",ꓹ:",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":",ː:":",ꓽ:":","⩴":"::=","⧴":":→","！":"!",ǃ:"!",ⵑ:"!","‼":"!!","⁉":"!?",ʔ:"?",Ɂ:"?",ॽ:"?",Ꭾ:"?",ꛫ:"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".",ꓸ:".",ꓻ:".,","‥":"..",ꓺ:"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·",ꞏ:"·",ᐧ:"·","⋯":"···",ⵈ:"···",ᑄ:"·<","⋗":"·>",ᐷ:"·>",ᑀ:"·>",ᔯ:"·4",ᑾ:"·b",ᒀ:"·ḃ",ᑺ:"·d",ᒘ:"·J",ᒶ:"·L",ᑶ:"·P",ᑗ:"·U",ᐺ:"·V",ᐼ:"·Ʌ",ᒮ:"·Γ",ᐎ:"·Δ",ᑙ:"·Ո",ᐌ:"·ᐁ",ᐐ:"·ᐄ",ᐒ:"·ᐅ",ᐔ:"·ᐆ",ᐗ:"·ᐊ",ᐙ:"·ᐋ",ᐾ:"·ᐲ",ᑂ:"·ᐴ",ᑆ:"·ᐹ",ᑛ:"·ᑏ",ᑔ:"·ᑐ",ᑝ:"·ᑐ",ᑟ:"·ᑑ",ᑡ:"·ᑕ",ᑣ:"·ᑖ",ᑴ:"·ᑫ",ᑸ:"·ᑮ",ᑼ:"·ᑰ",ᒒ:"·ᒉ",ᒔ:"·ᒋ",ᒖ:"·ᒌ",ᒚ:"·ᒎ",ᒜ:"·ᒐ",ᒞ:"·ᒑ",ᒬ:"·ᒣ",ᒰ:"·ᒦ",ᒲ:"·ᒧ",ᒴ:"·ᒨ",ᒸ:"·ᒫ",ᓉ:"·ᓀ",ᣆ:"·ᓂ",ᣈ:"·ᓃ",ᣊ:"·ᓄ",ᣌ:"·ᓅ",ᓋ:"·ᓇ",ᓍ:"·ᓈ",ᓜ:"·ᓓ",ᓞ:"·ᓕ",ᓠ:"·ᓖ",ᓢ:"·ᓗ",ᓤ:"·ᓘ",ᓦ:"·ᓚ",ᓨ:"·ᓛ",ᓶ:"·ᓭ",ᓸ:"·ᓯ",ᓺ:"·ᓰ",ᓼ:"·ᓱ",ᓾ:"·ᓲ",ᔀ:"·ᓴ",ᔂ:"·ᓵ",ᔗ:"·ᔐ",ᔙ:"·ᔑ",ᔛ:"·ᔒ",ᔝ:"·ᔓ",ᔟ:"·ᔔ",ᔡ:"·ᔕ",ᔣ:"·ᔖ",ᔱ:"·ᔨ",ᔳ:"·ᔩ",ᔵ:"·ᔪ",ᔷ:"·ᔫ",ᔹ:"·ᔭ",ᔻ:"·ᔮ",ᣎ:"·ᕃ",ᣏ:"·ᕆ",ᣐ:"·ᕇ",ᣑ:"·ᕈ",ᣒ:"·ᕉ",ᣓ:"·ᕋ",ᕎ:"·ᕌ",ᕛ:"·ᕚ",ᕨ:"·ᕧ",ᢳ:"·ᢱ",ᢶ:"·ᢴ",ᢹ:"·ᢸ",ᣂ:"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"'","＇":"'","‘":"'","’":"'","‛":"'","′":"'","‵":"'","՚":"'","׳":"'","`":"'","`":"'","｀":"'","´":"'","΄":"'","´":"'","᾽":"'","᾿":"'","῾":"'",ʹ:"'",ʹ:"'",ˈ:"'",ˊ:"'",ˋ:"'","˴":"'",ʻ:"'",ʽ:"'",ʼ:"'",ʾ:"'",ꞌ:"'",י:"'",ߴ:"'",ߵ:"'",ᑊ:"'",ᛌ:"'","𖽑":"'","𖽒":"'","᳓":"''",'"':"''","＂":"''","“":"''","”":"''","‟":"''","″":"''","‶":"''","〃":"''","״":"''","˝":"''",ʺ:"''","˶":"''",ˮ:"''",ײ:"''","‴":"'''","‷":"'''","⁗":"''''",Ɓ:"'B",Ɗ:"'D",ŉ:"'n",Ƥ:"'P",Ƭ:"'T",Ƴ:"'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬",く:"❬",𡿨:"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*",𐌟:"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/",〳:"/",Ⳇ:"/",ノ:"/",丿:"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\","﹨":"\\","∖":"\\","⟍":"\\","⧵":"\\","⧹":"\\","𝈏":"\\","𝈻":"\\","㇔":"\\",丶:"\\","⼂":"\\","⳹":"\\\\","⑊":"\\\\","⟈":"\\ᑕ",ꝸ:"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^",ˆ:"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ",ъ:"ˉb",ꙑ:"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵",ð:"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇",𑢨:"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+",𐊛:"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<",ᐸ:"<",ᚲ:"<","⋖":"<·",Ⲵ:"<·",ᑅ:"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">",ᐳ:">",𖼿:">",ᑁ:">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ",ൎ:"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー",ꟷ:"ー",ᅳ:"ー",ㅡ:"ー",一:"ー","⼀":"ー",ᆖ:"ーー",ힹ:"ーᅡ",ힺ:"ーᅥ",ힻ:"ーᅥ丨",ힼ:"ーᅩ",ᆕ:"ーᅮ",ᅴ:"ー丨",ㅢ:"ー丨",ᆗ:"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧",ၥ:"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2",Ꝛ:"2",Ƨ:"2",Ϩ:"2",Ꙅ:"2",ᒿ:"2",ꛯ:"2",ꧏ:"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁",ƻ:"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3",Ɜ:"3",Ȝ:"3",Ʒ:"3",Ꝫ:"3",Ⳍ:"3",З:"3",Ӡ:"3",𖼻:"3",𑣊:"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂",Ҙ:"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4",Ꮞ:"4",𑢯:"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.",ᔰ:"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5",Ƽ:"5",𑢻:"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6",Ⳓ:"6",б:"6",Ꮾ:"6",𑣕:"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7",𑣆:"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8",ȣ:"8",Ȣ:"8",𐌚:"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9",Ꝯ:"9",Ⳋ:"9",𑣌:"9",𑢬:"9",𑣖:"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a",ａ:"a",𝐚:"a",𝑎:"a",𝒂:"a",𝒶:"a",𝓪:"a",𝔞:"a",𝕒:"a",𝖆:"a",𝖺:"a",𝗮:"a",𝘢:"a",𝙖:"a",𝚊:"a",ɑ:"a",α:"a",𝛂:"a",𝛼:"a",𝜶:"a",𝝰:"a",𝞪:"a",а:"a","ⷶ":"ͣ",Ａ:"A",𝐀:"A",𝐴:"A",𝑨:"A",𝒜:"A",𝓐:"A",𝔄:"A",𝔸:"A",𝕬:"A",𝖠:"A",𝗔:"A",𝘈:"A",𝘼:"A",𝙰:"A",Α:"A",𝚨:"A",𝛢:"A",𝜜:"A",𝝖:"A",𝞐:"A",А:"A",Ꭺ:"A",ᗅ:"A",ꓮ:"A",𖽀:"A",𐊠:"A","⍶":"a̲",ǎ:"ă",Ǎ:"Ă",ȧ:"å",Ȧ:"Å",ẚ:"ả","℀":"a/c","℁":"a/s",ꜳ:"aa",Ꜳ:"AA",æ:"ae",ӕ:"ae",Æ:"AE",Ӕ:"AE",ꜵ:"ao",Ꜵ:"AO","🜇":"AR",ꜷ:"au",Ꜷ:"AU",ꜹ:"av",ꜻ:"av",Ꜹ:"AV",Ꜻ:"AV",ꜽ:"ay",Ꜽ:"AY",ꭺ:"ᴀ","∀":"Ɐ","𝈗":"Ɐ",ᗄ:"Ɐ",ꓯ:"Ɐ",𐐟:"Ɒ",𝐛:"b",𝑏:"b",𝒃:"b",𝒷:"b",𝓫:"b",𝔟:"b",𝕓:"b",𝖇:"b",𝖻:"b",𝗯:"b",𝘣:"b",𝙗:"b",𝚋:"b",Ƅ:"b",Ь:"b",Ꮟ:"b",ᑲ:"b",ᖯ:"b",Ｂ:"B",ℬ:"B",𝐁:"B",𝐵:"B",𝑩:"B",𝓑:"B",𝔅:"B",𝔹:"B",𝕭:"B",𝖡:"B",𝗕:"B",𝘉:"B",𝘽:"B",𝙱:"B",Ꞵ:"B",Β:"B",𝚩:"B",𝛣:"B",𝜝:"B",𝝗:"B",𝞑:"B",В:"B",Ᏼ:"B",ᗷ:"B",ꓐ:"B",𐊂:"B",𐊡:"B",𐌁:"B",ɓ:"b̔",ᑳ:"ḃ",ƃ:"b̄",Ƃ:"b̄",Б:"b̄",ƀ:"b̵",ҍ:"b̵",Ҍ:"b̵",ѣ:"b̵",Ѣ:"b̵",ᑿ:"b·",ᒁ:"ḃ·",ᒈ:"b'",Ы:"bl",в:"ʙ",ᏼ:"ʙ",ｃ:"c",ⅽ:"c",𝐜:"c",𝑐:"c",𝒄:"c",𝒸:"c",𝓬:"c",𝔠:"c",𝕔:"c",𝖈:"c",𝖼:"c",𝗰:"c",𝘤:"c",𝙘:"c",𝚌:"c",ᴄ:"c",ϲ:"c",ⲥ:"c",с:"c",ꮯ:"c",𐐽:"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C",Ｃ:"C",Ⅽ:"C",ℂ:"C",ℭ:"C",𝐂:"C",𝐶:"C",𝑪:"C",𝒞:"C",𝓒:"C",𝕮:"C",𝖢:"C",𝗖:"C",𝘊:"C",𝘾:"C",𝙲:"C",Ϲ:"C",Ⲥ:"C",С:"C",Ꮯ:"C",ꓚ:"C",𐊢:"C",𐌂:"C",𐐕:"C",𐔜:"C","¢":"c̸",ȼ:"c̸","₡":"C⃫","🅮":"C⃠",ç:"c̦",ҫ:"c̦",Ç:"C̦",Ҫ:"C̦",Ƈ:"C'","℅":"c/o","℆":"c/u","🅭":"㏄\t⃝","⋴":"ꞓ",ɛ:"ꞓ",ε:"ꞓ",ϵ:"ꞓ",𝛆:"ꞓ",𝛜:"ꞓ",𝜀:"ꞓ",𝜖:"ꞓ",𝜺:"ꞓ",𝝐:"ꞓ",𝝴:"ꞓ",𝞊:"ꞓ",𝞮:"ꞓ",𝟄:"ꞓ",ⲉ:"ꞓ",є:"ꞓ",ԑ:"ꞓ",ꮛ:"ꞓ",𑣎:"ꞓ",𐐩:"ꞓ","€":"Ꞓ",Ⲉ:"Ꞓ",Є:"Ꞓ","⍷":"ꞓ̲",ͽ:"ꜿ",Ͽ:"Ꜿ",ⅾ:"d",ⅆ:"d",𝐝:"d",𝑑:"d",𝒅:"d",𝒹:"d",𝓭:"d",𝔡:"d",𝕕:"d",𝖉:"d",𝖽:"d",𝗱:"d",𝘥:"d",𝙙:"d",𝚍:"d",ԁ:"d",Ꮷ:"d",ᑯ:"d",ꓒ:"d",Ⅾ:"D",ⅅ:"D",𝐃:"D",𝐷:"D",𝑫:"D",𝒟:"D",𝓓:"D",𝔇:"D",𝔻:"D",𝕯:"D",𝖣:"D",𝗗:"D",𝘋:"D",𝘿:"D",𝙳:"D",Ꭰ:"D",ᗞ:"D",ᗪ:"D",ꓓ:"D",ɗ:"d̔",ɖ:"d̨",ƌ:"d̄",đ:"d̵",Đ:"D̵",Ð:"D̵",Ɖ:"D̵","₫":"ḏ̵",ꝺ:"Ꝺ",ᑻ:"d·",ᒇ:"d'",ʤ:"dȝ",ǳ:"dz",ʣ:"dz",ǲ:"Dz",Ǳ:"DZ",ǆ:"dž",ǅ:"Dž",Ǆ:"DŽ",ʥ:"dʑ",ꭰ:"ᴅ","⸹":"ẟ",δ:"ẟ",𝛅:"ẟ",𝛿:"ẟ",𝜹:"ẟ",𝝳:"ẟ",𝞭:"ẟ",ծ:"ẟ",ᕷ:"ẟ",℮:"e",ｅ:"e",ℯ:"e",ⅇ:"e",𝐞:"e",𝑒:"e",𝒆:"e",𝓮:"e",𝔢:"e",𝕖:"e",𝖊:"e",𝖾:"e",𝗲:"e",𝘦:"e",𝙚:"e",𝚎:"e",ꬲ:"e",е:"e",ҽ:"e","ⷷ":"ͤ","⋿":"E",Ｅ:"E",ℰ:"E",𝐄:"E",𝐸:"E",𝑬:"E",𝓔:"E",𝔈:"E",𝔼:"E",𝕰:"E",𝖤:"E",𝗘:"E",𝘌:"E",𝙀:"E",𝙴:"E",Ε:"E",𝚬:"E",𝛦:"E",𝜠:"E",𝝚:"E",𝞔:"E",Е:"E",ⴹ:"E",Ꭼ:"E",ꓰ:"E",𑢦:"E",𑢮:"E",𐊆:"E",ě:"ĕ",Ě:"Ĕ",ɇ:"e̸",Ɇ:"E̸",ҿ:"ę",ꭼ:"ᴇ",ə:"ǝ",ә:"ǝ","∃":"Ǝ",ⴺ:"Ǝ",ꓱ:"Ǝ",ɚ:"ǝ˞",ᴔ:"ǝo",ꭁ:"ǝo̸",ꭂ:"ǝo̵",Ә:"Ə","𝈡":"Ɛ",ℇ:"Ɛ",Ԑ:"Ɛ",Ꮛ:"Ɛ",𖼭:"Ɛ",𐐁:"Ɛ",ᶟ:"ᵋ",ᴈ:"ɜ",з:"ɜ",ҙ:"ɜ̦",𐑂:"ɞ",ꞝ:"ʚ",𐐪:"ʚ",𝐟:"f",𝑓:"f",𝒇:"f",𝒻:"f",𝓯:"f",𝔣:"f",𝕗:"f",𝖋:"f",𝖿:"f",𝗳:"f",𝘧:"f",𝙛:"f",𝚏:"f",ꬵ:"f",ꞙ:"f",ſ:"f",ẝ:"f",ք:"f","𝈓":"F",ℱ:"F",𝐅:"F",𝐹:"F",𝑭:"F",𝓕:"F",𝔉:"F",𝔽:"F",𝕱:"F",𝖥:"F",𝗙:"F",𝘍:"F",𝙁:"F",𝙵:"F",Ꞙ:"F",Ϝ:"F",𝟊:"F",ᖴ:"F",ꓝ:"F",𑣂:"F",𑢢:"F",𐊇:"F",𐊥:"F",𐔥:"F",ƒ:"f̦",Ƒ:"F̦",ᵮ:"f̴","℻":"FAX",ﬀ:"ff",ﬃ:"ffi",ﬄ:"ffl",ﬁ:"fi",ﬂ:"fl",ʩ:"fŋ",ᖵ:"Ⅎ",ꓞ:"Ⅎ","𝈰":"ꟻ",ᖷ:"ꟻ",ｇ:"g",ℊ:"g",𝐠:"g",𝑔:"g",𝒈:"g",𝓰:"g",𝔤:"g",𝕘:"g",𝖌:"g",𝗀:"g",𝗴:"g",𝘨:"g",𝙜:"g",𝚐:"g",ɡ:"g",ᶃ:"g",ƍ:"g",ց:"g",𝐆:"G",𝐺:"G",𝑮:"G",𝒢:"G",𝓖:"G",𝔊:"G",𝔾:"G",𝕲:"G",𝖦:"G",𝗚:"G",𝘎:"G",𝙂:"G",𝙶:"G",Ԍ:"G",Ꮐ:"G",Ᏻ:"G",ꓖ:"G",ᶢ:"ᵍ",ɠ:"g̔",ǧ:"ğ",Ǧ:"Ğ",ǵ:"ģ",ǥ:"g̵",Ǥ:"G̵",Ɠ:"G'",ԍ:"ɢ",ꮐ:"ɢ",ᏻ:"ɢ",ｈ:"h",ℎ:"h",𝐡:"h",𝒉:"h",𝒽:"h",𝓱:"h",𝔥:"h",𝕙:"h",𝖍:"h",𝗁:"h",𝗵:"h",𝘩:"h",𝙝:"h",𝚑:"h",һ:"h",հ:"h",Ꮒ:"h",Ｈ:"H",ℋ:"H",ℌ:"H",ℍ:"H",𝐇:"H",𝐻:"H",𝑯:"H",𝓗:"H",𝕳:"H",𝖧:"H",𝗛:"H",𝘏:"H",𝙃:"H",𝙷:"H",Η:"H",𝚮:"H",𝛨:"H",𝜢:"H",𝝜:"H",𝞖:"H",Ⲏ:"H",Н:"H",Ꮋ:"H",ᕼ:"H",ꓧ:"H",𐋏:"H",ᵸ:"ᴴ",ɦ:"h̔",ꚕ:"h̔",Ᏺ:"h̔",Ⱨ:"H̩",Ң:"H̩",ħ:"h̵",ℏ:"h̵",ћ:"h̵",Ħ:"H̵",Ӊ:"H̦",Ӈ:"H̦",н:"ʜ",ꮋ:"ʜ",ң:"ʜ̩",ӊ:"ʜ̦",ӈ:"ʜ̦",Ԋ:"Ƕ",ꮀ:"ⱶ",Ͱ:"Ⱶ",Ꭸ:"Ⱶ",Ꮀ:"Ⱶ",ꚱ:"Ⱶ",ꞕ:"ꜧ","˛":"i","⍳":"i",ｉ:"i",ⅰ:"i",ℹ:"i",ⅈ:"i",𝐢:"i",𝑖:"i",𝒊:"i",𝒾:"i",𝓲:"i",𝔦:"i",𝕚:"i",𝖎:"i",𝗂:"i",𝗶:"i",𝘪:"i",𝙞:"i",𝚒:"i",ı:"i",𝚤:"i",ɪ:"i",ɩ:"i",ι:"i",ι:"i",ͺ:"i",𝛊:"i",𝜄:"i",𝜾:"i",𝝸:"i",𝞲:"i",і:"i",ꙇ:"i",ӏ:"i",ꭵ:"i",Ꭵ:"i",𑣃:"i","ⓛ":"Ⓘ","⍸":"i̲",ǐ:"ĭ",Ǐ:"Ĭ",ɨ:"i̵",ᵻ:"i̵",ᵼ:"i̵",ⅱ:"ii",ⅲ:"iii",ĳ:"ij",ⅳ:"iv",ⅸ:"ix",ｊ:"j",ⅉ:"j",𝐣:"j",𝑗:"j",𝒋:"j",𝒿:"j",𝓳:"j",𝔧:"j",𝕛:"j",𝖏:"j",𝗃:"j",𝗷:"j",𝘫:"j",𝙟:"j",𝚓:"j",ϳ:"j",ј:"j",Ｊ:"J",𝐉:"J",𝐽:"J",𝑱:"J",𝒥:"J",𝓙:"J",𝔍:"J",𝕁:"J",𝕵:"J",𝖩:"J",𝗝:"J",𝘑:"J",𝙅:"J",𝙹:"J",Ʝ:"J",Ϳ:"J",Ј:"J",Ꭻ:"J",ᒍ:"J",ꓙ:"J",ɉ:"j̵",Ɉ:"J̵",ᒙ:"J·",𝚥:"ȷ",յ:"ȷ",ꭻ:"ᴊ",𝐤:"k",𝑘:"k",𝒌:"k",𝓀:"k",𝓴:"k",𝔨:"k",𝕜:"k",𝖐:"k",𝗄:"k",𝗸:"k",𝘬:"k",𝙠:"k",𝚔:"k",K:"K",Ｋ:"K",𝐊:"K",𝐾:"K",𝑲:"K",𝒦:"K",𝓚:"K",𝔎:"K",𝕂:"K",𝕶:"K",𝖪:"K",𝗞:"K",𝘒:"K",𝙆:"K",𝙺:"K",Κ:"K",𝚱:"K",𝛫:"K",𝜥:"K",𝝟:"K",𝞙:"K",Ⲕ:"K",К:"K",Ꮶ:"K",ᛕ:"K",ꓗ:"K",𐔘:"K",ƙ:"k̔",Ⱪ:"K̩",Қ:"K̩","₭":"K̵",Ꝁ:"K̵",Ҟ:"K̵",Ƙ:"K'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l",I:"l",Ｉ:"l",Ⅰ:"l",ℐ:"l",ℑ:"l",𝐈:"l",𝐼:"l",𝑰:"l",𝓘:"l",𝕀:"l",𝕴:"l",𝖨:"l",𝗜:"l",𝘐:"l",𝙄:"l",𝙸:"l",Ɩ:"l",ｌ:"l",ⅼ:"l",ℓ:"l",𝐥:"l",𝑙:"l",𝒍:"l",𝓁:"l",𝓵:"l",𝔩:"l",𝕝:"l",𝖑:"l",𝗅:"l",𝗹:"l",𝘭:"l",𝙡:"l",𝚕:"l",ǀ:"l",Ι:"l",𝚰:"l",𝛪:"l",𝜤:"l",𝝞:"l",𝞘:"l",Ⲓ:"l",І:"l",Ӏ:"l",ו:"l",ן:"l",ا:"l",𞸀:"l",𞺀:"l",ﺎ:"l",ﺍ:"l",ߊ:"l",ⵏ:"l",ᛁ:"l",ꓲ:"l",𖼨:"l",𐊊:"l",𐌉:"l","𝈪":"L",Ⅼ:"L",ℒ:"L",𝐋:"L",𝐿:"L",𝑳:"L",𝓛:"L",𝔏:"L",𝕃:"L",𝕷:"L",𝖫:"L",𝗟:"L",𝘓:"L",𝙇:"L",𝙻:"L",Ⳑ:"L",Ꮮ:"L",ᒪ:"L",ꓡ:"L",𖼖:"L",𑢣:"L",𑢲:"L",𐐛:"L",𐔦:"L",ﴼ:"l̋",ﴽ:"l̋",ł:"l̸",Ł:"L̸",ɭ:"l̨",Ɨ:"l̵",ƚ:"l̵",ɫ:"l̴",إ:"lٕ",ﺈ:"lٕ",ﺇ:"lٕ",ٳ:"lٕ",ŀ:"l·",Ŀ:"l·",ᒷ:"l·","🄂":"l,","⒈":"l.",ױ:"l'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点",ǉ:"lj",Ĳ:"lJ",ǈ:"Lj",Ǉ:"LJ","‖":"ll","∥":"ll",Ⅱ:"ll",ǁ:"ll",װ:"ll","𐆙":"l̵l̵","⒒":"ll.",Ⅲ:"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点",Ю:"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点",ʪ:"ls","₶":"lt",Ⅳ:"lV",Ⅸ:"lX",ɮ:"lȝ",ʫ:"lz",أ:"lٴ",ﺄ:"lٴ",ﺃ:"lٴ",ٲ:"lٴ",ٵ:"lٴ",ﷳ:"lكبر",ﷲ:"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点",ⳑ:"ʟ",ꮮ:"ʟ",𐑃:"ʟ",Ｍ:"M",Ⅿ:"M",ℳ:"M",𝐌:"M",𝑀:"M",𝑴:"M",𝓜:"M",𝔐:"M",𝕄:"M",𝕸:"M",𝖬:"M",𝗠:"M",𝘔:"M",𝙈:"M",𝙼:"M",Μ:"M",𝚳:"M",𝛭:"M",𝜧:"M",𝝡:"M",𝞛:"M",Ϻ:"M",Ⲙ:"M",М:"M",Ꮇ:"M",ᗰ:"M",ᛖ:"M",ꓟ:"M",𐊰:"M",𐌑:"M",Ӎ:"M̦","🝫":"MB","ⷨ":"ᷟ",𝐧:"n",𝑛:"n",𝒏:"n",𝓃:"n",𝓷:"n",𝔫:"n",𝕟:"n",𝖓:"n",𝗇:"n",𝗻:"n",𝘯:"n",𝙣:"n",𝚗:"n",ո:"n",ռ:"n",Ｎ:"N",ℕ:"N",𝐍:"N",𝑁:"N",𝑵:"N",𝒩:"N",𝓝:"N",𝔑:"N",𝕹:"N",𝖭:"N",𝗡:"N",𝘕:"N",𝙉:"N",𝙽:"N",Ν:"N",𝚴:"N",𝛮:"N",𝜨:"N",𝝢:"N",𝞜:"N",Ⲛ:"N",ꓠ:"N",𐔓:"N","𐆎":"N̊",ɳ:"n̨",ƞ:"n̩",η:"n̩",𝛈:"n̩",𝜂:"n̩",𝜼:"n̩",𝝶:"n̩",𝞰:"n̩",Ɲ:"N̦",ᵰ:"n̴",ǌ:"nj",ǋ:"Nj",Ǌ:"NJ","№":"No",ͷ:"ᴎ",и:"ᴎ",𐑍:"ᴎ",ņ:"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o",ｏ:"o",ℴ:"o",𝐨:"o",𝑜:"o",𝒐:"o",𝓸:"o",𝔬:"o",𝕠:"o",𝖔:"o",𝗈:"o",𝗼:"o",𝘰:"o",𝙤:"o",𝚘:"o",ᴏ:"o",ᴑ:"o",ꬽ:"o",ο:"o",𝛐:"o",𝜊:"o",𝝄:"o",𝝾:"o",𝞸:"o",σ:"o",𝛔:"o",𝜎:"o",𝝈:"o",𝞂:"o",𝞼:"o",ⲟ:"o",о:"o",ჿ:"o",օ:"o",ס:"o",ه:"o",𞸤:"o",𞹤:"o",𞺄:"o",ﻫ:"o",ﻬ:"o",ﻪ:"o",ﻩ:"o",ھ:"o",ﮬ:"o",ﮭ:"o",ﮫ:"o",ﮪ:"o",ہ:"o",ﮨ:"o",ﮩ:"o",ﮧ:"o",ﮦ:"o",ە:"o",ഠ:"o",ဝ:"o","𐓪":"o",𑣈:"o",𑣗:"o",𐐬:"o","߀":"O","০":"O","୦":"O",〇:"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O",Ｏ:"O",𝐎:"O",𝑂:"O",𝑶:"O",𝒪:"O",𝓞:"O",𝔒:"O",𝕆:"O",𝕺:"O",𝖮:"O",𝗢:"O",𝘖:"O",𝙊:"O",𝙾:"O",Ο:"O",𝚶:"O",𝛰:"O",𝜪:"O",𝝤:"O",𝞞:"O",Ⲟ:"O",О:"O",Օ:"O",ⵔ:"O",ዐ:"O",ଠ:"O","𐓂":"O",ꓳ:"O",𑢵:"O",𐊒:"O",𐊫:"O",𐐄:"O",𐔖:"O","⁰":"º",ᵒ:"º",ǒ:"ŏ",Ǒ:"Ŏ",ۿ:"ô",Ő:"Ö",ø:"o̸",ꬾ:"o̸",Ø:"O̸",ⵁ:"O̸",Ǿ:"Ó̸",ɵ:"o̵",ꝋ:"o̵",ө:"o̵",ѳ:"o̵",ꮎ:"o̵",ꮻ:"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵",Ɵ:"O̵",Ꝋ:"O̵",θ:"O̵",ϑ:"O̵",𝛉:"O̵",𝛝:"O̵",𝜃:"O̵",𝜗:"O̵",𝜽:"O̵",𝝑:"O̵",𝝷:"O̵",𝞋:"O̵",𝞱:"O̵",𝟅:"O̵",Θ:"O̵",ϴ:"O̵",𝚯:"O̵",𝚹:"O̵",𝛩:"O̵",𝛳:"O̵",𝜣:"O̵",𝜭:"O̵",𝝝:"O̵",𝝧:"O̵",𝞗:"O̵",𝞡:"O̵",Ө:"O̵",Ѳ:"O̵",ⴱ:"O̵",Ꮎ:"O̵",Ꮻ:"O̵",ꭴ:"ơ",ﳙ:"oٰ","🄁":"O,","🄀":"O.",ơ:"o'",Ơ:"O'",Ꭴ:"O'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀",œ:"oe",Œ:"OE",ɶ:"oᴇ","∞":"oo",ꝏ:"oo",ꚙ:"oo",Ꝏ:"OO",Ꚙ:"OO",ﳗ:"oج",ﱑ:"oج",ﳘ:"oم",ﱒ:"oم",ﶓ:"oمج",ﶔ:"oمم",ﱓ:"oى",ﱔ:"oى",ൟ:"oരo",တ:"oာ","㍘":"O点",ↄ:"ɔ",ᴐ:"ɔ",ͻ:"ɔ",𐑋:"ɔ",Ↄ:"Ɔ",Ͻ:"Ɔ",ꓛ:"Ɔ",𐐣:"Ɔ",ꬿ:"ɔ̸",ꭢ:"ɔe",𐐿:"ɷ","⍴":"p",ｐ:"p",𝐩:"p",𝑝:"p",𝒑:"p",𝓅:"p",𝓹:"p",𝔭:"p",𝕡:"p",𝖕:"p",𝗉:"p",𝗽:"p",𝘱:"p",𝙥:"p",𝚙:"p",ρ:"p",ϱ:"p",𝛒:"p",𝛠:"p",𝜌:"p",𝜚:"p",𝝆:"p",𝝔:"p",𝞀:"p",𝞎:"p",𝞺:"p",𝟈:"p",ⲣ:"p",р:"p",Ｐ:"P",ℙ:"P",𝐏:"P",𝑃:"P",𝑷:"P",𝒫:"P",𝓟:"P",𝔓:"P",𝕻:"P",𝖯:"P",𝗣:"P",𝘗:"P",𝙋:"P",𝙿:"P",Ρ:"P",𝚸:"P",𝛲:"P",𝜬:"P",𝝦:"P",𝞠:"P",Ⲣ:"P",Р:"P",Ꮲ:"P",ᑭ:"P",ꓑ:"P",𐊕:"P",ƥ:"p̔",ᵽ:"p̵",ᑷ:"p·",ᒆ:"P'",ᴩ:"ᴘ",ꮲ:"ᴘ",φ:"ɸ",ϕ:"ɸ",𝛗:"ɸ",𝛟:"ɸ",𝜑:"ɸ",𝜙:"ɸ",𝝋:"ɸ",𝝓:"ɸ",𝞅:"ɸ",𝞍:"ɸ",𝞿:"ɸ",𝟇:"ɸ",ⲫ:"ɸ",ф:"ɸ",𝐪:"q",𝑞:"q",𝒒:"q",𝓆:"q",𝓺:"q",𝔮:"q",𝕢:"q",𝖖:"q",𝗊:"q",𝗾:"q",𝘲:"q",𝙦:"q",𝚚:"q",ԛ:"q",գ:"q",զ:"q",ℚ:"Q",𝐐:"Q",𝑄:"Q",𝑸:"Q",𝒬:"Q",𝓠:"Q",𝔔:"Q",𝕼:"Q",𝖰:"Q",𝗤:"Q",𝘘:"Q",𝙌:"Q",𝚀:"Q",ⵕ:"Q",ʠ:"q̔","🜀":"QE",ᶐ:"ɋ",ᴋ:"ĸ",κ:"ĸ",ϰ:"ĸ",𝛋:"ĸ",𝛞:"ĸ",𝜅:"ĸ",𝜘:"ĸ",𝜿:"ĸ",𝝒:"ĸ",𝝹:"ĸ",𝞌:"ĸ",𝞳:"ĸ",𝟆:"ĸ",ⲕ:"ĸ",к:"ĸ",ꮶ:"ĸ",қ:"ĸ̩",ҟ:"ĸ̵",𝐫:"r",𝑟:"r",𝒓:"r",𝓇:"r",𝓻:"r",𝔯:"r",𝕣:"r",𝖗:"r",𝗋:"r",𝗿:"r",𝘳:"r",𝙧:"r",𝚛:"r",ꭇ:"r",ꭈ:"r",ᴦ:"r",ⲅ:"r",г:"r",ꮁ:"r","𝈖":"R",ℛ:"R",ℜ:"R",ℝ:"R",𝐑:"R",𝑅:"R",𝑹:"R",𝓡:"R",𝕽:"R",𝖱:"R",𝗥:"R",𝘙:"R",𝙍:"R",𝚁:"R",Ʀ:"R",Ꭱ:"R",Ꮢ:"R","𐒴":"R",ᖇ:"R",ꓣ:"R",𖼵:"R",ɽ:"r̨",ɼ:"r̩",ɍ:"r̵",ғ:"r̵",ᵲ:"r̴",ґ:"r'","𑣣":"rn",m:Hge,ⅿ:"rn",𝐦:"rn",𝑚:"rn",𝒎:"rn",𝓂:"rn",𝓶:"rn",𝔪:"rn",𝕞:"rn",𝖒:"rn",𝗆:"rn",𝗺:"rn",𝘮:"rn",𝙢:"rn",𝚖:"rn",𑜀:"rn","₥":"rn̸",ɱ:"rn̦",ᵯ:"rn̴","₨":"Rs",ꭱ:"ʀ",ꮢ:"ʀ",я:"ᴙ",ᵳ:"ɾ̴","℩":"ɿ",ｓ:"s",𝐬:"s",𝑠:"s",𝒔:"s",𝓈:"s",𝓼:"s",𝔰:"s",𝕤:"s",𝖘:"s",𝗌:"s",𝘀:"s",𝘴:"s",𝙨:"s",𝚜:"s",ꜱ:"s",ƽ:"s",ѕ:"s",ꮪ:"s",𑣁:"s",𐑈:"s",Ｓ:"S",𝐒:"S",𝑆:"S",𝑺:"S",𝒮:"S",𝓢:"S",𝔖:"S",𝕊:"S",𝕾:"S",𝖲:"S",𝗦:"S",𝘚:"S",𝙎:"S",𝚂:"S",Ѕ:"S",Տ:"S",Ꮥ:"S",Ꮪ:"S",ꓢ:"S",𖼺:"S",𐊖:"S",𐐠:"S",ʂ:"s̨",ᵴ:"s̴",ꞵ:"ß",β:"ß",ϐ:"ß",𝛃:"ß",𝛽:"ß",𝜷:"ß",𝝱:"ß",𝞫:"ß",Ᏸ:"ß","🝜":"sss",ﬆ:"st","∫":"ʃ",ꭍ:"ʃ","∑":"Ʃ","⅀":"Ʃ",Σ:"Ʃ",𝚺:"Ʃ",𝛴:"Ʃ",𝜮:"Ʃ",𝝨:"Ʃ",𝞢:"Ʃ",ⵉ:"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ",𝐭:"t",𝑡:"t",𝒕:"t",𝓉:"t",𝓽:"t",𝔱:"t",𝕥:"t",𝖙:"t",𝗍:"t",𝘁:"t",𝘵:"t",𝙩:"t",𝚝:"t","⊤":"T","⟙":"T","🝨":"T",Ｔ:"T",𝐓:"T",𝑇:"T",𝑻:"T",𝒯:"T",𝓣:"T",𝔗:"T",𝕋:"T",𝕿:"T",𝖳:"T",𝗧:"T",𝘛:"T",𝙏:"T",𝚃:"T",Τ:"T",𝚻:"T",𝛵:"T",𝜯:"T",𝝩:"T",𝞣:"T",Ⲧ:"T",Т:"T",Ꭲ:"T",ꓔ:"T",𖼊:"T",𑢼:"T",𐊗:"T",𐊱:"T",𐌕:"T",ƭ:"t̔","⍡":"T̈",Ⱦ:"T̸",Ț:"Ţ",Ʈ:"T̨",Ҭ:"T̩","₮":"T⃫",ŧ:"t̵",Ŧ:"T̵",ᵵ:"t̴",Ⴀ:"Ꞇ",Ꜩ:"T3",ʨ:"tɕ","℡":"TEL",ꝷ:"tf",ʦ:"ts",ʧ:"tʃ",ꜩ:"tȝ",τ:"ᴛ",𝛕:"ᴛ",𝜏:"ᴛ",𝝉:"ᴛ",𝞃:"ᴛ",𝞽:"ᴛ",т:"ᴛ",ꭲ:"ᴛ",ҭ:"ᴛ̩",ţ:"ƫ",ț:"ƫ",Ꮏ:"ƫ",𝐮:"u",𝑢:"u",𝒖:"u",𝓊:"u",𝓾:"u",𝔲:"u",𝕦:"u",𝖚:"u",𝗎:"u",𝘂:"u",𝘶:"u",𝙪:"u",𝚞:"u",ꞟ:"u",ᴜ:"u",ꭎ:"u",ꭒ:"u",ʋ:"u",υ:"u",𝛖:"u",𝜐:"u",𝝊:"u",𝞄:"u",𝞾:"u",ս:"u","𐓶":"u",𑣘:"u","∪":"U","⋃":"U",𝐔:"U",𝑈:"U",𝑼:"U",𝒰:"U",𝓤:"U",𝔘:"U",𝕌:"U",𝖀:"U",𝖴:"U",𝗨:"U",𝘜:"U",𝙐:"U",𝚄:"U",Ս:"U",ሀ:"U","𐓎":"U",ᑌ:"U",ꓴ:"U",𖽂:"U",𑢸:"U",ǔ:"ŭ",Ǔ:"Ŭ",ᵾ:"u̵",ꮜ:"u̵",Ʉ:"U̵",Ꮜ:"U̵",ᑘ:"U·",ᑧ:"U'",ᵫ:"ue",ꭣ:"uo",ṃ:"ꭑ",պ:"ɰ",ሣ:"ɰ","℧":"Ʊ",ᘮ:"Ʊ",ᘴ:"Ʊ",ᵿ:"ʊ̵","∨":"v","⋁":"v",ｖ:"v",ⅴ:"v",𝐯:"v",𝑣:"v",𝒗:"v",𝓋:"v",𝓿:"v",𝔳:"v",𝕧:"v",𝖛:"v",𝗏:"v",𝘃:"v",𝘷:"v",𝙫:"v",𝚟:"v",ᴠ:"v",ν:"v",𝛎:"v",𝜈:"v",𝝂:"v",𝝼:"v",𝞶:"v",ѵ:"v",ט:"v",𑜆:"v",ꮩ:"v",𑣀:"v","𝈍":"V","٧":"V","۷":"V",Ⅴ:"V",𝐕:"V",𝑉:"V",𝑽:"V",𝒱:"V",𝓥:"V",𝔙:"V",𝕍:"V",𝖁:"V",𝖵:"V",𝗩:"V",𝘝:"V",𝙑:"V",𝚅:"V",Ѵ:"V",ⴸ:"V",Ꮩ:"V",ᐯ:"V",ꛟ:"V",ꓦ:"V",𖼈:"V",𑢠:"V",𐔝:"V","𐆗":"V̵",ᐻ:"V·","🝬":"VB",ⅵ:"vi",ⅶ:"vii",ⅷ:"viii",Ⅵ:"Vl",Ⅶ:"Vll",Ⅷ:"Vlll","🜈":"Vᷤ",ᴧ:"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ",Λ:"Ʌ",𝚲:"Ʌ",𝛬:"Ʌ",𝜦:"Ʌ",𝝠:"Ʌ",𝞚:"Ʌ",Л:"Ʌ",ⴷ:"Ʌ","𐒰":"Ʌ",ᐱ:"Ʌ",ꛎ:"Ʌ",ꓥ:"Ʌ",𖼽:"Ʌ",𐊍:"Ʌ",Ӆ:"Ʌ̦",ᐽ:"Ʌ·",ɯ:"w",𝐰:"w",𝑤:"w",𝒘:"w",𝓌:"w",𝔀:"w",𝔴:"w",𝕨:"w",𝖜:"w",𝗐:"w",𝘄:"w",𝘸:"w",𝙬:"w",𝚠:"w",ᴡ:"w",ѡ:"w",ԝ:"w",ա:"w",𑜊:"w",𑜎:"w",𑜏:"w",ꮃ:"w","𑣯":"W","𑣦":"W",𝐖:"W",𝑊:"W",𝑾:"W",𝒲:"W",𝓦:"W",𝔚:"W",𝕎:"W",𝖂:"W",𝖶:"W",𝗪:"W",𝘞:"W",𝙒:"W",𝚆:"W",Ԝ:"W",Ꮃ:"W",Ꮤ:"W",ꓪ:"W",ѽ:"w҆҇",𑓅:"ẇ","₩":"W̵",ꝡ:"w̦",ᴍ:"ʍ",м:"ʍ",ꮇ:"ʍ",ӎ:"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x",ｘ:"x",ⅹ:"x",𝐱:"x",𝑥:"x",𝒙:"x",𝓍:"x",𝔁:"x",𝔵:"x",𝕩:"x",𝖝:"x",𝗑:"x",𝘅:"x",𝘹:"x",𝙭:"x",𝚡:"x",х:"x",ᕁ:"x",ᕽ:"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X",Ｘ:"X",Ⅹ:"X",𝐗:"X",𝑋:"X",𝑿:"X",𝒳:"X",𝓧:"X",𝔛:"X",𝕏:"X",𝖃:"X",𝖷:"X",𝗫:"X",𝘟:"X",𝙓:"X",𝚇:"X",Ꭓ:"X",Χ:"X",𝚾:"X",𝛸:"X",𝜲:"X",𝝬:"X",𝞦:"X",Ⲭ:"X",Х:"X",ⵝ:"X",ᚷ:"X",ꓫ:"X",𐊐:"X",𐊴:"X",𐌗:"X",𐔧:"X","⨰":"ẋ",Ҳ:"X̩","𐆖":"X̵",ⅺ:"xi",ⅻ:"xii",Ⅺ:"Xl",Ⅻ:"Xll",ɣ:"y",ᶌ:"y",ｙ:"y",𝐲:"y",𝑦:"y",𝒚:"y",𝓎:"y",𝔂:"y",𝔶:"y",𝕪:"y",𝖞:"y",𝗒:"y",𝘆:"y",𝘺:"y",𝙮:"y",𝚢:"y",ʏ:"y",ỿ:"y",ꭚ:"y",γ:"y",ℽ:"y",𝛄:"y",𝛾:"y",𝜸:"y",𝝲:"y",𝞬:"y",у:"y",ү:"y",ყ:"y",𑣜:"y",Ｙ:"Y",𝐘:"Y",𝑌:"Y",𝒀:"Y",𝒴:"Y",𝓨:"Y",𝔜:"Y",𝕐:"Y",𝖄:"Y",𝖸:"Y",𝗬:"Y",𝘠:"Y",𝙔:"Y",𝚈:"Y",Υ:"Y",ϒ:"Y",𝚼:"Y",𝛶:"Y",𝜰:"Y",𝝪:"Y",𝞤:"Y",Ⲩ:"Y",У:"Y",Ү:"Y",Ꭹ:"Y",Ꮍ:"Y",ꓬ:"Y",𖽃:"Y",𑢤:"Y",𐊲:"Y",ƴ:"y̔",ɏ:"y̵",ұ:"y̵","¥":"Y̵",Ɏ:"Y̵",Ұ:"Y̵",ʒ:"ȝ",ꝫ:"ȝ",ⳍ:"ȝ",ӡ:"ȝ",ჳ:"ȝ",𝐳:"z",𝑧:"z",𝒛:"z",𝓏:"z",𝔃:"z",𝔷:"z",𝕫:"z",𝖟:"z",𝗓:"z",𝘇:"z",𝘻:"z",𝙯:"z",𝚣:"z",ᴢ:"z",ꮓ:"z",𑣄:"z","𐋵":"Z","𑣥":"Z",Ｚ:"Z",ℤ:"Z",ℨ:"Z",𝐙:"Z",𝑍:"Z",𝒁:"Z",𝒵:"Z",𝓩:"Z",𝖅:"Z",𝖹:"Z",𝗭:"Z",𝘡:"Z",𝙕:"Z",𝚉:"Z",Ζ:"Z",𝚭:"Z",𝛧:"Z",𝜡:"Z",𝝛:"Z",𝞕:"Z",Ꮓ:"Z",ꓜ:"Z",𑢩:"Z",ʐ:"z̨",ƶ:"z̵",Ƶ:"Z̵",ȥ:"z̦",Ȥ:"Z̦",ᵶ:"z̴",ƿ:"þ",ϸ:"þ",Ϸ:"Þ","𐓄":"Þ","⁹":"ꝰ",ᴤ:"ƨ",ϩ:"ƨ",ꙅ:"ƨ",ь:"ƅ",ꮟ:"ƅ",ы:"ƅi",ꭾ:"ɂ",ˤ:"ˁ",ꛍ:"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ",Ꙩ:"ʘ",ⵙ:"ʘ","𐓃":"ʘ",ℾ:"Γ",𝚪:"Γ",𝛤:"Γ",𝜞:"Γ",𝝘:"Γ",𝞒:"Γ",Ⲅ:"Γ",Г:"Γ",Ꮁ:"Γ",ᒥ:"Γ",𖼇:"Γ",Ғ:"Γ̵",ᒯ:"Γ·",Ґ:"Γ'","∆":"Δ","△":"Δ","🜂":"Δ",𝚫:"Δ",𝛥:"Δ",𝜟:"Δ",𝝙:"Δ",𝞓:"Δ",Ⲇ:"Δ",ⵠ:"Δ",ᐃ:"Δ",𖼚:"Δ",𐊅:"Δ",𐊣:"Δ","⍙":"Δ̲",ᐏ:"Δ·",ᐬ:"Δᐠ",𝟋:"ϝ",𝛇:"ζ",𝜁:"ζ",𝜻:"ζ",𝝵:"ζ",𝞯:"ζ",ⳤ:"ϗ",𝛌:"λ",𝜆:"λ",𝝀:"λ",𝝺:"λ",𝞴:"λ",Ⲗ:"λ","𐓛":"λ",µ:"μ",𝛍:"μ",𝜇:"μ",𝝁:"μ",𝝻:"μ",𝞵:"μ",𝛏:"ξ",𝜉:"ξ",𝝃:"ξ",𝝽:"ξ",𝞷:"ξ",𝚵:"Ξ",𝛯:"Ξ",𝜩:"Ξ",𝝣:"Ξ",𝞝:"Ξ",ϖ:"π",ℼ:"π",𝛑:"π",𝛡:"π",𝜋:"π",𝜛:"π",𝝅:"π",𝝕:"π",𝝿:"π",𝞏:"π",𝞹:"π",𝟉:"π",ᴨ:"π",п:"π","∏":"Π",ℿ:"Π",𝚷:"Π",𝛱:"Π",𝜫:"Π",𝝥:"Π",𝞟:"Π",Ⲡ:"Π",П:"Π",ꛛ:"Π",𐊭:"Ϙ",𐌒:"Ϙ",ϛ:"ς",𝛓:"ς",𝜍:"ς",𝝇:"ς",𝞁:"ς",𝞻:"ς",𝚽:"Φ",𝛷:"Φ",𝜱:"Φ",𝝫:"Φ",𝞥:"Φ",Ⲫ:"Φ",Ф:"Φ",Փ:"Φ",ቀ:"Φ",ᛰ:"Φ",𐊳:"Φ",ꭓ:"χ",ꭕ:"χ",𝛘:"χ",𝜒:"χ",𝝌:"χ",𝞆:"χ",𝟀:"χ",ⲭ:"χ",𝛙:"ψ",𝜓:"ψ",𝝍:"ψ",𝞇:"ψ",𝟁:"ψ",ѱ:"ψ","𐓹":"ψ",𝚿:"Ψ",𝛹:"Ψ",𝜳:"Ψ",𝝭:"Ψ",𝞧:"Ψ",Ⲯ:"Ψ",Ѱ:"Ψ","𐓑":"Ψ",ᛘ:"Ψ",𐊵:"Ψ","⍵":"ω",ꞷ:"ω",𝛚:"ω",𝜔:"ω",𝝎:"ω",𝞈:"ω",𝟂:"ω",ⲱ:"ω",ꙍ:"ω",Ω:"Ω",𝛀:"Ω",𝛺:"Ω",𝜴:"Ω",𝝮:"Ω",𝞨:"Ω",ᘯ:"Ω",ᘵ:"Ω",𐊶:"Ω","⍹":"ω̲",ώ:"ῴ","☰":"Ⲷ",Ⳝ:"Ϭ",җ:"ж̩",Җ:"Ж̩","𝈋":"И",Ͷ:"И",ꚡ:"И",𐐥:"И",Й:"Ѝ",Ҋ:"Ѝ̦",ѝ:"й",ҋ:"й̦","𐒼":"Ӄ",ᴫ:"л",ӆ:"л̦",ꭠ:"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ",Ꮗ:"Ѡ",ᗯ:"Ѡ",Ѽ:"Ѡ҆҇",ᣭ:"Ѡ·",Ꞷ:"Ꙍ",ӌ:"ҷ",Ӌ:"Ҷ",Ҿ:"Ҽ̨",ⲽ:"ш",Ⲽ:"Ш",Ꙑ:"Ъl","℈":"Э","🜁":"Ꙙ",𖼜:"Ꙙ",ꦒ:"ⰿ",և:"եւ",ኔ:"ձ",ﬔ:"մե",ﬕ:"մի",ﬗ:"մխ",ﬓ:"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո",በ:"Ո",ᑎ:"Ո",ꓵ:"Ո",ᑚ:"Ո·",ᑨ:"Ո'",ﬖ:"վն","₽":"Ք","˓":"ՙ",ʿ:"ՙ",ℵ:"א",ﬡ:"א",אָ:"אַ",אּ:"אַ",ﭏ:"אל",ℶ:"ב",ℷ:"ג",ℸ:"ד",ﬢ:"ד",ﬣ:"ה",יּ:"יִ",ﬤ:"כ",ﬥ:"ל",ﬦ:"ם",ﬠ:"ע",ﬧ:"ר",שׂ:"שׁ",שּ:"שׁ",שּׂ:"שּׁ",ﬨ:"ת",ﺀ:"ء","۽":"ء͈",ﺂ:"آ",ﺁ:"آ",ﭑ:"ٱ",ﭐ:"ٱ",𞸁:"ب",𞸡:"ب",𞹡:"ب",𞺁:"ب",𞺡:"ب",ﺑ:"ب",ﺒ:"ب",ﺐ:"ب",ﺏ:"ب",ݑ:"بۛ","ࢶ":"بۢ",ࢡ:"بٔ",ﲠ:"بo",ﳢ:"بo",ﲜ:"بج",ﰅ:"بج",ﲝ:"بح",ﰆ:"بح",ﷂ:"بحى",ﲞ:"بخ",ﰇ:"بخ",ﳒ:"بخ",ﱋ:"بخ",ﶞ:"بخى",ﱪ:"بر",ﱫ:"بز",ﲟ:"بم",ﳡ:"بم",ﱬ:"بم",ﰈ:"بم",ﱭ:"بن",ﱮ:"بى",ﰉ:"بى",ﱯ:"بى",ﰊ:"بى",ﭔ:"ٻ",ﭕ:"ٻ",ﭓ:"ٻ",ﭒ:"ٻ",ې:"ٻ",ﯦ:"ٻ",ﯧ:"ٻ",ﯥ:"ٻ",ﯤ:"ٻ",ﭜ:"ڀ",ﭝ:"ڀ",ﭛ:"ڀ",ﭚ:"ڀ",ࢩ:"ݔ",ݧ:"ݔ","⍥":"ة",ö:"ة",ﺔ:"ة",ﺓ:"ة",ۃ:"ة",𞸕:"ت",𞸵:"ت",𞹵:"ت",𞺕:"ت",𞺵:"ت",ﺗ:"ت",ﺘ:"ت",ﺖ:"ت",ﺕ:"ت",ﲥ:"تo",ﳤ:"تo",ﲡ:"تج",ﰋ:"تج",ﵐ:"تجم",ﶠ:"تجى",ﶟ:"تجى",ﲢ:"تح",ﰌ:"تح",ﵒ:"تحج",ﵑ:"تحج",ﵓ:"تحم",ﲣ:"تخ",ﰍ:"تخ",ﵔ:"تخم",ﶢ:"تخى",ﶡ:"تخى",ﱰ:"تر",ﱱ:"تز",ﲤ:"تم",ﳣ:"تم",ﱲ:"تم",ﰎ:"تم",ﵕ:"تمج",ﵖ:"تمح",ﵗ:"تمخ",ﶤ:"تمى",ﶣ:"تمى",ﱳ:"تن",ﱴ:"تى",ﰏ:"تى",ﱵ:"تى",ﰐ:"تى",ﭠ:"ٺ",ﭡ:"ٺ",ﭟ:"ٺ",ﭞ:"ٺ",ﭤ:"ٿ",ﭥ:"ٿ",ﭣ:"ٿ",ﭢ:"ٿ",𞸂:"ج",𞸢:"ج",𞹂:"ج",𞹢:"ج",𞺂:"ج",𞺢:"ج",ﺟ:"ج",ﺠ:"ج",ﺞ:"ج",ﺝ:"ج",ﲧ:"جح",ﰕ:"جح",ﶦ:"جحى",ﶾ:"جحى",ﷻ:"جل جلlلo",ﲨ:"جم",ﰖ:"جم",ﵙ:"جمح",ﵘ:"جمح",ﶧ:"جمى",ﶥ:"جمى",ﴝ:"جى",ﴁ:"جى",ﴞ:"جى",ﴂ:"جى",ﭸ:"ڃ",ﭹ:"ڃ",ﭷ:"ڃ",ﭶ:"ڃ",ﭴ:"ڄ",ﭵ:"ڄ",ﭳ:"ڄ",ﭲ:"ڄ",ﭼ:"چ",ﭽ:"چ",ﭻ:"چ",ﭺ:"چ",ﮀ:"ڇ",ﮁ:"ڇ",ﭿ:"ڇ",ﭾ:"ڇ",𞸇:"ح",𞸧:"ح",𞹇:"ح",𞹧:"ح",𞺇:"ح",𞺧:"ح",ﺣ:"ح",ﺤ:"ح",ﺢ:"ح",ﺡ:"ح",څ:"حۛ",ځ:"حٔ",ݲ:"حٔ",ﲩ:"حج",ﰗ:"حج",ﶿ:"حجى",ﲪ:"حم",ﰘ:"حم",ﵛ:"حمى",ﵚ:"حمى",ﴛ:"حى",ﳿ:"حى",ﴜ:"حى",ﴀ:"حى",𞸗:"خ",𞸷:"خ",𞹗:"خ",𞹷:"خ",𞺗:"خ",𞺷:"خ",ﺧ:"خ",ﺨ:"خ",ﺦ:"خ",ﺥ:"خ",ﲫ:"خج",ﰙ:"خج",ﰚ:"خح",ﲬ:"خم",ﰛ:"خم",ﴟ:"خى",ﴃ:"خى",ﴠ:"خى",ﴄ:"خى","𐋡":"د",𞸃:"د",𞺃:"د",𞺣:"د",ﺪ:"د",ﺩ:"د",ڈ:"دؕ",ﮉ:"دؕ",ﮈ:"دؕ",ڎ:"دۛ",ﮇ:"دۛ",ﮆ:"دۛ",ۮ:"د̂",ࢮ:"د̤̣",𞸘:"ذ",𞺘:"ذ",𞺸:"ذ",ﺬ:"ذ",ﺫ:"ذ",ﱛ:"ذٰ",ڋ:"ڊؕ",ﮅ:"ڌ",ﮄ:"ڌ",ﮃ:"ڍ",ﮂ:"ڍ",𞸓:"ر",𞺓:"ر",𞺳:"ر",ﺮ:"ر",ﺭ:"ر",ڑ:"رؕ",ﮍ:"رؕ",ﮌ:"رؕ",ژ:"رۛ",ﮋ:"رۛ",ﮊ:"رۛ",ڒ:"ر̆","ࢹ":"ر̆̇",ۯ:"ر̂",ݬ:"رٔ",ﱜ:"رٰ",ﷶ:"رسول","﷼":"رىlل",𞸆:"ز",𞺆:"ز",𞺦:"ز",ﺰ:"ز",ﺯ:"ز",ࢲ:"ز̂",ݱ:"ڗؕ",𞸎:"س",𞸮:"س",𞹎:"س",𞹮:"س",𞺎:"س",𞺮:"س",ﺳ:"س",ﺴ:"س",ﺲ:"س",ﺱ:"س",ش:"سۛ",𞸔:"سۛ",𞸴:"سۛ",𞹔:"سۛ",𞹴:"سۛ",𞺔:"سۛ",𞺴:"سۛ",ﺷ:"سۛ",ﺸ:"سۛ",ﺶ:"سۛ",ﺵ:"سۛ",ݾ:"س̂",ﴱ:"سo",ﳨ:"سo",ﴲ:"سۛo",ﳪ:"سۛo",ﲭ:"سج",ﴴ:"سج",ﰜ:"سج",ﴭ:"سۛج",ﴷ:"سۛج",ﴥ:"سۛج",ﴉ:"سۛج",ﵝ:"سجح",ﵞ:"سجى",ﵩ:"سۛجى",ﲮ:"سح",ﴵ:"سح",ﰝ:"سح",ﴮ:"سۛح",ﴸ:"سۛح",ﴦ:"سۛح",ﴊ:"سۛح",ﵜ:"سحج",ﵨ:"سۛحم",ﵧ:"سۛحم",ﶪ:"سۛحى",ﲯ:"سخ",ﴶ:"سخ",ﰞ:"سخ",ﴯ:"سۛخ",ﴹ:"سۛخ",ﴧ:"سۛخ",ﴋ:"سۛخ",ﶨ:"سخى",ﷆ:"سخى",ﴪ:"سر",ﴎ:"سر",ﴩ:"سۛر",ﴍ:"سۛر",ﲰ:"سم",ﳧ:"سم",ﰟ:"سم",ﴰ:"سۛم",ﳩ:"سۛم",ﴨ:"سۛم",ﴌ:"سۛم",ﵡ:"سمج",ﵠ:"سمح",ﵟ:"سمح",ﵫ:"سۛمخ",ﵪ:"سۛمخ",ﵣ:"سمم",ﵢ:"سمم",ﵭ:"سۛمم",ﵬ:"سۛمم",ﴗ:"سى",ﳻ:"سى",ﴘ:"سى",ﳼ:"سى",ﴙ:"سۛى",ﳽ:"سۛى",ﴚ:"سۛى",ﳾ:"سۛى","𐋲":"ص",𞸑:"ص",𞸱:"ص",𞹑:"ص",𞹱:"ص",𞺑:"ص",𞺱:"ص",ﺻ:"ص",ﺼ:"ص",ﺺ:"ص",ﺹ:"ص",ڞ:"صۛ",ࢯ:"ص̤̣",ﲱ:"صح",ﰠ:"صح",ﵥ:"صحح",ﵤ:"صحح",ﶩ:"صحى",ﲲ:"صخ",ﴫ:"صر",ﴏ:"صر",ﷵ:"صلعم",ﷹ:"صلى",ﷰ:"صلى",ﷺ:"صلى lللo علىo وسلم",ﲳ:"صم",ﰡ:"صم",ﷅ:"صمم",ﵦ:"صمم",ﴡ:"صى",ﴅ:"صى",ﴢ:"صى",ﴆ:"صى",𞸙:"ض",𞸹:"ض",𞹙:"ض",𞹹:"ض",𞺙:"ض",𞺹:"ض",ﺿ:"ض",ﻀ:"ض",ﺾ:"ض",ﺽ:"ض",ﲴ:"ضج",ﰢ:"ضج",ﲵ:"ضح",ﰣ:"ضح",ﵮ:"ضحى",ﶫ:"ضحى",ﲶ:"ضخ",ﰤ:"ضخ",ﵰ:"ضخم",ﵯ:"ضخم",ﴬ:"ضر",ﴐ:"ضر",ﲷ:"ضم",ﰥ:"ضم",ﴣ:"ضى",ﴇ:"ضى",ﴤ:"ضى",ﴈ:"ضى","𐋨":"ط",𞸈:"ط",𞹨:"ط",𞺈:"ط",𞺨:"ط",ﻃ:"ط",ﻄ:"ط",ﻂ:"ط",ﻁ:"ط",ڟ:"طۛ",ﲸ:"طح",ﰦ:"طح",ﴳ:"طم",ﴺ:"طم",ﰧ:"طم",ﵲ:"طمح",ﵱ:"طمح",ﵳ:"طمم",ﵴ:"طمى",ﴑ:"طى",ﳵ:"طى",ﴒ:"طى",ﳶ:"طى",𞸚:"ظ",𞹺:"ظ",𞺚:"ظ",𞺺:"ظ",ﻇ:"ظ",ﻈ:"ظ",ﻆ:"ظ",ﻅ:"ظ",ﲹ:"ظم",ﴻ:"ظم",ﰨ:"ظم","؏":"ع",𞸏:"ع",𞸯:"ع",𞹏:"ع",𞹯:"ع",𞺏:"ع",𞺯:"ع",ﻋ:"ع",ﻌ:"ع",ﻊ:"ع",ﻉ:"ع",ﲺ:"عج",ﰩ:"عج",ﷄ:"عجم",ﵵ:"عجم",ﷷ:"علىo",ﲻ:"عم",ﰪ:"عم",ﵷ:"عمم",ﵶ:"عمم",ﵸ:"عمى",ﶶ:"عمى",ﴓ:"عى",ﳷ:"عى",ﴔ:"عى",ﳸ:"عى",𞸛:"غ",𞸻:"غ",𞹛:"غ",𞹻:"غ",𞺛:"غ",𞺻:"غ",ﻏ:"غ",ﻐ:"غ",ﻎ:"غ",ﻍ:"غ",ﲼ:"غج",ﰫ:"غج",ﲽ:"غم",ﰬ:"غم",ﵹ:"غمم",ﵻ:"غمى",ﵺ:"غمى",ﴕ:"غى",ﳹ:"غى",ﴖ:"غى",ﳺ:"غى",𞸐:"ف",𞸰:"ف",𞹰:"ف",𞺐:"ف",𞺰:"ف",ﻓ:"ف",ﻔ:"ف",ﻒ:"ف",ﻑ:"ف",ڧ:"ف",ﲾ:"فج",ﰭ:"فج",ﲿ:"فح",ﰮ:"فح",ﳀ:"فخ",ﰯ:"فخ",ﵽ:"فخم",ﵼ:"فخم",ﳁ:"فم",ﰰ:"فم",ﷁ:"فمى",ﱼ:"فى",ﰱ:"فى",ﱽ:"فى",ﰲ:"فى",𞸞:"ڡ",𞹾:"ڡ","ࢻ":"ڡ",ٯ:"ڡ",𞸟:"ڡ",𞹟:"ڡ","ࢼ":"ڡ",ڤ:"ڡۛ",ﭬ:"ڡۛ",ﭭ:"ڡۛ",ﭫ:"ڡۛ",ﭪ:"ڡۛ",ڨ:"ڡۛ",ࢤ:"ڢۛ",ﭰ:"ڦ",ﭱ:"ڦ",ﭯ:"ڦ",ﭮ:"ڦ",𞸒:"ق",𞸲:"ق",𞹒:"ق",𞹲:"ق",𞺒:"ق",𞺲:"ق",ﻗ:"ق",ﻘ:"ق",ﻖ:"ق",ﻕ:"ق",ﳂ:"قح",ﰳ:"قح",ﷱ:"قلى",ﳃ:"قم",ﰴ:"قم",ﶴ:"قمح",ﵾ:"قمح",ﵿ:"قمم",ﶲ:"قمى",ﱾ:"قى",ﰵ:"قى",ﱿ:"قى",ﰶ:"قى",𞸊:"ك",𞸪:"ك",𞹪:"ك",ﻛ:"ك",ﻜ:"ك",ﻚ:"ك",ﻙ:"ك",ک:"ك",ﮐ:"ك",ﮑ:"ك",ﮏ:"ك",ﮎ:"ك",ڪ:"ك",ڭ:"كۛ",ﯕ:"كۛ",ﯖ:"كۛ",ﯔ:"كۛ",ﯓ:"كۛ",ݣ:"كۛ",ﲀ:"كl",ﰷ:"كl",ﳄ:"كج",ﰸ:"كج",ﳅ:"كح",ﰹ:"كح",ﳆ:"كخ",ﰺ:"كخ",ﳇ:"كل",ﳫ:"كل",ﲁ:"كل",ﰻ:"كل",ﳈ:"كم",ﳬ:"كم",ﲂ:"كم",ﰼ:"كم",ﷃ:"كمم",ﶻ:"كمم",ﶷ:"كمى",ﲃ:"كى",ﰽ:"كى",ﲄ:"كى",ﰾ:"كى",ݢ:"ڬ",ﮔ:"گ",ﮕ:"گ",ﮓ:"گ",ﮒ:"گ",ࢰ:"گ",ڴ:"گۛ",ﮜ:"ڱ",ﮝ:"ڱ",ﮛ:"ڱ",ﮚ:"ڱ",ﮘ:"ڳ",ﮙ:"ڳ",ﮗ:"ڳ",ﮖ:"ڳ",𞸋:"ل",𞸫:"ل",𞹋:"ل",𞺋:"ل",𞺫:"ل",ﻟ:"ل",ﻠ:"ل",ﻞ:"ل",ﻝ:"ل",ڷ:"لۛ",ڵ:"ل̆",ﻼ:"لl",ﻻ:"لl",ﻺ:"لlٕ",ﻹ:"لlٕ",ﻸ:"لlٴ",ﻷ:"لlٴ",ﳍ:"لo",ﻶ:"لآ",ﻵ:"لآ",ﳉ:"لج",ﰿ:"لج",ﶃ:"لجج",ﶄ:"لجج",ﶺ:"لجم",ﶼ:"لجم",ﶬ:"لجى",ﳊ:"لح",ﱀ:"لح",ﶵ:"لحم",ﶀ:"لحم",ﶂ:"لحى",ﶁ:"لحى",ﳋ:"لخ",ﱁ:"لخ",ﶆ:"لخم",ﶅ:"لخم",ﳌ:"لم",ﳭ:"لم",ﲅ:"لم",ﱂ:"لم",ﶈ:"لمح",ﶇ:"لمح",ﶭ:"لمى",ﲆ:"لى",ﱃ:"لى",ﲇ:"لى",ﱄ:"لى",𞸌:"م",𞸬:"م",𞹬:"م",𞺌:"م",𞺬:"م",ﻣ:"م",ﻤ:"م",ﻢ:"م",ﻡ:"م",ࢧ:"مۛ","۾":"م͈",ﲈ:"مl",ﳎ:"مج",ﱅ:"مج",ﶌ:"مجح",ﶒ:"مجخ",ﶍ:"مجم",ﷀ:"مجى",ﳏ:"مح",ﱆ:"مح",ﶉ:"محج",ﶊ:"محم",ﷴ:"محمد",ﶋ:"محى",ﳐ:"مخ",ﱇ:"مخ",ﶎ:"مخج",ﶏ:"مخم",ﶹ:"مخى",ﳑ:"مم",ﲉ:"مم",ﱈ:"مم",ﶱ:"ممى",ﱉ:"مى",ﱊ:"مى",𞸍:"ن",𞸭:"ن",𞹍:"ن",𞹭:"ن",𞺍:"ن",𞺭:"ن",ﻧ:"ن",ﻨ:"ن",ﻦ:"ن",ﻥ:"ن",ݨ:"نؕ",ݩ:"ن̆",ﳖ:"نo",ﳯ:"نo",ﶸ:"نجح",ﶽ:"نجح",ﶘ:"نجم",ﶗ:"نجم",ﶙ:"نجى",ﷇ:"نجى",ﳓ:"نح",ﱌ:"نح",ﶕ:"نحم",ﶖ:"نحى",ﶳ:"نحى",ﳔ:"نخ",ﱍ:"نخ",ﲊ:"نر",ﲋ:"نز",ﳕ:"نم",ﳮ:"نم",ﲌ:"نم",ﱎ:"نم",ﶛ:"نمى",ﶚ:"نمى",ﲍ:"نن",ﲎ:"نى",ﱏ:"نى",ﲏ:"نى",ﱐ:"نى",ۂ:"ۀ",ﮥ:"ۀ",ﮤ:"ۀ","𐋤":"و",𞸅:"و",𞺅:"و",𞺥:"و",ﻮ:"و",ﻭ:"و",ࢱ:"و",ۋ:"وۛ",ﯟ:"وۛ",ﯞ:"وۛ",ۇ:"و̓",ﯘ:"و̓",ﯗ:"و̓",ۆ:"و̆",ﯚ:"و̆",ﯙ:"و̆",ۉ:"و̂",ﯣ:"و̂",ﯢ:"و̂",ۈ:"وٰ",ﯜ:"وٰ",ﯛ:"وٰ",ؤ:"وٴ",ﺆ:"وٴ",ﺅ:"وٴ",ٶ:"وٴ",ٷ:"و̓ٴ",ﯝ:"و̓ٴ",ﷸ:"وسلم",ﯡ:"ۅ",ﯠ:"ۅ",ٮ:"ى",𞸜:"ى",𞹼:"ى",ں:"ى",𞸝:"ى",𞹝:"ى",ﮟ:"ى",ﮞ:"ى","ࢽ":"ى",ﯨ:"ى",ﯩ:"ى",ﻰ:"ى",ﻯ:"ى",ي:"ى",𞸉:"ى",𞸩:"ى",𞹉:"ى",𞹩:"ى",𞺉:"ى",𞺩:"ى",ﻳ:"ى",ﻴ:"ى",ﻲ:"ى",ﻱ:"ى",ی:"ى",ﯾ:"ى",ﯿ:"ى",ﯽ:"ى",ﯼ:"ى",ے:"ى",ﮯ:"ى",ﮮ:"ى",ٹ:"ىؕ",ﭨ:"ىؕ",ﭩ:"ىؕ",ﭧ:"ىؕ",ﭦ:"ىؕ",ڻ:"ىؕ",ﮢ:"ىؕ",ﮣ:"ىؕ",ﮡ:"ىؕ",ﮠ:"ىؕ",پ:"ىۛ",ﭘ:"ىۛ",ﭙ:"ىۛ",ﭗ:"ىۛ",ﭖ:"ىۛ",ث:"ىۛ",𞸖:"ىۛ",𞸶:"ىۛ",𞹶:"ىۛ",𞺖:"ىۛ",𞺶:"ىۛ",ﺛ:"ىۛ",ﺜ:"ىۛ",ﺚ:"ىۛ",ﺙ:"ىۛ",ڽ:"ىۛ",ۑ:"ىۛ",ؿ:"ىۛ","ࢷ":"ىۛۢ",ݖ:"ى̆",ێ:"ى̆","ࢺ":"ى̆̇",ؽ:"ى̂",ࢨ:"ىٔ",ﲐ:"ىٰ",ﱝ:"ىٰ",ﳞ:"ىo",ﳱ:"ىo",ﳦ:"ىۛo",ئ:"ىٴ",ﺋ:"ىٴ",ﺌ:"ىٴ",ﺊ:"ىٴ",ﺉ:"ىٴ",ٸ:"ىٴ",ﯫ:"ىٴl",ﯪ:"ىٴl",ﲛ:"ىٴo",ﳠ:"ىٴo",ﯭ:"ىٴo",ﯬ:"ىٴo",ﯸ:"ىٴٻ",ﯷ:"ىٴٻ",ﯶ:"ىٴٻ",ﲗ:"ىٴج",ﰀ:"ىٴج",ﲘ:"ىٴح",ﰁ:"ىٴح",ﲙ:"ىٴخ",ﱤ:"ىٴر",ﱥ:"ىٴز",ﲚ:"ىٴم",ﳟ:"ىٴم",ﱦ:"ىٴم",ﰂ:"ىٴم",ﱧ:"ىٴن",ﯯ:"ىٴو",ﯮ:"ىٴو",ﯱ:"ىٴو̓",ﯰ:"ىٴو̓",ﯳ:"ىٴو̆",ﯲ:"ىٴو̆",ﯵ:"ىٴوٰ",ﯴ:"ىٴوٰ",ﯻ:"ىٴى",ﯺ:"ىٴى",ﱨ:"ىٴى",ﯹ:"ىٴى",ﰃ:"ىٴى",ﱩ:"ىٴى",ﰄ:"ىٴى",ﳚ:"ىج",ﱕ:"ىج",ﰑ:"ىۛج",ﶯ:"ىجى",ﳛ:"ىح",ﱖ:"ىح",ﶮ:"ىحى",ﳜ:"ىخ",ﱗ:"ىخ",ﲑ:"ىر",ﱶ:"ىۛر",ﲒ:"ىز",ﱷ:"ىۛز",ﳝ:"ىم",ﳰ:"ىم",ﲓ:"ىم",ﱘ:"ىم",ﲦ:"ىۛم",ﳥ:"ىۛم",ﱸ:"ىۛم",ﰒ:"ىۛم",ﶝ:"ىمم",ﶜ:"ىمم",ﶰ:"ىمى",ﲔ:"ىن",ﱹ:"ىۛن",ﲕ:"ىى",ﱙ:"ىى",ﲖ:"ىى",ﱚ:"ىى",ﱺ:"ىۛى",ﰓ:"ىۛى",ﱻ:"ىۛى",ﰔ:"ىۛى",ﮱ:"ۓ",ﮰ:"ۓ",𐊸:"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ",Մ:"ሆ",Ռ:"ቡ",Ի:"ኮ",Պ:"ጣ",आ:"अा",ऒ:"अाॆ",ओ:"अाे",औ:"अाै",ऄ:"अॆ",ऑ:"अॉ",ऍ:"एॅ",ऎ:"एॆ",ऐ:"एे",ई:"र्इ",ઽ:"ऽ",𑇜:"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्",আ:"অা",ৠ:"ঋৃ",ৡ:"ঋৃ",𑒒:"ঘ",𑒔:"চ",𑒖:"জ",𑒘:"ঞ",𑒙:"ট",𑒛:"ড",𑒪:"ণ",𑒞:"ত",𑒟:"থ",𑒠:"দ",𑒡:"ধ",𑒢:"ন",𑒣:"প",𑒩:"ব",𑒧:"ম",𑒨:"য",𑒫:"র",𑒝:"ল",𑒭:"ষ",𑒮:"স",𑓄:"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ",ਉ:"ੳੁ",ਊ:"ੳੂ",ਆ:"ਅਾ",ਐ:"ਅੈ",ਔ:"ਅੌ",ਇ:"ੲਿ",ਈ:"ੲੀ",ਏ:"ੲੇ",આ:"અા",ઑ:"અાૅ",ઓ:"અાે",ઔ:"અાૈ",ઍ:"અૅ",એ:"અે",ઐ:"અૈ",ଆ:"ଅା","௮":"அ",ர:"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ",ഉ:"உ",ஊ:"உள",ഊ:"உൗ","௭":"எ","௷":"எவ",ஜ:"ஐ",ജ:"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ",ഺ:"டி",ണ:"ண","௺":"நீ","௴":"மீ","௰":"ய",ഴ:"ழ","ௗ":"ள","ை":"ன",ശ:"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ",ಅ:"అ",ಆ:"ఆ",ಇ:"ఇ",ౠ:"ఋా",ౡ:"ఌా",ಒ:"ఒ",ఔ:"ఒౌ",ಔ:"ఒౌ",ఓ:"ఒౕ",ಓ:"ఒౕ",ಜ:"జ",ಞ:"ఞ",ఢ:"డ̣",ಣ:"ణ",థ:"ధּ",భ:"బ̣",ಯ:"య",ఠ:"రּ",ಱ:"ఱ",ಲ:"ల",ష:"వ̣",హ:"వా",మ:"వు","ూ":"ుా","ౄ":"ృా",ೡ:"ಌಾ",ഈ:"ഇൗ",ഐ:"എെ",ഓ:"ഒാ",ഔ:"ഒൗ",ൡ:"ഞ","൫":"ദ്ര","൹":"നു",ഌ:"നു",ങ:"നു","൯":"ന്",ൻ:"ന്","൬":"ന്ന","൚":"ന്മ",റ:"ര","൪":"ര്",ർ:"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮",𑗘:"𑖂",𑗙:"𑖂",𑗚:"𑖃",𑗛:"𑖄","𑗜":"𑖲","𑗝":"𑖳",ฃ:"ข",ด:"ค",ต:"ค",ม:"ฆ",ຈ:"จ",ซ:"ช",ฏ:"ฎ",ท:"ฑ",ບ:"บ",ປ:"ป",ຝ:"ฝ",ພ:"พ",ຟ:"ฟ",ฦ:"ภ",ຍ:"ย","។":"ฯ",ๅ:"า",ำ:"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู",แ:"เเ",ໜ:"ຫນ",ໝ:"ຫມ",ຳ:"̊າ","༂":"འུྂཿ","༃":"འུྂ༔",ཪ:"ར",ༀ:"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪",ႁ:"ဂှ",က:"ဂာ",ၰ:"ဃှ",ၦ:"ပှ",ဟ:"ပာ",ၯ:"ပာှ",ၾ:"ၽှ",ဩ:"သြ",ဪ:"သြော်","႞":"ႃ̊",ឣ:"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ",ꦣ:"ꦝ",ᢖ:"ᡜ",ᡕ:"ᠵ",ῶ:"Ꮿ",ᐍ:"ᐁ·",ᐫ:"ᐁᐠ",ᐑ:"ᐄ·",ᐓ:"ᐅ·",ᐭ:"ᐅᐠ",ᐕ:"ᐆ·",ᐘ:"ᐊ·",ᐮ:"ᐊᐠ",ᐚ:"ᐋ·",ᣝ:"ᐞᣟ",ᓑ:"ᐡ",ᕀ:"ᐩ",ᐿ:"ᐲ·",ᑃ:"ᐴ·","⍩":"ᐵ",ᑇ:"ᐹ·",ᑜ:"ᑏ·","⸧":"ᑐ","⊃":"ᑐ",ᑞ:"ᑐ·",ᑩ:"ᑐ'","⟉":"ᑐ/","⫗":"ᑐᑕ",ᑠ:"ᑑ·","⸦":"ᑕ","⊂":"ᑕ",ᑢ:"ᑕ·",ᑪ:"ᑕ'",ᑤ:"ᑖ·",ᑵ:"ᑫ·",ᒅ:"ᑫ'",ᑹ:"ᑮ·",ᑽ:"ᑰ·",ᘃ:"ᒉ",ᒓ:"ᒉ·",ᒕ:"ᒋ·",ᒗ:"ᒌ·",ᒛ:"ᒎ·",ᘂ:"ᒐ",ᒝ:"ᒐ·",ᒟ:"ᒑ·",ᒭ:"ᒣ·",ᒱ:"ᒦ·",ᒳ:"ᒧ·",ᒵ:"ᒨ·",ᒹ:"ᒫ·",ᓊ:"ᓀ·",ᣇ:"ᓂ·",ᣉ:"ᓃ·",ᣋ:"ᓄ·",ᣍ:"ᓅ·",ᓌ:"ᓇ·",ᓎ:"ᓈ·",ᘄ:"ᓓ",ᓝ:"ᓓ·",ᓟ:"ᓕ·",ᓡ:"ᓖ·",ᓣ:"ᓗ·",ᓥ:"ᓘ·",ᘇ:"ᓚ",ᓧ:"ᓚ·",ᓩ:"ᓛ·",ᓷ:"ᓭ·",ᓹ:"ᓯ·",ᓻ:"ᓰ·",ᓽ:"ᓱ·",ᓿ:"ᓲ·",ᔁ:"ᓴ·",ᔃ:"ᓵ·",ᔌ:"ᔋ<",ᔎ:"ᔋb",ᔍ:"ᔋᑕ",ᔏ:"ᔋᒐ",ᔘ:"ᔐ·",ᔚ:"ᔑ·",ᔜ:"ᔒ·",ᔞ:"ᔓ·",ᔠ:"ᔔ·",ᔢ:"ᔕ·",ᔤ:"ᔖ·",ᔲ:"ᔨ·",ᔴ:"ᔩ·",ᔶ:"ᔪ·",ᔸ:"ᔫ·",ᔺ:"ᔭ·",ᔼ:"ᔮ·",ᘢ:"ᕃ",ᣠ:"ᕃ·",ᘣ:"ᕆ",ᘤ:"ᕊ",ᕏ:"ᕌ·",ᖃ:"ᕐb",ᖄ:"ᕐḃ",ᖁ:"ᕐd",ᕿ:"ᕐP",ᙯ:"ᕐᑫ",ᕾ:"ᕐᑬ",ᖀ:"ᕐᑮ",ᖂ:"ᕐᑰ",ᖅ:"ᕐᒃ",ᕜ:"ᕚ·",ᣣ:"ᕞ·",ᣤ:"ᕦ·",ᕩ:"ᕧ·",ᣥ:"ᕫ·",ᣨ:"ᖆ·",ᖑ:"ᖕJ",ᙰ:"ᖕᒉ",ᖎ:"ᖕᒊ",ᖏ:"ᖕᒋ",ᖐ:"ᖕᒌ",ᖒ:"ᖕᒎ",ᖓ:"ᖕᒐ",ᖔ:"ᖕᒑ",ᙳ:"ᖖJ",ᙱ:"ᖖᒋ",ᙲ:"ᖖᒌ",ᙴ:"ᖖᒎ",ᙵ:"ᖖᒐ",ᙶ:"ᖖᒑ",ᣪ:"ᖗ·",ᙷ:"ᖧ·",ᙸ:"ᖨ·",ᙹ:"ᖩ·",ᙺ:"ᖪ·",ᙻ:"ᖫ·",ᙼ:"ᖬ·",ᙽ:"ᖭ·","⪫":"ᗒ","⪪":"ᗕ",ꓷ:"ᗡ",ᣰ:"ᗴ·",ᣲ:"ᘛ·",ᶻ:"ᙆ",ꓭ:"ᙠ",ᶺ:"ᣔ",ᴾ:"ᣖ",ᣜ:"ᣟᐞ",ˡ:"ᣳ",ʳ:"ᣴ",ˢ:"ᣵ",ᣛ:"ᣵ",ꚰ:"ᚹ",ᛡ:"ᚼ","⍿":"ᚽ",ᛂ:"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ",ⵣ:"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ",𑢷:"ᛜ",𐊔:"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥",ㄱ:"ᄀ",ᆨ:"ᄀ",ᄁ:"ᄀᄀ",ㄲ:"ᄀᄀ",ᆩ:"ᄀᄀ",ᇺ:"ᄀᄂ",ᅚ:"ᄀᄃ",ᇃ:"ᄀᄅ",ᇻ:"ᄀᄇ",ᆪ:"ᄀᄉ",ㄳ:"ᄀᄉ",ᇄ:"ᄀᄉᄀ",ᇼ:"ᄀᄎ",ᇽ:"ᄀᄏ",ᇾ:"ᄀᄒ",ㄴ:"ᄂ",ᆫ:"ᄂ",ᄓ:"ᄂᄀ",ᇅ:"ᄂᄀ",ᄔ:"ᄂᄂ",ㅥ:"ᄂᄂ",ᇿ:"ᄂᄂ",ᄕ:"ᄂᄃ",ㅦ:"ᄂᄃ",ᇆ:"ᄂᄃ",ퟋ:"ᄂᄅ",ᄖ:"ᄂᄇ",ᅛ:"ᄂᄉ",ᇇ:"ᄂᄉ",ㅧ:"ᄂᄉ",ᅜ:"ᄂᄌ",ᆬ:"ᄂᄌ",ㄵ:"ᄂᄌ",ퟌ:"ᄂᄎ",ᇉ:"ᄂᄐ",ᅝ:"ᄂᄒ",ᆭ:"ᄂᄒ",ㄶ:"ᄂᄒ",ᇈ:"ᄂᅀ",ㅨ:"ᄂᅀ",ㄷ:"ᄃ",ᆮ:"ᄃ",ᄗ:"ᄃᄀ",ᇊ:"ᄃᄀ",ᄄ:"ᄃᄃ",ㄸ:"ᄃᄃ",ퟍ:"ᄃᄃ",ퟎ:"ᄃᄃᄇ",ᅞ:"ᄃᄅ",ᇋ:"ᄃᄅ",ꥠ:"ᄃᄆ",ꥡ:"ᄃᄇ",ퟏ:"ᄃᄇ",ꥢ:"ᄃᄉ",ퟐ:"ᄃᄉ",ퟑ:"ᄃᄉᄀ",ꥣ:"ᄃᄌ",ퟒ:"ᄃᄌ",ퟓ:"ᄃᄎ",ퟔ:"ᄃᄐ",ㄹ:"ᄅ",ᆯ:"ᄅ",ꥤ:"ᄅᄀ",ᆰ:"ᄅᄀ",ㄺ:"ᄅᄀ",ꥥ:"ᄅᄀᄀ",ퟕ:"ᄅᄀᄀ",ᇌ:"ᄅᄀᄉ",ㅩ:"ᄅᄀᄉ",ퟖ:"ᄅᄀᄒ",ᄘ:"ᄅᄂ",ᇍ:"ᄅᄂ",ꥦ:"ᄅᄃ",ᇎ:"ᄅᄃ",ㅪ:"ᄅᄃ",ꥧ:"ᄅᄃᄃ",ᇏ:"ᄅᄃᄒ",ᄙ:"ᄅᄅ",ᇐ:"ᄅᄅ",ퟗ:"ᄅᄅᄏ",ꥨ:"ᄅᄆ",ᆱ:"ᄅᄆ",ㄻ:"ᄅᄆ",ᇑ:"ᄅᄆᄀ",ᇒ:"ᄅᄆᄉ",ퟘ:"ᄅᄆᄒ",ꥩ:"ᄅᄇ",ᆲ:"ᄅᄇ",ㄼ:"ᄅᄇ",ퟙ:"ᄅᄇᄃ",ꥪ:"ᄅᄇᄇ",ᇓ:"ᄅᄇᄉ",ㅫ:"ᄅᄇᄉ",ꥫ:"ᄅᄇᄋ",ᇕ:"ᄅᄇᄋ",ퟚ:"ᄅᄇᄑ",ᇔ:"ᄅᄇᄒ",ꥬ:"ᄅᄉ",ᆳ:"ᄅᄉ",ㄽ:"ᄅᄉ",ᇖ:"ᄅᄉᄉ",ᄛ:"ᄅᄋ",ퟝ:"ᄅᄋ",ꥭ:"ᄅᄌ",ꥮ:"ᄅᄏ",ᇘ:"ᄅᄏ",ᆴ:"ᄅᄐ",ㄾ:"ᄅᄐ",ᆵ:"ᄅᄑ",ㄿ:"ᄅᄑ",ᄚ:"ᄅᄒ",ㅀ:"ᄅᄒ",ᄻ:"ᄅᄒ",ᆶ:"ᄅᄒ",ퟲ:"ᄅᄒ",ᇗ:"ᄅᅀ",ㅬ:"ᄅᅀ",ퟛ:"ᄅᅌ",ᇙ:"ᄅᅙ",ㅭ:"ᄅᅙ",ퟜ:"ᄅᅙᄒ",ㅁ:"ᄆ",ᆷ:"ᄆ",ꥯ:"ᄆᄀ",ᇚ:"ᄆᄀ",ퟞ:"ᄆᄂ",ퟟ:"ᄆᄂᄂ",ꥰ:"ᄆᄃ",ᇛ:"ᄆᄅ",ퟠ:"ᄆᄆ",ᄜ:"ᄆᄇ",ㅮ:"ᄆᄇ",ᇜ:"ᄆᄇ",ퟡ:"ᄆᄇᄉ",ꥱ:"ᄆᄉ",ᇝ:"ᄆᄉ",ㅯ:"ᄆᄉ",ᇞ:"ᄆᄉᄉ",ᄝ:"ᄆᄋ",ㅱ:"ᄆᄋ",ᇢ:"ᄆᄋ",ퟢ:"ᄆᄌ",ᇠ:"ᄆᄎ",ᇡ:"ᄆᄒ",ᇟ:"ᄆᅀ",ㅰ:"ᄆᅀ",ㅂ:"ᄇ",ᆸ:"ᄇ",ᄞ:"ᄇᄀ",ㅲ:"ᄇᄀ",ᄟ:"ᄇᄂ",ᄠ:"ᄇᄃ",ㅳ:"ᄇᄃ",ퟣ:"ᄇᄃ",ᇣ:"ᄇᄅ",ퟤ:"ᄇᄅᄑ",ퟥ:"ᄇᄆ",ᄈ:"ᄇᄇ",ㅃ:"ᄇᄇ",ퟦ:"ᄇᄇ",ᄬ:"ᄇᄇᄋ",ㅹ:"ᄇᄇᄋ",ᄡ:"ᄇᄉ",ㅄ:"ᄇᄉ",ᆹ:"ᄇᄉ",ᄢ:"ᄇᄉᄀ",ㅴ:"ᄇᄉᄀ",ᄣ:"ᄇᄉᄃ",ㅵ:"ᄇᄉᄃ",ퟧ:"ᄇᄉᄃ",ᄤ:"ᄇᄉᄇ",ᄥ:"ᄇᄉᄉ",ᄦ:"ᄇᄉᄌ",ꥲ:"ᄇᄉᄐ",ᄫ:"ᄇᄋ",ㅸ:"ᄇᄋ",ᇦ:"ᄇᄋ",ᄧ:"ᄇᄌ",ㅶ:"ᄇᄌ",ퟨ:"ᄇᄌ",ᄨ:"ᄇᄎ",ퟩ:"ᄇᄎ",ꥳ:"ᄇᄏ",ᄩ:"ᄇᄐ",ㅷ:"ᄇᄐ",ᄪ:"ᄇᄑ",ᇤ:"ᄇᄑ",ꥴ:"ᄇᄒ",ᇥ:"ᄇᄒ",ㅅ:"ᄉ",ᆺ:"ᄉ",ᄭ:"ᄉᄀ",ㅺ:"ᄉᄀ",ᇧ:"ᄉᄀ",ᄮ:"ᄉᄂ",ㅻ:"ᄉᄂ",ᄯ:"ᄉᄃ",ㅼ:"ᄉᄃ",ᇨ:"ᄉᄃ",ᄰ:"ᄉᄅ",ᇩ:"ᄉᄅ",ᄱ:"ᄉᄆ",ퟪ:"ᄉᄆ",ᄲ:"ᄉᄇ",ㅽ:"ᄉᄇ",ᇪ:"ᄉᄇ",ᄳ:"ᄉᄇᄀ",ퟫ:"ᄉᄇᄋ",ᄊ:"ᄉᄉ",ㅆ:"ᄉᄉ",ᆻ:"ᄉᄉ",ퟬ:"ᄉᄉᄀ",ퟭ:"ᄉᄉᄃ",ꥵ:"ᄉᄉᄇ",ᄴ:"ᄉᄉᄉ",ᄵ:"ᄉᄋ",ᄶ:"ᄉᄌ",ㅾ:"ᄉᄌ",ퟯ:"ᄉᄌ",ᄷ:"ᄉᄎ",ퟰ:"ᄉᄎ",ᄸ:"ᄉᄏ",ᄹ:"ᄉᄐ",ퟱ:"ᄉᄐ",ᄺ:"ᄉᄑ",ퟮ:"ᄉᅀ",ㅇ:"ᄋ",ᆼ:"ᄋ",ᅁ:"ᄋᄀ",ᇬ:"ᄋᄀ",ᇭ:"ᄋᄀᄀ",ᅂ:"ᄋᄃ",ꥶ:"ᄋᄅ",ᅃ:"ᄋᄆ",ᅄ:"ᄋᄇ",ᅅ:"ᄋᄉ",ᇱ:"ᄋᄉ",ㆂ:"ᄋᄉ",ᅇ:"ᄋᄋ",ㆀ:"ᄋᄋ",ᇮ:"ᄋᄋ",ᅈ:"ᄋᄌ",ᅉ:"ᄋᄎ",ᇯ:"ᄋᄏ",ᅊ:"ᄋᄐ",ᅋ:"ᄋᄑ",ꥷ:"ᄋᄒ",ᅆ:"ᄋᅀ",ᇲ:"ᄋᅀ",ㆃ:"ᄋᅀ",ㅈ:"ᄌ",ᆽ:"ᄌ",ퟷ:"ᄌᄇ",ퟸ:"ᄌᄇᄇ",ᅍ:"ᄌᄋ",ᄍ:"ᄌᄌ",ㅉ:"ᄌᄌ",ퟹ:"ᄌᄌ",ꥸ:"ᄌᄌᄒ",ㅊ:"ᄎ",ᆾ:"ᄎ",ᅒ:"ᄎᄏ",ᅓ:"ᄎᄒ",ㅋ:"ᄏ",ᆿ:"ᄏ",ㅌ:"ᄐ",ᇀ:"ᄐ",ꥹ:"ᄐᄐ",ㅍ:"ᄑ",ᇁ:"ᄑ",ᅖ:"ᄑᄇ",ᇳ:"ᄑᄇ",ퟺ:"ᄑᄉ",ᅗ:"ᄑᄋ",ㆄ:"ᄑᄋ",ᇴ:"ᄑᄋ",ퟻ:"ᄑᄐ",ꥺ:"ᄑᄒ",ㅎ:"ᄒ",ᇂ:"ᄒ",ᇵ:"ᄒᄂ",ᇶ:"ᄒᄅ",ᇷ:"ᄒᄆ",ᇸ:"ᄒᄇ",ꥻ:"ᄒᄉ",ᅘ:"ᄒᄒ",ㆅ:"ᄒᄒ",ᄽ:"ᄼᄼ",ᄿ:"ᄾᄾ",ㅿ:"ᅀ",ᇫ:"ᅀ",ퟳ:"ᅀᄇ",ퟴ:"ᅀᄇᄋ",ㆁ:"ᅌ",ᇰ:"ᅌ",ퟵ:"ᅌᄆ",ퟶ:"ᅌᄒ",ᅏ:"ᅎᅎ",ᅑ:"ᅐᅐ",ㆆ:"ᅙ",ᇹ:"ᅙ",ꥼ:"ᅙᅙ",ㅤ:"ᅠ",ㅏ:"ᅡ",ᆣ:"ᅡー",ᅶ:"ᅡᅩ",ᅷ:"ᅡᅮ",ᅢ:"ᅡ丨",ㅐ:"ᅡ丨",ㅑ:"ᅣ",ᅸ:"ᅣᅩ",ᅹ:"ᅣᅭ",ᆤ:"ᅣᅮ",ᅤ:"ᅣ丨",ㅒ:"ᅣ丨",ㅓ:"ᅥ",ᅼ:"ᅥー",ᅺ:"ᅥᅩ",ᅻ:"ᅥᅮ",ᅦ:"ᅥ丨",ㅔ:"ᅥ丨",ㅕ:"ᅧ",ᆥ:"ᅧᅣ",ᅽ:"ᅧᅩ",ᅾ:"ᅧᅮ",ᅨ:"ᅧ丨",ㅖ:"ᅧ丨",ㅗ:"ᅩ",ᅪ:"ᅩᅡ",ㅘ:"ᅩᅡ",ᅫ:"ᅩᅡ丨",ㅙ:"ᅩᅡ丨",ᆦ:"ᅩᅣ",ᆧ:"ᅩᅣ丨",ᅿ:"ᅩᅥ",ᆀ:"ᅩᅥ丨",ힰ:"ᅩᅧ",ᆁ:"ᅩᅧ丨",ᆂ:"ᅩᅩ",ힱ:"ᅩᅩ丨",ᆃ:"ᅩᅮ",ᅬ:"ᅩ丨",ㅚ:"ᅩ丨",ㅛ:"ᅭ",ힲ:"ᅭᅡ",ힳ:"ᅭᅡ丨",ᆄ:"ᅭᅣ",ㆇ:"ᅭᅣ",ᆆ:"ᅭᅣ",ᆅ:"ᅭᅣ丨",ㆈ:"ᅭᅣ丨",ힴ:"ᅭᅥ",ᆇ:"ᅭᅩ",ᆈ:"ᅭ丨",ㆉ:"ᅭ丨",ㅜ:"ᅮ",ᆉ:"ᅮᅡ",ᆊ:"ᅮᅡ丨",ᅯ:"ᅮᅥ",ㅝ:"ᅮᅥ",ᆋ:"ᅮᅥー",ᅰ:"ᅮᅥ丨",ㅞ:"ᅮᅥ丨",ힵ:"ᅮᅧ",ᆌ:"ᅮᅧ丨",ᆍ:"ᅮᅮ",ᅱ:"ᅮ丨",ㅟ:"ᅮ丨",ힶ:"ᅮ丨丨",ㅠ:"ᅲ",ᆎ:"ᅲᅡ",ힷ:"ᅲᅡ丨",ᆏ:"ᅲᅥ",ᆐ:"ᅲᅥ丨",ᆑ:"ᅲᅧ",ㆊ:"ᅲᅧ",ᆒ:"ᅲᅧ丨",ㆋ:"ᅲᅧ丨",ힸ:"ᅲᅩ",ᆓ:"ᅲᅮ",ᆔ:"ᅲ丨",ㆌ:"ᅲ丨",ㆍ:"ᆞ",ퟅ:"ᆞᅡ",ᆟ:"ᆞᅥ",ퟆ:"ᆞᅥ丨",ᆠ:"ᆞᅮ",ᆢ:"ᆞᆞ",ᆡ:"ᆞ丨",ㆎ:"ᆞ丨",ヘ:"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ",Ʇ:"ꓕ",Ꞟ:"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ",𖼦:"ꓶ",𐐑:"ꓶ","⅃":"𖼀",𑫦:"𑫥𑫯",𑫨:"𑫥𑫥",𑫩:"𑫥𑫥𑫯",𑫪:"𑫥𑫥𑫰",𑫧:"𑫥𑫰",𑫴:"𑫳𑫯",𑫶:"𑫳𑫳",𑫷:"𑫳𑫳𑫯",𑫸:"𑫳𑫳𑫰",𑫵:"𑫳𑫰",𑫬:"𑫫𑫯",𑫭:"𑫫𑫫",𑫮:"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨",Ꚛ:"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀",ꞛ:"𐐺",Ꞛ:"𐐒","𐒠":"𐒆",𐏑:"𐎂",𐏓:"𐎓",𒀸:"𐎚","☥":"𐦞",𓋹:"𐦞",〹:"卄",不:"不",丽:"丽",並:"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨",ᅵ:"丨",ㅣ:"丨","⼁":"丨",ᆜ:"丨ー",ᆘ:"丨ᅡ",ᆙ:"丨ᅣ",ힽ:"丨ᅣᅩ",ힾ:"丨ᅣ丨",ힿ:"丨ᅧ",ퟀ:"丨ᅧ丨",ᆚ:"丨ᅩ",ퟁ:"丨ᅩ丨",ퟂ:"丨ᅭ",ᆛ:"丨ᅮ",ퟃ:"丨ᅲ",ᆝ:"丨ᆞ",ퟄ:"丨丨",串:"串",丸:"丸",丹:"丹",乁:"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀",亂:"亂","㇚":"亅","⼅":"亅",了:"了",ニ:"二","⼆":"二",𠄢:"𠄢","⼇":"亠",亮:"亮","⼈":"人",イ:"亻","⺅":"亻",什:"什",仌:"仌",令:"令",你:"你",倂:"併",倂:"併",侀:"侀",來:"來",例:"例",侮:"侮",侮:"侮",侻:"侻",便:"便",值:"値",倫:"倫",偺:"偺",備:"備",像:"像",僚:"僚",僧:"僧",僧:"僧",㒞:"㒞","⼉":"儿",兀:"兀","⺎":"兀",充:"充",免:"免",免:"免",兔:"兔",兤:"兤","⼊":"入",內:"內",全:"全",兩:"兩",ハ:"八","⼋":"八",六:"六",具:"具",𠔜:"𠔜",𠔥:"𠔥",冀:"冀",㒹:"㒹","⼌":"冂",再:"再",𠕋:"𠕋",冒:"冒",冕:"冕",㒻:"㒻",最:"最","⼍":"冖",冗:"冗",冤:"冤","⼎":"冫",冬:"冬",况:"况",况:"况",冷:"冷",凉:"凉",凌:"凌",凜:"凜",凞:"凞","⼏":"几",𠘺:"𠘺",凵:"凵","⼐":"凵","⼑":"刀","⺉":"刂",刃:"刃",切:"切",切:"切",列:"列",利:"利",㓟:"㓟",刺:"刺",刻:"刻",剆:"剆",割:"割",剷:"剷",劉:"劉",𠠄:"𠠄",カ:"力",力:"力","⼒":"力",劣:"劣",㔕:"㔕",劳:"劳",勇:"勇",勇:"勇",勉:"勉",勉:"勉",勒:"勒",勞:"勞",勤:"勤",勤:"勤",勵:"勵","⼓":"勹",勺:"勺",勺:"勺",包:"包",匆:"匆",𠣞:"𠣞","⼔":"匕",北:"北",北:"北","⼕":"匚","⼖":"匸",匿:"匿","⼗":"十",〸:"十",〺:"卅",卉:"卉","࿖":"卍","࿕":"卐",卑:"卑",卑:"卑",博:"博",ト:"卜","⼘":"卜","⼙":"卩","⺋":"㔾",即:"即",卵:"卵",卽:"卽",卿:"卿",卿:"卿",卿:"卿","⼚":"厂",𠨬:"𠨬","⼛":"厶",參:"參","⼜":"又",及:"及",叟:"叟",𠭣:"𠭣",ロ:"口","⼝":"口",囗:"口","⼞":"口",句:"句",叫:"叫",叱:"叱",吆:"吆",吏:"吏",吝:"吝",吸:"吸",呂:"呂",呈:"呈",周:"周",咞:"咞",咢:"咢",咽:"咽",䎛:"㖈",哶:"哶",唐:"唐",啓:"啓",啟:"啓",啕:"啕",啣:"啣",善:"善",善:"善",喇:"喇",喙:"喙",喙:"喙",喝:"喝",喝:"喝",喫:"喫",喳:"喳",嗀:"嗀",嗂:"嗂",嗢:"嗢",嘆:"嘆",嘆:"嘆",噑:"噑",噴:"噴",器:"器",囹:"囹",圖:"圖",圗:"圗","⼟":"土",士:"土","⼠":"土",型:"型",城:"城",㦳:"㘽",埴:"埴",堍:"堍",報:"報",堲:"堲",塀:"塀",塚:"塚",塚:"塚",塞:"塞",填:"塡",壿:"墫",墬:"墬",墳:"墳",壘:"壘",壟:"壟",𡓤:"𡓤",壮:"壮",売:"売",壷:"壷","⼡":"夂",夆:"夆","⼢":"夊",タ:"夕","⼣":"夕",多:"多",夢:"夢","⼤":"大",奄:"奄",奈:"奈",契:"契",奔:"奔",奢:"奢",女:"女","⼥":"女",𡚨:"𡚨",𡛪:"𡛪",姘:"姘",姬:"姬",娛:"娛",娧:"娧",婢:"婢",婦:"婦",嬀:"媯",㛮:"㛮",㛼:"㛼",媵:"媵",嬈:"嬈",嬨:"嬨",嬾:"嬾",嬾:"嬾","⼦":"子","⼧":"宀",宅:"宅",𡧈:"𡧈",寃:"寃",寘:"寘",寧:"寧",寧:"寧",寧:"寧",寮:"寮",寳:"寳",𡬘:"𡬘","⼨":"寸",寿:"寿",将:"将","⼩":"小",尢:"尢","⺐":"尢","⼪":"尢","⺏":"尣",㞁:"㞁","⼫":"尸",尿:"尿",屠:"屠",屢:"屢",層:"層",履:"履",屮:"屮",屮:"屮","⼬":"屮",𡴋:"𡴋","⼭":"山",峀:"峀",岍:"岍",𡷤:"𡷤",𡷦:"𡷦",崙:"崙",嵃:"嵃",嵐:"嵐",嵫:"嵫",嵮:"嵮",嵼:"嵼",嶲:"嶲",嶺:"嶺","⼮":"巛",巢:"巢",エ:"工","⼯":"工","⼰":"己","⺒":"巳",㠯:"㠯",巽:"巽","⼱":"巾",帲:"帡",帨:"帨",帽:"帽",幩:"幩",㡢:"㡢",𢆃:"𢆃","⼲":"干",年:"年",𢆟:"𢆟","⺓":"幺","⼳":"幺","⼴":"广",度:"度",㡼:"㡼",庰:"庰",庳:"庳",庶:"庶",廊:"廊",廊:"廊",廉:"廉",廒:"廒",廓:"廓",廙:"廙",廬:"廬","⼵":"廴",廾:"廾","⼶":"廾",𢌱:"𢌱",𢌱:"𢌱",弄:"弄","⼷":"弋","⼸":"弓",弢:"弢",弢:"弢","⼹":"彐","⺔":"彑",当:"当",㣇:"㣇","⼺":"彡",形:"形",彩:"彩",彫:"彫","⼻":"彳",律:"律",㣣:"㣣",徚:"徚",復:"復",徭:"徭","⼼":"心","⺖":"忄","⺗":"㣺",忍:"忍",志:"志",念:"念",忹:"忹",怒:"怒",怜:"怜",恵:"恵",㤜:"㤜",㤺:"㤺",悁:"悁",悔:"悔",悔:"悔",惇:"惇",惘:"惘",惡:"惡",𢛔:"𢛔",愈:"愈",慨:"慨",慄:"慄",慈:"慈",慌:"慌",慌:"慌",慎:"慎",慎:"慎",慠:"慠",慺:"慺",憎:"憎",憎:"憎",憎:"憎",憐:"憐",憤:"憤",憯:"憯",憲:"憲",𢡄:"𢡄",𢡊:"𢡊",懞:"懞",懲:"懲",懲:"懲",懲:"懲",懶:"懶",懶:"懶",戀:"戀","⼽":"戈",成:"成",戛:"戛",戮:"戮",戴:"戴","⼾":"戶",戸:"戶","⼿":"手","⺘":"扌",扝:"扝",抱:"抱",拉:"拉",拏:"拏",拓:"拓",拔:"拔",拼:"拼",拾:"拾",𢬌:"𢬌",挽:"挽",捐:"捐",捨:"捨",捻:"捻",掃:"掃",掠:"掠",掩:"掩",揄:"揄",揤:"揤",摒:"摒",𢯱:"𢯱",搜:"搜",搢:"搢",揅:"揅",摩:"摩",摷:"摷",摾:"摾",㨮:"㨮",搉:"㩁",撚:"撚",撝:"撝",擄:"擄",㩬:"㩬","⽀":"支","⽁":"攴","⺙":"攵",敏:"敏",敏:"敏",敖:"敖",敬:"敬",數:"數",𣀊:"𣀊","⽂":"文","⻫":"斉","⽃":"斗",料:"料","⽄":"斤","⽅":"方",旅:"旅","⽆":"无","⺛":"旡",既:"既",旣:"旣","⽇":"日",易:"易",曶:"㫚",㫤:"㫤",晉:"晉",晩:"晚",晴:"晴",晴:"晴",暑:"暑",暑:"暑",暈:"暈",㬈:"㬈",暜:"暜",暴:"暴",曆:"曆",㬙:"㬙",𣊸:"𣊸","⽈":"曰",更:"更",書:"書","⽉":"月",𣍟:"𣍟",肦:"朌",胐:"朏",胊:"朐",脁:"朓",胶:"㬵",朗:"朗",朗:"朗",朗:"朗",脧:"朘",望:"望",望:"望",幐:"㬺",䐠:"㬻",𣎓:"𣎓",膧:"朣",𣎜:"𣎜","⽊":"木",李:"李",杓:"杓",杖:"杖",杞:"杞",𣏃:"𣏃",柿:"杮",杻:"杻",枅:"枅",林:"林",㭉:"㭉",𣏕:"𣏕",柳:"柳",柺:"柺",栗:"栗",栟:"栟",桒:"桒",𣑭:"𣑭",梁:"梁",梅:"梅",梅:"梅",梎:"梎",梨:"梨",椔:"椔",楂:"楂",㮝:"㮝",㮝:"㮝",槩:"㮣",樧:"榝",榣:"榣",槪:"槪",樂:"樂",樂:"樂",樂:"樂",樓:"樓",𣚣:"𣚣",檨:"檨",櫓:"櫓",櫛:"櫛",欄:"欄",㰘:"㰘","⽋":"欠",次:"次",𣢧:"𣢧",歔:"歔",㱎:"㱎","⽌":"止","⻭":"歯",歲:"歲",歷:"歷",歹:"歹","⽍":"歹","⺞":"歺",殟:"殟",殮:"殮","⽎":"殳",殺:"殺",殺:"殺",殺:"殺",殻:"殻",𣪍:"𣪍","⽏":"毋","⺟":"母",𣫺:"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺",汎:"汎",汧:"汧",沈:"沈",沿:"沿",泌:"泌",泍:"泍",泥:"泥",𣲼:"𣲼",洛:"洛",洞:"洞",洴:"洴",派:"派",流:"流",流:"流",流:"流",洖:"洖",浩:"浩",浪:"浪",海:"海",海:"海",浸:"浸",涅:"涅",𣴞:"𣴞",淋:"淋",淚:"淚",淪:"淪",淹:"淹",渚:"渚",港:"港",湮:"湮",潙:"溈",滋:"滋",滋:"滋",溜:"溜",溺:"溺",滇:"滇",滑:"滑",滛:"滛",㴳:"㴳",漏:"漏",漢:"漢",漢:"漢",漣:"漣",𣻑:"𣻑",潮:"潮",𣽞:"𣽞",𣾎:"𣾎",濆:"濆",濫:"濫",濾:"濾",瀛:"瀛",瀞:"瀞",瀞:"瀞",瀹:"瀹",灊:"灊",㶖:"㶖","⽕":"火","⺣":"灬",灰:"灰",灷:"灷",災:"災",炙:"炙",炭:"炭",烈:"烈",烙:"烙",煮:"煮",煮:"煮",𤉣:"𤉣",煅:"煅",煉:"煉",𤋮:"𤋮",熜:"熜",燎:"燎",燐:"燐",𤎫:"𤎫",爐:"爐",爛:"爛",爨:"爨","⽖":"爪",爫:"爫","⺤":"爫",爵:"爵",爵:"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片",牐:"牐","⽛":"牙",𤘈:"𤘈","⽜":"牛",牢:"牢",犀:"犀",犕:"犕","⽝":"犬","⺨":"犭",犯:"犯",狀:"狀",𤜵:"𤜵",狼:"狼",猪:"猪",猪:"猪",𤠔:"𤠔",獵:"獵",獺:"獺","⽞":"玄",率:"率",率:"率","⽟":"玉",王:"王",㺬:"㺬",玥:"玥",玲:"玲",㺸:"㺸",㺸:"㺸",珞:"珞",琉:"琉",理:"理",琢:"琢",瑇:"瑇",瑜:"瑜",瑩:"瑩",瑱:"瑱",瑱:"瑱",璅:"璅",璉:"璉",璘:"璘",瓊:"瓊","⽠":"瓜","⽡":"瓦",㼛:"㼛",甆:"甆","⽢":"甘","⽣":"生",甤:"甤","⽤":"用","⽥":"田",画:"画",甾:"甾",𤰶:"𤰶",留:"留",略:"略",異:"異",異:"異",𤲒:"𤲒","⽦":"疋","⽧":"疒",痢:"痢",瘐:"瘐",瘟:"瘟",瘝:"瘝",療:"療",癩:"癩","⽨":"癶","⽩":"白",𤾡:"𤾡",𤾸:"𤾸","⽪":"皮","⽫":"皿",𥁄:"𥁄",㿼:"㿼",益:"益",益:"益",盛:"盛",盧:"盧",䀈:"䀈","⽬":"目",直:"直",直:"直",𥃲:"𥃲",𥃳:"𥃳",省:"省",䀘:"䀘",𥄙:"𥄙",眞:"眞",真:"真",真:"真",𥄳:"𥄳",着:"着",睊:"睊",睊:"睊",鿃:"䀹",䀹:"䀹",䀹:"䀹",晣:"䀿",䁆:"䁆",瞋:"瞋",𥉉:"𥉉",瞧:"瞧","⽭":"矛","⽮":"矢","⽯":"石",䂖:"䂖",𥐝:"𥐝",硏:"研",硎:"硎",硫:"硫",碌:"碌",碌:"碌",碑:"碑",磊:"磊",磌:"磌",磌:"磌",磻:"磻",䃣:"䃣",礪:"礪","⽰":"示","⺭":"礻",礼:"礼",社:"社",祈:"祈",祉:"祉",𥘦:"𥘦",祐:"祐",祖:"祖",祖:"祖",祝:"祝",神:"神",祥:"祥",視:"視",視:"視",祿:"祿",𥚚:"𥚚",禍:"禍",禎:"禎",福:"福",福:"福",𥛅:"𥛅",禮:"禮","⽱":"禸","⽲":"禾",秊:"秊",䄯:"䄯",秫:"秫",稜:"稜",穊:"穊",穀:"穀",穀:"穀",穏:"穏","⽳":"穴",突:"突",𥥼:"𥥼",窱:"窱",立:"立","⽴":"立","⻯":"竜",𥪧:"𥪧",𥪧:"𥪧",竮:"竮","⽵":"竹",笠:"笠",節:"節",節:"節",䈂:"䈂",𥮫:"𥮫",篆:"篆",䈧:"䈧",築:"築",𥲀:"𥲀",𥳐:"𥳐",簾:"簾",籠:"籠","⽶":"米",类:"类",粒:"粒",精:"精",糒:"糒",糖:"糖",糨:"糨",䊠:"䊠",糣:"糣",糧:"糧","⽷":"糸","⺯":"糹",𥾆:"𥾆",紀:"紀",紐:"紐",索:"索",累:"累",絶:"絕",絣:"絣",絛:"絛",綠:"綠",綾:"綾",緇:"緇",練:"練",練:"練",練:"練",縂:"縂",䌁:"䌁",縉:"縉",縷:"縷",繁:"繁",繅:"繅",𦇚:"𦇚",䌴:"䌴","⽸":"缶",𦈨:"𦈨",缾:"缾",𦉇:"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓",䍙:"䍙",署:"署",𦋙:"𦋙",罹:"罹",罺:"罺",羅:"羅",𦌾:"𦌾","⽺":"羊",羕:"羕",羚:"羚",羽:"羽","⽻":"羽",翺:"翺",老:"老","⽼":"老","⺹":"耂",者:"者",者:"者",者:"者","⽽":"而",𦓚:"𦓚","⽾":"耒",𦔣:"𦔣","⽿":"耳",聆:"聆",聠:"聠",𦖨:"𦖨",聯:"聯",聰:"聰",聾:"聾","⾀":"聿","⺺":"肀","⾁":"肉",肋:"肋",肭:"肭",育:"育",䏕:"䏕",䏙:"䏙",腁:"胼",脃:"脃",脾:"脾",䐋:"䐋",朡:"朡",𦞧:"𦞧",𦞵:"𦞵",朦:"䑃",臘:"臘","⾂":"臣",臨:"臨","⾃":"自",臭:"臭","⾄":"至","⾅":"臼",舁:"舁",舁:"舁",舄:"舄","⾆":"舌",舘:"舘","⾇":"舛","⾈":"舟",䑫:"䑫","⾉":"艮",良:"良","⾊":"色","⾋":"艸",艹:"艹",艹:"艹","⺾":"艹","⺿":"艹","⻀":"艹",芋:"芋",芑:"芑",芝:"芝",花:"花",芳:"芳",芽:"芽",若:"若",若:"若",苦:"苦",𦬼:"𦬼",茶:"茶",荒:"荒",荣:"荣",茝:"茝",茣:"茣",莽:"莽",荓:"荓",菉:"菉",菊:"菊",菌:"菌",菜:"菜",菧:"菧",華:"華",菱:"菱",著:"著",著:"著",𦰶:"𦰶",莭:"莭",落:"落",葉:"葉",蔿:"蒍",𦳕:"𦳕",𦵫:"𦵫",蓮:"蓮",蓱:"蓱",蓳:"蓳",蓼:"蓼",蔖:"蔖",䔫:"䔫",蕤:"蕤",𦼬:"𦼬",藍:"藍",䕝:"䕝",𦾱:"𦾱",䕡:"䕡",藺:"藺",蘆:"蘆",䕫:"䕫",蘒:"蘒",蘭:"蘭",𧃒:"𧃒",虁:"蘷",蘿:"蘿","⾌":"虍","⻁":"虎",虐:"虐",虜:"虜",虜:"虜",虧:"虧",虩:"虩","⾍":"虫",蚩:"蚩",蚈:"蚈",蛢:"蛢",蜎:"蜎",蜨:"蜨",蝫:"蝫",蟡:"蟡",蝹:"蝹",蝹:"蝹",螆:"螆",䗗:"䗗",𧏊:"𧏊",螺:"螺",蠁:"蠁",䗹:"䗹",蠟:"蠟","⾎":"血",行:"行","⾏":"行",衠:"衠",衣:"衣","⾐":"衣","⻂":"衤",裂:"裂",𧙧:"𧙧",裏:"裏",裗:"裗",裞:"裞",裡:"裡",裸:"裸",裺:"裺",䘵:"䘵",褐:"褐",襁:"襁",襤:"襤","⾑":"襾","⻄":"西","⻃":"覀",覆:"覆",見:"見","⾒":"見",𧢮:"𧢮","⻅":"见","⾓":"角","⾔":"言",𧥦:"𧥦",詽:"訮",訞:"䚶",䚾:"䚾",䛇:"䛇",誠:"誠",說:"說",說:"說",調:"調",請:"請",諒:"諒",論:"論",諭:"諭",諭:"諭",諸:"諸",諸:"諸",諾:"諾",諾:"諾",謁:"謁",謁:"謁",謹:"謹",謹:"謹",識:"識",讀:"讀",讏:"讆",變:"變",變:"變","⻈":"讠","⾕":"谷","⾖":"豆",豈:"豈",豕:"豕","⾗":"豕",豣:"豜","⾘":"豸",𧲨:"𧲨","⾙":"貝",貫:"貫",賁:"賁",賂:"賂",賈:"賈",賓:"賓",贈:"贈",贈:"贈",贛:"贛","⻉":"贝","⾚":"赤","⾛":"走",起:"起",趆:"赿",𧻓:"𧻓",𧼯:"𧼯","⾜":"足",跋:"跋",趼:"趼",跺:"跥",路:"路",跰:"跰",躛:"躗","⾝":"身",車:"車","⾞":"車",軔:"軔",輧:"軿",輦:"輦",輪:"輪",輸:"輸",輸:"輸",輻:"輻",轢:"轢","⻋":"车","⾟":"辛",辞:"辞",辰:"辰","⾠":"辰","⾡":"辵",辶:"辶","⻌":"辶","⻍":"辶",巡:"巡",連:"連",逸:"逸",逸:"逸",遲:"遲",遼:"遼",𨗒:"𨗒",𨗭:"𨗭",邏:"邏","⾢":"邑",邔:"邔",郎:"郎",郞:"郎",郞:"郎",郱:"郱",都:"都",𨜮:"𨜮",鄑:"鄑",鄛:"鄛","⾣":"酉",酪:"酪",醙:"醙",醴:"醴","⾤":"釆",里:"里","⾥":"里",量:"量",金:"金","⾦":"金",鈴:"鈴",鈸:"鈸",鉶:"鉶",鋗:"鋗",鋘:"鋘",鉼:"鉼",錄:"錄",鍊:"鍊",鎮:"鎭",鏹:"鏹",鐕:"鐕",𨯺:"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門",開:"開",䦕:"䦕",閭:"閭",閷:"閷",𨵷:"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝",阮:"阮",陋:"陋",降:"降",陵:"陵",陸:"陸",陼:"陼",隆:"隆",隣:"隣",䧦:"䧦","⾪":"隶",隷:"隷",隸:"隷",隸:"隷","⾫":"隹",雃:"雃",離:"離",難:"難",難:"難","⾬":"雨",零:"零",雷:"雷",霣:"霣",𩅅:"𩅅",露:"露",靈:"靈","⾭":"靑","⻘":"青",靖:"靖",靖:"靖",𩇟:"𩇟","⾮":"非","⾯":"面",𩈚:"𩈚","⾰":"革",䩮:"䩮",䩶:"䩶","⾱":"韋",韛:"韛",韠:"韠","⻙":"韦","⾲":"韭",𩐊:"𩐊","⾳":"音",響:"響",響:"響","⾴":"頁",䪲:"䪲",頋:"頋",頋:"頋",頋:"頋",領:"領",頩:"頩",𩒖:"𩒖",頻:"頻",頻:"頻",類:"類","⻚":"页","⾵":"風",𩖶:"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠",飢:"飢",飯:"飯",飼:"飼",䬳:"䬳",館:"館",餩:"餩","⻠":"饣","⾸":"首","⾹":"香",馧:"馧","⾺":"馬",駂:"駂",駱:"駱",駾:"駾",驪:"驪","⻢":"马","⾻":"骨",䯎:"䯎","⾼":"高","⾽":"髟",𩬰:"𩬰",鬒:"鬒",鬒:"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚",魯:"魯",鱀:"鱀",鱗:"鱗","⻥":"鱼","⿃":"鳥",鳽:"鳽",䳎:"䳎",鵧:"鵧",䳭:"䳭",𪃎:"𪃎",鶴:"鶴",𪄅:"𪄅",䳸:"䳸",鷺:"鷺",𪈎:"𪈎",鸞:"鸞",鹃:"鹂","⿄":"鹵",鹿:"鹿","⿅":"鹿",𪊑:"𪊑",麗:"麗",麟:"麟","⿆":"麥","⻨":"麦",麻:"麻","⿇":"麻",𪎒:"𪎒","⿈":"黃","⻩":"黄","⿉":"黍",黎:"黎",䵖:"䵖","⿊":"黑",黒:"黑",墨:"墨",黹:"黹","⿋":"黹","⿌":"黽",鼅:"鼅",黾:"黾","⿍":"鼎",鼏:"鼏","⿎":"鼓",鼖:"鼖","⿏":"鼠",鼻:"鼻","⿐":"鼻",齃:"齃","⿑":"齊","⻬":"齐","⿒":"齒",𪘀:"𪘀","⻮":"齿",龍:"龍","⿓":"龍",龎:"龎","⻰":"龙",龜:"龜",龜:"龜",龜:"龜","⿔":"龜","⻳":"龟","⿕":"龠"};var rk,fF;function qge(){if(fF)return rk;fF=1;var e=Vge;var t=RegExp(Object.keys(e).map(function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}).join("|"),"g");function n(t){return e[t]}return rk=function(e){return e.replace(t,n)}}var Gge=qge();const Kge=ac(Gge);var sk,hF,pF,ok,mF,gF,c0={exports:{}},ik={};function zge(){if(hF)return sk;function e(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return hF=1,sk=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},e.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},e.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],o=i.message,s=(e[o]||0)+1;e[o]=s,s>=n&&(t=i,n=s)}return t},sk}function Wge(){return pF||(pF=1,e=ik,t=zge(),e.operation=function(n){var r=e.timeouts(n);return new t(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},e.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<t.retries;i++)r.push(this.createTimeout(i,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(i,t)),r.sort(function(e,t){return e-t}),r},e.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return r=Math.min(r,t.maxTimeout)},e.wrap=function(t,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],t)"function"==typeof t[i]&&r.push(i);for(var o=0;o<r.length;o++){var s=r[o],a=t[s];t[s]=function(r){var i=e.operation(n),o=Array.prototype.slice.call(arguments,1),s=o.pop();o.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))}),i.attempt(function(){r.apply(t,o)})}.bind(t,a),t[s].options=n}}),ik;var e,t}function Yge(){return mF||(mF=1,ok=Wge()),ok}function Xge(){if(gF)return c0.exports;gF=1;const e=Yge(),t=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const r=(r,i)=>new Promise((o,s)=>{i={onFailedAttempt:()=>{},retries:10,...i};const a=e.operation(i);a.attempt(async e=>{try{o(await r(e))}catch(r){if(!(r instanceof Error))return void s(new TypeError(`Non-error was thrown: "${r}". You should only throw errors.`));if(r instanceof n)a.stop(),s(r.originalError);else if(r instanceof TypeError&&!(e=>t.includes(e))(r.message))a.stop(),s(r);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(r,e,i);try{await i.onFailedAttempt(r)}catch(e){return void s(e)}a.retry(r)||s(a.mainError())}}})});return c0.exports=r,c0.exports.default=r,c0.exports.AbortError=n,c0.exports}var EX=Xge();const wX=ac(EX);let e_=class{constructor(e,t){if(this.stable=e,this.unstable=t,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){var e=[this.name],t=this.altName;return t&&e.push(t),e}matches(e){return this.name===e||this.altName===e}findIn(e){var t=void 0;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}includedIn(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}};class M3 extends e_{constructor(){super(...arguments),P(this,"preferUnstable",!1)}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}class xr extends e_{constructor(e,t){if(super(e,t),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}var zg=function(e){return e.Self="m.self",e.Pin="m.pin",e}({}),t_=new xr("m.asset","org.matrix.msc3488.asset"),Af=new xr("m.ts","org.matrix.msc3488.ts"),n_=new xr("m.location","org.matrix.msc3488.location"),os=function(e){return e.Read="m.read",e.FullyRead="m.fully_read",e.ReadPrivate="m.read.private",e}({}),r_="main";function vF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function yF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vF(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ak=new Map;function ck(e){return e instanceof String&&(e=e.toString()),ak.has(e)||ak.set(e,e),ak.get(e)}function k5(e,t){var n=t??new URLSearchParams,r=function(e){null!=o&&(Array.isArray(o)?o.forEach(t=>{n.append(e,String(t))}):n.append(e,String(o)))};for(var[i,o]of Object.entries(e))r(i);return n}function bF(e,t,n){var r=yF(yF({},n),{},{[t]:n[e]});return delete r[e],r}function Ae(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];null!=r&&(e=e.replace(n,encodeURIComponent(r)))}return e}function qw(e,t,n){var r;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return e.splice(r,1),!0}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return e.splice(r,1),!0;return!1}function CX(e,t){for(var n of t)if(!e.hasOwnProperty(n))throw new Error("Missing required key: "+n)}function i_(e){return JSON.parse(JSON.stringify(e))}function df(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("number"==typeof e&&isNaN(e)&&isNaN(t))return!0;if(null===e||null===t)return e===t;if(!(e instanceof Object)||e.constructor!==t.constructor||e.prototype!==t.prototype)return!1;if(e instanceof RegExp||e instanceof Date)return e.toString()===t.toString();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!df(e[n],t[n]))return!1}else{for(var r in t)if(t.hasOwnProperty(r)!==e.hasOwnProperty(r))return!1;for(var i in e)if(t.hasOwnProperty(i)!==e.hasOwnProperty(i)||!df(e[i],t[i]))return!1}return!0}function x5(e){if("object"!=typeof e||null==e||Array.isArray(e))return e;var t=[];for(var[n,r]of Object.entries(e))t.push([n,x5(r)]);return t.sort((e,t)=>ME(e[0],t[0])),t}function _F(e){return"number"==typeof e&&isFinite(e)}function Qd(e){return"string"==typeof e?Kge(e.normalize("NFD").replace(Qge,"")):""}function Gw(e){return"string"==typeof e?e.replace(/[\u202d-\u202e]/g,""):""}function Jge(e){return Qd(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}var Qge=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function TX(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function RX(e){return TX(e).replace(/\\\*/g,".*").replace(/\?/g,".")}function lk(e){return null!=e&&e.endsWith("/")?e.slice(0,-1):e}function mp(e,t){return new Promise(n=>{setTimeout(n,e,t)})}function Eot(e,t,n){return A5.apply(this,arguments)}function A5(){return(A5=B(function*(e,t,n){var r=Date.now();try{return yield n()}finally{var i=Date.now();e.debug("[Perf]: ".concat(t," took ").concat(i-r,"ms"))}})).apply(this,arguments)}function Zge(e,t,n){var r=Date.now();try{return n()}finally{var i=Date.now();e.debug("[Perf]: ".concat(t," took ").concat(i-r,"ms"))}}function IX(e){return null==e}function tg(e,t){return L5.apply(this,arguments)}function L5(){return(L5=B(function*(e,t){for(var n of e)yield t(yield n)})).apply(this,arguments)}function Em(e){return Promise.resolve(e())}function eve(e){return wX(t=>e(t),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})}var ff=(()=>{for(var e="",t=32;t<=126;t++)e+=String.fromCharCode(t);return e})();function SF(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ff;return e.padEnd(t,n[0])}function eb(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ff,r=BigInt(n.length);if(e<=r)return null!==(t=n[Number(e)-1])&&void 0!==t?t:"";var i=e/r,o=Number(e%r)-1;return o<0&&(i-=BigInt(Math.abs(o)),o=Number(r)-1),eb(i,n)+n[o]}function Kw(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ff,n=BigInt(t.length),r=BigInt(0),i=e.length-1,o=BigInt(0);i>=0;i--,o++){var s=e.charCodeAt(i)-t.charCodeAt(0);r+=BigInt(1+s)*n**o}return r}function tve(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ff,r=Math.max(e.length,t.length),i=Kw(SF(e,r,n),n),o=Kw(SF(t,r,n),n),s=(i+o)/BigInt(2);return s===i||s==o?eb(s,n)+n[0]:eb(s,n)}function l0(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ff;return eb(Kw(e,t)+BigInt(1),t)}function EF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ff;return eb(Kw(e,t)-BigInt(1),t)}function ME(e,t){return e<t?-1:e>t?1:0}function kX(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var[r,i]of Object.entries(t))e[r]instanceof Object&&i?kX(e[r],i):null==i&&n||zw(e,r,i);return e}function wF(e){var t;return null!==(t=Af.findIn(e.getContent()))&&void 0!==t?t:-1}function nve(e,t){return wF(t)-wF(e)}function CP(e){return[os.Read,os.ReadPrivate].includes(e)}function CF(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;if(e.size!==t.size)return!1;for(var[r,i]of e){var o=t.get(r);if(void 0===o||!n(i,o))return!1}return!0}function xX(e){return e instanceof Map?xh(e):Array.isArray(e)?e.map(e=>xX(e)):e}function xh(e){var t=new Map;for(var[n,r]of e)t.set(n,xX(r));return Object.fromEntries(t.entries())}function gy(e){return"__proto__"===e||"prototype"===e||"constructor"===e}function zw(e,t,n){if(gy(t))throw new Error("Trying to modify prototype or constructor");e[t]=n}function Ha(e){return!(gy(e.room_id)||gy(e.sender)||gy(e.event_id))}class pu extends Map{constructor(e){super(),this.createDefault=e}getOrCreate(e){return this.has(e)||this.set(e,this.createDefault()),this.get(e)}}var P5="migrationState",Wg=function(e){return e[e.NOT_STARTED=0]="NOT_STARTED",e[e.INITIAL_DATA_MIGRATED=1]="INITIAL_DATA_MIGRATED",e[e.OLM_SESSIONS_MIGRATED=2]="OLM_SESSIONS_MIGRATED",e[e.MEGOLM_SESSIONS_MIGRATED=3]="MEGOLM_SESSIONS_MIGRATED",e[e.ROOM_SETTINGS_MIGRATED=4]="ROOM_SETTINGS_MIGRATED",e[e.INITIAL_OWN_KEY_QUERY_DONE=5]="INITIAL_OWN_KEY_QUERY_DONE",e}({}),Yg=50;function TF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function RF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TF(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u2(e,t){return encodeURIComponent(e)+"/"+encodeURIComponent(t)}function rve(e){var t=e.split("/");return{senderKey:decodeURIComponent(t[0]),sessionId:decodeURIComponent(t[1])}}class D3{constructor(){P(this,"migrationState",Wg.NOT_STARTED),P(this,"account",null),P(this,"crossSigningKeys",null),P(this,"privateKeys",{}),P(this,"sessions",{}),P(this,"inboundGroupSessions",{}),P(this,"inboundGroupSessionsWithheld",{}),P(this,"rooms",{}),P(this,"sessionsNeedingBackup",{})}containsData(){var e=this;return B(function*(){return null!==e.account})()}startup(){var e=this;return B(function*(){return e})()}deleteAllData(){return Promise.resolve()}getMigrationState(){var e=this;return B(function*(){return e.migrationState})()}setMigrationState(e){var t=this;return B(function*(){t.migrationState=e})()}getAccount(e,t){t(this.account)}storeAccount(e,t){this.account=t}getCrossSigningKeys(e,t){t(this.crossSigningKeys)}getSecretStorePrivateKey(e,t,n){t(this.privateKeys[n]||null)}storeSecretStorePrivateKey(e,t,n){this.privateKeys[t]=n}countEndToEndSessions(e,t){var n=0;for(var r of Object.values(this.sessions))n+=Object.keys(r).length;t(n)}getEndToEndSession(e,t,n,r){r((this.sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,n){n(this.sessions[e]||{})}storeEndToEndSession(e,t,n,r){var i=this.sessions[e];void 0===i&&(i={},this.sessions[e]=i),zw(i,t,n)}getEndToEndSessionsBatch(){var e=this;return B(function*(){var t=[];for(var n of Object.values(e.sessions))for(var r of Object.values(n))if(t.push(r),t.length>=Yg)return t;return 0===t.length?null:t})()}deleteEndToEndSessionsBatch(e){var t=this;return B(function*(){for(var{deviceKey:n,sessionId:r}of e){var i=t.sessions[n]||{};delete i[r],0===Object.keys(i).length&&delete t.sessions[n]}})()}getEndToEndInboundGroupSession(e,t,n,r){var i=u2(e,t);r(this.inboundGroupSessions[i]||null,this.inboundGroupSessionsWithheld[i]||null)}storeEndToEndInboundGroupSession(e,t,n,r){var i=u2(e,t);this.inboundGroupSessions[i]=n}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){return Object.keys(e.inboundGroupSessions).length})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){var t=[];for(var[n,r]of Object.entries(e.inboundGroupSessions))if(t.push(RF(RF({},rve(n)),{},{sessionData:r,needsBackup:n in e.sessionsNeedingBackup})),t.length>=Yg)return t;return 0===t.length?null:t})()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return B(function*(){for(var{senderKey:n,sessionId:r}of e){var i=u2(n,r);delete t.inboundGroupSessions[i]}})()}getEndToEndRooms(e,t){t(this.rooms)}markSessionsNeedingBackup(e){for(var t of e){var n=u2(t.senderKey,t.sessionId);this.sessionsNeedingBackup[n]=!0}return Promise.resolve()}doTxn(e,t,n){return Promise.resolve(n(null))}}var ive=/^(?:(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:\[[\dA-Fa-f:.]{2,45}])|(?:[A-Za-z\d\-.]{1,255}))(?::\d{1,5})?$/;function sve(e){var t=ive.exec(e);return(null==t?void 0:t[0])===e}var ove=/^[\w-]+$/;function ave(e){var t=ove.exec(e);return(null==t?void 0:t[0])===e}function N3(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;if("string"!=typeof t||!t)return"";if(!t.startsWith("mxc://"))return o?t:"";var[l,c,...u]=t.slice(6).split("/");if(u.length>0||!sve(l)||!ave(c))return"";a&&(s=!0);var d,h=!!n||!!r||!!i?"thumbnail":"download";d=a?"/_matrix/client/v1/media/".concat(h):"/_matrix/media/v3/".concat(h);var p=new URL("".concat(d,"/").concat(l,"/").concat(c),e);return n&&p.searchParams.set("width",Math.round(n).toString()),r&&p.searchParams.set("height",Math.round(r).toString()),i&&p.searchParams.set("method",i),"boolean"==typeof s&&p.searchParams.set("allow_redirect",JSON.stringify(s)),p.href}var IF,DE={exports:{}},cve=DE.exports;function lve(){return IF||(IF=1,t=cve,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return c??a??s},d.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=f(o.getLevel())),l.call(d),o===d)for(var e in i)i[e].rebuild()},s=f(o?o.getLevel():"WARN");var m=p();null!=m&&(c=f(m)),l.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},(e=DE).exports?e.exports=n():t.log=n()),DE.exports;var e,t,n}var uve=lve();const O5=ac(uve);var dve="matrix";function AX(e){var t=dve+(void 0===e?"":"-".concat(e)),n=O5.getLogger(t);return void 0===n.getChild&&(n.prefix=e,n.getChild=t=>{var r=AX((e??"")+t);return r.methodFactory=n.methodFactory,r.rebuild(),r},n.setLevel(O5.levels.DEBUG,!1)),n}O5.methodFactory=function(e,t,n){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.prefix&&n.unshift(this.prefix),"error"===e||"warn"===e||"trace"===e||"info"===e||"debug"===e?console[e](...n):console.log(...n)}};var M=AX();class wot{constructor(e,t){this.parent=e,P(this,"name",void 0),this.name=t+":"}trace(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.trace(this.name,...t)}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.debug(this.name,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.info(this.name,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.warn(this.name,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.error(this.name,...t)}}class TP{constructor(e){this.debugInstance=e}trace(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.debugWithPrefix("[TRACE]",...t)}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.debugWithPrefix("[DEBUG]",...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.debugWithPrefix("[INFO]",...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.debugWithPrefix("[WARN]",...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.debugWithPrefix("[ERROR]",...t)}getChild(e){return new TP(this.debugInstance.extend(e))}debugWithPrefix(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(0===r.length)t="";else if(r[0]instanceof Error){var o=r.shift();t=o.stack||o.message}else t="string"==typeof r[0]?r.shift():"%O";this.debugInstance(e+" "+t,...r)}}var kF,d2={exports:{}};function fve(){if(kF)return d2.exports;kF=1;var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}d2.exports=i,d2.exports.once=function(e,t){return new Promise(function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}f(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&f(e,"error",t,n)}(e,i,{once:!0})})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,l;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),l=o[t]),void 0===l)l=o[t]=n,++e._eventsCount;else if("function"==typeof l?l=o[t]=r?[n,l]:[l,n]:r?l.unshift(n):l.push(n),(i=a(e))>0&&l.length>i&&!l.warned){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=l.length,function(e){console&&console.warn&&console.warn(e)}(c)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=c.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function f(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)})}}return Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return a(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var c=l.length,u=p(l,c);for(r=0;r<c;++r)n(u[r],this,t)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){return s(t),this.on(e,u(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,u(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return d(this,e,!0)},i.prototype.rawListeners=function(e){return d(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},d2.exports}var U3=fve();const LX=ac(U3);var PX=function(e){return e.NewListener="newListener",e.RemoveListener="removeListener",e.Error="error",e}({});class Pn extends U3.EventEmitter{addListener(e,t){return super.addListener(e,t)}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return super.emit(e,...n)}emitPromised(e){var t=arguments,n=this;return B(function*(){for(var r=t.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=t[o];var s=n.listeners(e);return Promise.allSettled(s.map(e=>e(...i))).then(()=>s.length>0)})()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,t){return super.off(e,t)}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeAllListeners(e){return void 0===e?super.removeAllListeners():super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}rawListeners(e){return super.rawListeners(e)}}var ee=function(e){return e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomPredecessor="org.matrix.msc3946.room_predecessor",e.PolicyRuleUser="m.policy.rule.user",e.PolicyRuleRoom="m.policy.rule.room",e.PolicyRuleServer="m.policy.rule.server",e.SpaceChild="m.space.child",e.SpaceParent="m.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",e.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",e.CallReplaces="m.call.replaces",e.CallAssertedIdentity="m.call.asserted_identity",e.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",e.CallEncryptionKeysPrefix="io.element.call.encryption_keys",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.KeyVerificationDone="m.key.verification.done",e.KeyVerificationKey="m.key.verification.key",e.KeyVerificationAccept="m.key.verification.accept",e.KeyVerificationReady="m.key.verification.ready",e.RoomMessageFeedback="m.room.message.feedback",e.Reaction="m.reaction",e.PollStart="org.matrix.msc3381.poll.start",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.SpaceOrder="org.matrix.msc3230.space_order",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy",e.SecretRequest="m.secret.request",e.SecretSend="m.secret.send",e.GroupCallPrefix="org.matrix.msc3401.call",e.GroupCallMemberPrefix="org.matrix.msc3401.call.member",e.CallNotify="org.matrix.msc4075.call.notify",e.RTCNotification="org.matrix.msc4075.rtc.notification",e}({}),kn=function(e){return e.Annotation="m.annotation",e.Replace="m.replace",e.Reference="m.reference",e.Thread="m.thread",e.unstable_RTCNotificationParent="org.matrix.msc4075.rtc.notification.parent",e}({}),cl=function(e){return e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video",e.KeyVerificationRequest="m.key.verification.request",e}({}),Ww="type",gg=function(e){return e.Space="m.space",e.UnstableCall="org.matrix.msc3417.call",e.ElementVideo="io.element.video",e}({}),j3="org.matrix.msgid",M5=new xr("m.room.purpose","org.matrix.msc3088.purpose"),D5=new xr("m.enabled","org.matrix.msc3088.enabled"),N5=new xr("m.data_tree","org.matrix.msc3089.data_tree"),OX=new xr("m.leaf","org.matrix.msc3089.leaf"),tu=new xr("m.branch","org.matrix.msc3089.branch"),MX=new xr("m.room.marker","org.matrix.msc2716.marker"),U5=new xr("with_rel_types","org.matrix.msc3912.with_relations"),DX=new xr("io.element.functional_members","io.element.functional_members"),Ah=new xr("m.visibility","org.matrix.msc3531.visibility"),j5=new xr("enabled","org.matrix.msc3881.enabled"),hve=new xr("device_id","org.matrix.msc3881.device_id"),NX=new xr("m.local_notification_settings","org.matrix.msc3890.local_notification_settings"),Yw=new xr("thread_id","org.matrix.msc4023.thread_id"),UX=new e_("membership","io.element.msc4115.membership"),Ve=function(e){return e.Ban="ban",e.Invite="invite",e.Join="join",e.Knock="knock",e.Leave="leave",e}({}),Ns=function(e){return e.Membership="RoomMember.membership",e.Name="RoomMember.name",e.PowerLevel="RoomMember.powerLevel",e.Typing="RoomMember.typing",e}({});class tb extends Pn{constructor(e,t){super(),this.roomId=e,this.userId=t,P(this,"_isOutOfBand",!1),P(this,"modified",-1),P(this,"requestedProfileInfo",!1),P(this,"typing",!1),P(this,"name",void 0),P(this,"rawDisplayName",void 0),P(this,"powerLevel",0),P(this,"user",void 0),P(this,"membership",void 0),P(this,"disambiguate",!1),P(this,"events",{}),this.name=t,this.rawDisplayName=t,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,t){var n,r,i=null!==(n=e.getDirectionalContent().displayname)&&void 0!==n?n:"";if(e.getType()===ee.RoomMember){this._isOutOfBand=!1,this.events.member=e;var o=this.membership;this.membership=e.getDirectionalContent().membership,void 0===this.membership&&M.trace("membership event with membership undefined (forwardLooking: ".concat(e.forwardLooking,")!"),e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=gve(this.userId,i,t);var s=this.name;this.name=vve(this.userId,i,this.disambiguate),this.rawDisplayName=Gw(null!==(r=e.getDirectionalContent().displayname)&&void 0!==r?r:""),(!this.rawDisplayName||!Qd(this.rawDisplayName))&&(this.rawDisplayName=this.userId),o!==this.membership&&(this.updateModifiedTime(),this.emit(Ns.Membership,e,this,o)),s!==this.name&&(this.updateModifiedTime(),this.emit(Ns.Name,e,this,s))}}setPowerLevel(e,t){var n=this.powerLevel;this.powerLevel=e,n!==this.powerLevel&&(this.updateModifiedTime(),this.emit(Ns.PowerLevel,t,this))}setTypingEvent(e){if("m.typing"===e.getType()){var t=this.typing;this.typing=!1;var n=e.getContent().user_ids;Array.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit(Ns.Typing,e,this)))}}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return this.membership===Ve.Leave&&void 0!==this.events.member&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){var e=this.events.member,t=e.getContent(),n=e.getSender();if(t.membership===Ve.Join&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),t.membership===Ve.Invite&&t.is_direct)return n}}getAvatarUrl(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=this.getMxcAvatarUrl();return(a||i)&&N3(e,a,t,n,r,o,void 0,s)||null}getMxcAvatarUrl(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:void 0}}var pve=/@.+:.+/,mve=/[\u200E\u200F\u202A-\u202F]/;function gve(e,t,n){if(!t||t===e||!n)return!1;var r=Qd(t);return!!r&&(!(!pve.test(r)&&!mve.test(t))||!!n.getUserIdsWithDisplayName(t).some(t=>t!==e))}function vve(e,t,n){return t&&t!==e?n?Gw(t)+" ("+e+")":Qd(t)?Gw(t):e:e}var xF,uk={},u0={},d0={};function jX(){if(xF)return d0;function e(e,n){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}}(e))||n){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,s=e},f:function(){try{!a&&null!=r.return&&r.return()}finally{if(l)throw s}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}xF=1,Object.defineProperty(d0,"__esModule",{value:!0}),d0.NamespacedMap=void 0;var r=function(){function t(n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"internalMap",new Map),n){var r,i=e(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;this.set(o[0],o[1])}}catch(e){i.e(e)}finally{i.f()}}}return n(t,[{key:"get",value:function(e){return e.name&&this.internalMap.has(e.name)?this.internalMap.get(e.name):e.altName&&this.internalMap.has(e.altName)?this.internalMap.get(e.altName):null}},{key:"set",value:function(e,t){e.name&&this.internalMap.set(e.name,t),e.altName&&this.internalMap.set(e.altName,t)}},{key:"has",value:function(e){return!!this.get(e)}},{key:"delete",value:function(e){e.name&&this.internalMap.delete(e.name),e.altName&&this.internalMap.delete(e.altName)}},{key:"hasNamespaced",value:function(e){return this.internalMap.has(e)}},{key:"getNamespaced",value:function(e){return this.internalMap.get(e)}}]),t}();return d0.NamespacedMap=r,d0}var AF,f0={};function Lv(){if(AF)return f0;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){var n=i();return function(){var r,i=s(t);if(n){var o=s(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,r)}}function n(e){var t="function"==typeof Map?new Map:void 0;return n=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return r(e,arguments,s(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,e)},n(e)}function r(e,t,n){return(r=i()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function i(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}AF=1,Object.defineProperty(f0,"__esModule",{value:!0}),f0.InvalidEventError=void 0;var a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(r,e);var n=t(r);function r(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),n.call(this,e)}return function(e){return Object.defineProperty(e,"prototype",{writable:!1}),e}(r)}(n(Error));return f0.InvalidEventError=a,f0}var LF,wm={},h0={},p0={};function s_(){if(LF)return p0;function e(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}LF=1,Object.defineProperty(p0,"__esModule",{value:!0}),p0.ExtensibleEvent=void 0;var t=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.wireFormat=e}return e(t,[{key:"wireContent",get:function(){return this.wireFormat.content}}]),t}();return p0.ExtensibleEvent=t,p0}var PF,m0={};function FX(){if(PF)return m0;function e(e){return null!=e}return PF=1,Object.defineProperty(m0,"__esModule",{value:!0}),m0.isOptionalAString=function(t){return e(t)&&"string"==typeof t},m0.isProvided=e,m0}var OF,MF,oo={},ah={};function Pv(){if(OF)return ah;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,n){return(t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,n)}function n(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var i,o=r(t);if(n){var s=r(this).constructor;i=Reflect.construct(o,arguments,s)}else i=o.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,i)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}OF=1,Object.defineProperty(ah,"__esModule",{value:!0}),ah.UnstableValue=ah.NamespacedValue=void 0;var s=function(){function e(t,n){if(i(this,e),this.stable=t,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return o(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(e){return!!this.name&&this.name===e||!!this.altName&&this.altName===e}},{key:"findIn",value:function(e){var t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();ah.NamespacedValue=s;var a=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&t(e,n)}(s,e);var r=n(s);function s(e,t){var n;if(i(this,s),!(n=r.call(this,e,t)).unstable)throw new Error("Unstable value must be supplied");return n}return o(s,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),s}(s);return ah.UnstableValue=a,ah}function ll(){if(MF)return oo;MF=1,Object.defineProperty(oo,"__esModule",{value:!0}),oo.M_TEXT=oo.M_NOTICE=oo.M_MESSAGE=oo.M_HTML=oo.M_EMOTE=void 0;var e=Pv(),t=new e.UnstableValue("m.message","org.matrix.msc1767.message");oo.M_MESSAGE=t;var n=new e.UnstableValue("m.text","org.matrix.msc1767.text");oo.M_TEXT=n;var r=new e.UnstableValue("m.html","org.matrix.msc1767.html");oo.M_HTML=r;var i=new e.UnstableValue("m.emote","org.matrix.msc1767.emote");oo.M_EMOTE=i;var o=new e.UnstableValue("m.notice","org.matrix.msc1767.notice");return oo.M_NOTICE=o,oo}var DF,NF,f2={};function gp(){if(DF)return f2;return DF=1,Object.defineProperty(f2,"__esModule",{value:!0}),f2.isEventTypeSame=function(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var n=t,r=e;return n.matches(r.name)||n.matches(r.altName)},f2}function vp(){if(NF)return h0;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}NF=1,Object.defineProperty(h0,"__esModule",{value:!0}),h0.MessageEvent=void 0;var t=s_(),n=FX(),r=Lv(),i=ll(),o=gp();function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){p(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,i=h(t);if(n){var o=h(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return d(t)}(this,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(s,e);var t=u(s);function s(e){var o;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,s),p(d(o=t.call(this,e)),"text",void 0),p(d(o),"html",void 0),p(d(o),"renderings",void 0);var a=i.M_MESSAGE.findIn(o.wireContent),l=i.M_TEXT.findIn(o.wireContent),c=i.M_HTML.findIn(o.wireContent);if((0,n.isProvided)(a)){if(!Array.isArray(a))throw new r.InvalidEventError("m.message contents must be an array");var u=a.find(function(e){return!(0,n.isProvided)(e.mimetype)||"text/plain"===e.mimetype}),h=a.find(function(e){return"text/html"===e.mimetype});if(!u)throw new r.InvalidEventError("m.message is missing a plain text representation");o.text=u.body,o.html=null==h?void 0:h.body,o.renderings=a}else{if(!(0,n.isOptionalAString)(l))throw new r.InvalidEventError("Missing textual representation for event");o.text=l,o.html=c,o.renderings=[{body:l,mimetype:"text/plain"}],o.html&&o.renderings.push({body:o.html,mimetype:"text/html"})}return o}return function(e,t,n){t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(s,[{key:"isEmote",get:function(){return i.M_EMOTE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return i.M_NOTICE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(e){return(0,o.isEventTypeSame)(e,i.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var e=p({},i.M_MESSAGE.name,this.renderings);if(1===this.renderings.length){var t=this.renderings[0].mimetype;(void 0===t||"text/plain"===t)&&(e=p({},i.M_TEXT.name,this.renderings[0].body))}return e}},{key:"serialize",value:function(){var e;return{type:"m.room.message",content:a(a({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:null!==(e=this.html)&&void 0!==e?e:void 0})}}}],[{key:"from",value:function(e,t){var n;return new s({type:i.M_MESSAGE.name,content:(n={},p(n,i.M_TEXT.name,e),p(n,i.M_HTML.name,t),n)})}}]),s}(t.ExtensibleEvent);return h0.MessageEvent=f,h0}var UF,g0={};function RP(){if(UF)return g0;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}UF=1,Object.defineProperty(g0,"__esModule",{value:!0}),g0.NoticeEvent=void 0;var t=vp(),n=ll(),r=gp();function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(){return s=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},s.apply(this,arguments)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,i=c(t);if(n){var o=c(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t=l(u);function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),t.call(this,e)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(u,[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,r.isEventTypeSame)(e,n.M_NOTICE)||s(c(u.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=s(c(u.prototype),"serialize",this).call(this);return e.content.msgtype="m.notice",e}}],[{key:"from",value:function(e,t){var r;return new u({type:n.M_NOTICE.name,content:(r={},i(r,n.M_TEXT.name,e),i(r,n.M_HTML.name,t),r)})}}]),u}(t.MessageEvent);return g0.NoticeEvent=u,g0}var jF,FF,v0={};function IP(){if(jF)return v0;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}jF=1,Object.defineProperty(v0,"__esModule",{value:!0}),v0.EmoteEvent=void 0;var t=vp(),n=ll(),r=gp();function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(){return s=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},s.apply(this,arguments)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,i=c(t);if(n){var o=c(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t=l(u);function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),t.call(this,e)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(u,[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,r.isEventTypeSame)(e,n.M_EMOTE)||s(c(u.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=s(c(u.prototype),"serialize",this).call(this);return e.content.msgtype="m.emote",e}}],[{key:"from",value:function(e,t){var r;return new u({type:n.M_EMOTE.name,content:(r={},i(r,n.M_TEXT.name,e),i(r,n.M_HTML.name,t),r)})}}]),u}(t.MessageEvent);return v0.EmoteEvent=u,v0}function $X(){if(FF)return wm;FF=1,Object.defineProperty(wm,"__esModule",{value:!0}),wm.LEGACY_M_ROOM_MESSAGE=void 0,wm.parseMRoomMessage=function(r){var o,l,c;if(i.M_MESSAGE.findIn(r.content)||i.M_TEXT.findIn(r.content))return new e.MessageEvent(r);var u,d=null===(o=r.content)||void 0===o?void 0:o.msgtype,h=null===(l=r.content)||void 0===l?void 0:l.body,p="org.matrix.custom.html"===(null===(c=r.content)||void 0===c?void 0:c.format)?r.content.formatted_body:null;return"m.text"===d?new e.MessageEvent(s(s({},r),{},{content:s(s({},r.content),{},(u={},a(u,i.M_TEXT.name,h),a(u,i.M_HTML.name,p),u))})):"m.notice"===d?new t.NoticeEvent(s(s({},r),{},{content:s(s({},r.content),{},(f={},a(f,i.M_TEXT.name,h),a(f,i.M_HTML.name,p),f))})):"m.emote"===d?new n.EmoteEvent(s(s({},r),{},{content:s(s({},r.content),{},(m={},a(m,i.M_TEXT.name,h),a(m,i.M_HTML.name,p),m))})):null;var f,m};var e=vp(),t=RP(),n=IP(),r=Pv(),i=ll();function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=new r.NamespacedValue("m.room.message");return wm.LEGACY_M_ROOM_MESSAGE=l,wm}var $F,h2={};function BX(){if($F)return h2;$F=1,Object.defineProperty(h2,"__esModule",{value:!0}),h2.parseMMessage=function(i){return t.M_EMOTE.matches(i.type)?new n.EmoteEvent(i):t.M_NOTICE.matches(i.type)?new r.NoticeEvent(i):new e.MessageEvent(i)};var e=vp(),t=ll(),n=IP(),r=RP();return h2}var BF,ao={};function Ov(){if(BF)return ao;BF=1,Object.defineProperty(ao,"__esModule",{value:!0}),ao.M_POLL_START=ao.M_POLL_RESPONSE=ao.M_POLL_KIND_UNDISCLOSED=ao.M_POLL_KIND_DISCLOSED=ao.M_POLL_END=void 0;var e=Pv(),t=new e.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");ao.M_POLL_KIND_DISCLOSED=t;var n=new e.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");ao.M_POLL_KIND_UNDISCLOSED=n;var r=new e.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");ao.M_POLL_START=r;var i=new e.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");ao.M_POLL_RESPONSE=i;var o=new e.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");return ao.M_POLL_END=o,ao}var HF,p2={},ch={};function HX(){if(HF)return ch;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}HF=1,Object.defineProperty(ch,"__esModule",{value:!0}),ch.PollStartEvent=ch.PollAnswerSubevent=void 0;var t=Ov(),n=vp(),r=ll(),i=Lv(),o=Pv(),s=gp(),a=s_();function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){w(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,i=b(t);if(n){var o=b(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return y(t)}(this,r)}}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(e){m(n,e);var t=g(n);function n(e){var r;h(this,n),w(y(r=t.call(this,e)),"id",void 0);var o=e.content.id;if(!o||"string"!=typeof o)throw new i.InvalidEventError("Answer ID must be a non-empty string");return r.id=o,r}return f(n,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:d({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(e,t){return new n({type:"org.matrix.sdk.poll.answer",content:w({id:e},r.M_TEXT.name,t)})}}]),n}(n.MessageEvent);ch.PollAnswerSubevent=_;var S=function(e){m(c,e);var a=g(c);function c(e){var r;h(this,c),w(y(r=a.call(this,e)),"question",void 0),w(y(r),"kind",void 0),w(y(r),"rawKind",void 0),w(y(r),"maxSelections",void 0),w(y(r),"answers",void 0);var o=t.M_POLL_START.findIn(r.wireContent);if(!o.question)throw new i.InvalidEventError("A question is required");if(r.question=new n.MessageEvent({type:"org.matrix.sdk.poll.question",content:o.question}),r.rawKind=o.kind,t.M_POLL_KIND_DISCLOSED.matches(r.rawKind)?r.kind=t.M_POLL_KIND_DISCLOSED:r.kind=t.M_POLL_KIND_UNDISCLOSED,r.maxSelections=Number.isFinite(o.max_selections)&&o.max_selections>0?o.max_selections:1,!Array.isArray(o.answers))throw new i.InvalidEventError("Poll answers must be an array");var s=o.answers.slice(0,20).map(function(e){return new _({type:"org.matrix.sdk.poll.answer",content:e})});if(s.length<=0)throw new i.InvalidEventError("No answers available");return r.answers=s,r}return f(c,[{key:"isEquivalentTo",value:function(e){return(0,s.isEventTypeSame)(e,t.M_POLL_START)}},{key:"serialize",value:function(){var e;return{type:t.M_POLL_START.name,content:(e={},w(e,t.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map(function(e){return e.serialize().content})}),w(e,r.M_TEXT.name,"".concat(this.question.text,"\n").concat(this.answers.map(function(e,t){return"".concat(t+1,". ").concat(e.text)}).join("\n"))),e)}}}],[{key:"from",value:function(e,n,i){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new c({type:t.M_POLL_START.name,content:(s={},w(s,r.M_TEXT.name,e),w(s,t.M_POLL_START.name,{question:w({},r.M_TEXT.name,e),kind:i instanceof o.NamespacedValue?i.name:i,max_selections:a,answers:n.map(function(e){return w({id:l(Array(16)).map(function(){return E.charAt(Math.floor(Math.random()*E.length))}).join("")},r.M_TEXT.name,e)})}),s)})}}]),c}(a.ExtensibleEvent);ch.PollStartEvent=S;var E="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return ch}var VF,qF,y0={},b0={};function kP(){if(VF)return b0;VF=1,Object.defineProperty(b0,"__esModule",{value:!0}),b0.REFERENCE_RELATION=void 0;var e=new(Pv().NamespacedValue)("m.reference");return b0.REFERENCE_RELATION=e,b0}function VX(){if(qF)return y0;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}qF=1,Object.defineProperty(y0,"__esModule",{value:!0}),y0.PollResponseEvent=void 0;var t=s_(),n=Ov(),r=Lv(),i=kP(),o=gp();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,i=u(t);if(n){var o=u(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}(this,r)}}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t=l(u);function u(e){var n;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,u),d(c(n=t.call(this,e)),"internalAnswerIds",void 0),d(c(n),"internalSpoiled",void 0),d(c(n),"pollEventId",void 0);var o=n.wireContent["m.relates_to"];if(!i.REFERENCE_RELATION.matches(null==o?void 0:o.rel_type)||"string"!=typeof(null==o?void 0:o.event_id))throw new r.InvalidEventError("Relationship must be a reference to an event");return n.pollEventId=o.event_id,n.validateAgainst(null),n}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(u,[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(e){var t=n.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(null==t?void 0:t.answers))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);var r=t.answers;if(r.some(function(e){return"string"!=typeof e})||0===r.length)return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);if(e){if(r.some(function(t){return!e.answers.some(function(e){return e.id===t})}))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);r=r.slice(0,e.maxSelections)}this.internalAnswerIds=r,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(e){return(0,o.isEventTypeSame)(e,n.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:n.M_POLL_RESPONSE.name,content:d({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:this.pollEventId}},n.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}],[{key:"from",value:function(e,t){return new u({type:n.M_POLL_RESPONSE.name,content:d({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:t}},n.M_POLL_RESPONSE.name,{answers:e})})}}]),u}(t.ExtensibleEvent);return y0.PollResponseEvent=h,y0}var GF,KF,zF,_0={};function qX(){if(GF)return _0;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}GF=1,Object.defineProperty(_0,"__esModule",{value:!0}),_0.PollEndEvent=void 0;var t=Ov(),n=Lv(),r=kP(),i=vp(),o=ll(),s=gp();function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){f(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,i=p(t);if(n){var o=p(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}(this,r)}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(p,e);var a=d(p);function p(e){var t;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,p),f(h(t=a.call(this,e)),"pollEventId",void 0),f(h(t),"closingMessage",void 0);var o=t.wireContent["m.relates_to"];if(!r.REFERENCE_RELATION.matches(null==o?void 0:o.rel_type)||"string"!=typeof(null==o?void 0:o.event_id))throw new n.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=o.event_id,t.closingMessage=new i.MessageEvent(t.wireFormat),t}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(p,[{key:"isEquivalentTo",value:function(e){return(0,s.isEventTypeSame)(e,t.M_POLL_END)}},{key:"serialize",value:function(){return{type:t.M_POLL_END.name,content:l(f({"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:this.pollEventId}},t.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}],[{key:"from",value:function(e,n){var i;return new p({type:t.M_POLL_END.name,content:(i={"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:e}},f(i,t.M_POLL_END.name,{}),f(i,o.M_TEXT.name,n),i)})}}]),p}(s_().ExtensibleEvent);return _0.PollEndEvent=m,_0}function GX(){if(KF)return p2;KF=1,Object.defineProperty(p2,"__esModule",{value:!0}),p2.parseMPoll=function(i){return e.M_POLL_START.matches(i.type)?new t.PollStartEvent(i):e.M_POLL_RESPONSE.matches(i.type)?new n.PollResponseEvent(i):e.M_POLL_END.matches(i.type)?new r.PollEndEvent(i):null};var e=Ov(),t=HX(),n=VX(),r=qX();return p2}function yve(){if(zF)return u0;zF=1,Object.defineProperty(u0,"__esModule",{value:!0}),u0.ExtensibleEvents=void 0;var e=jX(),t=Lv(),n=$X(),r=BX(),i=ll(),o=Ov(),s=GX();function a(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{!s&&null!=n.return&&n.return()}finally{if(a)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){function l(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,l),u(this,"interpreters",new e.NamespacedMap([[n.LEGACY_M_ROOM_MESSAGE,n.parseMRoomMessage],[i.M_MESSAGE,r.parseMMessage],[i.M_EMOTE,r.parseMMessage],[i.M_NOTICE,r.parseMMessage],[o.M_POLL_START,s.parseMPoll],[o.M_POLL_RESPONSE,s.parseMPoll],[o.M_POLL_END,s.parseMPoll]])),u(this,"_unknownInterpretOrder",[i.M_MESSAGE])}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(l,[{key:"unknownInterpretOrder",get:function(){var e;return null!==(e=this._unknownInterpretOrder)&&void 0!==e?e:[]},set:function(e){this._unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){this.interpreters.set(e,t)}},{key:"parse",value:function(e){try{if(this.interpreters.hasNamespaced(e.type))return this.interpreters.getNamespaced(e.type)(e);var n,r=a(this.unknownInterpretOrder);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(this.interpreters.has(i)){var o=this.interpreters.get(i)(e);if(o)return o}}}catch(e){r.e(e)}finally{r.f()}return null}catch(e){if(e instanceof t.InvalidEventError)return null;throw e}}}],[{key:"defaultInstance",get:function(){return l._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return l.defaultInstance.unknownInterpretOrder},set:function(e){l.defaultInstance.unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){l.defaultInstance.registerInterpreter(e,t)}},{key:"parse",value:function(e){return l.defaultInstance.parse(e)}}]),l}();return u0.ExtensibleEvents=d,u(d,"_defaultInstance",new d),u0}var WF,dk={};function bve(){return WF||(WF=1,Object.defineProperty(dk,"__esModule",{value:!0})),dk}var YF,XF,lh={};function _ve(){if(YF)return lh;YF=1,Object.defineProperty(lh,"__esModule",{value:!0}),lh.LegacyMsgType=void 0,lh.isEventLike=function(t,r){var i=t.content;return r===e.Text?n.M_MESSAGE.matches(t.type)||"m.room.message"===t.type&&"m.text"===(null==i?void 0:i.msgtype):r===e.Emote?n.M_EMOTE.matches(t.type)||"m.room.message"===t.type&&"m.emote"===(null==i?void 0:i.msgtype):r===e.Notice&&(n.M_NOTICE.matches(t.type)||"m.room.message"===t.type&&"m.notice"===(null==i?void 0:i.msgtype))};var e,t,n=ll();return lh.LegacyMsgType=e,(t=e||(lh.LegacyMsgType=e={})).Text="m.text",t.Notice="m.notice",t.Emote="m.emote",lh}function Sve(){return XF||(XF=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=yve();Object.keys(t).forEach(function(n){"default"===n||"__esModule"===n||n in e&&e[n]===t[n]||Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[n]}})});var n=bve();Object.keys(n).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===n[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var r=Lv();Object.keys(r).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===r[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})});var i=Pv();Object.keys(i).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===i[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o=jX();Object.keys(o).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===o[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})});var s=FX();Object.keys(s).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===s[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})});var a=_ve();Object.keys(a).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===a[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return a[t]}})});var l=gp();Object.keys(l).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===l[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return l[t]}})});var c=$X();Object.keys(c).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===c[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return c[t]}})});var u=BX();Object.keys(u).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===u[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return u[t]}})});var d=GX();Object.keys(d).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===d[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return d[t]}})});var h=kP();Object.keys(h).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===h[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return h[t]}})});var p=s_();Object.keys(p).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===p[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return p[t]}})});var f=ll();Object.keys(f).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===f[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return f[t]}})});var m=vp();Object.keys(m).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===m[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return m[t]}})});var v=IP();Object.keys(v).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===v[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return v[t]}})});var g=RP();Object.keys(g).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===g[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return g[t]}})});var y=Ov();Object.keys(y).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===y[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return y[t]}})});var b=HX();Object.keys(b).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===b[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return b[t]}})});var w=VX();Object.keys(w).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===w[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return w[t]}})});var _=qX();Object.keys(_).forEach(function(t){"default"===t||"__esModule"===t||t in e&&e[t]===_[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return _[t]}})})}(uk)),uk}var Ys=Sve();const Eve="modulepreload",wve=function(e,t){return new URL(e,t).href},JF={},nb=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};const i=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),s=(null==o?void 0:o.nonce)||(null==o?void 0:o.getAttribute("nonce"));r=e(t.map(e=>{if((e=wve(e,n))in JF)return;JF[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(n)for(let n=i.length-1;n>=0;n--){const r=i[n];if(r.href===e&&(!t||"stylesheet"===r.rel))return}else if(document.querySelector(`link[href="${e}"]${r}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":Eve,t||(o.as="script"),o.crossOrigin="",o.href=e,s&&o.setAttribute("nonce",s),document.head.appendChild(o),t?new Promise((t,n)=>{o.addEventListener("load",t),o.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})};function Cve(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}function Tve(e,t){if(null==e)return{};var n,r,i=Cve(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Oi=function(e){return e.DisplayName="User.displayName",e.AvatarUrl="User.avatarUrl",e.Presence="User.presence",e.CurrentlyActive="User.currentlyActive",e.LastPresenceTs="User.lastPresenceTs",e}({});class mu extends Pn{constructor(e){super(),this.userId=e,P(this,"modified",-1),P(this,"displayName",void 0),P(this,"rawDisplayName",void 0),P(this,"avatarUrl",void 0),P(this,"presenceStatusMsg",void 0),P(this,"presence","offline"),P(this,"lastActiveAgo",0),P(this,"lastPresenceTs",0),P(this,"currentlyActive",!1),P(this,"events",{}),this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}static createUser(e,t){var n=new mu(e);return t.reEmitter.reEmit(n,[Oi.AvatarUrl,Oi.DisplayName,Oi.Presence,Oi.CurrentlyActive,Oi.LastPresenceTs]),n}setPresenceEvent(e){if("m.presence"===e.getType()){var t=null===this.events.presence;this.events.presence=e;var n=[];for(var r of((e.getContent().presence!==this.presence||t)&&n.push(Oi.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push(Oi.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push(Oi.DisplayName),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push(Oi.CurrentlyActive),this.presence=e.getContent().presence,n.push(Oi.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime(),n))this.emit(r,e,this)}}setDisplayName(e){var t=this.displayName;this.displayName=e,e!==t&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){var t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}var gt=function(e){return e.Backward="b",e.Forward="f",e}({});class Me{static setEventMetadata(e,t,n){e.setMetadata(t,n)}constructor(e){var t,n;this.eventTimelineSet=e,P(this,"roomId",void 0),P(this,"name",void 0),P(this,"events",[]),P(this,"baseIndex",0),P(this,"startState",void 0),P(this,"endState",void 0),P(this,"startToken",null),P(this,"endToken",null),P(this,"prevTimeline",null),P(this,"nextTimeline",null),P(this,"paginationRequests",{[gt.Backward]:null,[gt.Forward]:null}),this.roomId=null!==(t=null===(n=e.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null,this.roomId&&(this.startState=new lb(this.roomId),this.endState=new lb(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}initialiseState(e){var t,n,{timelineWasEmpty:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.events.length>0)throw new Error("Cannot initialise state after events are added");null===(t=this.startState)||void 0===t||t.setStateEvents(e,{timelineWasEmpty:r}),null===(n=this.endState)||void 0===n||n.setStateEvents(e,{timelineWasEmpty:r})}forkLive(e){var t=this.getState(e),n=new Me(this.eventTimelineSet);return n.startState=null==t?void 0:t.clone(),n.endState=t,this.endState=null==t?void 0:t.clone(),n}fork(e){var t=this.getState(e),n=new Me(this.eventTimelineSet);return n.startState=null==t?void 0:t.clone(),n.endState=null==t?void 0:t.clone(),n}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==Me.BACKWARDS)return this.startState;if(e==Me.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e===gt.Backward?this.startToken:this.endToken}setPaginationToken(e,t){this.roomId?this.getState(t).paginationToken=e:t===gt.Backward?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==Me.BACKWARDS)return this.prevTimeline;if(e==Me.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==Me.BACKWARDS)this.prevTimeline=e;else{if(t!=Me.FORWARDS)throw new Error("Invalid direction '"+t+"'");this.nextTimeline=e}this.setPaginationToken(null,t)}addEvent(e,t){var{toStartOfTimeline:n,roomState:r,timelineWasEmpty:i,addToState:o}=t;r||(r=n?this.startState:this.endState);var s,a,l=this.getTimelineSet();l.room&&(Me.setEventMetadata(e,r,n),o&&e.isState()&&l.room.getUnfilteredTimelineSet()===l)&&(null===(s=r)||void 0===s||s.setStateEvents([e],{timelineWasEmpty:i}),(!e.sender||e.getType()===ee.RoomMember&&!n)&&Me.setEventMetadata(e,r,n));a=n?0:this.events.length,this.events.splice(a,0,e),n&&this.baseIndex++}insertEvent(e,t,n,r){var i=this.getTimelineSet();i.room&&(Me.setEventMetadata(e,n,!1),r&&e.isState()&&i.room.getUnfilteredTimelineSet()===i&&(n.setStateEvents([e],{}),(!e.sender||e.getType()===ee.RoomMember)&&Me.setEventMetadata(e,n,!1))),this.events.splice(t,0,e)}removeEvent(e){for(var t=this.events.length-1;t>=0;t--){var n=this.events[t];if(n.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,n}return null}toString(){return this.name}}P(Me,"BACKWARDS",gt.Backward),P(Me,"FORWARDS",gt.Forward);var Wm,NE=function(e){return e.Add="Relations.add",e.Remove="Relations.remove",e.Redaction="Relations.redaction",e}({}),Rve=function(e,t){return[t,...arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]].includes(e)};class xP extends Pn{constructor(e,t,n,r){var i,o;super(),i=this,this.relationType=e,this.eventType=t,this.altEventTypes=r,P(this,"relationEventIds",new Set),P(this,"relations",new Set),P(this,"annotationsByKey",{}),P(this,"annotationsBySender",{}),P(this,"sortedAnnotationsByKey",[]),P(this,"targetEvent",null),P(this,"creationEmitted",!1),P(this,"client",void 0),P(this,"onEventStatus",(e,t)=>{e.isSending()?t===ot.CANCELLED&&(e.removeListener(qt.Status,this.onEventStatus),this.removeEvent(e)):e.removeListener(qt.Status,this.onEventStatus)}),P(this,"onBeforeRedaction",(o=B(function*(e){if(i.relations.has(e)){if(i.relations.delete(e),i.relationType===kn.Annotation)i.removeAnnotationFromAggregation(e);else if(i.relationType===kn.Replace&&i.targetEvent&&!i.targetEvent.isState()){var t=yield i.getLastReplacement();i.targetEvent.makeReplaced(t)}e.removeListener(qt.BeforeRedaction,i.onBeforeRedaction),i.emit(NE.Redaction,e)}}),function(e){return o.apply(this,arguments)})),this.client=n instanceof $3?n.client:n}addEvent(e){var t=this;return B(function*(){if(!t.relationEventIds.has(e.getId())){var n=e.getRelation();if(!n)return void M.error("Event must have relation info");var r=n.rel_type,i=e.getType();if(t.relationType!==r||!Rve(i,t.eventType,t.altEventTypes))return void M.error("Event relation info doesn't match this container");if(e.isSending()&&e.on(qt.Status,t.onEventStatus),t.relations.add(e),t.relationEventIds.add(e.getId()),t.relationType===kn.Annotation)t.addAnnotationToAggregation(e);else if(t.relationType===kn.Replace&&t.targetEvent&&!t.targetEvent.isState()){var o=yield t.getLastReplacement();t.targetEvent.makeReplaced(o)}e.on(qt.BeforeRedaction,t.onBeforeRedaction),t.emit(NE.Add,e),t.maybeEmitCreated()}})()}removeEvent(e){var t=this;return B(function*(){if(t.relations.has(e)){if(t.relations.delete(e),t.relationType===kn.Annotation)t.removeAnnotationFromAggregation(e);else if(t.relationType===kn.Replace&&t.targetEvent&&!t.targetEvent.isState()){var n=yield t.getLastReplacement();t.targetEvent.makeReplaced(n)}t.emit(NE.Remove,e)}})()}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){var t,{key:n}=null!==(t=e.getRelation())&&void 0!==t?t:{};if(n){var r=this.annotationsByKey[n];r||(r=this.annotationsByKey[n]=new Set,this.sortedAnnotationsByKey.push([n,r])),r.add(e),this.sortedAnnotationsByKey.sort((e,t)=>{var n=e[1];return t[1].size-n.size});var i=e.getSender(),o=this.annotationsBySender[i];o||(o=this.annotationsBySender[i]=new Set),o.add(e)}}removeAnnotationFromAggregation(e){var t,{key:n}=null!==(t=e.getRelation())&&void 0!==t?t:{};if(n){var r=this.annotationsByKey[n];r&&(r.delete(e),this.sortedAnnotationsByKey.sort((e,t)=>{var n=e[1];return t[1].size-n.size}));var i=e.getSender(),o=this.annotationsBySender[i];o&&o.delete(e)}}getSortedAnnotationsByKey(){return this.relationType!==kn.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==kn.Annotation?null:this.annotationsBySender}getLastReplacement(){var e=this;return B(function*(){if(e.relationType!==kn.Replace||!e.targetEvent)return null;var t=e.targetEvent.getServerAggregatedRelation(kn.Replace),n=null==t?void 0:t.origin_server_ts,r=e.getRelations().reduce((t,r)=>r.getSender()!==e.targetEvent.getSender()||n&&n>r.getTs()||t&&t.getTs()>r.getTs()?t:r,null);return null!=r&&r.shouldAttemptDecryption()&&e.client.getCrypto()?yield r.attemptDecryption(e.client.getCrypto()):null!=r&&r.isBeingDecrypted()&&(yield r.getDecryptionPromise()),r})()}setTargetEvent(e){var t=this;return B(function*(){if(!t.targetEvent){if(t.targetEvent=e,t.relationType===kn.Replace&&!t.targetEvent.isState()){var n=yield t.getLastReplacement();n&&t.targetEvent.makeReplaced(n)}t.maybeEmitCreated()}})()}maybeEmitCreated(){this.creationEmitted||!this.targetEvent||!this.relations.size||(this.creationEmitted=!0,this.targetEvent.emit(qt.RelationsCreated,this.relationType,this.eventType))}}class KX{constructor(e,t){this.client=e,this.room=t,P(this,"relations",new Map)}getChildEventsForEvent(e,t,n){var r;return null===(r=this.relations.get(e))||void 0===r||null===(r=r.get(t))||void 0===r?void 0:r.get(n)}getAllChildEventsForEvent(e){var t,n=null!==(t=this.relations.get(e))&&void 0!==t?t:new Map,r=[];for(var i of n.values())for(var o of i.values())r.push(...o.getRelations());return r}aggregateParentEvent(e){var t=this.relations.get(e.getId());if(t)for(var n of t.values())for(var r of n.values())r.setTargetEvent(e)}aggregateChildEvent(e,t){if(!e.isRedacted()&&e.status!==ot.CANCELLED){var n=e.getRelation();if(n){var r=()=>{e.isDecryptionFailure()?e.once(qt.Decrypted,r):this.aggregateChildEvent(e,t)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption())return void e.once(qt.Decrypted,r);var{event_id:i,rel_type:o}=n,s=e.getType(),a=this.relations.get(i);a||(a=new Map,this.relations.set(i,a));var l=a.get(o);l||(l=new Map,a.set(o,l));var c=l.get(s);if(!c){var u,d,h;c=new xP(o,s,this.client),l.set(s,c);var p=null!==(u=this.room)&&void 0!==u?u:null==t?void 0:t.room,f=null!==(d=null!==(h=null==t?void 0:t.findEventById(i))&&void 0!==h?h:null==p?void 0:p.findEventById(i))&&void 0!==d?d:null==p?void 0:p.getPendingEvent(i);f&&c.setTargetEvent(f)}c.addEvent(e)}}}}Wm=M.log.bind(M);var vy=function(e){return e.Ignore="ignore",e.Replace="replace",e}({});class ng extends Pn{constructor(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(),this.room=e,this.thread=s,this.threadListType=a,P(this,"relations",void 0),P(this,"timelineSupport",void 0),P(this,"displayPendingEvents",void 0),P(this,"liveTimeline",void 0),P(this,"timelines",void 0),P(this,"_eventIdToTimeline",new Map),P(this,"filter",void 0),this.timelineSupport=!!i.timelineSupport,this.liveTimeline=new Me(this),this.displayPendingEvents=!1!==i.pendingEvents,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=i.filter,this.relations=null!==(t=null===(n=this.room)||void 0===n?void 0:n.relations)&&void 0!==t?t:new KX(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:o)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return this.room&&this.displayPendingEvents?this.room.getPendingEvents():[]}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,t){var n=this._eventIdToTimeline.get(e);n&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(t,n))}resetLiveTimeline(e,t){var n=!this.timelineSupport||!t,r=this.liveTimeline,i=n?r.forkLive(Me.FORWARDS):r.fork(Me.FORWARDS);n?(this.timelines=[i],this._eventIdToTimeline=new Map):this.timelines.push(i),t&&r.setPaginationToken(t,Me.FORWARDS),i.setPaginationToken(e??null,Me.BACKWARDS),this.liveTimeline=i,this.emit(xe.TimelineReset,this.room,this,n)}getTimelineForEvent(e){if(null==e)return null;var t=this._eventIdToTimeline.get(e);return void 0===t?null:t}findEventById(e){var t=this.getTimelineForEvent(e);if(t)return t.getEvents().find(function(t){return t.getId()==e})}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new Me(this);return this.timelines.push(e),e}addEventsToTimeline(e,t,n,r,i){if(!r)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&r==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!this.filter||(e=this.filter.filterRoomTimeline(e)).length){var o=t?Me.BACKWARDS:Me.FORWARDS,s=t?Me.FORWARDS:Me.BACKWARDS,a=!1,l=!1;for(var c of e){var u=c.getId(),d=this._eventIdToTimeline.get(u);if(d)if(l=!1,d!=r){var h=r.getNeighbouringTimeline(o);if(h)Wm(d==h?"Event "+u+" in neighbouring timeline - switching to "+d:"Event "+u+" already in a different timeline "+d),r=d;else{M.info("Already have timeline for "+u+" - joining timeline "+r+" to "+d);var p=d===this.liveTimeline,f=r===this.liveTimeline,m=o===Me.BACKWARDS&&p,v=o===Me.FORWARDS&&f;m||v?(m&&M.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+d+")"),v&&M.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+r+")")):(r.setNeighbouringTimeline(d,o),d.setNeighbouringTimeline(r,s),r=d,a=!0)}}else Wm("Event "+u+" already in timeline "+r);else this.addEventToTimeline(c,r,{toStartOfTimeline:t,addToState:n}),l=!0,a=!0}if(l||!a){if(o===Me.FORWARDS&&r===this.liveTimeline)return M.warn({lastEventWasNew:l,didUpdate:a}),void M.warn("Refusing to set forwards pagination token of live timeline "+"".concat(r," to ").concat(i));r.setPaginationToken(i??null,o)}}}addLiveEvent(e,t){var{duplicateStrategy:n,fromCache:r,roomState:i,timelineWasEmpty:o,addToState:s}=t;if(this.filter&&!this.filter.filterRoomTimeline([e]).length)return;var a=this._eventIdToTimeline.get(e.getId());if(a)if(n===vy.Replace){Wm("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var l=a.getEvents(),c=0;c<l.length;c++)if(l[c].getId()===e.getId()){i||(i=a.getState(Me.FORWARDS)),Me.setEventMetadata(e,i,!1),l[c]=e;break}}else Wm("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:r,roomState:i,timelineWasEmpty:o,addToState:s})}addEventToTimeline(e,t,n){var r,{toStartOfTimeline:i,fromCache:o=!1,roomState:s,timelineWasEmpty:a,addToState:l}=n;if(t.getTimelineSet()!==this)throw new Error("EventTimelineSet.addEventToTimeline: Timeline=".concat(t.toString(),' does not belong " +\n                "in timelineSet(threadId=').concat(null===(r=this.thread)||void 0===r?void 0:r.id,")"));var c=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var u,d="event=".concat(c);return e.threadRootId&&(d+="(belongs to thread=".concat(e.threadRootId,")")),void M.warn("EventTimelineSet.addEventToTimeline: Ignoring ".concat(d," that does not belong ")+"in timeline=".concat(t.toString()," timelineSet(threadId=").concat(null===(u=this.thread)||void 0===u?void 0:u.id,")"))}t.addEvent(e,{toStartOfTimeline:i,roomState:s,timelineWasEmpty:a,addToState:l}),this._eventIdToTimeline.set(c,t);var h={timeline:t,liveEvent:!i&&t==this.liveTimeline&&!o};this.emit(xe.Timeline,e,this.room,!!i,!1,h)}insertEventIntoTimeline(e,t,n,r){var i;if(t.getTimelineSet()!==this)throw new Error("EventTimelineSet.insertEventIntoTimeline: Timeline=".concat(t.toString(),' does not belong " +\n                "in timelineSet(threadId=').concat(null===(i=this.thread)||void 0===i?void 0:i.id,")"));var o=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var s,a="event=".concat(o);return e.threadRootId&&(a+="(belongs to thread=".concat(e.threadRootId,")")),void M.warn("EventTimelineSet.insertEventIntoTimeline: Ignoring ".concat(a," that does not belong ")+"in timeline=".concat(t.toString()," timelineSet(threadId=").concat(null===(s=this.thread)||void 0===s?void 0:s.id,")"))}var l=e.relationEventId;if(l){for(var c=this.findEventById(l),u=t.getEvents(),d=void 0!==c?u.indexOf(c):0;d<u.length;d++){if(u[d].getTs()>e.getTs())break}t.insertEvent(e,d,n,r),this._eventIdToTimeline.set(o,t);var h={timeline:t,liveEvent:!1};this.emit(xe.Timeline,e,this.room,!1,!1,h)}else this.addEventToTimeline(e,t,{toStartOfTimeline:!1,fromCache:!1,timelineWasEmpty:!1,roomState:n,addToState:r})}handleRemoteEcho(e,t,n){var r=this._eventIdToTimeline.get(t);r?(this._eventIdToTimeline.delete(t),this._eventIdToTimeline.set(n,r)):(!this.filter||this.filter.filterRoomTimeline([e]).length)&&this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,addToState:!1})}removeEvent(e){var t=this._eventIdToTimeline.get(e);if(!t)return null;var n=t.removeEvent(e);if(n){this._eventIdToTimeline.delete(e);var r={timeline:t};this.emit(xe.Timeline,n,this.room,void 0,!0,r)}return n}compareEventOrdering(e,t){if(e==t)return 0;var n=this._eventIdToTimeline.get(e),r=this._eventIdToTimeline.get(t);if(void 0===n||void 0===r)return null;if(n===r){for(var i=void 0,o=void 0,s=n.getEvents(),a=0;a<s.length&&(void 0===i||void 0===o);a++){var l=s[a].getId();l==e&&(i=a),l==t&&(o=a)}var c=i-o;return c<0?-1:c>0?1:0}for(var u=n;u;){if(u===r)return-1;u=u.getNeighbouringTimeline(Me.FORWARDS)}for(u=n;u;){if(u===r)return 1;u=u.getNeighbouringTimeline(Me.BACKWARDS)}return null}canContain(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");var t,{threadId:n,shouldLiveInRoom:r,shouldLiveInThread:i}=this.room.eventShouldLiveIn(e);if(this.thread)return this.thread.id===n;r||i||M.warn("EventTimelineSet:canContain event encountered which cannot be added to any timeline roomId=".concat(null===(t=this.room)||void 0===t?void 0:t.roomId," eventId=").concat(e.getId()," threadId=").concat(e.threadRootId));return r}}var ot=function(e){return e.NOT_SENT="not_sent",e.ENCRYPTING="encrypting",e.SENDING="sending",e.QUEUED="queued",e.SENT="sent",e.CANCELLED="cancelled",e}({});class zX{constructor(e,t){this.roomId=e}}class WX{constructor(e){this.target=e,P(this,"reEmitters",new WeakMap)}reEmit(e,t){var n=this,r=this.reEmitters.get(e);r||(r=new Map,this.reEmitters.set(e,r));var i=function(t){if(r.has(t))return 1;var i=function(){if("error"!==t||0!==n.target.listenerCount("error")){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.target.emit(t,...i,e)}};e.on(t,i),r.set(t,i)};for(var o of t)i(o)}stopReEmitting(e,t){var n=this.reEmitters.get(e);if(n){for(var r of t)e.off(r,n.get(r)),n.delete(r);0===n.size&&this.reEmitters.delete(e)}}}class Mv extends WX{constructor(e){super(e)}reEmit(e,t){super.reEmit(e,t)}stopReEmitting(e,t){super.stopReEmitting(e,t)}}var rb=new M3("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");function Ive(e,t){if(t.endsWith("*")){var n=t.slice(0,-1);return e.slice(0,n.length)===n}return e===t}class QF{constructor(e,t){this.filterJson=e,this.userId=t}check(e){var t,n,r=(null===(t=e.getUnsigned())||void 0===t?void 0:t["m.relations"])||{},i=Object.keys(r),o=[];return this.userId&&null!=r&&null!==(n=r[yn.name])&&void 0!==n&&n.current_user_participated&&o.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url,i,o)}toJSON(){return Object.fromEntries(Object.entries({types:this.filterJson.types,not_types:this.filterJson.not_types,rooms:this.filterJson.rooms,not_rooms:this.filterJson.not_rooms,senders:this.filterJson.senders,not_senders:this.filterJson.not_senders,contains_url:this.filterJson.contains_url,[_g.name]:this.filterJson[_g.name],[Sg.name]:this.filterJson[Sg.name]}).filter(e=>{var[t,n]=e;return n}))}checkFields(e,t,n,r,i,o){var s={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return Ive(n,e)}};for(var a in s){var l=s[a],c="not_"+a,u=this.filterJson[c];if(null!=u&&u.some(l))return!1;var d=this.filterJson[a];if(d&&!d.some(l))return!1}var h=this.filterJson.contains_url;if(void 0!==h&&h!==r)return!1;var p=this.filterJson[Sg.name];if(void 0!==p&&!this.arrayMatchesFilter(p,i))return!1;var f=this.filterJson[_g.name];return!(void 0!==f&&!this.arrayMatchesFilter(f,o))}arrayMatchesFilter(e,t){return t.length>0&&e.every(e=>t.includes(e))}filter(e){return e.filter(this.check,this)}limit(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}function ZF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Cm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZF(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function fk(e,t,n){for(var r=t.split("."),i=e,o=0;o<r.length-1;o++)i[r[o]]||(i[r[o]]={}),i=i[r[o]];i[r[r.length-1]]=n}class As{static fromJson(e,t,n){var r=new As(e,t);return r.setDefinition(n),r}constructor(e,t){this.userId=e,this.filterId=t,P(this,"definition",{}),P(this,"roomFilter",void 0),P(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;var t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms)),this.roomFilter=new QF(n,this.userId),this.roomTimelineFilter=new QF((null==t?void 0:t.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){fk(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var t,n;this.definition=Cm(Cm({},this.definition),{},{room:Cm(Cm({},null===(t=this.definition)||void 0===t?void 0:t.room),{},{timeline:Cm(Cm({},null===(n=this.definition)||void 0===n||null===(n=n.room)||void 0===n?void 0:n.timeline),{},{[rb.name]:e})})})}setLazyLoadMembers(e){fk(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){fk(this.definition,"room.include_leave",e)}}function Xw(e){return null!=e}P(As,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0});var kve=new Ys.UnstableValue("m.message","org.matrix.msc1767.message"),AP=new Ys.UnstableValue("m.text","org.matrix.msc1767.text"),xve=new Ys.UnstableValue("m.html","org.matrix.msc1767.html"),YX=new Ys.NamespacedValue("m.reference");function Ave(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var n=t,r=e;return n.matches(r.name)||Xw(r.altName)&&n.matches(r.altName)}var LP=new e_("m.topic");function e$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Lve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function XX(e,t){return{msgtype:cl.Text,format:"org.matrix.custom.html",body:e,formatted_body:t}}function JX(e,t){return{msgtype:cl.Notice,format:"org.matrix.custom.html",body:e,formatted_body:t}}function QX(e,t){return{msgtype:cl.Emote,format:"org.matrix.custom.html",body:e,formatted_body:t}}function ZX(e){return{msgtype:cl.Text,body:e}}function eJ(e){return{msgtype:cl.Notice,body:e}}function tJ(e){return{msgtype:cl.Emote,body:e}}var nJ=(e,t,n,r)=>{var i="at ".concat(new Date(n).toISOString());return[t===zg.Self?"User":void 0,"Location",r?'"'.concat(r,'"'):void 0,e,i].filter(Boolean).join(" ")},rJ=(e,t,n,r,i)=>{var o=e??nJ(t,i||zg.Self,n,r),s=n?{[Af.name]:n}:{};return Lve({msgtype:cl.Location,body:o,geo_uri:t,[n_.name]:{description:r,uri:t},[t_.name]:{type:i||zg.Self},[AP.name]:o},s)},Pve=e=>{var t,n,r=n_.findIn(e),i=t_.findIn(e),o=Af.findIn(e),s=AP.findIn(e),a=null!==(t=null==r?void 0:r.uri)&&void 0!==t?t:null==e?void 0:e.geo_uri,l=null==r?void 0:r.description,c=null!==(n=null==i?void 0:i.type)&&void 0!==n?n:zg.Self,u=s??e.body;return rJ(u,a,o??void 0,l,c)},iJ=(e,t)=>{var n=[];return Xw(t)&&n.push({body:t,mimetype:"text/html"}),Xw(e)&&n.push({body:e,mimetype:"text/plain"}),{topic:e,[LP.name]:n}},Ove=e=>{var t,n,r,i,o,s=LP.findIn(e);return Array.isArray(s)?{text:null!==(t=null!==(n=null==s||null===(r=s.find(e=>!Xw(e.mimetype)||"text/plain"===e.mimetype))||void 0===r?void 0:r.body)&&void 0!==n?n:e.topic)&&void 0!==t?t:void 0,html:null==s||null===(i=s.find(e=>"text/html"===e.mimetype))||void 0===i?void 0:i.body}:{text:null!==(o=e.topic)&&void 0!==o?o:void 0}},Mve=(e,t,n,r,i)=>({description:n,timeout:e,live:t,[Af.name]:i||Date.now(),[t_.name]:{type:r??zg.Self}}),sJ=e=>{var t,{description:n,timeout:r,live:i}=e,o=null!==(t=Af.findIn(e))&&void 0!==t?t:void 0,s=t_.findIn(e);return{description:n,timeout:r,live:i,assetType:null==s?void 0:s.type,timestamp:o}},Dve=(e,t,n,r)=>({[n_.name]:{description:r,uri:e},[Af.name]:t,"m.relates_to":{rel_type:YX.name,event_id:n}}),F5=e=>{var t,n=n_.findIn(e),r=null!==(t=Af.findIn(e))&&void 0!==t?t:void 0;return{description:null==n?void 0:n.description,uri:null==n?void 0:n.uri,timestamp:r}};const Nve=Object.freeze(Object.defineProperty({__proto__:null,getTextForLocationEvent:nJ,makeBeaconContent:Dve,makeBeaconInfoContent:Mve,makeEmoteMessage:tJ,makeHtmlEmote:QX,makeHtmlMessage:XX,makeHtmlNotice:JX,makeLocationContent:rJ,makeNotice:eJ,makeTextMessage:ZX,makeTopicContent:iJ,parseBeaconContent:F5,parseBeaconInfoContent:sJ,parseLocationEvent:Pve,parseTopicContent:Ove},Symbol.toStringTag,{value:"Module"}));var $n=function(e){return e.New="Beacon.new",e.Update="Beacon.update",e.LivenessChange="Beacon.LivenessChange",e.Destroy="Beacon.Destroy",e.LocationUpdate="Beacon.LocationUpdate",e}({}),$5=(e,t,n)=>n>=e&&e+t>=n,Jw=e=>"".concat(e.getRoomId(),"_").concat(e.getStateKey());class oJ extends Pn{constructor(e){super(),this.rootEvent=e,P(this,"roomId",void 0),P(this,"_beaconInfo",void 0),P(this,"_isLive",void 0),P(this,"livenessWatchTimeout",void 0),P(this,"_latestLocationEvent",void 0),P(this,"clearLatestLocation",()=>{this._latestLocationEvent=void 0,this.emit($n.LocationUpdate,this.latestLocationState)}),this.roomId=this.rootEvent.getRoomId(),this.setBeaconInfo(this.rootEvent)}get isLive(){return!!this._isLive}get identifier(){return Jw(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&F5(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(Jw(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit($n.Update,e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit($n.Destroy,this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),this.beaconInfo)if(this.isLive){var e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},this.beaconInfo.timestamp-Date.now()))}addLocations(e){var t;if(this.isLive){var n=null===(t=e.filter(e=>{var t=e.getContent(),n=F5(t);if(!n.uri||!n.timestamp)return!1;var{timestamp:r}=n;return this._beaconInfo.timestamp&&$5(this._beaconInfo.timestamp,this._beaconInfo.timeout,r)&&(!this.latestLocationState||r>this.latestLocationState.timestamp)}).sort(nve))||void 0===t?void 0:t[0];n&&(this._latestLocationEvent=n,this.emit($n.LocationUpdate,this.latestLocationState))}}setBeaconInfo(e){this._beaconInfo=sJ(e.getContent()),this.checkLiveness()}checkLiveness(){var e=this.isLive;if(this.beaconInfo){var t=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!!this._beaconInfo.live&&!!t&&$5(t,this._beaconInfo.timeout,Date.now()),e!==this.isLive&&this.emit($n.LivenessChange,this.isLive,this)}}}function t$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Uve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?t$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function aJ(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Zi({content:{[t.getId()]:{[n]:{[e]:Uve({ts:t.getTs()},!r&&{thread_id:Zg(t)})}}},type:ee.Receipt,room_id:t.getRoomId()})}var Tm=0,Rm=1;class cJ extends Pn{constructor(){super(...arguments),P(this,"receipts",new pu(()=>new Map)),P(this,"receiptCacheByEventId",new Map)}getReadReceiptForUserId(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:os.Read,[o,s]=null!==(t=null===(n=this.receipts.get(i))||void 0===n?void 0:n.get(e))&&void 0!==t?t:[null,null];return r?o:s??o}compareReceipts(e,t){var n;return null!==(n=this.getUnfilteredTimelineSet().compareEventOrdering(e.eventId,t.eventId))&&void 0!==n?n:e.data.ts-t.data.ts}getEventReadUpTo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getLatestReceipt(e,t);return n&&this.receiptPointsAtConsistentEvent(n)?n.eventId:null}receiptPointsAtConsistentEvent(e){var t,n=this.findEventById(e.eventId);if(!n)return!1;if(null===(t=e.data)||void 0===t||!t.thread_id)return!0;if(e.data.thread_id===r_){if(cb(n))return!0}else if(n.threadRootId===e.data.thread_id)return!0;return M.warn("Ignoring receipt because its thread_id (".concat(e.data.thread_id,") disagrees ")+"with the thread root (".concat(n.threadRootId,") of the referenced event ")+"(event ID = ".concat(e.eventId,")")),!1}getLatestReceipt(e,t){var n,r,i,o=this.getReadReceiptForUserId(e,t,os.Read),s=this.getReadReceiptForUserId(e,t,os.ReadPrivate);return null!=o&&o.eventId&&null!=s&&s.eventId&&(i=this.compareReceipts(o,s)),i?null!==(r=i<0?s:o)&&void 0!==r?r:null:null!==(n=s??o)&&void 0!==n?n:null}addReceiptToStructure(e,t,n,r,i){var o,s,a=this.receipts.getOrCreate(t),l=a.get(n);l||(l=[null,null],a.set(n,l));var c,u=l[Tm];i&&(u=null!==(c=l[Rm])&&void 0!==c?c:l[Tm]);var d={eventId:e,data:r};if(u&&this.compareReceipts(u,d)>=0)return;var h=i?l[Tm]:d,p=i?d:l[Rm],f=null;h&&p&&(f=this.getUnfilteredTimelineSet().compareEventOrdering(h.eventId,p.eventId));var m=null===f||f<0,v=null!==(o=l[Rm])&&void 0!==o?o:l[Tm];if(i&&m?l[Rm]=d:i||(l[Tm]=d,m||(l[Rm]=null)),v!==(null!==(s=l[Rm])&&void 0!==s?s:l[Tm])){if(v&&this.receiptCacheByEventId.get(v.eventId)){var g=v.eventId;this.receiptCacheByEventId.set(g,this.receiptCacheByEventId.get(g).filter(e=>e.type!==t||e.userId!==n)),this.receiptCacheByEventId.get(g).length<1&&this.receiptCacheByEventId.delete(g)}this.receiptCacheByEventId.get(e)||this.receiptCacheByEventId.set(e,[]),this.receiptCacheByEventId.get(e).push({userId:n,type:t,data:r})}}getReceiptsForEvent(e){return this.receiptCacheByEventId.get(e.getId())||[]}fixupNotifications(e){var t=this.getReadReceiptForUserId(e,!1),n=this.timeline[this.timeline.length-1];n&&(null==t?void 0:t.eventId)===n.getId()&&e===n.getSender()&&(this.setUnread(zt.Total,0),this.setUnread(zt.Highlight,0))}addLocalEchoReceipt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.addReceipt(aJ(e,t,n,r),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter(function(e){return CP(e.type)}).map(function(e){return e.userId})}}var jve=new Ys.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed"),Fve=new Ys.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed"),$ve=new Ys.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start"),ib=new Ys.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response"),Qw=new Ys.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end"),Pd=function(e){return e.New="Poll.new",e.End="Poll.end",e.Update="Poll.update",e.Responses="Poll.Responses",e.Destroy="Poll.Destroy",e.UndecryptableRelations="Poll.UndecryptableRelations",e}({}),n$=(e,t)=>({responseEvents:e.filter(e=>{if(!e.isDecryptionFailure())return ib.matches(e.getType())&&e.getTs()<=t})});class lJ extends Pn{constructor(e,t,n){if(super(),this.rootEvent=e,this.matrixClient=t,this.room=n,P(this,"roomId",void 0),P(this,"pollEvent",void 0),P(this,"_isFetchingResponses",!1),P(this,"relationsNextBatch",void 0),P(this,"responses",null),P(this,"endEvent",void 0),P(this,"undecryptableRelationEventIds",new Set),P(this,"countUndecryptableEvents",e=>{var t=e.filter(e=>e.isDecryptionFailure()).map(e=>e.getId()),n=this.undecryptableRelationsCount;this.undecryptableRelationEventIds=new Set([...this.undecryptableRelationEventIds,...t]),this.undecryptableRelationsCount!==n&&this.emit(Pd.UndecryptableRelations,this.undecryptableRelationsCount)}),!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get endEventId(){var e;return null===(e=this.endEvent)||void 0===e?void 0:e.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}get undecryptableRelationsCount(){return this.undecryptableRelationEventIds.size}getResponses(){var e=this;return B(function*(){return e.responses||e.isFetchingResponses||(yield e.fetchResponses()),e.responses})()}onNewRelation(e){var t;if(Qw.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit(Pd.End)),this.responses){var n=(null===(t=this.endEvent)||void 0===t?void 0:t.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:r}=n$([e],n);this.countUndecryptableEvents([e]),r.length&&(r.forEach(e=>{this.responses.addEvent(e)}),this.emit(Pd.Responses,this.responses))}}fetchResponses(){var e=this;return B(function*(){var t,n;e._isFetchingResponses=!0;var r=yield e.matrixClient.relations(e.roomId,e.rootEvent.getId(),"m.reference",void 0,{from:e.relationsNextBatch||void 0});yield Promise.all(r.events.map(t=>e.matrixClient.decryptEventIfNeeded(t)));var i=e.responses||new xP("m.reference",ib.name,e.matrixClient,[ib.altName]),o=r.events.find(e=>Qw.matches(e.getType()));e.validateEndEvent(o)&&(e.endEvent=o,e.refilterResponsesOnEnd(),e.emit(Pd.End));var s=(null===(t=e.endEvent)||void 0===t?void 0:t.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:a}=n$(r.events,s);a.forEach(e=>{i.addEvent(e)}),e.relationsNextBatch=null!==(n=r.nextBatch)&&void 0!==n?n:void 0,e.responses=i,e.countUndecryptableEvents(r.events),e.relationsNextBatch?e.fetchResponses():e._isFetchingResponses=!1,e.emit(Pd.Responses,e.responses)})()}refilterResponsesOnEnd(){var e;if(this.responses){var t=(null===(e=this.endEvent)||void 0===e?void 0:e.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach(e=>{var n;e.getTs()>t&&(null===(n=this.responses)||void 0===n||n.removeEvent(e))}),this.emit(Pd.Responses,this.responses)}}validateEndEvent(e){if(!e||this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;var t=this.room.currentState,n=e.getSender();return!!n&&(n===this.rootEvent.getSender()||t.maySendRedactionForEvent(this.rootEvent,n))}}var uJ=e=>{var t=e.getType();return Ys.M_POLL_START.matches(t)||ib.matches(t)||Qw.matches(t)};class Bve{constructor(e){P(this,"room",void 0),P(this,"threadedReceipts",void 0),P(this,"unthreadedReceipts",void 0),P(this,"danglingReceipts",void 0),P(this,"onTimelineEvent",e=>{var t=e.getId();if(t){var n=this.danglingReceipts.remove(t);null==n||n.forEach(e=>{e.receipt.thread_id?this.threadedReceipts.set(e.receipt.thread_id,e.eventId,e.receiptType,e.userId,e.receipt.ts,e.synthetic):this.unthreadedReceipts.set(t,e.receiptType,e.userId,e.receipt.ts,e.synthetic)})}}),this.room=e,this.threadedReceipts=new Gve(e),this.unthreadedReceipts=new dJ(e),this.danglingReceipts=new Kve,e.on(xe.Timeline,this.onTimelineEvent)}add(e,t){for(var[n,r]of Object.entries(e))for(var[i,o]of Object.entries(r))for(var[s,a]of Object.entries(o)){this.room.findEventById(n)?a.thread_id?this.threadedReceipts.set(a.thread_id,n,i,s,a.ts,t):this.unthreadedReceipts.set(n,i,s,a.ts,t):this.danglingReceipts.add(new Vve(n,i,s,a,t))}}hasUserReadEvent(e,t){var n=this.unthreadedReceipts.get(e);if(n&&B5(n.eventId,t,this.room))return!0;var r=this.room.findEventById(t);if(!r)return M.warn("hasUserReadEvent event ID ".concat(t," not found in room ").concat(this.room.roomId,": this shouldn't happen!")),!1;var i=Zg(r),o=this.threadedReceipts.get(i,e);return!!(o&&B5(o.eventId,t,this.room)||this.userSentLatestEventInThread(i,e))}userSentLatestEventInThread(e,t){var n,r=e===r_?this.room.getLiveTimeline().getEvents():null===(n=this.room.getThread(e))||void 0===n?void 0:n.timeline;return!!(r&&r.length>0&&r[r.length-1].getSender()===t)}}class Hve{constructor(e,t,n){this.eventId=e,this.receiptType=t,this.ts=n}}class Vve{constructor(e,t,n,r,i){this.eventId=e,this.receiptType=t,this.userId=n,this.receipt=r,this.synthetic=i}}class qve{constructor(e){P(this,"room",void 0),P(this,"real",void 0),P(this,"synthetic",void 0),this.room=e,this.real=void 0,this.synthetic=void 0}set(e,t){e?this.synthetic=t:this.real=t,this.synthetic&&this.real&&B5(this.real.eventId,this.synthetic.eventId,this.room)&&(this.synthetic=void 0)}get(){var e;return null!==(e=this.synthetic)&&void 0!==e?e:this.real}getByType(e){return e?this.synthetic:this.real}}class dJ{constructor(e){P(this,"room",void 0),P(this,"data",void 0),this.room=e,this.data=new Map}set(e,t,n,r,i){var o=PP(this.data,n,()=>new qve(this.room)),s=o.getByType(i);s&&zve(s.eventId,e,this.room)||o.set(i,new Hve(e,t,r))}get(e){var t;return null===(t=this.data.get(e))||void 0===t?void 0:t.get()}}class Gve{constructor(e){P(this,"room",void 0),P(this,"data",void 0),this.room=e,this.data=new Map}set(e,t,n,r,i,o){PP(this.data,e,()=>new dJ(this.room)).set(t,n,r,i,o)}get(e,t){var n;return null===(n=this.data.get(e))||void 0===n?void 0:n.get(t)}}class Kve{constructor(){P(this,"data",new Map)}add(e){PP(this.data,e.eventId,()=>[]).push(e)}remove(e){var t=this.data.get(e);return this.data.delete(e),t}}function PP(e,t,n){var r=e.get(t);if(r)return r;var i=n();return e.set(t,i),i}function B5(e,t,n){var r=n.compareEventOrdering(e,t);return null!==r&&r>=0}function zve(e,t,n){var r=n.compareEventOrdering(e,t);return null!==r&&r>0}function Wve(e,t,n){var r=e.findEventById(t),i=e.findEventById(n);if(!r||!i)return null;var o=cb(r),s=cb(i);return o&&s?Yve(e,t,n,r,i):Xve(t,n,r,i)}function Yve(e,t,n,r,i){var o=e.getUnfilteredTimelineSet(),s=o.compareEventOrdering(t,n);return null!==s?s:o.getTimelineForEvent(t)===o.getLiveTimeline()?1:o.getTimelineForEvent(n)===o.getLiveTimeline()?-1:fJ(r,i)}function Xve(e,t,n,r){var i=Zg(n),o=Zg(r),s=n.getThread();return s&&i===o?s.timelineSet.compareEventOrdering(e,t):fJ(n,r)}function fJ(e,t){var n=e.getTs(),r=t.getTs();return n<r?-1:n>r?1:0}var le=function(e){return e.Get="GET",e.Put="PUT",e.Post="POST",e.Delete="DELETE",e.Options="OPTIONS",e.Head="HEAD",e.Patch="PATCH",e}({});function r$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Jve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class Xh extends Error{constructor(e,t,n){super(e),this.httpStatus=t,this.httpHeaders=n}isRateLimitError(){return 429===this.httpStatus}getRetryAfterMs(){var e,t=null===(e=this.httpHeaders)||void 0===e?void 0:e.get("Retry-After");if(null!=t){if(/^\d+$/.test(t)){var n=1e3*Number.parseInt(t);if(!Number.isFinite(n))throw new Error("Retry-After header integer value is too large");return n}var r=new Date(t);if(r.toUTCString()!==t)throw new Error("Retry-After header value is not a valid HTTP-date or non-negative decimal integer");return r.getTime()-Date.now()}return null}}class nr extends Xh{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=e.error||"Unknown message";t&&(o="[".concat(t,"] ").concat(o)),n&&(o="".concat(o," (").concat(n,")")),super("MatrixError: ".concat(o),t,i),this.url=n,this.event=r,P(this,"errcode",void 0),P(this,"data",void 0),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.data=e}isRateLimitError(){return"M_LIMIT_EXCEEDED"===this.errcode||("M_UNKNOWN"===this.errcode||void 0===this.errcode)&&super.isRateLimitError()}getRetryAfterMs(){var e=super.getRetryAfterMs();if(null!==e)return e;if("M_LIMIT_EXCEEDED"===this.errcode&&"retry_after_ms"in this.data){if(!Number.isInteger(this.data.retry_after_ms))throw new Error("retry_after_ms is not an integer");return this.data.retry_after_ms}return null}asWidgetApiErrorData(){var e,t,n,r,i={};if(this.httpHeaders)for(var[o,s]of this.httpHeaders)i[o]=s;return{http_status:null!==(e=this.httpStatus)&&void 0!==e?e:400,http_headers:i,url:null!==(t=this.url)&&void 0!==t?t:"",response:Jve({errcode:null!==(n=this.errcode)&&void 0!==n?n:"M_UNKNOWN",error:null!==(r=this.data.error)&&void 0!==r?r:"Unknown message"},this.data)}}static fromWidgetApiErrorData(e){return new nr(e.response,e.http_status,e.url,void 0,new Headers(e.http_headers))}}function OP(e,t){if(!(e instanceof Xh&&e.isRateLimitError()))return t;try{var n;return null!==(n=e.getRetryAfterMs())&&void 0!==n?n:t}catch{return t}}let yp=class extends Error{constructor(e,t){super(e+(t?": ".concat(t.message):""))}get name(){return"ConnectionError"}};class hJ extends Error{constructor(e){var t;super(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"")}get name(){return"TokenRefreshError"}}class MP extends Error{constructor(e){var t;super(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"")}get name(){return"TokenRefreshLogoutError"}}var i$,H5=function(e){return e.SessionLoggedOut="Session.logged_out",e.NoConsent="no_consent",e}({}),m2={};function Qve(){if(i$)return m2;i$=1;var e=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,t=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,n=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,r=/\\([\u000b\u0020-\u00ff])/g,i=/([\\"])/g,o=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function s(e){var r=String(e);if(n.test(r))return r;if(r.length>0&&!t.test(r))throw new TypeError("invalid parameter value");return'"'+r.replace(i,"\\$1")+'"'}function a(e){this.parameters=Object.create(null),this.type=e}return m2.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,r=e.type;if(!r||!o.test(r))throw new TypeError("invalid type");var i=r;if(t&&"object"==typeof t)for(var a,l=Object.keys(t).sort(),c=0;c<l.length;c++){if(a=l[c],!n.test(a))throw new TypeError("invalid parameter name");i+="; "+a+"="+s(t[a])}return i},m2.parse=function(t){if(!t)throw new TypeError("argument string is required");var n="object"==typeof t?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(t):t;if("string"!=typeof n)throw new TypeError("argument string is required to be a string");var i=n.indexOf(";"),s=-1!==i?n.slice(0,i).trim():n.trim();if(!o.test(s))throw new TypeError("invalid media type");var l=new a(s.toLowerCase());if(-1!==i){var c,u,d;for(e.lastIndex=i;u=e.exec(n);){if(u.index!==i)throw new TypeError("invalid parameter format");i+=u[0].length,c=u[1].toLowerCase(),34===(d=u[2]).charCodeAt(0)&&(-1!==(d=d.slice(1,-1)).indexOf("\\")&&(d=d.replace(r,"$1"))),l.parameters[c]=d}if(i!==n.length)throw new TypeError("invalid parameter format")}return l},m2}var Zve=Qve();function F3(e){var t=new AbortController;return setTimeout(()=>{t.abort()},e),t.signal}function pJ(e){var t=new AbortController;function n(){for(var t of e)t.removeEventListener("abort",r)}function r(){t.abort(),n()}for(var i of e){if(i.aborted){r();break}i.addEventListener("abort",r)}return{signal:t.signal,cleanup:n}}function DP(e,t){var n,r,i,o=s$(e)?new Headers(e.getAllResponseHeaders().trim().split(/[\r\n]+/).map(e=>{var t=e.indexOf(":");return[e.substring(0,t),e.substring(t+1)]})):e.headers;try{i=e1e(o)}catch(e){return e}return"application/json"===(null===(n=i)||void 0===n?void 0:n.type)&&t?new nr(JSON.parse(t),e.status,s$(e)?e.responseURL:e.url,void 0,o):"text/plain"===(null===(r=i)||void 0===r?void 0:r.type)?new Xh("Server returned ".concat(e.status," error: ").concat(t),e.status,o):new Xh("Server returned ".concat(e.status," error"),e.status,o)}function s$(e){return"getResponseHeader"in e}function e1e(e){var t=e.get("Content-Type");if(null===t)return null;try{return Zve.parse(t)}catch(e){throw new Error("Error parsing Content-Type '".concat(t,"': ").concat(e))}}function V5(e,t){return q5.apply(this,arguments)}function q5(){return(q5=B(function*(e,t){for(var n=0,r=null;n<e;)try{if(n>0){var i=1e3*Math.pow(2,n);M.log("network operation failed ".concat(n," times, retrying in ").concat(i,"ms...")),yield mp(i)}return yield t()}catch(e){if(!(e instanceof yp))throw e;n+=1,r=e}throw r})).apply(this,arguments)}function NP(e,t,n){return t>4||e instanceof yp&&!n||e.httpStatus&&4===Math.floor(e.httpStatus/100)&&429!==e.httpStatus||"AbortError"===e.name||"M_TOO_LARGE"===e.name?-1:OP(e,1e3*Math.pow(2,t))}var Od=function(e){return e.Success="success",e.Failure="failure",e.Logout="logout",e}({}),t1e=500,n1e=6e4;class r1e{constructor(e){this.opts=e,P(this,"tokenRefreshPromise",void 0),P(this,"latestTokenRefreshExpiry",void 0)}prepareForRequest(){var e=this;return B(function*(){return yield e.refreshIfNeeded(),{accessToken:e.opts.accessToken,refreshToken:e.opts.refreshToken,expiry:e.latestTokenRefreshExpiry}})()}refreshIfNeeded(){var e=this;return B(function*(){if(e.tokenRefreshPromise)return e.tokenRefreshPromise;e.latestTokenRefreshExpiry&&(e.latestTokenRefreshExpiry.getTime()-Date.now()<=t1e&&(yield e._handleUnknownToken()))})()}handleUnknownToken(e,t){var n=this;return B(function*(){return n._handleUnknownToken(e,t)})()}_handleUnknownToken(e,t){var n=this;return B(function*(){if(null!=e&&e.expiry&&e.expiry.getTime()-Date.now()>=n1e)return Od.Logout;if(!e||(null==e?void 0:e.accessToken)===n.opts.accessToken){var r;null!==(r=n.tokenRefreshPromise)&&void 0!==r||(n.tokenRefreshPromise=n.doTokenRefresh(t));try{return yield n.tokenRefreshPromise}finally{n.tokenRefreshPromise=void 0}}return Od.Success})()}doTokenRefresh(e){var t=this;return B(function*(){var n;if(!t.opts.refreshToken||!t.opts.tokenRefreshFunction)return null===(n=t.opts.logger)||void 0===n||n.error("Unable to refresh token - no refresh token or refresh function"),Od.Logout;e&&e>1&&(yield mp(1e3*Math.min(32,2**e)));try{var r,i;null===(r=t.opts.logger)||void 0===r||r.debug("Attempting to refresh token");var{accessToken:o,refreshToken:s,expiry:a}=yield t.opts.tokenRefreshFunction(t.opts.refreshToken);return t.opts.accessToken=o,t.opts.refreshToken=s,t.latestTokenRefreshExpiry=a,null===(i=t.opts.logger)||void 0===i||i.debug("... token refresh complete, new token expiry:",a),Od.Success}catch(e){var l,c;return e instanceof MP||e instanceof nr?(null===(c=t.opts.logger)||void 0===c||c.error("Failed to refresh token",e),Od.Logout):(null===(l=t.opts.logger)||void 0===l||l.warn("Failed to refresh token",e),Od.Failure)}})()}}function o$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class i1e{constructor(e,t){var n;this.eventEmitter=e,this.opts=t,P(this,"abortController",new AbortController),P(this,"tokenRefresher",void 0),CX(t,["baseUrl","prefix"]),t.onlyData=!!t.onlyData,t.useAuthorizationHeader=null===(n=t.useAuthorizationHeader)||void 0===n||n,this.tokenRefresher=new r1e(t)}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,t){return this.opts.fetchFn?this.opts.fetchFn(e,t):globalThis.fetch(e,t)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,t,n,r,i){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");var o=void 0,s=void 0;e===le.Get?o=n:s=n;var a=this.getUrl(t,o,r,this.opts.idBaseUrl),l={json:!0,headers:{}};return i&&(l.headers.Authorization="Bearer ".concat(i)),this.requestOtherUrl(e,a,s,l)}authedRequest(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return this.doAuthedRequest(1,e,t,n,r,i)}doAuthedRequest(e,t,n,r,i){var o=arguments,s=this;return B(function*(){var a=o.length>5&&void 0!==o[5]?o[5]:{},l=i_(a);l.abortSignal=a.abortSignal;var c=yield s.tokenRefresher.prepareForRequest();c.accessToken&&(s.opts.useAuthorizationHeader?(l.headers||(l.headers={}),l.headers.Authorization||(l.headers.Authorization="Bearer ".concat(c.accessToken)),r.access_token&&delete r.access_token):r.access_token||(r.access_token=c.accessToken));try{return yield s.request(t,n,r,i,l)}catch(o){if(!(o instanceof nr))throw o;if("M_UNKNOWN_TOKEN"===o.errcode){var u=yield s.tokenRefresher.handleUnknownToken(c,e);if(u===Od.Success)return s.doAuthedRequest(e+1,t,n,r,i,a);if(u===Od.Failure)throw new hJ(o);null!=l&&l.inhibitLogoutEmit||s.eventEmitter.emit(H5.SessionLoggedOut,o)}else"M_CONSENT_NOT_GIVEN"==o.errcode&&s.eventEmitter.emit(H5.NoConsent,o.message,o.data.consent_uri);throw o}})()}request(e,t,n,r,i){var o=this.getUrl(t,n,null==i?void 0:i.prefix,null==i?void 0:i.baseUrl);return this.requestOtherUrl(e,o,r,i)}requestOtherUrl(e,t,n){var r=arguments,i=this;return B(function*(){var o,s,a,l,c=r.length>3&&void 0!==r[3]?r[3]:{};if(void 0!==c.json&&void 0!==c.rawResponseBody)throw new Error("Invalid call to `FetchHttpApi` sets both `opts.json` and `opts.rawResponseBody`");var u=i.sanitizeUrlForLogs(t);null===(o=i.opts.logger)||void 0===o||o.debug("FetchHttpApi: --\x3e ".concat(e," ").concat(u));var d=Object.assign({},c.headers||{}),h=!c.rawResponseBody&&!1!==c.json;h&&(d.Accept||(d.Accept="application/json"));var p,f=null!==(s=c.localTimeoutMs)&&void 0!==s?s:i.opts.localTimeoutMs,m=null!==(a=c.keepAlive)&&void 0!==a&&a,v=[i.abortController.signal];void 0!==f&&v.push(F3(f)),c.abortSignal&&v.push(c.abortSignal),!1!==c.json&&(null==n||null===(l=n.constructor)||void 0===l?void 0:l.name)===Object.name?(p=JSON.stringify(n),d["Content-Type"]||(d["Content-Type"]="application/json")):p=n;var g,{signal:y,cleanup:b}=pJ(v),w=Date.now();try{var _;g=yield i.fetch(t,{signal:y,method:e,body:p,headers:d,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:m,priority:c.priority}),null===(_=i.opts.logger)||void 0===_||_.debug("FetchHttpApi: <-- ".concat(e," ").concat(u," [").concat(Date.now()-w,"ms ").concat(g.status,"]"))}catch(t){var S;throw null===(S=i.opts.logger)||void 0===S||S.debug("FetchHttpApi: <-- ".concat(e," ").concat(u," [").concat(Date.now()-w,"ms ").concat(t,"]")),"AbortError"===t.name?t:new yp("fetch failed",t)}finally{b()}if(!g.ok)throw DP(g,yield g.text());return i.opts.onlyData?c.rawResponseBody?yield g.blob():h?yield g.json():yield g.text():g})()}sanitizeUrlForLogs(e){try{var t;t="string"==typeof e?new URL(e):e;var n=new URLSearchParams;for(var r of t.searchParams.keys())n.append(r,"xxx");var i=n.toString(),o=i?"?".concat(i):"";return t.origin+t.pathname+o}catch{return"??"}}getUrl(e,t,n,r){var i=r??this.opts.baseUrl,o=i.endsWith("/")?i.slice(0,-1):i,s=new URL(o+(n??this.opts.prefix)+e);(this.opts.extraParams||t)&&k5(a$(a$({},this.opts.extraParams),t),s.searchParams);return s}}var hk,Kr=function(e){return e.V1="/_matrix/client/v1",e.V3="/_matrix/client/v3",e.Unstable="/_matrix/client/unstable",e}({}),Fl=function(e){return e.V2="/_matrix/identity/v2",e}({}),vg=function(e){return e.V1="/_matrix/media/v1",e.V3="/_matrix/media/v3",e}({}),s1e=1e3,o1e=0,uu=[],a1e=function(){};function c$(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];(t=t||0)<0&&(t=0);var o=Date.now()+t,s=o1e++,a={runAt:o,func:e,params:r,key:s},l=l1e(uu,function(e){return e.runAt-o});return uu.splice(l,0,a),UP(),s}function l$(e){if(0!==uu.length){var t;for(t=0;t<uu.length;t++){if(uu[t].key==e){uu.splice(t,1);break}}0===t&&UP()}}function UP(){hk&&globalThis.clearTimeout(hk);var e=uu[0];if(e){var t=Date.now(),n=Math.min(e.runAt-t,s1e);hk=globalThis.setTimeout(c1e,n)}}function c1e(){for(var e=Date.now(),t=[];;){var n=uu[0];if(!n||n.runAt>e)break;var r=uu.shift();a1e("runCallbacks: popping",r.key),t.push(r)}for(var i of(UP(),t))try{i.func.apply(globalThis,i.params)}catch(e){M.error("Uncaught exception in callback function",e)}}function l1e(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>1;t(e[i])>0?r=i:n=i+1}return n}class mJ extends i1e{constructor(){super(...arguments),P(this,"uploads",[])}uploadContent(e){var t,n,r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null===(t=o.includeFilename)||void 0===t||t,a=null!==(n=o.abortController)&&void 0!==n?n:new AbortController,l=(null!==(r=o.type)&&void 0!==r?r:e.type)||"application/octet-stream",c=null!==(i=o.name)&&void 0!==i?i:e.name,u={loaded:0,total:0,abortController:a},d=Promise.withResolvers();if(globalThis.XMLHttpRequest){var h=new globalThis.XMLHttpRequest,p=function(){h.abort(),d.reject(new Error("Timeout"))},f=c$(p,3e4);h.onreadystatechange=function(){if(h.readyState===globalThis.XMLHttpRequest.DONE){l$(f);try{if(0===h.status)throw new DOMException(h.statusText,"AbortError");if(!h.responseText)throw new Error("No response body.");h.status>=400?d.reject(DP(h,h.responseText)):d.resolve(JSON.parse(h.responseText))}catch(e){if("AbortError"===e.name)return void d.reject(e);d.reject(new yp("request failed",e))}}},h.upload.onprogress=e=>{var t;l$(f),u.loaded=e.loaded,u.total=e.total,f=c$(p,3e4),null===(t=o.progressHandler)||void 0===t||t.call(o,{loaded:e.loaded,total:e.total})};var m=this.getUrl("/upload",void 0,vg.V3);s&&c&&m.searchParams.set("filename",encodeURIComponent(c)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&m.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),h.open(le.Post,m.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&h.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),h.setRequestHeader("Content-Type",l),h.send(e),a.signal.addEventListener("abort",()=>{h.abort()})}else{var v={};s&&c&&(v.filename=c);var g={"Content-Type":l};this.authedRequest(le.Post,"/upload",v,e,{prefix:vg.V3,headers:g,abortSignal:a.signal}).then(e=>this.opts.onlyData?e:e.json()).then(d.resolve,d.reject)}return u.promise=d.promise.finally(()=>{qw(this.uploads,e=>e===u)}),a.signal.addEventListener("abort",()=>{qw(this.uploads,e=>e===u),d.reject(new DOMException("Aborted","AbortError"))}),this.uploads.push(u),u.promise}cancelUpload(e){var t=this.uploads.find(t=>t.promise===e);return!!t&&(t.abortController.abort(),!0)}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:vg.V3+"/upload",params:{access_token:this.opts.accessToken}}}}var u1e=216e5,d1e=3e4,gJ=function(e){return e.Stable="stable",e.Unstable="unstable",e}({});class vJ{constructor(e,t){var n=this;this.logger=e,this.http=t,P(this,"capabilities",void 0),P(this,"retryTimeout",void 0),P(this,"refreshTimeout",void 0),P(this,"fetchCapabilities",B(function*(){var e=yield n.http.authedRequest(le.Get,"/capabilities");return n.capabilities=e.capabilities,n.capabilities})),P(this,"poll",B(function*(){try{yield n.fetchCapabilities(),n.clearTimeouts(),n.refreshTimeout=setTimeout(n.poll,u1e),n.logger.debug("Fetched new server capabilities")}catch(t){n.clearTimeouts();var e=Math.floor(d1e+5e3*Math.random());n.retryTimeout=setTimeout(n.poll,e),n.logger.warn("Failed to refresh capabilities: retrying in ".concat(e,"ms"),t)}}))}start(){this.poll().then()}stop(){this.clearTimeouts()}getCachedCapabilities(){return this.capabilities}clearTimeouts(){this.refreshTimeout&&(clearInterval(this.refreshTimeout),this.refreshTimeout=void 0),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}}function u$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S0(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var yJ="10",f1e=["1","2","3","4","5","6","7","8","9","10"],h1e=30,zt=function(e){return e.Highlight="highlight",e.Total="total",e}({}),xe=function(e){return e.MyMembership="Room.myMembership",e.Tags="Room.tags",e.AccountData="Room.accountData",e.Receipt="Room.receipt",e.Name="Room.name",e.Redaction="Room.redaction",e.RedactionCancelled="Room.redactionCancelled",e.LocalEchoUpdated="Room.localEchoUpdated",e.Timeline="Room.timeline",e.TimelineReset="Room.timelineReset",e.TimelineRefresh="Room.TimelineRefresh",e.OldStateUpdated="Room.OldStateUpdated",e.CurrentStateUpdated="Room.CurrentStateUpdated",e.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",e.UnreadNotifications="Room.UnreadNotifications",e.Summary="Room.Summary",e}({});let $3=class extends cJ{constructor(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),r=this,this.roomId=e,this.client=t,this.myUserId=n,this.opts=i,P(this,"reEmitter",void 0),P(this,"txnToEvent",new Map),P(this,"notificationCounts",{}),P(this,"bumpStamp",void 0),P(this,"threadNotifications",new Map),P(this,"cachedThreadReadReceipts",new Map),P(this,"oldestThreadedReceiptTs",1/0),P(this,"unthreadedReceipts",new Map),P(this,"timelineSets",void 0),P(this,"polls",new Map),P(this,"threadsTimelineSets",[]),P(this,"filteredTimelineSets",{}),P(this,"timelineNeedsRefresh",!1),P(this,"pendingEventList",void 0),P(this,"blacklistUnverifiedDevices",void 0),P(this,"selfMembership",void 0),P(this,"heroes",null),P(this,"getTypeWarning",!1),P(this,"membersPromise",void 0),P(this,"name",void 0),P(this,"normalizedName",void 0),P(this,"tags",{}),P(this,"accountData",new Map),P(this,"summary",null),P(this,"oldState",void 0),P(this,"currentState",void 0),P(this,"relations",void 0),P(this,"threads",new Map),P(this,"visibilityEvents",new Map),P(this,"roomReceipts",new Bve(this)),P(this,"threadTimelineSetsPromise",null),P(this,"threadsReady",!1),P(this,"updateThreadRootEvents",(e,t,n)=>{var r,i;e.length&&(this.updateThreadRootEvent(null===(r=this.threadsTimelineSets)||void 0===r?void 0:r[0],e,t,n),e.hasCurrentUserParticipated&&this.updateThreadRootEvent(null===(i=this.threadsTimelineSets)||void 0===i?void 0:i[1],e,t,n))}),P(this,"updateThreadRootEvent",(e,t,n,r)=>{e&&t.rootEvent&&(r&&e.removeEvent(t.id),Mn.hasServerSideSupport?e.addLiveEvent(t.rootEvent,{duplicateStrategy:vy.Replace,fromCache:!1,roomState:this.currentState,addToState:!1}):e.addEventToTimeline(t.rootEvent,e.getLiveTimeline(),{toStartOfTimeline:n,addToState:!1}))}),P(this,"tryApplyRedaction",e=>{if(e.isRedaction()){var t=e.event.redacts,n=t?this.findEventById(t):void 0;n&&this.applyEventAsRedaction(e,n)}else if(e.getType()===ee.RoomMember){var r=e.getContent().membership;if(r!==Ve.Ban&&(r!==Ve.Leave||e.getStateKey()===e.getSender()))return;if(!0!==e.getContent()["org.matrix.msc4293.redact_events"])return;if(!this.getLiveTimeline().getState(gt.Forward).maySendRedactionForEvent(e,e.getSender()))return;var i=this.getTimelineSets().map(e=>e.getTimelines()).reduce((e,t)=>(e.push(...t),e),[]).map(t=>t.getEvents().filter(t=>t.getSender()===e.getStateKey())).reduce((e,t)=>(e.push(...t),t),[]);for(var o of i)this.applyEventAsRedaction(e,o)}}),this.setMaxListeners(100),this.reEmitter=new Mv(this),i.pendingEventOrdering=i.pendingEventOrdering||Qg.Chronological,this.name=e,this.normalizedName=e,this.relations=new KX(this.client,this),this.on(xe.Receipt,this.onReceipt),this.timelineSets=[new ng(this,i)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[xe.Timeline,xe.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===Qg.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then(e=>{var n,i=this.client.getEventMapper({toDevice:!1,decrypt:!1});e.forEach((n=B(function*(e){var n=i(e);yield t.decryptEventIfNeeded(n),n.setStatus(ot.NOT_SENT),r.addPendingEvent(n,n.getTxnId())}),function(e){return n.apply(this,arguments)}))})),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}createThreadsTimelineSets(){var e=this;return B(function*(){var t;if(e.threadTimelineSetsPromise)return e.threadTimelineSetsPromise;if(null!==(t=e.client)&&void 0!==t&&t.supportsThreads())try{e.threadTimelineSetsPromise=Promise.all([e.createThreadTimelineSet(),e.createThreadTimelineSet(Ua.My)]);var n=yield e.threadTimelineSetsPromise;return e.threadsTimelineSets[0]=n[0],e.threadsTimelineSets[1]=n[1],n}catch{return e.threadTimelineSetsPromise=null,null}return null})()}decryptCriticalEvents(){var e=this;return B(function*(){if(e.client.getCrypto()){var t=e.getEventReadUpTo(e.client.getUserId(),!0),n=e.getLiveTimeline().getEvents(),r=n.findIndex(e=>e.event.event_id===t),i=n.slice(r).reverse().map(t=>e.client.decryptEventIfNeeded(t));yield Promise.allSettled(i)}})()}decryptAllEvents(){var e=this;return B(function*(){if(e.client.getCrypto()){var t=e.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map(t=>e.client.decryptEventIfNeeded(t));yield Promise.allSettled(t)}})()}getCreator(){var e,t=this.currentState.getStateEvents(ee.RoomCreate,"");return null!==(e=null==t?void 0:t.getSender())&&void 0!==e?e:null}getVersion(){return this.currentState.getRoomVersion()}getRecommendedVersion(){var e=this;return B(function*(){var t={};try{t=yield e.client.getCapabilities()}catch{}var n=t["m.room_versions"];if(!n)for(var r of(n={default:yJ,available:{}},f1e))n.available[r]=gJ.Stable;var i=e.checkVersionAgainstCapability(n);if(i.urgent&&i.needsUpgrade){M.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");try{t=yield e.client.fetchCapabilities()}catch(e){M.warn("Failed to refresh room version capabilities",e)}if(!(n=t["m.room_versions"]))return M.warn("No room version capability - assuming upgrade required."),i;i=e.checkVersionAgainstCapability(n)}return i})()}checkVersionAgainstCapability(e){var t=this.getVersion();M.log("[".concat(this.roomId,"] Current version: ").concat(t)),M.log("[".concat(this.roomId,"] Version capability: "),e);var n={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter(t=>"stable"===e.available[t]).includes(t)||(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?M.warn("URGENT upgrade required on ".concat(this.roomId)):M.warn("Non-urgent upgrade required on ".concat(this.roomId))),n}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(ee.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);var t=qw(this.pendingEventList,function(t){return t.getId()==e},!1);return this.savePendingEvents(),t}hasPendingEvent(e){var t,n;return null!==(t=null===(n=this.pendingEventList)||void 0===n?void 0:n.some(t=>t.getId()===e))&&void 0!==t&&t}getPendingEvent(e){var t,n;return null!==(t=null===(n=this.pendingEventList)||void 0===n?void 0:n.find(t=>t.getId()===e))&&void 0!==t?t:null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}get timeline(){return this.getLiveTimeline().getEvents()}getLastActiveTimestamp(){var e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER}getLastLiveEvent(){var e,t,n=this.getLiveTimeline().getEvents(),r=n[n.length-1],i=this.getLastThread();if(!i)return r;var o=i.events[i.events.length-1];return(null!==(e=null==r?void 0:r.getTs())&&void 0!==e?e:0)>(null!==(t=null==o?void 0:o.getTs())&&void 0!==t?t:0)?r:o}getLastThread(){return this.getThreads().reduce((e,t)=>{var n,r;if(!e)return t;var i=t.events[t.events.length-1],o=e.events[e.events.length-1];return(null!==(n=null==i?void 0:i.getTs())&&void 0!==n?n:0)>=(null!==(r=null==o?void 0:o.getTs())&&void 0!==r?r:0)?t:e},void 0)}getMyMembership(){var e;return null!==(e=this.selfMembership)&&void 0!==e?e:Ve.Leave}getDMInviter(){var e,t=this.getMember(this.myUserId);if(t)return t.getDMInviter();if(this.selfMembership===Ve.Invite&&2===this.getInvitedAndJoinedMemberCount())return null===(e=this.heroes)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.userId}guessDMUserId(){var e=this.getMember(this.myUserId);if(e){var t=e.getDMInviter();if(t)return t}if(Array.isArray(this.heroes)&&this.heroes.length)return this.heroes[0].userId;var n=this.currentState.getMembers().find(e=>e.userId!==this.myUserId);return n?n.userId:this.myUserId}getFunctionalMembers(){var e=this.currentState.getStateEvents(DX.name,"");return Array.isArray(null==e?void 0:e.getContent().service_members)?e.getContent().service_members:[]}getAvatarFallbackMember(){var e,t=this.getFunctionalMembers(),n=0;if(this.getMembers().forEach(e=>{"join"!==e.membership&&"invite"!==e.membership||t.includes(e.userId)||n++}),!(n>2)){var r=null===(e=this.heroes)||void 0===e?void 0:e.filter(e=>!t.includes(e.userId)),i=Array.isArray(r)&&r.length;if(i){for(var o of r){if(o.fromMSC4186){var s=new tb(this.roomId,o.userId);return s.setMembershipEvent(new Zi({event_id:"$"+this.roomId+o.userId+(new Date).getTime(),type:ee.RoomMember,state_key:o.userId,content:{displayname:o.displayName,avatar_url:o.avatarUrl}})),s}var a=this.getMember(o.userId);if(a)return a}var l=r.map(e=>this.getMember(e.userId)).find(e=>!!e);if(l)return l}var c=this.getMembers(),u=null==c?void 0:c.filter(e=>!t.includes(e.userId));if(u.length<=2){var d=u.find(e=>e.userId!==this.myUserId);if(d)return d}if(i){var h=r.map(e=>this.client.getUser(e.userId)).find(e=>!!e);if(h){var p=new tb(this.roomId,h.userId);return p.user=h,p}}}}updateMyMembership(e){var t=this.selfMembership;this.selfMembership=e,t!==e&&(e===Ve.Leave&&this.cleanupAfterLeaving(),this.emit(xe.MyMembership,this,e,t))}loadMembersFromServer(){var e=this;return B(function*(){var t=e.client.store.getSyncToken();return(yield e.client.members(e.roomId,void 0,Ve.Leave,t??void 0)).chunk})()}loadMembers(){var e=this;return B(function*(){var t=!1,n=yield e.client.store.getOutOfBandMembers(e.roomId);return(null===n||e.hasEncryptionStateEvent())&&(t=!0,n=yield e.loadMembersFromServer(),M.log("LL: got ".concat(n.length," ")+"members from server for room ".concat(e.roomId))),{memberEvents:n.filter(Ha).map(e.client.getEventMapper()),fromServer:t}})()}membersLoaded(){return!this.opts.lazyLoadMembers||this.currentState.outOfBandMembersReady()}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();var e=this.loadMembers().then(e=>(this.currentState.setOutOfBandMembers(e.memberEvents),e.fromServer)).catch(e=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),e});return e.then(e=>{if(e){var t=this.currentState.getMembers().filter(e=>e.isOutOfBand()).map(e=>{var t;return null===(t=e.events.member)||void 0===t?void 0:t.event});return M.log("LL: telling store to write ".concat(t.length)+" members for room ".concat(this.roomId)),this.client.store.setOutOfBandMembers(this.roomId,t).catch(e=>{M.log("LL: storing OOB room members failed, oh well",e)})}}).catch(e=>{M.error(e)}),this.membersPromise=e,this.membersPromise}clearLoadedMembersIfNeeded(){var e=this;return B(function*(){e.opts.lazyLoadMembers&&e.membersPromise&&(yield e.loadMembersIfNeeded(),yield e.client.store.clearOutOfBandMembers(e.roomId),e.currentState.clearOutOfBandMembers(),e.membersPromise=void 0)})()}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch(e=>{M.error("error after clearing loaded members from "+"room ".concat(this.roomId," after leaving")),M.log(e)})}refreshLiveTimeline(){var e=this;return B(function*(){var t=e.getLiveTimeline(),n=t.getPaginationToken(Me.FORWARDS),r=t.getPaginationToken(Me.BACKWARDS),i=t.getEvents(),o=i[i.length-1];M.log("[refreshLiveTimeline for ".concat(e.roomId,"] at ")+"mostRecentEventInTimeline=".concat(o&&o.getId()," ")+"liveTimelineBefore=".concat(t.toString()," ")+"forwardPaginationToken=".concat(n," ")+"backwardPaginationToken=".concat(r));var s,a=e.getUnfilteredTimelineSet();o?(e.resetLiveTimeline(null,null),e.emit(xe.TimelineRefresh,e,a),s=yield e.client.getEventTimeline(a,o.getId())):s=yield e.client.getLatestTimeline(a);var l=a.getLiveTimeline();!l||null===l.getPaginationToken(gt.Forward)&&null===l.getPaginationToken(gt.Backward)&&0===l.getEvents().length?(M.log("[refreshLiveTimeline for ".concat(e.roomId,"] using our new live timeline")),s.setPaginationToken(n,Me.FORWARDS),a.setLiveTimeline(s),e.fixUpLegacyTimelineFields()):M.log("[refreshLiveTimeline for ".concat(e.roomId,"] `/sync` or some other request beat us to creating a new ")+"live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history."),e.setTimelineNeedsRefresh(!1),e.emit(xe.TimelineRefresh,e,a)})()}resetLiveTimeline(e,t){for(var n of this.timelineSets)n.resetLiveTimeline(e??void 0,t??void 0);for(var r of this.threads.values())r.resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){var e=this.oldState,t=this.currentState;this.oldState=this.getLiveTimeline().getState(Me.BACKWARDS),this.currentState=this.getLiveTimeline().getState(Me.FORWARDS),e!==this.oldState&&this.emit(xe.OldStateUpdated,this,e,this.oldState),t!==this.currentState&&(this.emit(xe.CurrentStateUpdated,this,t,this.currentState),this.reEmitter.stopReEmitting(t,[vt.Events,vt.Members,vt.NewMember,vt.Update,vt.Marker,$n.New,$n.Update,$n.Destroy,$n.LivenessChange]),this.reEmitter.reEmit(this.currentState,[vt.Events,vt.Members,vt.NewMember,vt.Update,vt.Marker,$n.New,$n.Update,$n.Destroy,$n.LivenessChange]))}onReceipt(e){this.hasEncryptionStateEvent()&&this.clearNotificationsOnReceipt(e)}clearNotificationsOnReceipt(e){var t=[],n=!1,r=e.getContent();for(var i of Object.values(r))for(var[o,s]of Object.entries(i))if(CP(o)&&s)for(var[a,l]of Object.entries(s))if(l&&"object"==typeof l){var c=l;a===this.client.getUserId()&&(void 0===c.thread_id?n=!0:"string"==typeof c.thread_id&&t.push(c.thread_id))}for(var u of(n&&(t=this.getThreads().filter(e=>this.getThreadUnreadNotificationCount(e.id,zt.Total)>0||this.getThreadUnreadNotificationCount(e.id,zt.Highlight)>0).map(e=>e.id)).push("main"),t)){var d,h="main"===u?this.getLiveTimeline():null===(d=this.getThread(u))||void 0===d?void 0:d.liveTimeline;if(h){for(var p=h.getEvents(),f=0,m=p.length-1;m>=0;m--){var v;if(m===p.length-20)return;var g=p[m];if(this.hasUserReadEvent(this.client.getUserId(),g.getId()))break;var y=this.client.getPushActionsForEvent(g);f+=null!=y&&null!==(v=y.tweaks)&&void 0!==v&&v.highlight?1:0}"main"===u?this.setUnreadNotificationCount(zt.Highlight,f):this.setThreadUnreadNotificationCount(u,zt.Highlight,f)}else M.warn("Couldn't find timeline for thread ID ".concat(u," in room ").concat(this.roomId))}}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){var t=this.findEventById(e),n=this.findThreadForEvent(t);return n?n.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){var t=this.getUnfilteredTimelineSet().findEventById(e);if(!t)for(var n=this.getThreads(),r=0;r<n.length;r++){if(t=n[r].findEventById(e))return t}return t}getUnreadNotificationCount(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zt.Total,t=this.getRoomUnreadNotificationCount(e);for(var n of this.threadNotifications.values()){var r;t+=null!==(r=n[e])&&void 0!==r?r:0}return t}getUnreadCountForEventContext(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zt.Total,n=arguments.length>1?arguments[1]:void 0;return null!==(e=!!n.threadRootId&&!n.isThreadRoot?this.getThreadUnreadNotificationCount(n.threadRootId,t):this.getRoomUnreadNotificationCount(t))&&void 0!==e?e:0}getRoomUnreadNotificationCount(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zt.Total;return null!==(e=this.notificationCounts[t])&&void 0!==e?e:0}getThreadUnreadNotificationCount(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zt.Total;return null!==(t=null===(n=this.threadNotifications.get(e))||void 0===n?void 0:n[r])&&void 0!==t?t:0}hasThreadUnreadNotification(){for(var e of this.threadNotifications.values()){var t,n;if((null!==(t=e.highlight)&&void 0!==t?t:0)>0||(null!==(n=e.total)&&void 0!==n?n:0)>0)return!0}return!1}setThreadUnreadNotificationCount(e,t,n){var r,i,o=S0({highlight:null===(r=this.threadNotifications.get(e))||void 0===r?void 0:r.highlight,total:null===(i=this.threadNotifications.get(e))||void 0===i?void 0:i.total},{[t]:n});this.threadNotifications.set(e,o),this.emit(xe.UnreadNotifications,o,e)}get threadsAggregateNotificationType(){var e=null;for(var t of this.threadNotifications.values()){var n,r;if((null!==(n=t.highlight)&&void 0!==n?n:0)>0)return zt.Highlight;(null!==(r=t.total)&&void 0!==r?r:0)>0&&!e&&(e=zt.Total)}return e}resetThreadUnreadNotificationCountFromSync(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.hasEncryptionStateEvent();for(var[n,r]of this.threadNotifications)e.includes(n)||(r.total=0,t||(r.highlight=0));this.emit(xe.UnreadNotifications)}setBumpStamp(e){this.bumpStamp=e}getBumpStamp(){return this.bumpStamp}setUnreadNotificationCount(e,t){this.notificationCounts[e]=t,this.emit(xe.UnreadNotifications,this.notificationCounts)}setUnread(e,t){return this.setUnreadNotificationCount(e,t)}setSummary(e){var t,n=null===(t=e["m.heroes"])||void 0===t?void 0:t.map(e=>({userId:e,fromMSC4186:!1})),r=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(r)&&this.currentState.setJoinedMemberCount(r),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(n)&&(this.heroes=n.filter(e=>e.userId!=this.myUserId)),this.emit(xe.Summary,e)}setMSC4186SummaryData(e,t,n){e&&(this.heroes=e.filter(e=>e.user_id!==this.myUserId).map(e=>({userId:e.user_id,displayName:e.displayname,avatarUrl:e.avatar_url,fromMSC4186:!0}))),void 0!==t&&Number.isInteger(t)&&this.currentState.setJoinedMemberCount(t),void 0!==n&&Number.isInteger(n)&&this.currentState.setInvitedMemberCount(n),this.emit(xe.Summary,{"m.heroes":this.heroes?this.heroes.map(e=>e.userId):[],"m.joined_member_count":t,"m.invited_member_count":n})}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return void 0===this.blacklistUnverifiedDevices?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=this.currentState.getStateEvents(ee.RoomAvatar,"");if(!s&&!i)return null;var a=s?s.getContent().url:null;return a?N3(e,a,t,n,r,void 0,void 0,o):null}getMxcAvatarUrl(){var e;return(null===(e=this.currentState.getStateEvents(ee.RoomAvatar,""))||void 0===e||null===(e=e.getContent())||void 0===e?void 0:e.url)||null}getCanonicalAlias(){var e=this.currentState.getStateEvents(ee.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){var e=this.currentState.getStateEvents(ee.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}addEventsToTimeline(e,t,n,r,i){r.getTimelineSet().addEventsToTimeline(e,t,n,r,i)}getThread(e){var t;return null!==(t=this.threads.get(e))&&void 0!==t?t:null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership(Ve.Join)}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter(function(t){return t.membership===e})}getEncryptionTargetMembers(){var e=this;return B(function*(){yield e.loadMembersIfNeeded();var t=e.getMembersWithMembership(Ve.Join);return e.shouldEncryptForInvitedMembers()&&(t=t.concat(e.getMembersWithMembership(Ve.Invite))),t})()}shouldEncryptForInvitedMembers(){var e,t=this.currentState.getStateEvents(ee.RoomHistoryVisibility,"");return"joined"!==(null==t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,t){var n=this.getMember(e);return!!n&&n.membership===t}getOrCreateFilteredTimelineSet(e){var{prepopulateTimeline:t=!0,useSyncEvents:n=!0,pendingEvents:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];var i=Object.assign({filter:e,pendingEvents:r},this.opts),o=new ng(this,i);this.reEmitter.reEmit(o,[xe.Timeline,xe.TimelineReset]),n&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));var s=this.getLiveTimeline();if(t){s.getEvents().forEach(function(e){o.addLiveEvent(e,{addToState:!1})});for(var a=s;a.getNeighbouringTimeline(Me.BACKWARDS);)a=a.getNeighbouringTimeline(Me.BACKWARDS);o.getLiveTimeline().setPaginationToken(a.getPaginationToken(Me.BACKWARDS),Me.BACKWARDS)}else if(n){var l=s.getPaginationToken(gt.Forward);o.getLiveTimeline().setPaginationToken(l,gt.Backward)}return o}getThreadListFilter(){var e=arguments,t=this;return B(function*(){var n=e.length>0&&void 0!==e[0]?e[0]:Ua.All,r=t.client.getUserId(),i=new As(r),o={room:{timeline:{[Sg.name]:[yn.name]}}};n===Ua.My&&(o.room.timeline[_g.name]=[r]),i.setDefinition(o);var s=yield t.client.getOrCreateFilter("THREAD_PANEL_".concat(t.roomId,"_").concat(n),i);return i.filterId=s,i})()}createThreadTimelineSet(e){var t=this;return B(function*(){var n;if(Mn.hasServerSideListSupport)n=new ng(t,S0(S0({},t.opts),{},{pendingEvents:!1}),void 0,void 0,e??Ua.All),t.reEmitter.reEmit(n,[xe.Timeline,xe.TimelineReset]);else if(Mn.hasServerSideSupport){var r=yield t.getThreadListFilter(e);n=t.getOrCreateFilteredTimelineSet(r,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else n=new ng(t,{pendingEvents:!1}),Array.from(t.threads).forEach(r=>{var[,i]=r;if(0!==i.length){var o=i.timeline.some(e=>e.getSender()===t.client.getUserId());(e!==Ua.My||o)&&n.getLiveTimeline().addEvent(i.rootEvent,{toStartOfTimeline:!1,addToState:!1})}});return n})()}processThreadRoots(e,t){if(this.client.supportsThreads())for(var n of e)Me.setEventMetadata(n,this.currentState,t),this.getThread(n.getId())||this.createThread(n.getId(),n,[],t)}fetchRoomThreads(){var e=this;return B(function*(){if(!e.threadsReady&&e.client.supportsThreads()){if(Mn.hasServerSideListSupport)yield Promise.all([e.fetchRoomThreadList(Ua.All),e.fetchRoomThreadList(Ua.My)]);else{var t=yield e.getThreadListFilter(),{chunk:n}=yield e.client.createMessagesRequest(e.roomId,"",Number.MAX_SAFE_INTEGER,gt.Backward,t);if(!n.length)return;var r,i=n.map(e.client.getEventMapper()).sort((e,t)=>{var n=e.getServerAggregatedRelation(yn.name),r=t.getServerAggregatedRelation(yn.name);return n.latest_event.origin_server_ts-r.latest_event.origin_server_ts}),o=e.getLiveTimeline().getState(Me.FORWARDS);for(var s of i){var a,l={duplicateStrategy:vy.Ignore,fromCache:!1,addToState:!1,roomState:o};null===(a=e.threadsTimelineSets[0])||void 0===a||a.addLiveEvent(s,l);var c,u=s.getServerAggregatedRelation(yn.name);if(null!=u&&u.current_user_participated)null===(c=e.threadsTimelineSets[1])||void 0===c||c.addLiveEvent(s,l),r=s}e.processThreadRoots(i,!0),e.client.decryptEventIfNeeded(i[i.length-1]),r&&e.client.decryptEventIfNeeded(r)}e.on(as.NewReply,e.onThreadReply),e.on(as.Update,e.onThreadUpdate),e.on(as.Delete,e.onThreadDelete),e.threadsReady=!0}})()}processPollEvents(e){var t=this;return B(function*(){for(var n of e)try{if(!n.isEncrypted()&&!uJ(n))continue;yield t.client.decryptEventIfNeeded(n),t.processPollEvent(n)}catch(e){M.warn("Error processing poll event",n.getId(),e)}})()}processPollEvent(e){var t=this;return B(function*(){if(e.isDecryptionFailure())e.once(qt.Decrypted,e=>{t.processPollEvent(e)});else if(Ys.M_POLL_START.matches(e.getType()))try{var n=new lJ(e,t.client,t);t.polls.set(e.getId(),n),t.emit(Pd.New,n),e.once(qt.BeforeRedaction,e=>{t.polls.delete(e.getId())})}catch{}else{var r=e.relationEventId;if(r&&t.polls.has(r)){var i=t.polls.get(r);null==i||i.onNewRelation(e)}}})()}fetchRoomThreadList(e){var t=this;return B(function*(){if(t.client.supportsThreads()&&0!==t.threadsTimelineSets.length){var n=e===Ua.My?t.threadsTimelineSets[1]:t.threadsTimelineSets[0],{chunk:r,end:i}=yield t.client.createThreadListMessagesRequest(t.roomId,null,void 0,gt.Backward,n.threadListType,n.getFilter());if(n.getLiveTimeline().setPaginationToken(i??null,gt.Backward),r.length){var o=r.map(t.client.getEventMapper());t.processThreadRoots(o,!0);var s=t.getLiveTimeline().getState(Me.FORWARDS);for(var a of o)n.addLiveEvent(a,{duplicateStrategy:vy.Replace,fromCache:!1,roomState:s,addToState:!1})}}})()}onThreadUpdate(e){this.updateThreadRootEvents(e,!1,!1)}onThreadReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var t;this.threads.delete(e.id);var n=this.getTimelineForEvent(e.id),r=null==n||null===(t=n.getEvents())||void 0===t?void 0:t.find(t=>t.getId()===e.id);for(var i of(r?e.clearEventMetadata(r):M.debug("onThreadDelete: Could not find root event in room timeline"),this.threadsTimelineSets))i.removeEvent(e.id)}removeFilteredTimelineSet(e){var t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];var n=this.timelineSets.indexOf(t);n>-1&&this.timelineSets.splice(n,1)}eventShouldLiveIn(e,t,n){var r;if(null===(r=this.client)||void 0===r||!r.supportsThreads())return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||null!=n&&n.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};var i,o,s=e.isRelation(yn.name),a=e.getAssociatedId(),l=e.threadRootId;if(a&&!s&&(l===a||null!=n&&n.has(a)))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};a&&(i=null!==(o=this.findEventById(a))&&void 0!==o?o:null==t?void 0:t.find(e=>e.getId()===a));return i&&!s?this.eventShouldLiveIn(i,t,n):null!=l?{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:l}:!a||e.replyEventId?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:{shouldLiveInRoom:!1,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;var{threadId:t}=this.eventShouldLiveIn(e);return t?this.getThread(t):null}addThreadedEvents(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.getThread(e);if(r)r.addEvents(t,n);else{var i,o=null!==(i=this.findEventById(e))&&void 0!==i?i:t.find(t=>t.getId()===e);this.createThread(e,o,t,n)}}processThreadedEvents(e,t){e.forEach(this.tryApplyRedaction);var n={};for(var r of e){var i,{threadId:o,shouldLiveInThread:s}=this.eventShouldLiveIn(r);s&&!n[o]&&(n[o]=[]),null===(i=n[o])||void 0===i||i.push(r)}Object.entries(n).map(e=>{var[n,r]=e;return this.addThreadedEvents(n,r,t)})}createThread(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0;if(this.threads.has(e))return this.threads.get(e);if(t){var o=this.relations.getAllChildEventsForEvent(t.getId());null!=o&&o.length&&(r=r.concat(o.filter(e=>!e.isRelation(kn.Replace))))}var s=new Mn(e,t,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:null!==(n=this.cachedThreadReadReceipts.get(e))&&void 0!==n?n:[]});return this.reEmitter.reEmit(s,[as.Delete,as.Update,as.NewReply,xe.Timeline,xe.TimelineReset]),this.cachedThreadReadReceipts.delete(e),this.threads.set(s.id,s),s.addEvents(r,!1),this.threadsReady&&s.initialEventsFetched&&this.updateThreadRootEvents(s,i,!1),this.emit(as.New,s,i),s}applyEventAsRedaction(e,t){var n=t.threadRootId;if(t.makeRedacted(e,this),t.isState()){var r=this.currentState.getStateEvents(t.getType(),t.getStateKey());(null==r?void 0:r.getId())===t.getId()&&this.currentState.setStateEvents([t])}this.emit(xe.Redaction,e,this,n),this.visibilityEvents.delete(t.getId()),t.isVisibilityEvent()&&this.redactVisibilityChangeEvent(e)}processLiveEvent(e){if(this.tryApplyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e),!e.getUnsigned().transaction_id&&e.getSender()===this.myUserId)for(var[t,n]of this.txnToEvent)if(n.getId()===e.getId()){M.debug("processLiveEvent: found sent event without txn ID: ",t,e.getId());var r=e.getUnsigned();r.transaction_id=t,e.setUnsigned(r);break}}addLiveEvent(e,t){var{duplicateStrategy:n,timelineWasEmpty:r,fromCache:i,addToState:o}=t;for(var s of this.timelineSets)s.addLiveEvent(e,{duplicateStrategy:n,fromCache:i,timelineWasEmpty:r,addToState:o});e.sender&&e.getType()!==ee.RoomRedaction&&this.addReceipt(aJ(e.sender.userId,e,os.Read),!0)}addPendingEvent(e,t){if(e.status!==ot.SENDING&&e.status!==ot.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent.get(t))throw new Error("addPendingEvent called on an event with known txnId "+t);if(Me.setEventMetadata(e,this.getLiveTimeline().getState(Me.FORWARDS),!1),this.txnToEvent.set(t,e),this.pendingEventList){if(this.pendingEventList.some(e=>e.status===ot.NOT_SENT)&&(M.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(ot.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var n=e.event.redacts,r=this.pendingEventList.find(e=>e.getId()===n);!r&&n&&(r=this.findEventById(n)),r&&(r.markLocallyRedacted(e),this.emit(xe.Redaction,e,this,r.threadRootId))}}else for(var i of this.timelineSets)i.getFilter()?i.getFilter().filterRoomTimeline([e]).length&&i.addEventToTimeline(e,i.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1}):i.addEventToTimeline(e,i.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1});this.emit(xe.LocalEchoUpdated,e,this)}savePendingEvents(){if(this.pendingEventList){var e=this.pendingEventList.map(e=>S0(S0({},e.event),{},{txn_id:e.getTxnId()})).filter(e=>{var t=e.type===ee.RoomMessageEncrypted,n=this.hasEncryptionStateEvent();return t||!n});this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent.get(e)}handleRemoteEcho(e,t){var n=t.getId(),r=e.getId(),i=t.status;M.debug("Got remote echo for event ".concat(n," -> ").concat(r," old status ").concat(i)),this.txnToEvent.delete(e.getUnsigned().transaction_id),this.pendingEventList&&this.removePendingEvent(n),t.handleRemoteEcho(e.event);var{shouldLiveInRoom:o,threadId:s}=this.eventShouldLiveIn(e),a=s?this.getThread(s):null;if(null==a||a.setEventMetadata(t),null==a||a.timelineSet.handleRemoteEcho(t,n,r),o)for(var l of this.timelineSets)l.handleRemoteEcho(t,n,r);this.emit(xe.LocalEchoUpdated,t,this,n,i)}updatePendingEvent(e,t,n){if(M.log("setting pendingEvent status to ".concat(t," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(n)),t==ot.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==ot.SENT&&this.getTimelineForEvent(n)){var r=this.findEventById(n);if(!(null==r?void 0:r.getUnsigned().transaction_id)&&r){var i=r.getUnsigned();i.transaction_id=e.getTxnId(),r.setUnsigned(i),this.removeEvent(r.getId()),this.handleRemoteEcho(r,e)}return}var o=e.status,s=e.getId();if(!o)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var a=p1e[o];if(null==a||!a.includes(t))throw new Error("Invalid EventStatus transition ".concat(o,"->").concat(t));if(e.setStatus(t),t==ot.SENT){e.replaceLocalEventId(n);var{shouldLiveInRoom:l,threadId:c}=this.eventShouldLiveIn(e),u=c?this.getThread(c):void 0;if(null==u||u.setEventMetadata(e),null==u||u.timelineSet.replaceEventId(s,n),l)for(var d of this.timelineSets)d.replaceEventId(s,n)}else if(t==ot.CANCELLED){if(this.pendingEventList){var h=this.getPendingEvent(s);this.removePendingEvent(s),null!=h&&h.isRedaction()&&this.revertRedactionLocalEcho(h)}this.removeEvent(s)}this.savePendingEvents(),this.emit(xe.LocalEchoUpdated,e,this,s,o)}revertRedactionLocalEcho(e){var t=e.event.redacts;if(t){var n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit(xe.RedactionCancelled,e,this),n.isRelation()&&this.aggregateNonLiveRelation(n))}}assertTimelineSetsAreLive(){for(var e=0;e<this.timelineSets.length;e++){var t=this.timelineSets[e].getLiveTimeline();if(t.getPaginationToken(Me.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+t.getPaginationToken(Me.FORWARDS)+")");if(t.getNeighbouringTimeline(Me.FORWARDS))throw new Error("live timeline ".concat(e," is no longer live - it has a neighbouring timeline"))}}addLiveEvents(e,t){var n=this;return B(function*(){var{duplicateStrategy:r,fromCache:i,timelineWasEmpty:o=!1,addToState:s}=t;if(r&&-1===["replace","ignore"].indexOf(r))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");n.assertTimelineSetsAreLive();var a=n.findThreadRoots(e),l={},c={duplicateStrategy:r,fromCache:i,timelineWasEmpty:o,addToState:s},u=[...e];for(var d of e){var h;if(n.processLiveEvent(d),d.getUnsigned().transaction_id){var p=n.txnToEvent.get(d.getUnsigned().transaction_id);if(p){n.handleRemoteEcho(d,p);continue}}var{shouldLiveInRoom:f,shouldLiveInThread:m,threadId:v=""}=n.eventShouldLiveIn(d,u,a);if(!m&&!f&&d.isRelation())try{var g=new Zi(yield n.client.fetchRoomEvent(n.roomId,d.relationEventId));if(u.push(g),g.threadRootId){a.add(g.threadRootId);var y=d.getUnsigned();y[Yw.name]=g.threadRootId,d.setUnsigned(y)}({shouldLiveInRoom:f,shouldLiveInThread:m,threadId:v=""}=n.eventShouldLiveIn(d,u,a))}catch(e){M.error("Failed to load parent event of unhandled relation",e)}m&&!l[v]&&(l[v]=[]),null===(h=l[v])||void 0===h||h.push(d),f?n.addLiveEvent(d,c):!m&&d.isRelation()&&n.relations.aggregateChildEvent(d)}Object.entries(l).forEach(e=>{var[t,r]=e;n.addThreadedEvents(t,r,!1)})})()}partitionThreadedEvents(e){if(this.client.supportsThreads()){var t=this.findThreadRoots(e);return e.reduce((n,r)=>{var{shouldLiveInRoom:i,shouldLiveInThread:o,threadId:s}=this.eventShouldLiveIn(r,e,t);return i&&n[0].push(r),o&&(r.setThreadId(s??""),n[1].push(r)),!o&&!i&&n[2].push(r),n},[[],[],[]])}return[e,[],[]]}findThreadRoots(e){var t=new Set;for(var n of e){var r=n.threadRootId;null!=r&&t.add(r)}return t}addReceipt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getContent();this.roomReceipts.add(n,t),Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(r=>{Object.keys(n[e][r]).forEach(i=>{var o,s,a,l,c=n[e][r][i],u=!c.thread_id||c.thread_id===r_,d=u?this:this.threads.get(null!==(o=c.thread_id)&&void 0!==o?o:"");if(d){if(d.addReceiptToStructure(e,r,i,c,t),!t&&this.client.isInitialSyncComplete()&&i===this.client.getUserId()){var h=d.timeline[d.timeline.length-1];h&&e===h.getId()&&i===h.getSender()&&(d.setUnread(zt.Total,0),d.setUnread(zt.Highlight,0))}}else this.cachedThreadReadReceipts.set(c.thread_id,[...null!==(l=this.cachedThreadReadReceipts.get(c.thread_id))&&void 0!==l?l:[],{eventId:e,receiptType:r,userId:i,receipt:c,synthetic:t}]);i===this.client.getUserId()&&!u&&c.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=c.ts),!c.thread_id&&c.ts>(null!==(s=null===(a=this.unthreadedReceipts.get(i))||void 0===a?void 0:a.ts)&&void 0!==s?s:0)&&this.unthreadedReceipts.set(i,c)})})}),this.emit(xe.Receipt,e,this)}addEphemeralEvents(e){for(var t of e)t.getType()===ee.Typing?this.currentState.setTypingEvent(t):t.getType()===ee.Receipt&&this.addReceipt(t)}removeEvents(e){for(var t of e)this.removeEvent(t)}removeEvent(e){var t=!1;for(var n of this.timelineSets){var r=n.removeEvent(e);r&&(r.isRedaction()&&this.revertRedactionLocalEcho(r),t=!0)}return t}recalculate(){var e=this.currentState.getStateEvents(ee.RoomMember,this.myUserId);if(e){var t=e.getContent().membership;if(this.updateMyMembership(t),t===Ve.Invite)(e.getUnsigned().invite_room_state||[]).forEach(e=>{this.currentState.getStateEvents(e.type,e.state_key)||this.currentState.setStateEvents([new Zi({type:e.type,state_key:e.state_key,content:e.content,event_id:"$fake"+Date.now(),room_id:this.roomId,sender:this.myUserId})])})}var n=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=Jge(this.name),this.summary=new zX(this.roomId,{title:this.name}),n!==this.name&&this.emit(xe.Name,this)}addTags(e){this.tags=e.getContent().tags||{},this.emit(xe.Tags,e,this)}addAccountData(e){for(var t of e){"m.tag"===t.getType()&&this.addTags(t);var n=t.getType(),r=this.accountData.get(n);this.accountData.set(n,t),this.emit(xe.AccountData,t,this,r)}}getAccountData(e){return this.accountData.get(e)}maySendMessage(){return this.getMyMembership()===Ve.Join&&(this.hasEncryptionStateEvent()?this.currentState.maySendEvent(ee.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(ee.RoomMessage,this.myUserId))}canInvite(e){var t=this.getMyMembership()===Ve.Join,n=this.currentState.getStateEvents(ee.RoomPowerLevels,""),r=n&&n.getContent(),i=this.getMember(e);return r&&i&&r.invite>i.powerLevel&&(t=!1),t}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){var e=this.currentState.getStateEvents(ee.RoomCreate,"");if(e)return e.getContent()[Ww];this.getTypeWarning||(M.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}isSpaceRoom(){return this.getType()===gg.Space}isCallRoom(){return this.getType()===gg.UnstableCall}isElementVideoRoom(){return this.getType()===gg.ElementVideo}findPredecessor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getLiveTimeline().getState(Me.FORWARDS);return t?t.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){var t=this.client.roomNameGenerator(this.roomId,e);if(null!==t)return t}switch(e.type){case xc.Actual:return e.name;case xc.Generated:return"Inviting"===e.subtype?"Inviting ".concat(d$(e.names,e.count)):d$(e.names,e.count);case xc.EmptyRoom:return e.oldName?"Empty room (was ".concat(e.oldName,")"):"Empty room"}}calculateRoomName(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){var t=this.currentState.getStateEvents(ee.RoomName,"");if(null!=t&&t.getContent().name)return this.roomNameGenerator({type:xc.Actual,name:t.getContent().name})}var n=this.getCanonicalAlias();if(n)return this.roomNameGenerator({type:xc.Actual,name:n});var r=this.currentState.getJoinedMemberCount()+this.currentState.getInvitedMemberCount()-1,i=this.getFunctionalMembers(),o=[];if(this.heroes)this.heroes.forEach(e=>{if(i.includes(e.userId))r--;else if(e.displayName)o.push(e.displayName);else{var t=this.getMember(e.userId);o.push(t?t.name:e.userId)}});else{var s=this.currentState.getMembers().filter(t=>t.userId!==e&&(t.membership===Ve.Invite||t.membership===Ve.Join));s=s.filter(e=>{var{userId:t}=e;return!i.includes(t)||(r--,!1)});var a=new Intl.Collator;s.sort((e,t)=>a.compare(e.userId,t.userId)),s=s.slice(0,5),o=s.map(e=>e.name)}if(r)return this.roomNameGenerator({type:xc.Generated,names:o,count:r});if(this.getMyMembership()==Ve.Join){var l=this.currentState.getStateEvents(ee.RoomThirdPartyInvite);if(null!=l&&l.length){var c=l.map(e=>e.getContent().display_name);return this.roomNameGenerator({type:xc.Generated,subtype:"Inviting",names:c,count:c.length+1})}}var u,d=o;return d.length||(d=this.currentState.getMembers().filter(t=>t.userId!==e&&t.membership!==Ve.Invite&&t.membership!==Ve.Join).map(e=>e.name)),d.length&&(u=this.roomNameGenerator({type:xc.Generated,names:d,count:d.length+1})),this.roomNameGenerator({type:xc.EmptyRoom,oldName:u})}applyNewVisibilityEvent(e){var t=e.asVisibilityChange();if(t){var n=e.getSender();if(n)if(Ah.name&&this.currentState.maySendStateEvent(Ah.name,n)||Ah.altName&&this.currentState.maySendStateEvent(Ah.altName,n)){var r=this.visibilityEvents.get(t.eventId);if(r){for(var i=r.length-1,o=Math.max(0,r.length-h1e);i>=o;--i){if(r[i].getTs()<e.getTs())break}-1===i?r.unshift(e):r.splice(i+1,0,e)}else this.visibilityEvents.set(t.eventId,[e]);var s=this.findEventById(t.eventId);s&&s.applyVisibilityEvent(t)}}}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");var t=e.getRelation(),n=null==t?void 0:t.event_id,r=this.visibilityEvents.get(n);if(r){var i=r.findIndex(t=>t.getId()===e.getId());if(-1!==i&&(r.splice(i,1),i===r.length)){var o=this.findEventById(n);if(!o)return;if(0===i)this.visibilityEvents.delete(n),o.applyVisibilityEvent();else{var s=r[r.length-1].asVisibilityChange();if(!s)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(s)}}}}applyPendingVisibilityEvents(e){var t=this.visibilityEvents.get(e.getId());if(t&&0!=t.length){var n=t[t.length-1],r=n.asVisibilityChange();r&&(r.visible,!(n.getTs()<e.getTs())&&e.applyVisibilityEvent(r))}}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}hasUserReadEvent(e,t){return this.roomReceipts.hasUserReadEvent(e,t)}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}fixupNotifications(e){super.fixupNotifications(e);var t=this.getThreads().filter(e=>this.getThreadUnreadNotificationCount(e.id,zt.Total)>0);for(var n of t)n.fixupNotifications(e)}compareEventOrdering(e,t){return Wve(this,e,t)}hasEncryptionStateEvent(){var e;return!(null===(e=this.getLiveTimeline().getState(Me.FORWARDS))||void 0===e||!e.getStateEvents(ee.RoomEncryption,""))}};var p1e={[ot.ENCRYPTING]:[ot.SENDING,ot.NOT_SENT,ot.CANCELLED],[ot.SENDING]:[ot.ENCRYPTING,ot.QUEUED,ot.NOT_SENT,ot.SENT],[ot.QUEUED]:[ot.SENDING,ot.NOT_SENT,ot.CANCELLED],[ot.SENT]:[],[ot.NOT_SENT]:[ot.SENDING,ot.QUEUED,ot.CANCELLED],[ot.CANCELLED]:[]},xc=function(e){return e[e.EmptyRoom=0]="EmptyRoom",e[e.Generated=1]="Generated",e[e.Actual=2]="Actual",e}({});function d$(e,t){var n=t-1;return e.length?1===e.length&&n<=1?e[0]:2===e.length&&n<=2?"".concat(e[0]," and ").concat(e[1]):n>1?"".concat(e[0]," and ").concat(n," others"):"".concat(e[0]," and 1 other"):"Empty room"}var Yr=function(e){return e[e.Stable=0]="Stable",e[e.Unstable=1]="Unstable",e[e.Unsupported=2]="Unsupported",e}({}),Xr=function(e){return e.Thread="Thread",e.ThreadUnreadNotifications="ThreadUnreadNotifications",e.LoginTokenRequest="LoginTokenRequest",e.RelationBasedRedactions="RelationBasedRedactions",e.AccountDataDeletion="AccountDataDeletion",e.RelationsRecursion="RelationsRecursion",e.IntentionalMentions="IntentionalMentions",e}({}),m1e={[Xr.Thread]:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},[Xr.ThreadUnreadNotifications]:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},[Xr.LoginTokenRequest]:{unstablePrefixes:["org.matrix.msc3882"]},[Xr.RelationBasedRedactions]:{unstablePrefixes:["org.matrix.msc3912"]},[Xr.AccountDataDeletion]:{unstablePrefixes:["org.matrix.msc3391"]},[Xr.RelationsRecursion]:{unstablePrefixes:["org.matrix.msc3981"],matrixVersion:"v1.10"},[Xr.IntentionalMentions]:{unstablePrefixes:["org.matrix.msc3952_intentional_mentions"],matrixVersion:"v1.7"}};function g1e(e){return G5.apply(this,arguments)}function G5(){return(G5=B(function*(e){var t=new Map;for(var[n,r]of Object.entries(m1e)){var i,o,s,a,l=null!==(i=null===(o=e.versions)||void 0===o?void 0:o.includes(r.matrixVersion||""))&&void 0!==i&&i,c=null!==(s=null===(a=r.unstablePrefixes)||void 0===a?void 0:a.every(t=>{var n;return!0===(null===(n=e.unstable_features)||void 0===n?void 0:n[t])}))&&void 0!==s&&s;l?t.set(n,Yr.Stable):c?t.set(n,Yr.Unstable):t.set(n,Yr.Unsupported)}return t})).apply(this,arguments)}function f$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Zw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h$=8e4,v1e=3,Vt=function(e){return e.Error="ERROR",e.Prepared="PREPARED",e.Stopped="STOPPED",e.Syncing="SYNCING",e.Catchup="CATCHUP",e.Reconnecting="RECONNECTING",e}({}),y1e=["org.matrix.msc2716v3"];function p$(e,t){return"FILTER_SYNC_".concat(e)+(t?"_"+t:"")}var bJ=function(e){return e.Offline="offline",e.Online="online",e.Unavailable="unavailable",e}({});function _J(e){return Zw({initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:3e4,pendingEventOrdering:Qg.Chronological,threadSupport:!1},e)}function SJ(e){return Zw({canResetEntireTimeline:e=>!1},e)}class Hd{constructor(e,t,n){var r=this;this.client=e,P(this,"opts",void 0),P(this,"syncOpts",void 0),P(this,"_peekRoom",null),P(this,"currentSyncRequest",void 0),P(this,"abortController",void 0),P(this,"syncState",null),P(this,"syncStateData",void 0),P(this,"catchingUp",!1),P(this,"running",!1),P(this,"keepAliveTimer",void 0),P(this,"connectionReturnedResolvers",void 0),P(this,"notifEvents",[]),P(this,"failedSyncCount",0),P(this,"storeIsInvalid",!1),P(this,"presence",void 0),P(this,"getPushRules",B(function*(){try{r.syncOpts.logger.debug("Getting push rules...");var e=yield r.client.getPushRules();r.syncOpts.logger.debug("Got push rules"),r.client.pushRules=e}catch(e){return r.syncOpts.logger.error("Getting push rules failed",e),r.shouldAbortSync(e)?void 0:(r.syncOpts.logger.debug("Waiting for saved sync before retrying push rules..."),yield r.recoverFromSyncStartupError(r.savedSyncPromise,e),r.getPushRules())}})),P(this,"buildDefaultFilter",()=>{var e=new As(this.client.credentials.userId);return this.client.canSupport.get(Xr.ThreadUnreadNotifications)!==Yr.Unsupported&&e.setUnreadThreadNotifications(!0),e}),P(this,"prepareLazyLoadingForSync",B(function*(){r.syncOpts.logger.debug("Prepare lazy loading for sync..."),r.client.isGuest()&&(r.opts.lazyLoadMembers=!1),r.opts.lazyLoadMembers&&(r.syncOpts.logger.debug("Enabling lazy load on sync filter..."),r.opts.filter||(r.opts.filter=r.buildDefaultFilter()),r.opts.filter.setLazyLoadMembers(!0))})),P(this,"storeClientOptions",B(function*(){try{r.syncOpts.logger.debug("Storing client options..."),yield r.client.storeClientOptions(),r.syncOpts.logger.debug("Stored client options")}catch(e){throw r.syncOpts.logger.error("Storing client options failed",e),e}})),P(this,"getFilter",B(function*(){var e,t;r.syncOpts.logger.debug("Getting filter..."),e=r.opts.filter?r.opts.filter:r.buildDefaultFilter();try{t=yield r.client.getOrCreateFilter(p$(r.client.credentials.userId),e)}catch(e){return r.syncOpts.logger.error("Getting filter failed",e),r.shouldAbortSync(e)?{}:(r.syncOpts.logger.debug("Waiting for saved sync before retrying filter..."),yield r.recoverFromSyncStartupError(r.savedSyncPromise,e),r.getFilter())}return{filter:e,filterId:t}})),P(this,"savedSyncPromise",void 0),P(this,"onOnline",()=>{this.syncOpts.logger.debug("Browser thinks we are back online"),this.startKeepAlives(0)}),this.opts=_J(t),this.syncOpts=SJ(n),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[xe.Timeline,xe.TimelineReset])}createRoom(e){var t=EJ(this.client,e,this.opts);return t.on(vt.Marker,(e,n)=>{this.onMarkerStateEvent(t,e,n)}),t}onMarkerStateEvent(e,t){var{timelineWasEmpty:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n?this.syncOpts.logger.debug("MarkerState: Ignoring markerEventId=".concat(t.getId()," in roomId=").concat(e.roomId," ")+"because the timeline was empty before the marker arrived which means there is nothing to refresh."):y1e.includes(e.getVersion())||t.getSender()===e.getCreator()?(this.syncOpts.logger.debug("MarkerState: Timeline needs to be refreshed because "+"a new markerEventId=".concat(t.getId()," was sent in roomId=").concat(e.roomId)),e.setTimelineNeedsRefresh(!0),e.emit(xe.HistoryImportedWithinTimeline,t,e)):this.syncOpts.logger.debug("MarkerState: Ignoring markerEventId=".concat(t.getId()," in roomId=").concat(e.roomId," because ")+"MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.")}syncLeftRooms(){var e=this;return B(function*(){var t,n=e.client,r=new As(e.client.credentials.userId);r.setTimelineLimit(1),r.setIncludeLeaveRooms(!0);var i=e.opts.pollTimeout+h$,o={timeout:0,filter:yield n.getOrCreateFilter(p$(n.credentials.userId,"LEFT_ROOMS"),r),"org.matrix.msc4222.use_state_after":!0},s=yield n.http.authedRequest(le.Get,"/sync",o,void 0,{localTimeoutMs:i}),a=[];null!==(t=s.rooms)&&void 0!==t&&t.leave&&(a=e.mapSyncResponseToRoomArray(s.rooms.leave));var l,c=yield Promise.all(a.map((l=B(function*(t){var r=t.room;if(t.isBrandNewRoom){t.timeline=t.timeline||{prev_batch:null,events:[]},r.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,Me.BACKWARDS);var{timelineEvents:i}=yield e.mapAndInjectRoomEvents(t);return r.recalculate(),n.store.storeRoom(r),n.emit(Le.Room,r),e.processEventsForNotifs(r,i),r}}),function(e){return l.apply(this,arguments)})));return c.filter(Boolean)})()}peek(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if((null===(t=this._peekRoom)||void 0===t?void 0:t.roomId)===e)return Promise.resolve(this._peekRoom);var r=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,n).then(t=>{var n;if((null===(n=this._peekRoom)||void 0===n?void 0:n.roomId)!==e)throw new Error("Peeking aborted");t.messages=t.messages||{chunk:[]},t.messages.chunk=t.messages.chunk||[],t.state=t.state||[];var i=i_(t.state).map(r.getEventMapper()),o=t.state.map(r.getEventMapper()),s=t.messages.chunk.map(r.getEventMapper());return Array.isArray(t.presence)&&t.presence.map(r.getEventMapper()).forEach(function(e){var t=r.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=mu.createUser(e.getContent().user_id,r)).setPresenceEvent(e),r.store.storeUser(t)),r.emit(Le.Event,e)}),t.messages.start&&(this._peekRoom.oldState.paginationToken=t.messages.start),this._peekRoom.oldState.setStateEvents(i),this._peekRoom.currentState.setStateEvents(o),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(s.reverse(),!0,!0,this._peekRoom.getLiveTimeline(),t.messages.start),r.store.storeRoom(this._peekRoom),r.emit(Le.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom})}stopPeeking(){this._peekRoom=null}peekPoll(e,t){var n,r,i=this;this._peekRoom===e?this.client.http.authedRequest(le.Get,"/events",{room_id:e.roomId,timeout:String(3e4),from:t},void 0,{localTimeoutMs:5e4,abortSignal:null===(n=this.abortController)||void 0===n?void 0:n.signal}).then((r=B(function*(t){if(i._peekRoom===e){t.chunk.filter(function(e){return"m.presence"===e.type}).map(i.client.getEventMapper()).forEach(e=>{var t=i.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=mu.createUser(e.getContent().user_id,i.client)).setPresenceEvent(e),i.client.store.storeUser(t)),i.client.emit(Le.Event,e)});var n=t.chunk.filter(function(t){return t.room_id===e.roomId&&t.event_id}).map(i.client.getEventMapper());yield e.addLiveEvents(n,{addToState:!0}),i.peekPoll(e,t.end)}else i.syncOpts.logger.debug("Stopped peeking in room %s",e.roomId)}),function(e){return r.apply(this,arguments)}),n=>{this.syncOpts.logger.error("[%s] Peek poll failed: %s",e.roomId,n),setTimeout(()=>{this.peekPoll(e,t)},3e4)}):this.syncOpts.logger.debug("Stopped peeking in room %s",e.roomId)}getSyncState(){return this.syncState}getSyncStateData(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}recoverFromSyncStartupError(e,t){var n=this;return B(function*(){yield e;var r=n.startKeepAlives();n.updateSyncState(Vt.Error,{error:t}),yield r})()}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(this.syncOpts.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Vt.Error,{error:e}),!0)}sync(){var e=this;return B(function*(){var t,n;if(e.running=!0,e.abortController=new AbortController,null===(t=globalThis.window)||void 0===t||null===(n=t.addEventListener)||void 0===n||n.call(t,"online",e.onOnline,!1),e.client.isGuest())return e.doSync({});e.syncOpts.logger.debug("Getting saved sync token...");var r=e.client.store.getSavedSyncToken().then(t=>(e.syncOpts.logger.debug("Got saved sync token"),t));e.savedSyncPromise=e.client.store.getSavedSync().then(t=>{if(e.syncOpts.logger.debug("Got reply from saved sync, exists? ".concat(!!t)),t)return e.syncFromCache(t)}).catch(t=>{e.syncOpts.logger.error("Getting saved sync failed",t)}),yield e.getPushRules(),yield e.prepareLazyLoadingForSync(),yield e.storeClientOptions();var{filterId:i,filter:o}=yield e.getFilter();if(o){if(e.client.resetNotifTimelineSet(),!e.currentSyncRequest){var s=i,a=yield r;if(a)e.syncOpts.logger.debug("Sending first sync request...");else{e.syncOpts.logger.debug("Sending initial sync request...");var l=e.buildDefaultFilter();l.setDefinition(o.getDefinition()),l.setTimelineLimit(e.opts.initialSyncLimit),s=JSON.stringify(l.getDefinition())}e.currentSyncRequest=e.doSyncRequest({filter:s},a)}return e.syncOpts.logger.debug("Waiting for saved sync before starting sync processing..."),yield e.savedSyncPromise,e.doSync({filter:i})}})()}stop(){var e,t,n;this.syncOpts.logger.debug("SyncApi.stop"),null===(e=globalThis.window)||void 0===e||null===(t=e.removeEventListener)||void 0===t||t.call(e,"online",this.onOnline,!1),this.running=!1,null===(n=this.abortController)||void 0===n||n.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return!!this.connectionReturnedResolvers&&(this.startKeepAlives(0),!0)}syncFromCache(e){var t=this;return B(function*(){t.syncOpts.logger.debug("sync(): not doing HTTP hit, instead returning stored /sync data");var n=e.nextBatch;t.client.store.setSyncToken(n);var r={nextSyncToken:n,catchingUp:!1,fromCache:!0},i={next_batch:n,rooms:e.roomsData,account_data:{events:e.accountData}};try{yield t.processSyncResponse(r,i)}catch(e){t.syncOpts.logger.error("Error processing cached sync",e)}t.storeIsInvalid||t.updateSyncState(Vt.Prepared,r)})()}doSync(e){var t=this;return B(function*(){for(;t.running;){var n=t.client.store.getSyncToken(),r=void 0;try{t.currentSyncRequest||(t.currentSyncRequest=t.doSyncRequest(e,n)),r=yield t.currentSyncRequest}catch(e){if(yield t.onSyncError(e))return;continue}finally{t.currentSyncRequest=void 0}t.client.store.setSyncToken(r.next_batch),t.failedSyncCount=0;var i={oldSyncToken:n??void 0,nextSyncToken:r.next_batch,catchingUp:t.catchingUp};try{yield t.processSyncResponse(i,r)}catch(e){t.syncOpts.logger.error("Caught /sync error",e),t.client.emit(Le.SyncUnexpectedError,e)}yield t.client.store.setSyncData(r),i.catchingUp=t.catchingUp,e.hasSyncedBefore||(t.updateSyncState(Vt.Prepared,i),e.hasSyncedBefore=!0),t.syncOpts.cryptoCallbacks&&(yield t.syncOpts.cryptoCallbacks.onSyncCompleted(i)),t.updateSyncState(Vt.Syncing,i),t.client.store.wantsSave()&&(yield t.client.store.save())}t.running||(t.syncOpts.logger.debug("Sync no longer running: exiting."),t.connectionReturnedResolvers&&(t.connectionReturnedResolvers.reject(),t.connectionReturnedResolvers=void 0),t.updateSyncState(Vt.Stopped))})()}doSyncRequest(e,t){var n,r=this.getSyncParams(e,t);return this.client.http.authedRequest(le.Get,"/sync",r,void 0,{localTimeoutMs:r.timeout+h$,abortSignal:null===(n=this.abortController)||void 0===n?void 0:n.signal})}getSyncParams(e,t){var n=this.opts.pollTimeout;(this.getSyncState()!==Vt.Syncing||this.catchingUp)&&(this.catchingUp=!0,n=0);var r=e.filter;this.client.isGuest()&&!r&&(r=this.getGuestFilter());var i={filter:r,timeout:n,"org.matrix.msc4222.use_state_after":!0};return this.opts.disablePresence?i.set_presence=bJ.Offline:void 0!==this.presence&&(i.set_presence=this.presence),t?i.since=t:i._cacheBuster=Date.now(),[Vt.Reconnecting,Vt.Error].includes(this.getSyncState())&&(i.timeout=0),i}setPresence(e){this.presence=e}onSyncError(e){var t=this;return B(function*(){if(!t.running)return t.syncOpts.logger.debug("Sync no longer running: exiting"),t.connectionReturnedResolvers&&(t.connectionReturnedResolvers.reject(),t.connectionReturnedResolvers=void 0),t.updateSyncState(Vt.Stopped),!0;if(t.syncOpts.logger.error("/sync error %s",e),t.shouldAbortSync(e))return!0;t.failedSyncCount++,t.syncOpts.logger.debug("Number of consecutive failed sync requests:",t.failedSyncCount),t.syncOpts.logger.debug("Starting keep-alive");var n=t.startKeepAlives();return t.currentSyncRequest=void 0,t.updateSyncState(t.failedSyncCount>=v1e?Vt.Error:Vt.Reconnecting,{error:e}),(yield n)&&t.getSyncState()===Vt.Error&&t.updateSyncState(Vt.Catchup,{catchingUp:!0}),!1})()}processSyncResponse(e,t){var n=this;return B(function*(){var r,i,o,s,a=n.client;if(Array.isArray(null===(r=t.presence)||void 0===r?void 0:r.events)&&t.presence.events.filter(Ha).map(a.getEventMapper()).forEach(function(e){var t=a.store.getUser(e.getSender());t?t.setPresenceEvent(e):((t=mu.createUser(e.getSender(),a)).setPresenceEvent(e),a.store.storeUser(t)),a.emit(Le.Event,e)}),Array.isArray(null===(i=t.account_data)||void 0===i?void 0:i.events)){var l=t.account_data.events.filter(Ha).map(a.getEventMapper()),c=l.reduce((e,t)=>(e[t.getType()]=a.store.getAccountData(t.getType()),e),{});a.store.storeAccountDataEvents(l),l.forEach(function(e){if(e.getType()===ee.PushRules){var t=e.getContent();a.setPushRules(t)}var n=c[e.getType()];return a.emit(Le.AccountData,e,n),e})}if(t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0){var u=t.to_device.events.filter(Ha);wJ(n.syncOpts.cryptoCallbacks?yield n.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(u):u.map(e=>({message:e,encryptionInfo:null})),a)}else n.catchingUp=!1;var d,h=[],p=[],f=[],m=[];t.rooms&&(t.rooms.invite&&(h=n.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(p=n.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(f=n.mapSyncResponseToRoomArray(t.rooms.leave)),t.rooms.knock&&(m=n.mapSyncResponseToRoomArray(t.rooms.knock))),n.notifEvents=[],yield tg(h,(d=B(function*(e){var t=e.room,r=n.mapSyncEventsFormat(e.invite_state,t);yield n.injectRoomEvents(t,r,void 0),e.isBrandNewRoom?(t.recalculate(),a.store.storeRoom(t),a.emit(Le.Room,t)):t.recalculate(),r.forEach(function(e){a.emit(Le.Event,e)})}),function(e){return d.apply(this,arguments)})),yield tg(p,function(){var t=B(function*(t){var r,i=t.room,o=n.mapSyncEventsFormat(t.state,i),s=n.mapSyncEventsFormat(t["org.matrix.msc4222.state_after"],i),l=n.mapSyncEventsFormat(t.timeline,i,!1),c=n.mapSyncEventsFormat(t.ephemeral),u=n.mapSyncEventsFormat(t.account_data),d=t["org.matrix.msc4222.state_after"]?s:o.concat(l),h=n.isRoomEncrypted(i,d);if(t.unread_notifications){var p,f;if(!h||0===t.unread_notifications.notification_count)i.setUnreadNotificationCount(zt.Total,null!==(p=t.unread_notifications.notification_count)&&void 0!==p?p:0);if(!h||i.getUnreadNotificationCount(zt.Highlight)<=0)i.setUnreadNotificationCount(zt.Highlight,null!==(f=t.unread_notifications.highlight_count)&&void 0!==f?f:0)}var m=null!==(r=t[rb.name])&&void 0!==r?r:t[rb.altName];if(m)for(var[v,g]of(i.resetThreadUnreadNotificationCountFromSync(Object.keys(m)),Object.entries(m))){var y;if(!h||0===g.notification_count)i.setThreadUnreadNotificationCount(v,zt.Total,null!==(y=g.notification_count)&&void 0!==y?y:0);var b,w=i.getThreadUnreadNotificationCount(v,zt.Highlight)<=0;if(!h||h&&w)i.setThreadUnreadNotificationCount(v,zt.Highlight,null!==(b=g.highlight_count)&&void 0!==b?b:0)}else i.resetThreadUnreadNotificationCountFromSync();if(t.timeline=t.timeline||{},t.isBrandNewRoom)null!==t.timeline.prev_batch&&i.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,Me.BACKWARDS);else if(t.timeline.limited){for(var _=!0,S=l.length-1;S>=0;S--){var E=l[S].getId();if(i.getTimelineForEvent(E)){n.syncOpts.logger.debug("Already have event ".concat(E," in limited sync - not resetting")),_=!1,l.splice(0,S);break}}var C;if(_)i.resetLiveTimeline(t.timeline.prev_batch,n.syncOpts.canResetEntireTimeline(i.roomId)?null:null!==(C=e.oldSyncToken)&&void 0!==C?C:null),a.resetNotifTimelineSet()}if(n.syncOpts.cryptoCallbacks)for(var k of d)k.isState()&&k.getType()===ee.RoomEncryption&&""===k.getStateKey()&&(yield n.syncOpts.cryptoCallbacks.onCryptoEvent(i,k));try{"org.matrix.msc4222.state_after"in t?yield n.injectRoomEvents(i,void 0,s,l,e.fromCache):yield n.injectRoomEvents(i,o,void 0,l,e.fromCache)}catch(e){n.syncOpts.logger.error("Failed to process events on room ".concat(i.roomId,":"),e)}t.summary&&i.setSummary(t.summary),i.addEphemeralEvents(c),i.addAccountData(u),i.recalculate(),t.isBrandNewRoom&&(a.store.storeRoom(i),a.emit(Le.Room,i)),n.processEventsForNotifs(i,l);var T=e=>a.emit(Le.Event,e);o.forEach(T),l.forEach(T),c.forEach(T),u.forEach(T),i.decryptCriticalEvents()});return function(e){return t.apply(this,arguments)}}()),yield tg(f,function(){var e=B(function*(e){var t=e.room,{timelineEvents:r,stateEvents:i,stateAfterEvents:o}=yield n.mapAndInjectRoomEvents(e),s=n.mapSyncEventsFormat(e.account_data);t.addAccountData(s),t.recalculate(),e.isBrandNewRoom&&(a.store.storeRoom(t),a.emit(Le.Room,t)),n.processEventsForNotifs(t,r),null==i||i.forEach(function(e){a.emit(Le.Event,e)}),null==o||o.forEach(function(e){a.emit(Le.Event,e)}),r.forEach(function(e){a.emit(Le.Event,e)}),s.forEach(function(e){a.emit(Le.Event,e)})});return function(t){return e.apply(this,arguments)}}()),yield tg(m,function(){var e=B(function*(e){var t=e.room,r=n.mapSyncEventsFormat(e.knock_state,t);yield n.injectRoomEvents(t,r,void 0),e.isBrandNewRoom?(t.recalculate(),a.store.storeRoom(t),a.emit(Le.Room,t)):t.recalculate(),r.forEach(function(e){a.emit(Le.Event,e)})});return function(t){return e.apply(this,arguments)}}()),e.oldSyncToken&&n.notifEvents.length&&(n.notifEvents.sort(function(e,t){return e.getTs()-t.getTs()}),n.notifEvents.forEach(function(e){var t;null===(t=a.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e,{addToState:!0})})),t.device_lists&&n.syncOpts.cryptoCallbacks&&(yield n.syncOpts.cryptoCallbacks.processDeviceLists(t.device_lists)),yield null===(o=n.syncOpts.cryptoCallbacks)||void 0===o?void 0:o.processKeyCounts(t.device_one_time_keys_count,null!==(s=t.device_unused_fallback_key_types)&&void 0!==s?s:t["org.matrix.msc2732.device_unused_fallback_key_types"])})()}startKeepAlives(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedResolvers||(this.connectionReturnedResolvers=Promise.withResolvers()),this.connectionReturnedResolvers.promise}pokeKeepAlive(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.running)return clearTimeout(this.keepAliveTimer),void(this.connectionReturnedResolvers&&(this.connectionReturnedResolvers.reject("SyncApi.stop() was called"),this.connectionReturnedResolvers=void 0));var n=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedResolvers&&(this.connectionReturnedResolvers.resolve(t),this.connectionReturnedResolvers=void 0)};this.client.http.request(le.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3,abortSignal:null===(e=this.abortController)||void 0===e?void 0:e.signal}).then(()=>{n()},e=>{400==e.httpStatus||404==e.httpStatus?this.keepAliveTimer=setTimeout(n,2e3):(t=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,t),5e3+Math.floor(5e3*Math.random())),this.updateSyncState(Vt.Error,{error:e}))})}mapSyncResponseToRoomArray(e){var t=this.client;return Object.keys(e).filter(e=>!gy(e)).map(n=>{var r=t.store.getRoom(n),i=!1;return r||(r=this.createRoom(n),i=!0),Zw(Zw({},e[n]),{},{room:r,isBrandNewRoom:i})})}mapSyncEventsFormat(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!Array.isArray(e.events))return[];var r=this.client.getEventMapper({decrypt:n});return e.events.filter(Ha).map(function(e){return t&&(e.room_id=t.roomId),r(e)})}resolveInvites(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership(Ve.Invite).forEach(function(n){if(!n.requestedProfileInfo){n.requestedProfileInfo=!0;var r=t.getUser(n.userId);(r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then(function(t){var r=n.events.member;(null==r?void 0:r.getContent().membership)===Ve.Invite&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))},function(e){})}})}}findEncryptionEvent(e){return null==e?void 0:e.find(e=>e.getType()===ee.RoomEncryption&&""===e.getStateKey())}isRoomEncrypted(e,t){return e.hasEncryptionStateEvent()||!!this.findEncryptionEvent(t)}mapAndInjectRoomEvents(e){var t=this;return B(function*(){var n=t.mapSyncEventsFormat(e.state,e.room),r=t.mapSyncEventsFormat(e["org.matrix.msc4222.state_after"],e.room),i=t.mapSyncEventsFormat(e.timeline,e.room);return"org.matrix.msc4222.state_after"in e?yield t.injectRoomEvents(e.room,void 0,r,i):yield t.injectRoomEvents(e.room,n,void 0,i),{timelineEvents:i,stateEvents:n,stateAfterEvents:r}})()}injectRoomEvents(e,t,n,r){var i=arguments,o=this;return B(function*(){var s=i.length>4&&void 0!==i[4]&&i[4],a=n??t,l=e.getLiveTimeline(),c=0==l.getEvents().length;if(c){for(var u of a)o.client.getPushActionsForEvent(u);l.initialiseState(a,{timelineWasEmpty:c})}o.resolveInvites(e),e.recalculate(),c||(e.oldState.setStateEvents(a),e.currentState.setStateEvents(a)),yield e.addLiveEvents(r||[],{fromCache:s,timelineWasEmpty:c,addToState:void 0===n}),o.client.processBeaconEvents(e,r)})()}processEventsForNotifs(e,t){if(this.client.getNotifTimelineSet())for(var n of t){var r,i=this.client.getPushActionsForEvent(n);null!=i&&i.notify&&null!==(r=i.tweaks)&&void 0!==r&&r.highlight&&this.notifEvents.push(n)}}getGuestFilter(){return"{}"}updateSyncState(e,t){var n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(Le.Sync,this.syncState,n,t)}}function EJ(e,t,n){var{timelineSupport:r}=e,i=new $3(t,e,e.getUserId(),{lazyLoadMembers:n.lazyLoadMembers,pendingEventOrdering:n.pendingEventOrdering,timelineSupport:r});return e.reEmitter.reEmit(i,[xe.Name,xe.Redaction,xe.RedactionCancelled,xe.Receipt,xe.Tags,xe.LocalEchoUpdated,xe.AccountData,xe.MyMembership,xe.Timeline,xe.TimelineReset,vt.Events,vt.Members,vt.NewMember,vt.Update,$n.New,$n.Update,$n.Destroy,$n.LivenessChange]),i.on(vt.NewMember,(t,n,r)=>{var i;r.user=null!==(i=e.getUser(r.userId))&&void 0!==i?i:void 0,e.reEmitter.reEmit(r,[Ns.Name,Ns.Typing,Ns.PowerLevel,Ns.Membership])}),i}function wJ(e,t){var n=[];e.map(e=>{if("m.key.verification.cancel"===e.message.type){var t=e.message.content.transaction_id;t&&n.push(t)}return e}).forEach(function(e){var r=e.message,i=r.content,o=new Zi(Object.assign({},r));if("m.key.verification.start"===r.type||"m.key.verification.request"===r.type){var s=i.transaction_id;n.includes(s)&&o.flagCancelled()}e.encryptionInfo&&o.makeEncrypted(ee.RoomMessageEncrypted,{ciphertext:""},e.encryptionInfo.senderCurve25519KeyBase64,""),t.emit(Le.ToDeviceEvent,o),t.emit(Le.ReceivedToDeviceMessage,e)})}class b1e{constructor(){P(this,"accountData",new Map),P(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,t){return[]}setUserCreator(e){}storeEvents(e,t,n,r){}storeFilter(e){}getFilter(e,t){return null}getFilterIdByName(e){return null}setFilterIdByName(e,t){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,t){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}getPendingEvents(e){return B(function*(){return[]})()}setPendingEvents(e,t){return Promise.resolve()}saveToDeviceBatches(e){return B(function*(){return Promise.resolve()})()}getOldestToDeviceBatch(){return Promise.resolve(null)}removeToDeviceBatch(e){return B(function*(){return Promise.resolve()})()}destroy(){return B(function*(){})()}}const Li=[];for(let e=0;e<256;++e)Li.push((e+256).toString(16).slice(1));function _1e(e,t=0){return(Li[e[t+0]]+Li[e[t+1]]+Li[e[t+2]]+Li[e[t+3]]+"-"+Li[e[t+4]]+Li[e[t+5]]+"-"+Li[e[t+6]]+Li[e[t+7]]+"-"+Li[e[t+8]]+Li[e[t+9]]+"-"+Li[e[t+10]]+Li[e[t+11]]+Li[e[t+12]]+Li[e[t+13]]+Li[e[t+14]]+Li[e[t+15]]).toLowerCase()}let pk;const S1e=new Uint8Array(16);function E1e(){if(!pk){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");pk=crypto.getRandomValues.bind(crypto)}return pk(S1e)}const w1e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),m$={randomUUID:w1e};function C1e(e,t,n){var r;if(m$.randomUUID&&!e)return m$.randomUUID();const i=(e=e||{}).random??(null==(r=e.rng)?void 0:r.call(e))??E1e();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=15&i[6]|64,i[8]=63&i[8]|128,_1e(i)}var g$,v$,vk,y$,b$,Aa={},mk={},gk={exports:{}};function jP(){if(g$)return gk.exports;g$=1;var e=gk.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){e[t].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),gk.exports}function T1e(){return v$||(v$=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,r){var i=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:i&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:i?n[e.name]:n;(function(e,n,r,i){if(i&&!r)n[i]=t(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(n[r[o]]=t(e[o+1]))})(r.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},r=jP(),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),s=o[o.length-1]);for(var a=0;a<(r[t]||[]).length;a+=1){var l=r[t][a];if(l.reg.test(i))return n(l,s,i)}}),t.media=o,t};var o=function(e,n){var r=n.split(/=(.+)/,2);return 2===r.length?e[r[0]]=t(r[1]):1===r.length&&n.length>1&&(e[r[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],r=e.split(" ").map(t),i=0;i<r.length;i+=3)n.push({component:r[i],ip:r[i+1],port:r[i+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,r=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),r=!0),{scid:n,paused:r}})})}}(mk)),mk}function R1e(){if(y$)return vk;y$=1;var e=jP(),t=/%[sdv%]/g,n=function(e){var n=1,r=arguments,i=r.length;return e.replace(t,function(e){if(n>=i)return e;var t=r[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},r=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?i.push(r[t.name][s]):i.push(r[t.names[o]])}else i.push(r[t.name]);return n.apply(null,i)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return vk=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var s=n.outerOrder||i,a=n.innerOrder||o,l=[];return s.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?l.push(r(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){l.push(r(n,e,t))})})}),t.media.forEach(function(t){l.push(r("m",e.m[0],t)),a.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?l.push(r(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){l.push(r(n,e,t))})})})}),l.join("\r\n")+"\r\n"}}function I1e(){if(b$)return Aa;b$=1;var e=T1e(),t=R1e(),n=jP();return Aa.grammar=n,Aa.write=t,Aa.parse=e.parse,Aa.parseParams=e.parseParams,Aa.parseFmtpConfig=e.parseFmtpConfig,Aa.parsePayloads=e.parsePayloads,Aa.parseRemoteCandidates=e.parseRemoteCandidates,Aa.parseImageAttributes=e.parseImageAttributes,Aa.parseSimulcastStreamList=e.parseSimulcastStreamList,Aa}var K5=I1e();function FP(e,t){if("function"==typeof e.toBase64)return e.toBase64(t);var n=btoa(e.reduce((e,t)=>e+String.fromCharCode(t),""));return t.omitPadding&&(n=n.replace(/={1,2}$/,"")),"base64url"===t.alphabet&&(n=n.replace(/\+/g,"-").replace(/\//g,"_")),n}function yy(e){return FP(e,{alphabet:"base64",omitPadding:!1})}function CJ(e){return FP(e,{alphabet:"base64",omitPadding:!0})}function B3(e){return FP(e,{alphabet:"base64url",omitPadding:!0})}function k1e(e,t){return"function"==typeof Uint8Array.fromBase64?Uint8Array.fromBase64(e,t):Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function Nh(e){return k1e(e.replace(/-/g,"+").replace(/_/g,"/"),{alphabet:"base64",lastChunkHandling:"loose"})}var x1e="abcdefghijklmnopqrstuvwxyz",A1e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",L1e="0123456789";function TJ(e){var t=new Uint8Array(e);return globalThis.crypto.getRandomValues(t),B3(t)}function Eo(e){return P1e(e,A1e+x1e+L1e)}function P1e(e,t){if(t.length<2||t.length>256)throw new Error("Character set must be between 2 and 256 characters long");if(e<1||e>32768)throw new Error("Requested random string length must be between 1 and 32768");for(var n=256-256%t.length,r=new Uint8Array(Math.floor(1.3*e)),i=r.length,o=[];o.length<e;){i===r.length&&(globalThis.crypto.getRandomValues(r),i=0);var s=r[i++];s<n&&o.push(t[s%t.length])}return o.join("")}var yd="org.matrix.msc3077.sdp_stream_metadata",In=function(e){return e.Usermedia="m.usermedia",e.Screenshare="m.screenshare",e}({}),by=null,z5=0,O1e=()=>(null===by&&(by=new AudioContext),z5++,by),M1e=()=>{var e;0===--z5&&(null===(e=by)||void 0===e||e.close(),by=null)},D1e=200,W5=-60,N1e=8,Ac=function(e){return e.NewStream="new_stream",e.MuteStateChanged="mute_state_changed",e.LocalVolumeChanged="local_volume_changed",e.VolumeChanged="volume_changed",e.ConnectedChanged="connected_changed",e.Speaking="speaking",e.Disposed="disposed",e}({});class nu extends Pn{constructor(e){super(),P(this,"stream",void 0),P(this,"sdpMetadataStreamId",void 0),P(this,"userId",void 0),P(this,"deviceId",void 0),P(this,"purpose",void 0),P(this,"speakingVolumeSamples",void 0),P(this,"client",void 0),P(this,"call",void 0),P(this,"roomId",void 0),P(this,"audioMuted",void 0),P(this,"videoMuted",void 0),P(this,"localVolume",1),P(this,"measuringVolumeActivity",!1),P(this,"audioContext",void 0),P(this,"analyser",void 0),P(this,"frequencyBinCount",void 0),P(this,"speakingThreshold",W5),P(this,"speaking",!1),P(this,"volumeLooperTimeout",void 0),P(this,"_disposed",!1),P(this,"_connected",!1),P(this,"onAddTrack",()=>{this.emit(Ac.NewStream,this.stream)}),P(this,"onCallState",e=>{e===dt.Connected?this.connected=!0:e===dt.Connecting&&(this.connected=!1)}),P(this,"volumeLooper",()=>{if(this.analyser&&this.measuringVolumeActivity){this.analyser.getFloatFrequencyData(this.frequencyBinCount);var e=-1/0;for(var t of this.frequencyBinCount)t>e&&(e=t);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(e),this.emit(Ac.VolumeChanged,e);var n=!1;for(var r of this.speakingVolumeSamples)if(r>this.speakingThreshold){n=!0;break}this.speaking!==n&&(this.speaking=n,this.emit(Ac.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,D1e)}}),this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(N1e).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(bt.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit(Ac.ConnectedChanged,this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,t){if(t!==e){var n=this.measuringVolumeActivity;e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?(this.initVolumeMeasuring(),n&&this.measureVolumeActivity(!0)):this.measureVolumeActivity(!1),this.emit(Ac.NewStream,this.stream)}}initVolumeMeasuring(){this.hasAudioTrack&&(this.audioContext||(this.audioContext=O1e()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount))}getMember(){var e,t=this.client.getRoom(this.roomId);return null!==(e=null==t?void 0:t.getMember(this.userId))&&void 0!==e?e:null}isLocal(){return this.userId===this.client.getUserId()&&(void 0===this.deviceId||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return 0===this.stream.getAudioTracks().length||this.audioMuted}isVideoMuted(){return 0===this.stream.getVideoTracks().length||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,t){null!==e&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),null!==t&&(this.videoMuted=t),this.emit(Ac.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(Ac.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){var e=this.client.getMediaHandler(),t=this.stream.clone();return M.log("CallFeed clone() cloning stream (originalStreamId=".concat(this.stream.id,", newStreamId").concat(t.id,")")),this.purpose===In.Usermedia?e.userMediaStreams.push(t):e.screensharingStreams.push(t),new nu({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:t,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,t;clearTimeout(this.volumeLooperTimeout),null===(e=this.stream)||void 0===e||e.removeEventListener("addtrack",this.onAddTrack),null===(t=this.call)||void 0===t||t.removeListener(bt.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,M1e()),this._disposed=!0,this.emit(Ac.Disposed)}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit(Ac.LocalVolumeChanged,e)}}var U1e=3e3,Y5=function(e){return e.Incoming="Call.incoming",e}({});class j1e{constructor(e){P(this,"calls",void 0),P(this,"callEventBuffer",void 0),P(this,"nextSeqByCall",new Map),P(this,"toDeviceEventBuffers",new Map),P(this,"client",void 0),P(this,"candidateEventsByCall",void 0),P(this,"eventBufferPromiseChain",void 0),P(this,"onSync",()=>{var e=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then(()=>this.evaluateEventBuffer(e)):this.eventBufferPromiseChain=this.evaluateEventBuffer(e)}),P(this,"onRoomTimeline",e=>{this.callEventBuffer.push(e)}),P(this,"onToDeviceEvent",e=>{var t=e.getContent();if(t.call_id)if(this.nextSeqByCall.has(t.call_id)||this.nextSeqByCall.set(t.call_id,0),void 0!==t.seq){var n=this.nextSeqByCall.get(t.call_id)||0;if(t.seq!==n){this.toDeviceEventBuffers.has(t.call_id)||this.toDeviceEventBuffers.set(t.call_id,[]);var r=this.toDeviceEventBuffers.get(t.call_id),i=r.findIndex(e=>e.getContent().seq>t.seq);-1===i?r.push(e):r.splice(i,0,e)}else{var o=t.call_id;this.callEventBuffer.push(e),this.nextSeqByCall.set(o,t.seq+1);for(var s=this.toDeviceEventBuffers.get(o),a=s&&s.shift();a&&a.getContent().seq===this.nextSeqByCall.get(o);)this.callEventBuffer.push(a),this.nextSeqByCall.set(o,a.getContent().seq+1),a=s.shift()}}else this.callEventBuffer.push(e);else this.callEventBuffer.push(e)}),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(Le.Sync,this.onSync),this.client.on(xe.Timeline,this.onRoomTimeline),this.client.on(Le.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(Le.Sync,this.onSync),this.client.removeListener(xe.Timeline,this.onRoomTimeline),this.client.removeListener(Le.ToDeviceEvent,this.onToDeviceEvent)}evaluateEventBuffer(e){var t=this;return B(function*(){yield Promise.all(e.map(e=>t.client.decryptEventIfNeeded(e)));var n=e.filter(e=>{var t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")}),r=new Set;for(var i of n){var o=i.getType();(o===ee.CallAnswer||o===ee.CallHangup)&&r.add(i.getContent().call_id)}for(var s of n){var a=s.getType(),l=s.getContent().call_id;if(a!==ee.CallInvite||!r.has(l))try{yield t.handleCallEvent(s)}catch(e){M.error("CallEventHandler evaluateEventBuffer() caught exception handling call event",e)}}})()}handleCallEvent(e){var t=this;return B(function*(){var n;t.client.emit(Le.ReceivedVoipEvent,e);var r,i,o=e.getContent(),s=e.getRoomId()||(null===(n=t.client.groupCallEventHandler.getGroupCallById(o.conf_id))||void 0===n||null===(n=n.room)||void 0===n?void 0:n.roomId),a=o.conf_id,l=e.getType(),c=e.getSender(),u=o.call_id?t.calls.get(o.call_id):void 0;if(a){if(!(i=t.client.groupCallEventHandler.getGroupCallById(a)))return void M.warn("CallEventHandler handleCallEvent() could not find a group call - ignoring event (groupCallId=".concat(a,", type=").concat(l,")"));if(!(r=o.device_id))return M.warn("CallEventHandler handleCallEvent() could not find a device id - ignoring event (senderId=".concat(c,")")),void i.emit(Rn.Error,new kJ(c));if(o.dest_session_id!==t.client.getSessionId())return void M.warn("CallEventHandler handleCallEvent() call event does not match current session id - ignoring")}var d=c===t.client.credentials.userId&&(void 0===r||r===t.client.getDeviceId());if(s){if(l===ee.CallInvite){var h,p,f;if(d||e.getLocalAge()>o.lifetime-U1e||u&&u.state===dt.Ended||(u&&M.warn("CallEventHandler handleCallEvent() already has a call but got an invite - clobbering (callId=".concat(o.call_id,")")),o.invitee&&o.invitee!==t.client.getUserId()))return;var m=(null!==(h=t.client.getTurnServersExpiry())&&void 0!==h?h:0)-Date.now();if(M.info("CallEventHandler handleCallEvent() current turn creds expire in "+m+" ms"),!(u=null!==(p=sb(t.client,s,{forceTURN:t.client.forceTURN,opponentDeviceId:r,groupCallId:a,opponentSessionId:o.sender_session_id}))&&void 0!==p?p:void 0))return void M.log("CallEventHandler handleCallEvent() this client does not support WebRTC (callId=".concat(o.call_id,")"));u.callId=o.call_id;var v,g=null===(f=i)||void 0===f?void 0:f.getGroupCallStats();g&&u.initStats(g);try{yield u.initWithInvite(e)}catch(e){if(e instanceof Vl)if(e.code===Sy.UnknownDevice){var y;null===(y=i)||void 0===y||y.emit(Rn.Error,e)}else M.error(e)}if(t.calls.set(u.callId,u),t.candidateEventsByCall.get(u.callId))for(var b of t.candidateEventsByCall.get(u.callId))u.onRemoteIceCandidatesReceived(b);for(var w of t.calls.values()){var _,S=[dt.WaitLocalMedia,dt.CreateOffer,dt.InviteSent].includes(w.state);if(u.roomId===w.roomId&&w.direction===Id.Outbound&&(null===(_=u.getOpponentMember())||void 0===_?void 0:_.userId)===w.invitee&&S){v=w;break}}return void(v?v.callId>u.callId?(M.log("CallEventHandler handleCallEvent() detected glare - answering incoming call and canceling outgoing call (incomingId=".concat(u.callId,", outgoingId=").concat(v.callId,")")),v.replacedBy(u)):(M.log("CallEventHandler handleCallEvent() detected glare - hanging up incoming call (incomingId=".concat(u.callId,", outgoingId=").concat(v.callId,")")),u.hangup(mt.Replaced,!0)):t.client.emit(Y5.Incoming,u))}if(l===ee.CallCandidates){if(d)return;return void(u?u.onRemoteIceCandidatesReceived(e):(t.candidateEventsByCall.has(o.call_id)||t.candidateEventsByCall.set(o.call_id,[]),t.candidateEventsByCall.get(o.call_id).push(e)))}if([ee.CallHangup,ee.CallReject].includes(l)){var E;if(u)u.state!==dt.Ended&&(l===ee.CallHangup?u.onHangupReceived(o):u.onRejectReceived(o),u.state===dt.Ended&&t.calls.delete(o.call_id));else(u=null!==(E=sb(t.client,s,{opponentDeviceId:r,opponentSessionId:o.sender_session_id}))&&void 0!==E?E:void 0)&&(u.callId=o.call_id,u.initWithHangup(e),t.calls.set(o.call_id,u));return}if(!u||!u.hasPeerConnection)return void M.info("CallEventHandler handleCallEvent() discarding possible call event as we don't have a call (type=".concat(l,")"));if(e.getContent().party_id!==u.ourPartyId)switch(l){case ee.CallAnswer:d?u.state===dt.Ringing&&u.onAnsweredElsewhere(o):u.onAnswerReceived(e);break;case ee.CallSelectAnswer:u.onSelectAnswerReceived(e);break;case ee.CallNegotiate:u.onNegotiateReceived(e);break;case ee.CallAssertedIdentity:case ee.CallAssertedIdentityPrefix:u.onAssertedIdentityReceived(e);break;case ee.CallSDPStreamMetadataChanged:case ee.CallSDPStreamMetadataChangedPrefix:u.onSDPStreamMetadataChangedReceived(e)}}})()}}var X5=function(e){return e.Incoming="GroupCall.incoming",e.Outgoing="GroupCall.outgoing",e.Ended="GroupCall.ended",e.Participants="GroupCall.participants",e}({});class F1e{constructor(e){this.client=e,P(this,"groupCalls",new Map),P(this,"roomDeferreds",new Map),P(this,"onRoomsChanged",e=>{this.createGroupCallForRoom(e)}),P(this,"onRoomStateChanged",(e,t)=>{if(e.getType()===ee.GroupCallPrefix){var n=e.getStateKey(),r=e.getContent(),i=this.groupCalls.get(t.roomId);i||r["m.terminated"]||e.isRedacted()?i&&i.groupCallId===n?r["m.terminated"]||e.isRedacted()?i.terminate(!1):r["m.type"]!==i.type&&M.warn("GroupCallEventHandler onRoomStateChanged() currently does not support changing type (roomId=".concat(t.roomId,")")):i&&i.groupCallId!==n&&M.warn("GroupCallEventHandler onRoomStateChanged() currently does not support multiple calls (roomId=".concat(t.roomId,")")):this.createGroupCallFromRoomStateEvent(e)}})}start(){var e=this;return B(function*(){e.client.getSyncState()!==Vt.Syncing&&(M.debug("GroupCallEventHandler start() waiting for client to start syncing"),yield new Promise(t=>{var n=()=>{if(e.client.getSyncState()===Vt.Syncing)return e.client.off(Le.Sync,n),t()};e.client.on(Le.Sync,n)}));var t=e.client.getRooms();for(var n of t)e.createGroupCallForRoom(n);e.client.on(Le.Room,e.onRoomsChanged),e.client.on(vt.Events,e.onRoomStateChanged)})()}stop(){this.client.removeListener(Le.Room,this.onRoomsChanged),this.client.removeListener(vt.Events,this.onRoomStateChanged)}getRoomDeferred(e){var t,n=this.roomDeferreds.get(e);void 0===n&&((n={prom:new Promise(e=>{t=e})}).resolve=t,this.roomDeferreds.set(e,n));return n}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find(t=>t.groupCallId===e)}createGroupCallForRoom(e){var t=e.currentState.getStateEvents(ee.GroupCallPrefix),n=t.sort((e,t)=>t.getTs()-e.getTs());for(var r of n){if(!r.getContent()["m.terminated"]&&!r.isRedacted()){M.debug("GroupCallEventHandler createGroupCallForRoom() choosing group call from possible calls (stateKey=".concat(r.getStateKey(),", ts=").concat(r.getTs(),", roomId=").concat(e.roomId,", numOfPossibleCalls=").concat(t.length,")")),this.createGroupCallFromRoomStateEvent(r);break}}this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){var t=e.getRoomId(),n=e.getContent(),r=this.client.getRoom(t);if(r){var i=e.getStateKey(),o=n["m.type"];if(Object.values(H3).includes(o)){var s=n["m.intent"];if(Object.values(IJ).includes(s)){var a,l=!!n["io.element.ptt"];if(null!=n&&n.dataChannelsEnabled&&null!=n&&n.dataChannelOptions){var{ordered:c,maxPacketLifeTime:u,maxRetransmits:d,protocol:h}=n.dataChannelOptions;a={ordered:c,maxPacketLifeTime:u,maxRetransmits:d,protocol:h}}var p=new $P(this.client,r,o,l,s,i,(null==n?void 0:n.dataChannelsEnabled)||this.client.isVoipWithNoMediaAllowed,a,this.client.isVoipWithNoMediaAllowed,this.client.useLivekitForGroupCalls,n["io.element.livekit_service_url"]);return this.groupCalls.set(r.roomId,p),this.client.emit(X5.Incoming,p),p}M.warn("Received invalid group call intent (type=".concat(o,", roomId=").concat(t,")"))}else M.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() received invalid call type (type=".concat(o,", roomId=").concat(t,")"))}else M.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() couldn't find room for call (roomId=".concat(t,")"))}}class $1e{constructor(){P(this,"bandwidth",{}),P(this,"bitrate",{}),P(this,"packetLoss",{}),P(this,"transport",[])}}class B1e{static buildBandwidthReport(e){var t=e.availableIncomingBitrate,n=e.availableOutgoingBitrate;return{download:t?Math.round(t/1e3):0,upload:n?Math.round(n/1e3):0}}}class H1e{static buildReport(e,t,n,r){var i=null==e?void 0:e.get(t.localCandidateId),o=null==e?void 0:e.get(t.remoteCandidateId);if(o&&i){var s=void 0!==o.ip?o.ip:o.address,a=o.port,l="".concat(s,":").concat(a),c=void 0!==i.ip?i.ip:i.address,u=i.port,d="".concat(c,":").concat(u),h=o.protocol;n.some(e=>e.ip===l&&e.type===h&&e.localIp===d)||n.push({ip:l,type:h,localIp:d,isFocus:r,localCandidateType:i.candidateType,remoteCandidateType:o.candidateType,networkType:i.networkType,rtt:t.currentRoundTripTime?1e3*t.currentRoundTripTime:NaN})}return n}}class V1e{constructor(){P(this,"ssrcToMid",{local:new Map,remote:new Map})}findMidBySsrc(e,t){var n;return this.ssrcToMid[t].forEach((t,r)=>{t.find(t=>t==e)&&(n=r)}),n}parse(e,t){var n=K5.parse(e),r=new Map;n.media.forEach(e=>{if(e.mid&&"video"===e.type||"audio"===e.type){var t,n=[];null===(t=e.ssrcs)||void 0===t||t.forEach(e=>{"cname"===e.attribute&&n.push("".concat(e.id))}),r.set("".concat(e.mid),n)}}),this.ssrcToMid[t]=r}getSsrcToMidMap(e){return this.ssrcToMid[e]}}class q1e{constructor(e){this.pc=e}getLocalTracks(e){return this.pc.getTransceivers().filter(e=>"sendonly"===e.currentDirection||"sendrecv"===e.currentDirection).filter(e=>null!==e.sender).map(e=>e.sender).map(e=>e.track).filter(t=>null!==t&&t.kind===e)}getTackById(e){return this.pc.getTransceivers().map(t=>null!==(null==t?void 0:t.sender.track)&&t.sender.track.id===e?t.sender.track:null!==(null==t?void 0:t.receiver.track)&&t.receiver.track.id===e?t.receiver.track:void 0).find(e=>void 0!==e)}getLocalTrackIdByMid(e){var t,n=this.pc.getTransceivers().find(t=>t.mid===e);return null==n||null===(t=n.sender)||void 0===t||null===(t=t.track)||void 0===t?void 0:t.id}getRemoteTrackIdByMid(e){var t,n=this.pc.getTransceivers().find(t=>t.mid===e);return null==n||null===(t=n.receiver)||void 0===t||null===(t=t.track)||void 0===t?void 0:t.id}getActiveSimulcastStreams(){return 3}getTransceiverByTrackId(e){return this.pc.getTransceivers().find(t=>t.receiver.track.id===e||null!==t.sender.track&&t.sender.track.id===e)}}class G1e{constructor(e,t,n){this.trackId=e,this.type=t,this.kind=n,P(this,"loss",{packetsTotal:0,packetsLost:0,isDownloadStream:!1}),P(this,"bitrate",{download:0,upload:0}),P(this,"resolution",{width:-1,height:-1}),P(this,"audioConcealment",{concealedAudio:0,totalAudioDuration:0}),P(this,"framerate",0),P(this,"jitter",0),P(this,"codec",""),P(this,"isAlive",!0),P(this,"isMuted",!1),P(this,"isEnabled",!0)}getType(){return this.type}setLoss(e){this.loss=e}getLoss(){return this.loss}setResolution(e){this.resolution=e}getResolution(){return this.resolution}setFramerate(e){this.framerate=e}getFramerate(){return this.framerate}setBitrate(e){this.bitrate=e}getBitrate(){return this.bitrate}setCodec(e){return this.codec=e,!0}getCodec(){return this.codec}resetBitrate(){this.bitrate={download:0,upload:0}}set alive(e){this.isAlive=e}get alive(){return this.isAlive}set muted(e){this.isMuted=e}get muted(){return this.isMuted}set enabled(e){this.isEnabled=e}get enabled(){return this.isEnabled}setJitter(e){this.jitter=e}getJitter(){return this.jitter}setAudioConcealment(e,t){this.audioConcealment.concealedAudio=e,this.audioConcealment.totalAudioDuration=t}getAudioConcealment(){return this.audioConcealment}}class K1e{constructor(e,t){this.mediaSsrcHandler=e,this.mediaTrackHandler=t,P(this,"track2stats",new Map)}findTrack2Stats(e,t){var n;if(e.trackIdentifier)n=e.trackIdentifier;else if(e.mid)n="remote"===t?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid);else if(e.ssrc){if(!this.mediaSsrcHandler.findMidBySsrc(e.ssrc,t))return;n="remote"===t?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid)}if(n){var r=this.track2stats.get(n);if(!r){var i=this.mediaTrackHandler.getTackById(n);if(void 0===i)return;var o="audio"===i.kind?i.kind:"video";r=new G1e(n,t,o),this.track2stats.set(n,r)}return r}}findLocalVideoTrackStats(e){if(0!==this.mediaTrackHandler.getLocalTracks("video").length)return this.findTrack2Stats(e,"local")}getTrack2stats(){return this.track2stats}findTransceiverByTrackId(e){return this.mediaTrackHandler.getTransceiverByTrackId(e)}}class _h{static getNonNegativeValue(e){var t=e;return"number"!=typeof t&&(t=Number(t)),isNaN(t)?0:Math.max(0,t)}}class po{static buildFramerateResolution(e,t){var n={height:t.frameHeight,width:t.frameWidth},r=t.framesPerSecond;n.height&&n.width&&e.setResolution(n),e.setFramerate(Math.round(r||0))}static calculateSimulcastFramerate(e,t,n,r){var i=e.getFramerate();if(!i){if(n){var o=t.timestamp-n.timestamp;if(o>0&&t.framesSent)i=(t.framesSent-n.framesSent)/o*1e3}if(!i)return}i=r?Math.round(i/r):0,e.setFramerate(i)}static buildCodec(e,t,n){var r=null==e?void 0:e.get(n.codecId);if(r){var i=r.mimeType.split("/")[1];i&&t.setCodec(i)}}static buildBitrateReceived(e,t,n){e.setBitrate({download:po.calculateBitrate(t.bytesReceived,n.bytesReceived,t.timestamp,n.timestamp),upload:0})}static buildBitrateSend(e,t,n){e.setBitrate({download:0,upload:this.calculateBitrate(t.bytesSent,n.bytesSent,t.timestamp,n.timestamp)})}static buildPacketsLost(e,t,n){var r="outbound-rtp"===t.type?"packetsSent":"packetsReceived",i=t[r];(!i||i<0)&&(i=0);var o=_h.getNonNegativeValue(n[r]),s=Math.max(0,i-o),a=_h.getNonNegativeValue(t.packetsLost),l=_h.getNonNegativeValue(n.packetsLost),c=Math.max(0,a-l);e.setLoss({packetsTotal:s+c,packetsLost:c,isDownloadStream:"outbound-rtp"!==t.type})}static calculateBitrate(e,t,n,r){var i=_h.getNonNegativeValue(e),o=_h.getNonNegativeValue(t),s=Math.max(0,i-o),a=n-r,l=0;return a>0&&(l=Math.round(8*s/a)),l}static setTrackStatsState(e,t){var n;if(void 0!==t){var r="remote"===e.getType()?t.receiver.track:null==t||null===(n=t.sender)||void 0===n?void 0:n.track;null!=r&&"ended"!==r.readyState?(e.muted=r.muted,e.enabled=r.enabled,e.alive=!0):e.alive=!1}else e.alive=!1}static buildTrackSummary(e){var t={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},n={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},r=e.filter(e=>"remote"===e.getType()),i=r.filter(e=>"audio"===e.kind);return r.forEach(e=>{var r,o,s="video"===e.kind?t:n;(s.count++,e.alive&&e.muted&&s.muted++,s.maxJitter<e.getJitter()&&(s.maxJitter=e.getJitter()),s.maxPacketLoss<e.getLoss().packetsLost&&(s.maxPacketLoss=e.getLoss().packetsLost),i.length>0)&&(s.concealedAudio+=null===(r=e.getAudioConcealment())||void 0===r?void 0:r.concealedAudio,s.totalAudio+=null===(o=e.getAudioConcealment())||void 0===o?void 0:o.totalAudioDuration)}),{audioTrackSummary:n,videoTrackSummary:t}}static buildJitter(e,t){if("inbound-rtp"===t.type){var n=null==t?void 0:t.jitter;if(void 0!==n){var r=_h.getNonNegativeValue(n);e.setJitter(Math.round(1e3*r))}else e.setJitter(-1)}}static buildAudioConcealment(e,t){if("inbound-rtp"===t.type){var n=1e3*(null==t?void 0:t.totalSamplesDuration)/(null==t?void 0:t.totalSamplesReceived)*(null==t?void 0:t.concealedSamples),r=1e3*(null==t?void 0:t.totalSamplesDuration);e.setAudioConcealment(n,r)}}}class _y{static build(e){var t={},n={download:0,upload:0},r={download:0,upload:0},i=0,o=0,s={local:new Map,remote:new Map},a={local:new Map,remote:new Map},l={local:new Map,remote:new Map},c=new Map,u=new Map,d=0,h=0,p=0,f=0,m=0,v=0;for(var[g,y]of e){var b=y.getLoss(),w=b.isDownloadStream?"download":"upload";if(n[w]+=b.packetsTotal,r[w]+=b.packetsLost,i+=y.getBitrate().download,o+=y.getBitrate().upload,"audio"===y.kind){var _=y.getAudioConcealment();m+=_.concealedAudio,v+=_.totalAudioDuration,d+=y.getBitrate().download,h+=y.getBitrate().upload}else p+=y.getBitrate().download,f+=y.getBitrate().upload;s[y.getType()].set(g,y.getResolution()),a[y.getType()].set(g,y.getFramerate()),l[y.getType()].set(g,y.getCodec()),"remote"===y.getType()&&(c.set(g,y.getJitter()),"audio"===y.kind&&u.set(g,y.getAudioConcealment())),y.resetBitrate()}return t.bitrate={upload:o,download:i},t.bitrate.audio={upload:h,download:d},t.bitrate.video={upload:f,download:p},t.packetLoss={total:_y.calculatePacketLoss(r.download+r.upload,n.download+n.upload),download:_y.calculatePacketLoss(r.download,n.download),upload:_y.calculatePacketLoss(r.upload,n.upload)},t.audioConcealment=u,t.totalAudioConcealment={concealedAudio:m,totalAudioDuration:v},t.framerate=a,t.resolution=s,t.codec=l,t.jitter=c,t}static calculatePacketLoss(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}}class Vd{static buildCallFeedReport(e,t,n){var r=n.getTransceivers(),i=[];return r.forEach(e=>{var t,n=null!==(t=e.sender)&&void 0!==t&&t.track?Vd.buildTrackStats(e.sender.track,"sender"):null,r=Vd.buildTrackStats(e.receiver.track,"receiver");i.push({mid:null==e.mid?"null":e.mid,direction:e.direction,currentDirection:null==e.currentDirection?"null":e.currentDirection,sender:n,receiver:r})}),{callId:e,opponentMemberId:t,transceiver:i,callFeeds:[]}}static buildTrackStats(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--",i=null===(t=e.getSettings())||void 0===t?void 0:t.deviceId,o=null===(n=e.getConstraints())||void 0===n?void 0:n.deviceId;return{id:e.id,kind:e.kind,settingDeviceId:i??"unknown",constrainDeviceId:o??"unknown",muted:e.muted,enabled:e.enabled,readyState:e.readyState,label:r}}static expandCallFeedReport(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return t.forEach(t=>{var r=t.stream.getAudioTracks(),i=t.stream.getVideoTracks(),o=r.length>0?Vd.buildTrackStats(t.stream.getAudioTracks()[0],t.purpose):null,s=i.length>0?Vd.buildTrackStats(t.stream.getVideoTracks()[0],t.purpose):null,a={stream:t.stream.id,type:t.isLocal()?"local":"remote",audio:o,video:s,purpose:t.purpose,prefix:n,isVideoMuted:t.isVideoMuted(),isAudioMuted:t.isAudioMuted()};e.callFeeds.push(a)}),e}}function _$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class z1e{constructor(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.callId=e,this.opponentMemberId=t,this.pc=n,this.emitter=r,this.isFocus=i,P(this,"isActive",!0),P(this,"previousStatsReport",void 0),P(this,"currentStatsReport",void 0),P(this,"connectionStats",new $1e),P(this,"trackStats",void 0),n.addEventListener("signalingstatechange",this.onSignalStateChange.bind(this)),this.trackStats=new K1e(new V1e,new q1e(n))}processStats(e,t){var n=this;return B(function*(){var r={isFirstCollection:void 0===n.previousStatsReport,receivedMedia:0,receivedAudioMedia:0,receivedVideoMedia:0,audioTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0},videoTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0}};if(n.isActive){var i=n.pc.getStats();if("function"==typeof(null==i?void 0:i.then))return i.then(i=>{var o,s;n.currentStatsReport="function"==typeof(null==i?void 0:i.result)?i.result():i;try{n.processStatsReport(e,t)}catch(e){return n.handleError(e),r}n.previousStatsReport=n.currentStatsReport,r.receivedMedia=n.connectionStats.bitrate.download,r.receivedAudioMedia=(null===(o=n.connectionStats.bitrate.audio)||void 0===o?void 0:o.download)||0,r.receivedVideoMedia=(null===(s=n.connectionStats.bitrate.video)||void 0===s?void 0:s.download)||0;var a=po.buildTrackSummary(Array.from(n.trackStats.getTrack2stats().values()));return g2(g2({},r),{},{audioTrackSummary:a.audioTrackSummary,videoTrackSummary:a.videoTrackSummary})}).catch(e=>(n.handleError(e),r));n.isActive=!1}return Promise.resolve(r)})()}processStatsReport(e,t){var n,r=new Map;r.callId=this.callId,r.opponentMemberId=this.opponentMemberId,null===(n=this.currentStatsReport)||void 0===n||n.forEach(e=>{var t=this.previousStatsReport?this.previousStatsReport.get(e.id):null;if("candidate-pair"===e.type&&e.nominated&&"succeeded"===e.state)this.connectionStats.bandwidth=B1e.buildBandwidthReport(e),this.connectionStats.transport=H1e.buildReport(this.currentStatsReport,e,this.connectionStats.transport,this.isFocus);else if("inbound-rtp"===e.type||"outbound-rtp"===e.type){var n=this.trackStats.findTrack2Stats(e,"inbound-rtp"===e.type?"remote":"local");if(!n)return;if(t&&po.buildPacketsLost(n,e,t),"inbound-rtp"===e.type){po.buildFramerateResolution(n,e),t&&po.buildBitrateReceived(n,e,t);var i=this.trackStats.findTransceiverByTrackId(n.trackId);po.setTrackStatsState(n,i),po.buildJitter(n,e),po.buildAudioConcealment(n,e)}else t&&(r.set(n.trackId,_h.getNonNegativeValue(e.bytesSent)),po.buildBitrateSend(n,e,t));po.buildCodec(this.currentStatsReport,n,e)}else if("track"===e.type&&"video"===e.kind&&!e.remoteSource){var o=this.trackStats.findLocalVideoTrackStats(e);if(!o)return;po.buildFramerateResolution(o,e),po.calculateSimulcastFramerate(o,e,t,this.trackStats.mediaTrackHandler.getActiveSimulcastStreams())}}),this.emitter.emitByteSendReport(r),this.emitter.emitCallFeedReport(Vd.buildCallFeedReport(this.callId,this.opponentMemberId,this.pc)),this.processAndEmitConnectionStatsReport()}setActive(e){this.isActive=e}getActive(){return this.isActive}handleError(e){this.isActive=!1,M.warn("CallStatsReportGatherer ".concat(this.callId," processStatsReport fails and set to inactive ").concat(e))}processAndEmitConnectionStatsReport(){var e=_y.build(this.trackStats.getTrack2stats());e.callId=this.callId,e.opponentMemberId=this.opponentMemberId,this.connectionStats.bandwidth=e.bandwidth,this.connectionStats.bitrate=e.bitrate,this.connectionStats.packetLoss=e.packetLoss,this.emitter.emitConnectionStatsReport(g2(g2({},e),{},{transport:this.connectionStats.transport})),this.connectionStats.transport=[]}stopProcessingStats(){}onSignalStateChange(){"stable"===this.pc.signalingState&&(this.pc.currentRemoteDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp,"remote"),this.pc.currentLocalDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp,"local"))}setOpponentMemberId(e){this.opponentMemberId=e}}var du=function(e){return e.CONNECTION_STATS="StatsReport.connection_stats",e.CALL_FEED_REPORT="StatsReport.call_feed_report",e.BYTE_SENT_STATS="StatsReport.byte_sent_stats",e.SUMMARY_STATS="StatsReport.summary_stats",e}({});class W1e extends Pn{emitByteSendReport(e){this.emit(du.BYTE_SENT_STATS,e)}emitConnectionStatsReport(e){this.emit(du.CONNECTION_STATS,e)}emitCallFeedReport(e){this.emit(du.CALL_FEED_REPORT,e)}emitSummaryStatsReport(e){this.emit(du.SUMMARY_STATS,e)}}class RJ{constructor(e){this.emitter=e}build(e){var t=e.filter(e=>!e.isFirstCollection),n=t.length,r=e.length;if(0!==n){var i={receivedAudio:0,receivedVideo:0,receivedMedia:0,concealedAudio:0,totalAudio:0},o=0,s=0;t.forEach(e=>{this.countTrackListReceivedMedia(i,e),this.countConcealedAudio(i,e),o=this.buildMaxJitter(o,e),s=this.buildMaxPacketLoss(s,e)});var a={percentageReceivedMedia:Number((i.receivedMedia/n).toFixed(5)),percentageReceivedVideoMedia:Number((i.receivedVideo/n).toFixed(5)),percentageReceivedAudioMedia:Number((i.receivedAudio/n).toFixed(5)),maxJitter:o,maxPacketLoss:s,percentageConcealedAudio:Number(i.totalAudio>0?(i.concealedAudio/i.totalAudio).toFixed(5):0),peerConnections:r};this.emitter.emitSummaryStatsReport(a)}}static extendSummaryReport(e,t){var n=[],r=[];for(var i of t)for(var o of(r.push(i),i[1]))n.push(o);e.opponentDevicesInCall=Math.max(0,n.length-1),e.opponentUsersInCall=Math.max(0,r.length-1),e.diffDevicesToPeerConnections=Math.max(0,n.length-1)-e.peerConnections,e.ratioPeerConnectionToDevices=0==Math.max(0,n.length-1)?0:e.peerConnections/(n.length-1)}countTrackListReceivedMedia(e,t){var n=!1,r=!1;(t.receivedAudioMedia>0||0===t.audioTrackSummary.count)&&(e.receivedAudio++,n=!0),(t.receivedVideoMedia>0||0===t.videoTrackSummary.count||t.videoTrackSummary.muted>0&&t.videoTrackSummary.muted===t.videoTrackSummary.count)&&(e.receivedVideo++,r=!0),r&&n&&e.receivedMedia++}buildMaxJitter(e,t){return e<t.videoTrackSummary.maxJitter&&(e=t.videoTrackSummary.maxJitter),e<t.audioTrackSummary.maxJitter&&(e=t.audioTrackSummary.maxJitter),e}buildMaxPacketLoss(e,t){return e<t.videoTrackSummary.maxPacketLoss&&(e=t.videoTrackSummary.maxPacketLoss),e<t.audioTrackSummary.maxPacketLoss&&(e=t.audioTrackSummary.maxPacketLoss),e}countConcealedAudio(e,t){e.concealedAudio+=t.audioTrackSummary.concealedAudio,e.totalAudio+=t.audioTrackSummary.totalAudio}}class Y1e{constructor(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;this.groupCallId=e,this.userId=t,this.interval=n,P(this,"timer",void 0),P(this,"gatherers",new Map),P(this,"reports",new W1e),P(this,"summaryStatsReportGatherer",new RJ(this.reports))}start(){void 0===this.timer&&this.interval>0&&(this.timer=setInterval(()=>{this.processStats()},this.interval))}stop(){void 0!==this.timer&&(clearInterval(this.timer),this.gatherers.forEach(e=>e.stopProcessingStats()))}hasStatsReportGatherer(e){return this.gatherers.has(e)}addStatsReportGatherer(e,t,n){return!this.hasStatsReportGatherer(e)&&(this.gatherers.set(e,new z1e(e,t,n,this.reports)),!0)}removeStatsReportGatherer(e){return this.gatherers.delete(e)}getStatsReportGatherer(e){return this.hasStatsReportGatherer(e)?this.gatherers.get(e):void 0}updateOpponentMember(e,t){var n;null===(n=this.getStatsReportGatherer(e))||void 0===n||n.setOpponentMemberId(t)}processStats(){var e=[];this.gatherers.forEach(t=>{e.push(t.processStats(this.groupCallId,this.userId))}),Promise.all(e).then(e=>this.summaryStatsReportGatherer.build(e)).catch(e=>{M.error("Could not build summary stats report",e)})}setInterval(e){this.interval=e}}function S$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var IJ=function(e){return e.Ring="m.ring",e.Prompt="m.prompt",e.Room="m.room",e}({}),H3=function(e){return e.Video="m.video",e.Voice="m.voice",e}({}),X1e=function(e){return e.CallEnded="call_ended",e}({}),Rn=function(e){return e.GroupCallStateChanged="group_call_state_changed",e.ActiveSpeakerChanged="active_speaker_changed",e.CallsChanged="calls_changed",e.UserMediaFeedsChanged="user_media_feeds_changed",e.ScreenshareFeedsChanged="screenshare_feeds_changed",e.LocalScreenshareStateChanged="local_screenshare_state_changed",e.LocalMuteStateChanged="local_mute_state_changed",e.ParticipantsChanged="participants_changed",e.Error="group_call_error",e}({}),iy=function(e){return e.ConnectionStats="GroupCall.connection_stats",e.ByteSentStats="GroupCall.byte_sent_stats",e.SummaryStats="GroupCall.summary_stats",e.CallFeedStats="GroupCall.call_feed_stats",e}({}),Sy=function(e){return e.NoUserMedia="no_user_media",e.UnknownDevice="unknown_device",e.PlaceCallFailed="place_call_failed",e}({});class J5 extends Error{constructor(e,t,n){n?(super(t+": "+n),P(this,"code",void 0)):(super(t),P(this,"code",void 0)),this.code=e}}class kJ extends J5{constructor(e){super(Sy.UnknownDevice,"No device found for "+e),this.userId=e}}var er=function(e){return e.LocalCallFeedUninitialized="local_call_feed_uninitialized",e.InitializingLocalCallFeed="initializing_local_call_feed",e.LocalCallFeedInitialized="local_call_feed_initialized",e.Entered="entered",e.Ended="ended",e}({}),E$=36e5;function y2(e){var t;return(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId)||e.invitee||null}class $P extends Pn{constructor(e,t,n,r,i,o,s,a,l){var c,u,d=arguments.length>9&&void 0!==arguments[9]&&arguments[9],h=arguments.length>10?arguments[10]:void 0;super(),this.client=e,this.room=t,this.type=n,this.isPtt=r,this.intent=i,this.dataChannelsEnabled=s,this.dataChannelOptions=a,this.useLivekit=d,P(this,"activeSpeakerInterval",1e3),P(this,"retryCallInterval",5e3),P(this,"participantTimeout",15e3),P(this,"pttMaxTransmitTime",2e4),P(this,"activeSpeaker",void 0),P(this,"localCallFeed",void 0),P(this,"localScreenshareFeed",void 0),P(this,"localDesktopCapturerSourceId",void 0),P(this,"userMediaFeeds",[]),P(this,"screenshareFeeds",[]),P(this,"groupCallId",void 0),P(this,"allowCallWithoutVideoAndAudio",void 0),P(this,"calls",new Map),P(this,"callHandlers",new Map),P(this,"activeSpeakerLoopInterval",void 0),P(this,"retryCallLoopInterval",void 0),P(this,"retryCallCounts",new Map),P(this,"reEmitter",void 0),P(this,"transmitTimer",null),P(this,"participantsExpirationTimer",null),P(this,"resendMemberStateTimer",null),P(this,"initWithAudioMuted",!1),P(this,"initWithVideoMuted",!1),P(this,"initCallFeedPromise",void 0),P(this,"_livekitServiceURL",void 0),P(this,"stats",void 0),P(this,"statsCollectIntervalTime",0),P(this,"onConnectionStats",e=>{this.emit(iy.ConnectionStats,{report:e})}),P(this,"onByteSentStats",e=>{this.emit(iy.ByteSentStats,{report:e})}),P(this,"onSummaryStats",e=>{RJ.extendSummaryReport(e,this.participants),this.emit(iy.SummaryStats,{report:e})}),P(this,"onCallFeedReport",e=>{this.localCallFeed&&(e=Vd.expandCallFeedReport(e,[this.localCallFeed],"from-local-feed"));var t=[];this.forEachCall(n=>{n.callId===e.callId&&n.getFeeds().forEach(e=>t.push(e))}),e=Vd.expandCallFeedReport(e,t,"from-call-feed"),this.emit(iy.CallFeedStats,{report:e})}),P(this,"_state",er.LocalCallFeedUninitialized),P(this,"_participants",new Map),P(this,"_creationTs",null),P(this,"_enteredViaAnotherSession",!1),P(this,"onIncomingCall",e=>{var t,n;if(e.roomId===this.room.roomId){if(e.state!==dt.Ringing)return void M.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call no longer in ringing state - ignoring"));if(!e.groupCallId||e.groupCallId!==this.groupCallId)return M.log("GroupCall ".concat(this.groupCallId," onIncomingCall() ignored because it doesn't match the current group call")),void e.reject();var r=null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId;if(void 0===r)return void M.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call with no member - ignoring"));if(this.useLivekit)return void M.info("Received incoming call whilst in signaling-only mode! Ignoring.");var i=null!==(n=this.calls.get(r))&&void 0!==n?n:new Map,o=i.get(e.getOpponentDeviceId());if((null==o?void 0:o.callId)!==e.callId){M.log("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call (userId=").concat(r,", callId=").concat(e.callId,")")),o&&o.hangup(mt.Replaced,!1),i.set(e.getOpponentDeviceId(),e),this.calls.set(r,i),this.initCall(e);var s=this.getLocalFeeds().map(e=>e.clone());if(!this.callExpected(e))for(var a of s)Mr(a.stream.getAudioTracks(),!1),Mr(a.stream.getVideoTracks(),!1);e.answerWithCallFeeds(s),this.emit(Rn.CallsChanged,this.calls)}}}),P(this,"onRetryCallLoop",()=>{var e=!1;for(var[{userId:t},n]of this.participants){var r=this.calls.get(t),i=this.retryCallCounts.get(t);for(var[o,s]of n){var a,l,c=null==r?void 0:r.get(o),u=null!==(a=null===(l=i)||void 0===l?void 0:l.get(o))&&void 0!==a?a:0;(null==c?void 0:c.getOpponentSessionId())!==s.sessionId&&this.wantsOutgoingCall(t,o)&&u<3&&(void 0===i&&(i=new Map,this.retryCallCounts.set(t,i)),i.set(o,u+1),e=!0)}}e&&this.placeOutgoingCalls()}),P(this,"onCallFeedsChanged",e=>{var t=y2(e),n=e.getOpponentDeviceId();if(!t)throw new Error("Cannot change call feeds without user id");var r=this.getUserMediaFeed(t,n),i=e.remoteUsermediaFeed,o=i!==r,s=this.calls.get(t),a=null==s?void 0:s.get(n);if((null==a?void 0:a.callId)===e.callId){o&&(!r&&i?this.addUserMediaFeed(i):r&&i?this.replaceUserMediaFeed(r,i):r&&!i&&this.removeUserMediaFeed(r));var l=this.getScreenshareFeed(t,n),c=e.remoteScreensharingFeed;c!==l&&(!l&&c?this.addScreenshareFeed(c):l&&c?this.replaceScreenshareFeed(l,c):l&&!c&&this.removeScreenshareFeed(l))}}),P(this,"onCallStateChanged",(e,t,n)=>{var r;if(t!==dt.Ended){var i=this.localCallFeed.isAudioMuted();e.localUsermediaStream&&e.isMicrophoneMuted()!==i&&e.setMicrophoneMuted(i);var o=this.localCallFeed.isVideoMuted();e.localUsermediaStream&&e.isLocalVideoMuted()!==o&&e.setLocalVideoMuted(o);var s=null===(r=e.getOpponentMember())||void 0===r?void 0:r.userId;if(t===dt.Connected&&s){var a=this.retryCallCounts.get(s);null==a||a.delete(e.getOpponentDeviceId()),0===(null==a?void 0:a.size)&&this.retryCallCounts.delete(s)}}}),P(this,"onCallHangup",e=>{var t,n;if(e.hangupReason!==mt.Replaced){var r=null!==(t=null===(n=e.getOpponentMember())||void 0===n?void 0:n.userId)&&void 0!==t?t:this.room.getMember(e.invitee).userId,i=this.calls.get(r);(null==i?void 0:i.get(e.getOpponentDeviceId()))===e&&(this.disposeCall(e,e.hangupReason),i.delete(e.getOpponentDeviceId()),0===i.size&&this.calls.delete(r),this.emit(Rn.CallsChanged,this.calls))}}),P(this,"onCallReplaced",(e,t)=>{var n=e.getOpponentMember().userId,r=this.calls.get(n);void 0===r&&(r=new Map,this.calls.set(n,r)),e.hangup(mt.Replaced,!1),this.initCall(t),r.set(e.getOpponentDeviceId(),t),this.emit(Rn.CallsChanged,this.calls)}),P(this,"onActiveSpeakerLoop",()=>{var e=void 0,t=void 0;for(var n of this.userMediaFeeds)if(!(n.isLocal()&&this.userMediaFeeds.length>1)){var r=n.speakingVolumeSamples.reduce((e,t)=>e+Math.max(t,W5))/n.speakingVolumeSamples.length;(!e||r>e)&&(e=r,t=n)}t&&this.activeSpeaker!==t&&e&&e>W5&&(this.activeSpeaker=t,this.emit(Rn.ActiveSpeakerChanged,this.activeSpeaker))}),P(this,"onRoomState",()=>this.updateParticipants()),P(this,"onParticipantsChanged",()=>{this.forEachCall(e=>{var t=this.callExpected(e);for(var n of e.getLocalFeeds())Mr(n.stream.getAudioTracks(),!n.isAudioMuted()&&t),Mr(n.stream.getVideoTracks(),!n.isVideoMuted()&&t)}),this.state===er.Entered&&!this.useLivekit&&this.placeOutgoingCalls()}),P(this,"onStateChanged",(e,t)=>{(e===er.Entered||t===er.Entered||e===er.Ended)&&(this.updateParticipants(),this.updateMemberState().catch(e=>M.error("GroupCall ".concat(this.groupCallId,' onStateChanged() failed to update member state devices"'),e)))}),P(this,"onLocalFeedsChanged",()=>{this.state===er.Entered&&this.updateMemberState().catch(e=>M.error("GroupCall ".concat(this.groupCallId," onLocalFeedsChanged() failed to update member state feeds"),e))}),this.reEmitter=new WX(this),this.groupCallId=o??Sh(),this._livekitServiceURL=h,this.creationTs=null!==(c=null===(u=t.currentState.getStateEvents(ee.GroupCallPrefix,this.groupCallId))||void 0===u?void 0:u.getTs())&&void 0!==c?c:null,this.updateParticipants(),t.on(vt.Update,this.onRoomState),this.on(Rn.ParticipantsChanged,this.onParticipantsChanged),this.on(Rn.GroupCallStateChanged,this.onStateChanged),this.on(Rn.LocalScreenshareStateChanged,this.onLocalFeedsChanged),this.allowCallWithoutVideoAndAudio=!!l}create(){var e=this;return B(function*(){return e.creationTs=Date.now(),e.client.groupCallEventHandler.groupCalls.set(e.room.roomId,e),e.client.emit(X5.Outgoing,e),yield e.sendCallStateEvent(),e})()}sendCallStateEvent(){var e=this;return B(function*(){var t={"m.intent":e.intent,"m.type":e.type,"io.element.ptt":e.isPtt,dataChannelsEnabled:e.dataChannelsEnabled,dataChannelOptions:e.dataChannelsEnabled?e.dataChannelOptions:void 0};e.livekitServiceURL&&(t["io.element.livekit_service_url"]=e.livekitServiceURL),yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallPrefix,t,e.groupCallId)})()}get livekitServiceURL(){return this._livekitServiceURL}updateLivekitServiceURL(e){return this._livekitServiceURL=e,this.sendCallStateEvent()}get state(){return this._state}set state(e){var t=this._state;e!==t&&(this._state=e,this.emit(Rn.GroupCallStateChanged,e,t))}get participants(){return this._participants}set participants(e){var t=this._participants,n=(e,t)=>e.sessionId===t.sessionId&&e.screensharing===t.screensharing;CF(e,t,(e,t)=>CF(e,t,n))||(this._participants=e,this.emit(Rn.ParticipantsChanged,e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(var t of this.calls.values())for(var n of t.values())e(n)}getLocalFeeds(){var e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e,t;return null!==(e=null===(t=this.participants.get(this.room.getMember(this.client.getUserId())))||void 0===t?void 0:t.has(this.client.getDeviceId()))&&void 0!==e&&e}callExpected(e){var t,n=y2(e),r=null===n?null:this.room.getMember(n),i=e.getOpponentDeviceId();return null!==r&&void 0!==i&&void 0!==(null===(t=this.participants.get(r))||void 0===t?void 0:t.get(i))}initLocalCallFeed(){var e=this;return B(function*(){if(e.useLivekit)M.info("Livekit group call: not starting local call feed.");else{if(e.state!==er.LocalCallFeedUninitialized)throw new Error('Cannot initialize local call feed in the "'.concat(e.state,'" state.'));if(e.state=er.InitializingLocalCallFeed,e.initCallFeedPromise)return e.initCallFeedPromise;try{e.initCallFeedPromise=e.initLocalCallFeedInternal(),yield e.initCallFeedPromise}finally{e.initCallFeedPromise=void 0}}})()}initLocalCallFeedInternal(){var e=this;return B(function*(){var t;M.log("GroupCall ".concat(e.groupCallId," initLocalCallFeedInternal() running"));try{t=yield e.client.getMediaHandler().getUserMediaStream(!0,e.type===H3.Video)}catch(n){if(!e.allowCallWithoutVideoAndAudio)throw e.state=er.LocalCallFeedUninitialized,n;t=new MediaStream}if(e._state!==er.InitializingLocalCallFeed)throw e.client.getMediaHandler().stopUserMediaStream(t),new Error("Group call disposed while gathering media stream");var n=new nu({client:e.client,roomId:e.room.roomId,userId:e.client.getUserId(),deviceId:e.client.getDeviceId(),stream:t,purpose:In.Usermedia,audioMuted:e.initWithAudioMuted||0===t.getAudioTracks().length||e.isPtt,videoMuted:e.initWithVideoMuted||0===t.getVideoTracks().length});Mr(t.getAudioTracks(),!n.isAudioMuted()),Mr(t.getVideoTracks(),!n.isVideoMuted()),e.localCallFeed=n,e.addUserMediaFeed(n),e.state=er.LocalCallFeedInitialized})()}updateLocalUsermediaStream(e){var t=this;return B(function*(){if(t.localCallFeed){var n=t.localCallFeed.stream;t.localCallFeed.setNewStream(e);var r=t.localCallFeed.isAudioMuted(),i=t.localCallFeed.isVideoMuted();M.log("GroupCall ".concat(t.groupCallId," updateLocalUsermediaStream() (oldStreamId=").concat(n.id,", newStreamId=").concat(e.id,", micShouldBeMuted=").concat(r,", vidShouldBeMuted=").concat(i,")")),Mr(e.getAudioTracks(),!r),Mr(e.getVideoTracks(),!i),t.client.getMediaHandler().stopUserMediaStream(n)}})()}enter(){var e=this;return B(function*(){if(e.state===er.LocalCallFeedUninitialized)yield e.initLocalCallFeed();else if(e.state!==er.LocalCallFeedInitialized)throw new Error('Cannot enter call in the "'.concat(e.state,'" state'));for(var t of(M.log("GroupCall ".concat(e.groupCallId," enter() running")),e.state=er.Entered,e.client.on(Y5.Incoming,e.onIncomingCall),e.client.callEventHandler.calls.values()))e.onIncomingCall(t);e.useLivekit||(e.retryCallLoopInterval=setInterval(e.onRetryCallLoop,e.retryCallInterval),e.activeSpeaker=void 0,e.onActiveSpeakerLoop(),e.activeSpeakerLoopInterval=setInterval(e.onActiveSpeakerLoop,e.activeSpeakerInterval))})()}dispose(){var e;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),null!==this.transmitTimer&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),void 0!==this.retryCallLoopInterval&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===er.Entered&&(this.forEachCall(e=>e.hangup(mt.UserHangup,!1)),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(Y5.Incoming,this.onIncomingCall),null===(e=this.stats)||void 0===e||e.stop())}leave(){this.dispose(),this.state=er.LocalCallFeedUninitialized}terminate(){var e=arguments,t=this;return B(function*(){var n=!(e.length>0&&void 0!==e[0])||e[0];if(t.dispose(),t.room.off(vt.Update,t.onRoomState),t.client.groupCallEventHandler.groupCalls.delete(t.room.roomId),t.client.emit(X5.Ended,t),t.state=er.Ended,n){var r=t.room.currentState.getStateEvents(ee.GroupCallPrefix,t.groupCallId);yield t.client.sendStateEvent(t.room.roomId,ee.GroupCallPrefix,v2(v2({},r.getContent()),{},{"m.terminated":X1e.CallEnded}),t.groupCallId)}})()}isLocalVideoMuted(){return!this.localCallFeed||this.localCallFeed.isVideoMuted()}isMicrophoneMuted(){return!this.localCallFeed||this.localCallFeed.isAudioMuted()}setMicrophoneMuted(e){var t=this;return B(function*(){if(!e&&!(yield t.client.getMediaHandler().hasAudioDevice()))return!1;var n=!e&&t.isPtt;t.isPtt&&(!e&&t.isMicrophoneMuted()?t.transmitTimer=setTimeout(()=>{t.setMicrophoneMuted(!0)},t.pttMaxTransmitTime):e&&!t.isMicrophoneMuted()&&(null!==t.transmitTimer&&clearTimeout(t.transmitTimer),t.transmitTimer=null)),t.forEachCall(t=>{var n;return null===(n=t.localUsermediaFeed)||void 0===n?void 0:n.setAudioVideoMuted(e,null)});var r,i=(r=B(function*(){var e=[];t.forEachCall(t=>e.push(t.sendMetadataUpdate())),yield Promise.all(e).catch(e=>M.info("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() failed to send some metadata updates"),e))}),function(){return r.apply(this,arguments)});if(n&&(yield i()),t.localCallFeed){if(M.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() (streamId=").concat(t.localCallFeed.stream.id,", muted=").concat(e,")")),!(yield t.checkAudioPermissionIfNecessary(e)))return!1;t.localCallFeed.setAudioVideoMuted(e,null),Mr(t.localCallFeed.stream.getAudioTracks(),!e)}else M.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no stream muted (muted=").concat(e,")")),t.initWithAudioMuted=e;return t.forEachCall(n=>Mr(n.localUsermediaFeed.stream.getAudioTracks(),!e&&t.callExpected(n))),t.emit(Rn.LocalMuteStateChanged,e,t.isLocalVideoMuted()),n||(yield i()),!0})()}checkAudioPermissionIfNecessary(e){var t=this;return B(function*(){try{if(!e&&t.localCallFeed&&!t.localCallFeed.hasAudioTrack){var n=yield t.client.getMediaHandler().getUserMediaStream(!0,!t.localCallFeed.isVideoMuted());if(0===(null==n?void 0:n.getTracks().length))return M.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no device to receive local stream, muted=").concat(e)),!1}}catch{return M.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no device or permission to receive local stream, muted=").concat(e)),!1}return!0})()}setLocalVideoMuted(e){var t=this;return B(function*(){if(!e&&!(yield t.client.getMediaHandler().hasVideoDevice()))return!1;if(t.localCallFeed){M.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() (stream=").concat(t.localCallFeed.stream.id,", muted=").concat(e,")"));try{var n=yield t.client.getMediaHandler().getUserMediaStream(!0,!e);yield t.updateLocalUsermediaStream(n),t.localCallFeed.setAudioVideoMuted(null,e),Mr(t.localCallFeed.stream.getVideoTracks(),!e)}catch{return M.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() no device or permission to receive local stream, muted=").concat(e)),!1}}else M.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() no stream muted (muted=").concat(e,")")),t.initWithVideoMuted=e;var r=[];return t.forEachCall(t=>r.push(t.setLocalVideoMuted(e))),yield Promise.all(r),t.forEachCall(n=>Mr(n.localUsermediaFeed.stream.getVideoTracks(),!e&&t.callExpected(n))),t.emit(Rn.LocalMuteStateChanged,t.isMicrophoneMuted(),e),!0})()}setScreensharingEnabled(e){var t=arguments,n=this;return B(function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};if(e===n.isScreensharing())return e;if(!e)return n.forEachCall(e=>{e.localScreensharingFeed&&e.removeLocalFeed(e.localScreensharingFeed)}),n.client.getMediaHandler().stopScreensharingStream(n.localScreenshareFeed.stream),n.removeScreenshareFeed(n.localScreenshareFeed),n.localScreenshareFeed=void 0,n.localDesktopCapturerSourceId=void 0,n.emit(Rn.LocalScreenshareStateChanged,!1,void 0,void 0),!1;try{M.log("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() is asking for screensharing permissions"));var i=yield n.client.getMediaHandler().getScreensharingStream(r),o=function*(e){var t=()=>{n.setScreensharingEnabled(!1),e.removeEventListener("ended",t)};e.addEventListener("ended",t)};for(var s of i.getTracks())yield*o(s);return M.log("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() granted screensharing permissions. Setting screensharing enabled on all calls")),n.localDesktopCapturerSourceId=r.desktopCapturerSourceId,n.localScreenshareFeed=new nu({client:n.client,roomId:n.room.roomId,userId:n.client.getUserId(),deviceId:n.client.getDeviceId(),stream:i,purpose:In.Screenshare,audioMuted:!1,videoMuted:!1}),n.addScreenshareFeed(n.localScreenshareFeed),n.emit(Rn.LocalScreenshareStateChanged,!0,n.localScreenshareFeed,n.localDesktopCapturerSourceId),n.forEachCall(e=>e.pushLocalFeed(n.localScreenshareFeed.clone())),!0}catch(e){if(r.throwOnFail)throw e;return M.error("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() enabling screensharing error"),e),n.emit(Rn.Error,new J5(Sy.NoUserMedia,"Failed to get screen-sharing stream: ",e)),!1}})()}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,t){var n=this.client.getUserId(),r=this.client.getDeviceId();return e>=n&&(e!==n||t>r)}placeOutgoingCalls(){var e=this,t=!1,n=function(n){var r,o=null!==(r=e.calls.get(n))&&void 0!==r?r:new Map,s=function(r){var i=o.get(r);if((null==i?void 0:i.getOpponentSessionId())!==l.sessionId&&e.wantsOutgoingCall(n,r)){t=!0,void 0!==i&&(M.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() replacing call (userId=").concat(n,", deviceId=").concat(r,", callId=").concat(i.callId,")")),i.hangup(mt.NewSession,!1));var s=sb(e.client,e.room.roomId,{invitee:n,opponentDeviceId:r,opponentSessionId:l.sessionId,groupCallId:e.groupCallId});null===s?(M.error("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to create call (userId=").concat(n,", device=").concat(r,")")),o.delete(r)):(e.initCall(s),o.set(r,s),M.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() placing call (userId=").concat(n,", deviceId=").concat(r,", sessionId=").concat(l.sessionId,")")),s.placeCallWithCallFeeds(e.getLocalFeeds().map(e=>e.clone()),l.screensharing).then(()=>{e.dataChannelsEnabled&&s.createDataChannel("datachannel",e.dataChannelOptions)}).catch(t=>{M.warn("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to place call (userId=").concat(n,")"),t),t instanceof Vl&&t.code===Sy.UnknownDevice?e.emit(Rn.Error,t):e.emit(Rn.Error,new J5(Sy.PlaceCallFailed,"Failed to place call to ".concat(n))),s.hangup(mt.SignallingFailed,!1),o.get(r)===s&&o.delete(r)}))}};for(var[a,l]of i)s(a);o.size>0?e.calls.set(n,o):e.calls.delete(n)};for(var[{userId:r},i]of this.participants)n(r);t&&this.emit(Rn.CallsChanged,this.calls)}getMemberStateEvents(e){return void 0===e?this.room.currentState.getStateEvents(ee.GroupCallMemberPrefix):this.room.currentState.getStateEvents(ee.GroupCallMemberPrefix,e)}initCall(e){var t=y2(e);if(!t)throw new Error("Cannot init call without user id");var n=()=>this.onCallFeedsChanged(e),r=(t,n)=>this.onCallStateChanged(e,t,n),i=this.onCallHangup,o=t=>this.onCallReplaced(e,t),s=this.callHandlers.get(t);void 0===s&&(s=new Map,this.callHandlers.set(t,s)),s.set(e.getOpponentDeviceId(),{onCallFeedsChanged:n,onCallStateChanged:r,onCallHangup:i,onCallReplaced:o}),e.on(bt.FeedsChanged,n),e.on(bt.State,r),e.on(bt.Hangup,i),e.on(bt.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(bt)),e.initStats(this.getGroupCallStats()),n()}disposeCall(e,t){var n=y2(e),r=e.getOpponentDeviceId();if(!n)throw new Error("Cannot dispose call without user id");var i=this.callHandlers.get(n),{onCallFeedsChanged:o,onCallStateChanged:s,onCallHangup:a,onCallReplaced:l}=i.get(r);if(e.removeListener(bt.FeedsChanged,o),e.removeListener(bt.State,s),e.removeListener(bt.Hangup,a),e.removeListener(bt.Replaced,l),i.delete(n),0===i.size&&this.callHandlers.delete(n),e.hangupReason!==mt.Replaced){var c=this.getUserMediaFeed(n,r);c&&this.removeUserMediaFeed(c);var u=this.getScreenshareFeed(n,r);u&&this.removeScreenshareFeed(u)}}getUserMediaFeed(e,t){return this.userMediaFeeds.find(n=>n.userId===e&&n.deviceId===t)}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit(Rn.UserMediaFeedsChanged,this.userMediaFeeds)}replaceUserMediaFeed(e,t){var n=this.userMediaFeeds.findIndex(t=>t.userId===e.userId&&t.deviceId===e.deviceId);if(-1===n)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(n,1,t),e.dispose(),t.measureVolumeActivity(!0),this.emit(Rn.UserMediaFeedsChanged,this.userMediaFeeds)}removeUserMediaFeed(e){var t=this.userMediaFeeds.findIndex(t=>t.userId===e.userId&&t.deviceId===e.deviceId);if(-1===t)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(t,1),e.dispose(),this.emit(Rn.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit(Rn.ActiveSpeakerChanged,this.activeSpeaker))}getScreenshareFeed(e,t){return this.screenshareFeeds.find(n=>n.userId===e&&n.deviceId===t)}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit(Rn.ScreenshareFeedsChanged,this.screenshareFeeds)}replaceScreenshareFeed(e,t){var n=this.screenshareFeeds.findIndex(t=>t.userId===e.userId&&t.deviceId===e.deviceId);if(-1===n)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(n,1,t),e.dispose(),this.emit(Rn.ScreenshareFeedsChanged,this.screenshareFeeds)}removeScreenshareFeed(e){var t=this.screenshareFeeds.findIndex(t=>t.userId===e.userId&&t.deviceId===e.deviceId);if(-1===t)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(t,1),e.dispose(),this.emit(Rn.ScreenshareFeedsChanged,this.screenshareFeeds)}updateParticipants(){var e=this.room.getMember(this.client.getSafeUserId());if(e)if(null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state!==er.Ended){var t=new Map,n=Date.now(),r=this.state===er.Entered||this.enteredViaAnotherSession,i=1/0;for(var o of this.getMemberStateEvents()){var s=this.room.getMember(o.getStateKey()),a=o.getContent(),l=(Array.isArray(a["m.calls"])?a["m.calls"]:[]).find(e=>e["m.call_id"]===this.groupCallId),c=(Array.isArray(null==l?void 0:l["m.devices"])?l["m.devices"]:[]).filter(e=>"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>n&&Array.isArray(e.feeds));if(!r&&(null==s?void 0:s.userId)===this.client.getUserId()&&(c=c.filter(e=>e.device_id!==this.client.getDeviceId())),c.length>0&&(null==s?void 0:s.membership)===Ve.Join){var u=new Map;for(var d of(t.set(s,u),c))u.set(d.device_id,{sessionId:d.session_id,screensharing:d.feeds.some(e=>e.purpose===In.Screenshare)}),d.expires_ts<i&&(i=d.expires_ts)}}if(r){var h=t.get(e);void 0===h&&(h=new Map,t.set(e,h)),h.has(this.client.getDeviceId())||h.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some(e=>e.purpose===In.Screenshare)})}this.participants=t,i<1/0&&(this.participantsExpirationTimer=setTimeout(()=>this.updateParticipants(),i-n))}else this.participants=new Map;else M.warn("GroupCall ".concat(this.groupCallId," updateParticipants() tried to update participants before local room member is available"))}updateDevices(e){var t=arguments,n=this;return B(function*(){var r,i=t.length>1&&void 0!==t[1]&&t[1],o=Date.now(),s=n.client.getUserId(),a=n.getMemberStateEvents(s),l=null!==(r=null==a?void 0:a.getContent())&&void 0!==r?r:{},c=Array.isArray(l["m.calls"])?l["m.calls"]:[],u=null,d=[];for(var h of c)h["m.call_id"]===n.groupCallId?u=h:d.push(h);null===u&&(u={});var p=(Array.isArray(u["m.devices"])?u["m.devices"]:[]).filter(e=>"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>o&&Array.isArray(e.feeds)),f=e(p);if(null!==f){var m=[...d];f.length>0&&m.push(v2(v2({},u),{},{"m.call_id":n.groupCallId,"m.devices":f}));var v={"m.calls":m};yield n.client.sendStateEvent(n.room.roomId,ee.GroupCallMemberPrefix,v,s,{keepAlive:i})}})()}addDeviceToMemberState(){var e=this;return B(function*(){yield e.updateDevices(t=>[...t.filter(t=>t.device_id!==e.client.getDeviceId()),{device_id:e.client.getDeviceId(),session_id:e.client.getSessionId(),expires_ts:Date.now()+E$,feeds:e.getLocalFeeds().map(e=>({purpose:e.purpose}))}])})()}updateMemberState(){var e=this;return B(function*(){null!==e.resendMemberStateTimer&&(clearInterval(e.resendMemberStateTimer),e.resendMemberStateTimer=null),e.state===er.Entered?(yield e.addDeviceToMemberState(),e.resendMemberStateTimer=setInterval(B(function*(){M.log("GroupCall ".concat(e.groupCallId,' updateMemberState() resending call member state"'));try{yield e.addDeviceToMemberState()}catch(t){M.error("GroupCall ".concat(e.groupCallId," updateMemberState() failed to resend call member state"),t)}}),3*E$/4)):yield e.updateDevices(t=>t.filter(t=>t.device_id!==e.client.getDeviceId()),!0)})()}cleanMemberState(){var e=this;return B(function*(){var{devices:t}=yield e.client.getDevices(),n=new Map(t.map(e=>[e.device_id,e]));yield e.updateDevices(t=>{var r=t.filter(t=>{var r=n.get(t.device_id);return void 0!==(null==r?void 0:r.last_seen_ts)&&!(t.device_id===e.client.getDeviceId()&&e.state!==er.Entered&&!e.enteredViaAnotherSession)});return r.length===t.length?null:r})})()}getGroupCallStats(){if(void 0===this.stats){var e=this.client.getUserId()||"unknown";this.stats=new Y1e(this.groupCallId,e,this.statsCollectIntervalTime),this.stats.reports.on(du.CONNECTION_STATS,this.onConnectionStats),this.stats.reports.on(du.BYTE_SENT_STATS,this.onByteSentStats),this.stats.reports.on(du.SUMMARY_STATS,this.onSummaryStats),this.stats.reports.on(du.CALL_FEED_REPORT,this.onCallFeedReport)}return this.stats}setGroupCallStatsInterval(e){this.statsCollectIntervalTime=e,void 0!==this.stats&&(this.stats.stop(),this.stats.setInterval(e),e>0&&this.stats.start())}}function w$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var dt=function(e){return e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended",e}({}),C$=function(e){return e.Voice="voice",e.Video="video",e}({}),Id=function(e){return e.Inbound="inbound",e.Outbound="outbound",e}({}),ur=function(e){return e.Local="local",e.Remote="remote",e}({}),bt=function(e){return e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold",e.FeedsChanged="feeds_changed",e.AssertedIdentityChanged="asserted_identity_changed",e.LengthChanged="length_changed",e.DataChannel="datachannel",e.SendVoipEvent="send_voip_event",e.PeerConnectionCreated="peer_connection_created",e}({}),mt=function(e){return e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.CreateOffer="create_offer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout",e.UserBusy="user_busy",e.Transferred="transferred",e.NewSession="new_session",e}({}),J1e="1",Q1e="stun:turn.matrix.org",yk=6e4,Z1e=1e3,e0e=3e4,t0e=2e3;class Vl extends Error{constructor(e,t,n){super(t+": "+n),P(this,"code",void 0),this.code=e}}function Sh(){return Date.now().toString()+Eo(16)}function T$(e){return[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:e?12e3:void 0}]}function La(e,t){return e+":"+t}class n0e extends Pn{constructor(e){var t,n;if(super(),t=this,P(this,"roomId",void 0),P(this,"callId",void 0),P(this,"invitee",void 0),P(this,"hangupParty",void 0),P(this,"hangupReason",void 0),P(this,"direction",void 0),P(this,"ourPartyId",void 0),P(this,"peerConn",void 0),P(this,"toDeviceSeq",0),P(this,"isPtt",!1),P(this,"_state",dt.Fledgling),P(this,"client",void 0),P(this,"forceTURN",void 0),P(this,"turnServers",void 0),P(this,"candidateSendQueue",[]),P(this,"candidateSendTries",0),P(this,"candidatesEnded",!1),P(this,"feeds",[]),P(this,"transceivers",new Map),P(this,"inviteOrAnswerSent",!1),P(this,"waitForLocalAVStream",!1),P(this,"successor",void 0),P(this,"opponentMember",void 0),P(this,"opponentVersion",void 0),P(this,"opponentPartyId",void 0),P(this,"opponentCaps",void 0),P(this,"iceDisconnectedTimeout",void 0),P(this,"iceReconnectionTimeOut",void 0),P(this,"inviteTimeout",void 0),P(this,"removeTrackListeners",new Map),P(this,"remoteOnHold",!1),P(this,"callStatsAtEnd",void 0),P(this,"makingOffer",!1),P(this,"ignoreOffer",!1),P(this,"isSettingRemoteAnswerPending",!1),P(this,"responsePromiseChain",void 0),P(this,"remoteCandidateBuffer",new Map),P(this,"remoteAssertedIdentity",void 0),P(this,"remoteSDPStreamMetadata",void 0),P(this,"callLengthInterval",void 0),P(this,"callStartTime",void 0),P(this,"opponentDeviceId",void 0),P(this,"hasOpponentDeviceInfo",void 0),P(this,"opponentSessionId",void 0),P(this,"groupCallId",void 0),P(this,"stopVideoTrackTimer",void 0),P(this,"isOnlyDataChannelAllowed",void 0),P(this,"stats",void 0),P(this,"gotLocalIceCandidate",e=>{if(e.candidate){if(this.candidatesEnded&&M.warn("Call ".concat(this.callId," gotLocalIceCandidate() got candidate after candidates have ended!")),M.debug("Call ".concat(this.callId," got local ICE ").concat(e.candidate.sdpMid," ").concat(e.candidate.candidate)),this.callHasEnded())return;""===e.candidate.candidate?this.queueCandidate(null):this.queueCandidate(e.candidate)}}),P(this,"onIceGatheringStateChange",e=>{var t;M.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state changed to ").concat(this.peerConn.iceGatheringState)),"complete"===(null===(t=this.peerConn)||void 0===t?void 0:t.iceGatheringState)&&(this.queueCandidate(null),M.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state complete, set candidates have ended")))}),P(this,"getLocalOfferFailed",e=>{M.error("Call ".concat(this.callId," getLocalOfferFailed() running"),e),this.emit(bt.Error,new Vl(mt.LocalOfferFailed,"Failed to get local offer!",e),this),this.terminate(ur.Local,mt.LocalOfferFailed,!1)}),P(this,"getUserMediaFailed",e=>{this.successor?this.successor.getUserMediaFailed(e):(M.warn("Call ".concat(this.callId," getUserMediaFailed() failed to get user media - ending call"),e),this.emit(bt.Error,new Vl(mt.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e),this),this.terminate(ur.Local,mt.NoUserMedia,!1))}),P(this,"placeCallFailed",e=>{this.successor?this.successor.placeCallFailed(e):(M.warn("Call ".concat(this.callId," placeCallWithCallFeeds() failed - ending call"),e),this.emit(bt.Error,new Vl(mt.IceFailed,"Couldn't start call! Invalid ICE server configuration.",e),this),this.terminate(ur.Local,mt.IceFailed,!1))}),P(this,"onIceConnectionStateChanged",()=>{var e,t,n,r,i,o;if(!this.callHasEnded()){if(M.debug("Call ".concat(this.callId," onIceConnectionStateChanged() running (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.iceConnectionState,", conn=").concat(null===(t=this.peerConn)||void 0===t?void 0:t.connectionState,")")),["connected","completed"].includes(null!==(n=null===(r=this.peerConn)||void 0===r?void 0:r.iceConnectionState)&&void 0!==n?n:""))clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0,this.iceReconnectionTimeOut&&clearTimeout(this.iceReconnectionTimeOut),this.state=dt.Connected,!this.callLengthInterval&&!this.callStartTime&&(this.callStartTime=Date.now(),this.callLengthInterval=setInterval(()=>{this.emit(bt.LengthChanged,Math.round((Date.now()-this.callStartTime)/1e3),this)},Z1e));else if("failed"==(null===(i=this.peerConn)||void 0===i?void 0:i.iceConnectionState)){var s,a;if(this.candidatesEnded=!1,null!==(s=this.peerConn)&&void 0!==s&&s.restartIce)this.candidatesEnded=!1,M.debug("Call ".concat(this.callId," onIceConnectionStateChanged() ice restart (state=").concat(null===(a=this.peerConn)||void 0===a?void 0:a.iceConnectionState,")")),this.peerConn.restartIce();else M.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE failed and no ICE restart method)")),this.hangup(mt.IceFailed,!1)}else"disconnected"==(null===(o=this.peerConn)||void 0===o?void 0:o.iceConnectionState)&&(this.candidatesEnded=!1,this.iceReconnectionTimeOut=setTimeout(()=>{var e,t,n;M.info("Call ".concat(this.callId," onIceConnectionStateChanged() ICE restarting because of ICE disconnected, (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.iceConnectionState,", conn=").concat(null===(t=this.peerConn)||void 0===t?void 0:t.connectionState,")")),null!==(n=this.peerConn)&&void 0!==n&&n.restartIce&&(this.candidatesEnded=!1,this.peerConn.restartIce()),this.iceReconnectionTimeOut=void 0},t0e),this.iceDisconnectedTimeout=setTimeout(()=>{M.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE disconnected for too long)")),this.hangup(mt.IceFailed,!1)},e0e),this.state=dt.Connecting);if(this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState))for(var l of this.getRemoteFeeds())l.setAudioVideoMuted(!0,!0)}}),P(this,"onSignallingStateChanged",()=>{var e;M.debug("Call ".concat(this.callId," onSignallingStateChanged() running (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.signalingState,")"))}),P(this,"onTrack",e=>{if(0!==e.streams.length){var t=e.streams[0];if(this.pushRemoteFeed(t),!this.removeTrackListeners.has(t)){var n=()=>{0===t.getTracks().length&&(M.info("Call ".concat(this.callId," onTrack() removing track (streamId=").concat(t.id,")")),this.deleteFeedByStream(t),t.removeEventListener("removetrack",n),this.removeTrackListeners.delete(t))};t.addEventListener("removetrack",n),this.removeTrackListeners.set(t,n)}}else M.warn("Call ".concat(this.callId," onTrack() called with streamless track streamless (kind=").concat(e.track.kind,")"))}),P(this,"onDataChannel",e=>{this.emit(bt.DataChannel,e.channel,this)}),P(this,"onNegotiationNeeded",B(function*(){M.info("Call ".concat(t.callId," onNegotiationNeeded() negotiation is needed!")),t.state===dt.CreateOffer||0!==t.opponentVersion?t.queueGotLocalOffer():M.info("Call ".concat(t.callId," onNegotiationNeeded() opponent does not support renegotiation: ignoring negotiationneeded event"))})),P(this,"onHangupReceived",e=>{M.debug("Call ".concat(this.callId," onHangupReceived() running")),this.partyIdMatches(e)||this.state===dt.Ringing?this.terminate(ur.Remote,e.reason||mt.UserHangup,!0):M.info("Call ".concat(this.callId," onHangupReceived() ignoring message from party ID ").concat(e.party_id,": our partner is ").concat(this.opponentPartyId))}),P(this,"onRejectReceived",e=>{M.debug("Call ".concat(this.callId," onRejectReceived() running")),[dt.InviteSent,dt.Ringing].includes(this.state)||this.state===dt.Fledgling&&this.direction===Id.Inbound?this.terminate(ur.Remote,e.reason||mt.UserHangup,!0):M.debug("Call ".concat(this.callId," onRejectReceived() called in wrong state (state=").concat(this.state,")"))}),P(this,"onAnsweredElsewhere",e=>{M.debug("Call ".concat(this.callId," onAnsweredElsewhere() running")),this.terminate(ur.Remote,mt.AnsweredElsewhere,!0)}),this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");for(var r of(this.forceTURN=null!==(n=e.forceTURN)&&void 0!==n&&n,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[Q1e]}),this.turnServers))CX(r,["urls"]);this.callId=Sh(),this.isOnlyDataChannelAllowed=this.client.isVoipWithNoMediaAllowed}placeVoiceCall(){var e=this;return B(function*(){yield e.placeCall(!0,!1)})()}placeVideoCall(){var e=this;return B(function*(){yield e.placeCall(!0,!0)})()}createDataChannel(e,t){var n=this.peerConn.createDataChannel(e,t);return this.emit(bt.DataChannel,n,this),n}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return!(!this.opponentCaps||!this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return!(!this.opponentCaps||!this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){var t=this._state;this._state=e,this.emit(bt.State,e,t,this)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?C$.Video:C$.Voice}get hasLocalUserMediaVideoTrack(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some(e=>{var t;return e.purpose===In.Usermedia&&(null===(t=e.stream)||void 0===t?void 0:t.getVideoTracks().length)})}get hasLocalUserMediaAudioTrack(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some(e=>{var t;return e.purpose===In.Usermedia&&!(null===(t=e.stream)||void 0===t||!t.getAudioTracks().length)})}get hasUserMediaAudioSender(){var e;return!(null===(e=this.transceivers.get(La(In.Usermedia,"audio")))||void 0===e||!e.sender)}get hasUserMediaVideoSender(){var e;return!(null===(e=this.transceivers.get(La(In.Usermedia,"video")))||void 0===e||!e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find(e=>e.purpose===In.Usermedia)}get localScreensharingFeed(){return this.getLocalFeeds().find(e=>e.purpose===In.Screenshare)}get localUsermediaStream(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.stream}get localScreensharingStream(){var e;return null===(e=this.localScreensharingFeed)||void 0===e?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find(e=>e.purpose===In.Usermedia)}get remoteScreensharingFeed(){return this.getRemoteFeeds().find(e=>e.purpose===In.Screenshare)}get remoteUsermediaStream(){var e;return null===(e=this.remoteUsermediaFeed)||void 0===e?void 0:e.stream}get remoteScreensharingStream(){var e;return null===(e=this.remoteScreensharingFeed)||void 0===e?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find(t=>t.stream.id===e)}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter(e=>e.isLocal())}getRemoteFeeds(){return this.feeds.filter(e=>!e.isLocal())}initOpponentCrypto(){var e=this;return B(function*(){var t;if(e.opponentDeviceId&&e.client.getUseE2eForGroupCall()){if(!e.client.getCrypto())return void(e.hasOpponentDeviceInfo=!0);var n=e.invitee||(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId);throw n?(e.hasOpponentDeviceInfo=!1,new kJ(n)):new Error("Couldn't find opponent user ID to init crypto")}})()}getLocalSDPStreamMetadata(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={};for(var n of this.getLocalFeeds())e&&(n.sdpMetadataStreamId=n.stream.id),t[n.sdpMetadataStreamId]={purpose:n.purpose,audio_muted:n.isAudioMuted(),video_muted:n.isVideoMuted()};return t}noIncomingFeeds(){return!this.feeds.some(e=>!e.isLocal())}pushRemoteFeed(e){if(this.opponentSupportsSDPStreamMetadata()){var t=this.getOpponentMember().userId,n=this.remoteSDPStreamMetadata[e.id].purpose,r=this.remoteSDPStreamMetadata[e.id].audio_muted,i=this.remoteSDPStreamMetadata[e.id].video_muted;n?this.getFeedByStreamId(e.id)?M.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):(this.feeds.push(new nu({client:this.client,call:this,roomId:this.roomId,userId:t,deviceId:this.getOpponentDeviceId(),stream:e,purpose:n,audioMuted:r,videoMuted:i})),this.emit(bt.FeedsChanged,this.feeds,this),M.info("Call ".concat(this.callId," pushRemoteFeed() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,", purpose=").concat(n,")"))):M.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we didn't get any metadata about it (streamId=").concat(e.id,")"))}else this.pushRemoteFeedWithoutMetadata(e)}pushRemoteFeedWithoutMetadata(e){var t,n=this.getOpponentMember().userId,r=In.Usermedia,i=null===(t=this.feeds.find(e=>!e.isLocal()))||void 0===t?void 0:t.stream;i&&e.id!==i.id?M.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring new stream because we already have stream (streamId=").concat(e.id,")")):this.getFeedByStreamId(e.id)?M.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):(this.feeds.push(new nu({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r})),this.emit(bt.FeedsChanged,this.feeds,this),M.info("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,")")))}pushNewLocalFeed(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.client.getUserId();Mr(e.getAudioTracks(),!0),Mr(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)?M.warn("Call ".concat(this.callId," pushNewLocalFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):this.pushLocalFeed(new nu({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,deviceId:this.getOpponentDeviceId(),stream:e,purpose:t}),n)}pushLocalFeed(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.feeds.some(t=>e.stream.id===t.stream.id))M.info("Call ".concat(this.callId," pushLocalFeed() ignoring duplicate local stream (streamId=").concat(e.stream.id,")"));else{if(this.feeds.push(e),n){var r=function(){M.info("Call ".concat(t.callId," pushLocalFeed() adding track to peer connection (id=").concat(i.id,", kind=").concat(i.kind,", streamId=").concat(e.stream.id,", streamPurpose=").concat(e.purpose,", enabled=").concat(i.enabled,")"));var n=La(e.purpose,i.kind);if(t.transceivers.has(n)){var r=t.transceivers.get(n);r.sender.replaceTrack(i),r.direction="inactive"===r.direction?"sendonly":"sendrecv"}else{var o=t.peerConn.addTrack(i,e.stream),s=t.peerConn.getTransceivers().find(e=>e.sender===o);s?t.transceivers.set(n,s):M.warn("Call ".concat(t.callId," pushLocalFeed() didn't find a matching transceiver after adding track!"))}};for(var i of e.stream.getTracks())r()}M.info("Call ".concat(this.callId," pushLocalFeed() pushed stream (id=").concat(e.stream.id,", active=").concat(e.stream.active,", purpose=").concat(e.purpose,")")),this.emit(bt.FeedsChanged,this.feeds,this)}}removeLocalFeed(e){var t=La(e.purpose,"audio"),n=La(e.purpose,"video");for(var r of[t,n])if(this.transceivers.has(r)){var i=this.transceivers.get(r);i.sender&&this.peerConn.removeTrack(i.sender)}e.purpose===In.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(var e of this.feeds)(!e.isLocal()||!this.groupCallId)&&e.dispose();this.feeds=[],this.emit(bt.FeedsChanged,this.feeds,this)}deleteFeedByStream(e){var t=this.getFeedByStreamId(e.id);t?this.deleteFeed(t):M.warn("Call ".concat(this.callId," deleteFeedByStream() didn't find the feed to delete (streamId=").concat(e.id,")"))}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit(bt.FeedsChanged,this.feeds,this)}getCurrentCallStats(){var e=this;return B(function*(){return e.callHasEnded()?e.callStatsAtEnd:e.collectCallStats()})()}collectCallStats(){var e=this;return B(function*(){if(e.peerConn){var t=yield e.peerConn.getStats(),n=[];return t.forEach(e=>{n.push(e)}),n}})()}initWithInvite(e){var t=this;return B(function*(){var n,r=e.getContent();t.direction=Id.Inbound,(yield t.client.checkTurnServers())||M.warn("Call ".concat(t.callId," initWithInvite() failed to get TURN credentials! Proceeding with call anyway..."));var i=r[yd];i?t.updateRemoteSDPStreamMetadata(i):M.debug("Call ".concat(t.callId," initWithInvite() did not get any SDPStreamMetadata! Can not send/receive multiple streams")),t.peerConn=t.createPeerConnection(),t.emit(bt.PeerConnectionCreated,t.peerConn,t),t.chooseOpponent(e),yield t.initOpponentCrypto();try{yield t.peerConn.setRemoteDescription(r.offer),M.debug("Call ".concat(t.callId," initWithInvite() set remote description: ").concat(r.offer.type)),yield t.addBufferedIceCandidates()}catch(e){return M.debug("Call ".concat(t.callId," initWithInvite() failed to set remote description"),e),void t.terminate(ur.Local,mt.SetRemoteDescription,!1)}var o=null===(n=t.feeds.find(e=>!e.isLocal()))||void 0===n?void 0:n.stream;if(!(t.isOnlyDataChannelAllowed||o&&0!==o.getTracks().length))return M.error("Call ".concat(t.callId," initWithInvite() no remote stream or no tracks after setting remote description!")),void t.terminate(ur.Local,mt.SetRemoteDescription,!1);if(t.state=dt.Ringing,e.getLocalAge()){var s=setTimeout(()=>{var e;t.state==dt.Ringing&&(M.debug("Call ".concat(t.callId," initWithInvite() invite has expired. Hanging up.")),t.hangupParty=ur.Remote,t.state=dt.Ended,t.stopAllMedia(),"closed"!=t.peerConn.signalingState&&t.peerConn.close(),null===(e=t.stats)||void 0===e||e.removeStatsReportGatherer(t.callId),t.emit(bt.Hangup,t))},r.lifetime-e.getLocalAge()),a=e=>{e!==dt.Ringing&&(clearTimeout(s),t.off(bt.State,a))};t.on(bt.State,a)}})()}initWithHangup(e){this.state=dt.Ended}shouldAnswerWithMediaType(e,t,n){return e&&!t?(M.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(n," because the other side isn't sending it either.")),!1):IX(e)||e===t||this.opponentSupportsSDPStreamMetadata()?e??t:(M.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(n,"=").concat(e," because the other side doesn't support it. Answering with ").concat(n,"=").concat(t,".")),t)}answer(e,t){var n=this;return B(function*(){if(!n.inviteOrAnswerSent){if(!1===e&&!1===t)throw new Error("You CANNOT answer a call without media");if(n.localUsermediaStream||n.waitForLocalAVStream)n.waitForLocalAVStream&&(n.state=dt.WaitLocalMedia);else{var r=n.state,i=n.shouldAnswerWithMediaType(e,n.hasRemoteUserMediaAudioTrack,"audio"),o=n.shouldAnswerWithMediaType(t,n.hasRemoteUserMediaVideoTrack,"video");n.state=dt.WaitLocalMedia,n.waitForLocalAVStream=!0;try{var s,a=yield n.client.getMediaHandler().getUserMediaStream(i,o);n.waitForLocalAVStream=!1;var l=[new nu({client:n.client,roomId:n.roomId,userId:n.client.getUserId(),deviceId:null!==(s=n.client.getDeviceId())&&void 0!==s?s:void 0,stream:a,purpose:In.Usermedia,audioMuted:!1,videoMuted:!1})];n.localScreensharingFeed&&l.push(n.localScreensharingFeed),n.answerWithCallFeeds(l)}catch(e){if(!o)return void n.getUserMediaFailed(e);M.warn("Call ".concat(n.callId," answer() failed to getUserMedia(), trying to getUserMedia() without video")),n.state=r,n.waitForLocalAVStream=!1,yield n.answer(i,!1)}}}})()}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){M.debug("Call ".concat(this.callId," replacedBy() running (newCallId=").concat(e.callId,")")),this.state===dt.WaitLocalMedia?(M.debug("Call ".concat(this.callId," replacedBy() telling new call to wait for local media (newCallId=").concat(e.callId,")")),e.waitForLocalAVStream=!0):[dt.CreateOffer,dt.InviteSent].includes(this.state)&&(e.direction===Id.Outbound?e.queueGotCallFeedsForAnswer([]):(M.debug("Call ".concat(this.callId," replacedBy() handing local stream to new call(newCallId=").concat(e.callId,")")),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map(e=>e.clone())))),this.successor=e,this.emit(bt.Replaced,e,this),this.hangup(mt.Replaced,!0)}hangup(e,t){if(!this.callHasEnded()&&(M.debug("Call ".concat(this.callId," hangup() ending call (reason=").concat(e,")")),this.terminate(ur.Local,e,!t),![dt.Fledgling,dt.WaitLocalMedia].includes(this.state))){var n={};(this.opponentVersion&&0!==this.opponentVersion||e!==mt.UserHangup)&&(n.reason=e),this.sendVoipEvent(ee.CallHangup,n)}}reject(){if(this.state!==dt.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(0===this.opponentVersion)return M.info("Call ".concat(this.callId," reject() opponent version is less than 1: sending hangup instead of reject (opponentVersion=").concat(this.opponentVersion,")")),void this.hangup(mt.UserHangup,!0);M.debug("Rejecting call: "+this.callId),this.terminate(ur.Local,mt.UserHangup,!0),this.sendVoipEvent(ee.CallReject,{})}upgradeCall(e,t){var n=this;return B(function*(){if((e||t)&&n.opponentSupportsSDPStreamMetadata())try{M.debug("Call ".concat(n.callId," upgradeCall() upgrading call (audio=").concat(e,", video=").concat(t,")"));var r=e||n.hasLocalUserMediaAudioTrack,i=t||n.hasLocalUserMediaVideoTrack,o=yield n.client.getMediaHandler().getUserMediaStream(r,i,!1);yield n.updateLocalUsermediaStream(o,e,t)}catch(e){M.error("Call ".concat(n.callId," upgradeCall() failed to upgrade the call"),e),n.emit(bt.Error,new Vl(mt.NoUserMedia,"Failed to get camera access: ",e),n)}})()}opponentSupportsSDPStreamMetadata(){return!!this.remoteSDPStreamMetadata}isScreensharing(){return!!this.localScreensharingStream}setScreensharingEnabled(e,t){var n=this;return B(function*(){if(e&&n.isScreensharing())return M.warn("Call ".concat(n.callId," setScreensharingEnabled() there is already a screensharing stream - there is nothing to do!")),!0;if(!e&&!n.isScreensharing())return M.warn("Call ".concat(n.callId," setScreensharingEnabled() there already isn't a screensharing stream - there is nothing to do!")),!1;if(!n.opponentSupportsSDPStreamMetadata())return n.setScreensharingEnabledWithoutMetadataSupport(e,t);if(M.debug("Call ".concat(n.callId," setScreensharingEnabled() running (enabled=").concat(e,")")),!e){var r=n.transceivers.get(La(In.Screenshare,"audio")),i=n.transceivers.get(La(In.Screenshare,"video"));for(var o of[r,i])o&&o.sender&&n.peerConn.removeTrack(o.sender);return n.client.getMediaHandler().stopScreensharingStream(n.localScreensharingStream),n.deleteFeedByStream(n.localScreensharingStream),!1}try{var s=yield n.client.getMediaHandler().getScreensharingStream(t);return!!s&&(n.pushNewLocalFeed(s,In.Screenshare),!0)}catch(e){return M.error("Call ".concat(n.callId," setScreensharingEnabled() failed to get screen-sharing stream:"),e),!1}})()}setScreensharingEnabledWithoutMetadataSupport(e,t){var n=this;return B(function*(){if(M.debug("Call ".concat(n.callId," setScreensharingEnabledWithoutMetadataSupport() running (enabled=").concat(e,")")),!e){var r,i,o=null===(r=n.localUsermediaStream)||void 0===r?void 0:r.getTracks().find(e=>"video"===e.kind),s=null===(i=n.transceivers.get(La(In.Usermedia,"video")))||void 0===i?void 0:i.sender;return null==s||s.replaceTrack(o??null),n.client.getMediaHandler().stopScreensharingStream(n.localScreensharingStream),n.deleteFeedByStream(n.localScreensharingStream),!1}try{var a,l=yield n.client.getMediaHandler().getScreensharingStream(t);if(!l)return!1;var c=l.getTracks().find(e=>"video"===e.kind),u=null===(a=n.transceivers.get(La(In.Usermedia,"video")))||void 0===a?void 0:a.sender;return null==u||u.replaceTrack(c??null),n.pushNewLocalFeed(l,In.Screenshare,!1),!0}catch(e){return M.error("Call ".concat(n.callId," setScreensharingEnabledWithoutMetadataSupport() failed to get screen-sharing stream:"),e),!1}})()}updateLocalUsermediaStream(e){var t=arguments,n=this;return B(function*(){var r=t.length>1&&void 0!==t[1]&&t[1],i=t.length>2&&void 0!==t[2]&&t[2],o=n.localUsermediaFeed,s=r||!o.isAudioMuted()&&!n.remoteOnHold,a=i||!o.isVideoMuted()&&!n.remoteOnHold;for(var l of(M.log("Call ".concat(n.callId," updateLocalUsermediaStream() running (streamId=").concat(e.id,", audio=").concat(s,", video=").concat(a,")")),Mr(e.getAudioTracks(),s),Mr(e.getVideoTracks(),a),n.localUsermediaStream.getTracks()))n.localUsermediaStream.removeTrack(l),l.stop();for(var c of e.getTracks())n.localUsermediaStream.addTrack(c);var u=function*(){var t=La(In.Usermedia,d.kind),r=n.transceivers.get(t),i=null==r?void 0:r.sender,s=!1;if(i)try{M.info("Call ".concat(n.callId," updateLocalUsermediaStream() replacing track (id=").concat(d.id,", kind=").concat(d.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")")),yield i.replaceTrack(d),r.direction="inactive"===r.direction?"sendonly":"sendrecv",s=!0}catch(e){M.warn("Call ".concat(n.callId," updateLocalUsermediaStream() replaceTrack failed: adding new transceiver instead"),e)}if(!s){M.info("Call ".concat(n.callId," updateLocalUsermediaStream() adding track to peer connection (id=").concat(d.id,", kind=").concat(d.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")"));var a=n.peerConn.addTrack(d,n.localUsermediaStream),l=n.peerConn.getTransceivers().find(e=>e.sender===a);l?n.transceivers.set(t,l):M.warn("Call ".concat(n.callId," updateLocalUsermediaStream() couldn't find matching transceiver for newly added track!"))}};for(var d of e.getTracks())yield*u()})()}setLocalVideoMuted(e){var t=this;return B(function*(){var n,r;if(M.log("Call ".concat(t.callId," setLocalVideoMuted() running ").concat(e)),!e&&void 0!==t.stopVideoTrackTimer&&(clearTimeout(t.stopVideoTrackTimer),t.stopVideoTrackTimer=void 0),!(yield t.client.getMediaHandler().hasVideoDevice()))return t.isLocalVideoMuted();if(!t.hasUserMediaVideoSender&&!e)return null===(r=t.localUsermediaFeed)||void 0===r||r.setAudioVideoMuted(null,e),yield t.upgradeCall(!1,!0),t.isLocalVideoMuted();if(!e&&0===t.localUsermediaStream.getVideoTracks().length){var i=yield t.client.getMediaHandler().getUserMediaStream(!0,!0);yield t.updateLocalUsermediaStream(i)}return null===(n=t.localUsermediaFeed)||void 0===n||n.setAudioVideoMuted(null,e),t.updateMuteStatus(),yield t.sendMetadataUpdate(),e&&(t.stopVideoTrackTimer=setTimeout(()=>{for(var e of t.localUsermediaStream.getVideoTracks())e.stop(),t.localUsermediaStream.removeTrack(e)},120)),t.isLocalVideoMuted()})()}isLocalVideoMuted(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isVideoMuted())&&void 0!==e&&e}setMicrophoneMuted(e){var t=this;return B(function*(){var n;return M.log("Call ".concat(t.callId," setMicrophoneMuted() running ").concat(e)),(yield t.client.getMediaHandler().hasAudioDevice())?e||t.hasUserMediaAudioSender&&t.hasLocalUserMediaAudioTrack?(null===(n=t.localUsermediaFeed)||void 0===n||n.setAudioVideoMuted(e,null),t.updateMuteStatus(),yield t.sendMetadataUpdate(),t.isMicrophoneMuted()):(yield t.upgradeCall(!0,!1),t.isMicrophoneMuted()):t.isMicrophoneMuted()})()}isMicrophoneMuted(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isAudioMuted())&&void 0!==e&&e}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){for(var t of(this.remoteOnHold=e,this.peerConn.getTransceivers()))t.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(bt.RemoteHoldUnhold,this.remoteOnHold,this)}}isLocalOnHold(){if(this.state!==dt.Connected)return!1;var e=!0;for(var t of this.peerConn.getTransceivers()){["inactive","recvonly"].includes(t.currentDirection)||(e=!1)}return e}sendDtmfDigit(e){for(var t of this.peerConn.getSenders()){var n;if("audio"===(null===(n=t.track)||void 0===n?void 0:n.kind)&&t.dtmf)return void t.dtmf.insertDTMF(e)}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){var e=this.isMicrophoneMuted()||this.remoteOnHold,t=this.isLocalVideoMuted()||this.remoteOnHold;M.log("Call ".concat(this.callId," updateMuteStatus stream ").concat(this.localUsermediaStream.id," micShouldBeMuted ").concat(e," vidShouldBeMuted ").concat(t)),Mr(this.localUsermediaStream.getAudioTracks(),!e),Mr(this.localUsermediaStream.getVideoTracks(),!t)}sendMetadataUpdate(){var e=this;return B(function*(){yield e.sendVoipEvent(ee.CallSDPStreamMetadataChangedPrefix,{[yd]:e.getLocalSDPStreamMetadata()})})()}gotCallFeedsForInvite(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.successor)this.successor.queueGotCallFeedsForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{for(var n of e)this.pushLocalFeed(n);t&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=dt.CreateOffer,M.debug("Call ".concat(this.callId," gotUserMediaForInvite() run"))}}sendAnswer(){var e=this;return B(function*(){var t={answer:{sdp:e.peerConn.localDescription.sdp,type:e.peerConn.localDescription.type},[yd]:e.getLocalSDPStreamMetadata(!0)};t.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1};var n=e.discardDuplicateCandidates();M.info("Call ".concat(e.callId," sendAnswer() discarding ").concat(n," candidates that will be sent in answer"));try{yield e.sendVoipEvent(ee.CallAnswer,t),e.inviteOrAnswerSent=!0}catch(t){e.state=dt.Ringing,t instanceof nr&&t.event&&e.client.cancelPendingEvent(t.event);var r=mt.SendAnswer,i="Failed to send answer";throw"UnknownDeviceError"==t.name&&(r=mt.UnknownDevices,i="Unknown devices present in the room"),e.emit(bt.Error,new Vl(r,i,t),e),t}e.sendCandidateQueue()})()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.gotCallFeedsForAnswer(e)):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,t){var n=K5.parse(e.sdp);n.media.forEach(e=>{var n=new Map,r=new Map;for(var i of e.rtp)n.set(i.payload,i.codec),r.set(i.codec,i.payload);for(var o of t)if(o.mediaType===e.type){if(!r.has(o.codec)){M.info("Call ".concat(this.callId," mungeSdp() ignoring SDP modifications for ").concat(o.codec," as it's not present."));continue}var s=[];void 0!==o.enableDtx&&s.push("usedtx=".concat(o.enableDtx?"1":"0")),void 0!==o.maxAverageBitrate&&s.push("maxaveragebitrate=".concat(o.maxAverageBitrate));var a=!1;for(var l of e.fmtp)n.get(l.payload)===o.codec&&(a=!0,l.config+=";"+s.join(";"));a||e.fmtp.push({payload:r.get(o.codec),config:s.join(";")})}}),e.sdp=K5.write(n)}createOffer(){var e=this;return B(function*(){var t=yield e.peerConn.createOffer();return e.mungeSdp(t,T$(e.isPtt)),t})()}createAnswer(){var e=this;return B(function*(){var t=yield e.peerConn.createAnswer();return e.mungeSdp(t,T$(e.isPtt)),t})()}gotCallFeedsForAnswer(e){var t=this;return B(function*(){if(!t.callHasEnded()){for(var n of(t.waitForLocalAVStream=!1,e))t.pushLocalFeed(n);var r;t.state=dt.CreateAnswer;try{t.getRidOfRTXCodecs(),r=yield t.createAnswer()}catch(e){return M.debug("Call ".concat(t.callId," gotCallFeedsForAnswer() failed to create answer: "),e),void t.terminate(ur.Local,mt.CreateAnswer,!0)}try{if(yield t.peerConn.setLocalDescription(r),t.callHasEnded()||(t.state=dt.Connecting,yield new Promise(e=>{setTimeout(e,200)}),t.callHasEnded()))return;t.sendAnswer()}catch(e){return M.debug("Call ".concat(t.callId," gotCallFeedsForAnswer() error setting local description!"),e),void t.terminate(ur.Local,mt.SetLocalDescription,!0)}}})()}onRemoteIceCandidatesReceived(e){var t=this;return B(function*(){if(!t.callHasEnded()){var n=e.getContent(),r=n.candidates;if(!r)return void M.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() ignoring candidates event with no candidates!"));var i=0===n.version?null:n.party_id||null;if(void 0===t.opponentPartyId){if(i){M.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() buffering ").concat(r.length," candidates until we pick an opponent"));var o=t.remoteCandidateBuffer.get(i)||[];o.push(...r),t.remoteCandidateBuffer.set(i,o)}return}if(!t.partyIdMatches(n))return void M.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() ignoring candidates from party ID ").concat(n.party_id,": we have chosen party ID ").concat(t.opponentPartyId));yield t.addIceCandidates(r)}})()}onAnswerReceived(e){var t=this;return B(function*(){var n=e.getContent();if(M.debug("Call ".concat(t.callId," onAnswerReceived() running (hangupParty=").concat(n.party_id,")")),t.callHasEnded())M.debug("Call ".concat(t.callId," onAnswerReceived() ignoring answer because call has ended"));else if(void 0===t.opponentPartyId){t.chooseOpponent(e),yield t.addBufferedIceCandidates(),t.state=dt.Connecting;var r=n[yd];r?t.updateRemoteSDPStreamMetadata(r):M.warn("Call ".concat(t.callId," onAnswerReceived() did not get any SDPStreamMetadata! Can not send/receive multiple streams"));try{t.isSettingRemoteAnswerPending=!0,yield t.peerConn.setRemoteDescription(n.answer),t.isSettingRemoteAnswerPending=!1,M.debug("Call ".concat(t.callId," onAnswerReceived() set remote description: ").concat(n.answer.type))}catch(e){return t.isSettingRemoteAnswerPending=!1,M.debug("Call ".concat(t.callId," onAnswerReceived() failed to set remote description"),e),void t.terminate(ur.Local,mt.SetRemoteDescription,!1)}if(null!==t.opponentPartyId)try{yield t.sendVoipEvent(ee.CallSelectAnswer,{selected_party_id:t.opponentPartyId})}catch(e){M.warn("Call ".concat(t.callId," onAnswerReceived() failed to send select_answer event"),e)}}else M.info("Call ".concat(t.callId," onAnswerReceived() ignoring answer from party ID ").concat(n.party_id,": we already have an answer/reject from ").concat(t.opponentPartyId))})()}onSelectAnswerReceived(e){var t=this;return B(function*(){if(t.direction===Id.Inbound){var n=e.getContent().selected_party_id;null!=n?n!==t.ourPartyId&&(M.info("Call ".concat(t.callId," onSelectAnswerReceived() got select_answer for party ID ").concat(n,": we are party ID ").concat(t.ourPartyId,".")),yield t.terminate(ur.Remote,mt.AnsweredElsewhere,!0)):M.warn("Call ".concat(t.callId," onSelectAnswerReceived() got nonsensical select_answer with null/undefined selected_party_id: ignoring"))}else M.warn("Call ".concat(t.callId," onSelectAnswerReceived() got select_answer for an outbound call: ignoring"))})()}onNegotiateReceived(e){var t=this;return B(function*(){var n=e.getContent(),r=n.description;if(r&&r.sdp&&r.type){var i=t.direction===Id.Inbound,o=!t.makingOffer&&("stable"===t.peerConn.signalingState||t.isSettingRemoteAnswerPending),s="offer"===r.type&&!o;if(t.ignoreOffer=!i&&s,t.ignoreOffer)M.info("Call ".concat(t.callId," onNegotiateReceived() ignoring colliding negotiate event because we're impolite"));else{var a=t.isLocalOnHold(),l=n[yd];l?t.updateRemoteSDPStreamMetadata(l):M.warn("Call ".concat(t.callId," onNegotiateReceived() received negotiation event without SDPStreamMetadata!"));try{if(t.isSettingRemoteAnswerPending="answer"==r.type,yield t.peerConn.setRemoteDescription(r),t.isSettingRemoteAnswerPending=!1,M.debug("Call ".concat(t.callId," onNegotiateReceived() set remote description: ").concat(r.type)),"offer"===r.type){var c,u;try{t.getRidOfRTXCodecs(),u=yield t.createAnswer()}catch(e){return M.debug("Call ".concat(t.callId," onNegotiateReceived() failed to create answer: "),e),void t.terminate(ur.Local,mt.CreateAnswer,!0)}yield t.peerConn.setLocalDescription(u),M.debug("Call ".concat(t.callId," onNegotiateReceived() create an answer")),t.sendVoipEvent(ee.CallNegotiate,{lifetime:yk,description:null===(c=t.peerConn.localDescription)||void 0===c?void 0:c.toJSON(),[yd]:t.getLocalSDPStreamMetadata(!0)})}}catch(e){t.isSettingRemoteAnswerPending=!1,M.warn("Call ".concat(t.callId," onNegotiateReceived() failed to complete negotiation"),e)}var d=t.isLocalOnHold();a!==d&&(t.emit(bt.LocalHoldUnhold,d,t),t.emit(bt.HoldUnhold,d))}}else M.info("Call ".concat(t.callId," onNegotiateReceived() ignoring invalid m.call.negotiate event"))})()}updateRemoteSDPStreamMetadata(e){for(var t of(this.remoteSDPStreamMetadata=kX(this.remoteSDPStreamMetadata||{},e,!0),this.getRemoteFeeds())){var n,r=t.stream.id,i=this.remoteSDPStreamMetadata[r];t.setAudioVideoMuted(null==i?void 0:i.audio_muted,null==i?void 0:i.video_muted),t.purpose=null===(n=this.remoteSDPStreamMetadata[r])||void 0===n?void 0:n.purpose}}onSDPStreamMetadataChangedReceived(e){var t=e.getContent()[yd];this.updateRemoteSDPStreamMetadata(t)}onAssertedIdentityReceived(e){var t=this;return B(function*(){var n=e.getContent();n.asserted_identity&&(t.remoteAssertedIdentity={id:n.asserted_identity.id,displayName:n.asserted_identity.display_name},t.emit(bt.AssertedIdentityChanged,t))})()}callHasEnded(){return this.state===dt.Ended}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.wrappedGotLocalOffer()):this.responsePromiseChain=this.wrappedGotLocalOffer()}wrappedGotLocalOffer(){var e=this;return B(function*(){e.makingOffer=!0;try{yield e.gotLocalOffer()}catch(t){return void e.getLocalOfferFailed(t)}finally{e.makingOffer=!1}})()}gotLocalOffer(){var e=this;return B(function*(){if(M.debug("Call ".concat(e.callId," gotLocalOffer() running")),e.callHasEnded())M.debug("Call ".concat(e.callId,' gotLocalOffer() ignoring newly created offer because the call has ended"'));else{var t;try{e.getRidOfRTXCodecs(),t=yield e.createOffer()}catch(t){return M.debug("Call ".concat(e.callId," gotLocalOffer() failed to create offer: "),t),void e.terminate(ur.Local,mt.CreateOffer,!0)}try{yield e.peerConn.setLocalDescription(t)}catch(t){return M.debug("Call ".concat(e.callId," gotLocalOffer() error setting local description!"),t),void e.terminate(ur.Local,mt.SetLocalDescription,!0)}if("gathering"===e.peerConn.iceGatheringState&&(yield new Promise(e=>{setTimeout(e,200)})),!e.callHasEnded()){var n,r,i=e.state===dt.CreateOffer?ee.CallInvite:ee.CallNegotiate,o={lifetime:yk};if(i===ee.CallInvite&&e.invitee&&(o.invitee=e.invitee),e.state===dt.CreateOffer)o.offer=null===(n=e.peerConn.localDescription)||void 0===n?void 0:n.toJSON();else o.description=null===(r=e.peerConn.localDescription)||void 0===r?void 0:r.toJSON();o.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1},o[yd]=e.getLocalSDPStreamMetadata(!0);var s=e.discardDuplicateCandidates();M.info("Call ".concat(e.callId," gotLocalOffer() discarding ").concat(s," candidates that will be sent in offer"));try{yield e.sendVoipEvent(i,o)}catch(t){M.error("Call ".concat(e.callId," gotLocalOffer() failed to send invite"),t),t instanceof nr&&t.event&&e.client.cancelPendingEvent(t.event);var a=mt.SignallingFailed,l="Signalling failed";return e.state===dt.CreateOffer&&(a=mt.SendInvite,l="Failed to send invite"),"UnknownDeviceError"==t.name&&(a=mt.UnknownDevices,l="Unknown devices present in the room"),e.emit(bt.Error,new Vl(a,l,t),e),void e.terminate(ur.Local,a,!1)}e.sendCandidateQueue(),e.state===dt.CreateOffer&&(e.inviteOrAnswerSent=!0,e.state=dt.InviteSent,e.inviteTimeout=setTimeout(()=>{e.inviteTimeout=void 0,e.state===dt.InviteSent&&e.hangup(mt.InviteTimeout,!1)},yk))}}})()}getRidOfRTXCodecs(){if(RTCRtpReceiver.getCapabilities&&RTCRtpSender.getCapabilities){var e=this.transceivers.get(La(In.Screenshare,"video"));if(e&&e.setCodecPreferences){var t=RTCRtpReceiver.getCapabilities("video").codecs,n=RTCRtpSender.getCapabilities("video").codecs,r=[];for(var i of[...t,...n])if("video/rtx"!==i.mimeType){r.push(i);try{e.setCodecPreferences(r)}catch(e){M.info("Working around buggy WebRTC impl: claimed to support codec but threw when setting codec preferences",i,e),r.pop()}}}}}sendVoipEvent(e,t){var n=this;return B(function*(){var r=b2(b2({},t),{},{version:J1e,call_id:n.callId,party_id:n.ourPartyId,conf_id:n.groupCallId});if(n.opponentDeviceId){var i,o=n.toDeviceSeq++,s=b2(b2({},r),{},{device_id:n.client.deviceId,sender_session_id:n.client.getSessionId(),dest_session_id:n.opponentSessionId,seq:o,[j3]:C1e()});n.emit(bt.SendVoipEvent,{type:"toDevice",eventType:e,userId:n.invitee||(null===(i=n.getOpponentMember())||void 0===i?void 0:i.userId),opponentDeviceId:n.opponentDeviceId,content:s},n);var a=n.invitee||n.getOpponentMember().userId;if(n.client.getUseE2eForGroupCall()){if(!n.hasOpponentDeviceInfo)return void M.warn("Call ".concat(n.callId," sendVoipEvent() failed: we do not have opponentDeviceInfo"));throw new Error("Unimplemented")}yield n.client.sendToDevice(e,new Map([[a,new Map([[n.opponentDeviceId,s]])]]))}else{var l;n.emit(bt.SendVoipEvent,{type:"sendEvent",eventType:e,roomId:n.roomId,content:r,userId:n.invitee||(null===(l=n.getOpponentMember())||void 0===l?void 0:l.userId)},n),yield n.client.sendEvent(n.roomId,e,r)}})()}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,this.state!==dt.Ringing&&this.inviteOrAnswerSent){var t=this.direction===Id.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout(()=>{this.sendCandidateQueue()},t)}}discardDuplicateCandidates(){for(var e=0,t=[],n=0;n<this.candidateSendQueue.length;n++){var r=this.candidateSendQueue[n];""===r.candidate?t.push(r):e++}return this.candidateSendQueue=t,e}transfer(e){var t=this;return B(function*(){var n=yield t.client.getProfileInfo(e),r=Sh(),i={replacement_id:Sh(),target_user:{id:e,display_name:n.displayname,avatar_url:n.avatar_url},create_call:r};yield t.sendVoipEvent(ee.CallReplaces,i),yield t.terminate(ur.Local,mt.Transferred,!0)})()}transferToCall(e){var t=this;return B(function*(){var n,r,i=null===(n=e.getOpponentMember())||void 0===n?void 0:n.userId,o=i?yield t.client.getProfileInfo(i):void 0,s=null===(r=t.getOpponentMember())||void 0===r?void 0:r.userId,a=s?yield t.client.getProfileInfo(s):void 0,l=Sh(),c={replacement_id:Sh(),target_user:{id:s,display_name:null==a?void 0:a.displayname,avatar_url:null==a?void 0:a.avatar_url},await_call:l};yield e.sendVoipEvent(ee.CallReplaces,c);var u={replacement_id:Sh(),target_user:{id:i,display_name:null==o?void 0:o.displayname,avatar_url:null==o?void 0:o.avatar_url},create_call:l};yield t.sendVoipEvent(ee.CallReplaces,u),yield t.terminate(ur.Local,mt.Transferred,!0),yield e.terminate(ur.Local,mt.Transferred,!0)})()}terminate(e,t,n){var r=this;return B(function*(){var i;if(!r.callHasEnded()){for(var[o,s]of(r.hangupParty=e,r.hangupReason=t,r.state=dt.Ended,r.inviteTimeout&&(clearTimeout(r.inviteTimeout),r.inviteTimeout=void 0),void 0!==r.iceDisconnectedTimeout&&(clearTimeout(r.iceDisconnectedTimeout),r.iceDisconnectedTimeout=void 0),r.callLengthInterval&&(clearInterval(r.callLengthInterval),r.callLengthInterval=void 0),void 0!==r.stopVideoTrackTimer&&(clearTimeout(r.stopVideoTrackTimer),r.stopVideoTrackTimer=void 0),r.removeTrackListeners))o.removeEventListener("removetrack",s);r.removeTrackListeners.clear(),r.callStatsAtEnd=yield r.collectCallStats(),r.stopAllMedia(),r.deleteAllFeeds(),r.peerConn&&"closed"!==r.peerConn.signalingState&&r.peerConn.close(),null===(i=r.stats)||void 0===i||i.removeStatsReportGatherer(r.callId),n&&r.emit(bt.Hangup,r),r.client.callEventHandler.calls.delete(r.callId)}})()}stopAllMedia(){for(var e of(M.debug("Call ".concat(this.callId," stopAllMedia() running")),this.feeds))if(e.isLocal()&&e.purpose===In.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===In.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal())for(var t of(M.debug("Call ".concat(this.callId," stopAllMedia() stopping stream (streamId=").concat(e.stream.id,")")),e.stream.getTracks()))t.stop()}checkForErrorListener(){if(0===this.listeners(PX.Error).length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}sendCandidateQueue(){var e=this;return B(function*(){if(0!==e.candidateSendQueue.length&&!e.callHasEnded()){var t=e.candidateSendQueue;e.candidateSendQueue=[],++e.candidateSendTries;var n={candidates:t.map(e=>e.toJSON())};e.candidatesEnded&&n.candidates.push({candidate:""}),M.debug("Call ".concat(e.callId," sendCandidateQueue() attempting to send ").concat(t.length," candidates"));try{yield e.sendVoipEvent(ee.CallCandidates,n),e.candidateSendTries=0,e.sendCandidateQueue()}catch(n){if(n instanceof nr&&n.event&&e.client.cancelPendingEvent(n.event),e.candidateSendQueue.push(...t),e.candidateSendTries>5){M.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates on attempt ").concat(e.candidateSendTries,". Giving up on this call."),n);var r=mt.SignallingFailed;return e.emit(bt.Error,new Vl(r,"Signalling failed",n),e),void e.hangup(r,!1)}var i=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,M.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates. Retrying in ").concat(i,"ms"),n),setTimeout(()=>{e.sendCandidateQueue()},i)}}})()}placeCall(e,t){var n=this;return B(function*(){if(!e)throw new Error("You CANNOT start a call without audio");var r;n.state=dt.WaitLocalMedia;try{var i,o=yield n.client.getMediaHandler().getUserMediaStream(e,t);Mr(o.getAudioTracks(),!0),Mr(o.getVideoTracks(),!0),r=new nu({client:n.client,roomId:n.roomId,userId:n.client.getUserId(),deviceId:null!==(i=n.client.getDeviceId())&&void 0!==i?i:void 0,stream:o,purpose:In.Usermedia,audioMuted:!1,videoMuted:!1})}catch(e){return void n.getUserMediaFailed(e)}try{yield n.placeCallWithCallFeeds([r])}catch(e){return void n.placeCallFailed(e)}})()}placeCallWithCallFeeds(e){var t=arguments,n=this;return B(function*(){var r=t.length>1&&void 0!==t[1]&&t[1];n.checkForErrorListener(),n.direction=Id.Outbound,yield n.initOpponentCrypto(),n.client.callEventHandler.calls.set(n.callId,n),(yield n.client.checkTurnServers())||M.warn("Call ".concat(n.callId," placeCallWithCallFeeds() failed to get TURN credentials! Proceeding with call anyway...")),n.peerConn=n.createPeerConnection(),n.emit(bt.PeerConnectionCreated,n.peerConn,n),n.gotCallFeedsForInvite(e,r)})()}createPeerConnection(){var e,t=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers.length?this.turnServers:void 0,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});t.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),t.addEventListener("signalingstatechange",this.onSignallingStateChanged),t.addEventListener("icecandidate",this.gotLocalIceCandidate),t.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),t.addEventListener("track",this.onTrack),t.addEventListener("negotiationneeded",this.onNegotiationNeeded),t.addEventListener("datachannel",this.onDataChannel);var n=this.getOpponentMember(),r=n?n.userId:"unknown";return null===(e=this.stats)||void 0===e||e.addStatsReportGatherer(this.callId,r,t),t}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){var t,n,r=e.getContent();(M.debug("Call ".concat(this.callId," chooseOpponent() running (partyId=").concat(r.party_id,")")),this.opponentVersion=r.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=r.party_id||null,this.opponentCaps=r.capabilities||{},this.opponentMember=null!==(t=this.client.getRoom(this.roomId).getMember(e.getSender()))&&void 0!==t?t:void 0,this.opponentMember)&&(null===(n=this.stats)||void 0===n||n.updateOpponentMember(this.callId,this.opponentMember.userId))}addBufferedIceCandidates(){var e=this;return B(function*(){var t=e.remoteCandidateBuffer.get(e.opponentPartyId);t&&(M.info("Call ".concat(e.callId," addBufferedIceCandidates() adding ").concat(t.length," buffered candidates for opponent ").concat(e.opponentPartyId)),yield e.addIceCandidates(t)),e.remoteCandidateBuffer.clear()})()}addIceCandidates(e){var t=this;return B(function*(){for(var n of e){null!==n.sdpMid&&void 0!==n.sdpMid||null!==n.sdpMLineIndex&&void 0!==n.sdpMLineIndex?M.debug("Call ".concat(t.callId," addIceCandidates() got remote ICE candidate (sdpMid=").concat(n.sdpMid,", candidate=").concat(n.candidate,")")):M.debug("Call ".concat(t.callId," addIceCandidates() got remote ICE end-of-candidates"));try{yield t.peerConn.addIceCandidate(n)}catch(e){t.ignoreOffer?M.debug("Call ".concat(t.callId," addIceCandidates() failed to add remote ICE candidate because ignoring offer"),e):M.info("Call ".concat(t.callId," addIceCandidates() failed to add remote ICE candidate"),e)}}})()}get hasPeerConnection(){return!!this.peerConn}initStats(e){this.stats=e,this.stats.start()}}function Mr(e,t){for(var n of e)n.enabled=t}function Q5(){if(typeof window>"u"||typeof document>"u")return!1;try{var e,t,n;if(!!!(null!==(e=null!==(t=null!==(n=window.RTCPeerConnection)&&void 0!==n?n:window.RTCSessionDescription)&&void 0!==t?t:window.RTCIceCandidate)&&void 0!==e?e:navigator.mediaDevices))return M.error("WebRTC is not supported in this browser / environment"),!1}catch(e){return M.error("Exception thrown when trying to access WebRTC",e),!1}return!0}function sb(e,t,n){if(!Q5())return null;var r=!!n&&n.forceTURN,i={client:e,roomId:t,invitee:null==n?void 0:n.invitee,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||r,opponentDeviceId:null==n?void 0:n.opponentDeviceId,opponentSessionId:null==n?void 0:n.opponentSessionId,groupCallId:null==n?void 0:n.groupCallId},o=new n0e(i);return e.reEmitter.reEmit(o,Object.values(bt)),o}var Zd=function(e){return e.DontNotify="dont_notify",e.Notify="notify",e.Coalesce="coalesce",e}({}),BP=function(e){return e.Highlight="highlight",e.Sound="sound",e}({}),r0e=function(e){return e.ExactEquals="==",e.LessThan="<",e.GreaterThan=">",e.GreaterThanOrEqual=">=",e.LessThanOrEqual="<=",e}({}),i0e="2";function s0e(e){return"==2"===e||"2"===e}var Dr=function(e){return e.EventMatch="event_match",e.EventPropertyIs="event_property_is",e.EventPropertyContains="event_property_contains",e.ContainsDisplayName="contains_display_name",e.RoomMemberCount="room_member_count",e.SenderNotificationPermission="sender_notification_permission",e.CallStarted="call_started",e.CallStartedPrefix="org.matrix.msc3914.call_started",e}({}),vi=function(e){return e.Override="override",e.ContentSpecific="content",e.RoomSpecific="room",e.SenderSpecific="sender",e.Underride="underride",e}({}),gi=function(e){return e.Master=".m.rule.master",e.IsUserMention=".m.rule.is_user_mention",e.IsRoomMention=".m.rule.is_room_mention",e.ContainsDisplayName=".m.rule.contains_display_name",e.ContainsUserName=".m.rule.contains_user_name",e.AtRoomNotification=".m.rule.roomnotif",e.DM=".m.rule.room_one_to_one",e.EncryptedDM=".m.rule.encrypted_room_one_to_one",e.Message=".m.rule.message",e.EncryptedMessage=".m.rule.encrypted",e.InviteToSelf=".m.rule.invite_for_me",e.MemberEvent=".m.rule.member_event",e.IncomingCall=".m.rule.call",e.SuppressNotices=".m.rule.suppress_notices",e.Tombstone=".m.rule.tombstone",e.PollStart=".m.rule.poll_start",e.PollStartUnstable=".org.matrix.msc3930.rule.poll_start",e.PollEnd=".m.rule.poll_end",e.PollEndUnstable=".org.matrix.msc3930.rule.poll_end",e.PollStartOneToOne=".m.rule.poll_start_one_to_one",e.PollStartOneToOneUnstable=".org.matrix.msc3930.rule.poll_start_one_to_one",e.PollEndOneToOne=".m.rule.poll_end_one_to_one",e.PollEndOneToOneUnstable=".org.matrix.msc3930.rule.poll_end_one_to_one",e}({});function R$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function I$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var k$=[vi.Override,vi.ContentSpecific,vi.RoomSpecific,vi.SenderSpecific,vi.Underride],o0e={".m.rule.is_room_mention":{rule_id:".m.rule.is_room_mention",default:!0,enabled:!0,conditions:[{kind:Dr.EventPropertyIs,key:"content.m\\.mentions.room",value:!0},{kind:Dr.SenderNotificationPermission,key:"room"}],actions:[Zd.Notify,{set_tweak:BP.Highlight}]},".m.rule.reaction":{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:Dr.EventMatch,key:"type",pattern:"m.reaction"}],actions:[Zd.DontNotify]},".org.matrix.msc3786.rule.room.server_acl":{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:Dr.EventMatch,key:"type",pattern:ee.RoomServerAcl},{kind:Dr.EventMatch,key:"state_key",pattern:""}],actions:[]}},HP=Symbol("UserDefinedRules"),a0e=[gi.Master,HP,gi.SuppressNotices,gi.InviteToSelf,gi.MemberEvent,gi.IsUserMention,gi.ContainsDisplayName,gi.IsRoomMention,gi.AtRoomNotification,gi.Tombstone,".m.rule.reaction",".m.rule.room.server_acl",".org.matrix.msc3786.rule.room.server_acl",".m.rule.suppress_edits"],c0e={".org.matrix.msc3914.rule.room.call":{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:Dr.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:Dr.CallStarted}],actions:[Zd.Notify,{set_tweak:BP.Sound,value:"default"}]}},l0e=[HP,gi.IncomingCall,".org.matrix.msc3914.rule.room.call",gi.EncryptedDM,gi.DM,gi.Message,gi.EncryptedMessage];function x$(e,t,n,r,i){var o=n.filter(e=>e.default),s=n.filter(e=>!e.default);function a(n){n===HP?c.push(...s):n in r?(e.warn("Adding default global ".concat(t," push rule ").concat(n)),c.push(r[n])):e.warn("Missing default global ".concat(t," push rule ").concat(n))}var l=0,c=[];for(var u of o){var d=i.indexOf(u.rule_id);if(-1!==d){for(;d>l;){a(i[l]),l+=1}c.push(u),l+=1}else c.push(u)}for(var h of i.slice(l))a(h);return c}class Fa{constructor(e){this.client=e,P(this,"parsedKeys",new Map)}static actionListToActionsObject(e){var t={notify:!1,tweaks:{}};for(var n of e)n===Zd.Notify?t.notify=!0:"object"==typeof n&&(void 0===n.value&&(n.value=!0),t.tweaks[n.set_tweak]=n.value);return t}static rewriteDefaultRules(e,t){var n=JSON.parse(JSON.stringify(t));return n||(n={}),n.global||(n.global={}),n.global.override||(n.global.override=[]),n.global.underride||(n.global.underride=[]),n.global.override=x$(e,vi.Override,n.global.override,o0e,a0e),n.global.underride=x$(e,vi.Underride,n.global.underride,c0e,l0e),n}static getPushRuleGlobRegex(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"i",[r,i]=t?["(?<=^|\\W)","(?=\\W|$)"]:["^","$"],o="".concat(t,"-").concat(n,"-").concat(e);return Fa.cachedGlobToRegex[o]||(Fa.cachedGlobToRegex[o]=new RegExp(r+"("+RX(e)+")"+i,n)),Fa.cachedGlobToRegex[o]}updateCachedPushRuleKeys(e){e||(e={}),e.global||(e.global={}),e.global.override||(e.global.override=[]),e.global.room||(e.global.room=[]),e.global.sender||(e.global.sender=[]),e.global.underride||(e.global.underride=[]);var t=new Set(this.parsedKeys.keys());for(var n of[e.global.override,e.global.room,e.global.sender,e.global.underride])for(var r of n)if(r.conditions)for(var i of r.conditions)i.kind===Dr.EventMatch&&(t.delete(i.key),this.parsedKeys.set(i.key,Fa.partsForDottedKey(i.key)));t.forEach(e=>this.parsedKeys.delete(e))}matchingRuleFromKindSet(e,t){for(var n of k$){var r=t[n];if(r)for(var i of r)if(i.enabled){var o=this.templateRuleToRaw(n,i);if(o&&this.ruleMatchesEvent(o,e))return I$(I$({},i),{},{kind:n})}}return null}templateRuleToRaw(e,t){var n={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case vi.Underride:case vi.Override:n.conditions=t.conditions;break;case vi.RoomSpecific:if(!t.rule_id)return null;n.conditions.push({kind:Dr.EventMatch,key:"room_id",value:t.rule_id});break;case vi.SenderSpecific:if(!t.rule_id)return null;n.conditions.push({kind:Dr.EventMatch,key:"user_id",value:t.rule_id});break;case vi.ContentSpecific:if(!t.pattern)return null;n.conditions.push({kind:Dr.EventMatch,key:"content.body",pattern:t.pattern})}return n}eventFulfillsCondition(e,t){switch(e.kind){case Dr.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case Dr.EventPropertyIs:return this.eventFulfillsEventPropertyIsCondition(e,t);case Dr.EventPropertyContains:return this.eventFulfillsEventPropertyContains(e,t);case Dr.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case Dr.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case Dr.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t);case Dr.CallStarted:case Dr.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,t)}return!1}eventFulfillsSenderNotifPermCondition(e,t){var n=e.key;if(!n)return!1;var r=this.client.getRoom(t.getRoomId());return!(null==r||!r.currentState)&&r.currentState.mayTriggerNotifOfType(n,t.getSender())}eventFulfillsRoomMemberCountCondition(e,t){if(!e.is)return!1;var n=this.client.getRoom(t.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;var r=n.currentState.getJoinedMemberCount(),i=e.is.match(/^([=<>]*)(\d*)$/);if(!i)return!1;var o=i[1],s=parseInt(i[2]);if(isNaN(s))return!1;switch(o){case"":case"==":return r==s;case"<":return r<s;case">":return r>s;case"<=":return r<=s;case">=":return r>=s;default:return!1}}eventFulfillsDisplayNameCondition(e,t){var n,r=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(r=t.getClearContent()),!r||!r.body||"string"!=typeof r.body)return!1;var i=this.client.getRoom(t.getRoomId()),o=null==i||null===(n=i.currentState)||void 0===n?void 0:n.getMember(this.client.credentials.userId);if(!o)return!1;var s=o.name,a=new RegExp("(^|\\W)"+TX(s)+"(\\W|$)","i");return r.body.search(a)>-1}eventFulfillsEventMatchCondition(e,t){if(!e.key)return!1;var n=this.valueForDottedKey(e.key,t);if("string"!=typeof n)return!1;if(e.value)return e.value===n;if("string"!=typeof e.pattern)return!1;var r=Fa.getPushRuleGlobRegex(e.pattern,"content.body"===e.key);return!!n.match(r)}eventFulfillsEventPropertyIsCondition(e,t){return!(!e.key||void 0===e.value)&&e.value===this.valueForDottedKey(e.key,t)}eventFulfillsEventPropertyContains(e,t){if(!e.key||void 0===e.value)return!1;var n=this.valueForDottedKey(e.key,t);return!!Array.isArray(n)&&n.includes(e.value)}eventFulfillsCallStartedCondition(e,t){return["m.ring","m.prompt"].includes(t.getContent()["m.intent"])&&!("m.terminated"in t.getContent())&&(t.getPrevContent()["m.terminated"]!==t.getContent()["m.terminated"]||df(t.getPrevContent(),{}))}static partsForDottedKey(e){var t=[],n="",r=!1;for(var i of e)r?(n+="\\"===i||"."===i?i:"\\"+i,r=!1):"."==i?(t.push(n),n=""):"\\"==i?r=!0:n+=i;return r&&(n+="\\"),t.push(n),t}valueForDottedKey(e,t){var n=this.parsedKeys.get(e);void 0===n&&(n=Fa.partsForDottedKey(e),this.parsedKeys.set(e,n));var r,i=n[0],o=0;for("content"===i?(r=t.getContent(),++o):"type"===i?(r=t.getType(),++o):r=t.event;o<n.length;++o){if(IX(r))return;r=r[n[o]]}return r}matchingRuleForEventWithRulesets(e,t){return t&&e.getSender()!==this.client.getSafeUserId()?this.matchingRuleFromKindSet(e,t.global):null}pushActionsForEventAndRulesets(e,t){var n=this.matchingRuleForEventWithRulesets(e,t);if(!n)return{};var r=Fa.actionListToActionsObject(n.actions);return void 0===r.tweaks.highlight&&(r.tweaks.highlight=n.kind==vi.ContentSpecific),{actions:r,rule:n}}ruleMatchesEvent(e,t){var n;return(!this.client.supportsIntentionalMentions()||void 0===t.getContent()["m.mentions"]||e.rule_id!==gi.ContainsUserName&&e.rule_id!==gi.ContainsDisplayName&&e.rule_id!==gi.AtRoomNotification)&&!(null!==(n=e.conditions)&&void 0!==n&&n.some(e=>!this.eventFulfillsCondition(e,t)))}actionsForEvent(e){var{actions:t}=this.pushActionsForEventAndRulesets(e,this.client.pushRules);return t||{}}actionsAndRuleForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){var t,n=this.getPushRuleAndKindById(e);return null!==(t=null==n?void 0:n.rule)&&void 0!==t?t:null}getPushRuleAndKindById(e){for(var t of["global"]){var n;if(void 0!==(null===(n=this.client.pushRules)||void 0===n?void 0:n[t]))for(var r of k$)if(void 0!==this.client.pushRules[t][r])for(var i of this.client.pushRules[t][r])if(i.rule_id===e)return{rule:i,kind:r}}return null}}P(Fa,"cachedGlobToRegex",{});var ob=["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6","v1.7","v1.8","v1.9"],u0e=ob[0],d0e=ob[ob.length-1],vo=function(e){return e.SUCCESS="SUCCESS",e.IGNORE="IGNORE",e.PROMPT="PROMPT",e.FAIL_PROMPT="FAIL_PROMPT",e.FAIL_ERROR="FAIL_ERROR",e}({}),Sa=function(e){return e.Invalid="Invalid homeserver discovery response",e.GenericFailure="Failed to get autodiscovery configuration from server",e.InvalidHsBaseUrl="Invalid base_url for m.homeserver",e.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",e.InvalidIsBaseUrl="Invalid base_url for m.identity_server",e.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",e.InvalidIs="Invalid identity server discovery response",e.MissingWellknown="No .well-known JSON file found",e.InvalidJson="Invalid JSON",e.UnsupportedHomeserverSpecVersion="The homeserver does not meet the version requirements",e}({});class ht{static fromDiscoveryConfig(e){var t=this;return B(function*(){var n,r={"m.homeserver":{state:ht.FAIL_ERROR,error:ht.ERROR_INVALID,base_url:null},"m.identity_server":{state:ht.PROMPT,error:null,base_url:null}};if(null==e||!e["m.homeserver"])return M.error("No m.homeserver key in config"),r["m.homeserver"].state=ht.FAIL_PROMPT,r["m.homeserver"].error=ht.ERROR_INVALID,Promise.resolve(r);if(!e["m.homeserver"].base_url)return M.error("No m.homeserver base_url in config"),r["m.homeserver"].state=ht.FAIL_PROMPT,r["m.homeserver"].error=ht.ERROR_INVALID_HS_BASE_URL,Promise.resolve(r);var i=t.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!i)return M.error("Invalid base_url for m.homeserver"),r["m.homeserver"].error=ht.ERROR_INVALID_HS_BASE_URL,Promise.resolve(r);var o=yield t.fetchWellKnownObject("".concat(i,"/_matrix/client/versions"));if(!o||!Array.isArray(null===(n=o.raw)||void 0===n?void 0:n.versions))return M.error("Invalid /versions response"),r["m.homeserver"].error=ht.ERROR_INVALID_HOMESERVER,r["m.homeserver"].base_url=i,Promise.resolve(r);var s=new Set(o.raw.versions),a=!1;for(var l of ob)if(s.has(l)){a=!0;break}if(!a)return M.error("Homeserver does not meet version requirements"),r["m.homeserver"].error=ht.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION,r["m.homeserver"].base_url=i,Promise.resolve(r);r["m.homeserver"]={state:ht.SUCCESS,error:null,base_url:i};var c="";if(e["m.identity_server"]){var u={"m.homeserver":r["m.homeserver"],"m.identity_server":{state:ht.FAIL_PROMPT,error:ht.ERROR_INVALID_IS,base_url:null}};if(!(c=t.sanitizeWellKnownUrl(e["m.identity_server"].base_url)))return M.error("Invalid base_url for m.identity_server"),u["m.identity_server"].error=ht.ERROR_INVALID_IS_BASE_URL,Promise.resolve(u);var d=yield t.fetchWellKnownObject("".concat(c,"/_matrix/identity/v2"));if(null==d||!d.raw||d.action!==vo.SUCCESS)return M.error("Invalid /v2 response"),u["m.identity_server"].error=ht.ERROR_INVALID_IDENTITY_SERVER,u["m.identity_server"].base_url=c,Promise.resolve(u)}return c&&c.toString().length>0&&(r["m.identity_server"]={state:ht.SUCCESS,error:null,base_url:c}),Object.keys(e).forEach(t=>{if("m.homeserver"===t||"m.identity_server"===t){var n=["error","state","base_url"];for(var i of Object.keys(e[t]))n.includes(i)||(r[t][i]=e[t][i])}else r[t]=e[t]}),Promise.resolve(r)})()}static findClientConfig(e){var t=this;return B(function*(){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");var n={"m.homeserver":{state:ht.FAIL_ERROR,error:ht.ERROR_INVALID,base_url:null},"m.identity_server":{state:ht.PROMPT,error:null,base_url:null}},r=e.includes("://")?e:"https://".concat(e),i=yield t.fetchWellKnownObject("".concat(r,"/.well-known/matrix/client"));return i&&i.action===vo.SUCCESS?ht.fromDiscoveryConfig(i.raw):(M.error("No response or error when parsing .well-known"),i.reason&&M.error(i.reason),i.action===vo.IGNORE?n["m.homeserver"]={state:ht.PROMPT,error:null,base_url:null}:(n["m.homeserver"].state=ht.FAIL_PROMPT,n["m.homeserver"].error=ht.ERROR_INVALID),Promise.resolve(n))})()}static getRawClientConfig(e){var t=this;return B(function*(){var n;if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");var r=yield t.fetchWellKnownObject("https://".concat(e,"/.well-known/matrix/client"));return r&&null!==(n=r.raw)&&void 0!==n?n:{}})()}static sanitizeWellKnownUrl(e){if(!e)return!1;try{var t,n;try{n=new URL(e)}catch(e){M.error("Could not parse url",e)}if(null===(t=n)||void 0===t||!t.hostname||"http:"!==n.protocol&&"https:"!==n.protocol)return!1;var r=n.port?":".concat(n.port):"",i=n.pathname?n.pathname:"",o="".concat(n.protocol,"//").concat(n.hostname).concat(r).concat(i);return o.endsWith("/")&&(o=o.substring(0,o.length-1)),o}catch(e){return M.error(e),!1}}static fetch(e,t){return this.fetchFn?this.fetchFn(e,t):globalThis.fetch(e,t)}static setFetchFn(e){ht.fetchFn=e}static fetchWellKnownObject(e){return B(function*(){var t;try{if(404===(t=yield ht.fetch(e,{method:le.Get,signal:F3(5e3)})).status)return{raw:{},action:vo.IGNORE,reason:ht.ERROR_MISSING_WELLKNOWN};if(200!==t.status)return{raw:{},action:vo.FAIL_PROMPT,reason:"General failure"}}catch(e){var n=e,r="";return"object"==typeof n&&(r=null==n?void 0:n.message),{error:n,raw:{},action:vo.FAIL_PROMPT,reason:r||"General failure"}}try{return{raw:yield t.json(),action:vo.SUCCESS}}catch(e){var i=e;return{error:i,raw:{},action:vo.FAIL_PROMPT,reason:"SyntaxError"===(null==i?void 0:i.name)?ht.ERROR_INVALID_JSON:ht.ERROR_INVALID}}})()}}P(ht,"ERROR_INVALID",Sa.Invalid),P(ht,"ERROR_GENERIC_FAILURE",Sa.GenericFailure),P(ht,"ERROR_INVALID_HS_BASE_URL",Sa.InvalidHsBaseUrl),P(ht,"ERROR_INVALID_HOMESERVER",Sa.InvalidHomeserver),P(ht,"ERROR_INVALID_IS_BASE_URL",Sa.InvalidIsBaseUrl),P(ht,"ERROR_INVALID_IDENTITY_SERVER",Sa.InvalidIdentityServer),P(ht,"ERROR_INVALID_IS",Sa.InvalidIs),P(ht,"ERROR_MISSING_WELLKNOWN",Sa.MissingWellknown),P(ht,"ERROR_INVALID_JSON",Sa.InvalidJson),P(ht,"ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION",Sa.UnsupportedHomeserverSpecVersion),P(ht,"ALL_ERRORS",Object.keys(Sa)),P(ht,"FAIL_ERROR",vo.FAIL_ERROR),P(ht,"FAIL_PROMPT",vo.FAIL_PROMPT),P(ht,"PROMPT",vo.PROMPT),P(ht,"SUCCESS",vo.SUCCESS),P(ht,"fetchFn",void 0);var Z5=function(e){return e.IS="SERVICE_TYPE_IS",e.IM="SERVICE_TYPE_IM",e}({});class f0e{constructor(e){this.ourEvent=e,P(this,"timeline",void 0),P(this,"ourEventIndex",0),P(this,"paginateTokens",{[gt.Backward]:null,[gt.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.paginateTokens[e?gt.Backward:gt.Forward]}setPaginateToken(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.paginateTokens[t?gt.Backward:gt.Forward]=e??null}addEvents(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}class V3{static fromJson(e,t){var n=e.context||{},r=(n.events_before||[]).map(t),i=(n.events_after||[]).map(t),o=new f0e(t(e.result)),s=o.ourEvent.threadRootId;return r=r.filter(e=>e.threadRootId===s),i=i.filter(e=>e.threadRootId===s),o.setPaginateToken(n.start,!0),o.addEvents(r,!0),o.addEvents(i,!1),o.setPaginateToken(n.end,!1),new V3(e.rank,o)}constructor(e,t){this.rank=e,this.context=t}}var xJ=function(e){return e.Public="public",e.Private="private",e}({}),q3=function(e){return e.PrivateChat="private_chat",e.TrustedPrivateChat="trusted_private_chat",e.PublicChat="public_chat",e}({}),ef=function(e){return e.Public="public",e.Invite="invite",e.Private="private",e.Knock="knock",e.Restricted="restricted",e}({}),h0e=function(e){return e.RoomMembership="m.room_membership",e}({}),eC=function(e){return e.CanJoin="can_join",e.Forbidden="forbidden",e}({}),VP=function(e){return e.Invited="invited",e.Joined="joined",e.Shared="shared",e.WorldReadable="world_readable",e}({});function A$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function L$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p0e(e,t){var n=!!t.preventReEmit,r=!1!==t.decrypt;return function t(i){var o,s=e.getRoom(i.room_id);s&&void 0===i.state_key&&(o=s.findEventById(i.event_id)),!o||o.status?o=new Zi(i):(o.setUnsigned(L$(L$({},o.getUnsigned()),i.unsigned)),n=!0);var a=o.getServerAggregatedRelation(kn.Replace);if(null!=a&&a.content){var l=t(a);o.makeReplaced(l)}var c=null==s?void 0:s.findThreadForEvent(o);return c&&o.setThread(c),o.isEncrypted()&&(n||e.reEmitter.reEmit(o,[qt.Decrypted]),r&&e.decryptEventIfNeeded(o)),n||(e.reEmitter.reEmit(o,[qt.Replaced,qt.VisibilityChange]),null==s||s.reEmitter.reEmit(o,[qt.BeforeRedaction])),o}}function P$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function bd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class O${constructor(e,t,n){this.client=e,this.indexEvent=t,this.directory=n}get id(){var e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return!0===this.indexEvent.getContent().active}get version(){var e;return null!==(e=this.indexEvent.getContent().version)&&void 0!==e?e:1}get roomId(){return this.indexEvent.getRoomId()}delete(){var e=this;return B(function*(){yield e.client.sendStateEvent(e.roomId,tu.name,{},e.id),yield e.client.redactEvent(e.roomId,e.id);var t=(yield e.getVersionHistory())[1];t&&(yield t.delete())})()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}setName(e){var t=this;return B(function*(){yield t.client.sendStateEvent(t.roomId,tu.name,bd(bd({},t.indexEvent.getContent()),{},{name:e}),t.id)})()}isLocked(){return this.indexEvent.getContent().locked||!1}setLocked(e){var t=this;return B(function*(){yield t.client.sendStateEvent(t.roomId,tu.name,bd(bd({},t.indexEvent.getContent()),{},{locked:e}),t.id)})()}getFileInfo(){var e=this;return B(function*(){var t=(yield e.getFileEvent()).getOriginalContent().file,n=e.client.mxcUrlToHttp(t.url);if(!n)throw new Error("No HTTP URL available for ".concat(t.url));return{info:t,httpUrl:n}})()}getFileEvent(){var e=this;return B(function*(){var t=e.client.getRoom(e.roomId);if(!t)throw new Error("Unknown room");for(var n=t.getUnfilteredTimelineSet().findEventById(e.id);!n&&t.getLiveTimeline().getState(Me.BACKWARDS).paginationToken;)yield e.client.scrollback(t,100),n=t.getUnfilteredTimelineSet().findEventById(e.id);if(!n)throw new Error("Failed to find event");return yield e.client.decryptEventIfNeeded(n),n})()}createNewVersion(e,t,n,r){var i=this;return B(function*(){var o=yield i.directory.createFile(e,t,n,bd(bd({},r??{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:kn.Replace,event_id:i.id}}));return yield i.client.sendStateEvent(i.roomId,tu.name,{active:!0,name:e,version:i.version+1},o.event_id),yield i.client.sendStateEvent(i.roomId,tu.name,bd(bd({},i.indexEvent.getContent()),{},{active:!1}),i.id),o})()}getVersionHistory(){var e=this;return B(function*(){var t=[];t.push(e);var n=e.client.getRoom(e.roomId);if(!n)throw new Error("Invalid or unknown room");var r,i=[...n.getLiveTimeline().getEvents()].reverse(),o=yield e.getFileEvent();do{if(r=i.find(e=>e.replacingEventId()===o.getId())){var s=e.directory.getFile(r.getId());if(!s)break;t.push(s),o=r}}while(r);return t})()}}function M$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function uh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m0e={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[ee.RoomPowerLevels]:100,[ee.RoomHistoryVisibility]:100,[ee.RoomTombstone]:100,[ee.RoomEncryption]:100,[ee.RoomName]:50,[ee.RoomMessage]:50,[ee.RoomMessageEncrypted]:50,[ee.Sticker]:50},users:{}},Im=function(e){return e.Viewer="viewer",e.Editor="editor",e.Owner="owner",e}({});class D${constructor(e,t){if(this.client=e,this.roomId=t,P(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){var e=this.room.currentState.getStateEvents(ee.SpaceParent);return null==e||!e.length||e.every(e=>{var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)})}setName(e){var t=this;return B(function*(){yield t.client.sendStateEvent(t.roomId,ee.RoomName,{name:e},"")})()}invite(e){var t=arguments,n=this;return B(function*(){var r=!(t.length>1&&void 0!==t[1])||t[1],i=[n.retryInvite(e)];r&&i.push(...n.getDirectories().map(t=>t.invite(e,r))),yield Promise.all(i)})()}retryInvite(e){var t=this;return eve(B(function*(){yield t.client.invite(t.roomId,e).catch(e=>{throw"M_FORBIDDEN"===(null==e?void 0:e.errcode)?new wX.AbortError(e):e})}))}setPermissions(e,t){var n=this;return B(function*(){var r,i=n.room.currentState.getStateEvents(ee.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");var o=(null==i?void 0:i.getContent())||{},s=o.users_default||0,a=o.events_default||50,l=(null===(r=o.events)||void 0===r?void 0:r[ee.RoomPowerLevels])||100,c=o.users||{};switch(t){case Im.Viewer:c[e]=s;break;case Im.Editor:c[e]=a;break;case Im.Owner:c[e]=l;break;default:throw new Error("Invalid role: "+t)}o.users=c,yield n.client.sendStateEvent(n.roomId,ee.RoomPowerLevels,o,"")})()}getPermissions(e){var t,n,r=this.room.currentState.getStateEvents(ee.RoomPowerLevels,"");if(Array.isArray(r))throw new Error("Unexpected return type for power levels");var i=(null==r?void 0:r.getContent())||{},o=i.users_default||0,s=i.events_default||50,a=(null===(t=i.events)||void 0===t?void 0:t[ee.RoomPowerLevels])||100,l=(null===(n=i.users)||void 0===n?void 0:n[e])||o;return l>=a?Im.Owner:l>=s?Im.Editor:Im.Viewer}createDirectory(e){var t=this;return B(function*(){var n=yield t.client.unstableCreateFileTree(e);return yield t.client.sendStateEvent(t.roomId,ee.SpaceChild,{via:[t.client.getDomain()]},n.roomId),yield t.client.sendStateEvent(n.roomId,ee.SpaceParent,{via:[t.client.getDomain()]},t.roomId),n})()}getDirectories(){var e=[],t=this.room.currentState.getStateEvents(ee.SpaceChild);for(var n of t)try{var r=n.getStateKey();if(r){var i=this.client.unstableGetFileTreeSpace(r);i&&e.push(i)}}catch(e){M.warn("Unable to create tree space instance for listing. Are we joined?",e)}return e}getDirectory(e){return this.getDirectories().find(t=>t.roomId===e)}delete(){var e=this;return B(function*(){var t=e.getDirectories();for(var n of t)yield n.delete();var r=[Ve.Invite,Ve.Knock,Ve.Join],i=e.room.currentState.getStateEvents(ee.RoomMember);for(var o of i){if(o.getStateKey()!==e.client.getUserId()&&r.includes(o.getContent().membership)){var s=o.getStateKey();if(!s)throw new Error("State key not found for branch");yield e.client.kick(e.roomId,s,"Room deleted")}}yield e.client.leave(e.roomId)})()}getOrderedChildren(e){var t=e.map(e=>({roomId:e.getStateKey(),order:e.getContent().order})).filter(e=>e.roomId);return t.sort((e,t)=>{if(e.order&&!t.order)return-1;if(!e.order&&t.order)return 1;if(e.order||t.order)return ME(e.order,t.order);var n,r,i,o,s=this.client.getRoom(e.roomId),a=this.client.getRoom(t.roomId);if(!s||!a)return ME(e.roomId,t.roomId);var l=null!==(n=null===(r=s.currentState.getStateEvents(ee.RoomCreate,""))||void 0===r?void 0:r.getTs())&&void 0!==n?n:0,c=null!==(i=null===(o=a.currentState.getStateEvents(ee.RoomCreate,""))||void 0===o?void 0:o.getTs())&&void 0!==i?i:0;return l===c?ME(e.roomId,t.roomId):l-c}),t}getParentRoom(){var e=this.room.currentState.getStateEvents(ee.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");var t=e.getStateKey();if(!t)throw new Error("No state key found for parent");var n=this.client.getRoom(t);if(!n)throw new Error("Unable to locate room for parent");return n}getOrder(){if(this.isTopLevel)return-1;var e=this.getParentRoom().currentState.getStateEvents(ee.SpaceChild);return this.getOrderedChildren(e).findIndex(e=>e.roomId===this.roomId)}setOrder(e){var t=this;return B(function*(){var n;if(t.isTopLevel)throw new Error("Cannot set order of top level spaces currently");var r=t.getParentRoom(),i=r.currentState.getStateEvents(ee.SpaceChild),o=t.getOrderedChildren(i);e=Math.max(Math.min(e,o.length-1),0);var s=t.getOrder()<e;s&&e===o.length-1?e--:!s&&0===e&&e++;var a=o[s?e:e-1],l=o[s?e+1:e],c=ff[0],u=!1;if(a)if(e===o.length-1)null!=l&&l.order&&(c=l0(l.order));else{var d=null==a?void 0:a.order,h=null==l?void 0:l.order;d&&h?c=d===h?l0(d):tve(d,h):d?c=l0(d):h?c=EF(h):u=!0}else null!=l&&l.order&&(c=EF(l.order));if(u){for(var p,f=0;f<=e;f++){var m=o[f];if(0===f&&(p=m.order),m.order)p=m.order;else{var v;p=p?l0(p):ff[0];var g=r.currentState.getStateEvents(ee.SpaceChild,m.roomId),y=null!==(v=null==g?void 0:g.getContent())&&void 0!==v?v:{via:[t.client.getDomain()]};yield t.client.sendStateEvent(r.roomId,ee.SpaceChild,uh(uh({},y),{},{order:p}),m.roomId)}}p&&(c=l0(p))}var b=r.currentState.getStateEvents(ee.SpaceChild,t.roomId),w=null!==(n=null==b?void 0:b.getContent())&&void 0!==n?n:{via:[t.client.getDomain()]};yield t.client.sendStateEvent(r.roomId,ee.SpaceChild,uh(uh({},w),{},{order:c}),t.roomId)})()}createFile(e,t,n,r){var i=this;return B(function*(){var{content_uri:o}=yield i.client.uploadContent(t,{includeFilename:!1});n.url=o;var s={msgtype:cl.File,body:e,url:o,file:n};(r=r??{})["m.new_content"]&&(r["m.new_content"]=s);var a=yield i.client.sendMessage(i.roomId,uh(uh(uh({},r),s),{},{[OX.name]:{}}));return yield i.client.sendStateEvent(i.roomId,tu.name,{active:!0,name:e},a.event_id),a})()}getFile(e){var t=this.room.currentState.getStateEvents(tu.name,e);return t?new O$(this.client,t,this):null}listFiles(){return this.listAllFiles().filter(e=>e.isActive)}listAllFiles(){var e;return(null!==(e=this.room.currentState.getStateEvents(tu.name))&&void 0!==e?e:[]).map(e=>new O$(this.client,e,this))}}var AJ=function(e){return e.Recent="recent",e.Rank="rank",e}({}),Eh=function(e){return e.LocalStreamsChanged="local_streams_changed",e}({});class g0e extends Pn{constructor(e){super(),this.client=e,P(this,"audioInput",void 0),P(this,"audioSettings",void 0),P(this,"videoInput",void 0),P(this,"localUserMediaStream",void 0),P(this,"userMediaStreams",[]),P(this,"screensharingStreams",[]),P(this,"getMediaStreamPromise",void 0)}restoreMediaSettings(e,t){this.audioInput=e,this.videoInput=t}setAudioInput(e){var t=this;return B(function*(){M.info("MediaHandler setAudioInput() running (deviceId=".concat(e,")")),t.audioInput!==e&&(t.audioInput=e,yield t.updateLocalUsermediaStreams())})()}setAudioSettings(e){var t=this;return B(function*(){M.info("MediaHandler setAudioSettings() running (opts=".concat(JSON.stringify(e),")")),t.audioSettings=Object.assign({},e),yield t.updateLocalUsermediaStreams()})()}setVideoInput(e){var t=this;return B(function*(){M.info("MediaHandler setVideoInput() running (deviceId=".concat(e,")")),t.videoInput!==e&&(t.videoInput=e,yield t.updateLocalUsermediaStreams())})()}setMediaInputs(e,t){var n=this;return B(function*(){M.log("MediaHandler setMediaInputs() running (audioInput: ".concat(e," videoInput: ").concat(t,")")),n.audioInput=e,n.videoInput=t,yield n.updateLocalUsermediaStreams()})()}updateLocalUsermediaStreams(){var e=this;return B(function*(){if(0!==e.userMediaStreams.length){var t=new Map;for(var n of e.client.callEventHandler.calls.values())t.set(n.callId,{audio:n.hasLocalUserMediaAudioTrack,video:n.hasLocalUserMediaVideoTrack});for(var r of e.userMediaStreams)for(var i of(M.log("MediaHandler updateLocalUsermediaStreams() stopping all tracks (streamId=".concat(r.id,")")),r.getTracks()))i.stop();for(var o of(e.userMediaStreams=[],e.localUserMediaStream=void 0,e.client.callEventHandler.calls.values()))if(!o.callHasEnded()&&t.has(o.callId)){var{audio:s,video:a}=t.get(o.callId);M.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (callId=".concat(o.callId,")"));var l=yield e.getUserMediaStream(s,a);o.callHasEnded()||(yield o.updateLocalUsermediaStream(l))}for(var c of e.client.groupCallEventHandler.groupCalls.values())if(c.localCallFeed){M.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (groupCallId=".concat(c.groupCallId,")"));var u=yield e.getUserMediaStream(!0,c.type===H3.Video);c.state!==er.Ended&&(yield c.updateLocalUsermediaStream(u))}e.emit(Eh.LocalStreamsChanged)}})()}hasAudioDevice(){return B(function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind).length>0}catch(e){return M.log("MediaHandler hasAudioDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}})()}hasVideoDevice(){return B(function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind).length>0}catch(e){return M.log("MediaHandler hasVideoDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}})()}getUserMediaStream(e,t){var n=arguments,r=this;return B(function*(){var i=!(n.length>2&&void 0!==n[2])||n[2];return r.getMediaStreamPromise?r.getMediaStreamPromise=r.getMediaStreamPromise.then(()=>r.getUserMediaStreamInternal(e,t,i)):r.getMediaStreamPromise=r.getUserMediaStreamInternal(e,t,i),r.getMediaStreamPromise})()}getUserMediaStreamInternal(e,t,n){var r=this;return B(function*(){var i,o,s,a=e&&(yield r.hasAudioDevice()),l=t&&(yield r.hasVideoDevice()),c=!0;r.localUserMediaStream?(a!==r.localUserMediaStream.getAudioTracks().length>0&&(c=!1),l!==r.localUserMediaStream.getVideoTracks().length>0&&(c=!1),a&&(null===(o=r.localUserMediaStream.getAudioTracks()[0])||void 0===o||null===(o=o.getSettings())||void 0===o?void 0:o.deviceId)!==r.audioInput&&(c=!1),l&&(null===(s=r.localUserMediaStream.getVideoTracks()[0])||void 0===s||null===(s=s.getSettings())||void 0===s?void 0:s.deviceId)!==r.videoInput&&(c=!1)):c=!1;if(c){var u;if(i=r.localUserMediaStream.clone(),M.log("MediaHandler getUserMediaStreamInternal() cloning (oldStreamId=".concat(null===(u=r.localUserMediaStream)||void 0===u?void 0:u.id," newStreamId=").concat(i.id," shouldRequestAudio=").concat(a," shouldRequestVideo=").concat(l,")")),!a)for(var d of i.getAudioTracks())i.removeTrack(d);if(!l)for(var h of i.getVideoTracks())i.removeTrack(h)}else{var p=r.getUserMediaContraints(a,l);for(var f of(i=yield navigator.mediaDevices.getUserMedia(p),M.log("MediaHandler getUserMediaStreamInternal() calling getUserMediaStream (streamId=".concat(i.id,", shouldRequestAudio=").concat(a,", shouldRequestVideo=").concat(l,", constraints=").concat(JSON.stringify(p),")")),i.getTracks())){var m=f.getSettings();"audio"===f.kind?r.audioInput=m.deviceId:"video"===f.kind&&(r.videoInput=m.deviceId)}n&&(r.localUserMediaStream=i)}return n&&r.userMediaStreams.push(i),r.emit(Eh.LocalStreamsChanged),i})()}stopUserMediaStream(e){for(var t of(M.log("MediaHandler stopUserMediaStream() stopping (streamId=".concat(e.id,")")),e.getTracks()))t.stop();var n=this.userMediaStreams.indexOf(e);if(-1!==n&&(M.debug("MediaHandler stopUserMediaStream() splicing usermedia stream out stream array (streamId=".concat(e.id,")"),e.id),this.userMediaStreams.splice(n,1)),this.emit(Eh.LocalStreamsChanged),this.localUserMediaStream===e)this.localUserMediaStream=void 0;else for(var r of e.getTracks()){var i;if(null!==(i=this.localUserMediaStream)&&void 0!==i&&i.getTrackById(r.id)){this.stopUserMediaStream(this.localUserMediaStream);break}}}getScreensharingStream(){var e=arguments,t=this;return B(function*(){var n,r=e.length>0&&void 0!==e[0]?e[0]:{},i=!(e.length>1&&void 0!==e[1])||e[1];if(0===t.screensharingStreams.length){var o=t.getScreenshareContraints(r);r.desktopCapturerSourceId?(M.debug("MediaHandler getScreensharingStream() calling getUserMedia() (opts=".concat(JSON.stringify(r),")")),n=yield navigator.mediaDevices.getUserMedia(o)):(M.debug("MediaHandler getScreensharingStream() calling getDisplayMedia() (opts=".concat(JSON.stringify(r),")")),n=yield navigator.mediaDevices.getDisplayMedia(o))}else{var s=t.screensharingStreams[t.screensharingStreams.length-1];M.log("MediaHandler getScreensharingStream() cloning (streamId=".concat(s.id,")")),n=s.clone()}return i&&t.screensharingStreams.push(n),t.emit(Eh.LocalStreamsChanged),n})()}stopScreensharingStream(e){for(var t of(M.debug("MediaHandler stopScreensharingStream() stopping stream (streamId=".concat(e.id,")")),e.getTracks()))t.stop();var n=this.screensharingStreams.indexOf(e);-1!==n&&(M.debug("MediaHandler stopScreensharingStream() splicing stream out (streamId=".concat(e.id,")")),this.screensharingStreams.splice(n,1)),this.emit(Eh.LocalStreamsChanged)}stopAllStreams(){for(var e of this.userMediaStreams)for(var t of(M.log("MediaHandler stopAllStreams() stopping (streamId=".concat(e.id,")")),e.getTracks()))t.stop();for(var n of this.screensharingStreams)for(var r of n.getTracks())r.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(Eh.LocalStreamsChanged)}getUserMediaContraints(e,t){var n=!!navigator.webkitGetUserMedia;return{audio:!!e&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0},video:!!t&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:n?{exact:640}:{ideal:640},height:n?{exact:360}:{ideal:360}}}}getScreenshareContraints(e){var{desktopCapturerSourceId:t,audio:n}=e;return t?{audio:n??!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t}}}:{audio:n??!1,video:!0}}}var N$=function(e){return e.RequestFinished="FINISHED",e.Complete="COMPLETE",e}({}),o_=function(e){return e.PreProcess="ExtState.PreProcess",e.PostProcess="ExtState.PostProcess",e}({}),eA=function(e){return e.RoomData="SlidingSync.RoomData",e.Lifecycle="SlidingSync.Lifecycle",e}({}),v0e=3;class y0e{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return o_.PreProcess}onRequest(e){var t=this;return B(function*(){return e&&(M.log("ExtensionE2EE: invalidating all device lists due to missing 'pos'"),yield t.crypto.markAllTrackedUsersAsDirty()),{enabled:!0}})()}onResponse(e){var t=this;return B(function*(){e.device_lists&&(yield t.crypto.processDeviceLists(e.device_lists)),yield t.crypto.processKeyCounts(e.device_one_time_keys_count,e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]),t.crypto.onSyncCompleted({})})()}}class b0e{constructor(e,t){this.client=e,this.cryptoCallbacks=t,P(this,"nextBatch",null)}name(){return"to_device"}when(){return o_.PreProcess}onRequest(e){var t=this;return B(function*(){return{since:null!==t.nextBatch?t.nextBatch:void 0,limit:100,enabled:!0}})()}onResponse(e){var t=this;return B(function*(){var n=e.events||[];wJ(t.cryptoCallbacks?yield t.cryptoCallbacks.preprocessToDeviceMessages(n):n.map(e=>({message:e,encryptionInfo:null})),t.client),t.nextBatch=e.next_batch})()}}class _0e{constructor(e){this.client=e}name(){return"account_data"}when(){return o_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var t=this;return B(function*(){for(var n in e.global&&e.global.length>0&&t.processGlobalAccountData(e.global),e.rooms){var r=yg(t.client,n,e.rooms[n]),i=t.client.getRoom(n);i?(i.addAccountData(r),r.forEach(e=>{t.client.emit(Le.Event,e)})):M.warn("got account data for room but room doesn't exist on client:",n)}})()}processGlobalAccountData(e){var t=yg(this.client,void 0,e),n=t.reduce((e,t)=>(e[t.getType()]=this.client.store.getAccountData(t.getType()),e),{});this.client.store.storeAccountDataEvents(t),t.forEach(e=>{if(e.getType()===ee.PushRules){var t=e.getContent();this.client.setPushRules(t)}var r=n[e.getType()];return this.client.emit(Le.AccountData,e,r),e})}}class S0e{constructor(e){this.client=e}name(){return"typing"}when(){return o_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var t=this;return B(function*(){if(null!=e&&e.rooms)for(var n in e.rooms)PJ(t.client,n,[e.rooms[n]])})()}}class E0e{constructor(e){this.client=e}name(){return"receipts"}when(){return o_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var t=this;return B(function*(){if(null!=e&&e.rooms)for(var n in e.rooms)PJ(t.client,n,[e.rooms[n]])})()}}class LJ{constructor(e,t,n,r){this.slidingSync=e,this.client=t,P(this,"opts",void 0),P(this,"syncOpts",void 0),P(this,"syncState",null),P(this,"syncStateData",void 0),P(this,"lastPos",null),P(this,"failCount",0),P(this,"notifEvents",[]),this.opts=_J(n),this.syncOpts=SJ(r),t.getNotifTimelineSet()&&t.reEmitter.reEmit(t.getNotifTimelineSet(),[xe.Timeline,xe.TimelineReset]),this.slidingSync.on(eA.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(eA.RoomData,this.onRoomData.bind(this));var i=[new b0e(this.client,this.syncOpts.cryptoCallbacks),new _0e(this.client),new S0e(this.client),new E0e(this.client)];this.syncOpts.cryptoCallbacks&&i.push(new y0e(this.syncOpts.cryptoCallbacks)),i.forEach(e=>{this.slidingSync.registerExtension(e)})}onRoomData(e,t){var n=this;return B(function*(){var r=n.client.store.getRoom(e);if(!r){if(!t.initial)return void n.syncOpts.logger.debug("initial flag not set but no stored room exists for room ",e,t);r=EJ(n.client,e,n.opts)}yield n.processRoomData(n.client,r,t)})()}onLifecycle(e,t,n){switch(n&&this.syncOpts.logger.debug("onLifecycle",e,n),e){case N$.Complete:if(this.purgeNotifications(),!t)break;this.lastPos||this.updateSyncState(Vt.Prepared,{oldSyncToken:void 0,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(Vt.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.lastPos=t.pos;break;case N$.RequestFinished:if(n){if(this.failCount+=1,this.updateSyncState(this.failCount>v0e?Vt.Error:Vt.Reconnecting,{error:new nr(n)}),this.shouldAbortSync(new nr(n)))return}else this.failCount=0,this.syncOpts.logger.debug("SlidingSyncState.RequestFinished with ".concat(Object.keys((null==t?void 0:t.rooms)||[]).length," rooms"))}}syncLeftRooms(){return B(function*(){return[]})()}peek(e){return B(function*(){return null})()}stopPeeking(){}setPresence(e){}getSyncState(){return this.syncState}getSyncStateData(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}createRoom(e){var{timelineSupport:t}=this.client,n=new $3(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:t});return this.client.reEmitter.reEmit(n,[xe.Name,xe.Redaction,xe.RedactionCancelled,xe.Receipt,xe.Tags,xe.LocalEchoUpdated,xe.AccountData,xe.MyMembership,xe.Timeline,xe.TimelineReset]),this.registerStateListeners(n),n}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[vt.Events,vt.Members,vt.NewMember,vt.Update]),e.currentState.on(vt.NewMember,(e,t,n)=>{var r;n.user=null!==(r=this.client.getUser(n.userId))&&void 0!==r?r:void 0,this.client.reEmitter.reEmit(n,[Ns.Name,Ns.Typing,Ns.PowerLevel,Ns.Membership])})}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(this.syncOpts.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Vt.Error,{error:e}),!0)}processRoomData(e,t,n){var r=this;return B(function*(){n=w0e(e,t.roomId,n);var i=yg(r.client,t.roomId,n.required_state),o=yg(r.client,t.roomId,n.timeline,!1),s=[];if(n.limited||n.initial){var a=new Set;t.getLiveTimeline().getEvents().forEach(e=>{a.add(e.getId())});for(var l=[],c=[],u=!1,d=o.length-1;d>=0;d--){var h=o[d];a.has(h.getId())?u=!0:u?l.push(h):c.unshift(h)}o=c,l.length>0&&t.addEventsToTimeline(l,!0,!1,t.getLiveTimeline(),n.prev_batch)}var p,f=t.hasEncryptionStateEvent();if(null!=n.notification_count&&t.setUnreadNotificationCount(zt.Total,n.notification_count),null!=n.highlight_count&&(!f||f&&t.getUnreadNotificationCount(zt.Highlight)<=0)&&t.setUnreadNotificationCount(zt.Highlight,n.highlight_count),n.bump_stamp&&t.setBumpStamp(n.bump_stamp),Number.isInteger(n.invited_count)&&t.currentState.setInvitedMemberCount(n.invited_count),Number.isInteger(n.joined_count)&&t.currentState.setJoinedMemberCount(n.joined_count),n.invite_state){var m=yg(r.client,t.roomId,n.invite_state);return yield r.injectRoomEvents(t,m),n.initial&&(t.recalculate(),r.client.store.storeRoom(t),r.client.emit(Le.Room,t)),void m.forEach(e=>{r.client.emit(Le.Event,e)})}n.limited&&t.getLiveTimeline().setPaginationToken(null!==(p=n.prev_batch)&&void 0!==p?p:null,Me.BACKWARDS);yield r.injectRoomEvents(t,i,o,n.num_live),t.addEphemeralEvents(s),t.updateMyMembership(Ve.Join),t.setMSC4186SummaryData(n.heroes,n.joined_count,n.invited_count),t.recalculate(),n.initial&&(e.store.storeRoom(t),e.emit(Le.Room,t)),r.addNotifications(o);var v,g=(v=B(function*(n){e.emit(Le.Event,n),n.isState()&&n.getType()==ee.RoomEncryption&&r.syncOpts.cryptoCallbacks&&(yield r.syncOpts.cryptoCallbacks.onCryptoEvent(t,n))}),function(e){return v.apply(this,arguments)});yield tg(i,g),yield tg(o,g),s.forEach(function(t){e.emit(Le.Event,t)}),t.decryptCriticalEvents()})()}injectRoomEvents(e,t){var n=arguments,r=this;return B(function*(){var i=n.length>2&&void 0!==n[2]?n[2]:[],o=n.length>3&&void 0!==n[3]?n[3]:0,s=e.getLiveTimeline(),a=0==s.getEvents().length;if(a){for(var l of t)r.client.getPushActionsForEvent(l);s.initialiseState(t)}a||(e.oldState.setStateEvents(t),e.currentState.setStateEvents(t));var c=[];o>0&&(c=i.slice(-1*o),i=i.slice(0,-1*c.length)),yield e.addLiveEvents(i,{fromCache:!0,addToState:!1}),c.length>0&&(yield e.addLiveEvents(c,{fromCache:!1,addToState:!1})),e.recalculate(),r.resolveInvites(e)})()}resolveInvites(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership(Ve.Invite).forEach(function(n){if(!n.requestedProfileInfo){n.requestedProfileInfo=!0;var r=t.getUser(n.userId);(r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then(function(t){var r=n.events.member;r.getContent().membership===Ve.Invite&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))},function(e){})}})}}retryImmediately(){return!0}sync(){var e=this;return B(function*(){for(e.syncOpts.logger.debug("Sliding sync init loop");!e.client.isGuest();)try{e.syncOpts.logger.debug("Getting push rules...");var t=yield e.client.getPushRules();e.syncOpts.logger.debug("Got push rules"),e.client.pushRules=t;break}catch(t){if(e.syncOpts.logger.error("Getting push rules failed",t),e.shouldAbortSync(t))return}yield e.slidingSync.start()})()}stop(){this.syncOpts.logger.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,t){var n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(Le.Sync,this.syncState,n,t)}addNotifications(e){if(this.client.getNotifTimelineSet())for(var t of e){var n=this.client.getPushActionsForEvent(t);n&&n.notify&&n.tweaks&&n.tweaks.highlight&&this.notifEvents.push(t)}}purgeNotifications(){this.notifEvents.sort(function(e,t){return e.getTs()-t.getTs()}),this.notifEvents.forEach(e=>{var t;null===(t=this.client.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e,{addToState:!1})}),this.notifEvents=[]}}function w0e(e,t,n){if(!n.name)return n;for(var r of n.required_state)if(r.type===ee.RoomName&&""===r.state_key)return r.content={name:n.name},n;return n.required_state.push({event_id:"$fake-sliding-sync-name-event-"+t,state_key:"",type:ee.RoomName,content:{name:n.name},sender:e.getUserId(),origin_server_ts:(new Date).getTime()}),n}function yg(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.getEventMapper({decrypt:r});return n.map(function(e){return e.room_id=t,i(e)})}function PJ(e,t,n){var r=yg(e,t,n),i=e.getRoom(t);i?(i.addEphemeralEvents(r),r.forEach(t=>{e.emit(Le.Event,t)})):M.warn("got ephemeral events for room but room doesn't exist on client:",t)}var qP=new xr("m.beacon_info","org.matrix.msc3672.beacon_info"),tA=new xr("m.beacon","org.matrix.msc3672.beacon");class Xg{static RETRY_BACKOFF_RATELIMIT(e,t,n){return NP(n,t,!1)}static QUEUE_MESSAGES(e){return e.getType()===ee.RoomMessage||e.hasAssociation()?"message":null}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xg.RETRY_BACKOFF_RATELIMIT,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xg.QUEUE_MESSAGES;this.retryAlgorithm=e,this.queueAlgorithm=t,P(this,"queues",{}),P(this,"activeQueues",[]),P(this,"procFn",null),P(this,"processQueue",e=>{var t=this.peekNextEvent(e);t?(this.queues[e].length,Promise.resolve().then(()=>this.procFn(t.event)).then(n=>{this.removeNextEvent(e),t.event.getId(),t.resolvers.resolve(n),this.processQueue(e)},n=>{t.attempts+=1;var r=this.retryAlgorithm(t.event,t.attempts,n);t.attempts,t.event.getId(),-1===r?(M.info("Queue '%s' giving up on event %s",e,t.event.getId()),this.clearQueue(e,n)):setTimeout(this.processQueue,r,e)})):this.disableQueue(e)})}getQueueForEvent(e){var t=this.queueAlgorithm(e);return t&&this.queues[t]?this.queues[t].map(function(e){return e.event}):null}removeEventFromQueue(e){var t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;var n=!1;return qw(this.queues[t],t=>t.event.getId()===e.getId()&&(n=!0,!0)),n}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){var t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);var n=Promise.withResolvers();return this.queues[t].push({event:e,resolvers:n,attempts:0}),e.getId(),this.startProcessingQueues(),n.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter(e=>-1===this.activeQueues.indexOf(e)&&this.queues[e].length>0).forEach(e=>{this.activeQueues.push(e),this.processQueue(e)})}disableQueue(e){var t=this.activeQueues.indexOf(e);t>=0&&this.activeQueues.splice(t,1),M.info("Stopping queue '%s' as it is now empty",e)}clearQueue(e,t){M.info("clearing queue '%s'",e);for(var n;n=this.removeNextEvent(e);)n.resolvers.reject(t);this.disableQueue(e)}peekNextEvent(e){var t=this.queues[e];if(Array.isArray(t))return t[0]}removeNextEvent(e){var t=this.queues[e];if(Array.isArray(t))return t.shift()}}var U$=20;class C0e{constructor(e,t){var n=this;this.client=e,this.logger=t,P(this,"sending",!1),P(this,"running",!0),P(this,"retryTimeout",null),P(this,"retryAttempts",0),P(this,"sendQueue",B(function*(){if(null!==n.retryTimeout&&clearTimeout(n.retryTimeout),n.retryTimeout=null,!n.sending&&n.running){var e;n.logger.debug("Attempting to send queued to-device messages"),n.sending=!0;try{for(;n.running&&null!==(e=yield n.client.store.getOldestToDeviceBatch());)yield n.sendBatch(e),yield n.client.store.removeToDeviceBatch(e.id),n.retryAttempts=0;if(!n.running)return;n.logger.debug("All queued to-device messages sent")}catch(r){++n.retryAttempts;var t=Xg.RETRY_BACKOFF_RATELIMIT(null,n.retryAttempts,r);if(-1===t)return void(4===Math.floor(r.httpStatus/100)?(n.logger.error("Fatal error when sending to-device message - dropping to-device batch!",r),yield n.client.store.removeToDeviceBatch(e.id)):n.logger.info("Automatic retry limit reached for to-device messages."));n.logger.info("Failed to send batch of to-device messages. Will retry in ".concat(t,"ms"),r),n.retryTimeout=setTimeout(n.sendQueue,t)}finally{n.sending=!1}}})),P(this,"onResumedSync",(e,t)=>{e===Vt.Syncing&&t!==Vt.Syncing&&(this.logger.info("Resuming queue after resumed sync"),this.sendQueue())})}start(){this.running=!0,this.sendQueue(),this.client.on(Le.Sync,this.onResumedSync)}stop(){this.running=!1,null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(Le.Sync,this.onResumedSync)}queueBatch(e){var t=this;return B(function*(){for(var n=[],r=0;r<e.batch.length;r+=U$){var i={eventType:e.eventType,batch:e.batch.slice(r,r+U$),txnId:t.client.makeTxnId()};n.push(i);var o=i.batch.map(e=>"".concat(e.userId,"/").concat(e.deviceId," (msgid ").concat(e.payload[j3],")"));t.logger.info("Enqueuing batch of to-device messages. type=".concat(e.eventType," txnid=").concat(i.txnId),o)}yield t.client.store.saveToDeviceBatches(n),t.sendQueue()})()}sendBatch(e){var t=this;return B(function*(){var n=new pu(()=>new Map);for(var r of e.batch)n.getOrCreate(r.userId).set(r.deviceId,r.payload);t.logger.info("Sending batch of ".concat(e.batch.length," to-device messages with ID ").concat(e.id," and txnId ").concat(e.txnId)),yield t.client.sendToDevice(e.eventType,n,e.txnId)})()}}var bk=new Ys.UnstableValue("m.policies","org.matrix.msc3847.policies"),_2=new Ys.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites"),j$=function(e){return e.Ban="m.ban",e}({}),bg=function(e){return e.User="m.policy.user",e.Room="m.policy.room",e.Server="m.policy.server",e}({}),F$={[bg.User]:ee.PolicyRuleUser,[bg.Room]:ee.PolicyRuleRoom,[bg.Server]:ee.PolicyRuleServer};class T0e{constructor(e){this.client=e}addRule(e,t,n){var r=this;return B(function*(){var i=yield r.getOrCreateTargetRoom();return(yield r.client.sendStateEvent(i.roomId,F$[e],{entity:t,reason:n,recommendation:j$.Ban})).event_id})()}removeRule(e){var t=this;return B(function*(){yield t.client.redactEvent(e.getRoomId(),e.getId())})()}addSource(e){var t=this;return B(function*(){yield t.client.joinRoom(e);var n=(yield t.getOrCreateSourceRooms()).map(e=>e.roomId);return!n.includes(e)&&(n.push(e),yield t.withIgnoreInvitesPolicies(e=>{e.sources=n}),!0)})()}getRuleForInvite(e){var t=this;return B(function*(){var{sender:n,roomId:r}=e,i=yield t.getOrCreateSourceRooms(),o=n.split(":")[1],s=r.split(":")[1];for(var a of i){var l=a.getUnfilteredTimelineSet().getLiveTimeline().getState(Me.FORWARDS);for(var{scope:c,entities:u}of[{scope:bg.Room,entities:[r]},{scope:bg.User,entities:[n]},{scope:bg.Server,entities:[o,s]}]){var d=l.getStateEvents(F$[c]);for(var h of d){var p=h.getContent();if((null==p?void 0:p.recommendation)==j$.Ban){var f=null==p?void 0:p.entity;if(f){var m=void 0;try{m=new RegExp(RX(f))}catch{continue}for(var v of u)if(v&&m.test(v))return h}}}}}return null})()}getOrCreateTargetRoom(){var e=this;return B(function*(){var t=e.getIgnoreInvitesPolicies().target;if("string"!=typeof t&&(t=null),t){var n=e.client.getRoom(t);if(n)return n;t=null}return t=(yield e.client.createRoom({name:"Individual Policy Room",preset:q3.PrivateChat})).room_id,yield e.withIgnoreInvitesPolicies(e=>{e.target=t}),e.client.getRoom(t)})()}getOrCreateSourceRooms(){var e=this;return B(function*(){var t=e.getIgnoreInvitesPolicies().sources,n=!1;Array.isArray(t)||(n=!0,t=[]);var r=t.filter(e=>"string"==typeof e).map(t=>e.client.getRoom(t)).filter(e=>!!e);(r.length!=t.length&&(n=!0),0==r.length)&&(n=!0,r=[yield e.getOrCreateTargetRoom()]);return n&&(yield e.withIgnoreInvitesPolicies(e=>{e.sources=t})),r})()}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}withIgnoreInvitesPolicies(e){var t=this;return B(function*(){var{policies:n,ignoreInvitesPolicies:r}=t.getPoliciesAndIgnoreInvitesPolicies();e(r),n[_2.name]=r,yield t.client.setAccountData(bk.name,n)})()}getPoliciesAndIgnoreInvitesPolicies(){var e={};for(var t of[bk.name,bk.altName]){var n;if(t){var r=null===(n=this.client.getAccountData(t))||void 0===n?void 0:n.getContent();if(r){e=r;break}}}var i={},o=!1;for(var s of[_2.name,_2.altName])if(s){var a=e[s];if(a&&"object"==typeof a){i=a,o=!0;break}}return o||(e[_2.name]=i),{policies:e,ignoreInvitesPolicies:i}}}var _k="matrix-js-sdk";function R0e(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let e=0;e<t.length;e++)t[e]=255;for(let n=0;n<e.length;n++){const r=e.charAt(n),i=r.charCodeAt(0);if(255!==t[i])throw new TypeError(r+" is ambiguous");t[i]=n}const n=e.length,r=e.charAt(0),i=Math.log(n)/Math.log(256),o=Math.log(256)/Math.log(n);function s(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let o=0,s=0,a=0;for(;e[o]===r;)s++,o++;const l=(e.length-o)*i+1>>>0,c=new Uint8Array(l);for(;o<e.length;){const r=e.charCodeAt(o);if(r>255)return;let i=t[r];if(255===i)return;let s=0;for(let e=l-1;(0!==i||s<a)&&-1!==e;e--,s++)i+=n*c[e]>>>0,c[e]=i%256>>>0,i=i/256>>>0;if(0!==i)throw new Error("Non-zero carry");a=s,o++}let u=l-a;for(;u!==l&&0===c[u];)u++;const d=new Uint8Array(s+(l-u));let h=s;for(;u!==l;)d[h++]=c[u++];return d}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let i=0,s=0,a=0;const l=t.length;for(;a!==l&&0===t[a];)a++,i++;const c=(l-a)*o+1>>>0,u=new Uint8Array(c);for(;a!==l;){let e=t[a],r=0;for(let t=c-1;(0!==e||r<s)&&-1!==t;t--,r++)e+=256*u[t]>>>0,u[t]=e%n>>>0,e=e/n>>>0;if(0!==e)throw new Error("Non-zero carry");s=r,a++}let d=c-s;for(;d!==c&&0===u[d];)d++;let h=r.repeat(i);for(;d<c;++d)h+=e.charAt(u[d]);return h},decodeUnsafe:s,decode:function(e){const t=s(e);if(t)return t;throw new Error("Non-base"+n+" character")}}}var I0e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Rot=R0e(I0e);var ui=function(e){return e.UserTrustStatusChanged="userTrustStatusChanged",e.KeyBackupStatus="crypto.keyBackupStatus",e.KeyBackupFailed="crypto.keyBackupFailed",e.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",e.KeyBackupDecryptionKeyCached="crypto.keyBackupDecryptionKeyCached",e.VerificationRequestReceived="crypto.verificationRequestReceived",e.WillUpdateDevices="crypto.willUpdateDevices",e.DevicesUpdated="crypto.devicesUpdated",e.KeysChanged="crossSigning.keysChanged",e.LegacyCryptoStoreMigrationProgress="crypto.legacyCryptoStoreMigrationProgress",e.DehydratedDeviceCreated="dehydration.DehydratedDeviceCreated",e.DehydratedDeviceUploaded="dehydration.DehydratedDeviceUploaded",e.RehydrationStarted="dehydration.RehydrationStarted",e.RehydrationProgress="dehydration.RehydrationProgress",e.RehydrationCompleted="dehydration.RehydrationCompleted",e.RehydrationError="dehydration.RehydrationError",e.DehydrationKeyCached="dehydration.DehydrationKeyCached",e.DehydratedDeviceRotationError="dehydration.DehydratedDeviceRotationError",e}({}),$$=function(e){return e.MEGOLM_UNKNOWN_INBOUND_SESSION_ID="MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e.MEGOLM_KEY_WITHHELD="MEGOLM_KEY_WITHHELD",e.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE="MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE",e.OLM_UNKNOWN_MESSAGE_INDEX="OLM_UNKNOWN_MESSAGE_INDEX",e.HISTORICAL_MESSAGE_NO_KEY_BACKUP="HISTORICAL_MESSAGE_NO_KEY_BACKUP",e.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED="HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED",e.HISTORICAL_MESSAGE_WORKING_BACKUP="HISTORICAL_MESSAGE_WORKING_BACKUP",e.HISTORICAL_MESSAGE_USER_NOT_JOINED="HISTORICAL_MESSAGE_USER_NOT_JOINED",e.SENDER_IDENTITY_PREVIOUSLY_VERIFIED="SENDER_IDENTITY_PREVIOUSLY_VERIFIED",e.UNSIGNED_SENDER_DEVICE="UNSIGNED_SENDER_DEVICE",e.UNKNOWN_SENDER_DEVICE="UNKNOWN_SENDER_DEVICE",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MEGOLM_BAD_ROOM="MEGOLM_BAD_ROOM",e.MEGOLM_MISSING_FIELDS="MEGOLM_MISSING_FIELDS",e.OLM_DECRYPT_GROUP_MESSAGE_ERROR="OLM_DECRYPT_GROUP_MESSAGE_ERROR",e.OLM_BAD_ENCRYPTED_MESSAGE="OLM_BAD_ENCRYPTED_MESSAGE",e.OLM_BAD_RECIPIENT="OLM_BAD_RECIPIENT",e.OLM_BAD_RECIPIENT_KEY="OLM_BAD_RECIPIENT_KEY",e.OLM_BAD_ROOM="OLM_BAD_ROOM",e.OLM_BAD_SENDER_CHECK_FAILED="OLM_BAD_SENDER_CHECK_FAILED",e.OLM_BAD_SENDER="OLM_BAD_SENDER",e.OLM_FORWARDED_MESSAGE="OLM_FORWARDED_MESSAGE",e.OLM_MISSING_CIPHERTEXT="OLM_MISSING_CIPHERTEXT",e.OLM_NOT_INCLUDED_IN_RECIPIENTS="OLM_NOT_INCLUDED_IN_RECIPIENTS",e.UNKNOWN_ENCRYPTION_ALGORITHM="UNKNOWN_ENCRYPTION_ALGORITHM",e}({}),k0e=function(e){return e[e.AllDevicesIsolationMode=0]="AllDevicesIsolationMode",e[e.OnlySignedDevicesIsolationMode=1]="OnlySignedDevicesIsolationMode",e}({});class Iot{constructor(e){this.errorOnVerifiedUserProblems=e,P(this,"kind",k0e.AllDevicesIsolationMode)}}class kot{constructor(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.crossSigningVerified=e,this.crossSigningVerifiedBefore=t,this.tofu=n,P(this,"needsUserApproval",void 0),this.needsUserApproval=r}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}class xot{constructor(e){var t,n,r,i,o;P(this,"signedByOwner",void 0),P(this,"crossSigningVerified",void 0),P(this,"tofu",void 0),P(this,"localVerified",void 0),P(this,"trustCrossSignedDevices",void 0),this.signedByOwner=null!==(t=e.signedByOwner)&&void 0!==t&&t,this.crossSigningVerified=null!==(n=e.crossSigningVerified)&&void 0!==n&&n,this.tofu=null!==(r=e.tofu)&&void 0!==r&&r,this.localVerified=null!==(i=e.localVerified)&&void 0!==i&&i,this.trustCrossSignedDevices=null!==(o=e.trustCrossSignedDevices)&&void 0!==o&&o}isVerified(){return this.localVerified||this.trustCrossSignedDevices&&this.crossSigningVerified}}var Aot=function(e){return e.Fetch="fetch",e.LoadKeys="load_keys",e}({}),Lot=function(e){return e.Master="master",e.SelfSigning="self_signing",e.UserSigning="user_signing",e}({}),Pot=function(e){return e[e.NONE=0]="NONE",e[e.GREY=1]="GREY",e[e.RED=2]="RED",e}({}),Oot=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.UNVERIFIED_IDENTITY=1]="UNVERIFIED_IDENTITY",e[e.UNSIGNED_DEVICE=2]="UNSIGNED_DEVICE",e[e.UNKNOWN_DEVICE=3]="UNKNOWN_DEVICE",e[e.AUTHENTICITY_NOT_GUARANTEED=4]="AUTHENTICITY_NOT_GUARANTEED",e[e.MISMATCHED_SENDER_KEY=5]="MISMATCHED_SENDER_KEY",e[e.SENT_IN_CLEAR=6]="SENT_IN_CLEAR",e[e.VERIFICATION_VIOLATION=7]="VERIFICATION_VIOLATION",e[e.MISMATCHED_SENDER=8]="MISMATCHED_SENDER",e}({}),x0e=new Uint8Array(8);function OJ(e,t){return nA.apply(this,arguments)}function nA(){return(nA=B(function*(e,t){var n=yield globalThis.crypto.subtle.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),r=yield globalThis.crypto.subtle.deriveBits({name:"HKDF",salt:x0e,info:(new TextEncoder).encode(t),hash:"SHA-256"},n,512),i=r.slice(0,32),o=r.slice(32),s=globalThis.crypto.subtle.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),a=globalThis.crypto.subtle.importKey("raw",o,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([s,a])})).apply(this,arguments)}function MJ(e,t,n,r){return rA.apply(this,arguments)}function rA(){return(rA=B(function*(e,t,n,r){var i;r?i=Nh(r):(i=new Uint8Array(16),globalThis.crypto.getRandomValues(i),i[8]&=127);var[o,s]=yield OJ(t,n),a=(new TextEncoder).encode(e),l=yield globalThis.crypto.subtle.encrypt({name:"AES-CTR",counter:i,length:64},o,a),c=yield globalThis.crypto.subtle.sign({name:"HMAC"},s,l);return{iv:yy(i),ciphertext:yy(new Uint8Array(l)),mac:yy(new Uint8Array(c))}})).apply(this,arguments)}function A0e(e,t,n){return iA.apply(this,arguments)}function iA(){return(iA=B(function*(e,t,n){var[r,i]=yield OJ(t,n),o=Nh(e.ciphertext);if(!(yield globalThis.crypto.subtle.verify({name:"HMAC"},i,Nh(e.mac),o)))throw new Error("Error decrypting secret ".concat(n,": bad MAC"));var s=yield globalThis.crypto.subtle.decrypt({name:"AES-CTR",counter:Nh(e.iv),length:64},r,o);return(new TextDecoder).decode(new Uint8Array(s))})).apply(this,arguments)}var wh="m.secret_storage.v1.aes-hmac-sha2";class DJ{constructor(e,t){this.accountDataAdapter=e,this.callbacks=t}getDefaultKeyId(){var e=this;return B(function*(){var t,n=yield e.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return n&&null!==(t=n.key)&&void 0!==t?t:null})()}setDefaultKeyId(e){return new Promise((t,n)=>{var r=n=>{if("m.secret_storage.default_key"===n.getType()){var i=n.getContent();(null===e?0===Object.keys(i).length:i.key===e)&&(this.accountDataAdapter.removeListener(Le.AccountData,r),t())}};this.accountDataAdapter.on(Le.AccountData,r);var i=null===e?{}:{key:e};this.accountDataAdapter.setAccountData("m.secret_storage.default_key",i).catch(e=>{this.accountDataAdapter.removeListener(Le.AccountData,r),n(e)})})}addKey(e,t,n){var r=this;return B(function*(){if(e!==wh)throw new Error("Unknown key algorithm ".concat(e));var i={algorithm:e};t.name&&(i.name=t.name),t.passphrase&&(i.passphrase=t.passphrase);var{iv:o,mac:s}=yield oA(t.key);if(i.iv=o,i.mac=s,!n)do{n=Eo(32)}while(yield r.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(n)));return yield r.accountDataAdapter.setAccountData("m.secret_storage.key.".concat(n),i),{keyId:n,keyInfo:i}})()}getKey(e){var t=this;return B(function*(){if(e||(e=yield t.getDefaultKeyId()),!e)return null;var n=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(e));return n?[e,n]:null})()}hasKey(e){var t=this;return B(function*(){return!!(yield t.getKey(e))})()}checkKey(e,t){return B(function*(){if(t.algorithm===wh){if(t.mac){var{mac:n}=yield oA(e,t.iv);return sA(t.mac)===sA(n)}return!0}throw new Error("Unknown algorithm")})()}store(e,t,n){var r=this;return B(function*(){if(null!==t){var i={};if(!n){var o=yield r.getDefaultKeyId();if(!o)throw new Error("No keys specified and no default key present");n=[o]}if(0===n.length)throw new Error("Zero keys given to encrypt with!");for(var s of n){var a=yield r.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s));if(!a)throw new Error("Unknown key: "+s);if(a.algorithm===wh){var l={[s]:a},[,c]=yield r.getSecretStorageKey(l,e);i[s]=yield c.encrypt(t)}else M.warn("unknown algorithm for secret storage key "+s+": "+a.algorithm)}yield r.accountDataAdapter.setAccountData(e,{encrypted:i})}else yield r.accountDataAdapter.setAccountData(e,{})})()}get(e){var t=this;return B(function*(){var n=yield t.accountDataAdapter.getAccountDataFromServer(e);if(n){if(!n.encrypted)throw new Error("Content is not encrypted!");var r={};for(var i of Object.keys(n.encrypted)){var o=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(i)),s=n.encrypted[i];(null==o?void 0:o.algorithm)===wh&&s.iv&&s.ciphertext&&s.mac&&(r[i]=o)}if(0===Object.keys(r).length)throw new Error("Could not decrypt ".concat(e," because none of ")+"the keys it is encrypted with are for a supported algorithm");var[a,l]=yield t.getSecretStorageKey(r,e),c=n.encrypted[a];return l.decrypt(c)}})()}isStored(e){var t=this;return B(function*(){var n=yield t.accountDataAdapter.getAccountDataFromServer(e);if(null==n||!n.encrypted)return null;var r={};for(var i of Object.keys(n.encrypted)){var o=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(i));if(o){var s=n.encrypted[i];o.algorithm===wh&&s.iv&&s.ciphertext&&s.mac&&(r[i]=o)}}return Object.keys(r).length?r:null})()}getSecretStorageKey(e,t){var n=this;return B(function*(){if(!n.callbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");var r=yield n.callbacks.getSecretStorageKey({keys:e},t);if(!r)throw new Error("getSecretStorageKey callback returned falsey");if(r.length<2)throw new Error("getSecretStorageKey callback returned invalid data");var[i,o]=r;if(!e[i])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[i].algorithm===wh)return[i,{encrypt:function(e){return MJ(e,o,t)},decrypt:function(e){return A0e(e,o,t)}}];throw new Error("Unknown key type: "+e[i].algorithm)})()}}function sA(e){for(var t=e.length;t>=1&&61==e.charCodeAt(t-1);)t--;return t<e.length?e.substring(0,t):e}var L0e="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";function oA(e,t){return MJ(L0e,e,"",t)}const P0e=Object.freeze(Object.defineProperty({__proto__:null,SECRET_STORAGE_ALGORITHM_V1_AES:wh,ServerSideSecretStorageImpl:DJ,calculateKeyCheck:oA,trimTrailingEquals:sA},Symbol.toStringTag,{value:"Module"}));var NJ=e=>"livekit"===e.type&&"livekit_service_url"in e,UJ=e=>NJ(e)&&"livekit_alias"in e,jJ=e=>"livekit"===e.type&&"focus_selection"in e,FJ=144e5,O0e=(e,t)=>{var n,r="Malformed session membership event: ";return"string"!=typeof e.device_id&&t.push(r+"device_id must be string"),"string"!=typeof e.call_id&&t.push(r+"call_id must be string"),"string"!=typeof e.application&&t.push(r+"application must be a string"),"string"!=typeof(null===(n=e.focus_active)||void 0===n?void 0:n.type)&&t.push(r+"focus_active.type must be a string"),Array.isArray(e.foci_preferred)||t.push(r+"foci_preferred must be an array"),e.created_ts&&"number"!=typeof e.created_ts&&t.push(r+"created_ts must be number"),e.scope&&"string"!=typeof e.scope&&t.push(r+"scope must be string"),0===t.length};class B${static equal(e,t){return df(e.membershipData,t.membershipData)}constructor(e,t){this.parentEvent=e,P(this,"membershipData",void 0);var n=[];if(!O0e(t,n))throw Error("unknown CallMembership data. Does not match MSC4143 call.member (".concat(n.join(" & "),") events this could be a legacy membership event: (").concat(t,")"));this.membershipData=t}get sender(){return this.parentEvent.getSender()}get eventId(){return this.parentEvent.getId()}get callId(){return this.membershipData.call_id}get deviceId(){return this.membershipData.device_id}get sessionDescription(){return{application:this.membershipData.application,id:this.membershipData.call_id}}get application(){return this.membershipData.application}get scope(){return this.membershipData.scope}get membershipID(){return this.createdTs().toString()}createdTs(){var e;return null!==(e=this.membershipData.created_ts)&&void 0!==e?e:this.parentEvent.getTs()}getAbsoluteExpiry(){var e;return this.createdTs()+(null!==(e=this.membershipData.expires)&&void 0!==e?e:FJ)}getMsUntilExpiry(){return this.getAbsoluteExpiry()-Date.now()}isExpired(){return this.getMsUntilExpiry()<=0}getPreferredFoci(){return this.membershipData.foci_preferred}getFocusSelection(){var e=this.membershipData.focus_active;if(jJ(e))return e.focus_selection}}var UE=function(e){return e.Cancel="cancel",e.Restart="restart",e.Send="send",e}({}),GP=function(e){return e.TooNew="TOO_NEW",e}({});class KP extends Error{constructor(e){super("Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again"),this.reason=e,this.name="InvalidCryptoStoreError"}}P(KP,"TOO_NEW",GP.TooNew);class M0e extends Error{constructor(e,t){super(e),this.value=t}}class D0e extends Error{constructor(){super("MatrixClient has been stopped")}}class qd extends Error{constructor(e,t){super(e),this.clientEndpoint=t,this.name="UnsupportedDelayedEventsEndpointError"}}var kd=function(e){return e.Disconnected="Disconnected",e.Connecting="Connecting",e.ConnectingFailed="ConnectingFailed",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Stuck="Stuck",e.Unknown="Unknown",e}({}),jE=(e,t,n)=>e.sender===t&&e.deviceId===n;class N0e{constructor(e,t){this.membershipLoopHandler=e,P(this,"logger",void 0),P(this,"running",!1),P(this,"wakeup",e=>{this.logger.error("Cannot call wakeup before calling `startWithJoin()`")}),P(this,"_actions",[]),this.logger=(t??M).getChild("[NewMembershipActionScheduler]")}get actions(){return this._actions}startWithJoin(){var e=this;return B(function*(){if(e.running)e.logger.error("Cannot call startWithJoin() on NewMembershipActionScheduler while already running");else{e.running=!0,e._actions=[{ts:Date.now(),type:ut.SendDelayedEvent}];try{for(var t=function*(){e._actions.sort((e,t)=>e.ts-t.ts);var t=e._actions[0],n=void 0,r=new Promise(t=>{e.wakeup=e=>{n=e,t()}});t.ts>Date.now()&&(yield Promise.race([r,mp(t.ts-Date.now())]));var i={};if(!n){e.logger.debug("Current MembershipManager processing: ".concat(t.type,"\nQueue:"),e._actions,'\nDate.now: "'.concat(Date.now()));try{i=yield e.membershipLoopHandler(t.type)}catch(e){throw Error("The MembershipManager shut down because of the end condition: ".concat(e))}}e._actions.splice(0,1);var o=n??i;"replace"in o?e._actions=o.replace:"insert"in o&&e._actions.push(...o.insert)};e._actions.length>0;)yield*t()}finally{e.running=!1}e.logger.debug("Leave MembershipManager ActionScheduler loop (no more actions)")}})()}initiateJoin(){var e;null===(e=this.wakeup)||void 0===e||e.call(this,{replace:[{ts:Date.now(),type:ut.SendDelayedEvent}]})}initiateLeave(){var e;null===(e=this.wakeup)||void 0===e||e.call(this,{replace:[{ts:Date.now(),type:ut.SendScheduledDelayedLeaveEvent}]})}}var Uh=function(e){return e.StatusChanged="StatusChanged",e.ProbablyLeft="ProbablyLeft",e}({}),ut=function(e){return e.SendDelayedEvent="SendDelayedEvent",e.SendJoinEvent="SendJoinEvent",e.RestartDelayedEvent="RestartDelayedEvent",e.UpdateExpiry="UpdateExpiry",e.SendScheduledDelayedLeaveEvent="SendScheduledDelayedLeaveEvent",e.SendLeaveEvent="SendLeaveEvent",e}({});class tC extends Pn{isActivated(){return this.activated}isJoined(){return this.isActivated()}join(e,t,n){this.scheduler.running?this.logger.error("MembershipManager is already running. Ignoring join request."):(this.fociPreferred=e,this.focusActive=t,this.leavePromiseResolvers=void 0,this.activated=!0,this.oldStatus=this.status,this.state=tC.defaultState,this.scheduler.startWithJoin().catch(e=>{this.logger.error("MembershipManager stopped because: ",e),null==n||n(e)}).finally(()=>{var e;(this.activated=!1,this.oldStatus&&this.oldStatus!==this.status&&this.emit(Uh.StatusChanged,this.oldStatus,this.status),this.scheduler.running)||(null===(e=this.leavePromiseResolvers)||void 0===e||e.resolve(!0),this.leavePromiseResolvers=void 0)}))}leave(e){return this.scheduler.running?(this.leavePromiseResolvers||(this.leavePromiseResolvers=Promise.withResolvers(),this.activated=!1,this.scheduler.initiateLeave(),e&&setTimeout(()=>{var e;return null===(e=this.leavePromiseResolvers)||void 0===e?void 0:e.resolve(!1)},e)),this.leavePromiseResolvers.promise):(this.logger.warn("Called MembershipManager.leave() even though the MembershipManager is not running"),Promise.resolve(!0))}onRTCSessionMemberUpdate(e){var t=this;return B(function*(){var n=t.client.getUserId(),r=t.client.getDeviceId();if(!n||!r)return t.logger.error("MembershipManager.onRTCSessionMemberUpdate called without user or device id"),Promise.resolve();if(t._ownMembership=e.find(e=>jE(e,n,r)),t.isActivated()&&!t._ownMembership){var i=[ut.SendDelayedEvent,ut.SendJoinEvent];t.logger.warn("Missing own membership: force re-join"),t.state.hasMemberStateEvent=!1,t.scheduler.actions.some(e=>i.includes(e.type))?t.logger.error("tried adding another `SendDelayedEvent` actions even though we already have one in the Queue\nActionQueueOnMemberUpdate:",t.scheduler.actions):t.scheduler.initiateJoin()}return Promise.resolve()})()}getActiveFocus(){if(!this.focusActive){var e=this.getOldestMembership();return null==e?void 0:e.getPreferredFoci()[0]}if(jJ(this.focusActive)){if("oldest_membership"===this.focusActive.focus_selection){var t=this.getOldestMembership();return null==t?void 0:t.getPreferredFoci()[0]}}else this.logger.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.")}constructor(e,t,n,r,i,o){super(),this.joinConfig=e,this.room=t,this.client=n,this.getOldestMembership=r,this.sessionDescription=i,P(this,"activated",!1),P(this,"logger",void 0),P(this,"leavePromiseResolvers",void 0),P(this,"_ownMembership",void 0),P(this,"oldStatus",void 0),P(this,"scheduler",void 0),P(this,"state",void 0),P(this,"deviceId",void 0),P(this,"stateKey",void 0),P(this,"fociPreferred",void 0),P(this,"focusActive",void 0),P(this,"delayedLeaveEventDelayMsOverride",void 0),this.logger=(o??M).getChild("[MembershipManager]");var[s,a]=[this.client.getUserId(),this.client.getDeviceId()];if(null===s)throw Error("Missing userId in client");if(null===a)throw Error("Missing deviceId in client");this.deviceId=a,this.stateKey=this.makeMembershipStateKey(s,a),this.state=tC.defaultState,this.scheduler=new N0e(e=>(this.oldStatus&&(this.logger.debug("MembershipManager applied action changes. Status: ".concat(this.oldStatus," -> ").concat(this.status)),this.oldStatus!==this.status&&this.emit(Uh.StatusChanged,this.oldStatus,this.status)),this.oldStatus=this.status,this.logger.debug("MembershipManager before processing action. status=".concat(this.oldStatus)),this.membershipLoopHandler(e)),this.logger)}get ownMembership(){return this._ownMembership}static get defaultState(){return{hasMemberStateEvent:!1,delayId:void 0,startTime:0,rateLimitRetries:new Map,networkErrorRetries:new Map,expireUpdateIterations:1,probablyLeft:!1}}get networkErrorRetryMs(){var e,t,n,r;return null!==(e=null!==(t=null===(n=this.joinConfig)||void 0===n?void 0:n.networkErrorRetryMs)&&void 0!==t?t:null===(r=this.joinConfig)||void 0===r?void 0:r.callMemberEventRetryDelayMinimum)&&void 0!==e?e:3e3}get membershipEventExpiryMs(){var e,t,n,r;return null!==(e=null!==(t=null===(n=this.joinConfig)||void 0===n?void 0:n.membershipEventExpiryMs)&&void 0!==t?t:null===(r=this.joinConfig)||void 0===r?void 0:r.membershipExpiryTimeout)&&void 0!==e?e:FJ}get membershipEventExpiryHeadroomMs(){var e,t,n,r;return null!==(e=null!==(t=null===(n=this.joinConfig)||void 0===n?void 0:n.membershipEventExpiryHeadroomMs)&&void 0!==t?t:null===(r=this.joinConfig)||void 0===r?void 0:r.membershipExpiryTimeoutHeadroom)&&void 0!==e?e:5e3}computeNextExpiryActionTs(e){return this.state.startTime+this.membershipEventExpiryMs*e-this.membershipEventExpiryHeadroomMs}get delayedLeaveEventDelayMs(){var e,t,n,r,i;return null!==(e=null!==(t=null!==(n=this.delayedLeaveEventDelayMsOverride)&&void 0!==n?n:null===(r=this.joinConfig)||void 0===r?void 0:r.delayedLeaveEventDelayMs)&&void 0!==t?t:null===(i=this.joinConfig)||void 0===i?void 0:i.membershipServerSideExpiryTimeout)&&void 0!==e?e:8e3}get delayedLeaveEventRestartMs(){var e,t,n,r;return null!==(e=null!==(t=null===(n=this.joinConfig)||void 0===n?void 0:n.delayedLeaveEventRestartMs)&&void 0!==t?t:null===(r=this.joinConfig)||void 0===r?void 0:r.membershipKeepAlivePeriod)&&void 0!==e?e:5e3}get maximumRateLimitRetryCount(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.maximumRateLimitRetryCount)&&void 0!==e?e:10}get maximumNetworkErrorRetryCount(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.maximumNetworkErrorRetryCount)&&void 0!==e?e:10}get delayedLeaveEventRestartLocalTimeoutMs(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.delayedLeaveEventRestartLocalTimeoutMs)&&void 0!==e?e:2e3}membershipLoopHandler(e){var t=this;return B(function*(){switch(e){case ut.SendDelayedEvent:return t.state.delayId?t.cancelKnownDelayIdBeforeSendDelayedEvent(t.state.delayId):t.sendOrResendDelayedLeaveEvent();case ut.RestartDelayedEvent:return t.state.delayId?t.restartDelayedEvent(t.state.delayId):Go(ut.SendDelayedEvent);case ut.SendScheduledDelayedLeaveEvent:return t.state.hasMemberStateEvent?t.state.delayId?t.sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(t.state.delayId):Go(ut.SendLeaveEvent):{replace:[]};case ut.SendJoinEvent:return t.sendJoinEvent();case ut.UpdateExpiry:return t.updateExpiryOnJoinedEvent();case ut.SendLeaveEvent:return t.state.hasMemberStateEvent?t.sendFallbackLeaveEvent():{replace:[]}}})()}sendOrResendDelayedLeaveEvent(){var e=this;return B(function*(){return yield e.client._unstable_sendDelayedStateEvent(e.room.roomId,{delay:e.delayedLeaveEventDelayMs},ee.GroupCallMemberPrefix,{},e.stateKey).then(t=>(e.state.expectedServerDelayLeaveTs=Date.now()+e.delayedLeaveEventDelayMs,e.setAndEmitProbablyLeft(!1),e.resetRateLimitCounter(ut.SendDelayedEvent),e.state.delayId=t.delay_id,e.state.hasMemberStateEvent?Go(ut.RestartDelayedEvent,e.delayedLeaveEventRestartMs):Go(ut.SendJoinEvent))).catch(t=>{var n=ut.SendDelayedEvent;if(e.manageMaxDelayExceededSituation(t))return Go(n);var r=e.actionUpdateFromErrors(t,n,"sendDelayedStateEvent");if(r)return r;if(e.state.hasMemberStateEvent){if(e.isUnsupportedDelayedEndpoint(t))return{};throw Error("Could not send delayed event, even though delayed events are supported. "+t)}return e.isUnsupportedDelayedEndpoint(t)?e.logger.info("Not using delayed event because the endpoint is not supported"):e.logger.info("Not using delayed event because: "+t),Go(ut.SendJoinEvent)})})()}cancelKnownDelayIdBeforeSendDelayedEvent(e){var t=this;return B(function*(){return yield t.client._unstable_updateDelayedEvent(e,UE.Cancel).then(()=>(t.state.delayId=void 0,t.resetRateLimitCounter(ut.SendDelayedEvent),Sk(ut.SendDelayedEvent))).catch(e=>{var n=ut.SendDelayedEvent,r=t.actionUpdateFromErrors(e,n,"updateDelayedEvent");if(r)return r;if(t.isNotFoundError(e))return t.state.delayId=void 0,Sk(n);if(t.isUnsupportedDelayedEndpoint(e))return Sk(ut.SendJoinEvent);throw Error("We failed to cancel a delayed event where we already had a delay id with an error we cannot automatically handle")})})()}setAndEmitProbablyLeft(e){this.state.probablyLeft!==e&&(this.state.probablyLeft=e,this.emit(Uh.ProbablyLeft,this.state.probablyLeft))}restartDelayedEvent(e){var t=this;return B(function*(){var n=t.state.expectedServerDelayLeaveTs?t.state.expectedServerDelayLeaveTs-Date.now():void 0,r=new Promise((e,r)=>{setTimeout(()=>{r(new EX.AbortError("Restart delayed event timed out before the HS responded"))},void 0===n||t.state.probablyLeft?t.delayedLeaveEventRestartLocalTimeoutMs:Math.min(t.delayedLeaveEventRestartLocalTimeoutMs,n))});return yield Promise.race([t.client._unstable_updateDelayedEvent(e,UE.Restart),r]).then(()=>(t.state.expectedServerDelayLeaveTs=Date.now()+t.delayedLeaveEventDelayMs,t.resetRateLimitCounter(ut.RestartDelayedEvent),t.setAndEmitProbablyLeft(!1),Go(ut.RestartDelayedEvent,t.delayedLeaveEventRestartMs))).catch(e=>{t.state.expectedServerDelayLeaveTs&&t.state.expectedServerDelayLeaveTs<=Date.now()&&t.setAndEmitProbablyLeft(!0);var n=ut.RestartDelayedEvent;if(t.isNotFoundError(e))return t.state.delayId=void 0,Go(ut.SendDelayedEvent);if(t.isUnsupportedDelayedEndpoint(e))return{};var r=t.actionUpdateFromErrors(e,n,"updateDelayedEvent");if(r)return r;throw Error("Could not restart delayed event, even though delayed events are supported. "+e)})})()}sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(e){var t=this;return B(function*(){return yield t.client._unstable_updateDelayedEvent(e,UE.Send).then(()=>(t.state.hasMemberStateEvent=!1,t.resetRateLimitCounter(ut.SendScheduledDelayedLeaveEvent),{replace:[]})).catch(e=>{var n=ut.SendLeaveEvent;return t.isUnsupportedDelayedEndpoint(e)?{}:t.isNotFoundError(e)?(t.state.delayId=void 0,Go(n)):t.actionUpdateFromErrors(e,n,"updateDelayedEvent")||(t.logger.warn("Encountered unexpected error during SendScheduledDelayedLeaveEvent. Falling back to SendLeaveEvent",e),Go(n))})})()}sendJoinEvent(){var e=this;return B(function*(){return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,e.makeMyMembership(e.membershipEventExpiryMs),e.stateKey).then(()=>(e.setAndEmitProbablyLeft(!1),e.state.startTime=Date.now(),e.state.expireUpdateIterations=1,e.state.hasMemberStateEvent=!0,e.resetRateLimitCounter(ut.SendJoinEvent),{replace:[...e.scheduler.actions.filter(e=>e.type!==ut.UpdateExpiry&&e.type!==ut.SendJoinEvent),{ts:Date.now(),type:ut.RestartDelayedEvent},{ts:e.computeNextExpiryActionTs(e.state.expireUpdateIterations),type:ut.UpdateExpiry}]})).catch(t=>{var n=e.actionUpdateFromErrors(t,ut.SendJoinEvent,"sendStateEvent");if(n)return n;throw t})})()}updateExpiryOnJoinedEvent(){var e=this;return B(function*(){var t=e.state.expireUpdateIterations+1;return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,e.makeMyMembership(e.membershipEventExpiryMs*t),e.stateKey).then(()=>(e.resetRateLimitCounter(ut.UpdateExpiry),e.state.expireUpdateIterations=t,{insert:[{ts:e.computeNextExpiryActionTs(t),type:ut.UpdateExpiry}]})).catch(t=>{var n=e.actionUpdateFromErrors(t,ut.UpdateExpiry,"sendStateEvent");if(n)return n;throw t})})()}sendFallbackLeaveEvent(){var e=this;return B(function*(){return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,{},e.stateKey).then(()=>(e.resetRateLimitCounter(ut.SendLeaveEvent),e.state.hasMemberStateEvent=!1,{replace:[]})).catch(t=>{var n=e.actionUpdateFromErrors(t,ut.SendLeaveEvent,"sendStateEvent");if(n)return n;throw t})})()}makeMembershipStateKey(e,t){var n="".concat(e,"_").concat(t,"_").concat(this.sessionDescription.application).concat(this.sessionDescription.id);return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?n:"_".concat(n)}makeMyMembership(e){var t;return{application:this.sessionDescription.application,call_id:this.sessionDescription.id,scope:"m.room",device_id:this.deviceId,expires:e,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:null!==(t=this.fociPreferred)&&void 0!==t?t:[]}}isNotFoundError(e){return e instanceof nr&&"M_NOT_FOUND"===e.errcode}manageMaxDelayExceededSituation(e){if(e instanceof nr&&"M_UNKNOWN"===e.errcode&&"M_MAX_DELAY_EXCEEDED"===e.data["org.matrix.msc4140.errcode"]){var t=e.data["org.matrix.msc4140.max_delay"];return"number"==typeof t&&this.delayedLeaveEventDelayMs>t&&(this.delayedLeaveEventDelayMsOverride=t),this.logger.warn("Retry sending delayed disconnection event due to server timeout limitations:",e),!0}return!1}actionUpdateFromErrors(e,t,n){var r=this.actionUpdateFromRateLimitError(e,n,t);if(r)return r;var i=this.actionUpdateFromNetworkErrorRetry(e,t);return i||void 0}actionUpdateFromRateLimitError(e,t,n){var r;if((e instanceof Xh||e instanceof nr)&&e.isRateLimitError()){var i=null!==(r=this.state.rateLimitRetries.get(n))&&void 0!==r?r:0;if(i<this.maximumRateLimitRetryCount){var o,s=5e3;try{var a;o=null!==(a=e.getRetryAfterMs())&&void 0!==a?a:s,this.logger.info("Rate limited by server, retrying in ".concat(o,"ms"))}catch(e){this.logger.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of ".concat(s),e),o=s}return this.state.rateLimitRetries.set(n,i+1),Go(n,o)}throw Error("Exceeded maximum retries for "+n+" attempts (client."+t+"): "+e)}}actionUpdateFromNetworkErrorRetry(e,t){var n,r=null!==(n=this.state.networkErrorRetries.get(t))&&void 0!==n?n:0,i=this.networkErrorRetryMs/1e3+"s",o="("+r+"/"+this.maximumNetworkErrorRetryCount+")",s=this.networkErrorRetryMs;if(e instanceof Error&&"AbortError"===e.name)s=0,this.logger.warn("Network local timeout error while sending event, immediate retry ("+o+")",e);else if(e instanceof Error&&e.message.includes("updating delayed event"))this.logger.warn("delayed event update timeout error, retrying in "+i+" "+o,e);else if(e instanceof yp)this.logger.warn("Network connection error while sending event, retrying in "+i+" "+o,e);else{if(!((e instanceof Xh||e instanceof nr)&&"number"==typeof e.httpStatus&&e.httpStatus>=500&&e.httpStatus<600))return;this.logger.warn("Server error while sending event, retrying in "+i+" "+o,e)}if(r<this.maximumNetworkErrorRetryCount)return this.state.networkErrorRetries.set(t,r+1),Go(t,s);throw Error("Reached maximum ("+this.maximumNetworkErrorRetryCount+") retries cause by: "+e)}isUnsupportedDelayedEndpoint(e){return e instanceof qd}resetRateLimitCounter(e){this.state.rateLimitRetries.set(e,0),this.state.networkErrorRetries.set(e,0)}get status(){var e=this.scheduler.actions;if(1===e.length){var{type:t}=e[0];switch(t){case ut.SendDelayedEvent:case ut.SendJoinEvent:return kd.Connecting;case ut.UpdateExpiry:return kd.Connected;case ut.SendScheduledDelayedLeaveEvent:case ut.SendLeaveEvent:return kd.Disconnecting}}else if(2===e.length){var n=e.map(e=>e.type);if((n.includes(ut.RestartDelayedEvent)||n.includes(ut.SendDelayedEvent)&&this.state.hasMemberStateEvent)&&n.includes(ut.UpdateExpiry))return kd.Connected}else if(3===e.length){var r=e.map(e=>e.type);if(2===r.filter(e=>e===ut.RestartDelayedEvent).length&&r.includes(ut.UpdateExpiry))return kd.Connected}return this.scheduler.running?(this.logger.error("MembershipManager has an unknown state. Actions: ",e),kd.Unknown):kd.Disconnected}get probablyLeft(){return this.state.probablyLeft}}function Go(e,t){return{insert:[{ts:Date.now()+(t??0),type:e}]}}function Sk(e,t){return{replace:[{ts:Date.now()+0,type:e}]}}var Kc=function(e){return e.ReceivedKeys="received_keys",e.NotSupportedError="not_supported_error",e}({});class U0e{constructor(){P(this,"tsBuffer",new Map)}isOutdated(e,t){var n;this.tsBuffer.has(e)||this.tsBuffer.set(e,new Map);var r=null===(n=this.tsBuffer.get(e))||void 0===n?void 0:n.get(t.keyIndex);return!!(r&&r>t.creationTS)||(this.tsBuffer.get(e).set(t.keyIndex,t.creationTS),!1)}}function jh(e,t){return"".concat(e,":").concat(t)}class $J extends Error{constructor(e){super(e)}get name(){return"NotSupportedError"}}class j0e extends Pn{setParentLogger(e){this.logger=e.getChild("[ToDeviceKeyTransport]")}constructor(e,t,n,r,i,o){super(),this.userId=e,this.deviceId=t,this.roomId=n,this.client=r,this.statistics=i,P(this,"logger",M),P(this,"onToDeviceEvent",e=>{if(e.getType()===ee.CallEncryptionKeysPrefix){var t=this.getValidEventContent(e);t&&e.getSender()&&this.receiveCallKeyEvent(e.getSender(),t)}}),this.setParentLogger(o??M)}start(){this.client.on(Le.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.off(Le.ToDeviceEvent,this.onToDeviceEvent)}sendKey(e,t,n){var r=this;return B(function*(){var i={keys:{index:t,key:e},room_id:r.roomId,member:{claimed_device_id:r.deviceId},session:{call_id:"",application:"m.call",scope:"m.room"},sent_ts:Date.now()},o=n.map(e=>({userId:e.userId,deviceId:e.deviceId})).filter(e=>!(e.userId==r.userId&&e.deviceId==r.deviceId));o.length>0?(yield r.client.encryptAndSendToDevice(ee.CallEncryptionKeysPrefix,o,i).catch(e=>{var t=e.message;if(t.includes("unknown variant")&&t.includes("send_to_device")||t.includes("not supported"))throw new $J("The widget driver does not support to-device encryption")}),r.statistics.counters.roomEventEncryptionKeysSent+=1):r.logger.warn("No targets found for sending key")})()}receiveCallKeyEvent(e,t){this.statistics.counters.roomEventEncryptionKeysReceived+=1;var n=Date.now(),r=n-("number"==typeof t.sent_ts?t.sent_ts:n);this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=r,this.emit(Kc.ReceivedKeys,e,t.member.claimed_device_id,t.keys.key,t.keys.index,n)}getValidEventContent(e){var t=e.getContent(),n=t.room_id;if(n)if(n===this.roomId)if(t.keys&&t.keys.key&&"number"==typeof t.keys.index){if(t.member&&t.member.claimed_device_id)return t;this.logger.warn("Malformed Event: Missing claimed_device_id")}else this.logger.warn("Malformed Event: Missing keys field");else this.logger.warn("Malformed Event: Mismatch roomId");else this.logger.warn("Malformed Event: invalid call encryption keys event, no roomId")}}var a_=function(e){return e.EnabledTransportsChanged="enabled_transports_changed",e}({});class zP extends Pn{constructor(e,t,n){var r;super(),r=this,this.toDeviceTransport=e,this.roomKeyTransport=t,P(this,"logger",void 0),P(this,"_enabled",{toDevice:!0,room:!1}),this.logger=(n??M).getChild("[RoomAndToDeviceTransport]"),this.toDeviceTransport.setParentLogger(this.logger),this.roomKeyTransport.setParentLogger(this.logger),this.roomKeyTransport.on(Kc.ReceivedKeys,function(){r._enabled.room||(r.logger.debug("Received room key, enabling room key transport, disabling toDevice transport"),r.setEnabled({toDevice:!1,room:!0}));for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.emit(Kc.ReceivedKeys,...t)}),this.toDeviceTransport.on(Kc.ReceivedKeys,function(){if(r._enabled.toDevice){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.emit(Kc.ReceivedKeys,...t)}else r.logger.debug("To Device transport is disabled, ignoring received keys")})}setEnabled(e){(this.enabled.toDevice!==e.toDevice||this.enabled.room!==e.room)&&(this._enabled=e,this.emit(a_.EnabledTransportsChanged,e))}get enabled(){return this._enabled}start(){this.roomKeyTransport.start(),this.toDeviceTransport.start()}stop(){this.roomKeyTransport.stop(),this.toDeviceTransport.stop()}sendKey(e,t,n){var r=this;return B(function*(){if(r.logger.debug("Sending key with index ".concat(t," to call members (count=").concat(n.length,") via:")+(r._enabled.room?"room transport":"")+(r._enabled.room&&r._enabled.toDevice?"and":"")+(r._enabled.toDevice?"to device transport":"")),r._enabled.room&&(yield r.roomKeyTransport.sendKey(e,t,n)),r._enabled.toDevice)try{yield r.toDeviceTransport.sendKey(e,t,n)}catch(i){i instanceof $J&&!r._enabled.room&&(r.logger.warn("To device is not supported enabling room key transport, disabling toDevice transport"),r.setEnabled({toDevice:!1,room:!0}),yield r.sendKey(e,t,n))}})()}}class F0e{get updateEncryptionKeyThrottle(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.updateEncryptionKeyThrottle)&&void 0!==e?e:3e3}get makeKeyDelay(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.makeKeyDelay)&&void 0!==e?e:3e3}get useKeyDelay(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.useKeyDelay)&&void 0!==e?e:5e3}constructor(e,t,n,r,i,o,s){var a,l=this;this.userId=e,this.deviceId=t,this.getMemberships=n,this.transport=r,this.statistics=i,this.onEncryptionKeysChanged=o,P(this,"manageMediaKeys",!1),P(this,"keysEventUpdateTimeout",void 0),P(this,"makeNewKeyTimeout",void 0),P(this,"setNewKeyTimeouts",new Set),P(this,"encryptionKeys",new Map),P(this,"lastEncryptionKeyUpdateRequest",void 0),P(this,"lastMembershipFingerprints",void 0),P(this,"latestGeneratedKeyIndex",-1),P(this,"joinConfig",void 0),P(this,"logger",void 0),P(this,"joined",!1),P(this,"sendEncryptionKeysEvent",(a=B(function*(e){if(void 0!==l.keysEventUpdateTimeout&&(clearTimeout(l.keysEventUpdateTimeout),l.keysEventUpdateTimeout=void 0),l.lastEncryptionKeyUpdateRequest=Date.now(),l.joined){var t=l.getKeysForParticipant(l.userId,l.deviceId);if(!t)return void l.logger.warn("Tried to send encryption keys event but no keys found!");if("number"!=typeof e&&-1===l.latestGeneratedKeyIndex)return void l.logger.warn("Tried to send encryption keys event but no current key index found!");var n=e??l.latestGeneratedKeyIndex;l.logger.info("Try sending encryption keys event. keyIndexToSend=".concat(n," (method parameter: ").concat(e,")"));var r=t[n];try{l.statistics.counters.roomEventEncryptionKeysSent+=1;var i=l.getMemberships().filter(e=>null!=e.sender).map(e=>({userId:e.sender,deviceId:e.deviceId,membershipTs:e.createdTs()}));yield l.transport.sendKey(CJ(r),n,i),l.logger.debug("sendEncryptionKeysEvent participantId=".concat(l.userId,":").concat(l.deviceId," numKeys=").concat(t.length," currentKeyIndex=").concat(l.latestGeneratedKeyIndex," keyIndexToSend=").concat(n))}catch(e){if(void 0===l.keysEventUpdateTimeout){var o=OP(e,5e3);l.logger.warn("Failed to send m.call.encryption_key, retrying in ".concat(o),e),l.keysEventUpdateTimeout=setTimeout(()=>{l.sendEncryptionKeysEvent()},o)}else l.logger.info("Not scheduling key resend as another re-send is already pending")}}}),function(e){return a.apply(this,arguments)})),P(this,"onTransportChanged",()=>{this.requestSendCurrentKey()}),P(this,"onNewKeyReceived",(e,t,n,r,i)=>{this.logger.debug("Received key over key transport ".concat(e,":").concat(t," at index ").concat(r)),this.setEncryptionKey(e,t,r,n,i)}),P(this,"onRotateKeyTimeout",()=>{if(this.manageMediaKeys){this.makeNewKeyTimeout=void 0,this.logger.info("Making new sender key for key rotation");var e=this.makeNewSenderKey(!0);this.sendEncryptionKeysEvent(e)}}),this.logger=(s??M).getChild("[EncryptionManager]")}getEncryptionKeys(){var e=new Map;for(var[t,n]of this.encryptionKeys){var r=n.map((e,t)=>({key:e.key,keyIndex:t}));e.set(t,r)}return e}join(e){var t,n,r;this.joinConfig=e,this.joined=!0,this.manageMediaKeys=null!==(t=null===(n=this.joinConfig)||void 0===n?void 0:n.manageMediaKeys)&&void 0!==t?t:this.manageMediaKeys,this.transport.on(Kc.ReceivedKeys,this.onNewKeyReceived),this.transport instanceof zP&&this.transport.on(a_.EnabledTransportsChanged,this.onTransportChanged),this.transport.start(),null!==(r=this.joinConfig)&&void 0!==r&&r.manageMediaKeys&&(this.makeNewSenderKey(),this.requestSendCurrentKey())}leave(){for(var e of(this.encryptionKeys.set(jh(this.userId,this.deviceId),[]),this.transport.off(Kc.ReceivedKeys,this.onNewKeyReceived),this.transport.stop(),void 0!==this.makeNewKeyTimeout&&(clearTimeout(this.makeNewKeyTimeout),this.makeNewKeyTimeout=void 0),this.setNewKeyTimeouts))clearTimeout(e);this.setNewKeyTimeouts.clear(),this.manageMediaKeys=!1,this.joined=!1}onMembershipsUpdate(e){if(this.manageMediaKeys&&this.joined){var t=new Set(e.filter(e=>!jE(e,this.userId,this.deviceId)).map(Ek)),n=new Set(this.getMemberships().filter(e=>!jE(e,this.userId,this.deviceId)).map(Ek)),r=Array.from(t).some(e=>!n.has(e)),i=Array.from(n).some(e=>!t.has(e)),o=this.lastMembershipFingerprints;if(this.storeLastMembershipFingerprints(),r)this.makeNewKeyTimeout||(this.logger.debug("Member(s) have left: queueing sender key rotation"),this.makeNewKeyTimeout=setTimeout(this.onRotateKeyTimeout,this.makeKeyDelay));else if(i)this.logger.debug("New member(s) have joined: re-sending keys"),this.requestSendCurrentKey();else if(o){var s=this.lastMembershipFingerprints;(Array.from(o).some(e=>!s.has(e))||Array.from(s).some(e=>!o.has(e)))&&(this.logger.debug("Member(s) have updated/reconnected: re-sending keys to everyone"),this.requestSendCurrentKey())}}}makeNewSenderKey(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=TJ(16),n=this.getNewEncryptionKeyIndex();return this.logger.info("Generated new key at index "+n),this.setEncryptionKey(this.userId,this.deviceId,n,t,Date.now(),e),n}requestSendCurrentKey(){if(this.manageMediaKeys){if(this.lastEncryptionKeyUpdateRequest&&this.lastEncryptionKeyUpdateRequest+this.updateEncryptionKeyThrottle>Date.now())return this.logger.info("Last encryption key event sent too recently: postponing"),void(void 0===this.keysEventUpdateTimeout&&(this.keysEventUpdateTimeout=setTimeout(()=>{this.sendEncryptionKeysEvent()},this.updateEncryptionKeyThrottle)));this.sendEncryptionKeysEvent()}}getKeysForParticipant(e,t){var n;return null===(n=this.encryptionKeys.get(jh(e,t)))||void 0===n?void 0:n.map(e=>e.key)}storeLastMembershipFingerprints(){this.lastMembershipFingerprints=new Set(this.getMemberships().filter(e=>!jE(e,this.userId,this.deviceId)).map(e=>"".concat(Ek(e),":").concat(e.createdTs())))}getNewEncryptionKeyIndex(){return-1===this.latestGeneratedKeyIndex?0:(this.latestGeneratedKeyIndex+1)%256}setEncryptionKey(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.logger.debug("Setting encryption key for ".concat(e,":").concat(t," at index ").concat(n));var s=Nh(r),a=jh(e,t);this.encryptionKeys.has(a)||this.encryptionKeys.set(a,[]);var l=this.encryptionKeys.get(a),c=l[n];if(c){if(c.timestamp>i)return void this.logger.info("Ignoring new key at index ".concat(n," for ").concat(a," as it is older than existing known key"));if($0e(c.key,s))return void(c.timestamp=i)}if(e===this.userId&&t===this.deviceId&&(this.latestGeneratedKeyIndex=n),l[n]={key:s,timestamp:i},o){var u=setTimeout(()=>{this.setNewKeyTimeouts.delete(u),this.logger.info("Delayed-emitting key changed event for ".concat(a," index ").concat(n)),this.onEncryptionKeysChanged(s,n,a)},this.useKeyDelay);this.setNewKeyTimeouts.add(u)}else this.onEncryptionKeysChanged(s,n,a)}}function $0e(e,t){return e===t||!!e&&!!t&&e.length===t.length&&e.every((e,n)=>e===t[n])}var Ek=e=>jh(e.sender,e.deviceId);class H$ extends Pn{setParentLogger(e){this.logger=e.getChild("[RoomKeyTransport]")}constructor(e,t,n,r){super(),this.room=e,this.client=t,this.statistics=n,P(this,"logger",M),this.setParentLogger(r??M)}start(){this.room.on(xe.Timeline,e=>{this.consumeCallEncryptionEvent(e)})}stop(){this.room.off(xe.Timeline,e=>{this.consumeCallEncryptionEvent(e)})}consumeCallEncryptionEvent(e){var t=arguments,n=this;return B(function*(){var r=t.length>1&&void 0!==t[1]&&t[1];if(yield n.client.decryptEventIfNeeded(e),!e.isDecryptionFailure())return r&&n.logger.info("Decryption succeeded for event ".concat(e.getId()," after retry")),e.getType()!==ee.CallEncryptionKeysPrefix?Promise.resolve():n.room?void n.onEncryptionEvent(e):(n.logger.error("Got room state event for unknown room ".concat(e.getRoomId(),"!")),Promise.resolve());r?n.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason)):(n.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason," will retry once only")),setTimeout(()=>{n.consumeCallEncryptionEvent(e,!0)},1e3))})()}sendKey(e,t,n){var r=this;return B(function*(){var n={keys:[{index:t,key:e}],device_id:r.client.getDeviceId(),call_id:"",sent_ts:Date.now()};try{yield r.client.sendEvent(r.room.roomId,ee.CallEncryptionKeysPrefix,n)}catch(e){r.logger.error("Failed to send call encryption keys",e);var i=e;throw i.event&&r.client.cancelPendingEvent(i.event),e}})()}onEncryptionEvent(e){var t=e.getSender(),n=e.getContent(),r=n.device_id,i=n.call_id;if(t)if(""===i)if(Array.isArray(n.keys))if(t!==this.client.getUserId()||r!==this.client.getDeviceId()){this.statistics.counters.roomEventEncryptionKeysReceived+=1;var o=Date.now()-("number"==typeof n.sent_ts?n.sent_ts:e.getTs());for(var s of(this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=o,n.keys))if(s){var a=s.key,l=s.index;a&&null!=l&&null!=i&&"string"==typeof r&&"string"==typeof i&&"string"==typeof a&&"number"==typeof l?(this.logger.debug("onCallEncryption userId=".concat(t,":").concat(r," encryptionKeyIndex=").concat(l," age=").concat(o,"ms")),this.emit(Kc.ReceivedKeys,t,r,a,l,e.getTs())):this.logger.warn("Malformed call encryption_key: userId=".concat(t,", deviceId=").concat(r,", encryptionKeyIndex=").concat(l," callId=").concat(i))}else this.logger.info("Ignoring false-y key in keys event")}else this.logger.info("Ignoring our own keys event");else this.logger.warn("Received m.call.encryption_keys where keys wasn't an array: callId=".concat(i));else this.logger.warn("Received m.call.encryption_keys with unsupported callId: userId=".concat(t,", deviceId=").concat(r,", callId=").concat(i));else this.logger.warn("Received m.call.encryption_keys with no userId: callId=".concat(i))}}class B0e{constructor(e,t,n,r,i,o,s){this.userId=e,this.deviceId=t,this.getMemberships=n,this.transport=r,this.statistics=i,this.onEncryptionKeysChanged=o,P(this,"manageMediaKeys",!1),P(this,"participantKeyRings",new Map),P(this,"outboundSession",null),P(this,"currentKeyDistributionPromise",null),P(this,"useKeyDelay",5e3),P(this,"keyRotationGracePeriodMs",1e4),P(this,"needToEnsureKeyAgain",!1),P(this,"keyBuffer",new U0e),P(this,"logger",void 0),P(this,"onTransportChanged",()=>{var e;null===(e=this.logger)||void 0===e||e.info("Transport change detected, restarting key distribution"),this.currentKeyDistributionPromise?this.currentKeyDistributionPromise.then(()=>{this.outboundSession&&(this.outboundSession.sharedWith=[],this.ensureKeyDistribution())}).catch(e=>{var t;null===(t=this.logger)||void 0===t||t.error("Failed to restart key distribution",e)}):this.outboundSession&&(this.outboundSession.sharedWith=[],this.ensureKeyDistribution())}),P(this,"onNewKeyReceived",(e,t,n,r,i)=>{var o;if(this.manageMediaKeys){null===(o=this.logger)||void 0===o||o.debug("Received key over transport ".concat(e,":").concat(t," at index ").concat(r));var s,a=jh(e,t),l={key:Nh(n),participantId:a,keyIndex:r,creationTS:i};if(this.keyBuffer.isOutdated(a,l))null===(s=this.logger)||void 0===s||s.info("Received an out of order key for ".concat(e,":").concat(t,", dropping it"));else this.addKeyToParticipant(l.key,l.keyIndex,l.participantId),this.statistics.counters.roomEventEncryptionKeysReceived+=1}else{var c;null===(c=this.logger)||void 0===c||c.warn("Received key over transport ".concat(e,":").concat(t," at index ").concat(r," but media keys are disabled"))}}),this.logger=null==s?void 0:s.getChild("[EncryptionManager]")}getEncryptionKeys(){return new Map(this.participantKeyRings)}addKeyToParticipant(e,t,n){this.participantKeyRings.has(n)||this.participantKeyRings.set(n,[]),this.participantKeyRings.get(n).push({key:e,keyIndex:t}),this.onEncryptionKeysChanged(e,t,n)}join(e){var t,n,r,i;this.manageMediaKeys=null===(t=null==e?void 0:e.manageMediaKeys)||void 0===t||t,null===(n=this.logger)||void 0===n||n.info("Joining room"),this.useKeyDelay=null!==(r=null==e?void 0:e.useKeyDelay)&&void 0!==r?r:1e3,this.keyRotationGracePeriodMs=null!==(i=null==e?void 0:e.keyRotationGracePeriodMs)&&void 0!==i?i:1e4,this.transport.on(Kc.ReceivedKeys,this.onNewKeyReceived),this.transport instanceof zP&&this.transport.on(a_.EnabledTransportsChanged,this.onTransportChanged),this.transport.start()}leave(){this.transport.off(Kc.ReceivedKeys,this.onNewKeyReceived),this.transport.stop(),this.participantKeyRings.clear()}ensureKeyDistribution(){if(this.manageMediaKeys)if(null==this.currentKeyDistributionPromise){var e;null===(e=this.logger)||void 0===e||e.debug("No active rollout, start a new one"),this.currentKeyDistributionPromise=this.rolloutOutboundKey().then(()=>{var e,t;(null===(e=this.logger)||void 0===e||e.debug("Rollout completed"),this.currentKeyDistributionPromise=null,this.needToEnsureKeyAgain)&&(null===(t=this.logger)||void 0===t||t.debug("New Rollout needed"),this.needToEnsureKeyAgain=!1,this.ensureKeyDistribution())})}else{var t;null===(t=this.logger)||void 0===t||t.debug("Rollout in progress, a new rollout will be started after the current one"),this.needToEnsureKeyAgain=!0}}onMembershipsUpdate(){var e;null===(e=this.logger)||void 0===e||e.trace("onMembershipsUpdate"),this.ensureKeyDistribution()}rolloutOutboundKey(){var e=this;return B(function*(){var t,n;null==e.outboundSession&&(e.outboundSession={key:e.generateRandomKey(),creationTS:Date.now(),sharedWith:[],keyId:0},e.addKeyToParticipant(e.outboundSession.key,e.outboundSession.keyId,jh(e.userId,e.deviceId)));var r,i=e.getMemberships().filter(e=>null!=e.sender).map(e=>({userId:e.sender,deviceId:e.deviceId,membershipTs:e.createdTs()})),o=null!==(t=null===(n=e.outboundSession)||void 0===n?void 0:n.sharedWith)&&void 0!==t?t:[],s=(o=o.filter(e=>!i.some(t=>e.userId==t.userId&&e.deviceId==t.deviceId&&e.membershipTs!=t.membershipTs))).filter(e=>!i.some(t=>e.userId==t.userId&&e.deviceId==t.deviceId&&e.membershipTs==t.membershipTs)),a=i.filter(e=>!o.some(t=>e.userId==t.userId&&e.deviceId==t.deviceId&&e.membershipTs==t.membershipTs)),l=[],c=!1;if(s.length>0){var u=e.createNewOutboundSession();c=!0,l=i,r=u}else{if(!(a.length>0))return;var d=Date.now()-e.outboundSession.creationTS;if(d<e.keyRotationGracePeriodMs){var h;null===(h=e.logger)||void 0===h||h.debug("New joiners detected, but the key is recent enough (age:".concat(d,"), keeping it")),l=a,r=e.outboundSession}else{var p;null===(p=e.logger)||void 0===p||p.debug("New joiners detected, rotating the key");var f=e.createNewOutboundSession();c=!0,l=i,r=f}}try{var m,v,g,y;if(null===(m=e.logger)||void 0===m||m.trace("Sending key..."),yield e.transport.sendKey(yy(r.key),r.keyId,l),e.statistics.counters.roomEventEncryptionKeysSent+=1,r.sharedWith.push(...l),null===(v=e.logger)||void 0===v||v.trace("key index:".concat(r.keyId," sent to ").concat(r.sharedWith.map(e=>"".concat(e.userId,":").concat(e.deviceId)).join(","))),c)null===(g=e.logger)||void 0===g||g.trace("Delay Rollout for key:".concat(r.keyId,"...")),yield mp(e.useKeyDelay),null===(y=e.logger)||void 0===y||y.trace("...Delayed rollout of index:".concat(r.keyId," ")),e.addKeyToParticipant(r.key,r.keyId,jh(e.userId,e.deviceId))}catch(t){var b;null===(b=e.logger)||void 0===b||b.error("Failed to rollout key",t)}})()}createNewOutboundSession(){var e,t={key:this.generateRandomKey(),creationTS:Date.now(),sharedWith:[],keyId:this.nextKeyIndex()};return null===(e=this.logger)||void 0===e||e.info("creating new outbound key index:".concat(t.keyId)),this.outboundSession=t,t}nextKeyIndex(){return this.outboundSession?(this.outboundSession.keyId+1)%256:0}generateRandomKey(){var e=new Uint8Array(16);return globalThis.crypto.getRandomValues(e),e}}var yi=function(e){return e.MembershipsChanged="memberships_changed",e.JoinStateChanged="join_state_changed",e.EncryptionKeyChanged="encryption_key_changed",e.MembershipManagerError="membership_manager_error",e}({});class Jl extends Pn{get membershipStatus(){var e;return null===(e=this.membershipManager)||void 0===e?void 0:e.status}get probablyLeft(){var e;return null===(e=this.membershipManager)||void 0===e?void 0:e.probablyLeft}get callId(){return this._callId}static callMembershipsForRoom(e){return Jl.sessionMembershipsForRoom(e,{id:"",application:"m.call"})}static sessionMembershipsForRoom(e,t){var n=M.getChild("[MatrixRTCSession ".concat(e.roomId,"]")),r=e.getLiveTimeline().getState(Me.FORWARDS);if(!r)throw n.warn("Couldn't get state for room "+e.roomId),new Error("Could't get state for room "+e.roomId);var i=r.getStateEvents(ee.GroupCallMemberPrefix),o=[];for(var s of i){var a=s.getContent(),l=Object.keys(a).length;if(0!==l){var c=[];if(l>1&&"focus_active"in a?c.push(a):1===l&&"memberships"in a&&n.warn("Legacy event found. Those are ignored, they do not contribute to the MatrixRTC session"),0!==c.length)for(var u of c)try{var d,h=new B$(s,u);if(!df(h.sessionDescription,t)){n.info("Ignoring membership of user ".concat(h.sender," for a different session:  ").concat(JSON.stringify(h.sessionDescription)));continue}if(h.isExpired()){n.info("Ignoring expired device membership ".concat(h.sender,"/").concat(h.deviceId));continue}if(!e.hasMembershipState(null!==(d=h.sender)&&void 0!==d?d:"",Ve.Join)){n.info("Ignoring membership of user ".concat(h.sender," who is not in the room."));continue}o.push(h)}catch(e){n.warn("Couldn't construct call membership: ",e)}}}return o.sort((e,t)=>e.createdTs()-t.createdTs()),o.length>1&&n.debug("Call memberships in room ".concat(e.roomId,", in order: "),o.map(e=>[e.createdTs(),e.sender])),o}static roomSessionForRoom(e,t){var n=Jl.sessionMembershipsForRoom(t,{id:"",application:"m.call"});return new Jl(e,t,n,{id:"",application:"m.call"})}static sessionForRoom(e,t,n){var r=Jl.sessionMembershipsForRoom(t,n);return new Jl(e,t,r,n)}get room(){return this.roomSubset}constructor(e,t,n,r){var i;super(),this.client=e,this.roomSubset=t,this.memberships=n,this.sessionDescription=r,P(this,"membershipManager",void 0),P(this,"encryptionManager",void 0),P(this,"_callId",void 0),P(this,"joinConfig",void 0),P(this,"logger",void 0),P(this,"pendingNotificationToSend",void 0),P(this,"expiryTimeout",void 0),P(this,"statistics",{counters:{roomEventEncryptionKeysSent:0,roomEventEncryptionKeysReceived:0},totals:{roomEventEncryptionKeysReceivedTotalAge:0}}),P(this,"reEmitter",new Mv(this)),P(this,"onRoomMemberUpdate",()=>{this.recalculateSessionMembers()}),P(this,"onRTCSessionMemberUpdate",()=>{this.recalculateSessionMembers()}),P(this,"recalculateSessionMembers",()=>{var e,t,n,r=this.memberships;if(this.memberships=Jl.sessionMembershipsForRoom(this.room,this.sessionDescription),this._callId=null!==(e=this._callId)&&void 0!==e?e:null===(t=this.memberships[0])||void 0===t?void 0:t.sessionDescription.id,r.length!=this.memberships.length||r.some((e,t)=>!B$.equal(e,this.memberships[t]))){var i,o;this.logger.info("Memberships for call in room ".concat(this.roomSubset.roomId," have changed: emitting (").concat(this.memberships.length," members)")),Zge(this.logger,"emit MatrixRTCSessionEvent.MembershipsChanged",()=>{this.emit(yi.MembershipsChanged,r,this.memberships)}),null===(i=this.membershipManager)||void 0===i||i.onRTCSessionMemberUpdate(this.memberships);var s,a=null===(o=this.membershipManager)||void 0===o?void 0:o.ownMembership;if(this.pendingNotificationToSend&&a&&0===r.length)a.eventId&&null!==(s=this.joinConfig)&&void 0!==s&&s.notificationType?this.sendCallNotify(a.eventId,this.joinConfig.notificationType):this.logger.warn("Own membership eventId is undefined, cannot send call notification");this.memberships.length>0&&(this.pendingNotificationToSend=void 0)}null===(n=this.encryptionManager)||void 0===n||n.onMembershipsUpdate(r),this.setExpiryTimer()}),this.logger=M.getChild("[MatrixRTCSession ".concat(t.roomId,"]")),this._callId=null===(i=n[0])||void 0===i?void 0:i.sessionDescription.id;var o=this.roomSubset.getLiveTimeline().getState(Me.FORWARDS);null==o||o.on(vt.Members,this.onRoomMemberUpdate),this.setExpiryTimer()}isJoined(){var e,t;return null!==(e=null===(t=this.membershipManager)||void 0===t?void 0:t.isJoined())&&void 0!==e&&e}stop(){var e=this;return B(function*(){var t;yield null===(t=e.membershipManager)||void 0===t?void 0:t.leave(1e3),e.expiryTimeout&&(clearTimeout(e.expiryTimeout),e.expiryTimeout=void 0);var n=e.roomSubset.getLiveTimeline().getState(Me.FORWARDS);null==n||n.off(vt.Members,e.onRoomMemberUpdate)})()}joinRoomSession(e,t,n){var r;if(this.isJoined())this.logger.info("Already joined to session in room ".concat(this.roomSubset.roomId,": ignoring join call"));else{var i;if(this.membershipManager=new tC(n,this.roomSubset,this.client,()=>this.getOldestMembership(),this.sessionDescription,this.logger),this.reEmitter.reEmit(this.membershipManager,[Uh.ProbablyLeft,Uh.StatusChanged]),null!=n&&n.useExperimentalToDeviceTransport){this.logger.info("Using experimental to-device transport for encryption keys"),this.logger.info("Using to-device with room fallback transport for encryption keys");var[o,s]=[this.client.getUserId(),this.client.getDeviceId()],[a,l,c]=[this.roomSubset,this.client,this.statistics],u=new H$(a,l,c),d=new j0e(o,s,a.roomId,l,c);i=new zP(d,u,this.logger),this.reEmitter.reEmit(i,[a_.EnabledTransportsChanged]),this.encryptionManager=new B0e(this.client.getUserId(),this.client.getDeviceId(),()=>this.memberships,i,this.statistics,(e,t,n)=>{this.emit(yi.EncryptionKeyChanged,e,t,n)},this.logger)}else i=new H$(this.roomSubset,this.client,this.statistics),this.encryptionManager=new F0e(this.client.getUserId(),this.client.getDeviceId(),()=>this.memberships,i,this.statistics,(e,t,n)=>{this.emit(yi.EncryptionKeyChanged,e,t,n)});this.joinConfig=n,this.pendingNotificationToSend=null===(r=this.joinConfig)||void 0===r?void 0:r.notificationType,this.membershipManager.join(e,t,e=>{this.logger.error("MembershipManager encountered an unrecoverable error: ",e),this.emit(yi.MembershipManagerError,e),this.emit(yi.JoinStateChanged,this.isJoined())}),this.encryptionManager.join(n),this.emit(yi.JoinStateChanged,!0)}}leaveRoomSession(){var e=arguments,t=this;return B(function*(){var n=e.length>0&&void 0!==e[0]?e[0]:void 0;if(!t.isJoined())return t.logger.info("Not joined to session in room ".concat(t.roomSubset.roomId,": ignoring leave call")),!1;t.logger.info("Leaving call session in room ".concat(t.roomSubset.roomId)),t.encryptionManager.leave();var r=t.membershipManager.leave(n);return t.emit(yi.JoinStateChanged,!1),yield r})()}getActiveFocus(){var e;return null===(e=this.membershipManager)||void 0===e?void 0:e.getActiveFocus()}getOldestMembership(){return this.memberships[0]}getFocusInUse(){var e=this.getOldestMembership();if("oldest_membership"===(null==e?void 0:e.getFocusSelection()))return e.getPreferredFoci()[0]}reemitEncryptionKeys(){var e;null===(e=this.encryptionManager)||void 0===e||e.getEncryptionKeys().forEach((e,t)=>{e.forEach(e=>{this.emit(yi.EncryptionKeyChanged,e.key,e.keyIndex,t)})})}setExpiryTimer(){var e;for(var t of(this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0),this.memberships)){var n=t.getMsUntilExpiry();void 0!==n&&(void 0===e||n<e)&&(e=n)}null!=e&&(this.expiryTimeout=setTimeout(this.onRTCSessionMemberUpdate,e))}sendCallNotify(e,t){this.client.sendEvent(this.roomSubset.roomId,ee.CallNotify,{application:"m.call","m.mentions":{user_ids:[],room:!0},notify_type:"notification"===t?"notify":t,call_id:this.callId}).catch(e=>this.logger.error("Failed to send call notification",e)),this.client.sendEvent(this.roomSubset.roomId,ee.RTCNotification,{"m.mentions":{user_ids:[],room:!0},notification_type:t,"m.relates_to":{event_id:e,rel_type:kn.unstable_RTCNotificationParent},sender_ts:Date.now(),lifetime:3e4}).catch(e=>this.logger.error("Failed to send call notification",e))}}var nC=function(e){return e.SessionStarted="session_started",e.SessionEnded="session_ended",e}({});class H0e extends Pn{constructor(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{id:"",application:"m.call"};super(),this.client=t,this.sessionDescription=n,P(this,"roomSessions",new Map),P(this,"logger",void 0),P(this,"onRoom",e=>{this.refreshRoom(e)}),P(this,"onRoomState",(e,t)=>{var n=this.client.getRoom(e.getRoomId());n?e.getType()==ee.GroupCallMemberPrefix&&this.refreshRoom(n):this.logger.error("Got room state event for unknown room ".concat(e.getRoomId(),"!"))}),this.logger=e.getChild("[MatrixRTCSessionManager]")}start(){for(var e of null!==(t=this.client.getRooms())&&void 0!==t?t:[]){var t,n=Jl.sessionForRoom(this.client,e,this.sessionDescription);n.memberships.length>0&&this.roomSessions.set(e.roomId,n)}this.client.on(Le.Room,this.onRoom),this.client.on(vt.Events,this.onRoomState)}stop(){for(var e of this.roomSessions.values())e.stop();this.roomSessions.clear(),this.client.off(Le.Room,this.onRoom),this.client.off(vt.Events,this.onRoomState)}getActiveRoomSession(e){return this.roomSessions.get(e.roomId)}getRoomSession(e){return this.roomSessions.has(e.roomId)||this.roomSessions.set(e.roomId,Jl.sessionForRoom(this.client,e,this.sessionDescription)),this.roomSessions.get(e.roomId)}refreshRoom(e){var t=!this.roomSessions.has(e.roomId),n=this.getRoomSession(e),r=n.memberships.length>0&&!t;n.onRTCSessionMemberUpdate();var i=n.memberships.length>0;r&&!i?(this.logger.trace("Session ended for ".concat(e.roomId," (").concat(n.memberships.length," members)")),this.emit(nC.SessionEnded,e.roomId,this.roomSessions.get(e.roomId))):!r&&i&&(this.logger.trace("Session started for ".concat(e.roomId," (").concat(n.memberships.length," members)")),this.emit(nC.SessionStarted,e.roomId,this.roomSessions.get(e.roomId)))}}function wk(e){return t=>{var n,r;return(null===(n=t.content)||void 0===n||null===(n=n["m.relates_to"])||void 0===n?void 0:n.event_id)!==e||(null===(r=t.content)||void 0===r||null===(r=r["m.relates_to"])||void 0===r?void 0:r.rel_type)===yn.name}}function BJ(e){return aA.apply(this,arguments)}function aA(){return(aA=B(function*(e){if(!globalThis.crypto.subtle)throw new Error("Crypto.subtle is not available: insecure context?");var t=(new TextEncoder).encode(e),n=yield globalThis.crypto.subtle.digest("SHA-256",t);return new Uint8Array(n)})).apply(this,arguments)}class sy extends Error{}function V0e(e){return decodeURIComponent(atob(e).replace(/(.)/g,(e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function q0e(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return V0e(t)}catch{return atob(t)}}function HJ(e,t){if("string"!=typeof e)throw new sy("Invalid token specified: must be a string");t||(t={});const n=!0===t.header?0:1,r=e.split(".")[n];if("string"!=typeof r)throw new sy(`Invalid token specified: missing part #${n+1}`);let i;try{i=q0e(r)}catch(e){throw new sy(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(i)}catch(e){throw new sy(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}sy.prototype.name="InvalidTokenError";var Dc,Nc,G0e={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},ab=(e=>(e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e))(ab||{});(e=>{e.reset=function(){Dc=3,Nc=G0e},e.setLevel=function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");Dc=e},e.setLogger=function(e){Nc=e}})(ab||(ab={}));var Ir=class e{constructor(e){this._name=e}debug(...t){Dc>=4&&Nc.debug(e._format(this._name,this._method),...t)}info(...t){Dc>=3&&Nc.info(e._format(this._name,this._method),...t)}warn(...t){Dc>=2&&Nc.warn(e._format(this._name,this._method),...t)}error(...t){Dc>=1&&Nc.error(e._format(this._name,this._method),...t)}throw(e){throw this.error(e),e}create(e){const t=Object.create(this);return t._method=e,t.debug("begin"),t}static createStatic(t,n){const r=new e(`${t}.${n}`);return r.debug("begin"),r}static _format(e,t){const n=`[${e}]`;return t?`${n} ${t}:`:n}static debug(t,...n){Dc>=4&&Nc.debug(e._format(t),...n)}static info(t,...n){Dc>=3&&Nc.info(e._format(t),...n)}static warn(t,...n){Dc>=2&&Nc.warn(e._format(t),...n)}static error(t,...n){Dc>=1&&Nc.error(e._format(t),...n)}};ab.reset();var rC=class{static decode(e){try{return HJ(e)}catch(e){throw Ir.error("JwtUtils.decode",e),e}}static async generateSignedJwt(e,t,n){const r=`${Za.encodeBase64Url((new TextEncoder).encode(JSON.stringify(e)))}.${Za.encodeBase64Url((new TextEncoder).encode(JSON.stringify(t)))}`,i=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,(new TextEncoder).encode(r));return`${r}.${Za.encodeBase64Url(new Uint8Array(i))}`}},K0e="10000000-1000-4000-8000-100000000000",cA=e=>btoa([...new Uint8Array(e)].map(e=>String.fromCharCode(e)).join("")),VJ=class e{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return K0e.replace(/[018]/g,t=>(+t^e._randomWord()&15>>+t/4).toString(16)).replace(/-/g,"")}static generateCodeVerifier(){return e.generateUUIDv4()+e.generateUUIDv4()+e.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return cA(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(e){throw Ir.error("CryptoUtils.generateCodeChallenge",e),e}}static generateBasicAuth(e,t){const n=(new TextEncoder).encode([e,t].join(":"));return cA(n)}static async hash(e,t){const n=(new TextEncoder).encode(t),r=await crypto.subtle.digest(e,n);return new Uint8Array(r)}static async customCalculateJwkThumbprint(t){let n;switch(t.kty){case"RSA":n={e:t.e,kty:t.kty,n:t.n};break;case"EC":n={crv:t.crv,kty:t.kty,x:t.x,y:t.y};break;case"OKP":n={crv:t.crv,kty:t.kty,x:t.x};break;case"oct":n={crv:t.k,kty:t.kty};break;default:throw new Error("Unknown jwk type")}const r=await e.hash("SHA-256",JSON.stringify(n));return e.encodeBase64Url(r)}static async generateDPoPProof({url:t,accessToken:n,httpMethod:r,keyPair:i,nonce:o}){let s,a;const l={jti:window.crypto.randomUUID(),htm:r??"GET",htu:t,iat:Math.floor(Date.now()/1e3)};n&&(s=await e.hash("SHA-256",n),a=e.encodeBase64Url(s),l.ath=a),o&&(l.nonce=o);try{const e=await crypto.subtle.exportKey("jwk",i.publicKey),t={alg:"ES256",typ:"dpop+jwt",jwk:{crv:e.crv,kty:e.kty,x:e.x,y:e.y}};return await rC.generateSignedJwt(t,l,i.privateKey)}catch(e){throw e instanceof TypeError?new Error(`Error exporting dpop public key: ${e.message}`):e}}static async generateDPoPJkt(t){try{const n=await crypto.subtle.exportKey("jwk",t.publicKey);return await e.customCalculateJwkThumbprint(n)}catch(e){throw e instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${e.message}`):e}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};VJ.encodeBase64Url=e=>cA(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var Za=VJ,z0e=class{constructor(e){this._name=e,this._callbacks=[],this._logger=new Ir(`Event('${this._name}')`)}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const t=this._callbacks.lastIndexOf(e);t>=0&&this._callbacks.splice(t,1)}async raise(...e){this._logger.debug("raise:",...e);for(const t of this._callbacks)await t(...e)}},iC=class e extends z0e{constructor(){super(...arguments),this._logger=new Ir(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const t=this._expiration-e.getEpochTime();this._logger.debug("timer completes in",t),this._expiration<=e.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(t){const n=this._logger.create("init");t=Math.max(Math.floor(t),1);const r=e.getEpochTime()+t;if(this.expiration===r&&this._timerHandle)return void n.debug("skipping since already initialized for expiration at",this.expiration);this.cancel(),n.debug("using duration",t),this._expiration=r;const i=Math.min(t,5);this._timerHandle=setInterval(this._callback,1e3*i)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},V$=class{static readParams(e,t="query"){if(!e)throw new TypeError("Invalid URL");const n=new URL(e,"http://127.0.0.1")["fragment"===t?"hash":"search"];return new URLSearchParams(n.slice(1))}},lA=";",Jg=class extends Error{constructor(e,t){var n,r,i;if(super(e.error_description||e.error||""),this.form=t,this.name="ErrorResponse",!e.error)throw Ir.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=e.error,this.error_description=null!=(n=e.error_description)?n:null,this.error_uri=null!=(r=e.error_uri)?r:null,this.state=e.userState,this.session_state=null!=(i=e.session_state)?i:null,this.url_state=e.url_state}},W0e=class extends Error{constructor(e){super(e),this.name="ErrorTimeout"}},Y0e=class{constructor(){this._logger=new Ir("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(e){return this._logger.create(`getItem('${e}')`),this._data[e]}setItem(e,t){this._logger.create(`setItem('${e}')`),this._data[e]=t}removeItem(e){this._logger.create(`removeItem('${e}')`),delete this._data[e]}get length(){return Object.getOwnPropertyNames(this._data).length}key(e){return Object.getOwnPropertyNames(this._data)[e]}},uA=class extends Error{constructor(e,t){super(t),this.name="ErrorDPoPNonce",this.nonce=e}},WP=class{constructor(e=[],t=null,n={}){this._jwtHandler=t,this._extraHeaders=n,this._logger=new Ir("JsonService"),this._contentTypes=[],this._contentTypes.push(...e,"application/json"),t&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(e,t={}){const{timeoutInSeconds:n,...r}=t;if(!n)return await fetch(e,r);const i=new AbortController,o=setTimeout(()=>i.abort(),1e3*n);try{return await fetch(e,{...t,signal:i.signal})}catch(e){throw e instanceof DOMException&&"AbortError"===e.name?new W0e("Network timed out"):e}finally{clearTimeout(o)}}async getJson(e,{token:t,credentials:n,timeoutInSeconds:r}={}){const i=this._logger.create("getJson"),o={Accept:this._contentTypes.join(", ")};let s;t&&(i.debug("token passed, setting Authorization header"),o.Authorization="Bearer "+t),this.appendExtraHeaders(o);try{i.debug("url:",e),s=await this.fetchWithTimeout(e,{method:"GET",headers:o,timeoutInSeconds:r,credentials:n})}catch(e){throw i.error("Network Error"),e}i.debug("HTTP response received, status",s.status);const a=s.headers.get("Content-Type");if(a&&!this._contentTypes.find(e=>a.startsWith(e))&&i.throw(new Error(`Invalid response Content-Type: ${a??"undefined"}, from URL: ${e}`)),s.ok&&this._jwtHandler&&null!=a&&a.startsWith("application/jwt"))return await this._jwtHandler(await s.text());let l;try{l=await s.json()}catch(e){throw i.error("Error parsing JSON response",e),s.ok?e:new Error(`${s.statusText} (${s.status})`)}if(!s.ok)throw i.error("Error from server:",l),l.error?new Jg(l):new Error(`${s.statusText} (${s.status}): ${JSON.stringify(l)}`);return l}async postForm(e,{body:t,basicAuth:n,timeoutInSeconds:r,initCredentials:i,extraHeaders:o}){const s=this._logger.create("postForm"),a={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded",...o};let l;void 0!==n&&(a.Authorization="Basic "+n),this.appendExtraHeaders(a);try{s.debug("url:",e),l=await this.fetchWithTimeout(e,{method:"POST",headers:a,body:t,timeoutInSeconds:r,credentials:i})}catch(e){throw s.error("Network error"),e}s.debug("HTTP response received, status",l.status);const c=l.headers.get("Content-Type");if(c&&!this._contentTypes.find(e=>c.startsWith(e)))throw new Error(`Invalid response Content-Type: ${c??"undefined"}, from URL: ${e}`);const u=await l.text();let d={};if(u)try{d=JSON.parse(u)}catch(e){throw s.error("Error parsing JSON response",e),l.ok?e:new Error(`${l.statusText} (${l.status})`)}if(!l.ok){if(s.error("Error from server:",d),l.headers.has("dpop-nonce")){const e=l.headers.get("dpop-nonce");throw new uA(e,`${JSON.stringify(d)}`)}throw d.error?new Jg(d,t):new Error(`${l.statusText} (${l.status}): ${JSON.stringify(d)}`)}return d}appendExtraHeaders(e){const t=this._logger.create("appendExtraHeaders"),n=Object.keys(this._extraHeaders),r=["authorization","accept","content-type"];0!==n.length&&n.forEach(n=>{if(r.includes(n.toLocaleLowerCase()))return void t.warn("Protected header could not be overridden",n,r);const i="function"==typeof this._extraHeaders[n]?this._extraHeaders[n]():this._extraHeaders[n];i&&""!==i&&(e[n]=i)})}},qJ=class{constructor(e){this._settings=e,this._logger=new Ir("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new WP(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const e=this._logger.create("getMetadata");if(this._metadata)return e.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw e.throw(new Error("No authority or metadataUrl configured on settings")),null;e.debug("getting metadata from",this._metadataUrl);const t=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return e.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,t),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(e=!0){return this._getMetadataProperty("token_endpoint",e)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(e=!0){return this._getMetadataProperty("revocation_endpoint",e)}getKeysEndpoint(e=!0){return this._getMetadataProperty("jwks_uri",e)}async _getMetadataProperty(e,t=!1){const n=this._logger.create(`_getMetadataProperty('${e}')`),r=await this.getMetadata();if(n.debug("resolved"),void 0===r[e]){if(!0===t)return void n.warn("Metadata does not contain optional property");n.throw(new Error("Metadata does not contain property "+e))}return r[e]}async getSigningKeys(){const e=this._logger.create("getSigningKeys");if(this._signingKeys)return e.debug("returning signingKeys from cache"),this._signingKeys;const t=await this.getKeysEndpoint(!1);e.debug("got jwks_uri",t);const n=await this._jsonService.getJson(t,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(e.debug("got key set",n),!Array.isArray(n.keys))throw e.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=n.keys,this._signingKeys}},G3=class{constructor({prefix:e="oidc.",store:t=localStorage}={}){this._logger=new Ir("WebStorageStateStore"),this._store=t,this._prefix=e}async set(e,t){this._logger.create(`set('${e}')`),e=this._prefix+e,await this._store.setItem(e,t)}async get(e){return this._logger.create(`get('${e}')`),e=this._prefix+e,await this._store.getItem(e)}async remove(e){this._logger.create(`remove('${e}')`),e=this._prefix+e;const t=await this._store.getItem(e);return await this._store.removeItem(e),t}async getAllKeys(){this._logger.create("getAllKeys");const e=await this._store.length,t=[];for(let n=0;n<e;n++){const e=await this._store.key(n);e&&0===e.indexOf(this._prefix)&&t.push(e.substr(this._prefix.length))}return t}},X0e="code",J0e="openid",Q0e="client_secret_post",Z0e=900,dA=class{constructor({authority:e,metadataUrl:t,metadata:n,signingKeys:r,metadataSeed:i,client_id:o,client_secret:s,response_type:a=X0e,scope:l=J0e,redirect_uri:c,post_logout_redirect_uri:u,client_authentication:d=Q0e,prompt:h,display:p,max_age:f,ui_locales:m,acr_values:v,resource:g,response_mode:y,filterProtocolClaims:b=!0,loadUserInfo:w=!1,requestTimeoutInSeconds:_,staleStateAgeInSeconds:S=Z0e,mergeClaimsStrategy:E={array:"replace"},disablePKCE:C=!1,stateStore:k,revokeTokenAdditionalContentTypes:T,fetchRequestCredentials:R,refreshTokenAllowedScope:I,extraQueryParams:x={},extraTokenParams:P={},extraHeaders:L={},dpop:M,omitScopeWhenRequesting:O=!1}){var A;if(this.authority=e,t?this.metadataUrl=t:(this.metadataUrl=e,e&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=n,this.metadataSeed=i,this.signingKeys=r,this.client_id=o,this.client_secret=s,this.response_type=a,this.scope=l,this.redirect_uri=c,this.post_logout_redirect_uri=u,this.client_authentication=d,this.prompt=h,this.display=p,this.max_age=f,this.ui_locales=m,this.acr_values=v,this.resource=g,this.response_mode=y,this.filterProtocolClaims=b??!0,this.loadUserInfo=!!w,this.staleStateAgeInSeconds=S,this.mergeClaimsStrategy=E,this.omitScopeWhenRequesting=O,this.disablePKCE=!!C,this.revokeTokenAdditionalContentTypes=T,this.fetchRequestCredentials=R||"same-origin",this.requestTimeoutInSeconds=_,k)this.stateStore=k;else{const e=typeof window<"u"?window.localStorage:new Y0e;this.stateStore=new G3({store:e})}if(this.refreshTokenAllowedScope=I,this.extraQueryParams=x,this.extraTokenParams=P,this.extraHeaders=L,this.dpop=M,this.dpop&&(null==(A=this.dpop)||!A.store))throw new Error("A DPoPStore is required when dpop is enabled")}},eye=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new Ir("UserInfoService"),this._getClaimsFromJwt=async e=>{const t=this._logger.create("_getClaimsFromJwt");try{const n=rC.decode(e);return t.debug("JWT decoding successful"),n}catch(e){throw t.error("Error parsing JWT response"),e}},this._jsonService=new WP(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(e){const t=this._logger.create("getClaims");e||this._logger.throw(new Error("No token passed"));const n=await this._metadataService.getUserInfoEndpoint();t.debug("got userinfo url",n);const r=await this._jsonService.getJson(n,{token:e,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return t.debug("got claims",r),r}},GJ=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new Ir("TokenClient"),this._jsonService=new WP(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:e="authorization_code",redirect_uri:t=this._settings.redirect_uri,client_id:n=this._settings.client_id,client_secret:r=this._settings.client_secret,extraHeaders:i,...o}){const s=this._logger.create("exchangeCode");n||s.throw(new Error("A client_id is required")),t||s.throw(new Error("A redirect_uri is required")),o.code||s.throw(new Error("A code is required"));const a=new URLSearchParams({grant_type:e,redirect_uri:t});for(const[e,t]of Object.entries(o))null!=t&&a.set(e,t);let l;switch(this._settings.client_authentication){case"client_secret_basic":if(!r)throw s.throw(new Error("A client_secret is required")),null;l=Za.generateBasicAuth(n,r);break;case"client_secret_post":a.append("client_id",n),r&&a.append("client_secret",r)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const u=await this._jsonService.postForm(c,{body:a,basicAuth:l,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return s.debug("got response"),u}async exchangeCredentials({grant_type:e="password",client_id:t=this._settings.client_id,client_secret:n=this._settings.client_secret,scope:r=this._settings.scope,...i}){const o=this._logger.create("exchangeCredentials");t||o.throw(new Error("A client_id is required"));const s=new URLSearchParams({grant_type:e});this._settings.omitScopeWhenRequesting||s.set("scope",r);for(const[e,t]of Object.entries(i))null!=t&&s.set(e,t);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw o.throw(new Error("A client_secret is required")),null;a=Za.generateBasicAuth(t,n);break;case"client_secret_post":s.append("client_id",t),n&&s.append("client_secret",n)}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const c=await this._jsonService.postForm(l,{body:s,basicAuth:a,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return o.debug("got response"),c}async exchangeRefreshToken({grant_type:e="refresh_token",client_id:t=this._settings.client_id,client_secret:n=this._settings.client_secret,timeoutInSeconds:r,extraHeaders:i,...o}){const s=this._logger.create("exchangeRefreshToken");t||s.throw(new Error("A client_id is required")),o.refresh_token||s.throw(new Error("A refresh_token is required"));const a=new URLSearchParams({grant_type:e});for(const[e,t]of Object.entries(o))Array.isArray(t)?t.forEach(t=>a.append(e,t)):null!=t&&a.set(e,t);let l;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;l=Za.generateBasicAuth(t,n);break;case"client_secret_post":a.append("client_id",t),n&&a.append("client_secret",n)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const u=await this._jsonService.postForm(c,{body:a,basicAuth:l,timeoutInSeconds:r,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return s.debug("got response"),u}async revoke(e){var t;const n=this._logger.create("revoke");e.token||n.throw(new Error("A token is required"));const r=await this._metadataService.getRevocationEndpoint(!1);n.debug(`got revocation endpoint, revoking ${null!=(t=e.token_type_hint)?t:"default token type"}`);const i=new URLSearchParams;for(const[t,n]of Object.entries(e))null!=n&&i.set(t,n);i.set("client_id",this._settings.client_id),this._settings.client_secret&&i.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(r,{body:i,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),n.debug("got response")}},tye=class{constructor(e,t,n){this._settings=e,this._metadataService=t,this._claimsService=n,this._logger=new Ir("ResponseValidator"),this._userInfoService=new eye(this._settings,this._metadataService),this._tokenClient=new GJ(this._settings,this._metadataService)}async validateSigninResponse(e,t,n){const r=this._logger.create("validateSigninResponse");this._processSigninState(e,t),r.debug("state processed"),await this._processCode(e,t,n),r.debug("code processed"),e.isOpenId&&this._validateIdTokenAttributes(e),r.debug("tokens validated"),await this._processClaims(e,null==t?void 0:t.skipUserInfo,e.isOpenId),r.debug("claims processed")}async validateCredentialsResponse(e,t){const n=this._logger.create("validateCredentialsResponse");e.isOpenId&&e.id_token&&this._validateIdTokenAttributes(e),n.debug("tokens validated"),await this._processClaims(e,t,e.isOpenId),n.debug("claims processed")}async validateRefreshResponse(e,t){const n=this._logger.create("validateRefreshResponse");e.userState=t.data,null!=e.session_state||(e.session_state=t.session_state),null!=e.scope||(e.scope=t.scope),e.isOpenId&&e.id_token&&(this._validateIdTokenAttributes(e,t.id_token),n.debug("ID Token validated")),e.id_token||(e.id_token=t.id_token,e.profile=t.profile);const r=e.isOpenId&&!!e.id_token;await this._processClaims(e,!1,r),n.debug("claims processed")}validateSignoutResponse(e,t){const n=this._logger.create("validateSignoutResponse");if(t.id!==e.state&&n.throw(new Error("State does not match")),n.debug("state validated"),e.userState=t.data,e.error)throw n.warn("Response was error",e.error),new Jg(e)}_processSigninState(e,t){const n=this._logger.create("_processSigninState");if(t.id!==e.state&&n.throw(new Error("State does not match")),t.client_id||n.throw(new Error("No client_id on state")),t.authority||n.throw(new Error("No authority on state")),this._settings.authority!==t.authority&&n.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==t.client_id&&n.throw(new Error("client_id mismatch on settings vs. signin state")),n.debug("state validated"),e.userState=t.data,e.url_state=t.url_state,null!=e.scope||(e.scope=t.scope),e.error)throw n.warn("Response was error",e.error),new Jg(e);t.code_verifier&&!e.code&&n.throw(new Error("Expected code in response"))}async _processClaims(e,t=!1,n=!0){const r=this._logger.create("_processClaims");if(e.profile=this._claimsService.filterProtocolClaims(e.profile),t||!this._settings.loadUserInfo||!e.access_token)return void r.debug("not loading user info");r.debug("loading user info");const i=await this._userInfoService.getClaims(e.access_token);r.debug("user info claims received from user info endpoint"),n&&i.sub!==e.profile.sub&&r.throw(new Error("subject from UserInfo response does not match subject in ID Token")),e.profile=this._claimsService.mergeClaims(e.profile,this._claimsService.filterProtocolClaims(i)),r.debug("user info claims received, updated profile:",e.profile)}async _processCode(e,t,n){const r=this._logger.create("_processCode");if(e.code){r.debug("Validating code");const i=await this._tokenClient.exchangeCode({client_id:t.client_id,client_secret:t.client_secret,code:e.code,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier,extraHeaders:n,...t.extraTokenParams});Object.assign(e,i)}else r.debug("No code to process")}_validateIdTokenAttributes(e,t){var n;const r=this._logger.create("_validateIdTokenAttributes");r.debug("decoding ID Token JWT");const i=rC.decode(null!=(n=e.id_token)?n:"");if(i.sub||r.throw(new Error("ID Token is missing a subject claim")),t){const e=rC.decode(t);i.sub!==e.sub&&r.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==e.auth_time&&r.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==e.azp&&r.throw(new Error("azp in id_token does not match original azp")),!i.azp&&e.azp&&r.throw(new Error("azp not in id_token, but present in original id_token"))}e.profile=i}},sC=class e{constructor(e){this.id=e.id||Za.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=iC.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new Ir("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(t){return Ir.createStatic("State","fromStorageString"),Promise.resolve(new e(JSON.parse(t)))}static async clearStaleState(t,n){const r=Ir.createStatic("State","clearStaleState"),i=iC.getEpochTime()-n,o=await t.getAllKeys();r.debug("got keys",o);for(let n=0;n<o.length;n++){const s=o[n],a=await t.get(s);let l=!1;if(a)try{const t=await e.fromStorageString(a);r.debug("got item from key:",s,t.created),t.created<=i&&(l=!0)}catch(e){r.error("Error parsing state for key:",s,e),l=!0}else r.debug("no item in storage for key:",s),l=!0;l&&(r.debug("removed item for key:",s),t.remove(s))}}},YP=class e extends sC{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(t){const n=!0===t.code_verifier?Za.generateCodeVerifier():t.code_verifier||void 0,r=n?await Za.generateCodeChallenge(n):void 0;return new e({...t,code_verifier:n,code_challenge:r})}toStorageString(){return new Ir("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(t){Ir.createStatic("SigninState","fromStorageString");const n=JSON.parse(t);return e.create(n)}},KJ=class e{constructor(e){this.url=e.url,this.state=e.state}static async create({url:t,authority:n,client_id:r,redirect_uri:i,response_type:o,scope:s,state_data:a,response_mode:l,request_type:c,client_secret:u,nonce:d,url_state:h,resource:p,skipUserInfo:f,extraQueryParams:m,extraTokenParams:v,disablePKCE:g,dpopJkt:y,omitScopeWhenRequesting:b,...w}){if(!t)throw this._logger.error("create: No url passed"),new Error("url");if(!r)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!i)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!o)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!s)throw this._logger.error("create: No scope passed"),new Error("scope");if(!n)throw this._logger.error("create: No authority passed"),new Error("authority");const _=await YP.create({data:a,request_type:c,url_state:h,code_verifier:!g,client_id:r,authority:n,redirect_uri:i,response_mode:l,client_secret:u,scope:s,extraTokenParams:v,skipUserInfo:f}),S=new URL(t);S.searchParams.append("client_id",r),S.searchParams.append("redirect_uri",i),S.searchParams.append("response_type",o),b||S.searchParams.append("scope",s),d&&S.searchParams.append("nonce",d),y&&S.searchParams.append("dpop_jkt",y);let E=_.id;h&&(E=`${E}${lA}${h}`),S.searchParams.append("state",E),_.code_challenge&&(S.searchParams.append("code_challenge",_.code_challenge),S.searchParams.append("code_challenge_method","S256")),p&&(Array.isArray(p)?p:[p]).forEach(e=>S.searchParams.append("resource",e));for(const[e,t]of Object.entries({response_mode:l,...w,...m}))null!=t&&S.searchParams.append(e,t.toString());return new e({url:S.href,state:_})}};KJ._logger=new Ir("SigninRequest");var nye=KJ,rye="openid",$E=class{constructor(e){if(this.access_token="",this.token_type="",this.profile={},this.state=e.get("state"),this.session_state=e.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(lA);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(lA))}this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri"),this.code=e.get("code")}get expires_in(){if(void 0!==this.expires_at)return this.expires_at-iC.getEpochTime()}set expires_in(e){"string"==typeof e&&(e=Number(e)),void 0!==e&&e>=0&&(this.expires_at=Math.floor(e)+iC.getEpochTime())}get isOpenId(){var e;return(null==(e=this.scope)?void 0:e.split(" ").includes(rye))||!!this.id_token}},iye=class{constructor({url:e,state_data:t,id_token_hint:n,post_logout_redirect_uri:r,extraQueryParams:i,request_type:o,client_id:s}){if(this._logger=new Ir("SignoutRequest"),!e)throw this._logger.error("ctor: No url passed"),new Error("url");const a=new URL(e);n&&a.searchParams.append("id_token_hint",n),s&&a.searchParams.append("client_id",s),r&&(a.searchParams.append("post_logout_redirect_uri",r),t&&(this.state=new sC({data:t,request_type:o}),a.searchParams.append("state",this.state.id)));for(const[e,t]of Object.entries({...i}))null!=t&&a.searchParams.append(e,t.toString());this.url=a.href}},sye=class{constructor(e){this.state=e.get("state"),this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri")}},oye=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],aye=["sub","iss","aud","exp","iat"],cye=class{constructor(e){this._settings=e,this._logger=new Ir("ClaimsService")}filterProtocolClaims(e){const t={...e};if(this._settings.filterProtocolClaims){let e;e=Array.isArray(this._settings.filterProtocolClaims)?this._settings.filterProtocolClaims:oye;for(const n of e)aye.includes(n)||delete t[n]}return t}mergeClaims(e,t){const n={...e};for(const[e,r]of Object.entries(t))if(n[e]!==r)if(Array.isArray(n[e])||Array.isArray(r))if("replace"==this._settings.mergeClaimsStrategy.array)n[e]=r;else{const t=Array.isArray(n[e])?n[e]:[n[e]];for(const e of Array.isArray(r)?r:[r])t.includes(e)||t.push(e);n[e]=t}else"object"==typeof n[e]&&"object"==typeof r?n[e]=this.mergeClaims(n[e],r):n[e]=r;return n}},lye=class{constructor(e,t){this.keys=e,this.nonce=t}},XP=class{constructor(e,t){this._logger=new Ir("OidcClient"),this.settings=e instanceof dA?e:new dA(e),this.metadataService=t??new qJ(this.settings),this._claimsService=new cye(this.settings),this._validator=new tye(this.settings,this.metadataService,this._claimsService),this._tokenClient=new GJ(this.settings,this.metadataService)}async createSigninRequest({state:e,request:t,request_uri:n,request_type:r,id_token_hint:i,login_hint:o,skipUserInfo:s,nonce:a,url_state:l,response_type:c=this.settings.response_type,scope:u=this.settings.scope,redirect_uri:d=this.settings.redirect_uri,prompt:h=this.settings.prompt,display:p=this.settings.display,max_age:f=this.settings.max_age,ui_locales:m=this.settings.ui_locales,acr_values:v=this.settings.acr_values,resource:g=this.settings.resource,response_mode:y=this.settings.response_mode,extraQueryParams:b=this.settings.extraQueryParams,extraTokenParams:w=this.settings.extraTokenParams,dpopJkt:_,omitScopeWhenRequesting:S=this.settings.omitScopeWhenRequesting}){const E=this._logger.create("createSigninRequest");if("code"!==c)throw new Error("Only the Authorization Code flow (with PKCE) is supported");const C=await this.metadataService.getAuthorizationEndpoint();E.debug("Received authorization endpoint",C);const k=await nye.create({url:C,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:d,response_type:c,scope:u,state_data:e,url_state:l,prompt:h,display:p,max_age:f,ui_locales:m,id_token_hint:i,login_hint:o,acr_values:v,dpopJkt:_,resource:g,request:t,request_uri:n,extraQueryParams:b,extraTokenParams:w,request_type:r,response_mode:y,client_secret:this.settings.client_secret,skipUserInfo:s,nonce:a,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:S});await this.clearStaleState();const T=k.state;return await this.settings.stateStore.set(T.id,T.toStorageString()),k}async readSigninResponseState(e,t=!1){const n=this._logger.create("readSigninResponseState"),r=new $E(V$.readParams(e,this.settings.response_mode));if(!r.state)throw n.throw(new Error("No state in response")),null;const i=await this.settings.stateStore[t?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await YP.fromStorageString(i),response:r}}async processSigninResponse(e,t){const n=this._logger.create("processSigninResponse"),{state:r,response:i}=await this.readSigninResponseState(e,!0);if(n.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){const e=await this.getDpopProof(this.settings.dpop.store);t={...t,DPoP:e}}try{await this._validator.validateSigninResponse(i,r,t)}catch(e){if(!(e instanceof uA&&this.settings.dpop))throw e;{const n=await this.getDpopProof(this.settings.dpop.store,e.nonce);t.DPoP=n,await this._validator.validateSigninResponse(i,r,t)}}return i}async getDpopProof(e,t){let n,r;return(await e.getAllKeys()).includes(this.settings.client_id)?(r=await e.get(this.settings.client_id),r.nonce!==t&&t&&(r.nonce=t,await e.set(this.settings.client_id,r))):(n=await Za.generateDPoPKeys(),r=new lye(n,t),await e.set(this.settings.client_id,r)),await Za.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:r.keys,nonce:r.nonce})}async processResourceOwnerPasswordCredentials({username:e,password:t,skipUserInfo:n=!1,extraTokenParams:r={}}){const i=await this._tokenClient.exchangeCredentials({username:e,password:t,...r}),o=new $E(new URLSearchParams);return Object.assign(o,i),await this._validator.validateCredentialsResponse(o,n),o}async useRefreshToken({state:e,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,extraTokenParams:o}){var s;const a=this._logger.create("useRefreshToken");let l,c;if(void 0===this.settings.refreshTokenAllowedScope)l=e.scope;else{const t=this.settings.refreshTokenAllowedScope.split(" ");l=((null==(s=e.scope)?void 0:s.split(" "))||[]).filter(e=>t.includes(e)).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){const e=await this.getDpopProof(this.settings.dpop.store);i={...i,DPoP:e}}try{c=await this._tokenClient.exchangeRefreshToken({refresh_token:e.refresh_token,scope:l,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,...o})}catch(s){if(!(s instanceof uA&&this.settings.dpop))throw s;i.DPoP=await this.getDpopProof(this.settings.dpop.store,s.nonce),c=await this._tokenClient.exchangeRefreshToken({refresh_token:e.refresh_token,scope:l,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,...o})}const u=new $E(new URLSearchParams);return Object.assign(u,c),a.debug("validating response",u),await this._validator.validateRefreshResponse(u,{...e,scope:l}),u}async createSignoutRequest({state:e,id_token_hint:t,client_id:n,request_type:r,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:o=this.settings.extraQueryParams}={}){const s=this._logger.create("createSignoutRequest"),a=await this.metadataService.getEndSessionEndpoint();if(!a)throw s.throw(new Error("No end session endpoint")),null;s.debug("Received end session endpoint",a),!n&&i&&!t&&(n=this.settings.client_id);const l=new iye({url:a,id_token_hint:t,client_id:n,post_logout_redirect_uri:i,state_data:e,extraQueryParams:o,request_type:r});await this.clearStaleState();const c=l.state;return c&&(s.debug("Signout request has state to persist"),await this.settings.stateStore.set(c.id,c.toStorageString())),l}async readSignoutResponseState(e,t=!1){const n=this._logger.create("readSignoutResponseState"),r=new sye(V$.readParams(e,this.settings.response_mode));if(!r.state){if(n.debug("No state in response"),r.error)throw n.warn("Response was error:",r.error),new Jg(r);return{state:void 0,response:r}}const i=await this.settings.stateStore[t?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await sC.fromStorageString(i),response:r}}async processSignoutResponse(e){const t=this._logger.create("processSignoutResponse"),{state:n,response:r}=await this.readSignoutResponseState(e,!0);return n?(t.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(r,n)):t.debug("No state from storage; skipping response validation"),r}clearStaleState(){return this._logger.create("clearStaleState"),sC.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(e,t){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:e,token_type_hint:t})}},Qi=function(e){return e.NotSupported="OIDC authentication not supported",e.Misconfigured="OIDC is misconfigured",e.General="Something went wrong with OIDC discovery",e.OpSupport="Configured OIDC OP does not support required functions",e.DynamicRegistrationNotSupported="Dynamic registration not supported",e.DynamicRegistrationFailed="Dynamic registration failed",e.DynamicRegistrationInvalid="Dynamic registration invalid response",e.CodeExchangeFailed="Failed to exchange code for token",e.InvalidBearerTokenResponse="Invalid bearer token response",e.InvalidIdToken="Invalid ID token",e.MissingOrInvalidStoredState="State required to finish logging in is not found in storage.",e}({}),JP=e=>!!e&&"object"==typeof e&&!Array.isArray(e),fu=(e,t)=>!(!e[t]||!Ey(e,t))||(M.error("Missing or invalid property: ".concat(t)),!1),Ey=(e,t)=>!e[t]||"string"==typeof e[t]||(M.error("Invalid property: ".concat(t)),!1),q$=(e,t)=>!!(!e[t]||Array.isArray(e[t])&&e[t].every(e=>"string"==typeof e))||(M.error("Invalid property: ".concat(t)),!1),Ck=(e,t,n)=>{var r=e[t];return!!(r&&Array.isArray(r)&&r.includes(n))||(M.error("Invalid property: ".concat(t,". ").concat(n," is required.")),!1)},WJ=e=>{if(!JP(e))throw M.error("Issuer configuration not found or malformed"),new Error(Qi.OpSupport);if(![fu(e,"issuer"),fu(e,"authorization_endpoint"),fu(e,"token_endpoint"),fu(e,"revocation_endpoint"),Ey(e,"registration_endpoint"),Ey(e,"account_management_uri"),Ey(e,"device_authorization_endpoint"),q$(e,"account_management_actions_supported"),Ck(e,"response_types_supported","code"),Ck(e,"grant_types_supported","authorization_code"),Ck(e,"code_challenge_methods_supported","S256"),q$(e,"prompt_values_supported")].some(e=>!e))return e;throw M.error("Issuer configuration not valid"),new Error(Qi.OpSupport)},YJ=e=>{try{return HJ(e)}catch(e){throw M.error("Could not decode id_token",e),e}},XJ=(e,t,n,r)=>{try{if(!e)throw new Error("No ID token");var i=YJ(e);if(i.iss!==t)throw new Error("Invalid issuer");if(!("string"==typeof i.aud?[i.aud]:i.aud).includes(n))throw new Error("Invalid audience");if(void 0!==r&&i.nonce!==r)throw new Error("Invalid nonce");if(!i.exp||Date.now()>1e3*i.exp)throw new Error("Invalid expiry")}catch(e){throw M.error("Invalid ID token",e),new Error(Qi.InvalidIdToken)}};function JJ(e){if(!JP(e))throw M.error("Stored user state not found"),new Error(Qi.MissingOrInvalidStoredState);if([fu(e,"homeserverUrl"),fu(e,"nonce"),Ey(e,"identityServerUrl")].some(e=>!e))throw new Error(Qi.MissingOrInvalidStoredState)}var uye=e=>JP(e)&&fu(e,"token_type")&&"bearer"===e.token_type.toLowerCase()&&fu(e,"access_token")&&fu(e,"refresh_token")&&(!("expires_in"in e)||"number"==typeof e.expires_in);function QJ(e){if(!uye(e))throw new Error(Qi.InvalidBearerTokenResponse)}function G$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function oC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var K3=e=>{var t=e??Eo(10);return"openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:".concat(t)},dye=function(){var e=B(function*(e){return globalThis.crypto.subtle?B3(yield BJ(e)):(M.warn("A secure context is required to generate code challenge. Using plain text code challenge"),e)});return function(t){return e.apply(this,arguments)}}(),fye=e=>{var{redirectUri:t}=e;return{scope:K3(),redirectUri:t,state:Eo(8),nonce:Eo(8),codeVerifier:Eo(64)}},hye=function(){var e=B(function*(e,t,n){var{scope:r,redirectUri:i,state:o,nonce:s,codeVerifier:a}=n,l=new URL(e);return l.searchParams.append("response_mode","query"),l.searchParams.append("response_type","code"),l.searchParams.append("redirect_uri",i),l.searchParams.append("client_id",t),l.searchParams.append("state",o),l.searchParams.append("scope",r),l.searchParams.append("nonce",s),l.searchParams.append("code_challenge_method","S256"),l.searchParams.append("code_challenge",yield dye(a)),l.toString()});return function(t,n,r){return e.apply(this,arguments)}}(),pye=function(){var e=B(function*(e){var{metadata:t,redirectUri:n,clientId:r,homeserverUrl:i,identityServerUrl:o,nonce:s,prompt:a,urlState:l,loginHint:c}=e,u=K3(),d=new XP(oC(oC({},t),{},{client_id:r,redirect_uri:n,authority:t.issuer,response_mode:"query",response_type:"code",scope:u,stateStore:new G3({prefix:"mx_oidc_",store:window.sessionStorage})})),h={homeserverUrl:i,nonce:s,identityServerUrl:o};return(yield d.createSigninRequest({state:h,nonce:s,prompt:a,url_state:l,login_hint:c})).url});return function(t){return e.apply(this,arguments)}}(),mye=e=>({id_token:e.id_token,scope:e.scope,expires_at:e.expires_at,refresh_token:e.refresh_token,access_token:e.access_token,token_type:"Bearer"}),gye=function(){var e=B(function*(e,t){var n=new URL(window.location.origin);n.searchParams.append("code",e),n.searchParams.append("state",t),ab.setLogger(M);try{var r=new $E(n.searchParams),i=new G3({prefix:"mx_oidc_",store:window.sessionStorage}),o=yield i.get(r.state);if(!o)throw new Error(Qi.MissingOrInvalidStoredState);var s=yield YP.fromStorageString(o),a=new XP(oC(oC({},s),{},{stateStore:i})),l=yield a.processSigninResponse(n.href),c=l.userState;JJ(c),QJ(l),XJ(l.id_token,a.settings.authority,a.settings.client_id,c.nonce);var u=mye(l);return{oidcClientSettings:{clientId:a.settings.client_id,issuer:a.settings.authority},tokenResponse:u,homeserverUrl:c.homeserverUrl,identityServerUrl:c.identityServerUrl,idTokenClaims:l.profile}}catch(e){M.error("Oidc login failed",e);var d=e.message;throw Object.values(Qi).includes(d)?e:new Error(Qi.CodeExchangeFailed)}});return function(t,n){return e.apply(this,arguments)}}();function K$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function z$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var QP=function(){var e=B(function*(e){var t=new URL(".well-known/openid-configuration",e),n=yield fetch(t,{method:le.Get,signal:F3(5e3)}),r=yield n.json();return ZP(r)});return function(t){return e.apply(this,arguments)}}(),ZP=function(){var e=B(function*(e){var t=WJ(e),n=new dA({authority:t.issuer,metadata:t,redirect_uri:"",client_id:""}),r=new qJ(n);return z$(z$({},t),{},{signingKeys:yield r.getSigningKeys()})});return function(t){return e.apply(this,arguments)}}(),vye="urn:ietf:params:oauth:grant-type:device_code",Tk=(e,t)=>{if(!t)return!1;var n=new URL(t);return!(n.protocol!==e.protocol||n.hostname!==e.hostname&&!n.hostname.endsWith(".".concat(e.hostname)))},yye=function(){var e=B(function*(e,t){if(!e.registration_endpoint)throw new Error(Qi.DynamicRegistrationNotSupported);var n=["authorization_code","refresh_token"];if(n.some(t=>!e.grant_types_supported.includes(t)))throw new Error(Qi.DynamicRegistrationNotSupported);var r=new URL(t.clientUri),i={client_name:t.clientName,client_uri:t.clientUri,response_types:["code"],grant_types:n,redirect_uris:t.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:t.applicationType,contacts:t.contacts,logo_uri:Tk(r,t.logoUri)?t.logoUri:void 0,policy_uri:Tk(r,t.policyUri)?t.policyUri:void 0,tos_uri:Tk(r,t.tosUri)?t.tosUri:void 0};try{var o=yield fetch(e.registration_endpoint,{method:le.Post,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)});if(o.status>=400)throw new Error(Qi.DynamicRegistrationFailed);var s=(yield o.json()).client_id;if(!s||"string"!=typeof s)throw new Error(Qi.DynamicRegistrationInvalid);return s}catch(e){throw Object.values(Qi).includes(e.message)?e:(M.error("Dynamic registration request failed",e),new Error(Qi.DynamicRegistrationFailed))}});return function(t,n){return e.apply(this,arguments)}}();class bye{constructor(e,t,n,r,i){this.idTokenClaims=i,P(this,"oidcClientReady",void 0),P(this,"oidcClient",void 0),P(this,"inflightRefreshRequest",void 0),this.oidcClientReady=this.initialiseOidcClient(e,t,r,n)}initialiseOidcClient(e,t,n,r){var i=this;return B(function*(){try{var o,s=yield QP(e),a=K3(n);i.oidcClient=new XP({metadata:s,signingKeys:null!==(o=s.signingKeys)&&void 0!==o?o:void 0,client_id:t,scope:a,redirect_uri:r,authority:s.issuer,stateStore:new G3({prefix:"mx_oidc_",store:window.sessionStorage})})}catch(e){throw M.error("Failed to initialise OIDC client.",e),new Error("Failed to initialise OIDC client.")}})()}doRefreshAccessToken(e){var t=this;return B(function*(){t.inflightRefreshRequest||(t.inflightRefreshRequest=t.getNewTokens(e));try{return yield t.inflightRefreshRequest}catch(e){throw e instanceof Jg?new MP(e):e}finally{t.inflightRefreshRequest=void 0}})()}persistTokens(e){return B(function*(){})()}getNewTokens(e){var t=this;return B(function*(){if(!t.oidcClient)throw new Error("Cannot get new token before OIDC client is initialised.");var n={refresh_token:e,session_state:"test",data:void 0,profile:t.idTokenClaims},r=Date.now(),i=yield t.oidcClient.useRefreshToken({state:n,timeoutInSeconds:300}),o={accessToken:i.access_token,refreshToken:i.refresh_token,expiry:i.expires_in?new Date(r+1e3*i.expires_in):void 0};return yield t.persistTokens(o),o})()}}var _ye=["server","limit","since"];function W$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Gr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Sye=3e3,Y$=6e5,Eye=new xr("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent"),Qg=function(e){return e.Chronological="chronological",e.Detached="detached",e}({}),wye=new e_("m.get_login_token","org.matrix.msc3882.get_login_token"),ZJ="uk.half-shot.msc2666",eQ="uk.half-shot.msc2666.mutual_rooms",tQ="uk.half-shot.msc2666.query_mutual_rooms",Bc="org.matrix.msc4140",nQ="uk.tcpip.msc4133",Ec="$",Le=function(e){return e.Sync="sync",e.Event="event",e.ToDeviceEvent="toDeviceEvent",e.ReceivedToDeviceMessage="receivedToDeviceMessage",e.AccountData="accountData",e.Room="Room",e.DeleteRoom="deleteRoom",e.SyncUnexpectedError="sync.unexpectedError",e.ClientWellKnown="WellKnown.client",e.ReceivedVoipEvent="received_voip_event",e.UndecryptableToDeviceEvent="toDeviceEvent.undecryptable",e.TurnServers="turnServers",e.TurnServersError="turnServers.error",e}({}),Cye=new xr("action","org.matrix.msc3824.action");class z3 extends Pn{constructor(e){var t,n,r,i;super(),r=this,P(this,"logger",void 0),P(this,"reEmitter",new Mv(this)),P(this,"olmVersion",null),P(this,"usingExternalCrypto",!1),P(this,"_store",void 0),P(this,"deviceId",void 0),P(this,"credentials",void 0),P(this,"legacyPickleKey",void 0),P(this,"scheduler",void 0),P(this,"clientRunning",!1),P(this,"timelineSupport",!1),P(this,"urlPreviewCache",{}),P(this,"identityServer",void 0),P(this,"http",void 0),P(this,"cryptoBackend",void 0),P(this,"cryptoCallbacks",void 0),P(this,"callEventHandler",void 0),P(this,"groupCallEventHandler",void 0),P(this,"supportsCallTransfer",!1),P(this,"forceTURN",!1),P(this,"iceCandidatePoolSize",0),P(this,"idBaseUrl",void 0),P(this,"baseUrl",void 0),P(this,"isVoipWithNoMediaAllowed",void 0),P(this,"useLivekitForGroupCalls",void 0),P(this,"canSupportVoip",!1),P(this,"peekSync",null),P(this,"isGuestAccount",!1),P(this,"ongoingScrollbacks",{}),P(this,"notifTimelineSet",null),P(this,"legacyCryptoStore",void 0),P(this,"verificationMethods",void 0),P(this,"fallbackICEServerAllowed",!1),P(this,"syncApi",void 0),P(this,"roomNameGenerator",void 0),P(this,"pushRules",void 0),P(this,"syncLeftRoomsPromise",void 0),P(this,"syncedLeftRooms",!1),P(this,"clientOpts",void 0),P(this,"clientWellKnownIntervalID",void 0),P(this,"canResetTimelineCallback",void 0),P(this,"canSupport",new Map),P(this,"pushProcessor",new Fa(this)),P(this,"serverVersionsPromise",void 0),P(this,"clientWellKnown",void 0),P(this,"clientWellKnownPromise",void 0),P(this,"turnServers",[]),P(this,"turnServersExpiry",0),P(this,"checkTurnServersIntervalID",void 0),P(this,"txnCtr",0),P(this,"mediaHandler",new g0e(this)),P(this,"sessionId",void 0),P(this,"eventsBeingEncrypted",new Set),P(this,"useE2eForGroupCall",!0),P(this,"toDeviceMessageQueue",void 0),P(this,"livekitServiceURL",void 0),P(this,"_secretStorage",void 0),P(this,"ignoredInvites",void 0),P(this,"matrixRTC",void 0),P(this,"serverCapabilitiesService",void 0),P(this,"startCallEventHandler",()=>{this.isInitialSyncComplete()&&(Q5()&&(this.callEventHandler.start(),this.groupCallEventHandler.start()),this.off(Le.Sync,this.startCallEventHandler))}),P(this,"startMatrixRTC",()=>{this.isInitialSyncComplete()&&(this.matrixRTC.start(),this.off(Le.Sync,this.startMatrixRTC))}),P(this,"fixupRoomNotifications",()=>{if(this.isInitialSyncComplete()){var e,t=(null!==(e=this.getRooms())&&void 0!==e?e:[]).filter(e=>e.getUnreadNotificationCount(zt.Total)>0);for(var n of t){var r=this.getSafeUserId();n.fixupNotifications(r)}this.off(Le.Sync,this.fixupRoomNotifications)}}),this.logger=null!==(t=e.logger)&&void 0!==t?t:M,e.baseUrl=lk(e.baseUrl),e.idBaseUrl=lk(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=null!==(n=e.usingExternalCrypto)&&void 0!==n&&n,this.store=e.store||new b1e,this.deviceId=e.deviceId||null,this.sessionId=Eo(10);var o,s=e.userId||null;this.credentials={userId:s},this.http=new mJ(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,refreshToken:e.refreshToken,tokenRefreshFunction:e.tokenRefreshFunction,prefix:Kr.V3,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader,logger:this.logger}),e.pickleKey&&(this.legacyPickleKey=e.pickleKey),this.useLivekitForGroupCalls=!!e.useLivekitForGroupCalls,this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction((o=B(function*(e){var t=r.getRoom(e.getRoomId());e.status!==ot.SENDING&&r.updatePendingEventStatus(t,e,ot.SENDING);var n=yield r.sendEventHttpRequest(e);return t&&t.updatePendingEvent(e,ot.SENT,n.event_id),n}),function(e){return o.apply(this,arguments)})),Q5()&&(this.callEventHandler=new j1e(this),this.groupCallEventHandler=new F1e(this),this.canSupportVoip=!0,this.on(Le.Sync,this.startCallEventHandler)),this.matrixRTC=new H0e(this.logger,this),this.serverCapabilitiesService=new vJ(this.logger,this.http),this.on(Le.Sync,this.fixupRoomNotifications),this.timelineSupport=!!e.timelineSupport,this.legacyCryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.isVoipWithNoMediaAllowed=e.isVoipWithNoMediaAllowed||!1,void 0!==e.useE2eForGroupCall&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.livekitServiceURL=e.livekitServiceURL,this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new C0e(this,this.logger),this.on(qt.Decrypted,e=>{rQ(this,e)}),this.ignoredInvites=new T0e(this),this._secretStorage=new DJ(this,null!==(i=e.cryptoCallbacks)&&void 0!==i?i:{}),this.setMaxListeners(0)}set store(e){this._store=e,this._store.setUserCreator(e=>mu.createUser(e,this))}get store(){return this._store}startClient(e){var t=this;return B(function*(){if(!t.clientRunning){t.clientRunning=!0,t.on(Le.Sync,t.startMatrixRTC);var n=t.getUserId();n&&t.store.storeUser(new mu(n)),t.canSupportVoip&&(t.checkTurnServersIntervalID=setInterval(()=>{t.checkTurnServers()},Y$),t.checkTurnServers()),t.syncApi&&(t.logger.error("Still have sync object whilst not running: stopping old one"),t.syncApi.stop());try{yield t.getVersions();var{threads:r,list:i,fwdPagination:o}=yield t.doesServerSupportThread();Mn.setServerSideSupport(r),Mn.setServerSideListSupport(i),Mn.setServerSideFwdPaginationSupport(o)}catch(e){t.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",e)}t.clientOpts=e??{},t.clientOpts.slidingSync?t.syncApi=new LJ(t.clientOpts.slidingSync,t,t.clientOpts,t.buildSyncApiOptions()):t.syncApi=new Hd(t,t.clientOpts,t.buildSyncApiOptions()),t.syncApi.sync().catch(e=>t.logger.info("Sync startup aborted with an error:",e)),void 0!==t.clientOpts.clientWellKnownPollPeriod&&(t.clientWellKnownIntervalID=setInterval(()=>{t.fetchClientWellKnown()},1e3*t.clientOpts.clientWellKnownPollPeriod),t.fetchClientWellKnown()),t.toDeviceMessageQueue.start(),t.serverCapabilitiesService.start()}})()}buildSyncApiOptions(){return{cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(e),logger:this.logger.getChild("sync")}}stopClient(){var e,t,n,r,i;null===(e=this.cryptoBackend)||void 0===e||e.stop(),this.off(Le.Sync,this.startMatrixRTC),this.clientRunning&&(this.logger.debug("stopping MatrixClient"),this.clientRunning=!1,null===(t=this.syncApi)||void 0===t||t.stop(),this.syncApi=void 0,null===(n=this.peekSync)||void 0===n||n.stopPeeking(),null===(r=this.callEventHandler)||void 0===r||r.stop(),null===(i=this.groupCallEventHandler)||void 0===i||i.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,globalThis.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,void 0!==this.clientWellKnownIntervalID&&globalThis.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop(),this.matrixRTC.stop(),this.serverCapabilitiesService.stop())}clearStores(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.clientRunning)throw new Error("Cannot clear stores while client is running");var n=[];n.push(this.store.deleteAllData()),this.legacyCryptoStore&&n.push(this.legacyCryptoStore.deleteAllData());var r,i=(r=B(function*(){var n;try{if(!(n=globalThis.indexedDB))return}catch{return}var r=function*(t){var r=new Promise((r,i)=>{e.logger.info("Removing IndexedDB instance ".concat(t));var o=n.deleteDatabase(t);o.onsuccess=n=>{e.logger.info("Removed IndexedDB instance ".concat(t)),r(0)},o.onerror=n=>{e.logger.warn("Failed to remove IndexedDB instance ".concat(t,":"),n),r(0)},o.onblocked=n=>{e.logger.info("cannot yet remove IndexedDB instance ".concat(t))}});yield r};for(var i of["".concat(null!==(o=t.cryptoDatabasePrefix)&&void 0!==o?o:_k,"::matrix-sdk-crypto"),"".concat(null!==(s=t.cryptoDatabasePrefix)&&void 0!==s?s:_k,"::matrix-sdk-crypto-meta")]){var o,s;yield*r(i)}}),function(){return r.apply(this,arguments)});return n.push(i()),Promise.all(n).then()}getUserId(){var e,t;return null!==(e=null===(t=this.credentials)||void 0===t?void 0:t.userId)&&void 0!==e?e:null}getSafeUserId(){var e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){var e;return null!==(e=this.credentials)&&void 0!==e&&e.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){var e,t;return null!==(e=null===(t=this.credentials)||void 0===t||null===(t=t.userId)||void 0===t?void 0:t.split(":")[0].substring(1))&&void 0!==e?e:null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return sb(this,e)}createGroupCall(e,t,n,r,i,o){var s=this;return B(function*(){if(s.getGroupCallForRoom(e))throw new Error("".concat(e," already has an existing group call"));var a=s.getRoom(e);if(!a)throw new Error("Cannot find room ".concat(e));return new $P(s,a,t,n,r,void 0,i||s.isVoipWithNoMediaAllowed,o,s.isVoipWithNoMediaAllowed,s.useLivekitForGroupCalls,s.livekitServiceURL).create()})()}getLivekitServiceURL(){return this.livekitServiceURL}setLivekitServiceURL(e){this.livekitServiceURL=e}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e,t;return null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.getSyncState())&&void 0!==e?e:null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){var e=this.getSyncState();return!!e&&(e===Vt.Prepared||e===Vt.Syncing)}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e,t;return this.toDeviceMessageQueue.sendQueue(),null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.retryImmediately())&&void 0!==e&&e}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(){var e=this;return B(function*(){return e.serverCapabilitiesService.getCachedCapabilities()||e.serverCapabilitiesService.fetchCapabilities()})()}getCachedCapabilities(){return this.serverCapabilitiesService.getCachedCapabilities()}fetchCapabilities(){return this.serverCapabilitiesService.fetchCapabilities()}initRustCrypto(){var e=arguments,t=this;return B(function*(){var n,r,i=e.length>0&&void 0!==e[0]?e[0]:{};if(t.cryptoBackend)t.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");else{var o=t.getUserId();if(null===o)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");var s=t.getDeviceId();if(null===s)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");t.logger.debug("Downloading Rust crypto library");var a=yield nb(()=>import("./index-vmZlFGtO.js"),__vite__mapDeps([0,1]),import.meta.url),l=yield a.initRustCrypto({logger:t.logger,http:t.http,userId:o,deviceId:s,secretStorage:t.secretStorage,cryptoCallbacks:t.cryptoCallbacks,storePrefix:!1===i.useIndexedDB?null:null!==(n=i.cryptoDatabasePrefix)&&void 0!==n?n:_k,storeKey:i.storageKey,storePassphrase:i.storagePassword,legacyCryptoStore:t.legacyCryptoStore,legacyPickleKey:null!==(r=t.legacyPickleKey)&&void 0!==r?r:"DEFAULT_KEY",legacyMigrationProgressListener:(e,n)=>{t.emit(ui.LegacyCryptoStoreMigrationProgress,e,n)}});l.setSupportedVerificationMethods(t.verificationMethods),t.cryptoBackend=l,t.on(Ns.Membership,l.onRoomMembership.bind(l)),t.on(Le.Event,e=>{l.onLiveEventFromSync(e)}),t.reEmitter.reEmit(l,[ui.VerificationRequestReceived,ui.UserTrustStatusChanged,ui.KeyBackupStatus,ui.KeyBackupSessionsRemaining,ui.KeyBackupFailed,ui.KeyBackupDecryptionKeyCached,ui.KeysChanged,ui.DevicesUpdated,ui.WillUpdateDevices,ui.DehydratedDeviceCreated,ui.DehydratedDeviceUploaded,ui.RehydrationStarted,ui.RehydrationProgress,ui.RehydrationCompleted,ui.RehydrationError,ui.DehydrationKeyCached,ui.DehydratedDeviceRotationError])}})()}get secretStorage(){return this._secretStorage}getCrypto(){return this.cryptoBackend}isRoomEncrypted(e){var t=this.getRoom(e);return!!t&&t.hasEncryptionStateEvent()}isKeyBackupKeyStored(){return Promise.resolve(this.secretStorage.isStored("m.megolm_backup.v1"))}makeKeyBackupPath(e,t,n){return{path:void 0!==t?Ae("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?Ae("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",queryData:void 0===n?void 0:{version:n}}}deleteKeysFromBackup(e,t,n){var r=this;return B(function*(){var i=r.makeKeyBackupPath(e,t,n);yield r.http.authedRequest(le.Delete,i.path,i.queryData,void 0,{prefix:Kr.V3})})()}getMediaConfig(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?"/media/config":"/config";return this.http.authedRequest(le.Get,t,void 0,void 0,{prefix:e?Kr.V1:vg.V3})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.store.getRooms(),n=new Set;for(var r of t){var i,o=null===(i=r.findPredecessor(e))||void 0===i?void 0:i.roomId;o&&n.add(o)}return t.filter(e=>!(e.currentState.getStateEvents(ee.RoomTombstone,"")&&n.has(e.roomId)))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,t){var n=this;return B(function*(){if(!n.clientRunning)return n.logger.warn("Calling `setAccountData` before the client is started: `getAccountData` may return inconsistent results."),yield V5(5,()=>n.setAccountDataRaw(e,t));var r=n.store.getAccountData(e);if(r&&df(r.event.content,t))return{};var i=Promise.withResolvers();function o(t){t.getType()===e&&i.resolve()}n.addListener(Le.AccountData,o);try{var s=yield V5(5,()=>n.setAccountDataRaw(e,t));return yield i.promise,s}finally{n.removeListener(Le.AccountData,o)}})()}setAccountDataRaw(e,t){var n=Ae("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return this.http.authedRequest(le.Put,n,void 0,t)}getAccountData(e){return this.store.getAccountData(e)}getAccountDataFromServer(e){var t=this;return B(function*(){if(t.isInitialSyncComplete()){var n=t.store.getAccountData(e);return n?n.getContent():null}var r=Ae("/user/$userId/account_data/$type",{$userId:t.credentials.userId,$type:e});try{return yield t.http.authedRequest(le.Get,r)}catch(e){var i;if("M_NOT_FOUND"===(null===(i=e.data)||void 0===i?void 0:i.errcode))return null;throw e}})()}deleteAccountData(e){var t=this;return B(function*(){var n=t.canSupport.get(Xr.AccountDataDeletion);if(n!==Yr.Unsupported){var r=Ae("/user/$userId/account_data/$type",{$userId:t.getSafeUserId(),$type:e}),i=n===Yr.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return yield t.http.authedRequest(le.Delete,r,void 0,void 0,i)}yield t.setAccountData(e,{})})()}getIgnoredUsers(){var e=this.getAccountData(ee.IgnoredUserList);return null!=e&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e){var t={ignored_users:{}};return e.forEach(e=>{t.ignored_users[e]={}}),this.setAccountData(ee.IgnoredUserList,t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}joinRoom(e){var t=arguments,n=this;return B(function*(){var r,i,o=t.length>1&&void 0!==t[1]?t[1]:{},s=n.getRoom(e),a=null==s?void 0:s.getMember(n.getSafeUserId()),l=null==a?void 0:a.membership,c=l==Ve.Invite&&null!==(r=null==a||null===(i=a.events.member)||void 0===i?void 0:i.getSender())&&void 0!==r?r:null;if(n.logger.debug("joinRoom[".concat(e,"]: preJoinMembership=").concat(l,", inviter=").concat(c,", opts=").concat(JSON.stringify(o))),l==Ve.Join)return s;var u=Promise.resolve();if(o.inviteSignUrl){var d=new URL(o.inviteSignUrl);d.searchParams.set("mxid",n.credentials.userId),u=n.http.requestOtherUrl(le.Post,d)}var h={};o.viaServers&&(h.server_name=o.viaServers,h.via=o.viaServers);var p={},f=yield u;f&&(p.third_party_signed=f);var m=Ae("/join/$roomid",{$roomid:e}),v=(yield n.http.authedRequest(le.Post,m,h,p)).room_id;o.acceptSharedHistory&&c&&n.cryptoBackend&&(yield n.cryptoBackend.maybeAcceptKeyBundle(v,c));var g=n.getRoom(v);return null!=g&&g.hasMembershipState(n.credentials.userId,Ve.Join)?g:new Hd(n,n.clientOpts,n.buildSyncApiOptions()).createRoom(v)})()}knockRoom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRoom(e);if(null!=n&&n.hasMembershipState(this.credentials.userId,Ve.Knock))return Promise.resolve({room_id:n.roomId});var r=Ae("/knock/$roomIdOrAlias",{$roomIdOrAlias:e}),i={};t.viaServers&&(i.server_name=t.viaServers,i.via=t.viaServers);var o={};return t.reason&&(o.reason=t.reason),this.http.authedRequest(le.Post,r,i,o)}resendEvent(e,t){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(t,e,ot.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if(![ot.QUEUED,ot.NOT_SENT,ot.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===ot.ENCRYPTING?this.eventsBeingEncrypted.delete(e.getId()):this.scheduler&&e.status===ot.QUEUED&&this.scheduler.removeEventFromQueue(e);var t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,ot.CANCELLED)}setRoomName(e,t){return this.sendStateEvent(e,ee.RoomName,{name:t})}setRoomTopic(e,t,n){var r=iJ(t,n);return this.sendStateEvent(e,ee.RoomTopic,r)}getRoomTags(e){var t=Ae("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(le.Get,t)}setRoomTag(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Ae("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(le.Put,r,void 0,n)}deleteRoomTag(e,t){var n=Ae("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(le.Delete,n)}setRoomAccountData(e,t,n){var r=Ae("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(le.Put,r,void 0,n)}setPowerLevel(e,t,n){var r=this;return B(function*(){var i,o,s;r.clientRunning&&r.isInitialSyncComplete()&&(o=null===(s=r.getRoom(e))||void 0===s||null===(s=s.currentState)||void 0===s||null===(s=s.getStateEvents(ee.RoomPowerLevels,""))||void 0===s?void 0:s.getContent());if(!o)try{o=yield r.getStateEvent(e,ee.RoomPowerLevels,"")}catch(e){if(!(e instanceof nr&&"M_NOT_FOUND"===e.errcode))throw e;o={}}null!==(i=o=i_(o))&&void 0!==i&&i.users||(o.users={});var a=Array.isArray(t)?t:[t];for(var l of a)null==n?delete o.users[l]:o.users[l]=n;return r.sendStateEvent(e,ee.RoomPowerLevels,o,"")})()}unstable_createLiveBeacon(e,t){var n=this;return B(function*(){return n.unstable_setLiveBeacon(e,t)})()}unstable_setLiveBeacon(e,t){var n=this;return B(function*(){return n.sendStateEvent(e,qP.name,t,n.getUserId())})()}sendEvent(e,t,n,r,i){var o,s,a,l;return null!=t&&t.startsWith(Ec)||null===t?(l=i,a=r,s=n,o=t):(l=r,a=n,s=t,o=null),this.addThreadRelationIfNeeded(a,o,e),this.sendCompleteEvent(e,o,{type:s,content:a},l)}addThreadRelationIfNeeded(e,t,n){var r;if(t&&(null===(r=e["m.relates_to"])||void 0===r||!r.rel_type)){var i,o,s=!(null===(i=e["m.relates_to"])||void 0===i||!i["m.in_reply_to"]);e["m.relates_to"]=Gr(Gr({},e["m.relates_to"]),{},{rel_type:yn.name,event_id:t,is_falling_back:!s});var a,l,c=null===(o=this.getRoom(n))||void 0===o?void 0:o.getThread(t);if(c&&!s)e["m.relates_to"]["m.in_reply_to"]={event_id:null!==(a=null===(l=c.lastReply(e=>e.isRelation(yn.name)&&!e.status))||void 0===l?void 0:l.getId())&&void 0!==a?a:t}}}sendCompleteEvent(e,t,n,r,i){var o,s;"string"==typeof r?s=r:(o=r,s=i),s||(s=this.makeTxnId());var a=new Zi(Object.assign(n,{event_id:"~"+e+":"+s,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),l=this.getRoom(e),c=t?null==l?void 0:l.getThread(t):void 0;c&&a.setThread(c),o||(this.reEmitter.reEmit(a,[qt.Replaced,qt.VisibilityChange]),null==l||l.reEmitter.reEmit(a,[qt.BeforeRedaction]));var u=a.getAssociatedId();if(null!=u&&u.startsWith("~")){var d=null==l?void 0:l.getPendingEvents().find(e=>e.getId()===u);null==d||d.once(qt.LocalEventIdReplaced,()=>{a.updateAssociatedId(d.getId())})}var h=a.getType();return this.logger.debug("sendEvent of type ".concat(h," in ").concat(e," with txnId ").concat(s).concat(o?" (delayed event)":"")),a.setTxnId(s),a.setStatus(ot.SENDING),o?this.encryptAndSendEvent(l,a,o):(null==l||l.addPendingEvent(a,s),a.status===ot.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(l,a))}encryptAndSendEvent(e,t,n){var r=this;return B(function*(){if(n)return r.sendEventHttpRequest(t,n);try{var i;r.eventsBeingEncrypted.add(t.getId());try{yield r.encryptEventIfNeeded(t,e??void 0)}finally{i=!r.eventsBeingEncrypted.delete(t.getId())}if(i)return{};t.status===ot.ENCRYPTING&&r.updatePendingEventStatus(e,t,ot.SENDING);var o=null;return r.scheduler&&((o=r.scheduler.queueEvent(t))&&r.scheduler.getQueueForEvent(t).length>1&&r.updatePendingEventStatus(e,t,ot.QUEUED)),o||(o=r.sendEventHttpRequest(t),e&&(o=o.then(n=>(e.updatePendingEvent(t,ot.SENT,n.event_id),n)))),yield o}catch(n){r.logger.error("Error sending event",n);try{t.error=n,r.updatePendingEventStatus(e,t,ot.NOT_SENT)}catch(e){r.logger.error("Exception in error handler!",e)}throw n instanceof nr&&(n.event=t),n}})()}encryptEventIfNeeded(e,t){var n=this;return B(function*(){if(t&&(yield n.shouldEncryptEventForRoom(e,t))&&(n.cryptoBackend||!n.usingExternalCrypto)){if(!n.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");n.updatePendingEventStatus(t,e,ot.ENCRYPTING),yield n.cryptoBackend.encryptEvent(e,t)}})()}shouldEncryptEventForRoom(e,t){var n=this;return B(function*(){var r;return!e.isEncrypted()&&e.getType()!==ee.Reaction&&!e.isRedaction()&&!(!t.hasEncryptionStateEvent()&&!(yield null===(r=n.cryptoBackend)||void 0===r?void 0:r.isEncryptionEnabledInRoom(t.roomId)))})()}getEncryptedIfNeededEventType(e,t){var n;return t===ee.Reaction?t:null!==(n=this.getRoom(e))&&void 0!==n&&n.hasEncryptionStateEvent()?ee.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}sendEventHttpRequest(e,t){var n=e.getTxnId();n||(n=this.makeTxnId(),e.setTxnId(n));var r,i={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:n};if(e.isState()){var o="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(o="/rooms/$roomId/state/$eventType/$stateKey"),r=Ae(o,i)}else if(e.isRedaction()&&e.event.redacts){r=Ae("/rooms/$roomId/redact/$redactsEventId/$txnId",Gr({$redactsEventId:e.event.redacts},i))}else r=Ae("/rooms/$roomId/send/$eventType/$txnId",i);var s=e.getWireContent();return t?this.http.authedRequest(le.Put,r,X$(t),s):this.http.authedRequest(le.Put,r,void 0,s).then(t=>(this.logger.debug("Event sent to ".concat(e.getRoomId()," with event id ").concat(t.event_id)),t))}redactEvent(e,t,n,r,i){var o,s,a;null!==(o=n)&&void 0!==o&&o.startsWith(Ec)||(i=r,r=n,n=t,t=null);var l={reason:null===(s=i)||void 0===s?void 0:s.reason};if(void 0!==(null===(a=i)||void 0===a?void 0:a.with_rel_types)){if(this.canSupport.get(Xr.RelationBasedRedactions)===Yr.Unsupported)throw new Error("Server does not support relation based redactions "+"roomId ".concat(e," eventId ").concat(n," txnId: ").concat(r," threadId ").concat(t));l[this.canSupport.get(Xr.RelationBasedRedactions)===Yr.Stable?U5.stable:U5.unstable]=i.with_rel_types}return this.sendCompleteEvent(e,t,{type:ee.RoomRedaction,content:l,redacts:n},r)}sendMessage(e,t,n,r){"string"!=typeof t&&null!==t&&(r=n,n=t,t=null);var i=ee.RoomMessage,o=n;return this.sendEvent(e,t,i,o,r)}sendTextMessage(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Ec))&&null!==t&&(r=n,n=t,t=null);var o=ZX(n);return this.sendMessage(e,t,o,r)}sendNotice(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Ec))&&null!==t&&(r=n,n=t,t=null);var o=eJ(n);return this.sendMessage(e,t,o,r)}sendEmoteMessage(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Ec))&&null!==t&&(r=n,n=t,t=null);var o=tJ(n);return this.sendMessage(e,t,o,r)}sendImageMessage(e,t,n,r){var i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Image";(null===(i=t)||void 0===i||!i.startsWith(Ec))&&null!==t&&(o=r||"Image",r=n,n=t,t=null);var s={msgtype:cl.Image,url:n,info:r,body:o};return this.sendMessage(e,t,s)}sendStickerMessage(e,t,n,r){var i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Sticker";(null===(i=t)||void 0===i||!i.startsWith(Ec))&&null!==t&&(o=r||"Sticker",r=n,n=t,t=null);var s={url:n,info:r,body:o};return this.sendEvent(e,t,ee.Sticker,s)}sendHtmlMessage(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Ec))&&null!==t&&(r=n,n=t,t=null);var o=XX(n,r);return this.sendMessage(e,t,o)}sendHtmlNotice(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Ec))&&null!==t&&(r=n,n=t,t=null);var o=JX(n,r);return this.sendMessage(e,t,o)}sendHtmlEmote(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Ec))&&null!==t&&(r=n,n=t,t=null);var o=QX(n,r);return this.sendMessage(e,t,o)}_unstable_sendDelayedEvent(e,t,n,r,i,o){var s=this;return B(function*(){if(!(yield s.doesServerSupportUnstableFeature(Bc)))throw new qd("Server does not support the delayed events API","sendDelayedEvent");return s.addThreadRelationIfNeeded(i,n,e),s.sendCompleteEvent(e,n,{type:r,content:i},t,o)})()}_unstable_sendDelayedStateEvent(e,t,n,r){var i=arguments,o=this;return B(function*(){var s=i.length>4&&void 0!==i[4]?i[4]:"",a=i.length>5&&void 0!==i[5]?i[5]:{};if(!(yield o.doesServerSupportUnstableFeature(Bc)))throw new qd("Server does not support the delayed events API","sendDelayedStateEvent");var l={$roomId:e,$eventType:n,$stateKey:s},c=Ae("/rooms/$roomId/state/$eventType",l);return void 0!==s&&(c=Ae(c+"/$stateKey",l)),o.http.authedRequest(le.Put,c,X$(t),r,a)})()}_unstable_getDelayedEvents(e){var t=this;return B(function*(){if(!(yield t.doesServerSupportUnstableFeature(Bc)))throw new qd("Server does not support the delayed events API","getDelayedEvents");var n=e?{from:e}:void 0;return yield t.http.authedRequest(le.Get,"/delayed_events",n,void 0,{prefix:"".concat(Kr.Unstable,"/").concat(Bc)})})()}_unstable_updateDelayedEvent(e,t){var n=arguments,r=this;return B(function*(){var i=n.length>2&&void 0!==n[2]?n[2]:{};if(!(yield r.doesServerSupportUnstableFeature(Bc)))throw new qd("Server does not support the delayed events API","updateDelayedEvent");var o=Ae("/delayed_events/$delayId",{$delayId:e}),s={action:t};return yield r.http.authedRequest(le.Post,o,void 0,s,Gr(Gr({},i),{},{prefix:"".concat(Kr.Unstable,"/").concat(Bc)}))})()}sendReceipt(e,t,n){var r=arguments,i=this;return B(function*(){var o=r.length>3&&void 0!==r[3]&&r[3];if(i.isGuest())return Promise.resolve({});var s=Ae("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),a=!o&&i.supportsThreads()?Gr(Gr({},n),{},{thread_id:Zg(e)}):n,l=i.http.authedRequest(le.Post,s,void 0,a||{}),c=i.getRoom(e.getRoomId());return c&&i.credentials.userId&&c.addLocalEchoReceipt(i.credentials.userId,e,t,o),l})()}sendReadReceipt(e){var t=arguments,n=this;return B(function*(){var r=t.length>1&&void 0!==t[1]?t[1]:os.Read,i=t.length>2&&void 0!==t[2]&&t[2];if(e){var o=e.getId(),s=n.getRoom(e.getRoomId());if(null!=s&&s.hasPendingEvent(o))throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));return n.sendReceipt(e,r,{},i)}})()}setRoomReadMarkers(e,t,n,r){var i=this;return B(function*(){var o,s,a=i.getRoom(e);if(null!=a&&a.hasPendingEvent(t))throw new Error("Cannot set read marker to a pending event (".concat(t,")"));if(n){if(o=n.getId(),null!=a&&a.hasPendingEvent(o))throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));null==a||a.addLocalEchoReceipt(i.credentials.userId,n,os.Read)}if(r){if(s=r.getId(),null!=a&&a.hasPendingEvent(s))throw new Error("Cannot set read receipt to a pending event (".concat(s,")"));null==a||a.addLocalEchoReceipt(i.credentials.userId,r,os.ReadPrivate)}return yield i.setRoomReadMarkersHttpRequest(e,t,o,s)})()}getUrlPreview(e,t){t=6e4*Math.floor(t/6e4);var n=new URL(e);n.hash="";var r=t+"_"+(e=n.toString());if(r in this.urlPreviewCache)return this.urlPreviewCache[r];var i=this.http.authedRequest(le.Get,"/preview_url",{url:e,ts:t.toString()},void 0,{prefix:vg.V3,priority:"low"});return this.urlPreviewCache[r]=i,i}sendTyping(e,t,n){if(this.isGuest())return Promise.resolve({});var r=Ae("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),i={typing:t};return t&&(i.timeout=n||2e4),this.http.authedRequest(le.Put,r,void 0,i)}getRoomUpgradeHistory(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.getRoom(e);return r?[...this.findPredecessorRooms(r,t,n),r,...this.findSuccessorRooms(r,t,n)]:[]}findPredecessorRooms(e,t,n){for(var r,i=[],o=new Set([e.roomId]),s=null===(r=e.findPredecessor(n))||void 0===r?void 0:r.roomId;null!==s;){var a;if(s){if(o.has(s))break;o.add(s)}var l=this.getRoom(s);if(null===l)break;if(t){var c=l.currentState.getStateEvents(ee.RoomTombstone,"");if(!c||c.getContent().replacement_room!==e.roomId)break}i.splice(0,0,l),s=null===(a=(e=l).findPredecessor(n))||void 0===a?void 0:a.roomId}return i}findSuccessorRooms(e,t,n){for(var r=[],i=e.currentState.getStateEvents(ee.RoomTombstone,"");i;){var o=this.getRoom(i.getContent().replacement_room);if(!o||o.roomId===e.roomId)break;if(t){var s,a=null===(s=o.findPredecessor(n))||void 0===s?void 0:s.roomId;if(!a||a!==e.roomId)break}if(r.push(o),new Set(r.map(e=>e.roomId)).size<r.length)return r.slice(0,r.length-1);i=(e=o).currentState.getStateEvents(ee.RoomTombstone,"")}return r}invite(e,t){var n=arguments,r=this;return B(function*(){var i,o=n.length>2&&void 0!==n[2]?n[2]:{};("object"!=typeof o&&(o={reason:o}),o.shareEncryptedHistory)&&(yield null===(i=r.cryptoBackend)||void 0===i?void 0:i.shareRoomHistoryWithUser(e,t));return yield r.membershipChange(e,t,Ve.Invite,o.reason)})()}inviteByEmail(e,t){return this.inviteByThreePid(e,"email",t)}inviteByThreePid(e,t,n){var r=this;return B(function*(){var i,o=Ae("/rooms/$roomId/invite",{$roomId:e}),s=r.getIdentityServerUrl(!0);if(!s)return Promise.reject(new nr({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));var a={id_server:s,medium:t,address:n};if(null!==(i=r.identityServer)&&void 0!==i&&i.getAccessToken){var l=yield r.identityServer.getAccessToken();l&&(a.id_access_token=l)}return r.http.authedRequest(le.Post,o,void 0,a)})()}leave(e){return this.membershipChange(e,void 0,Ve.Leave)}leaveRoomChain(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getRoomUpgradeHistory(e),r=n;if(!t)for(var i of(r=[],n))if(r.push(i),i.roomId===e)break;var o={},s=[],a=e=>this.leave(e).then(()=>{delete o[e]}).catch(t=>{o[e]=t});for(var l of r)s.push(a(l.roomId));return Promise.all(s).then(()=>o)}ban(e,t,n){return this.membershipChange(e,t,Ve.Ban,n)}forget(e){var t=arguments,n=this;return B(function*(){var r=!(t.length>1&&void 0!==t[1])||t[1],i=Ae("/rooms/$room_id/forget",{$room_id:e}),o=yield n.http.authedRequest(le.Post,i);return r&&(n.store.removeRoom(e),n.emit(Le.DeleteRoom,e)),o})()}unban(e,t){var n=Ae("/rooms/$roomId/unban",{$roomId:e}),r={user_id:t};return this.http.authedRequest(le.Post,n,void 0,r)}kick(e,t,n){var r=Ae("/rooms/$roomId/kick",{$roomId:e}),i={user_id:t,reason:n};return this.http.authedRequest(le.Post,r,void 0,i)}membershipChange(e,t,n,r){var i=Ae("/rooms/$room_id/$membership",{$room_id:e,$membership:n});return this.http.authedRequest(le.Post,i,void 0,{user_id:t,reason:r})}getPushActionsForEvent(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.getPushActions()||t){var{actions:n,rule:r}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(n,r)}return e.getPushActions()}getPushDetailsForEvent(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.getPushDetails()||t){var{actions:n,rule:r}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(n,r)}return e.getPushDetails()}setProfileInfo(e,t){var n=Ae("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(le.Put,n,void 0,t)}setDisplayName(e){var t=this;return B(function*(){var n=yield t.setProfileInfo("displayname",{displayname:e}),r=t.getUser(t.getUserId());return r&&(r.displayName=e,r.emit(Oi.DisplayName,r.events.presence,r)),n})()}setAvatarUrl(e){var t=this;return B(function*(){var n=yield t.setProfileInfo("avatar_url",{avatar_url:e}),r=t.getUser(t.getUserId());return r&&(r.avatarUrl=e,r.emit(Oi.AvatarUrl,r.events.presence,r)),n})()}mxcUrlToHttp(e,t,n,r,i,o,s){return N3(this.baseUrl,e,t,n,r,i,o,s)}setSyncPresence(e){var t=this;return B(function*(){var n;null===(n=t.syncApi)||void 0===n||n.setPresence(e)})()}setPresence(e){var t=this;return B(function*(){var n=Ae("/presence/$userId/status",{$userId:t.credentials.userId});if(-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);yield t.http.authedRequest(le.Put,n,void 0,e)})()}getPresence(e){var t=Ae("/presence/$userId/status",{$userId:e});return this.http.authedRequest(le.Get,t)}scrollback(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=0,r=this.ongoingScrollbacks[e.roomId]||{};if(r.promise)return r.promise;if(r.errorTs){var i=Date.now()-r.errorTs;n=Math.max(Sye-i,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);var o=this.store.scrollback(e,t).length;if(o===t)return Promise.resolve(e);t-=o;var s=new Promise((r,i)=>{mp(n).then(()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,gt.Backward)).then(t=>{var n,i,o=t.chunk.map(this.getEventMapper());if(t.state){var s=t.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(s)}var[a,l,c]=e.partitionThreadedEvents(o);this.processAggregatedTimelineEvents(e,a),e.addEventsToTimeline(a,!0,!0,e.getLiveTimeline()),this.processThreadEvents(e,l,!0),c.forEach(t=>e.relations.aggregateChildEvent(t)),e.oldState.paginationToken=null!==(n=t.end)&&void 0!==n?n:null,0===t.chunk.length&&(e.oldState.paginationToken=null),this.store.storeEvents(e,o,null!==(i=t.end)&&void 0!==i?i:null,!0),delete this.ongoingScrollbacks[e.roomId],r(e)}).catch(t=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},i(t)})});return r={promise:s},this.ongoingScrollbacks[e.roomId]=r,s}getEventMapper(e){return p0e(this,e||{})}getEventTimeline(e,t){var n=this;return B(function*(){var r,i,o,s;if(!n.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(null==e||!e.room)throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);if(e.thread&&n.supportsThreads())return n.getThreadTimeline(e,t);var a=Ae("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),l=void 0;null!==(r=n.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(l={filter:JSON.stringify(As.LAZY_LOADING_MESSAGES_FILTER)});var c=yield n.http.authedRequest(le.Get,a,l);if(!c.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);var u=n.getEventMapper(),d=u(c.event);if(!d.isRelation(yn.name)){var h=[...c.events_after.reverse().map(u),d,...c.events_before.map(u)],p=e.getTimelineForEvent(h[0].getId());p?p.getState(Me.BACKWARDS).setUnknownStateEvents(c.state.map(u)):((p=e.addTimeline()).initialiseState(c.state.map(u)),p.getState(Me.FORWARDS).paginationToken=c.end);var[f,m,v]=e.room.partitionThreadedEvents(h);return e.addEventsToTimeline(f,!0,!1,p,c.start),n.processThreadEvents(e.room,m,!0),n.processAggregatedTimelineEvents(e.room,f),v.forEach(t=>e.relations.aggregateChildEvent(t)),null!==(i=null!==(o=e.getTimelineForEvent(t))&&void 0!==o?o:null===(s=e.room.findThreadForEvent(d))||void 0===s?void 0:s.liveTimeline)&&void 0!==i?i:p}n.logger.warn("Tried loading a regular timeline at the position of a thread event")})()}getThreadTimeline(e,t){var n=this;return B(function*(){var r;if(!n.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var i=Ae("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),o={limit:"0"};null!==(r=n.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(o.filter=JSON.stringify(As.LAZY_LOADING_MESSAGES_FILTER));var s=yield n.http.authedRequest(le.Get,i,o),a=n.getEventMapper(),l=a(s.event);if(e.canContain(l)){var c=n.canSupport.get(Xr.RelationsRecursion)!==Yr.Unsupported;if(Mn.hasServerSideSupport){if(Mn.hasServerSideFwdPaginationSupport){var u,d,h;if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var p=e.thread,f=yield n.fetchRelations(e.room.roomId,p.id,null,null,{dir:gt.Backward,from:s.start,recurse:c||void 0}),m=yield n.fetchRelations(e.room.roomId,p.id,null,null,{dir:gt.Forward,from:s.end,recurse:c||void 0}),v=[...m.chunk.reverse().filter(wk(p.id)).map(a),l,...f.chunk.filter(wk(p.id)).map(a)];for(var g of v){var y;yield null===(y=e.thread)||void 0===y?void 0:y.processEvent(g)}var b=e.getTimelineForEvent(l.getId());if(b?b.getState(Me.BACKWARDS).setUnknownStateEvents(s.state.map(a)):(b=e.addTimeline()).initialiseState(s.state.map(a)),e.addEventsToTimeline(v,!0,!1,b,m.next_batch),!f.next_batch){var w=yield n.fetchRoomEvent(e.room.roomId,p.id);e.addEventsToTimeline([a(w)],!0,!1,b,null)}return b.setPaginationToken(null!==(u=f.next_batch)&&void 0!==u?u:null,gt.Backward),b.setPaginationToken(null!==(d=m.next_batch)&&void 0!==d?d:null,gt.Forward),n.processAggregatedTimelineEvents(e.room,v),null!==(h=e.getTimelineForEvent(t))&&void 0!==h?h:b}for(var _,S=e.thread,E=yield n.fetchRelations(e.room.roomId,S.id,yn.name,null,{dir:gt.Backward,from:s.start,recurse:c||void 0}),C=[],k=s.end;k;){var T,R=yield n.fetchRelations(e.room.roomId,S.id,yn.name,null,{dir:gt.Forward,from:k,recurse:c||void 0});k=null!==(T=R.next_batch)&&void 0!==T?T:null,C.push(...R.chunk)}var I=[...C.reverse().map(a),l,...E.chunk.map(a)];for(var x of I){var P;yield null===(P=e.thread)||void 0===P?void 0:P.processEvent(x)}var L=e.getLiveTimeline();if(L.getState(Me.BACKWARDS).setUnknownStateEvents(s.state.map(a)),e.addEventsToTimeline(I,!0,!1,L,null),!E.next_batch){var M=yield n.fetchRoomEvent(e.room.roomId,S.id);e.addEventsToTimeline([a(M)],!0,!1,L,null)}return L.setPaginationToken(null!==(_=E.next_batch)&&void 0!==_?_:null,gt.Backward),L.setPaginationToken(null,gt.Forward),n.processAggregatedTimelineEvents(e.room,I),L}}})()}getLatestTimeline(e){var t=this;return B(function*(){if(!t.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");var n,r;if(null!==e.threadListType)n=null===(r=(yield t.createThreadListMessagesRequest(e.room.roomId,null,1,gt.Backward,e.threadListType,e.getFilter())).chunk)||void 0===r?void 0:r[0];else if(e.thread&&Mn.hasServerSideSupport){var i,o=t.canSupport.get(Xr.RelationsRecursion)!==Yr.Unsupported;n=null===(i=(yield t.fetchRelations(e.room.roomId,e.thread.id,yn.name,null,{dir:gt.Backward,limit:1,recurse:o||void 0})).chunk)||void 0===i?void 0:i[0]}else{var s,a,l=Ae("/rooms/$roomId/messages",{$roomId:e.room.roomId}),c={dir:"b"};null!==(s=t.clientOpts)&&void 0!==s&&s.lazyLoadMembers&&(c.filter=JSON.stringify(As.LAZY_LOADING_MESSAGES_FILTER)),n=null===(a=(yield t.http.authedRequest(le.Get,l,c)).chunk)||void 0===a?void 0:a[0]}if(!n)throw new Error("No message returned when trying to construct getLatestTimeline");return t.getEventTimeline(e,n.event_id)})()}createMessagesRequest(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,s=Ae("/rooms/$roomId/messages",{$roomId:e}),a={limit:r.toString(),dir:i};t&&(a.from=t);var l,c=null;(null!==(n=this.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(c=Object.assign({},As.LAZY_LOADING_MESSAGES_FILTER)),o)&&(c=c||{},Object.assign(c,null===(l=o.getRoomTimelineFilterComponent())||void 0===l?void 0:l.toJSON()));return c&&(a.filter=JSON.stringify(c)),this.http.authedRequest(le.Get,s,a)}createThreadListMessagesRequest(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:gt.Backward,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ua.All,s=arguments.length>5?arguments[5]:void 0,a=Ae("/rooms/$roomId/threads",{$roomId:e}),l={limit:r.toString(),dir:i,include:iQ(o)};t&&(l.from=t);var c,u={};(null!==(n=this.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(u=Gr({},As.LAZY_LOADING_MESSAGES_FILTER)),s)&&(u=Gr(Gr({},u),null===(c=s.getRoomTimelineFilterComponent())||void 0===c?void 0:c.toJSON()));Object.keys(u).length&&(l.filter=JSON.stringify(u));var d={prefix:Mn.hasServerSideListSupport===Ji.Stable?Kr.V1:"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(le.Get,a,l,void 0,d).then(e=>{var t;return Gr(Gr({},e),{},{chunk:null===(t=e.chunk)||void 0===t?void 0:t.reverse(),start:e.prev_batch,end:e.next_batch})})}paginateEventTimeline(e,t){var n=this,r=e.getTimelineSet()===this.notifTimelineSet,i=this.getRoom(e.getRoomId()),o=e.getTimelineSet().threadListType,s=e.getTimelineSet().thread,a=(t=t||{}).backwards||!1;if(r&&!a)throw new Error("paginateNotifTimeline can only paginate backwards");var l,c,u,d,h=a?Me.BACKWARDS:Me.FORWARDS,p=e.getPaginationToken(h),f=e.paginationRequests[h];if(f)return f;if(r)l={limit:(null!==(u=t.limit)&&void 0!==u?u:30).toString(),only:"highlight"},p&&"end"!==p&&(l.from=p),c=this.http.authedRequest(le.Get,"/notifications",l).then((d=B(function*(t){var r=t.next_token,i=[];t.notifications=t.notifications.filter(Ha);for(var o=0;o<t.notifications.length;o++){var s=t.notifications[o],l=n.getEventMapper()(s.event);n.getPushDetailsForEvent(l,!0),l.event.room_id=s.room_id,i[o]=l}var c=e.getTimelineSet();return c.addEventsToTimeline(i,a,!1,e,r),n.processAggregatedTimelineEvents(c.room,i),a&&!t.next_token&&e.setPaginationToken(null,h),!!t.next_token}),function(e){return d.apply(this,arguments)})).finally(()=>{e.paginationRequests[h]=null}),e.paginationRequests[h]=c;else if(null!==o){if(!i)throw new Error("Unknown room "+e.getRoomId());if(!Mn.hasServerSideFwdPaginationSupport&&h===gt.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");c=this.createThreadListMessagesRequest(e.getRoomId(),p,t.limit,h,o,e.getFilter()).then(t=>{if(t.state){var n=e.getState(h),r=t.state.filter(Ha).map(this.getEventMapper());n.setUnknownStateEvents(r)}var o=t.end,s=t.chunk.filter(Ha).map(this.getEventMapper());return e.getTimelineSet().addEventsToTimeline(s,a,!1,e,o),this.processAggregatedTimelineEvents(i,s),this.processThreadRoots(i,s,a),a&&t.end==t.start&&e.setPaginationToken(null,h),t.end!==t.start}).finally(()=>{e.paginationRequests[h]=null}),e.paginationRequests[h]=c}else if(s){var m,v,g=this.getRoom(null!==(m=e.getRoomId())&&void 0!==m?m:void 0);if(!g)throw new Error("Unknown room "+e.getRoomId());var y=this.canSupport.get(Xr.RelationsRecursion)!==Yr.Unsupported;c=this.fetchRelations(null!==(v=e.getRoomId())&&void 0!==v?v:"",s.id,null,null,{dir:h,limit:t.limit,from:p??void 0,recurse:y||void 0}).then(function(){var t=B(function*(t){var r=n.getEventMapper(),i=t.chunk.filter(Ha).filter(wk(s.id)).map(r);for(var o of i.slice().reverse()){yield null==s?void 0:s.processEvent(o);var l=o.getSender();(!a||null===(null==s?void 0:s.getEventReadUpTo(l)))&&g.addLocalEchoReceipt(l,o,os.Read)}var c=t.next_batch,u=e.getTimelineSet();if(u.addEventsToTimeline(i,a,!1,e,c??null),!c&&a){var d,p,f=null!==(d=s.rootEvent)&&void 0!==d?d:r(yield n.fetchRoomEvent(null!==(p=e.getRoomId())&&void 0!==p?p:"",s.id));u.addEventsToTimeline([f],!0,!1,e,null)}return n.processAggregatedTimelineEvents(u.room,i),a&&!c&&e.setPaginationToken(null,h),!!c});return function(e){return t.apply(this,arguments)}}()).finally(()=>{e.paginationRequests[h]=null}),e.paginationRequests[h]=c}else{if(!i)throw new Error("Unknown room "+e.getRoomId());c=this.createMessagesRequest(e.getRoomId(),p,t.limit,h,e.getFilter()).then(t=>{if(t.state){var n=e.getState(h),r=t.state.filter(Ha).map(this.getEventMapper());n.setUnknownStateEvents(r)}var o=t.end,s=t.chunk.filter(Ha).map(this.getEventMapper()),l=e.getTimelineSet(),[c,,u]=i.partitionThreadedEvents(s);l.addEventsToTimeline(c,a,!1,e,o),this.processAggregatedTimelineEvents(i,c),this.processThreadRoots(i,c.filter(e=>e.getServerAggregatedRelation(yn.name)),!1),u.forEach(e=>i.relations.aggregateChildEvent(e));var d=void 0===t.end||t.end===t.start;return a&&d&&e.setPaginationToken(null,h),!d}).finally(()=>{e.paginationRequests[h]=null}),e.paginationRequests[h]=c}return c}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return null===(t=this.peekSync)||void 0===t||t.stopPeeking(),this.peekSync=new Hd(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e,n)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){var n=this.sendStateEvent(e,ee.RoomGuestAccess,{guest_access:t.allowJoin?eC.CanJoin:eC.Forbidden},""),r=Promise.resolve();return t.allowRead&&(r=this.sendStateEvent(e,ee.RoomHistoryVisibility,{history_visibility:VP.WorldReadable},"")),Promise.all([r,n]).then()}requestRegisterEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestRegisterMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestAdd3pidEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestAdd3pidMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestPasswordEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestPasswordMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestTokenFromEndpoint(e,t){var n=this;return B(function*(){var r=Object.assign({},t);return n.http.request(le.Post,e,void 0,r)})()}getRoomPushRule(e,t){var n;if(this.pushRules)return null===(n=this.pushRules[e])||void 0===n||null===(n=n.room)||void 0===n?void 0:n.find(e=>e.rule_id===t);throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,t,n){var r,i=!1,o=this.getRoomPushRule(e,t);if(null!=o&&o.actions.includes(Zd.DontNotify)&&(i=!0),n)if(o){if(!i){var s=Promise.withResolvers();this.deletePushRule(e,vi.RoomSpecific,o.rule_id).then(()=>{this.addPushRule(e,vi.RoomSpecific,t,{actions:[Zd.DontNotify]}).then(()=>{s.resolve()}).catch(e=>{s.reject(e)})}).catch(e=>{s.reject(e)}),r=s.promise}}else r=this.addPushRule(e,vi.RoomSpecific,t,{actions:[Zd.DontNotify]});else i&&(r=this.deletePushRule(e,vi.RoomSpecific,o.rule_id));if(r)return new Promise((e,t)=>{r.then(()=>{this.getPushRules().then(t=>{this.pushRules=t,e()}).catch(e=>{t(e)})}).catch(e=>{this.getPushRules().then(n=>{this.pushRules=n,t(e)}).catch(n=>{t(e)})})})}searchMessageText(e){var t={search_term:e.query};return"keys"in e&&(t.keys=e.keys),this.search({body:{search_categories:{room_events:t}}})}searchRoomEvents(e){var t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:AJ.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:t,results:[],highlights:[]};return this.search({body:t}).then(e=>this.processRoomEventsSearch(n,e))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var t={body:e._query,next_batch:e.next_batch},n=this.search(t,e.abortSignal).then(t=>this.processRoomEventsSearch(e,t)).finally(()=>{e.pendingRequest=void 0});return e.pendingRequest=n,n}processRoomEventsSearch(e,t){var n,r,i=t.search_categories.room_events;e.count=i.count,e.next_batch=i.next_batch;var o=new Set(i.highlights);e.highlights.forEach(e=>{o.add(e)}),e.highlights=Array.from(o);for(var s=this.getEventMapper(),a=null!==(n=null===(r=i.results)||void 0===r?void 0:r.length)&&void 0!==n?n:0,l=0;l<a;l++){var c=V3.fromJson(i.results[l],s),u=this.getRoom(c.context.getEvent().getRoomId());if(u)for(var d of c.context.getTimeline())d.setMetadata(u.currentState,!1);e.results.push(c)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;var e=new Hd(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then(()=>{this.logger.debug("Marking success of sync left room request"),this.syncedLeftRooms=!0}).finally(()=>{this.syncLeftRoomsPromise=void 0}),this.syncLeftRoomsPromise}createFilter(e){var t=Ae("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(le.Post,t,void 0,e).then(t=>{var n=As.fromJson(this.credentials.userId,t.filter_id,e);return this.store.storeFilter(n),n})}getFilter(e,t,n){if(n){var r=this.store.getFilter(e,t);if(r)return Promise.resolve(r)}var i=Ae("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(le.Get,i).then(n=>{var r=As.fromJson(e,t,n);return this.store.storeFilter(r),r})}getOrCreateFilter(e,t){var n=this;return B(function*(){var r,i=n.store.getFilterIdByName(e);if(i){try{var o=yield n.getFilter(n.credentials.userId,i,!0);if(o)df(o.getDefinition(),t.getDefinition())&&(r=i)}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}r||n.store.setFilterIdByName(e,void 0)}if(r)return r;var s=yield n.createFilter(t.getDefinition());return n.store.setFilterIdByName(e,s.filterId),s.filterId})()}getOpenIdToken(){var e=Ae("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(le.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(le.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return void 0!==this.checkTurnServersIntervalID}checkTurnServers(){var e=this;return B(function*(){if(e.canSupportVoip){var t=!1,n=e.turnServersExpiry-Date.now();if(n>Y$)e.logger.debug("TURN creds are valid for another "+n+" ms: not fetching new ones."),t=!0;else{e.logger.debug("Fetching new TURN credentials");try{var r=yield e.turnServer();if(r.uris){e.logger.debug("Got TURN URIs: "+r.uris+" refresh in "+r.ttl+" secs");var i={urls:r.uris,username:r.username,credential:r.password};e.turnServers=[i],e.turnServersExpiry=Date.now()+1e3*r.ttl,t=!0,e.emit(Le.TurnServers,e.turnServers)}}catch(t){e.logger.error("Failed to get TURN URIs",t),403===t.httpStatus?(e.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==e.checkTurnServersIntervalID&&globalThis.clearInterval(e.checkTurnServersIntervalID),e.checkTurnServersIntervalID=void 0,e.emit(Le.TurnServersError,t,!0)):e.emit(Le.TurnServersError,t,!1)}}return t}})()}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){var e=Ae("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(le.Get,e,void 0,void 0,{prefix:""}).then(e=>e.admin)}whoisSynapseUser(e){var t=Ae("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(le.Get,t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){var t=Ae("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(le.Post,t,void 0,void 0,{prefix:""})}fetchClientWellKnown(){var e=this;return B(function*(){var t;e.clientWellKnownPromise=ht.getRawClientConfig(null!==(t=e.getDomain())&&void 0!==t?t:void 0),e.clientWellKnown=yield e.clientWellKnownPromise,e.emit(Le.ClientWellKnown,e.clientWellKnown)})()}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){var e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter(t=>{var[n,r]=t;return e.includes(typeof r)}).reduce((e,t)=>{var[n,r]=t;return e[n]=r,e},{});return this.store.storeClientOptions(t)}_unstable_getSharedRooms(e){var t=this;return B(function*(){var n,r,i=yield t.doesServerSupportUnstableFeature(ZJ),o=yield t.doesServerSupportUnstableFeature(eQ),s=yield t.doesServerSupportUnstableFeature(tQ);if(!i&&!o&&!s)throw Error("Server does not support the Mutual Rooms API");s?(n="/uk.half-shot.msc2666/user/mutual_rooms",r={user_id:e}):(n=Ae("/uk.half-shot.msc2666/user/".concat(o?"mutual_rooms":"shared_rooms","/$userId"),{$userId:e}),r={});var a=[],l=null;do{var c={};null!=l&&s&&(c.batch_token=l);var u=yield t.http.authedRequest(le.Get,n,Gr(Gr({},r),c),void 0,{prefix:Kr.Unstable});a.push(...u.joined),l=void 0!==u.next_batch_token?u.next_batch_token:null}while(null!=l);return a})()}getVersions(){var e=this;return B(function*(){if(e.serverVersionsPromise)return e.serverVersionsPromise;e.serverVersionsPromise=e.http.authedRequest(le.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(t=>{throw e.serverVersionsPromise=void 0,t});var t=yield e.serverVersionsPromise;return e.canSupport=yield g1e(t),e.serverVersionsPromise})()}isVersionSupported(e){var t=this;return B(function*(){var{versions:n}=yield t.getVersions();return n&&n.includes(e)})()}doesServerSupportUnstableFeature(e){var t=this;return B(function*(){var n=yield t.getVersions();if(!n)return!1;var r=n.unstable_features;return r&&!!r[e]})()}doesServerForceEncryptionForPreset(e){var t=this;return B(function*(){var n=yield t.getVersions();if(!n)return!1;var r=n.unstable_features,i=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return r&&!!r["io.element.e2ee_forced.".concat(i)]})()}doesServerSupportThread(){var e=this;return B(function*(){if(yield e.isVersionSupported("v1.4"))return{threads:Ji.Stable,list:Ji.Stable,fwdPagination:Ji.Stable};try{var[t,n,r,i,o,s]=yield Promise.all([e.doesServerSupportUnstableFeature("org.matrix.msc3440"),e.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3856"),e.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3715"),e.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:BE(n,t),list:BE(i,r),fwdPagination:BE(s,o)}}catch{return{threads:Ji.None,list:Ji.None,fwdPagination:Ji.None}}})()}hasLazyLoadMembersEnabled(){var e;return!(null===(e=this.clientOpts)||void 0===e||!e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}relations(e,t,n,r){var i=arguments,o=this;return B(function*(){var s,a,l=i.length>4&&void 0!==i[4]?i[4]:{dir:gt.Backward},c=r?o.getEncryptedIfNeededEventType(e,r):null,[u,d]=yield Promise.all([o.fetchRoomEvent(e,t),o.fetchRelations(e,t,n,c,l)]),h=o.getEventMapper(),p=u?h(u):void 0,f=d.chunk.map(h);if(c===ee.RoomMessageEncrypted){var m=p?f.concat(p):f;yield Promise.all(m.map(e=>o.decryptEventIfNeeded(e))),null!==r&&(f=f.filter(e=>e.getType()===r))}return p&&n===kn.Replace&&(f=f.filter(e=>e.getSender()===p.getSender())),{originalEvent:p??null,events:f,nextBatch:null!==(s=d.next_batch)&&void 0!==s?s:null,prevBatch:null!==(a=d.prev_batch)&&void 0!==a?a:null}})()}generateClientSecret(){return Eo(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&this.getCrypto()&&e.attemptDecryption(this.cryptoBackend,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,t){switch(e){case Z5.IS:return this.http.getUrl("/terms",void 0,Fl.V2,t);case Z5.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",t);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(){var e,t;return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(null!==(e=this.idBaseUrl)&&void 0!==e&&e.startsWith("http://")||null!==(t=this.idBaseUrl)&&void 0!==t&&t.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=lk(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}getRefreshToken(){var e;return null!==(e=this.http.opts.refreshToken)&&void 0!==e?e:null}setAccessToken(e){this.http.opts.accessToken=e,this.serverVersionsPromise=void 0}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(le.Get,"/register/available",{username:e}).then(e=>e.available).catch(e=>"M_USER_IN_USE"!==e.errcode&&Promise.reject(e))}register(e,t,n,r,i,o,s){n&&(r.session=n);var a={auth:r,refresh_token:!0};return null!=e&&(a.username=e),null!=t&&(a.password=t),null!=o&&(a.guest_access_token=o),null!=s&&(a.inhibit_login=s),this.registerRequest(a)}registerGuest(){var{body:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.registerRequest(e||{},"guest")}registerRequest(e,t){var n={};return t&&(n.kind=t),this.http.request(le.Post,"/register",n,e)}refreshToken(e){var t=t=>this.http.authedRequest(le.Post,"/refresh",void 0,{refresh_token:e},{prefix:t,inhibitLogoutEmit:!0});return t(Kr.V3).catch(e=>{if("M_UNRECOGNIZED"===e.errcode)return t(Kr.V1);throw e})}loginFlows(){return this.http.request(le.Get,"/login")}login(e,t){return this.loginRequest(Gr(Gr({},t),{},{type:e})).then(e=>(e.access_token&&e.user_id&&(this.http.opts.accessToken=e.access_token,this.credentials={userId:e.user_id}),e))}loginWithPassword(e,t){return this.login("m.login.password",{user:e,password:t})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e){var t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r="/login/"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sso")+"/redirect";t&&(r+="/"+t);var i={redirectUrl:e,[Cye.unstable]:n};return this.http.getUrl(r,i).href}loginWithToken(e){return this.login("m.login.token",{token:e})}loginRequest(e){var t=this;return B(function*(){return yield t.http.authedRequest(le.Post,"/login",void 0,e)})()}logout(){var e=arguments,t=this;return B(function*(){return e.length>0&&void 0!==e[0]&&e[0]&&(t.stopClient(),t.http.abort()),t.http.authedRequest(le.Post,"/logout")})()}deactivateAccount(e,t){var n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this.http.authedRequest(le.Post,"/account/deactivate",void 0,n)}requestLoginToken(e){var t=this;return B(function*(){var n={auth:e};return t.http.authedRequest(le.Post,"/login/get_token",void 0,n,{prefix:Kr.V1})})()}getFallbackAuthUrl(e,t){var n=Ae("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(n,{session:t}).href}createRoom(e){var t=this;return B(function*(){var n,r=(e.invite_3pid||[]).filter(e=>!e.id_access_token);if(r.length>0&&null!==(n=t.identityServer)&&void 0!==n&&n.getAccessToken){var i=yield t.identityServer.getAccessToken();if(i)for(var o of r)o.id_access_token=i}return t.http.authedRequest(le.Post,"/createRoom",void 0,e)})()}fetchRelations(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{dir:gt.Backward};Mn.hasServerSideFwdPaginationSupport===Ji.Experimental&&(i=bF("dir","org.matrix.msc3715.dir",i)),this.canSupport.get(Xr.RelationsRecursion)===Yr.Unstable&&(i=bF("recurse","org.matrix.msc3981.recurse",i));var o=k5(i),s="/rooms/$roomId/relations/$eventId";null!==n?(s+="/$relationType",null!==r&&(s+="/$eventType")):null!==r&&(this.logger.warn("eventType: ".concat(r," ignored when fetching\n            relations as relationType is null")),r=null);var a=Ae(s+"?"+o,{$roomId:e,$eventId:t,$relationType:n,$eventType:r});return this.http.authedRequest(le.Get,a,void 0,void 0,{prefix:Kr.V1})}roomState(e){var t=Ae("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(le.Get,t)}fetchRoomEvent(e,t){var n=Ae("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(le.Get,n)}members(e,t,n,r){var i={};t&&(i.membership=t),n&&(i.not_membership=n),r&&(i.at=r);var o=Ae("/rooms/$roomId/members?"+k5(i),{$roomId:e});return this.http.authedRequest(le.Get,o)}upgradeRoom(e,t){var n=Ae("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(le.Post,n,void 0,{new_version:t})}getStateEvent(e,t,n){var r={$roomId:e,$eventType:t,$stateKey:n},i=Ae("/rooms/$roomId/state/$eventType",r);return void 0!==n&&(i=Ae(i+"/$stateKey",r)),this.http.authedRequest(le.Get,i)}sendStateEvent(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o={$roomId:e,$eventType:t,$stateKey:r},s=Ae("/rooms/$roomId/state/$eventType",o);return void 0!==r&&(s=Ae(s+"/$stateKey",o)),this.http.authedRequest(le.Put,s,void 0,n,i)}roomInitialSync(e,t){var n,r=Ae("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(le.Get,r,{limit:null!==(n=null==t?void 0:t.toString())&&void 0!==n?n:"30"})}setRoomReadMarkersHttpRequest(e,t,n,r){var i=this;return B(function*(){var o=Ae("/rooms/$roomId/read_markers",{$roomId:e}),s={[os.FullyRead]:t,[os.Read]:n};return((yield i.doesServerSupportUnstableFeature("org.matrix.msc2285.stable"))||(yield i.isVersionSupported("v1.4")))&&(s[os.ReadPrivate]=r),i.http.authedRequest(le.Post,o,void 0,s)})()}getJoinedRooms(){var e=Ae("/joined_rooms",{});return this.http.authedRequest(le.Get,e)}getJoinedRoomMembers(e){var t=Ae("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(le.Get,t)}publicRooms(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{server:t,limit:n,since:r}=e,i=Tve(e,_ye);if(0===Object.keys(i).length){var o={server:t,limit:n,since:r};return this.http.authedRequest(le.Get,"/publicRooms",o)}var s={server:t},a=Gr({limit:n,since:r},i);return this.http.authedRequest(le.Post,"/publicRooms",s,a)}createAlias(e,t){var n=Ae("/directory/room/$alias",{$alias:e}),r={room_id:t};return this.http.authedRequest(le.Put,n,void 0,r)}deleteAlias(e){var t=Ae("/directory/room/$alias",{$alias:e});return this.http.authedRequest(le.Delete,t)}getLocalAliases(e){var t=Ae("/rooms/$roomId/aliases",{$roomId:e}),n=Kr.V3;return this.http.authedRequest(le.Get,t,void 0,void 0,{prefix:n})}getRoomIdForAlias(e){var t=Ae("/directory/room/$alias",{$alias:e});return this.http.authedRequest(le.Get,t)}getRoomDirectoryVisibility(e){var t=Ae("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(le.Get,t)}setRoomDirectoryVisibility(e,t){var n=Ae("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(le.Put,n,void 0,{visibility:t})}searchUserDirectory(e){var{term:t,limit:n}=e,r={search_term:t};return void 0!==n&&(r.limit=n),this.http.authedRequest(le.Post,"/user_directory/search",void 0,r)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t){var n=t?Ae("/profile/$userId/$info",{$userId:e,$info:t}):Ae("/profile/$userId",{$userId:e});return this.http.authedRequest(le.Get,n)}doesServerSupportExtendedProfiles(){var e=this;return B(function*(){return e.doesServerSupportUnstableFeature(nQ)})()}getExtendedProfileRequestPrefix(){var e=this;return B(function*(){return(yield e.doesServerSupportUnstableFeature("uk.tcpip.msc4133.stable"))?Kr.V3:"/_matrix/client/unstable/uk.tcpip.msc4133"})()}getExtendedProfile(e){var t=this;return B(function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return t.http.authedRequest(le.Get,Ae("/profile/$userId",{$userId:e}),void 0,void 0,{prefix:yield t.getExtendedProfileRequestPrefix()})})()}getExtendedProfileProperty(e,t){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return(yield n.http.authedRequest(le.Get,Ae("/profile/$userId/$key",{$userId:e,$key:t}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()}))[t]})()}setExtendedProfileProperty(e,t){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(le.Put,Ae("/profile/$userId/$key",{$userId:r,$key:e}),void 0,{[e]:t},{prefix:yield n.getExtendedProfileRequestPrefix()})})()}deleteExtendedProfileProperty(e){var t=this;return B(function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();yield t.http.authedRequest(le.Delete,Ae("/profile/$userId/$key",{$userId:n,$key:e}),void 0,void 0,{prefix:yield t.getExtendedProfileRequestPrefix()})})()}patchExtendedProfile(e){var t=this;return B(function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();return t.http.authedRequest(le.Patch,Ae("/profile/$userId",{$userId:n}),{},e,{prefix:yield t.getExtendedProfileRequestPrefix()})})()}setExtendedProfile(e){var t=this;return B(function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();yield t.http.authedRequest(le.Put,Ae("/profile/$userId",{$userId:n}),{},e,{prefix:yield t.getExtendedProfileRequestPrefix()})})()}getThreePids(){return this.http.authedRequest(le.Get,"/account/3pid")}addThreePidOnly(e){var t=this;return B(function*(){return t.http.authedRequest(le.Post,"/account/3pid/add",void 0,e)})()}bindThreePid(e){var t=this;return B(function*(){return t.http.authedRequest(le.Post,"/account/3pid/bind",void 0,e)})()}unbindThreePid(e,t){var n=this;return B(function*(){var r={medium:e,address:t,id_server:n.getIdentityServerUrl(!0)};return n.http.authedRequest(le.Post,"/account/3pid/unbind",void 0,r)})()}deleteThreePid(e,t){return this.http.authedRequest(le.Post,"/account/3pid/delete",void 0,{medium:e,address:t})}setPassword(e,t,n){var r={auth:e,new_password:t,logout_devices:n};return this.http.authedRequest(le.Post,"/account/password",void 0,r)}getDevices(){return this.http.authedRequest(le.Get,"/devices")}getDevice(e){var t=Ae("/devices/$device_id",{$device_id:e});return this.http.authedRequest(le.Get,t)}setDeviceDetails(e,t){var n=Ae("/devices/$device_id",{$device_id:e});return this.http.authedRequest(le.Put,n,void 0,t)}deleteDevice(e,t){var n=Ae("/devices/$device_id",{$device_id:e}),r={};return t&&(r.auth=t),this.http.authedRequest(le.Delete,n,void 0,r)}deleteMultipleDevices(e,t){var n={devices:e};t&&(n.auth=t);return this.http.authedRequest(le.Post,"/delete_devices",void 0,n)}getPushers(){var e=this;return B(function*(){var t=yield e.http.authedRequest(le.Get,"/pushers");return(yield e.doesServerSupportUnstableFeature("org.matrix.msc3881"))||(t.pushers=t.pushers.map(e=>(e.hasOwnProperty(j5.name)||(e[j5.name]=!0),e))),t})()}setPusher(e){return this.http.authedRequest(le.Post,"/pushers/set",void 0,e)}removePusher(e,t){var n={pushkey:e,app_id:t,kind:null};return this.http.authedRequest(le.Post,"/pushers/set",void 0,n)}setLocalNotificationSettings(e,t){var n="".concat(NX.name,".").concat(e);return this.setAccountData(n,t)}getPushRules(){return this.http.authedRequest(le.Get,"/pushrules/").then(e=>(this.setPushRules(e),this.pushRules))}setPushRules(e){this.pushRules=Fa.rewriteDefaultRules(this.logger,e,this.getUserId()),this.pushProcessor.updateCachedPushRuleKeys(this.pushRules)}addPushRule(e,t,n,r){var i=Ae("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(le.Put,i,void 0,r)}deletePushRule(e,t,n){var r=Ae("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(le.Delete,r)}setPushRuleEnabled(e,t,n,r){var i=Ae("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this.http.authedRequest(le.Put,i,void 0,{enabled:r})}setPushRuleActions(e,t,n,r){var i=Ae("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this.http.authedRequest(le.Put,i,void 0,{actions:r})}search(e,t){var{body:n,next_batch:r}=e,i={};return r&&(i.next_batch=r),this.http.authedRequest(le.Post,"/search",i,n,{abortSignal:t})}uploadKeysRequest(e,t){return this.http.authedRequest(le.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(le.Post,"/keys/signatures/upload",void 0,e)}downloadKeysForUsers(e){var{token:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={device_keys:{}};return void 0!==t&&(n.token=t),e.forEach(e=>{n.device_keys[e]=[]}),this.http.authedRequest(le.Post,"/keys/query",void 0,n)}claimOneTimeKeys(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signed_curve25519",n=arguments.length>2?arguments[2]:void 0,r={};for(var[i,o]of(void 0===t&&(t="signed_curve25519"),e)){var s=r[i]||{};zw(r,i,s),zw(s,o,t)}var a={one_time_keys:r};n&&(a.timeout=n);return this.http.authedRequest(le.Post,"/keys/claim",void 0,a)}getKeyChanges(e,t){var n={from:e,to:t};return this.http.authedRequest(le.Get,"/keys/changes",n)}uploadDeviceSigningKeys(e,t){var n=Object.assign({},t);return e&&Object.assign(n,{auth:e}),this.http.authedRequest(le.Post,"/keys/device_signing/upload",void 0,n,{prefix:Kr.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");var t=this.http.getUrl("/account/register",void 0,Fl.V2,this.idBaseUrl);return this.http.requestOtherUrl(le.Post,t,e)}requestEmailToken(e,t,n,r,i){var o={client_secret:t,email:e,send_attempt:null==n?void 0:n.toString()};return r&&(o.next_link=r),this.http.idServerRequest(le.Post,"/validate/email/requestToken",o,Fl.V2,i)}requestMsisdnToken(e,t,n,r,i,o){var s={client_secret:n,country:e,phone_number:t,send_attempt:null==r?void 0:r.toString()};return i&&(s.next_link=i),this.http.idServerRequest(le.Post,"/validate/msisdn/requestToken",s,Fl.V2,o)}submitMsisdnToken(e,t,n,r){var i={sid:e,client_secret:t,token:n};return this.http.idServerRequest(le.Post,"/validate/msisdn/submitToken",i,Fl.V2,r??void 0)}submitMsisdnTokenOtherUrl(e,t,n,r){var i={sid:t,client_secret:n,token:r};return this.http.requestOtherUrl(le.Post,e,i)}getIdentityHashDetails(e){return this.http.idServerRequest(le.Get,"/hash_details",void 0,Fl.V2,e)}identityHashedLookup(e,t){var n=this;return B(function*(){var r={},i=yield n.getIdentityHashDetails(t);if(!i||!i.lookup_pepper||!i.algorithms)throw new Error("Unsupported identity server: bad response");r.pepper=i.lookup_pepper;var o,s={};if(i.algorithms.includes("sha256"))r.addresses=yield Promise.all(e.map((o=B(function*(e){var t=e[0].toLowerCase(),n=e[1].toLowerCase(),i=B3(yield BJ("".concat(t," ").concat(n," ").concat(r.pepper)));return s[i]=e[0],i}),function(e){return o.apply(this,arguments)}))),r.algorithm="sha256";else{if(!i.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");r.addresses=e.map(e=>{var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r="".concat(t," ").concat(n);return s[r]=e[0],r}),r.algorithm="none"}var a=yield n.http.idServerRequest(le.Post,"/lookup",r,Fl.V2,t);if(null==a||!a.mappings)return[];var l=[];for(var c of Object.keys(a.mappings)){var u=a.mappings[c],d=s[c];if(!d)throw new Error("Identity server returned more results than expected");l.push({address:d,mxid:u})}return l})()}lookupThreePid(e,t,n){var r=this;return B(function*(){var i=(yield r.identityHashedLookup([[t,e]],n)).find(e=>e.address===t);return i?{address:t,medium:e,mxid:i.mxid}:{}})()}bulkLookupThreePids(e,t){var n=this;return B(function*(){var r=yield n.identityHashedLookup(e.map(e=>[e[1],e[0]]),t),i=[],o=function*(t){var n=e.find(e=>e[1]===t.address);if(!n)throw new Error("Identity sever returned unexpected results");i.push([n[0],t.address,t.mxid])};for(var s of r)yield*o(s);return{threepids:i}})()}getIdentityAccount(e){return this.http.idServerRequest(le.Get,"/account",void 0,Fl.V2,e)}sendToDevice(e,t,n){var r=Ae("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),i={messages:xh(t)},o=new Map;for(var[s,a]of t)o.set(s,Array.from(a.keys()));return this.logger.debug("PUT ".concat(r),o),this.http.authedRequest(le.Put,r,void 0,i)}encryptAndSendToDevice(e,t,n){var r=this;return B(function*(){if(!r.cryptoBackend)throw new Error("Cannot encrypt to device event, your client does not support encryption.");var i=yield r.cryptoBackend.encryptToDeviceMessages(e,t,n);yield r.queueToDevice(i)})()}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(le.Get,"/thirdparty/protocols").then(e=>{if(!e||"object"!=typeof e)throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e})}getThirdpartyLocation(e,t){var n=Ae("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(le.Get,n,t)}getThirdpartyUser(e,t){var n=Ae("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(le.Get,n,t)}getTerms(e,t){var n=this.termsUrlForService(e,t);return this.http.requestOtherUrl(le.Get,n)}agreeToTerms(e,t,n,r){var i=this.termsUrlForService(e,t),o={Authorization:"Bearer "+n};return this.http.requestOtherUrl(le.Post,i,{user_accepts:r},{headers:o})}reportEvent(e,t,n,r){var i=Ae("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(le.Post,i,void 0,{score:n,reason:r})}reportRoom(e,t){var n=Ae("/rooms/$roomId/report",{$roomId:e});return this.http.authedRequest(le.Post,n,void 0,{reason:t})}getRoomHierarchy(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=Ae("/rooms/$roomId/hierarchy",{$roomId:e}),s={suggested_only:String(r),max_depth:null==n?void 0:n.toString(),from:i,limit:null==t?void 0:t.toString()};return this.http.authedRequest(le.Get,o,s,void 0,{prefix:Kr.V1}).catch(e=>{if("M_UNRECOGNIZED"===e.errcode)return this.http.authedRequest(le.Get,o,s,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw e})}unstableCreateFileTree(e){var t=this;return B(function*(){var{room_id:n}=yield t.createRoom({name:e,preset:q3.PrivateChat,power_level_content_override:Gr(Gr({},m0e),{},{users:{[t.getUserId()]:100}}),creation_content:{[Ww]:gg.Space},initial_state:[{type:M5.name,state_key:N5.name,content:{[D5.name]:!0}},{type:ee.RoomEncryption,state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]});return new D$(t,n)})()}unstableGetFileTreeSpace(e){var t,n,r=this.getRoom(e);if((null==r?void 0:r.getMyMembership())!==Ve.Join)return null;var i=r.currentState.getStateEvents(ee.RoomCreate,""),o=r.currentState.getStateEvents(M5.name,N5.name);if(!i)throw new Error("Expected single room create event");return null!=o&&null!==(t=o.getContent())&&void 0!==t&&t[D5.name]&&(null===(n=i.getContent())||void 0===n?void 0:n[Ww])===gg.Space?new D$(this,e):null}slidingSync(e,t,n){var r={};e.pos&&(r.pos=e.pos,delete e.pos),e.timeout&&(r.timeout=e.timeout,delete e.timeout);var i=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(le.Post,"/sync",r,e,{prefix:"/_matrix/client/unstable/org.matrix.simplified_msc3575",baseUrl:t,localTimeoutMs:i,abortSignal:n})}supportsThreads(){var e;return(null===(e=this.clientOpts)||void 0===e?void 0:e.threadSupport)||!1}supportsIntentionalMentions(){return this.canSupport.get(Xr.IntentionalMentions)!==Yr.Unsupported}getRoomSummary(e,t){var n=this;return B(function*(){var r={prefix:"/_matrix/client/unstable/im.nheko.summary"};try{var i=Ae("/summary/$roomid",{$roomid:e});return yield n.http.authedRequest(le.Get,i,{via:t},void 0,r)}catch(i){if(i instanceof nr&&"M_UNRECOGNIZED"===i.errcode){var o=Ae("/rooms/$roomid/summary",{$roomid:e});return yield n.http.authedRequest(le.Get,o,{via:t},void 0,r)}throw i}})()}processThreadEvents(e,t,n){e.processThreadedEvents(t,n)}processThreadRoots(e,t,n){this.supportsThreads()&&e.processThreadRoots(t,n)}processBeaconEvents(e,t){this.processAggregatedTimelineEvents(e,t)}processAggregatedTimelineEvents(e,t){null!=t&&t.length&&e&&(e.currentState.processBeaconEvents(t,this),e.processPollEvents(t))}whoami(){var e=this;return B(function*(){return e.http.authedRequest(le.Get,"/account/whoami")})()}timestampToEvent(e,t,n){var r=this;return B(function*(){var i=Ae("/rooms/$roomId/timestamp_to_event",{$roomId:e}),o={ts:t.toString(),dir:n};try{return yield r.http.authedRequest(le.Get,i,o,void 0,{prefix:Kr.V1})}catch(e){if("M_UNRECOGNIZED"===e.errcode&&(400===e.httpStatus||404===e.httpStatus||405===e.httpStatus))return yield r.http.authedRequest(le.Get,i,o,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw e}})()}getAuthIssuer(){var e=this;return B(function*(){return e.http.request(le.Get,"/auth_issuer",void 0,void 0,{prefix:Kr.Unstable+"/org.matrix.msc2965"})})()}getAuthMetadata(){var e=this;return B(function*(){var t;try{t=yield e.http.request(le.Get,"/auth_metadata",void 0,void 0,{prefix:Kr.Unstable+"/org.matrix.msc2965"})}catch(t){if(t instanceof nr&&"M_UNRECOGNIZED"===t.errcode){var{issuer:n}=yield e.getAuthIssuer();return QP(n)}throw t}return ZP(t)})()}}function X$(e){return Object.fromEntries(Object.entries(e).map(e=>{var[t,n]=e;return["".concat(Bc,".").concat(t),n]}))}function rQ(e,t){var n,r=e.getUserId(),i=t.getId(),o=e.getRoom(t.getRoomId());if(o&&r&&i){if(!o.findEventById(i))return void M.info("Decrypted event ".concat(t.getId()," is not in room ").concat(o.roomId,": ignoring"));var s,a=!!t.threadRootId&&!t.isThreadRoot;if(a){var l=o.getThread(t.threadRootId);s=!l||l.hasUserReadEvent(r,i)}else s=o.hasUserReadEvent(r,i);if(!s){var c=e.getPushActionsForEvent(t,!0);if(!(null==c||null===(n=c.tweaks)||void 0===n||!n.highlight)){var u=o.getUnreadCountForEventContext(zt.Highlight,t)+1;a?o.setThreadUnreadNotificationCount(t.threadRootId,zt.Highlight,u):o.setUnreadNotificationCount(zt.Highlight,u)}if(!(null==c||!c.notify)){var d=o.getUnreadCountForEventContext(zt.Total,t)+1;a?o.setThreadUnreadNotificationCount(t.threadRootId,zt.Total,d):o.setUnreadNotificationCount(zt.Total,d)}}}}function Zg(e){return cb(e)?r_:e.threadRootId}function cb(e){return!(e.threadRootId&&!e.isThreadRoot)||(e.isRelation()?!e.isRelation(yn.name)&&e.relationEventId===e.threadRootId:(M.warn("Event is not a relation or a thread root, but still has a threadRootId! id=".concat(e.getId())),!0))}function J$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J$(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}P(z3,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY");var as=function(e){return e.New="Thread.new",e.Update="Thread.update",e.NewReply="Thread.newReply",e.ViewThread="Thread.viewThread",e.Delete="Thread.delete",e}({}),Ji=function(e){return e[e.None=0]="None",e[e.Experimental=1]="Experimental",e[e.Stable=2]="Stable",e}({});function BE(e,t){return e?Ji.Stable:t?Ji.Experimental:Ji.None}class Mn extends cJ{constructor(e,t,n){var r,i,o;if(super(),r=this,this.id=e,this.rootEvent=t,P(this,"timelineSet",void 0),P(this,"_currentUserParticipated",!1),P(this,"reEmitter",void 0),P(this,"lastEvent",void 0),P(this,"replyCount",0),P(this,"lastPendingEvent",void 0),P(this,"pendingReplyCount",0),P(this,"room",void 0),P(this,"client",void 0),P(this,"pendingEventOrdering",void 0),P(this,"processRootEventPromise",void 0),P(this,"initialEventsFetched",!Mn.hasServerSideSupport),P(this,"initalEventFetchProm",void 0),P(this,"replayEvents",[]),P(this,"onTimelineReset",B(function*(){yield r.processRootEventPromise,r.processRootEventPromise=void 0})),P(this,"onBeforeRedaction",(e,t)=>{null!=e&&e.isRelation(yn.name)&&this.room.eventShouldLiveIn(e).threadId===this.id&&e.getId()!==this.id&&!t.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit(as.Update,this))}),P(this,"onRedaction",(o=B(function*(e,t,n){if(n===r.id)if(r.replyCount<=0){for(var i of r.timeline)r.clearEventMetadata(i);r.lastEvent=r.rootEvent,r._currentUserParticipated=!1,r.emit(as.Delete,r)}else{var o;(null===(o=r.lastEvent)||void 0===o?void 0:o.getId())===e.getAssociatedId()&&(yield r.processRootEventPromise,r.processRootEventPromise=void 0),yield r.updateThreadMetadata()}}),function(e,t,n){return o.apply(this,arguments)})),P(this,"onTimelineEvent",(e,t,n)=>{if(!n){var r=e.getSender();r&&t&&this.shouldSendLocalEchoReceipt(r,e)&&t.addLocalEchoReceipt(r,e,os.Read),e.getId()!==this.id&&e.isRelation(yn.name)&&this.replyCount++}this.onEcho(e,n??!1)}),P(this,"onLocalEcho",e=>{this.onEcho(e,!1)}),P(this,"onEcho",function(){var e=B(function*(e,t){e.threadRootId===r.id&&r.lastEvent!==e&&(yield r.updateThreadMetadata(),e.isRelation(yn.name)&&(t||(r.lastEvent=void 0,r.emit(as.NewReply,r,e))))});return function(t,n){return e.apply(this,arguments)}}()),this.setMaxListeners(1e3),null==n||!n.room)throw new Error("element-web#22141: A thread requires a room in order to function");this.room=n.room,this.client=n.client,this.pendingEventOrdering=null!==(i=n.pendingEventOrdering)&&void 0!==i?i:Qg.Chronological,this.timelineSet=new ng(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new Mv(this),this.reEmitter.reEmit(this.timelineSet,[xe.Timeline,xe.TimelineReset]),this.room.on(qt.BeforeRedaction,this.onBeforeRedaction),this.room.on(xe.Redaction,this.onRedaction),this.room.on(xe.LocalEchoUpdated,this.onLocalEcho),this.room.on(xe.TimelineReset,this.onTimelineReset),this.timelineSet.on(xe.Timeline,this.onTimelineEvent),this.processReceipts(n.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}fetchRootEvent(){var e=this;return B(function*(){try{var t=yield e.client.fetchRoomEvent(e.roomId,e.id),n=e.client.getEventMapper();e.rootEvent=n(t)}catch(e){M.error("Failed to fetch thread root to construct thread with",e)}yield e.processEvent(e.rootEvent)})()}static setServerSideSupport(e){Mn.hasServerSideSupport=e,e!==Ji.Stable&&(_g.setPreferUnstable(!0),Sg.setPreferUnstable(!0),yn.setPreferUnstable(!0))}static setServerSideListSupport(e){Mn.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){Mn.hasServerSideFwdPaginationSupport=e}shouldSendLocalEchoReceipt(e,t){var n;if((null!==(n=this.client.canSupport.get(Xr.RelationsRecursion))&&void 0!==n?n:Yr.Unsupported)===Yr.Unsupported){var r,i=null===(r=this.getReadReceiptForUserId(e))||void 0===r?void 0:r.eventId;if(i){var o=this.findEventById(i);if(o&&o.getTs()>t.getTs())return!1}}return!0}get roomState(){return this.room.getLiveTimeline().getState(Me.FORWARDS)}addEventToTimeline(e,t){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:t,fromCache:!1,roomState:this.roomState,addToState:!1})}insertEventIntoTimeline(e){var t=e.getId();t&&(this.findEventById(t)||this.timelineSet.insertEventIntoTimeline(e,this.liveTimeline,this.roomState,!1))}addEvents(e,t){e.forEach(e=>this.addEvent(e,t,!1)),this.updateThreadMetadata()}addEvent(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.setEventMetadata(e);var r=this.lastReply(),i=!r||e.localTimestamp>=r.localTimestamp;if(Mn.hasServerSideSupport){if(e.isRelation(kn.Annotation)||e.isRelation(kn.Replace))return void this.addRelatedThreadEvent(e,t);!t&&i?(this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e)):t?this.addEventToTimeline(e,t):this.insertEventIntoTimeline(e)}else this.addEventToTimeline(e,t),this.client.decryptEventIfNeeded(e);e.getId()!==this.id&&e.isRelation(yn.name)&&!t&&i&&(this.lastEvent=void 0),n&&(this.emit(as.NewReply,this,e),this.updateThreadMetadata())}addRelatedThreadEvent(e,t){var n,r,i,o;this.initialEventsFetched?(null!==(i=this.client.canSupport.get(Xr.RelationsRecursion))&&void 0!==i?i:Yr.Unsupported)===Yr.Unsupported?this.insertEventIntoTimeline(e):this.addEventToTimeline(e,t):null===(o=this.replayEvents)||void 0===o||o.push(e);null===(n=this.timelineSet.relations)||void 0===n||n.aggregateParentEvent(e),null===(r=this.timelineSet.relations)||void 0===r||r.aggregateChildEvent(e,this.timelineSet)}processEvent(e){var t=this;return B(function*(){e&&(t.setEventMetadata(e),yield t.fetchEditsWhereNeeded(e))})()}processReceipts(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(var{eventId:t,receiptType:n,userId:r,receipt:i,synthetic:o}of e)this.addReceiptToStructure(t,n,r,i,o)}getRootEventBundledRelationship(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rootEvent;return null==e?void 0:e.getServerAggregatedRelation(yn.name)}processRootEvent(){var e=this;return B(function*(){var t=e.getRootEventBundledRelationship();if(Mn.hasServerSideSupport&&t){e.replyCount=t.count,e._currentUserParticipated=!!t.current_user_participated;var n=e.client.getEventMapper();e.lastEvent=n(Q$(Q$({},t.latest_event),{},{room_id:e.roomId})),e.updatePendingReplyCount(),yield e.processEvent(e.lastEvent)}})()}updatePendingReplyCount(){var e=(this.pendingEventOrdering===Qg.Detached?this.room.getPendingEvents():this.events).filter(e=>{var t;return e.threadRootId===this.id&&e.isRelation(yn.name)&&null!==e.status&&e.getId()!==(null===(t=this.lastEvent)||void 0===t?void 0:t.getId())});this.lastPendingEvent=e.length?e[e.length-1]:void 0,this.pendingReplyCount=e.length}resetLiveTimeline(e,t){var n=this;return B(function*(){var r=n.liveTimeline;n.timelineSet.resetLiveTimeline(e??void 0,t??void 0);var i,o,s=n.liveTimeline;e&&(i=(yield n.client.createMessagesRequest(n.roomId,e,1,gt.Forward)).end);t&&(o=(yield n.client.createMessagesRequest(n.roomId,t,1,gt.Backward)).start);t&&r.getPaginationToken(gt.Forward)===t&&r.setPaginationToken(o??null,gt.Forward),e&&s.getPaginationToken(gt.Backward)===e&&s.setPaginationToken(i??null,gt.Backward)})()}updateThreadFromRootEvent(){var e=this;return B(function*(){Mn.hasServerSideSupport&&(!e.initialEventsFetched&&!e.lastEvent&&(yield e.processRootEvent()),yield e.fetchRootEvent()),yield e.processRootEvent()})()}updateThreadMetadata(){var e=this;return B(function*(){if(e.updatePendingReplyCount(),e.processRootEventPromise||(e.processRootEventPromise=e.updateThreadFromRootEvent()),yield e.processRootEventPromise,!e.initialEventsFetched)if(e.initalEventFetchProm)yield e.initalEventFetchProm;else try{for(var t of(e.timelineSet.resetLiveTimeline(),0===e.replyCount&&e.rootEvent?(e.timelineSet.addEventsToTimeline([e.rootEvent],!0,!1,e.liveTimeline,null),e.liveTimeline.setPaginationToken(null,gt.Backward)):(e.initalEventFetchProm=e.client.paginateEventTimeline(e.liveTimeline,{backwards:!0}),yield e.initalEventFetchProm),e.initialEventsFetched=!0,e.replayEvents))e.addEvent(t,!1);e.replayEvents=null,e.emit(xe.TimelineReset,e.room,e.timelineSet,!0)}catch(t){M.error("Failed to load start of newly created thread: ",t),e.initialEventsFetched=!1}e.emit(as.Update,e)})()}fetchEditsWhereNeeded(){var e=arguments,t=this;return B(function*(){var n,r;if((null!==(n=t.client.canSupport.get(Xr.RelationsRecursion))&&void 0!==n?n:Yr.Unsupported)===Yr.Unsupported){for(var i=e.length,o=new Array(i),s=0;s<i;s++)o[s]=e[s];return Promise.all(o.filter(Tye).map((r=B(function*(e){try{var n=yield t.client.relations(t.roomId,e.getId(),kn.Replace,e.getType(),{limit:1});if(n.events.length){var r=n.events[0];e.makeReplaced(r),t.insertEventIntoTimeline(r)}}catch(e){M.error("Failed to load edits for encrypted thread event",e)}}),function(e){return r.apply(this,arguments)})))}})()}setEventMetadata(e){e&&(Me.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){var t;e&&(e.setThread(void 0),null===(t=e.event)||void 0===t||null===(t=t.unsigned)||void 0===t||null===(t=t["m.relations"])||void 0===t||delete t[yn.name])}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e.isRelation(yn.name),t=this.timeline.length-1;t>=0;t--){var n=this.timeline[t];if(e(n))return n}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){var e,t;return null!==(e=null!==(t=this.lastPendingEvent)&&void 0!==t?t:this.lastEvent)&&void 0!==e?e:this.lastReply()}get timeline(){return this.events}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof Zi}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,t){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,t){var n=e===this.client.getUserId(),r=this.timeline[this.timeline.length-1];if(n&&r){var i=r.getTs()<this.room.getOldestThreadedReceiptTs(),o=r.getId();if(i&&o)return o}var s=super.getEventReadUpTo(e,t);if(r){var a=this.room.getLastUnthreadedReceiptFor(e);if(!a)return s;for(var l=(null===(c=this.timeline)||void 0===c?void 0:c.length)-1;l>=0;--l){var c,u,d=this.timeline[l];if(d.getId()===s)return s;if(d.getTs()<a.ts)return null!==(u=d.getId())&&void 0!==u?u:s}}return s}hasUserReadEvent(e,t){if(e===this.client.getUserId()){var n,r,i,o,s,a,l=(null!==(n=null===(r=this.lastReply())||void 0===r?void 0:r.getTs())&&void 0!==n?n:0)<this.room.getOldestThreadedReceiptTs(),c=null!==(i=null===(o=this.room.getLastUnthreadedReceiptFor(e))||void 0===o?void 0:o.ts)&&void 0!==i?i:0,u=(null!==(s=null==this||null===(a=this.lastReply())||void 0===a?void 0:a.getTs())&&void 0!==s?s:0)<c;if(l||u)return!0}return this.room.hasUserReadEvent(e,t)}setUnread(e,t){return this.room.setThreadUnreadNotificationCount(this.id,e,t)}getLastUnthreadedReceiptFor(e){return this.room.getLastUnthreadedReceiptFor(e)}}function Tye(e){return e.isEncrypted()&&(e.isRelation(yn.name)||e.isThreadRoot)}P(Mn,"hasServerSideSupport",Ji.None),P(Mn,"hasServerSideListSupport",Ji.None),P(Mn,"hasServerSideFwdPaginationSupport",Ji.None);var _g=new M3("related_by_senders","io.element.relation_senders"),Sg=new M3("related_by_rel_types","io.element.relation_types"),yn=new M3("m.thread","io.element.thread"),Ua=function(e){return e[e.My=0]="My",e[e.All=1]="All",e}({});function iQ(e){return e===Ua.My?"participated":"all"}class Z$ extends Error{constructor(e,t,n){super(t),this.code=e,P(this,"detailedString",void 0),this.name="DecryptionError",this.detailedString=Rye(this,n)}}function Rye(e,t){var n=e.name+"[msg: "+e.message;return t&&(n+=", "+Object.keys(t).map(e=>e+": "+t[e]).join(", ")),n+="]"}var eB=Object.freeze({visible:!0}),qt=function(e){return e.Decrypted="Event.decrypted",e.BeforeRedaction="Event.beforeRedaction",e.VisibilityChange="Event.visibilityChange",e.LocalEventIdReplaced="Event.localEventIdReplaced",e.Status="Event.status",e.Replaced="Event.replaced",e.RelationsCreated="Event.relationsCreated",e.SentinelUpdated="Event.sentinelUpdated",e}({});class Zi extends Pn{setMetadata(e,t){var n,r,i=this.isState()&&this.getType()===ee.RoomMember&&this.getSender()===this.getStateKey(),o=!1;if(i||null===(n=this.sender)||void 0===n||null===(n=n.events)||void 0===n||!n.member){var s=e.getSentinelMember(this.getSender());s!==this.sender&&(o=!0),this.sender=s}if(i||(null===(r=this.target)||void 0===r||null===(r=r.events)||void 0===r||!r.member)&&this.getType()===ee.RoomMember){var a=e.getSentinelMember(this.getStateKey());a!==this.target&&(o=!0),this.target=a}this.isState()&&t&&(this.forwardLooking=!1),o&&this.emit(qt.SentinelUpdated)}constructor(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.event=t,P(this,"pushDetails",{}),P(this,"_replacingEvent",null),P(this,"_localRedactionEvent",null),P(this,"_isCancelled",!1),P(this,"clearEvent",void 0),P(this,"visibility",eB),P(this,"_hasCachedExtEv",!1),P(this,"_cachedExtEv",void 0),P(this,"_decryptionFailureReason",null),P(this,"senderCurve25519Key",null),P(this,"claimedEd25519Key",null),P(this,"forwardingCurve25519KeyChain",[]),P(this,"untrusted",null),P(this,"decryptionPromise",null),P(this,"retryDecryption",!1),P(this,"txnId",void 0),P(this,"thread",void 0),P(this,"threadId",void 0),P(this,"localTimestamp",void 0),P(this,"sender",null),P(this,"target",null),P(this,"status",null),P(this,"error",null),P(this,"forwardLooking",!0),P(this,"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach(e=>{"string"==typeof t[e]&&(t[e]=ck(t[e]))}),["membership","avatar_url","displayname"].forEach(e=>{var n;"string"==typeof(null===(n=t.content)||void 0===n?void 0:n[e])&&(t.content[e]=ck(t.content[e]))}),["rel_type"].forEach(e=>{var n;"string"==typeof(null===(n=t.content)||void 0===n||null===(n=n["m.relates_to"])||void 0===n?void 0:n[e])&&(t.content["m.relates_to"][e]=ck(t.content["m.relates_to"][e]))}),this.txnId=t.txn_id;var n=this.getAge();this.localTimestamp=void 0!==n?Date.now()-n:null!==(e=this.getTs())&&void 0!==e?e:Date.now(),this.reEmitter=new Mv(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=Ys.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){var e=Object.assign({},this.getContent());if(this.getWireType()===ee.RoomMessageEncrypted)for(var[t,n]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(t)||void 0===e[t]&&(e[t]=n);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){var e,t=this.getRoomId();if(t)return"id=".concat(this.getId()," type=").concat(this.getWireType()," sender=").concat(this.getSender()," room=").concat(t," ts=").concat(null===(e=this.getDate())||void 0===e?void 0:e.toISOString());var n=this.getContent()[j3];return"msgid=".concat(n," type=").concat(this.getWireType()," sender=").concat(this.getSender())}getOriginalContent(){var e,t;return this._localRedactionEvent?{}:this.clearEvent?null!==(t=this.clearEvent.content)&&void 0!==t?t:{}:null!==(e=this.event.content)&&void 0!==e?e:{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?null!==(e=this._replacingEvent.getContent()["m.new_content"])&&void 0!==e?e:{}:this.getOriginalContent();var e}getWireContent(){return this.event.content||{}}get threadRootId(){var e;if(!this.isState()){var t=null===(e=this.getWireContent())||void 0===e?void 0:e["m.relates_to"];if((null==t?void 0:t.rel_type)===yn.name)return t.event_id;if(this.thread)return this.thread.id;if(void 0!==this.threadId)return this.threadId;var n=this.getUnsigned();if("string"==typeof n[Yw.name])return n[Yw.name]}}get isThreadRoot(){return!this.isState()&&(!!this.getServerAggregatedRelation(yn.name)||this.threadRootId===this.getId())}get replyEventId(){var e;return null===(e=this.getWireContent()["m.relates_to"])||void 0===e||null===(e=e["m.in_reply_to"])||void 0===e?void 0:e.event_id}get relationEventId(){var e;return null===(e=this.getWireContent())||void 0===e||null===(e=e["m.relates_to"])||void 0===e?void 0:e.event_id}getPrevContent(){return this.getUnsigned().prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return void 0!==this.event.state_key}getMembershipAtEvent(){var e=this.getUnsigned();return UX.findIn(e)}makeEncrypted(e,t,n,r){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=n,this.claimedEd25519Key=r}isBeingDecrypted(){return null!=this.decryptionPromise}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){return null!==this._decryptionFailureReason}get decryptionFailureReason(){return this._decryptionFailureReason}get isEncryptedDisabledForUnverifiedDevices(){return this.decryptionFailureReason===$$.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}attemptDecryption(e){var t=arguments,n=this;return B(function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};if(!n.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");var i=n.clearEvent&&!n.isDecryptionFailure(),o=r.forceRedecryptIfUntrusted&&n.isKeySourceUntrusted();if(i&&!o)throw new Error("Attempt to decrypt event which has already been decrypted");return n.decryptionPromise?(M.log("Event ".concat(n.getId()," already being decrypted; queueing a retry")),n.retryDecryption=!0,n.decryptionPromise):(n.decryptionPromise=n.decryptionLoop(e,r),n.decryptionPromise)})()}getKeyRequestRecipients(e){return[{userId:e,deviceId:"*"}]}decryptionLoop(e){var t=arguments,n=this;return B(function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};for(yield Promise.resolve();;){n.retryDecryption=!1;var i=void 0;try{var o=yield e.decryptEvent(n);!0===r.isRetry&&M.info("Decrypted event on retry (".concat(n.getDetails(),")")),n.setClearData(o),n._decryptionFailureReason=null}catch(e){var s=e instanceof Z$?e.detailedString:String(e);if(i=e,n.retryDecryption){M.log("Error decrypting event (".concat(n.getDetails(),"), but retrying: ").concat(s));continue}M.warn("Error decrypting event (".concat(n.getDetails(),"): ").concat(s)),n.setClearDataForDecryptionFailure(String(e)),n._decryptionFailureReason=e instanceof Z$?e.code:$$.UNKNOWN_ERROR}return n.decryptionPromise=null,n.retryDecryption=!1,n.setPushDetails(),void(!1!==r.emit&&n.emit(qt.Decrypted,n,i))}})()}setClearData(e){var t,n;this.clearEvent=e.clearEvent,this.senderCurve25519Key=null!==(t=e.senderCurve25519Key)&&void 0!==t?t:null,this.claimedEd25519Key=null!==(n=e.claimedEd25519Key)&&void 0!==n?n:null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}setClearDataForDecryptionFailure(e){this.clearEvent={type:ee.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: ".concat(e," **")}},this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===ee.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit(qt.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){var t,n,r=null===(t=null==e?void 0:e.visible)||void 0===t||t,i=null!==(n=null==e?void 0:e.reason)&&void 0!==n?n:null,o=!1;(this.visibility.visible!==r||!this.visibility.visible&&this.visibility.reason!==i)&&(o=!0),o&&(this.visibility=r?eB:Object.freeze({visible:!1,reason:i}),this.emit(qt.VisibilityChange,this,r))}messageVisibility(){return this.visibility}makeRedacted(e,t){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");for(var n in this._localRedactionEvent=null,this.emit(qt.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(n)&&!Iye.has(n)&&delete this.event[n];this.isEncrypted()&&(this.clearEvent=void 0);var r=this.getType()in tB?tB[this.getType()]:{},i=this.getContent();for(var o in i)i.hasOwnProperty(o)&&!r[o]&&delete i[o];!this.isThreadRoot&&this.threadRootId&&this.threadRootId!==this.getId()&&(this.moveAllRelatedToMainTimeline(t),e.moveToMainTimeline(t)),this.invalidateExtensibleEvent()}moveAllRelatedToMainTimeline(e){var t=this.thread;if(this.moveToMainTimeline(e),t)for(var n of t.events){var r;(null===(r=n.getRelation())||void 0===r?void 0:r.event_id)===this.getId()&&n.moveAllRelatedToMainTimeline(e)}}moveToMainTimeline(e){var t;null===(t=this.thread)||void 0===t||t.timelineSet.removeEvent(this.getId()),this.setThread(void 0);var n=e.getLiveTimeline();n.getTimelineSet().insertEventIntoTimeline(this,n,n.getState(Me.FORWARDS),!1)}isRedacted(){return!!this.getUnsigned().redacted_because}isRedaction(){return this.getType()===ee.RoomRedaction}asVisibilityChange(){if(!Ah.matches(this.getType()))return null;var e=this.getRelation();if(!e||"m.reference"!=e.rel_type)return null;var t=e.event_id;if(!t)return null;var n=this.getWireContent(),r=!!n.visible,i=n.reason;return i&&"string"!=typeof i?null:{visible:r,reason:i,eventId:t}}isVisibilityEvent(){return Ah.matches(this.getType())}getRedactionEvent(){var e,t,n,r;return this.isRedacted()?null!==(e=this.clearEvent)&&void 0!==e&&e.unsigned?null!==(n=null===(r=this.clearEvent)||void 0===r?void 0:r.unsigned.redacted_because)&&void 0!==n?n:null:null!==(t=this.event.unsigned)&&void 0!==t&&t.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushDetails.actions||null}getPushDetails(){return this.pushDetails}setPushDetails(e,t){this.pushDetails={actions:e,rule:t}}handleRemoteEcho(e){var t,n=this.getUnsigned(),r=this.getId();this.event=e,n.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=n.redacted_because),this.setStatus(null),this.getId()!==r&&this.emit(qt.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-(null!==(t=this.getAge())&&void 0!==t?t:0)}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit(qt.Status,this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit(qt.LocalEventIdReplaced,this)}isRelation(e){var t,n=null===(t=this.getWireContent())||void 0===t?void 0:t["m.relates_to"];return!(this.isState()&&null!=n&&n.rel_type&&[kn.Replace,kn.Thread].includes(n.rel_type))&&!(null==n||!n.rel_type||!n.event_id||e&&n.rel_type!==e)}getRelation(){var e;return this.isRelation()&&null!==(e=this.getWireContent()["m.relates_to"])&&void 0!==e?e:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=e??null,this.emit(qt.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var t;return null===(t=this.getUnsigned()["m.relations"])||void 0===t?void 0:t[e]}replacingEventId(){var e=this.getServerAggregatedRelation(kn.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}replacingEvent(){return this._replacingEvent}replacingEventDate(){var e=this.getServerAggregatedRelation(kn.Replace);if(e){var t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent){var n;return null!==(n=this._replacingEvent.getDate())&&void 0!==n?n:void 0}}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){var e=this.getRelation();return this.replyEventId?this.replyEventId:e?e.event_id:this.isRedaction()?this.event.redacts:void 0}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){var t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){var e=new Zi(JSON.parse(JSON.stringify(this.event)));for(var[t,n]of Object.entries(this))"event"!==t&&(e[t]=n);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;var t=x5(this.event),n=x5(e.event);return JSON.stringify(t)===JSON.stringify(n)}toJSON(){var e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.isState()||(this.thread&&this.reEmitter.stopReEmitting(this.thread,[as.Update]),this.thread=e,this.setThreadId(null==e?void 0:e.id),e&&this.reEmitter.reEmit(e,[as.Update]))}getThread(){return this.thread}setThreadId(e){this.threadId=e}}var Iye=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),tB={[ee.RoomMember]:{membership:1},[ee.RoomJoinRules]:{join_rule:1},[ee.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}},kye=["org.matrix.hydra.11","12"];function xye(e){return kye.includes(e)}var ho=function(e){return e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished",e}(ho||{}),vt=function(e){return e.Events="RoomState.events",e.Members="RoomState.members",e.NewMember="RoomState.newMember",e.Update="RoomState.update",e.BeaconLiveness="RoomState.BeaconLiveness",e.Marker="RoomState.Marker",e}({});class lb extends Pn{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{status:ho.NotStarted};super(),this.roomId=e,this.oobMemberFlags=t,P(this,"reEmitter",new Mv(this)),P(this,"sentinels",{}),P(this,"displayNameToUserIds",new Map),P(this,"userIdsToDisplayNames",{}),P(this,"tokenToInvite",{}),P(this,"joinedMemberCount",null),P(this,"summaryJoinedMemberCount",null),P(this,"invitedMemberCount",null),P(this,"summaryInvitedMemberCount",null),P(this,"modified",-1),P(this,"members",{}),P(this,"events",new Map),P(this,"paginationToken",null),P(this,"beacons",new Map),P(this,"_liveBeaconIds",[]),P(this,"getVersionWarning",!1),this.updateModifiedTime()}getRoomVersion(){var e,t=this.getStateEvents(ee.RoomCreate,"");return t?null!==(e=t.getContent().room_version)&&void 0!==e?e:"1":(this.getVersionWarning||(M.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}getJoinedMemberCount(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce((e,t)=>t.membership===Ve.Join?e+1:e,0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce((e,t)=>t.membership===Ve.Invite?e+1:e,0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter(t=>!e.includes(t.userId))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;var t=this.sentinels[e];if(void 0===t){t=new tb(this.roomId,e);var n=this.members[e];null!=n&&n.events.member&&t.setMembershipEvent(n.events.member,this),this.sentinels[e]=t}return t}getStateEvents(e,t){return this.events.has(e)?void 0===t?Array.from(this.events.get(e).values()):this.events.get(e).get(t)||null:void 0===t?[]:null}get hasLiveBeacons(){var e;return!(null===(e=this.liveBeaconIds)||void 0===e||!e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){var e=new lb(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=ho.NotStarted,Array.from(this.events.values()).forEach(t=>{e.setStateEvents(Array.from(t.values()))}),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==ho.Finished&&this.getMembers().forEach(t=>{var n;t.isOutOfBand()&&(null===(n=e.getMember(t.userId))||void 0===n||n.markOutOfBand())}),e}setUnknownStateEvents(e){var t=e.filter(e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey()));this.setStateEvents(t)}setStateEvents(e,t){this.updateModifiedTime(),e.forEach(e=>{if(e.getRoomId()===this.roomId&&e.isState()){qP.matches(e.getType())&&this.setBeacon(e);var t,n=this.getStateEventMatching(e);if(this.setStateEvent(e),e.getType()===ee.RoomMember)this.updateDisplayNameCache(e.getStateKey(),null!==(t=e.getContent().displayname)&&void 0!==t?t:""),this.updateThirdPartyTokenCache(e);this.emit(vt.Events,e,this,n)}}),this.onBeaconLivenessChange(),e.forEach(e=>{if(e.getRoomId()===this.roomId&&e.isState())if(e.getType()===ee.RoomMember){var n=e.getStateKey();(e.getContent().membership===Ve.Leave||e.getContent().membership===Ve.Ban)&&(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);var r=this.getOrCreateMember(n,e);r.setMembershipEvent(e,this),this.updateMember(r),this.emit(vt.Members,e,this,r)}else if(e.getType()===ee.RoomPowerLevels){if(""!==e.getStateKey())return;var i=Object.values(this.members),o=this.getStateEvents(ee.RoomCreate,""),s=nB(this.getRoomVersion(),o);i.forEach(t=>{var n=t.getLastModifiedTime();if(o){var r=rB(t.userId,e,s);t.setPowerLevel(r,e)}n!==t.getLastModifiedTime()&&this.emit(vt.Members,e,this,t)}),this.sentinels={}}else MX.matches(e.getType())&&this.emit(vt.Marker,e,t)}),this.emit(vt.Update,this)}processBeaconEvents(e,t){var n=this;return B(function*(){if(e.length&&n.beacons.size){var r,i=[...n.beacons.values()].reduce((e,t)=>(e[t.beaconInfoId]=t,e),{}),o=(e,t)=>{if(tA.matches(t.getType())){var n=i[e];n&&n.addLocations([t])}},s=function*(e){var n,r=null===(n=e.getRelation())||void 0===n?void 0:n.event_id;if(!r||!i[r])return{v:void 0};if(!tA.matches(e.getType())&&!e.isEncrypted())return{v:void 0};try{yield t.decryptEventIfNeeded(e),o(r,e)}catch{e.isDecryptionFailure()&&e.once(qt.Decrypted,B(function*(){o(r,e)}))}};for(var a of e)if(r=yield*s(a))return r.v}})()}getOrCreateMember(e,t){var n=this.members[e];return n||(n=new tb(this.roomId,e),this.members[e]=n,this.emit(vt.NewMember,t,this,n)),n}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var t=Jw(e);if(this.beacons.has(t)){var n,r=this.beacons.get(t);return e.isRedacted()?void(r.beaconInfoId===(null===(n=e.getRedactionEvent())||void 0===n?void 0:n.redacts)&&(r.destroy(),this.beacons.delete(t))):r.update(e)}if(!e.isRedacted()){var i=new oJ(e);this.reEmitter.reEmit(i,[$n.New,$n.Update,$n.Destroy,$n.LivenessChange]),this.emit($n.New,e,i),i.on($n.LivenessChange,this.onBeaconLivenessChange.bind(this)),i.on($n.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(i.identifier,i)}}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter(e=>e.isLive).map(e=>e.identifier),this.emit(vt.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var t,n;return null!==(t=null===(n=this.events.get(e.getType()))||void 0===n?void 0:n.get(e.getStateKey()))&&void 0!==t?t:null}updateMember(e){var t=this.getStateEvents(ee.RoomCreate,""),n=this.getStateEvents(ee.RoomPowerLevels,"");if(n&&t){var r=rB(e.userId,n,nB(this.getRoomVersion(),t));e.setPowerLevel(r,n)}delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===ho.NotStarted}outOfBandMembersReady(){return this.oobMemberFlags.status===ho.Finished}markOutOfBandMembersStarted(){this.oobMemberFlags.status===ho.NotStarted&&(this.oobMemberFlags.status=ho.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===ho.InProgress&&(this.oobMemberFlags.status=ho.NotStarted)}clearOutOfBandMembers(){var e=0;Object.keys(this.members).forEach(t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])}),M.log("LL: RoomState removed ".concat(e," members...")),this.oobMemberFlags.status=ho.NotStarted}setOutOfBandMembers(e){M.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),this.oobMemberFlags.status===ho.InProgress&&(M.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=ho.Finished,e.forEach(e=>this.setOutOfBandMember(e)),this.emit(vt.Update,this))}setOutOfBandMember(e){if(e.getType()===ee.RoomMember){var t=e.getStateKey(),n=this.getMember(t);if(!n||n.isOutOfBand()){var r=this.getOrCreateMember(t,e);r.setMembershipEvent(e,this),r.markOutOfBand(),this.updateDisplayNameCache(r.userId,r.name),this.setStateEvent(e),this.updateMember(r),this.emit(vt.Members,e,this,r)}}}setTypingEvent(e){Object.values(this.members).forEach(function(t){t.setTypingEvent(e)})}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var t;return null!==(t=this.displayNameToUserIds.get(Qd(e)))&&void 0!==t?t:[]}maySendRedactionForEvent(e,t){var n=this.getMember(t);return!(!n||n.membership===Ve.Leave||e.status||e.isRedacted())&&(!!this.maySendEvent(ee.RoomRedaction,t)&&(e.getSender()===t||this.hasSufficientPowerLevelFor("redact",n.powerLevel)))}hasSufficientPowerLevelFor(e,t){var n=this.getStateEvents(ee.RoomPowerLevels,""),r={};n&&(r=n.getContent());var i=50;return _F(r[e])&&(i=r[e]),t>=i}maySendMessage(e){return this.maySendEventOfType(ee.RoomMessage,e,!1)}maySendEvent(e,t){return this.maySendEventOfType(e,t,!1)}mayClientSendStateEvent(e,t){return!(t.isGuest()||!t.credentials.userId)&&this.maySendStateEvent(e,t.credentials.userId)}maySendStateEvent(e,t){return this.maySendEventOfType(e,t,!0)}maySendEventOfType(e,t,n){var r,i,o=this.getStateEvents(ee.RoomPowerLevels,""),s={},a=0,l=0;o&&(s=(i=o.getContent()).events||{},a=Number.isSafeInteger(i.state_default)?i.state_default:50,Number.isSafeInteger(i.events_default)&&(l=i.events_default));var c=n?a:l;Number.isSafeInteger(s[e])&&(c=s[e]);var u=this.getMember(t);return(null!==(r=null==u?void 0:u.powerLevel)&&void 0!==r?r:0)>=c}mayTriggerNotifOfType(e,t){var n=this.getMember(t);if(!n)return!1;var r=this.getStateEvents(ee.RoomPowerLevels,""),i=50;return r&&r.getContent()&&r.getContent().notifications&&_F(r.getContent().notifications[e])&&(i=r.getContent().notifications[e]),n.powerLevel>=i}getJoinRule(){var e,t=this.getStateEvents(ee.RoomJoinRules,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).join_rule||ef.Invite}getHistoryVisibility(){var e,t=this.getStateEvents(ee.RoomHistoryVisibility,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).history_visibility||VP.Shared}getGuestAccess(){var e,t=this.getStateEvents(ee.RoomGuestAccess,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).guest_access||eC.Forbidden}findPredecessor(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){var e=this.getStateEvents(ee.RoomPredecessor,"");if(e){var t=e.getContent(),n=t.predecessor_room_id,r=t.last_known_event_id;"string"!=typeof r&&(r=void 0);var i=t.via_servers;if(Array.isArray(i)||(i=void 0),"string"==typeof n)return{roomId:n,eventId:r,viaServers:i}}}var o=this.getStateEvents(ee.RoomCreate,"");if(o){var s=o.getContent().predecessor;if(s){var a=s.room_id;if("string"==typeof a){var l=s.event_id;return("string"!=typeof l||""===l)&&(l=void 0),{roomId:a,eventId:l}}}}return null}updateThirdPartyTokenCache(e){if(e.getContent().third_party_invite){var t=(e.getContent().third_party_invite.signed||{}).token;if(t)this.getStateEvents(ee.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}}updateDisplayNameCache(e,t){var n=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],n){var r=Qd(n),i=this.displayNameToUserIds.get(r);if(i){var o=i.filter(t=>t!==e);this.displayNameToUserIds.set(r,o)}}this.userIdsToDisplayNames[e]=t;var s=t&&Qd(t);if(s){var a,l=null!==(a=this.displayNameToUserIds.get(s))&&void 0!==a?a:[];l.push(e),this.displayNameToUserIds.set(s,l)}}}function nB(e,t){var n=new Set;if(xye(e)&&t){var r=t.getSender();r&&n.add(r);var i=t.getDirectionalContent().additional_creators;Array.isArray(i)&&i.forEach(e=>n.add(e))}return n}function rB(e,t,n){if(n.has(e))return 1/0;var r=t.getDirectionalContent(),i=r.users||{};return void 0!==i[e]&&Number.isInteger(i[e])?i[e]:void 0!==r.users_default?r.users_default:0}function iB(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}class ub{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};P(this,"rooms",{}),P(this,"users",{}),P(this,"syncToken",null),P(this,"filters",new pu(()=>new Map)),P(this,"accountData",new Map),P(this,"localStorage",void 0),P(this,"oobMembers",new Map),P(this,"pendingEvents",{}),P(this,"clientOptions",void 0),P(this,"pendingToDeviceBatches",[]),P(this,"nextToDeviceBatchId",0),P(this,"createUser",void 0),P(this,"onRoomMember",(e,t,n)=>{var r;if(n.membership!==Ve.Invite){var i=this.users[n.userId]||(null===(r=this.createUser)||void 0===r?void 0:r.call(this,n.userId));n.name&&(i.setDisplayName(n.name),n.events.member&&i.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&i.setAvatarUrl(n.events.member.getContent().avatar_url),this.users[i.userId]=i}}),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(vt.Members,this.onRoomMember),e.currentState.getMembers().forEach(t=>{this.onRoomMember(null,e.currentState,t)})}setUserCreator(e){this.createUser=e}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(vt.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map(function(e){return e.summary})}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,t){return[]}storeEvents(e,t,n,r){}storeFilter(e){null==e||!e.userId||null==e||!e.filterId||this.filters.getOrCreate(e.userId).set(e.filterId,e)}getFilter(e,t){var n;return(null===(n=this.filters.get(e))||void 0===n?void 0:n.get(t))||null}getFilterIdByName(e){if(!this.localStorage)return null;var t="mxjssdk_memory_filter_"+e;try{var n=this.localStorage.getItem(t);if(iB(n))return n}catch{}return null}setFilterIdByName(e,t){if(this.localStorage){var n="mxjssdk_memory_filter_"+e;try{iB(t)?this.localStorage.setItem(n,t):this.localStorage.removeItem(n)}catch{}}}storeAccountDataEvents(e){e.forEach(e=>{!Object.keys(e.getContent()).length?this.accountData.delete(e.getType()):this.accountData.set(e.getType(),e)})}getAccountData(e){return this.accountData.get(e)}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters=new pu(()=>new Map),this.accountData=new Map,Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers.get(e)||null)}setOutOfBandMembers(e,t){return this.oobMembers.set(e,t),Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers.delete(e),Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}getPendingEvents(e){var t=this;return B(function*(){var n;return null!==(n=t.pendingEvents[e])&&void 0!==n?n:[]})()}setPendingEvents(e,t){var n=this;return B(function*(){n.pendingEvents[e]=t})()}saveToDeviceBatches(e){for(var t of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:t.eventType,txnId:t.txnId,batch:t.batch});return Promise.resolve()}getOldestToDeviceBatch(){var e=this;return B(function*(){return 0===e.pendingToDeviceBatches.length?null:e.pendingToDeviceBatches[0]})()}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter(t=>t.id!==e),Promise.resolve()}destroy(){return B(function*(){})()}}var sQ=(e=>(e.ToWidget="toWidget",e.FromWidget="fromWidget",e))(sQ||{});function Aye(e){if("toWidget"===e)return"fromWidget";if("fromWidget"===e)return"toWidget";throw new Error("Invalid direction")}var ql=(e=>(e.MSC2762="org.matrix.msc2762",e.MSC2762_UPDATE_STATE="org.matrix.msc2762_update_state",e.MSC2871="org.matrix.msc2871",e.MSC2873="org.matrix.msc2873",e.MSC2931="org.matrix.msc2931",e.MSC2974="org.matrix.msc2974",e.MSC2876="org.matrix.msc2876",e.MSC3819="org.matrix.msc3819",e.MSC3846="town.robin.msc3846",e.MSC3869="org.matrix.msc3869",e.MSC3973="org.matrix.msc3973",e.MSC4039="org.matrix.msc4039",e))(ql||{});const Lye=["0.0.1","0.0.2","org.matrix.msc2762","org.matrix.msc2762_update_state","org.matrix.msc2871","org.matrix.msc2873","org.matrix.msc2931","org.matrix.msc2974","org.matrix.msc2876","org.matrix.msc3819","town.robin.msc3846","org.matrix.msc3869","org.matrix.msc3973","org.matrix.msc4039"];class Pye extends U3.EventEmitter{constructor(e,t,n,r){super(),this.sendDirection=e,this.initialWidgetId=t,this.transportWindow=n,this.inboundWindow=r,this.strictOriginCheck=!1,this.targetOrigin="*",this.timeoutSeconds=10,this._ready=!1,this._widgetId=null,this.outboundRequests=new Map,this.stopController=new AbortController,this._widgetId=t}get ready(){return this._ready}get widgetId(){return this._widgetId||null}get nextRequestId(){const e=`widgetapi-${Date.now()}`;let t=0,n=e;for(;this.outboundRequests.has(n);)n=`${e}-${t++}`;return this.outboundRequests.set(n,null),n}sendInternal(e){console.log(`[PostmessageTransport] Sending object to ${this.targetOrigin}: `,e),this.transportWindow.postMessage(e,this.targetOrigin)}reply(e,t){return this.sendInternal({...e,response:t})}send(e,t){return this.sendComplete(e,t).then(e=>e.response)}sendComplete(e,t){if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));const n={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:t};return e===hr.UpdateVisibility&&(n.visible=t.visible),new Promise((e,t)=>{const r=e=>{s(),t(e)},i=setTimeout(()=>r(new Error("Request timed out")),1e3*(this.timeoutSeconds||1)),o=()=>r(new Error("Transport stopped"));this.stopController.signal.addEventListener("abort",o);const s=()=>{this.outboundRequests.delete(n.requestId),clearTimeout(i),this.stopController.signal.removeEventListener("abort",o)};this.outboundRequests.set(n.requestId,{request:n,resolve:t=>{s(),e(t)},reject:r}),this.sendInternal(n)})}start(){this.inboundWindow.addEventListener("message",e=>{this.handleMessage(e)}),this._ready=!0}stop(){this._ready=!1,this.stopController.abort()}handleMessage(e){if(this.stopController.signal.aborted||!e.data||this.strictOriginCheck&&e.origin!==window.origin)return;const t=e.data;if(t.action&&t.requestId&&t.widgetId)if(t.response){if(t.api!==this.sendDirection)return;this.handleResponse(t)}else{const e=t;if(e.api!==Aye(this.sendDirection))return;this.handleRequest(e)}}handleRequest(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}handleResponse(e){if(e.widgetId!==this.widgetId)return;const t=this.outboundRequests.get(e.requestId);if(t)if(Mye(e.response)){const{message:n,...r}=e.response.error;t.reject(new aC(n,r))}else t.resolve(e)}}var hr=(e=>(e.SupportedApiVersions="supported_api_versions",e.Capabilities="capabilities",e.NotifyCapabilities="notify_capabilities",e.ThemeChange="theme_change",e.LanguageChange="language_change",e.TakeScreenshot="screenshot",e.UpdateVisibility="visibility",e.OpenIDCredentials="openid_credentials",e.WidgetConfig="widget_config",e.CloseModalWidget="close_modal",e.ButtonClicked="button_clicked",e.SendEvent="send_event",e.SendToDevice="send_to_device",e.UpdateState="update_state",e.UpdateTurnServers="update_turn_servers",e))(hr||{}),Wn=(e=>(e.SupportedApiVersions="supported_api_versions",e.ContentLoaded="content_loaded",e.SendSticker="m.sticker",e.UpdateAlwaysOnScreen="set_always_on_screen",e.GetOpenIDCredentials="get_openid",e.CloseModalWidget="close_modal",e.OpenModalWidget="open_modal",e.SetModalButtonEnabled="set_button_enabled",e.SendEvent="send_event",e.SendToDevice="send_to_device",e.WatchTurnServers="watch_turn_servers",e.UnwatchTurnServers="unwatch_turn_servers",e.BeeperReadRoomAccountData="com.beeper.read_room_account_data",e.MSC2876ReadEvents="org.matrix.msc2876.read_events",e.MSC2931Navigate="org.matrix.msc2931.navigate",e.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",e.MSC3869ReadRelations="org.matrix.msc3869.read_relations",e.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",e.MSC4039GetMediaConfigAction="org.matrix.msc4039.get_media_config",e.MSC4039UploadFileAction="org.matrix.msc4039.upload_file",e.MSC4039DownloadFileAction="org.matrix.msc4039.download_file",e.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",e))(Wn||{}),Ym=(e=>(e.Allowed="allowed",e.Blocked="blocked",e.PendingUserConfirmation="request",e))(Ym||{}),oQ=(e=>(e.Custom="m.custom",e.JitsiMeet="m.jitsi",e.Stickerpicker="m.stickerpicker",e))(oQ||{}),aQ=(e=>(e.Close="m.close",e))(aQ||{}),Oc=(e=>(e.Send="send",e.Receive="receive",e))(Oc||{});class Yi{constructor(e,t,n,r,i){this.direction=e,this.eventType=t,this.kind=n,this.keyStr=r,this.raw=i}matchesAsStateEvent(e,t,n){return"state_event"===this.kind&&this.direction===e&&this.eventType===t&&(null===this.keyStr||this.keyStr===n)}matchesAsToDeviceEvent(e,t){return!("to_device"!==this.kind||this.direction!==e||this.eventType!==t)}matchesAsRoomEvent(e,t,n=null){return"event"===this.kind&&this.direction===e&&this.eventType===t&&("m.room.message"!==this.eventType||(null===this.keyStr||this.keyStr===n))}matchesAsRoomAccountData(e,t){return!("room_account"!==this.kind||this.direction!==e||this.eventType!==t)}static forStateEvent(e,t,n){const r=`org.matrix.msc2762.${e}.state_event:${t=t.replace(/#/g,"\\#")}${n=null!=n?`#${n}`:""}`;return Yi.findEventCapabilities([r])[0]}static forToDeviceEvent(e,t){const n=`org.matrix.msc3819.${e}.to_device:${t}`;return Yi.findEventCapabilities([n])[0]}static forRoomEvent(e,t){const n=`org.matrix.msc2762.${e}.event:${t}`;return Yi.findEventCapabilities([n])[0]}static forRoomMessageEvent(e,t){const n=`org.matrix.msc2762.${e}.event:m.room.message#${t=t??""}`;return Yi.findEventCapabilities([n])[0]}static forRoomAccountData(e,t){const n=`com.beeper.capabilities.${e}.room_account_data:${t}`;return Yi.findEventCapabilities([n])[0]}static findEventCapabilities(e){const t=[];for(const n of e){let e,r=null,i=null;if(n.startsWith("org.matrix.msc2762.send.event:")?(r="send",i="event",e=n.substring(30)):n.startsWith("org.matrix.msc2762.send.state_event:")?(r="send",i="state_event",e=n.substring(36)):n.startsWith("org.matrix.msc3819.send.to_device:")?(r="send",i="to_device",e=n.substring(34)):n.startsWith("org.matrix.msc2762.receive.event:")?(r="receive",i="event",e=n.substring(33)):n.startsWith("org.matrix.msc2762.receive.state_event:")?(r="receive",i="state_event",e=n.substring(39)):n.startsWith("org.matrix.msc3819.receive.to_device:")?(r="receive",i="to_device",e=n.substring(37)):n.startsWith("com.beeper.capabilities.receive.room_account_data:")&&(r="receive",i="room_account",e=n.substring(50)),null===r||null===i||void 0===e)continue;const o=e.startsWith("m.room.message#")||"state_event"===i;let s=null;if(e.includes("#")&&o){const t=e.split("#"),n=t.findIndex(e=>!e.endsWith("\\"));e=t.slice(0,n+1).map(e=>e.endsWith("\\")?e.substring(0,e.length-1):e).join("#"),s=t.slice(n+1).join("#")}t.push(new Yi(r,e,i,s,n))}return t}}var Ch=(e=>(e.AnyRoom="*",e))(Ch||{});const O3=class extends Error{constructor(e,t){super(e),this.data=t}};O3.prototype.name=O3.name;let aC=O3;class Oye extends U3.EventEmitter{constructor(e=null,t=null){if(super(),this.clientOrigin=t,this.capabilitiesFinished=!1,this.supportsMSC2974Renegotiate=!1,this.requestedCapabilities=[],this.turnServerWatchers=0,!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");this.transport=new Pye(sQ.FromWidget,e,window.parent,window),this.transport.targetOrigin=t,this.transport.on("message",this.handleMessage.bind(this))}hasCapability(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}requestCapability(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}requestCapabilities(e){e.forEach(e=>this.requestCapability(e))}requestCapabilityForRoomTimeline(e){this.requestCapability(`org.matrix.msc2762.timeline:${e}`)}requestCapabilityToSendState(e,t){this.requestCapability(Yi.forStateEvent(Oc.Send,e,t).raw)}requestCapabilityToReceiveState(e,t){this.requestCapability(Yi.forStateEvent(Oc.Receive,e,t).raw)}requestCapabilityToSendToDevice(e){this.requestCapability(Yi.forToDeviceEvent(Oc.Send,e).raw)}requestCapabilityToReceiveToDevice(e){this.requestCapability(Yi.forToDeviceEvent(Oc.Receive,e).raw)}requestCapabilityToSendEvent(e){this.requestCapability(Yi.forRoomEvent(Oc.Send,e).raw)}requestCapabilityToReceiveEvent(e){this.requestCapability(Yi.forRoomEvent(Oc.Receive,e).raw)}requestCapabilityToSendMessage(e){this.requestCapability(Yi.forRoomMessageEvent(Oc.Send,e).raw)}requestCapabilityToReceiveMessage(e){this.requestCapability(Yi.forRoomMessageEvent(Oc.Receive,e).raw)}requestCapabilityToReceiveRoomAccountData(e){this.requestCapability(Yi.forRoomAccountData(Oc.Receive,e).raw)}requestOpenIDConnectToken(){return new Promise((e,t)=>{this.transport.sendComplete(Wn.GetOpenIDCredentials,{}).then(n=>{const r=n.response;if(r.state===Ym.Allowed)e(r);else if(r.state===Ym.Blocked)t(new Error("User declined to verify their identity"));else if(r.state===Ym.PendingUserConfirmation){const i=o=>{o.preventDefault();const s=o.detail;s.data.original_request_id===n.requestId&&(s.data.state===Ym.Allowed?(e(s.data),this.transport.reply(s,{})):s.data.state===Ym.Blocked?(t(new Error("User declined to verify their identity")),this.transport.reply(s,{})):(t(new Error("Invalid state on reply: "+r.state)),this.transport.reply(s,{error:{message:"Invalid state"}})),this.off(`action:${hr.OpenIDCredentials}`,i))};this.on(`action:${hr.OpenIDCredentials}`,i)}else t(new Error("Invalid state: "+r.state))}).catch(t)})}updateRequestedCapabilities(){return this.transport.send(Wn.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}sendContentLoaded(){return this.transport.send(Wn.ContentLoaded,{}).then()}sendSticker(e){return this.transport.send(Wn.SendSticker,e).then()}setAlwaysOnScreen(e){return this.transport.send(Wn.UpdateAlwaysOnScreen,{value:e}).then(e=>e.success)}openModalWidget(e,t,n=[],r={},i=oQ.Custom){return this.transport.send(Wn.OpenModalWidget,{type:i,url:e,name:t,buttons:n,data:r}).then()}closeModalWidget(e={}){return this.transport.send(Wn.CloseModalWidget,e).then()}sendRoomEvent(e,t,n,r,i){return this.sendEvent(e,void 0,t,n,r,i)}sendStateEvent(e,t,n,r,i,o){return this.sendEvent(e,t,n,r,i,o)}sendEvent(e,t,n,r,i,o){return this.transport.send(Wn.SendEvent,{type:e,content:n,...void 0!==t&&{state_key:t},...void 0!==r&&{room_id:r},...void 0!==i&&{delay:i},...void 0!==o&&{parent_delay_id:o}})}updateDelayedEvent(e,t){return this.transport.send(Wn.MSC4157UpdateDelayedEvent,{delay_id:e,action:t})}sendToDevice(e,t,n){return this.transport.send(Wn.SendToDevice,{type:e,encrypted:t,messages:n})}readRoomAccountData(e,t){const n={type:e};return t&&(t.includes(Ch.AnyRoom)?n.room_ids=Ch.AnyRoom:n.room_ids=t),this.transport.send(Wn.BeeperReadRoomAccountData,n).then(e=>e.events)}readRoomEvents(e,t,n,r,i){const o={type:e,msgtype:n};return void 0!==t&&(o.limit=t),r&&(r.includes(Ch.AnyRoom)?o.room_ids=Ch.AnyRoom:o.room_ids=r),i&&(o.since=i),this.transport.send(Wn.MSC2876ReadEvents,o).then(e=>e.events)}async readEventRelations(e,t,n,r,i,o,s,a){if(!(await this.getClientVersions()).includes(ql.MSC3869))throw new Error("The read_relations action is not supported by the client.");const l={event_id:e,rel_type:n,event_type:r,room_id:t,to:s,from:o,limit:i,direction:a};return this.transport.send(Wn.MSC3869ReadRelations,l)}readStateEvents(e,t,n,r){const i={type:e,state_key:void 0===n||n};return void 0!==t&&(i.limit=t),r&&(r.includes(Ch.AnyRoom)?i.room_ids=Ch.AnyRoom:i.room_ids=r),this.transport.send(Wn.MSC2876ReadEvents,i).then(e=>e.events)}setModalButtonEnabled(e,t){if(e===aQ.Close)throw new Error("The close button cannot be disabled");return this.transport.send(Wn.SetModalButtonEnabled,{button:e,enabled:t}).then()}navigateTo(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(Wn.MSC2931Navigate,{uri:e}).then()}async*getTurnServers(){let e;const t=async t=>{t.preventDefault(),e(t.detail.data),await this.transport.reply(t.detail,{})};if(this.on(`action:${hr.UpdateTurnServers}`,t),0===this.turnServerWatchers)try{await this.transport.send(Wn.WatchTurnServers,{})}catch(e){throw this.off(`action:${hr.UpdateTurnServers}`,t),e}this.turnServerWatchers++;try{for(;;)yield await new Promise(t=>e=t)}finally{this.off(`action:${hr.UpdateTurnServers}`,t),this.turnServerWatchers--,0===this.turnServerWatchers&&await this.transport.send(Wn.UnwatchTurnServers,{})}}async searchUserDirectory(e,t){if(!(await this.getClientVersions()).includes(ql.MSC3973))throw new Error("The user_directory_search action is not supported by the client.");const n={search_term:e,limit:t};return this.transport.send(Wn.MSC3973UserDirectorySearch,n)}async getMediaConfig(){if(!(await this.getClientVersions()).includes(ql.MSC4039))throw new Error("The get_media_config action is not supported by the client.");return this.transport.send(Wn.MSC4039GetMediaConfigAction,{})}async uploadFile(e){if(!(await this.getClientVersions()).includes(ql.MSC4039))throw new Error("The upload_file action is not supported by the client.");const t={file:e};return this.transport.send(Wn.MSC4039UploadFileAction,t)}async downloadFile(e){if(!(await this.getClientVersions()).includes(ql.MSC4039))throw new Error("The download_file action is not supported by the client.");const t={content_uri:e};return this.transport.send(Wn.MSC4039DownloadFileAction,t)}start(){this.transport.start(),this.getClientVersions().then(e=>{e.includes(ql.MSC2974)&&(this.supportsMSC2974Renegotiate=!0)})}handleMessage(e){const t=new CustomEvent(`action:${e.detail.action}`,{detail:e.detail,cancelable:!0});if(this.emit(`action:${e.detail.action}`,t),!t.defaultPrevented)switch(e.detail.action){case hr.SupportedApiVersions:return this.replyVersions(e.detail);case hr.Capabilities:return this.handleCapabilities(e.detail);case hr.UpdateVisibility:case hr.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}replyVersions(e){this.transport.reply(e,{supported_versions:Lye})}getClientVersions(){return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(Wn.SupportedApiVersions,{}).then(e=>(this.cachedClientVersions=e.supported_versions,e.supported_versions)).catch(e=>(console.warn("non-fatal error getting supported client versions: ",e),[]))}handleCapabilities(e){return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then(t=>(t.includes(ql.MSC2871)?this.once(`action:${hr.NotifyCapabilities}`,e=>{this.approvedCapabilities=e.detail.data.approved,this.emit("ready")}):this.emit("ready"),this.capabilitiesFinished=!0,this.transport.reply(e,{capabilities:this.requestedCapabilities})))}}var wy=(e=>(e.Screenshots="m.capability.screenshot",e.StickerSending="m.sticker",e.AlwaysOnScreen="m.always_on_screen",e.RequiresClient="io.element.requires_client",e.MSC2931Navigate="org.matrix.msc2931.navigate",e.MSC3846TurnServers="town.robin.msc3846.turn_servers",e.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",e.MSC4039UploadFile="org.matrix.msc4039.upload_file",e.MSC4039DownloadFile="org.matrix.msc4039.download_file",e.MSC4157SendDelayedEvent="org.matrix.msc4157.send.delayed_event",e.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",e))(wy||{});function Mye(e){const t=e.error;return"object"==typeof t&&null!==t&&"message"in t&&"string"==typeof t.message}function sB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sB(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Dye(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new HE(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function HE(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(HE=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new HE(e)}var VE=function(e){return e.PendingEventsChanged="PendingEvent.pendingEventsChanged",e}({});class cQ extends z3{constructor(e,t,n,r,i){var o,s,a,l,c,u,d,h,p,f,m,v,g,y,b;super(r),o=this,this.widgetApi=e,this.capabilities=t,this.roomId=n,P(this,"room",void 0),P(this,"widgetApiReady",void 0),P(this,"roomStateSynced",void 0),P(this,"lifecycle",void 0),P(this,"syncState",null),P(this,"pendingSendingEventsTxId",[]),P(this,"eventEmitter",new Pn),P(this,"updateTxId",(b=B(function*(e){if(e.getSender()===o.getUserId()&&o.pendingSendingEventsTxId.some(t=>e.getType()===t.type)){for(var t,n=null===(t=o.pendingSendingEventsTxId.find(t=>t.id===e.getId()))||void 0===t?void 0:t.txId;!n&&o.pendingSendingEventsTxId.length>0;){var r;yield new Promise(e=>o.eventEmitter.once(VE.PendingEventsChanged,()=>e())),n=null===(r=o.pendingSendingEventsTxId.find(t=>t.id===e.getId()))||void 0===r?void 0:r.txId}n&&(e.setTxnId(n),e.setUnsigned(S2(S2({},e.getUnsigned()),{},{transaction_id:n}))),o.pendingSendingEventsTxId=o.pendingSendingEventsTxId.filter(t=>t.id!==e.getId()),0===o.pendingSendingEventsTxId.length&&o.eventEmitter.emit(VE.PendingEventsChanged)}}),function(e){return b.apply(this,arguments)})),P(this,"onEvent",function(){var e=B(function*(e){if(e.preventDefault(),e.detail.data.room_id===o.roomId){var t=new Zi(e.detail.data);yield o.updateTxId(t),o.syncApi instanceof Hd?(yield o.supportUpdateState())?yield o.syncApi.injectRoomEvents(o.room,void 0,[],[t]):yield o.syncApi.injectRoomEvents(o.room,[],void 0,[t]):(yield o.supportUpdateState())?yield o.syncApi.injectRoomEvents(o.room,[],[t]):M.error("slididng sync cannot be used in widget mode if the client widget driver does not support the version: 'org.matrix.msc2762_update_state'"),o.emit(Le.Event,t),o.setSyncState(Vt.Syncing),M.info("Received event ".concat(t.getId()," ").concat(t.getType()))}else{var{event_id:n,room_id:r}=e.detail.data;M.info("Received event ".concat(n," for a different room ").concat(r,"; discarding"))}yield o.ack(e)});return function(t){return e.apply(this,arguments)}}()),P(this,"onToDevice",function(){var e=B(function*(e){e.preventDefault();var t=new Zi({type:e.detail.data.type,sender:e.detail.data.sender,content:e.detail.data.content});e.detail.data.encrypted&&t.makeEncrypted(ee.RoomMessageEncrypted,{},"",""),o.emit(Le.ToDeviceEvent,t),o.setSyncState(Vt.Syncing),yield o.ack(e)});return function(t){return e.apply(this,arguments)}}()),P(this,"onStateUpdate",function(){var e=B(function*(e){for(var t of(e.preventDefault(),(yield o.supportUpdateState())||M.warn("received update_state widget action but the widget driver did not claim to support 'org.matrix.msc2762_update_state'"),e.detail.data.state))if(t.room_id===o.roomId){var n=new Zi(t);o.syncApi instanceof Hd?yield o.syncApi.injectRoomEvents(o.room,void 0,[n]):yield o.syncApi.injectRoomEvents(o.room,[n]),M.info("Updated state entry ".concat(n.getType()," ").concat(n.getStateKey()," to ").concat(n.getId()))}else{var{event_id:r,room_id:i}=e.detail.data;M.info("Received state entry ".concat(r," for a different room ").concat(i,"; discarding"))}yield o.ack(e)});return function(t){return e.apply(this,arguments)}}());var w=this.widgetApi.transport.send.bind(this.widgetApi.transport);this.widgetApi.transport.send=function(){var e=B(function*(e,t){try{return yield w(e,t)}catch(e){oB(e)}});return function(t,n){return e.apply(this,arguments)}}();var _=this.widgetApi.transport.sendComplete.bind(this.widgetApi.transport);this.widgetApi.transport.sendComplete=function(){var e=B(function*(e,t){try{return yield _(e,t)}catch(e){oB(e)}});return function(t,n){return e.apply(this,arguments)}}(),this.widgetApiReady=new Promise(e=>this.widgetApi.once("ready",e)),this.roomStateSynced=null!==(s=t.receiveState)&&void 0!==s&&s.length?new Promise(e=>this.widgetApi.once("action:".concat(hr.UpdateState),e)):Promise.resolve(),(null!==(a=t.sendEvent)&&void 0!==a&&a.length||null!==(l=t.receiveEvent)&&void 0!==l&&l.length||!0===t.sendMessage||Array.isArray(t.sendMessage)&&t.sendMessage.length||!0===t.receiveMessage||Array.isArray(t.receiveMessage)&&t.receiveMessage.length||null!==(c=t.sendState)&&void 0!==c&&c.length||null!==(u=t.receiveState)&&void 0!==u&&u.length)&&e.requestCapabilityForRoomTimeline(n),null===(d=t.sendEvent)||void 0===d||d.forEach(t=>e.requestCapabilityToSendEvent(t)),null===(h=t.receiveEvent)||void 0===h||h.forEach(t=>e.requestCapabilityToReceiveEvent(t)),!0===t.sendMessage?e.requestCapabilityToSendMessage():Array.isArray(t.sendMessage)&&t.sendMessage.forEach(t=>e.requestCapabilityToSendMessage(t)),!0===t.receiveMessage?e.requestCapabilityToReceiveMessage():Array.isArray(t.receiveMessage)&&t.receiveMessage.forEach(t=>e.requestCapabilityToReceiveMessage(t)),null===(p=t.sendState)||void 0===p||p.forEach(t=>{var{eventType:n,stateKey:r}=t;return e.requestCapabilityToSendState(n,r)}),null===(f=t.receiveState)||void 0===f||f.forEach(t=>{var{eventType:n,stateKey:r}=t;return e.requestCapabilityToReceiveState(n,r)}),null===(m=t.sendToDevice)||void 0===m||m.forEach(t=>e.requestCapabilityToSendToDevice(t)),null===(v=t.receiveToDevice)||void 0===v||v.forEach(t=>e.requestCapabilityToReceiveToDevice(t)),t.sendDelayedEvents&&(null!==(g=t.sendEvent)&&void 0!==g&&g.length||!0===t.sendMessage||Array.isArray(t.sendMessage)&&t.sendMessage.length||null!==(y=t.sendState)&&void 0!==y&&y.length)&&e.requestCapability(wy.MSC4157SendDelayedEvent),t.updateDelayedEvents&&e.requestCapability(wy.MSC4157UpdateDelayedEvent),t.turnServers&&e.requestCapability(wy.MSC3846TurnServers),e.on("action:".concat(hr.SendEvent),this.onEvent),e.on("action:".concat(hr.SendToDevice),this.onToDevice),e.on("action:".concat(hr.UpdateState),this.onStateUpdate),e.start(),i&&e.sendContentLoaded()}supportUpdateState(){var e=this;return B(function*(){return(yield e.widgetApi.getClientVersions()).includes(ql.MSC2762_UPDATE_STATE)})()}startClient(){var e=arguments,t=this;return B(function*(){var n=e.length>0&&void 0!==e[0]?e[0]:{};t.lifecycle=new AbortController;var r,i,o,s=t.getUserId();(s&&t.store.storeUser(new mu(s)),n.slidingSync?t.syncApi=new LJ(n.slidingSync,t,n,t.buildSyncApiOptions()):t.syncApi=new Hd(t,n,t.buildSyncApiOptions()),t.room=t.syncApi.createRoom(t.roomId),t.store.storeRoom(t.room),yield t.widgetApiReady,yield t.supportUpdateState())?yield t.roomStateSynced:yield Promise.all(null!==(r=null===(i=t.capabilities.receiveState)||void 0===i?void 0:i.map((o=B(function*(e){var{eventType:n,stateKey:r}=e,i=(yield t.widgetApi.readStateEvents(n,void 0,r,[t.roomId])).map(e=>new Zi(e));t.syncApi instanceof Hd?yield t.syncApi.injectRoomEvents(t.room,void 0,i):yield t.syncApi.injectRoomEvents(t.room,i),i.forEach(e=>{t.emit(Le.Event,e),M.info("Backfilled event ".concat(e.getId()," ").concat(e.getType()," ").concat(e.getStateKey()))})}),function(e){return o.apply(this,arguments)})))&&void 0!==r?r:[]);void 0!==n.clientWellKnownPollPeriod&&(t.clientWellKnownIntervalID=setInterval(()=>{t.fetchClientWellKnown()},1e3*n.clientWellKnownPollPeriod),t.fetchClientWellKnown()),t.setSyncState(Vt.Syncing),M.info("Finished initial sync"),t.matrixRTC.start(),t.capabilities.turnServers&&t.watchTurnServers()})()}stopClient(){this.widgetApi.off("action:".concat(hr.SendEvent),this.onEvent),this.widgetApi.off("action:".concat(hr.SendToDevice),this.onToDevice),this.widgetApi.off("action:".concat(hr.UpdateState),this.onStateUpdate),super.stopClient(),this.lifecycle.abort()}joinRoom(e){var t=this;return B(function*(){if(e===t.roomId)return t.room;throw new Error("Unknown room: ".concat(e))})()}encryptAndSendEvent(e,t,n){var r=this;return B(function*(){var i=t.event.redacts?S2(S2({},t.getContent()),{},{redacts:t.event.redacts}):t.getContent();if(n){var o=yield r.widgetApi.sendRoomEvent(t.getType(),i,e.roomId,"delay"in n?n.delay:void 0,"parent_delay_id"in n?n.parent_delay_id:void 0).catch(wc);return r.validateSendDelayedEventResponse(o)}var s,a=t.getTxnId();a&&r.pendingSendingEventsTxId.push({type:t.getType(),id:void 0,txId:a});try{s=yield r.widgetApi.sendRoomEvent(t.getType(),i,e.roomId).catch(wc)}catch(n){throw r.updatePendingEventStatus(e,t,ot.NOT_SENT),n}return e.updatePendingEvent(t,ot.SENT,s.event_id),r.pendingSendingEventsTxId.forEach(e=>{e.txId===a&&(e.id=s.event_id)}),r.eventEmitter.emit(VE.PendingEventsChanged),{event_id:s.event_id}})()}sendStateEvent(e,t,n){var r=arguments,i=this;return B(function*(){var o=r.length>3&&void 0!==r[3]?r[3]:"",s=yield i.widgetApi.sendStateEvent(t,o,n,e).catch(wc);if(void 0===s.event_id)throw new Error("'event_id' absent from response to an event request");return{event_id:s.event_id}})()}_unstable_sendDelayedStateEvent(e,t,n,r){var i=arguments,o=this;return B(function*(){var s=i.length>4&&void 0!==i[4]?i[4]:"";if(!(yield o.doesServerSupportUnstableFeature(Bc)))throw new qd("Server does not support the delayed events API","sendDelayedStateEvent");var a=yield o.widgetApi.sendStateEvent(n,s,r,e,"delay"in t?t.delay:void 0,"parent_delay_id"in t?t.parent_delay_id:void 0).catch(wc);return o.validateSendDelayedEventResponse(a)})()}validateSendDelayedEventResponse(e){if(void 0===e.delay_id)throw new Error("'delay_id' absent from response to a delayed event request");return{delay_id:e.delay_id}}_unstable_updateDelayedEvent(e,t){var n=this;return B(function*(){if(!(yield n.doesServerSupportUnstableFeature(Bc)))throw new qd("Server does not support the delayed events API","updateDelayedEvent");return yield n.widgetApi.updateDelayedEvent(e,t).catch(wc),{}})()}encryptAndSendToDevice(e,t,n){var r=this;return B(function*(){var i=new pu(()=>new Map);for(var{userId:o,deviceId:s}of t)i.getOrCreate(o).set(s,n);yield r.widgetApi.sendToDevice(e,!0,xh(i)).catch(wc)})()}sendToDevice(e,t){var n=this;return B(function*(){return yield n.widgetApi.sendToDevice(e,!1,xh(t)).catch(wc),{}})()}getOpenIdToken(){var e=this;return B(function*(){var t=yield e.widgetApi.requestOpenIDConnectToken().catch(wc);return{access_token:t.access_token,expires_in:t.expires_in,matrix_server_name:t.matrix_server_name,token_type:t.token_type}})()}queueToDevice(e){var t=this;return B(function*(){var{eventType:n,batch:r}=e,i=new pu(()=>new Map);for(var{userId:o,deviceId:s,payload:a}of r)i.getOrCreate(o).set(s,a);yield t.widgetApi.sendToDevice(n,!1,xh(i)).catch(wc)})()}sendToDeviceViaWidgetApi(e,t,n){var r=this;return B(function*(){yield r.widgetApi.sendToDevice(e,t,xh(n)).catch(wc)})()}checkTurnServers(){var e=this;return B(function*(){return e.turnServers.length>0})()}getSyncState(){return this.syncState}setSyncState(e){var t=this.syncState;this.syncState=e,this.emit(Le.Sync,e,t)}ack(e){var t=this;return B(function*(){yield t.widgetApi.transport.reply(e.detail,{})})()}watchTurnServers(){var e=this;return B(function*(){var t=e.widgetApi.getTurnServers(),n=()=>{t.return(void 0)};e.lifecycle.signal.addEventListener("abort",n);try{var r,i=!1,o=!1;try{for(var s,a=Dye(t);i=!(s=yield a.next()).done;i=!1){var l=s.value;e.turnServers=[{urls:l.uris,username:l.username,credential:l.password}],e.emit(Le.TurnServers,e.turnServers),M.log("Received TURN server: ".concat(l.uris))}}catch(e){o=!0,r=e}finally{try{i&&null!=a.return&&(yield a.return())}finally{if(o)throw r}}}catch(e){M.warn("Error watching TURN servers",e)}finally{e.lifecycle.signal.removeEventListener("abort",n)}})()}}function oB(e){throw e instanceof aC&&e.data.matrix_api_error?nr.fromWidgetApiErrorData(e.data.matrix_api_error):e}function wc(e){throw e instanceof Error&&"Request timed out"===e.message?new yp("widget api timeout"):e}class Nye{constructor(){P(this,"unthreadedReadReceipts",new Map),P(this,"threadedReadReceipts",new pu(()=>new Map))}setUnthreaded(e,t){this.unthreadedReadReceipts.set(e,t)}setThreaded(e,t,n){this.threadedReadReceipts.getOrCreate(e).set(t,n)}allUnthreaded(){return this.unthreadedReadReceipts.entries()}*allThreaded(){for(var e of this.threadedReadReceipts.values())for(var t of e.entries())yield t}consumeEphemeralEvents(e){null==e||e.forEach(e=>{e.type!==ee.Receipt||!e.content||Object.keys(e.content).forEach(t=>{Object.entries(e.content[t]).forEach(n=>{var[r,i]=n;if(CP(r))for(var o of Object.keys(i)){var s=e.content[t][r][o],a={data:e.content[t][r][o],type:r,eventId:t};s.thread_id?this.setThreaded(s.thread_id,o,a):this.setUnthreaded(o,a)}})})})}buildAccumulatedReceiptEvent(e){var t={type:ee.Receipt,room_id:e,content:{}},n=new pu(()=>new pu(()=>new Map));for(var[r,i]of this.allUnthreaded())n.getOrCreate(i.eventId).getOrCreate(i.type).set(r,i.data);for(var[o,s]of this.allThreaded())n.getOrCreate(s.eventId).getOrCreate(s.type).set(o,s.data);return t.content=xh(n),n.size>0?t:null}}var $l=function(e){return e.Invite="invite",e.Leave="leave",e.Join="join",e.Knock="knock",e}({});function Uye(e){return"_localTs"in e&&void 0!==e._localTs}class lQ{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.opts=e,P(this,"accountData",{}),P(this,"inviteRooms",{}),P(this,"knockRooms",{}),P(this,"joinRooms",{}),P(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.accumulateRooms(e,t),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){!e.account_data||!e.account_data.events||e.account_data.events.forEach(e=>{this.accountData[e.type]=e})}accumulateRooms(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(n=>{this.accumulateRoom(n,$l.Invite,e.rooms.invite[n],t)}),e.rooms.join&&Object.keys(e.rooms.join).forEach(n=>{this.accumulateRoom(n,$l.Join,e.rooms.join[n],t)}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(n=>{this.accumulateRoom(n,$l.Leave,e.rooms.leave[n],t)}),e.rooms.knock&&Object.keys(e.rooms.knock).forEach(n=>{this.accumulateRoom(n,$l.Knock,e.rooms.knock[n],t)}))}accumulateRoom(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];switch(t){case $l.Invite:this.knockRooms[e]&&delete this.knockRooms[e],this.accumulateInviteState(e,n);break;case $l.Knock:this.accumulateKnockState(e,n);break;case $l.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,n,r);break;case $l.Leave:this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:M.error("Unknown cateogory: ",t)}}accumulateInviteState(e,t){if(t.invite_state&&t.invite_state.events){if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});var n=this.inviteRooms[e];t.invite_state.events.forEach(e=>{for(var t=!1,r=0;r<n.invite_state.events.length;r++){var i=n.invite_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.invite_state.events[r]=e,t=!0)}t||n.invite_state.events.push(e)})}}accumulateKnockState(e,t){if(t.knock_state&&t.knock_state.events){if(!this.knockRooms[e])return void(this.knockRooms[e]={knock_state:t.knock_state});var n=this.knockRooms[e];t.knock_state.events.forEach(e=>{for(var t=!1,r=0;r<n.knock_state.events.length;r++){var i=n.knock_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.knock_state.events[r]=e,t=!0)}t||n.knock_state.events.push(e)})}}accumulateJoinState(e,t){var n,r,i,o,s,a,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_receipts:new Nye});var c=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach(e=>{c._accountData[e.type]=e}),t.unread_notifications&&(c._unreadNotifications=t.unread_notifications),c._unreadThreadNotifications=null!==(n=null!==(r=t[rb.stable])&&void 0!==r?r:t[rb.unstable])&&void 0!==n?n:void 0,t.summary){var u,d,h,p="m.heroes",f="m.invited_member_count",m="m.joined_member_count",v=c._summary,g=t.summary;v[p]=null!==(u=g[p])&&void 0!==u?u:v[p],v[m]=null!==(d=g[m])&&void 0!==d?d:v[m],v[f]=null!==(h=g[f])&&void 0!==h?h:v[f]}if(c._receipts.consumeEphemeralEvents(null===(i=t.ephemeral)||void 0===i?void 0:i.events),t.timeline&&t.timeline.limited&&(c._timeline=[]),null===(o=t.state)||void 0===o||null===(o=o.events)||void 0===o||o.forEach(e=>{E2(c._currentState,e)}),null===(s=t["org.matrix.msc4222.state_after"])||void 0===s||null===(s=s.events)||void 0===s||s.forEach(e=>{E2(c._currentState,e)}),null===(a=t.timeline)||void 0===a||null===(a=a.events)||void 0===a||a.forEach((e,n)=>{var r,i;if(t["org.matrix.msc4222.state_after"]||E2(c._currentState,e),l)i=e;else{var o;void 0!==(i=Object.assign({},e)).unsigned&&(i.unsigned=Object.assign({},i.unsigned));var s=null===(o=e.unsigned)||void 0===o?void 0:o.age;void 0!==s&&(i._localTs=Date.now()-s)}c._timeline.push({event:i,token:0===n&&null!==(r=t.timeline.prev_batch)&&void 0!==r?r:null})}),c._timeline.length>this.opts.maxTimelineEntries)for(var y=c._timeline.length-this.opts.maxTimelineEntries;y<c._timeline.length;y++)if(c._timeline[y].token){c._timeline=c._timeline.slice(y,c._timeline.length);break}}getJSON(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={join:{},invite:{},knock:{},leave:{}};Object.keys(this.inviteRooms).forEach(e=>{t.invite[e]=this.inviteRooms[e]}),Object.keys(this.knockRooms).forEach(e=>{t.knock[e]=this.knockRooms[e]}),Object.keys(this.joinRooms).forEach(n=>{var r=this.joinRooms[n],i={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},"org.matrix.msc4222.state_after":{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:r._unreadNotifications,unread_thread_notifications:r._unreadThreadNotifications,summary:r._summary};Object.keys(r._accountData).forEach(e=>{i.account_data.events.push(r._accountData[e])});var o=r._receipts.buildAccumulatedReceiptEvent(n);o&&i.ephemeral.events.push(o),r._timeline.forEach(t=>{if(!i.timeline.prev_batch){if(!t.token)return;i.timeline.prev_batch=t.token}var n;!e&&Uye(t.event)?(void 0!==(n=Object.assign({},t.event)).unsigned&&(n.unsigned=Object.assign({},n.unsigned)),delete n._localTs,n.unsigned=n.unsigned||{},n.unsigned.age=Date.now()-t.event._localTs):n=t.event,i.timeline.events.push(n)});for(var s=Object.create(null),a=i.timeline.events.length-1;a>=0;a--){var l=i.timeline.events[a];if(null!==l.state_key&&void 0!==l.state_key){var c=i_(l);c.unsigned&&(c.unsigned.prev_content&&(c.content=c.unsigned.prev_content),c.unsigned.prev_sender&&(c.sender=c.unsigned.prev_sender)),E2(s,c)}}Object.keys(r._currentState).forEach(e=>{Object.keys(r._currentState[e]).forEach(t=>{var n=r._currentState[e][t];i["org.matrix.msc4222.state_after"].events.push(n),s[e]&&s[e][t]&&(n=s[e][t]),i.state.events.push(n)})}),t.join[n]=i});var n=[];return Object.keys(this.accountData).forEach(e=>{n.push(this.accountData[e])}),{nextBatch:this.nextBatch,roomsData:t,accountData:n}}getNextBatchToken(){return this.nextBatch}}function E2(e,t){null===t.state_key||void 0===t.state_key||!t.type||(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}var uQ=function(e){return e[e.Blocked=-1]="Blocked",e[e.Unverified=0]="Unverified",e[e.Verified=1]="Verified",e}({});class jye{constructor(e){P(this,"deviceId",void 0),P(this,"userId",void 0),P(this,"algorithms",void 0),P(this,"keys",void 0),P(this,"verified",void 0),P(this,"signatures",void 0),P(this,"displayName",void 0),P(this,"dehydrated",!1),this.deviceId=e.deviceId,this.userId=e.userId,this.algorithms=e.algorithms,this.keys=e.keys,this.verified=e.verified||uQ.Unverified,this.signatures=e.signatures||new Map,this.displayName=e.displayName,this.dehydrated=!!e.dehydrated}getFingerprint(){return this.keys.get("ed25519:".concat(this.deviceId))}getIdentityKey(){return this.keys.get("curve25519:".concat(this.deviceId))}}var aB=function(){},Fye=10;class $ye{constructor(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.client=e,this.timelineSet=t,P(this,"windowLimit",void 0),P(this,"start",void 0),P(this,"end",void 0),P(this,"eventCount",0),this.windowLimit=r.windowLimit||1e3,null===(n=t.room)||void 0===n||n.on(xe.Timeline,this.onTimelineEvent.bind(this))}load(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=n=>{if(!n)throw new Error("No timeline given to initFields");var r,i=n.getEvents();if(e){if((r=i.findIndex(t=>t.getId()===e))<0)throw new Error("getEventTimeline result didn't include requested event")}else r=i.length;var o=Math.min(i.length,r+Math.ceil(t/2)),s=Math.max(0,o-t);this.start=new pA(n,s-n.getBaseIndex()),this.end=new pA(n,o-n.getBaseIndex()),this.eventCount=o-s};return this.timelineSet.getTimelineForEvent(e)?(n(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(n):(n(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){var t,n;if(e==Me.BACKWARDS)return null!==(t=this.start)&&void 0!==t?t:null;if(e==Me.FORWARDS)return null!==(n=this.end)&&void 0!==n?n:null;throw new Error("Invalid direction '"+e+"'")}extend(e,t){var n=this.getTimelineIndex(e);if(!n)return!1;var r=e==Me.BACKWARDS?n.retreat(t):n.advance(t);if(r){this.eventCount+=r,aB("TimelineWindow: increased cap by "+r+" (now "+this.eventCount+")");var i=this.eventCount-this.windowLimit;return i>0&&this.unpaginate(i,e!=Me.BACKWARDS),!0}return!1}onTimelineEvent(e,t,n,r){r&&this.onEventRemoved()}onEventRemoved(){var e=this.getEvents();e.length>0&&void 0===e[e.length-1]&&this.end&&this.end.index--}canPaginate(e){var t=this.getTimelineIndex(e);if(!t)return!1;if(e==Me.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;var n=t.timeline.getNeighbouringTimeline(e),r=t.timeline.getPaginationToken(e);return!!n||!!r}paginate(e,t){var n=arguments,r=this;return B(function*(){var i=!(n.length>2&&void 0!==n[2])||n[2],o=n.length>3&&void 0!==n[3]?n[3]:Fye,s=r.getTimelineIndex(e);if(!s)return!1;if(s.pendingPaginate)return s.pendingPaginate;if(r.extend(e,t))return!0;if(!i||0===o)return!1;if(!s.timeline.getPaginationToken(e))return!1;var a=r.client.paginateEventTimeline(s.timeline,{backwards:e==Me.BACKWARDS,limit:t}).finally(function(){s.pendingPaginate=void 0}).then(n=>n?r.paginate(e,t,!0,o-1):r.paginate(e,t,!1,0));return s.pendingPaginate=a,a})()}unpaginate(e,t){var n=t?this.start:this.end;if(!n)throw new Error("Attempting to unpaginate startOfTimeline=".concat(t," but don't have this direction"));if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate ".concat(e," events, but only have ").concat(this.eventCount," in the timeline"));for(;e>0;){var r=t?n.advance(e):n.retreat(e);if(r<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=r,this.eventCount-=r,aB("TimelineWindow.unpaginate: dropped "+r+" (now "+this.eventCount+")")}}getEvents(){if(!this.start)return[];for(var e=[],t=this.start.timeline;t;){var n,r,i=t.getEvents(),o=0,s=i.length;t===this.start.timeline&&(o=this.start.index+t.getBaseIndex()),t===(null===(n=this.end)||void 0===n?void 0:n.timeline)&&(s=this.end.index+t.getBaseIndex());for(var a=o;a<s;a++)e.push(i[a]);if(t===(null===(r=this.end)||void 0===r?void 0:r.timeline))break;t=t.getNeighbouringTimeline(Me.FORWARDS)}return e}}class pA{constructor(e,t){this.timeline=e,this.index=t,P(this,"pendingPaginate",void 0)}minIndex(){return-1*this.timeline.getBaseIndex()}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;var t;if(e<0){if((t=Math.max(e,this.minIndex()-this.index))<0)return this.index+=t,t}else if((t=Math.min(e,this.maxIndex()-this.index))>0)return this.index+=t,t;var n=this.timeline.getNeighbouringTimeline(e<0?Me.BACKWARDS:Me.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),this.advance(e)):0}retreat(e){return-1*this.advance(-1*e)}}var E0="m.login.email.identity",cB="m.login.msisdn",mA=function(e){return e.Password="m.login.password",e.Recaptcha="m.login.recaptcha",e.Terms="m.login.terms",e.Email="m.login.email.identity",e.Msisdn="m.login.msisdn",e.Sso="m.login.sso",e.SsoUnstable="org.matrix.login.sso",e.Dummy="m.login.dummy",e.RegistrationToken="m.login.registration_token",e.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token",e}({});class dQ extends Error{constructor(e,t,n){super(e),this.required_stages=t,this.flows=n,P(this,"name","NoAuthFlowFoundError")}}class eO{constructor(e){var t=this;P(this,"matrixClient",void 0),P(this,"inputs",void 0),P(this,"clientSecret",void 0),P(this,"requestCallback",void 0),P(this,"busyChangedCallback",void 0),P(this,"stateUpdatedCallback",void 0),P(this,"requestEmailTokenCallback",void 0),P(this,"supportedStages",void 0),P(this,"data",void 0),P(this,"emailSid",void 0),P(this,"requestingEmailToken",!1),P(this,"attemptAuthDeferred",null),P(this,"chosenFlow",null),P(this,"currentStage",null),P(this,"emailAttempt",1),P(this,"submitPromise",null),P(this,"requestEmailToken",B(function*(){if(t.requestingEmailToken)M.warn("Could not request email token: Already requesting");else{M.trace("Requesting email token. Attempt: "+t.emailAttempt),t.requestingEmailToken=!0;try{var e=yield t.requestEmailTokenCallback(t.inputs.emailAddress,t.clientSecret,t.emailAttempt++,t.data.session);t.emailSid=e.sid,M.trace("Email token request succeeded")}finally{t.requestingEmailToken=!1}}})),this.matrixClient=e.matrixClient,this.data=e.authData||{flows:[]},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid,void 0!==e.supportedStages&&(this.supportedStages=new Set(e.supportedStages))}attemptAuth(){var e=this;return B(function*(){var t;e.attemptAuthDeferred=Promise.withResolvers();var n=e.attemptAuthDeferred.promise;if(null!==(t=e.data)&&void 0!==t&&null!==(t=t.flows)&&void 0!==t&&t.length)e.startNextAuthStage();else{var r;null===(r=e.busyChangedCallback)||void 0===r||r.call(e,!0);var i=e.data.session?{session:e.data.session}:null;e.doRequest(i).finally(()=>{var t;null===(t=e.busyChangedCallback)||void 0===t||t.call(e,!1)})}return n})()}poll(){var e=this;return B(function*(){if(e.data.session&&e.attemptAuthDeferred&&!e.submitPromise){var t={};if(e.currentStage==E0&&e.emailSid){var n={sid:e.emailSid,client_secret:e.clientSecret},r=e.matrixClient.getIdentityServerUrl();r&&(n.id_server=new URL(r).host),t={type:E0,threepid_creds:n}}e.submitAuthDict(t,!0)}})()}getSessionId(){var e;return null===(e=this.data)||void 0===e?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var t;return null===(t=this.data)||void 0===t||null===(t=t.params)||void 0===t?void 0:t[e]}getChosenFlow(){return this.chosenFlow}submitAuthDict(e){var t=arguments,n=this;return B(function*(){var r,i,o,s=t.length>1&&void 0!==t[1]&&t[1];if(!n.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");s||(null===(i=n.busyChangedCallback)||void 0===i||i.call(n,!0));for(;n.submitPromise;)try{yield n.submitPromise}catch{}o=null!==(r=n.data)&&void 0!==r&&r.session?Object.assign({session:n.data.session},e):e;try{n.submitPromise=n.doRequest(o,s),yield n.submitPromise}finally{var a;if(n.submitPromise=null,!s)null===(a=n.busyChangedCallback)||void 0===a||a.call(n,!1)}})()}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}doRequest(e){var t=arguments,n=this;return B(function*(){var r=t.length>1&&void 0!==t[1]&&t[1];try{var i=yield n.requestCallback(e,r);n.attemptAuthDeferred.resolve(i),n.attemptAuthDeferred=null}catch(e){var o,s,a,l,c=e instanceof nr?e:null,u=null!==(o=null==c||null===(s=c.data)||void 0===s?void 0:s.flows)&&void 0!==o?o:null,d=(null===(a=n.data)||void 0===a?void 0:a.flows)||!!u;if(!c||401!==c.httpStatus||!c.data||!d)if(r)M.log("Background poll request failed doing UI auth: ignoring",e);else{var h;null===(h=n.attemptAuthDeferred)||void 0===h||h.reject(e)}c&&!c.data&&(c.data={}),c&&!c.data.flows&&!c.data.completed&&!c.data.session&&(c.data.flows=n.data.flows,c.data.completed=n.data.completed,c.data.session=n.data.session),c&&(n.data=c.data);try{n.startNextAuthStage()}catch(e){return n.attemptAuthDeferred.reject(e),void(n.attemptAuthDeferred=null)}if(!n.emailSid&&null!==(l=n.chosenFlow)&&void 0!==l&&l.stages.includes(mA.Email))try{yield n.requestEmailToken()}catch(e){n.attemptAuthDeferred.reject(e),n.attemptAuthDeferred=null}}})()}startNextAuthStage(){var e,t,n,r,i=this.chooseStage();if(!i)throw new Error("No incomplete flows from the server");(this.currentStage=i,i!==mA.Dummy)?null!==(e=this.data)&&void 0!==e&&e.errcode||null!==(t=this.data)&&void 0!==t&&t.error?this.stateUpdatedCallback(i,{errcode:(null===(n=this.data)||void 0===n?void 0:n.errcode)||"",error:(null===(r=this.data)||void 0===r?void 0:r.error)||""}):this.stateUpdatedCallback(i,i===E0?{emailSid:this.emailSid}:{}):this.submitAuthDict({type:"m.login.dummy"})}chooseStage(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),M.log("Active flow => %s",JSON.stringify(this.chosenFlow));var e=this.firstUncompletedStage(this.chosenFlow);return M.log("Next stage: %s",e),e}scoreFlow(e){var t=e.stages.length;return void 0!==this.supportedStages&&(t+=10*e.stages.filter(e=>!this.supportedStages.has(e)).length),t}chooseFlow(){var e,t=(null===(e=this.data)||void 0===e?void 0:e.flows)||[],n=!!this.inputs.emailAddress||!!this.emailSid,r=!!this.inputs.phoneCountry&&!!this.inputs.phoneNumber;for(var i of(t.sort((e,t)=>this.scoreFlow(e)-this.scoreFlow(t)),t)){var o=!1,s=!1;for(var a of i.stages)a===E0?o=!0:a==cB&&(s=!0);if(o==n&&s==r)return i}var l=[];throw n&&l.push(E0),r&&l.push(cB),new dQ("No appropriate authentication flow found",l,t)}firstUncompletedStage(e){var t,n=(null===(t=this.data)||void 0===t?void 0:t.completed)||[];return e.stages.find(e=>!n.includes(e))}}function fQ(e,t){return new Promise((n,r)=>{var i=!0,o=e.open(t);o.onupgradeneeded=()=>{i=!1},o.onblocked=()=>r(o.error),o.onsuccess=()=>{o.result.close(),i||e.deleteDatabase(t),n(i)},o.onerror=()=>r(o.error)})}var hQ=[e=>{e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})},e=>{e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},e=>{e.createObjectStore("client_options",{keyPath:["clobber"]})},e=>{e.createObjectStore("to_device_queue",{autoIncrement:!0})}],Bye=hQ.length;function w2(e,t,n){var r=e.openCursor(t);return new Promise((e,t)=>{var i=[];r.onerror=()=>{var e;t(new Error("Query failed: "+(null===(e=r.error)||void 0===e?void 0:e.name)))},r.onsuccess=()=>{var t=r.result;t?(i.push(n(t)),t.continue()):e(i)}})}function dh(e){return new Promise((t,n)=>{e.oncomplete=function(e){t(e)},e.onerror=function(){n(e.error)}})}function pQ(e){return new Promise((t,n)=>{e.onsuccess=function(e){t(e)},e.onerror=function(){n(e.error)}})}function Hye(e){return new Promise((t,n)=>{e.onsuccess=()=>t(e),e.onerror=e=>n(e)})}function Rk(e){return pQ(e).then(t=>e.result)}class lB{static exists(e,t){return fQ(e,t="matrix-js-sdk:"+(t||"default"))}constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";this.indexedDB=e,P(this,"dbName",void 0),P(this,"syncAccumulator",void 0),P(this,"db",void 0),P(this,"disconnected",!0),P(this,"_isNewlyCreated",!1),P(this,"syncToDatabasePromise",void 0),P(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+t,this.syncAccumulator=new lQ}connect(e){var t=this;if(!this.disconnected)return M.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,M.log("LocalIndexedDBStoreBackend.connect: connecting...");var n=this.indexedDB.open(this.dbName,Bye);return n.onupgradeneeded=e=>{var t=n.result,r=e.oldVersion;M.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(r)),r<1&&(this._isNewlyCreated=!0),hQ.forEach((e,n)=>{r<=n&&e(t)})},n.onblocked=()=>{M.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},M.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),pQ(n).then(B(function*(){M.log("LocalIndexedDBStoreBackend.connect: connected"),t.db=n.result,t.db.onversionchange=()=>{var e;null===(e=t.db)||void 0===e||e.close(),t.disconnected=!0,t.db=void 0},t.db.onclose=()=>{t.disconnected=!0,t.db=void 0,null==e||e()},yield t.init()}))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then(e=>{var[t,n]=e;M.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:n.nextBatch,rooms:n.roomsData,account_data:{events:t}},!0)})}getOutOfBandMembers(e){return new Promise((t,n)=>{var r=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),i=IDBKeyRange.only(e),o=r.openCursor(i),s=[],a=!1;o.onsuccess=()=>{var e=o.result;if(!e)return s.length||a?t(s):t(null);var n=e.value;n.oob_written?a=!0:s.push(n),e.continue()},o.onerror=e=>{n(e)}}).then(t=>(M.log("LL: got ".concat(null==t?void 0:t.length," membershipEvents from storage for room ").concat(e," ...")),t))}setOutOfBandMembers(e,t){var n=this;return B(function*(){M.log("LL: backend about to store ".concat(t.length)+" members for ".concat(e));var r=n.db.transaction(["oob_membership_events"],"readwrite"),i=r.objectStore("oob_membership_events");t.forEach(e=>{i.put(e)});var o={room_id:e,oob_written:!0,state_key:0};i.put(o),yield dh(r),M.log("LL: backend done storing for ".concat(e,"!"))})()}clearOutOfBandMembers(e){var t=this;return B(function*(){var n=t.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),r=IDBKeyRange.only(e),i=Rk(n.openKeyCursor(r,"next")).then(e=>(null==e?void 0:e.primaryKey)[1]),o=Rk(n.openKeyCursor(r,"prev")).then(e=>(null==e?void 0:e.primaryKey)[1]),[s,a]=yield Promise.all([i,o]),l=t.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),c=IDBKeyRange.bound([e,s],[e,a]);M.log("LL: Deleting all users + marker in storage for room ".concat(e,", with key range:"),[e,s],[e,a]),yield Hye(l.delete(c))})()}clearDatabase(){return new Promise(e=>{var t;M.log("Removing indexeddb instance: ".concat(this.dbName)),null===(t=this.db)||void 0===t||t.close();var n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{M.log("can't yet delete indexeddb ".concat(this.dbName," because it is open elsewhere"))},n.onerror=()=>{var t;M.warn("unable to delete js-sdk store indexeddb: ".concat(null===(t=n.error)||void 0===t?void 0:t.name)),e()},n.onsuccess=()=>{M.log("Removed indexeddb instance: ".concat(this.dbName)),e()}})}getSavedSync(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(i_(t)):Promise.resolve(t):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then(()=>{this.syncAccumulator.accumulate(e)})}syncToDatabase(e){var t=this;return B(function*(){return t.syncToDatabasePromise?(M.warn("Skipping syncToDatabase() as persist already in flight"),t.pendingUserPresenceData.push(...e),t.syncToDatabasePromise):(e.unshift(...t.pendingUserPresenceData),t.syncToDatabasePromise=t.doSyncToDatabase(e),t.syncToDatabasePromise)})()}doSyncToDatabase(e){var t=this;return B(function*(){try{var n=t.syncAccumulator.getJSON(!0);yield Promise.all([t.persistUserPresenceEvents(e),t.persistAccountData(n.accountData),t.persistSyncData(n.nextBatch,n.roomsData)])}finally{t.syncToDatabasePromise=void 0}})()}persistSyncData(e,t){return M.log("Persisting sync data up to",e),Em(()=>{var n=this.db.transaction(["sync"],"readwrite");return n.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t}),dh(n).then(()=>{M.log("Persisted sync data up to",e)})})}persistAccountData(e){return Em(()=>{var t=this.db.transaction(["accountData"],"readwrite"),n=t.objectStore("accountData");for(var r of e)n.put(r);return dh(t).then()})}persistUserPresenceEvents(e){return Em(()=>{var t=this.db.transaction(["users"],"readwrite"),n=t.objectStore("users");for(var r of e)n.put({userId:r[0],event:r[1]});return dh(t).then()})}getUserPresenceEvents(){return Em(()=>w2(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,e=>[e.value.userId,e.value.event]))}loadAccountData(){return M.log("LocalIndexedDBStoreBackend: loading account data..."),Em(()=>w2(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,e=>e.value).then(e=>(M.log("LocalIndexedDBStoreBackend: loaded account data"),e)))}loadSyncData(){return M.log("LocalIndexedDBStoreBackend: loading sync data..."),Em(()=>w2(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,e=>e.value).then(e=>(M.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&M.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))}getClientOptions(){return Promise.resolve().then(()=>w2(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,e=>{var t;return null===(t=e.value)||void 0===t?void 0:t.options}).then(e=>e[0]))}storeClientOptions(e){var t=this;return B(function*(){var n=t.db.transaction(["client_options"],"readwrite");n.objectStore("client_options").put({clobber:"-",options:e}),yield dh(n)})()}saveToDeviceBatches(e){var t=this;return B(function*(){var n=t.db.transaction(["to_device_queue"],"readwrite"),r=n.objectStore("to_device_queue");for(var i of e)r.add(i);yield dh(n)})()}getOldestToDeviceBatch(){var e=this;return B(function*(){var t=e.db.transaction(["to_device_queue"],"readonly").objectStore("to_device_queue"),n=yield Rk(t.openCursor());if(!n)return null;var r=n.value;return{id:n.key,txnId:r.txnId,eventType:r.eventType,batch:r.batch}})()}removeToDeviceBatch(e){var t=this;return B(function*(){var n=t.db.transaction(["to_device_queue"],"readwrite");n.objectStore("to_device_queue").delete(e),yield dh(n)})()}destroy(){var e=this;return B(function*(){var t;null===(t=e.db)||void 0===t||t.close()})()}}class Vye{constructor(e,t){this.workerFactory=e,this.dbName=t,P(this,"worker",void 0),P(this,"nextSeq",0),P(this,"inFlight",{}),P(this,"startPromise",void 0),P(this,"onWorkerMessage",e=>{var t,n=e.data;if("closed"==n.command)null===(t=this.onClose)||void 0===t||t.call(this);else if("cmd_success"==n.command||"cmd_fail"==n.command){if(void 0===n.seq)return void M.error("Got reply from worker with no seq");var r=this.inFlight[n.seq];if(void 0===r)return void M.error("Got reply for unknown seq "+n.seq);if(delete this.inFlight[n.seq],"cmd_success"==n.command)r.resolve(n.result);else{var i=new Error(n.error.message);i.name=n.error.name,r.reject(i)}}else M.warn("Unrecognised message from worker: ",n)})}connect(e){return this.onClose=e,this.ensureStarted().then(()=>this.doCmd("connect"))}clearDatabase(){return this.ensureStarted().then(()=>this.doCmd("clearDatabase"))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}saveToDeviceBatches(e){var t=this;return B(function*(){return t.doCmd("saveToDeviceBatches",[e])})()}getOldestToDeviceBatch(){var e=this;return B(function*(){return e.doCmd("getOldestToDeviceBatch")})()}removeToDeviceBatch(e){var t=this;return B(function*(){return t.doCmd("removeToDeviceBatch",[e])})()}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then(()=>{M.log("IndexedDB worker is ready")})),this.startPromise}doCmd(e,t){return Promise.resolve().then(()=>{var n,r=this.nextSeq++,i=Promise.withResolvers();return this.inFlight[r]=i,null===(n=this.worker)||void 0===n||n.postMessage({command:e,seq:r,args:t}),i.promise})}destroy(){var e=this;return B(function*(){var t;null===(t=e.worker)||void 0===t||t.terminate()})()}}var qye=3e5;class mQ extends ub{static exists(e,t){return lB.exists(e,t)}constructor(e){if(super(e),P(this,"backend",void 0),P(this,"startedUp",!1),P(this,"syncTs",0),P(this,"userModifiedMap",{}),P(this,"emitter",new Pn),P(this,"onClose",()=>{this.emitter.emit("closed")}),P(this,"getSavedSync",this.degradable(()=>this.backend.getSavedSync(),"getSavedSync")),P(this,"isNewlyCreated",this.degradable(()=>this.backend.isNewlyCreated(),"isNewlyCreated")),P(this,"getSavedSyncToken",this.degradable(()=>this.backend.getNextBatchToken(),"getSavedSyncToken")),P(this,"deleteAllData",this.degradable(()=>(super.deleteAllData(),this.backend.clearDatabase().then(()=>{M.log("Deleted indexeddb data.")},e=>{throw M.error("Failed to delete indexeddb data: ".concat(e)),e})),null)),P(this,"reallySave",this.degradable(()=>{this.syncTs=Date.now();var e=[];for(var t of this.getUsers())this.userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this.userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)},null)),P(this,"setSyncData",this.degradable(e=>this.backend.setSyncData(e),"setSyncData")),P(this,"getOutOfBandMembers",this.degradable(e=>this.backend.getOutOfBandMembers(e),"getOutOfBandMembers")),P(this,"setOutOfBandMembers",this.degradable((e,t)=>(super.setOutOfBandMembers(e,t),this.backend.setOutOfBandMembers(e,t)),"setOutOfBandMembers")),P(this,"clearOutOfBandMembers",this.degradable(e=>(super.clearOutOfBandMembers(e),this.backend.clearOutOfBandMembers(e)),"clearOutOfBandMembers")),P(this,"getClientOptions",this.degradable(()=>this.backend.getClientOptions(),"getClientOptions")),P(this,"storeClientOptions",this.degradable(e=>(super.storeClientOptions(e),this.backend.storeClientOptions(e)),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new Vye(e.workerFactory,e.dbName):this.backend=new lB(e.indexedDB,e.dbName)}on(e,t){this.emitter.on(e,t)}startup(){return this.startedUp?(M.log("IndexedDBStore.startup: already started"),Promise.resolve()):(M.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect(this.onClose).then(()=>(M.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{M.log("IndexedDBStore.startup: processing presence events"),e.forEach(e=>{var[t,n]=e;if(!this.createUser)throw new Error("`IndexedDBStore.startup` must be called after assigning it to the client, not before!");var r=this.createUser(t);n&&r.setPresenceEvent(new Zi(n)),this.userModifiedMap[r.userId]=r.getLastModifiedTime(),this.storeUser(r)}),this.startedUp=!0}))}destroy(){return this.backend.destroy()}wantsSave(){return Date.now()-this.syncTs>qye}save(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,t){var n=this,r=t?super[t]:null;return B(function*(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];try{return yield e.call(n,...i)}catch(e){M.error("IndexedDBStore failure, degrading to MemoryStore",e),n.emitter.emit("degraded",e);try{M.log("IndexedDBStore trying to delete degraded data"),yield n.backend.clearDatabase(),M.log("IndexedDBStore delete after degrading succeeded")}catch(e){M.warn("IndexedDBStore delete after degrading failed",e)}if(r)return r.call(n,...i)}})}getPendingEvents(e){var t=()=>super.getPendingEvents,n=this;return B(function*(){if(!n.localStorage)return t().call(n,e);var r=n.localStorage.getItem(Ik(e));if(r)try{return JSON.parse(r)}catch(e){M.error("Could not parse persisted pending events",e)}return[]})()}setPendingEvents(e,t){var n=()=>super.setPendingEvents,r=this;return B(function*(){if(!r.localStorage)return n().call(r,e,t);t.length>0?r.localStorage.setItem(Ik(e),JSON.stringify(t)):r.localStorage.removeItem(Ik(e))})()}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function Ik(e){return"mx_pending_events_".concat(e)}var ec="crypto.",uB=ec+"migration",kk=ec+"account",Gye=ec+"cross_signing_keys",qE=ec+"inboundgroupsessions/",Kye=ec+"inboundgroupsessions.withheld/",zye=ec+"rooms/",xk=ec+"sessionsneedingbackup";function km(e){return ec+"sessions/"+e}function Ak(e,t){return qE+e+"/"+t}function Wye(e,t){return Kye+e+"/"+t}function Yye(e){return zye+e}class W3 extends D3{static exists(e){for(var t=e.length,n=0;n<t;n++){var r;if(null!==(r=e.key(n))&&void 0!==r&&r.startsWith(ec))return!0}return!1}constructor(e){super(),this.store=e}containsData(){var e=this;return B(function*(){return W3.exists(e.store)})()}getMigrationState(){var e=this;return B(function*(){var t;return null!==(t=Ko(e.store,uB))&&void 0!==t?t:Wg.NOT_STARTED})()}setMigrationState(e){var t=this;return B(function*(){fh(t.store,uB,e)})()}countEndToEndSessions(e,t){for(var n=0,r=0;r<this.store.length;++r){var i=this.store.key(r);if(null!=i&&i.startsWith(km(""))){var o=Ko(this.store,i);n+=Object.keys(o??{}).length}}t(n)}_getEndToEndSessions(e){var t=Ko(this.store,km(e)),n={};for(var[r,i]of Object.entries(t||{}))n[r]="string"==typeof i?{session:i}:i;return n}getEndToEndSession(e,t,n,r){var i;r(null!==(i=this._getEndToEndSessions(e)[t])&&void 0!==i?i:{})}getEndToEndSessions(e,t,n){var r;n(null!==(r=this._getEndToEndSessions(e))&&void 0!==r?r:{})}storeEndToEndSession(e,t,n,r){var i=this._getEndToEndSessions(e)||{};i[t]=n,fh(this.store,km(e),i)}getEndToEndSessionsBatch(){var e=this;return B(function*(){for(var t=[],n=0;n<e.store.length;++n){var r;if(null!==(r=e.store.key(n))&&void 0!==r&&r.startsWith(km(""))){var i=e.store.key(n).split("/")[1];for(var o of Object.values(e._getEndToEndSessions(i)))if(t.push(o),t.length>=Yg)return t}}return 0===t.length?null:t})()}deleteEndToEndSessionsBatch(e){var t=this;return B(function*(){for(var{deviceKey:n,sessionId:r}of e){var i=t._getEndToEndSessions(n)||{};delete i[r],0===Object.keys(i).length?t.store.removeItem(km(n)):fh(t.store,km(n),i)}})()}getEndToEndInboundGroupSession(e,t,n,r){r(Ko(this.store,Ak(e,t)),Ko(this.store,Wye(e,t)))}storeEndToEndInboundGroupSession(e,t,n,r){fh(this.store,Ak(e,t),n)}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){for(var t=0,n=0;n<e.store.length;++n){var r=e.store.key(n);null!=r&&r.startsWith(qE)&&(t+=1)}return t})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){for(var t=Ko(e.store,xk)||{},n=[],r=0;r<e.store.length;++r){var i=e.store.key(r);if(null!=i&&i.startsWith(qE)){var o=i.slice(qE.length);if(n.push({senderKey:o.slice(0,43),sessionId:o.slice(44),sessionData:Ko(e.store,i),needsBackup:o in t}),n.length>=Yg)return n}}return 0===n.length?null:n})()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return B(function*(){for(var{senderKey:n,sessionId:r}of e){var i=Ak(n,r);t.store.removeItem(i)}})()}getEndToEndRooms(e,t){for(var n={},r=Yye(""),i=0;i<this.store.length;++i){var o=this.store.key(i);if(null!=o&&o.startsWith(r))n[o.slice(r.length)]=Ko(this.store,o)}t(n)}markSessionsNeedingBackup(e){var t=Ko(this.store,xk)||{};for(var n of e)t[n.senderKey+"/"+n.sessionId]=!0;return fh(this.store,xk,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(kk),Promise.resolve()}getAccount(e,t){t(Ko(this.store,kk))}storeAccount(e,t){fh(this.store,kk,t)}getCrossSigningKeys(e,t){t(Ko(this.store,Gye))}getSecretStorePrivateKey(e,t,n){t(Ko(this.store,ec+"ssss_cache.".concat(n)))}storeSecretStorePrivateKey(e,t,n){fh(this.store,ec+"ssss_cache.".concat(t),n)}doTxn(e,t,n){return Promise.resolve(n(null))}}function Ko(e,t){try{return JSON.parse(e.getItem(t))}catch(e){M.log("Error: Failed to get key %s: %s",t,e.message),M.log(e.stack)}return null}function fh(e,t,n){e.setItem(t,JSON.stringify(n))}let Xye=class{constructor(e){this.db=e,P(this,"nextTxnId",0),e.onversionchange=()=>{M.log("versionchange for indexeddb ".concat(this.db.name,": closing")),e.close()}}containsData(){return B(function*(){throw Error("Not implemented for Backend")})()}startup(){var e=this;return B(function*(){return e})()}deleteAllData(){return B(function*(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")})()}getMigrationState(){var e=this;return B(function*(){var t=Wg.NOT_STARTED;return yield e.doTxn("readonly",[Ht.STORE_ACCOUNT],e=>{var n=e.objectStore(Ht.STORE_ACCOUNT).get(P5);n.onsuccess=()=>{var e;t=null!==(e=n.result)&&void 0!==e?e:Wg.NOT_STARTED}}),t})()}setMigrationState(e){var t=this;return B(function*(){yield t.doTxn("readwrite",[Ht.STORE_ACCOUNT],t=>{t.objectStore(Ht.STORE_ACCOUNT).put(e,P5)})})()}getAccount(e,t){var n=e.objectStore("account").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){Rs(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){var n=e.objectStore("account").get("crossSigningKeys");n.onsuccess=function(){try{t(n.result||null)}catch(t){Rs(e,t)}}}getSecretStorePrivateKey(e,t,n){var r=e.objectStore("account").get("ssss_cache:".concat(n));r.onsuccess=function(){try{t(r.result||null)}catch(t){Rs(e,t)}}}storeSecretStorePrivateKey(e,t,n){e.objectStore("account").put(n,"ssss_cache:".concat(t))}countEndToEndSessions(e,t){var n=e.objectStore("sessions").count();n.onsuccess=function(){try{t(n.result)}catch(t){Rs(e,t)}}}getEndToEndSessions(e,t,n){var r=t.objectStore("sessions").index("deviceKey").openCursor(e),i={};r.onsuccess=function(){var e=r.result;if(e)i[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{n(i)}catch(e){Rs(t,e)}}}getEndToEndSession(e,t,n,r){var i=n.objectStore("sessions").get([e,t]);i.onsuccess=function(){try{i.result?r({session:i.result.session,lastReceivedMessageTs:i.result.lastReceivedMessageTs}):r(null)}catch(e){Rs(n,e)}}}storeEndToEndSession(e,t,n,r){r.objectStore("sessions").put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}getEndToEndSessionsBatch(){var e=this;return B(function*(){var t=[];return yield e.doTxn("readonly",[Ht.STORE_SESSIONS],e=>{var n=e.objectStore(Ht.STORE_SESSIONS).openCursor();n.onsuccess=function(){try{var r=n.result;r&&(t.push(r.value),t.length<Yg&&r.continue())}catch(t){Rs(e,t)}}}),0===t.length?null:t})()}deleteEndToEndSessionsBatch(e){var t=this;return B(function*(){var n;yield t.doTxn("readwrite",[Ht.STORE_SESSIONS],(n=B(function*(t){try{var n=t.objectStore(Ht.STORE_SESSIONS),r=function*(){var e=n.delete([i,o]);yield new Promise(t=>{e.onsuccess=t})};for(var{deviceKey:i,sessionId:o}of e)yield*r()}catch(e){Rs(t,e)}}),function(e){return n.apply(this,arguments)}))})()}getEndToEndInboundGroupSession(e,t,n,r){var i=!1,o=!1,s=n.objectStore("inbound_group_sessions").get([e,t]);s.onsuccess=function(){try{i=s.result?s.result.session:null,!1!==o&&r(i,o)}catch(e){Rs(n,e)}};var a=n.objectStore("inbound_group_sessions_withheld").get([e,t]);a.onsuccess=function(){try{o=a.result?a.result.session:null,!1!==i&&r(i,o)}catch(e){Rs(n,e)}}}storeEndToEndInboundGroupSession(e,t,n,r){r.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:n})}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){var t=0;return yield e.doTxn("readonly",[Ht.STORE_INBOUND_GROUP_SESSIONS],e=>{var n=e.objectStore(Ht.STORE_INBOUND_GROUP_SESSIONS).count();n.onsuccess=()=>{t=n.result}}),t})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){var t=[];return yield e.doTxn("readonly",[Ht.STORE_INBOUND_GROUP_SESSIONS,Ht.STORE_BACKUP],e=>{var n=e.objectStore(Ht.STORE_INBOUND_GROUP_SESSIONS),r=e.objectStore(Ht.STORE_BACKUP),i=n.openCursor();i.onsuccess=function(){try{var n=i.result;if(n){var o=r.get(n.key);o.onsuccess=()=>{t.push({senderKey:n.value.senderCurve25519Key,sessionId:n.value.sessionId,sessionData:n.value.session,needsBackup:void 0!==o.result}),t.length<Yg&&n.continue()}}}catch(t){Rs(e,t)}}}),0===t.length?null:t})()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return B(function*(){var n;yield t.doTxn("readwrite",[Ht.STORE_INBOUND_GROUP_SESSIONS],(n=B(function*(t){try{var n=t.objectStore(Ht.STORE_INBOUND_GROUP_SESSIONS),r=function*(){var e=n.delete([i,o]);yield new Promise(t=>{e.onsuccess=t})};for(var{senderKey:i,sessionId:o}of e)yield*r()}catch(e){Rs(t,e)}}),function(e){return n.apply(this,arguments)}))})()}getEndToEndDeviceData(e,t){var n=e.objectStore("device_data").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){Rs(e,t)}}}getEndToEndRooms(e,t){var n={},r=e.objectStore("rooms").openCursor();r.onsuccess=function(){var i=r.result;if(i)n[i.key]=i.value,i.continue();else try{t(n)}catch(t){Rs(e,t)}}}markSessionsNeedingBackup(e,t){var n=this;return B(function*(){t||(t=n.db.transaction("sessions_needing_backup","readwrite"));var r=t.objectStore("sessions_needing_backup");yield Promise.all(e.map(e=>new Promise((t,n)=>{var i=r.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});i.onsuccess=t,i.onerror=n})))})()}doTxn(e,t,n){var r=this.db.transaction(t,e),i=Zye(r),o=n(r);return i.then(()=>o)}};var gQ=[e=>{Qye(e)},e=>{e.createObjectStore("account")},e=>{e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},e=>{e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("device_data")},e=>{e.createObjectStore("rooms")},e=>{e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},e=>{e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},e=>{e.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],vQ=gQ.length;function Jye(e,t){M.log("Upgrading IndexedDBCryptoStore from version ".concat(t)+" to ".concat(vQ)),gQ.forEach((n,r)=>{t<=r&&n(e)})}function Qye(e){var t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}function Rs(e,t){e._mx_abortexception=t;try{e.abort()}catch{}}function Zye(e){return new Promise((t,n)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&n(e._mx_abortexception),t(null)},e.onerror=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(M.log("Error performing indexeddb txn",t),n(e.error))},e.onabort=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(M.log("Error performing indexeddb txn",t),n(e.error))}})}class Ht{static exists(e,t){return fQ(e,t)}static existsAndIsNotMigrated(e,t){return new Promise((n,r)=>{var i=!0,o=e.open(t);o.onupgradeneeded=()=>{i=!1},o.onblocked=()=>r(o.error),o.onsuccess=()=>{var s=o.result;if(i){var a=s.transaction([Ht.STORE_ACCOUNT],"readonly").objectStore(Ht.STORE_ACCOUNT).get(P5);a.onsuccess=()=>{var e,t=null!==(e=a.result)&&void 0!==e?e:Wg.NOT_STARTED;n(t===Wg.NOT_STARTED)},a.onerror=()=>{r(a.error)},s.close()}else s.close(),e.deleteDatabase(t),n(!1)},o.onerror=()=>r(o.error)})}constructor(e,t){this.indexedDB=e,this.dbName=t,P(this,"backendPromise",void 0),P(this,"backend",void 0)}containsData(){var e=this;return B(function*(){return Ht.exists(e.indexedDB,e.dbName)})()}startup(){return this.backendPromise||(this.backendPromise=new Promise((e,t)=>{if(this.indexedDB){M.log("connecting to indexeddb ".concat(this.dbName));var n=this.indexedDB.open(this.dbName,vQ);n.onupgradeneeded=e=>{Jye(n.result,e.oldVersion)},n.onblocked=()=>{M.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{M.log("Error connecting to indexeddb",e),t(n.error)},n.onsuccess=()=>{var t=n.result;M.log("connected to indexeddb ".concat(this.dbName)),e(new Xye(t))}}else t(new Error("no indexeddb support available"))}).then(e=>e.doTxn("readonly",[Ht.STORE_INBOUND_GROUP_SESSIONS,Ht.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],t=>{e.getEndToEndInboundGroupSession("","",t,()=>{})}).then(()=>e)).catch(e=>{if("VersionError"===e.name)throw M.warn("Crypto DB is too new for us to use!",e),new KP(GP.TooNew);M.warn("unable to connect to indexeddb ".concat(this.dbName)+": falling back to localStorage store: ".concat(e));try{if(!(globalThis.localStorage instanceof Storage))throw new Error("localStorage is not available");return new W3(globalThis.localStorage)}catch(e){return M.warn("Unable to open localStorage: falling back to in-memory store: ".concat(e)),new D3}}).then(e=>(this.backend=e,e))),this.backendPromise}deleteAllData(){return new Promise((e,t)=>{if(this.indexedDB){M.log("Removing indexeddb instance: ".concat(this.dbName));var n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{M.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{M.log("Error deleting data from indexeddb",e),t(n.error)},n.onsuccess=()=>{M.log("Removed indexeddb instance: ".concat(this.dbName)),e()}}else t(new Error("no indexeddb support available"))}).catch(e=>{M.warn("unable to delete IndexedDBCryptoStore: ".concat(e))})}getMigrationState(){return this.backend.getMigrationState()}setMigrationState(e){return this.backend.setMigrationState(e)}getAccount(e,t){this.backend.getAccount(e,t)}storeAccount(e,t){this.backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this.backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,n){this.backend.getSecretStorePrivateKey(e,t,n)}storeSecretStorePrivateKey(e,t,n){this.backend.storeSecretStorePrivateKey(e,t,n)}countEndToEndSessions(e,t){this.backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,n,r){this.backend.getEndToEndSession(e,t,n,r)}getEndToEndSessions(e,t,n){this.backend.getEndToEndSessions(e,t,n)}storeEndToEndSession(e,t,n,r){this.backend.storeEndToEndSession(e,t,n,r)}countEndToEndInboundGroupSessions(){return this.backend.countEndToEndInboundGroupSessions()}getEndToEndSessionsBatch(){return this.backend.getEndToEndSessionsBatch()}deleteEndToEndSessionsBatch(e){return this.backend.deleteEndToEndSessionsBatch(e)}getEndToEndInboundGroupSession(e,t,n,r){this.backend.getEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSession(e,t,n,r){this.backend.storeEndToEndInboundGroupSession(e,t,n,r)}getEndToEndInboundGroupSessionsBatch(){return this.backend.getEndToEndInboundGroupSessionsBatch()}deleteEndToEndInboundGroupSessionsBatch(e){return this.backend.deleteEndToEndInboundGroupSessionsBatch(e)}getEndToEndRooms(e,t){this.backend.getEndToEndRooms(e,t)}markSessionsNeedingBackup(e,t){return this.backend.markSessionsNeedingBackup(e,t)}doTxn(e,t,n,r){return this.backend.doTxn(e,t,n,r)}}P(Ht,"STORE_ACCOUNT","account"),P(Ht,"STORE_SESSIONS","sessions"),P(Ht,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions"),P(Ht,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld"),P(Ht,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions"),P(Ht,"STORE_PARKED_SHARED_HISTORY","parked_shared_history"),P(Ht,"STORE_DEVICE_DATA","device_data"),P(Ht,"STORE_ROOMS","rooms"),P(Ht,"STORE_BACKUP","sessions_needing_backup");var ebe=function(e){return e.Email="email",e.Phone="msisdn",e}({}),tbe=new xr("delegated_oidc_compatibility","org.matrix.msc3824.delegated_oidc_compatibility"),nbe=function(e){return e.Gitlab="gitlab",e.Github="github",e.Apple="apple",e.Google="google",e.Facebook="facebook",e.Twitter="twitter",e}({}),rbe=function(e){return e.LOGIN="login",e.REGISTER="register",e}({}),ibe="us.cloke.msc4175.tz";class sbe{constructor(e){P(this,"relations",void 0),this.relations=e.filter(e=>!!e)}getRelations(){return this.relations.reduce((e,t)=>[...e,...t.getRelations()],[])}on(e,t){this.relations.forEach(n=>n.on(e,t))}off(e,t){this.relations.forEach(n=>n.off(e,t))}}var obe=function(e){return e.Global="Global",e.SetItemError="setItem",e.GetItemError="getItem",e.RemoveItemError="removeItem",e.ClearError="clear",e.QuotaExceededError="QuotaExceededError",e}({});class abe extends Pn{}var cbe=new abe,yQ=()=>new D3;function bQ(e){yQ=e}function _Q(e){var t,n,r;return e.store=null!==(t=e.store)&&void 0!==t?t:new ub({localStorage:globalThis.localStorage}),e.scheduler=null!==(n=e.scheduler)&&void 0!==n?n:new Xg,e.cryptoStore=null!==(r=e.cryptoStore)&&void 0!==r?r:yQ(),e}function Y3(e){return new z3(_Q(e))}function SQ(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return new cQ(e,t,n,_Q(r),i)}const lbe=Object.freeze(Object.defineProperty({__proto__:null,AuthType:mA,AutoDiscovery:ht,AutoDiscoveryAction:vo,AutoDiscoveryError:Sa,Beacon:oJ,BeaconEvent:$n,CallEvent:bt,CallFeedEvent:Ac,Category:$l,ClientEvent:Le,ClientPrefix:Kr,ClientStoppedError:D0e,ConditionKind:Dr,ConditionOperator:r0e,ConnectionError:yp,ContentHelpers:Nve,DELEGATED_OIDC_COMPATIBILITY:tbe,DEVICE_CODE_SCOPE:vye,DMMemberCountCondition:i0e,DebugLogger:TP,Device:jye,DeviceVerification:uQ,Direction:gt,DuplicateStrategy:vy,EVENT_VISIBILITY_CHANGE_TYPE:Ah,EventEmitterEvents:PX,EventStatus:ot,EventTimeline:Me,EventTimelineSet:ng,EventType:ee,FILTER_RELATED_BY_REL_TYPES:Sg,FILTER_RELATED_BY_SENDERS:_g,FeatureSupport:Ji,Filter:As,GET_LOGIN_TOKEN_CAPABILITY:wye,GroupCall:$P,GroupCallEvent:Rn,GroupCallIntent:IJ,GroupCallState:er,GroupCallStatsReportEvent:iy,GroupCallType:H3,GuestAccess:eC,HTTPError:Xh,HistoryVisibility:VP,HttpApiEvent:H5,IdentityPrefix:Fl,IdentityProviderBrand:nbe,IndexedDBCryptoStore:Ht,IndexedDBStore:mQ,InteractiveAuth:eO,InvalidCryptoStoreError:KP,InvalidCryptoStoreState:GP,JoinRule:ef,KNOWN_SAFE_ROOM_VERSION:yJ,KeySignatureUploadError:M0e,KnownMembership:Ve,LOCAL_NOTIFICATION_SETTINGS_PREFIX:NX,LocalStorageCryptoStore:W3,LocalStorageErrors:obe,LocationAssetType:zg,MAIN_ROOM_TIMELINE:r_,MAXIMUM_MATRIX_VERSION:d0e,MINIMUM_MATRIX_VERSION:u0e,MSC3912_RELATION_BASED_REDACTIONS_PROP:U5,M_ASSET:t_,M_BEACON:tA,M_BEACON_INFO:qP,M_HTML:xve,M_LOCATION:n_,M_MESSAGE:kve,M_POLL_END:Qw,M_POLL_KIND_DISCLOSED:jve,M_POLL_KIND_UNDISCLOSED:Fve,M_POLL_RESPONSE:ib,M_POLL_START:$ve,M_TEXT:AP,M_TIMESTAMP:Af,M_TOPIC:LP,MatrixClient:z3,MatrixError:nr,MatrixEvent:Zi,MatrixEventEvent:qt,MatrixHttpApi:mJ,MatrixScheduler:Xg,MediaHandlerEvent:Eh,MediaPrefix:vg,MemoryCryptoStore:D3,MemoryStore:ub,Method:le,MsgType:cl,NoAuthFlowFoundError:dQ,NotificationCountType:zt,OidcError:Qi,OidcTokenRefresher:bye,PUSHER_DEVICE_ID:hve,PUSHER_ENABLED:j5,PendingEventOrdering:Qg,Poll:lJ,PollEvent:Pd,Preset:q3,ProfileKeyMSC4175Timezone:ibe,PushRuleActionName:Zd,PushRuleKind:vi,REFERENCE_RELATION:YX,ReceiptType:os,RelatedRelations:sbe,RelationType:kn,Relations:xP,RelationsEvent:NE,RestrictedAllowType:h0e,Room:$3,RoomCreateTypeField:Ww,RoomEvent:xe,RoomMember:tb,RoomMemberEvent:Ns,RoomNameType:xc,RoomState:lb,RoomStateEvent:vt,RoomSummary:zX,RoomType:gg,RoomVersionStability:gJ,RoomWidgetClient:cQ,RoomWidgetClientEvent:VE,RuleId:gi,SERVICE_TYPES:Z5,SSOAction:rbe,SUPPORTED_MATRIX_VERSIONS:ob,SearchOrderBy:AJ,SearchResult:V3,SecretStorage:P0e,ServerCapabilities:vJ,SetPresence:bJ,SlidingSyncEvent:eA,StatsReport:du,SyncAccumulator:lQ,SyncState:Vt,THREAD_RELATION_TYPE:yn,Thread:Mn,ThreadEvent:as,ThreadFilterType:Ua,ThreepidMedium:ebe,TimelineIndex:pA,TimelineWindow:$ye,ToDeviceMessageId:j3,TokenRefreshError:hJ,TokenRefreshLogoutError:MP,TweakName:BP,TypedEventEmitter:Pn,UNSIGNED_MEMBERSHIP_FIELD:UX,UNSIGNED_THREAD_ID_FIELD:Yw,UNSTABLE_ELEMENT_FUNCTIONAL_USERS:DX,UNSTABLE_MSC2666_MUTUAL_ROOMS:eQ,UNSTABLE_MSC2666_QUERY_MUTUAL_ROOMS:tQ,UNSTABLE_MSC2666_SHARED_ROOMS:ZJ,UNSTABLE_MSC2716_MARKER:MX,UNSTABLE_MSC3088_ENABLED:D5,UNSTABLE_MSC3088_PURPOSE:M5,UNSTABLE_MSC3089_BRANCH:tu,UNSTABLE_MSC3089_LEAF:OX,UNSTABLE_MSC3089_TREE_SUBTYPE:N5,UNSTABLE_MSC3852_LAST_SEEN_UA:Eye,UNSTABLE_MSC4133_EXTENDED_PROFILES:nQ,UNSTABLE_MSC4140_DELAYED_EVENTS:Bc,UnsupportedDelayedEventsEndpointError:qd,UpdateDelayedEventAction:UE,User:mu,UserEvent:Oi,Visibility:xJ,anySignal:pJ,calculateRetryBackoff:NP,completeAuthorizationCodeGrant:gye,createClient:Y3,createNewMatrixCall:sb,createRoomWidgetClient:SQ,decodeBase64:Nh,decodeIdToken:YJ,determineFeatureSupport:BE,discoverAndValidateOIDCIssuerWellKnown:QP,encodeBase64:yy,encodeUnpaddedBase64:CJ,encodeUnpaddedBase64Url:B3,fixNotificationCountOnDecryption:rQ,generateAuthorizationParams:fye,generateAuthorizationUrl:hye,generateOidcAuthorizationUrl:pye,generateScope:K3,getBeaconInfoIdentifier:Jw,getHttpUriForMxc:N3,inMainTimelineForReceipt:cb,isDmMemberCountCondition:s0e,isEventTypeSame:Ave,isPollEvent:uJ,isTimestampInDuration:$5,localStorageErrorsEventsEmitter:cbe,parseErrorResponse:DP,registerOidcClient:yye,retryNetworkOperation:V5,safeGetRetryAfterMs:OP,setCryptoStoreFactory:bQ,threadFilterTypeToFilter:iQ,threadIdForReceipt:Zg,timeoutSignal:F3,validateAuthMetadata:WJ,validateAuthMetadataAndKeys:ZP,validateBearerTokenResponse:QJ,validateIdToken:XJ,validateStoredUserState:JJ},Symbol.toStringTag,{value:"Module"}));if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");var gA;globalThis.__js_sdk_entrypoint=!0;try{gA=globalThis.indexedDB}catch{}gA&&bQ(()=>new Ht(gA,"matrix-js-sdk:crypto")),globalThis.matrixcs=lbe;var dB,fB,Lk={exports:{}},Et={};function ube(){if(dB)return Et;dB=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),s=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,f={};function m(e,t,n){this.props=e,this.context=t,this.refs=f,this.updater=n||h}function v(){}function g(e,t,n){this.props=e,this.context=t,this.refs=f,this.updater=n||h}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=m.prototype;var y=g.prototype=new v;y.constructor=g,p(y,m.prototype),y.isPureReactComponent=!0;var b=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},_=Object.prototype.hasOwnProperty;function S(t,n,r,i,o,s){return r=s.ref,{$$typeof:e,type:t,key:n,ref:void 0!==r?r:null,props:s}}function E(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var C=/\/+/g;function k(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(){}function R(n,r,i,o,s){var a=typeof n;("undefined"===a||"boolean"===a)&&(n=null);var l=!1;if(null===n)l=!0;else switch(a){case"bigint":case"string":case"number":l=!0;break;case"object":switch(n.$$typeof){case e:case t:l=!0;break;case u:return R((l=n._init)(n._payload),r,i,o,s)}}if(l)return s=s(n),l=""===o?"."+k(n,0):o,b(s)?(i="",null!=l&&(i=l.replace(C,"$&/")+"/"),R(s,r,i,"",function(e){return e})):null!=s&&(E(s)&&(s=function(e,t){return S(e.type,t,void 0,0,0,e.props)}(s,i+(null==s.key||n&&n.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+l)),r.push(s)),1;l=0;var c=""===o?".":o+":";if(b(n))for(var h=0;h<n.length;h++)l+=R(o=n[h],r,i,a=c+k(o,h),s);else if(h=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=d&&e[d]||e["@@iterator"])?e:null}(n),"function"==typeof h)for(n=h.call(n),h=0;!(o=n.next()).done;)l+=R(o=o.value,r,i,a=c+k(o,h++),s);else if("object"===a){if("function"==typeof n.then)return R(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(T,T):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(n),r,i,o,s);throw r=String(n),Error("Objects are not valid as a React child (found: "+("[object Object]"===r?"object with keys {"+Object.keys(n).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.")}return l}function I(e,t,n){if(null==e)return e;var r=[],i=0;return R(e,r,"","",function(e){return t.call(n,e,i++)}),r}function x(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function L(){}return Et.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Et.Component=m,Et.Fragment=n,Et.Profiler=i,Et.PureComponent=g,Et.StrictMode=r,Et.Suspense=l,Et.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,Et.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},Et.cache=function(e){return function(){return e.apply(null,arguments)}},Et.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var r=p({},e.props),i=e.key;if(null!=t)for(o in void 0!==t.ref&&void 0,void 0!==t.key&&(i=""+t.key),t)!_.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(r[o]=t[o]);var o=arguments.length-2;if(1===o)r.children=n;else if(1<o){for(var s=Array(o),a=0;a<o;a++)s[a]=arguments[a+2];r.children=s}return S(e.type,i,void 0,0,0,r)},Et.createContext=function(e){return(e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},Et.createElement=function(e,t,n){var r,i={},o=null;if(null!=t)for(r in void 0!==t.key&&(o=""+t.key),t)_.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var a=Array(s),l=0;l<s;l++)a[l]=arguments[l+2];i.children=a}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===i[r]&&(i[r]=s[r]);return S(e,o,void 0,0,0,i)},Et.createRef=function(){return{current:null}},Et.forwardRef=function(e){return{$$typeof:a,render:e}},Et.isValidElement=E,Et.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:x}},Et.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},Et.startTransition=function(e){var t=w.T,n={};w.T=n;try{var r=e(),i=w.S;null!==i&&i(n,r),"object"==typeof r&&null!==r&&"function"==typeof r.then&&r.then(L,P)}catch(e){P(e)}finally{w.T=t}},Et.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},Et.use=function(e){return w.H.use(e)},Et.useActionState=function(e,t,n){return w.H.useActionState(e,t,n)},Et.useCallback=function(e,t){return w.H.useCallback(e,t)},Et.useContext=function(e){return w.H.useContext(e)},Et.useDebugValue=function(){},Et.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},Et.useEffect=function(e,t,n){var r=w.H;if("function"==typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Et.useId=function(){return w.H.useId()},Et.useImperativeHandle=function(e,t,n){return w.H.useImperativeHandle(e,t,n)},Et.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},Et.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},Et.useMemo=function(e,t){return w.H.useMemo(e,t)},Et.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},Et.useReducer=function(e,t,n){return w.H.useReducer(e,t,n)},Et.useRef=function(e){return w.H.useRef(e)},Et.useState=function(e){return w.H.useState(e)},Et.useSyncExternalStore=function(e,t,n){return w.H.useSyncExternalStore(e,t,n)},Et.useTransition=function(){return w.H.useTransition()},Et.version="19.1.0",Et}function tO(){return fB||(fB=1,Lk.exports=ube()),Lk.exports}var _=tO();const Te=ac(_),c_=Nge({__proto__:null,default:Te},[_]);var hB,pB,Pk={exports:{}},w0={},Ok={exports:{}},Mk={};function dbe(){return hB||(hB=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<i(o,t)))break e;e[r]=t,e[n]=o,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,s=o>>>1;r<s;){var a=2*(r+1)-1,l=e[a],c=a+1,u=e[c];if(0>i(l,n))c<o&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else{if(!(c<o&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();e.unstable_now=function(){return s.now()-a}}var l=[],c=[],u=1,d=null,h=3,p=!1,f=!1,m=!1,v=!1,g="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function w(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function _(e){if(m=!1,w(e),!f)if(null!==n(l))f=!0,E||(E=!0,S());else{var t=n(c);null!==t&&L(_,t.startTime-e)}}var S,E=!1,C=-1,k=5,T=-1;function R(){return!!v||!(e.unstable_now()-T<k)}function I(){if(v=!1,E){var t=e.unstable_now();T=t;var i=!0;try{e:{f=!1,m&&(m=!1,y(C),C=-1),p=!0;var o=h;try{t:{for(w(t),d=n(l);null!==d&&!(d.expirationTime>t&&R());){var s=d.callback;if("function"==typeof s){d.callback=null,h=d.priorityLevel;var a=s(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof a){d.callback=a,w(t),i=!0;break t}d===n(l)&&r(l),w(t)}else r(l);d=n(l)}if(null!==d)i=!0;else{var u=n(c);null!==u&&L(_,u.startTime-t),i=!1}}break e}finally{d=null,h=o,p=!1}i=void 0}}finally{i?S():E=!1}}}if("function"==typeof b)S=function(){b(I)};else if(typeof MessageChannel<"u"){var x=new MessageChannel,P=x.port2;x.port1.onmessage=I,S=function(){P.postMessage(null)}}else S=function(){g(I,0)};function L(t,n){C=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_requestPaint=function(){v=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(r,i,o){var s=e.unstable_now();switch("object"==typeof o&&null!==o?o="number"==typeof(o=o.delay)&&0<o?s+o:s:o=s,r){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(r.sortIndex=o,t(c,r),null===n(l)&&r===n(c)&&(m?(y(C),C=-1):m=!0,L(_,o-s))):(r.sortIndex=a,t(l,r),f||p||(f=!0,E||(E=!0,S()))),r},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(Mk)),Mk}function fbe(){return pB||(pB=1,Ok.exports=dbe()),Ok.exports}var mB,gB,vB,yB,Dk={exports:{}},zi={};function hbe(){if(mB)return zi;mB=1;var e=tO();function t(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");var o=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}return zi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,zi.createPortal=function(e,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!n||1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType)throw Error(t(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:i,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,n,null,r)},zi.flushSync=function(e){var t=o.T,n=r.p;try{if(o.T=null,r.p=2,e)return e()}finally{o.T=t,r.p=n,r.d.f()}},zi.preconnect=function(e,t){"string"==typeof e&&(t?t="string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,r.d.C(e,t))},zi.prefetchDNS=function(e){"string"==typeof e&&r.d.D(e)},zi.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,i=s(n,t.crossOrigin),o="string"==typeof t.integrity?t.integrity:void 0,a="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?r.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:o,fetchPriority:a}):"script"===n&&r.d.X(e,{crossOrigin:i,integrity:o,fetchPriority:a,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},zi.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=s(t.as,t.crossOrigin);r.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&r.d.M(e)},zi.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,i=s(n,t.crossOrigin);r.d.L(e,n,{crossOrigin:i,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},zi.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=s(t.as,t.crossOrigin);r.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else r.d.m(e)},zi.requestFormReset=function(e){r.d.r(e)},zi.unstable_batchedUpdates=function(e,t){return e(t)},zi.useFormState=function(e,t,n){return o.H.useFormState(e,t,n)},zi.useFormStatus=function(){return o.H.useHostTransitionStatus()},zi.version="19.1.0",zi}function EQ(){if(gB)return Dk.exports;return gB=1,function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||"function"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),Dk.exports=hbe(),Dk.exports}function pbe(){if(vB)return w0;vB=1;var e=fbe(),t=tO(),n=EQ();function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function o(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function s(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function a(e){if(o(e)!==e)throw Error(r(188))}function l(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=l(e)))return t;e=e.sibling}return null}var c=Object.assign,u=Symbol.for("react.element"),d=Symbol.for("react.transitional.element"),h=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),g=Symbol.for("react.consumer"),y=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),C=Symbol.for("react.activity"),k=Symbol.for("react.memo_cache_sentinel"),T=Symbol.iterator;function R(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=T&&e[T]||e["@@iterator"])?e:null}var I=Symbol.for("react.client.reference");function x(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===I?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case p:return"Fragment";case m:return"Profiler";case f:return"StrictMode";case w:return"Suspense";case _:return"SuspenseList";case C:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case h:return"Portal";case y:return(e.displayName||"Context")+".Provider";case g:return(e._context.displayName||"Context")+".Consumer";case b:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case S:return null!==(t=e.displayName||null)?t:x(e.type)||"Memo";case E:t=e._payload,e=e._init;try{return x(e(t))}catch{}}return null}var P=Array.isArray,L=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O={pending:!1,data:null,method:null,action:null},A=[],D=-1;function N(e){return{current:e}}function j(e){0>D||(e.current=A[D],A[D]=null,D--)}function F(e,t){D++,A[D]=e.current,e.current=t}var U=N(null),B=N(null),H=N(null),$=N(null);function V(e,t){switch(F(H,t),F(B,e),F(U,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?td(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=nd(t=td(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}j(U),F(U,e)}function q(){j(U),j(B),j(H)}function G(e){null!==e.memoizedState&&F($,e);var t=U.current,n=nd(t,e.type);t!==n&&(F(B,e),F(U,n))}function z(e){B.current===e&&(j(U),j(B)),$.current===e&&(j($),Gd._currentValue=O)}var K=Object.prototype.hasOwnProperty,W=e.unstable_scheduleCallback,J=e.unstable_cancelCallback,Y=e.unstable_shouldYield,X=e.unstable_requestPaint,Q=e.unstable_now,Z=e.unstable_getCurrentPriorityLevel,ee=e.unstable_ImmediatePriority,te=e.unstable_UserBlockingPriority,ne=e.unstable_NormalPriority,re=e.unstable_LowPriority,ie=e.unstable_IdlePriority,oe=e.log,se=e.unstable_setDisableYieldValue,ae=null,le=null;function ce(e){if("function"==typeof oe&&se(e),le&&"function"==typeof le.setStrictMode)try{le.setStrictMode(ae,e)}catch{}}var ue=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(de(e)/he|0)|0},de=Math.log,he=Math.LN2;var pe=256,fe=4194304;function me(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ve(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var i=0,o=e.suspendedLanes,s=e.pingedLanes;e=e.warmLanes;var a=134217727&r;return 0!==a?0!==(r=a&~o)?i=me(r):0!==(s&=a)?i=me(s):n||0!==(n=a&~e)&&(i=me(n)):0!==(a=r&~o)?i=me(a):0!==s?i=me(s):n||0!==(n=r&~e)&&(i=me(n)),0===i?0:0!==t&&t!==i&&0===(t&o)&&((o=i&-i)>=(n=t&-t)||32===o&&4194048&n)?t:i}function ge(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function ye(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function be(){var e=pe;return!(4194048&(pe<<=1))&&(pe=256),e}function we(){var e=fe;return!(62914560&(fe<<=1))&&(fe=4194304),e}function _e(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Se(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ee(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-ue(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194090&n}function Ce(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ue(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function ke(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Te(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Re(){var e=M.p;return 0!==e?e:void 0===(e=window.event)?32:sh(e.type)}var Ie=Math.random().toString(36).slice(2),xe="__reactFiber$"+Ie,Pe="__reactProps$"+Ie,Le="__reactContainer$"+Ie,Me="__reactEvents$"+Ie,Oe="__reactListeners$"+Ie,Ae="__reactHandles$"+Ie,De="__reactResources$"+Ie,Ne="__reactMarker$"+Ie;function je(e){delete e[xe],delete e[Pe],delete e[Me],delete e[Oe],delete e[Ae]}function Fe(e){var t=e[xe];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Le]||n[xe]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=vd(e);null!==e;){if(n=e[xe])return n;e=vd(e)}return t}n=(e=n).parentNode}return null}function Ue(e){if(e=e[xe]||e[Le]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Be(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(r(33))}function He(e){var t=e[De];return t||(t=e[De]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function $e(e){e[Ne]=!0}var Ve=new Set,qe={};function Ge(e,t){ze(e,t),ze(e+"Capture",t)}function ze(e,t){for(qe[e]=t,e=0;e<t.length;e++)Ve.add(t[e])}var Ke,We,Je=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ye={},Xe={};function Qe(e,t,n){if(function(e){return!!K.call(Xe,e)||!K.call(Ye,e)&&(Je.test(e)?Xe[e]=!0:(Ye[e]=!0,!1))}(t))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function Ze(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function et(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function tt(e){if(void 0===Ke)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);Ke=t&&t[1]||"",We=-1<e.stack.indexOf("\n    at")?" (<anonymous>)":-1<e.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ke+e+We}var nt=!1;function rt(e,t){if(!e||nt)return"";nt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var r=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){r=e}e.call(n.prototype)}}else{try{throw Error()}catch(e){r=e}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(e){if(e&&r&&"string"==typeof e.stack)return[e.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=r.DetermineComponentFrameRoot(),s=o[0],a=o[1];if(s&&a){var l=s.split("\n"),c=a.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i);break}}}finally{nt=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?tt(n):""}function it(e){switch(e.tag){case 26:case 27:case 5:return tt(e.type);case 16:return tt("Lazy");case 13:return tt("Suspense");case 19:return tt("SuspenseList");case 0:case 15:return rt(e.type,!1);case 11:return rt(e.type.render,!1);case 1:return rt(e.type,!0);case 31:return tt("Activity");default:return""}}function ot(e){try{var t="";do{t+=it(e),e=e.return}while(e);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}function st(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function at(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function lt(e){e._valueTracker||(e._valueTracker=function(e){var t=at(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ct(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=at(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function ut(e){if(typeof(e=e||(typeof document<"u"?document:void 0))>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var dt=/[\n"\\]/g;function ht(e){return e.replace(dt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function pt(e,t,n,r,i,o,s,a){e.name="",null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+st(t)):e.value!==""+st(t)&&(e.value=""+st(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?mt(e,s,st(t)):null!=n?mt(e,s,st(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=o&&(e.defaultChecked=!!o),null!=i&&(e.checked=i&&"function"!=typeof i&&"symbol"!=typeof i),null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a?e.name=""+st(a):e.removeAttribute("name")}function ft(e,t,n,r,i,o,s,a){if(null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.type=o),null!=t||null!=n){if(("submit"===o||"reset"===o)&&null==t)return;n=null!=n?""+st(n):"",t=null!=t?""+st(t):n,a||t===e.value||(e.value=t),e.defaultValue=t}r="function"!=typeof(r=r??i)&&"symbol"!=typeof r&&!!r,e.checked=a?e.checked:!!r,e.defaultChecked=!!r,null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s&&(e.name=s)}function mt(e,t,n){"number"===t&&ut(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function vt(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+st(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function gt(e,t,n){null==t||((t=""+st(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+st(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function yt(e,t,n,i){if(null==t){if(null!=i){if(null!=n)throw Error(r(92));if(P(i)){if(1<i.length)throw Error(r(93));i=i[0]}n=i}null==n&&(n=""),t=n}n=st(t),e.defaultValue=n,(i=e.textContent)===n&&""!==i&&null!==i&&(e.value=i)}function bt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var wt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function _t(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!=typeof n||0===n||wt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function St(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(r(62));if(e=e.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var o in t)i=t[o],t.hasOwnProperty(o)&&n[o]!==i&&_t(e,o,i)}else for(var s in t)t.hasOwnProperty(s)&&_t(e,s,t[s])}function Et(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ct=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tt(e){return kt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Rt=null;function It(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xt=null,Pt=null;function Lt(e){var t=Ue(e);if(t&&(e=t.stateNode)){var n=e[Pe]||null;e:switch(e=t.stateNode,t.type){case"input":if(pt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+ht(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var o=i[Pe]||null;if(!o)throw Error(r(90));pt(i,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(t=0;t<n.length;t++)(i=n[t]).form===e.form&&ct(i)}break e;case"textarea":gt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&vt(e,!!n.multiple,t,!1)}}}var Mt=!1;function Ot(e,t,n){if(Mt)return e(t,n);Mt=!0;try{return e(t)}finally{if(Mt=!1,(null!==xt||null!==Pt)&&(Fc(),xt&&(t=xt,e=Pt,Pt=xt=null,Lt(t),e)))for(t=0;t<e.length;t++)Lt(e[t])}}function At(e,t){var n=e.stateNode;if(null===n)return null;var i=n[Pe]||null;if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(r(231,t,typeof n));return n}var Dt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nt=!1;if(Dt)try{var jt={};Object.defineProperty(jt,"passive",{get:function(){Nt=!0}}),window.addEventListener("test",jt,jt),window.removeEventListener("test",jt,jt)}catch{Nt=!1}var Ft=null,Ut=null,Bt=null;function Ht(){if(Bt)return Bt;var e,t,n=Ut,r=n.length,i="value"in Ft?Ft.value:Ft.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return Bt=i.slice(e,1<t?1-t:void 0)}function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Vt(){return!0}function qt(){return!1}function Gt(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Vt:qt,this.isPropagationStopped=qt,this}return c(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Vt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Vt)},persist:function(){},isPersistent:Vt}),t}var zt,Kt,Wt,Jt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yt=Gt(Jt),Xt=c({},Jt,{view:0,detail:0}),Qt=Gt(Xt),Zt=c({},Xt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Wt&&(Wt&&"mousemove"===e.type?(zt=e.screenX-Wt.screenX,Kt=e.screenY-Wt.screenY):Kt=zt=0,Wt=e),zt)},movementY:function(e){return"movementY"in e?e.movementY:Kt}}),en=Gt(Zt),tn=Gt(c({},Zt,{dataTransfer:0})),nn=Gt(c({},Xt,{relatedTarget:0})),rn=Gt(c({},Jt,{animationName:0,elapsedTime:0,pseudoElement:0})),on=Gt(c({},Jt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),sn=Gt(c({},Jt,{data:0})),an={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ln={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function un(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=cn[e])&&!!t[e]}function dn(){return un}var hn=Gt(c({},Xt,{key:function(e){if(e.key){var t=an[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ln[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dn,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),pn=Gt(c({},Zt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),fn=Gt(c({},Xt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dn})),mn=Gt(c({},Jt,{propertyName:0,elapsedTime:0,pseudoElement:0})),vn=Gt(c({},Zt,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),gn=Gt(c({},Jt,{newState:0,oldState:0})),yn=[9,13,27,32],bn=Dt&&"CompositionEvent"in window,wn=null;Dt&&"documentMode"in document&&(wn=document.documentMode);var _n=Dt&&"TextEvent"in window&&!wn,Sn=Dt&&(!bn||wn&&8<wn&&11>=wn),En=" ",Cn=!1;function kn(e,t){switch(e){case"keyup":return-1!==yn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Rn=!1;var In={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!In[e.type]:"textarea"===t}function Pn(e,t,n,r){xt?Pt?Pt.push(r):Pt=[r]:xt=r,0<(t=Hu(t,"onChange")).length&&(n=new Yt("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ln=null,Mn=null;function On(e){Ou(e,0)}function An(e){if(ct(Be(e)))return e}function Dn(e,t){if("change"===e)return t}var Nn=!1;if(Dt){var jn;if(Dt){var Fn="oninput"in document;if(!Fn){var Un=document.createElement("div");Un.setAttribute("oninput","return;"),Fn="function"==typeof Un.oninput}jn=Fn}else jn=!1;Nn=jn&&(!document.documentMode||9<document.documentMode)}function Bn(){Ln&&(Ln.detachEvent("onpropertychange",Hn),Mn=Ln=null)}function Hn(e){if("value"===e.propertyName&&An(Mn)){var t=[];Pn(t,Mn,e,It(e)),Ot(On,t)}}function $n(e,t,n){"focusin"===e?(Bn(),Mn=n,(Ln=t).attachEvent("onpropertychange",Hn)):"focusout"===e&&Bn()}function Vn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return An(Mn)}function qn(e,t){if("click"===e)return An(t)}function Gn(e,t){if("input"===e||"change"===e)return An(t)}var zn="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function Kn(e,t){if(zn(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!K.call(t,i)||!zn(e[i],t[i]))return!1}return!0}function Wn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Jn(e,t){var n,r=Wn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Wn(r)}}function Yn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Yn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Xn(e){for(var t=ut((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch{n=!1}if(!n)break;t=ut((e=t.contentWindow).document)}return t}function Qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Zn=Dt&&"documentMode"in document&&11>=document.documentMode,er=null,tr=null,nr=null,rr=!1;function ir(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;rr||null==er||er!==ut(r)||("selectionStart"in(r=er)&&Qn(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},nr&&Kn(nr,r)||(nr=r,0<(r=Hu(tr,"onSelect")).length&&(t=new Yt("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=er)))}function or(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var sr={animationend:or("Animation","AnimationEnd"),animationiteration:or("Animation","AnimationIteration"),animationstart:or("Animation","AnimationStart"),transitionrun:or("Transition","TransitionRun"),transitionstart:or("Transition","TransitionStart"),transitioncancel:or("Transition","TransitionCancel"),transitionend:or("Transition","TransitionEnd")},ar={},lr={};function cr(e){if(ar[e])return ar[e];if(!sr[e])return e;var t,n=sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in lr)return ar[e]=n[t];return e}Dt&&(lr=document.createElement("div").style,"AnimationEvent"in window||(delete sr.animationend.animation,delete sr.animationiteration.animation,delete sr.animationstart.animation),"TransitionEvent"in window||delete sr.transitionend.transition);var ur=cr("animationend"),dr=cr("animationiteration"),hr=cr("animationstart"),pr=cr("transitionrun"),fr=cr("transitionstart"),mr=cr("transitioncancel"),vr=cr("transitionend"),gr=new Map,yr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function br(e,t){gr.set(e,t),Ge(t,[e])}yr.push("scrollEnd");var wr=new WeakMap;function _r(e,t){if("object"==typeof e&&null!==e){var n=wr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ot(t)},wr.set(e,t),t)}return{value:e,source:t,stack:ot(t)}}var Sr=[],Er=0,Cr=0;function kr(){for(var e=Er,t=Cr=Er=0;t<e;){var n=Sr[t];Sr[t++]=null;var r=Sr[t];Sr[t++]=null;var i=Sr[t];Sr[t++]=null;var o=Sr[t];if(Sr[t++]=null,null!==r&&null!==i){var s=r.pending;null===s?i.next=i:(i.next=s.next,s.next=i),r.pending=i}0!==o&&xr(n,i,o)}}function Tr(e,t,n,r){Sr[Er++]=e,Sr[Er++]=t,Sr[Er++]=n,Sr[Er++]=r,Cr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Rr(e,t,n,r){return Tr(e,t,n,r),Pr(e)}function Ir(e,t){return Tr(e,null,null,t),Pr(e)}function xr(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(r=o.alternate)&&(r.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(i=!0)),e=o,o=o.return;return 3===e.tag?(o=e.stateNode,i&&null!==t&&(i=31-ue(n),null===(r=(e=o.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),o):null}function Pr(e){if(50<xc)throw xc=0,Pc=null,Error(r(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Lr={};function Mr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Or(e,t,n,r){return new Mr(e,t,n,r)}function Ar(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dr(e,t){var n=e.alternate;return null===n?((n=Or(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Nr(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function jr(e,t,n,i,o,s){var a=0;if(i=e,"function"==typeof e)Ar(e)&&(a=1);else if("string"==typeof e)a=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,U.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case C:return(e=Or(31,n,t,o)).elementType=C,e.lanes=s,e;case p:return Fr(n.children,o,s,t);case f:a=8,o|=24;break;case m:return(e=Or(12,n,t,2|o)).elementType=m,e.lanes=s,e;case w:return(e=Or(13,n,t,o)).elementType=w,e.lanes=s,e;case _:return(e=Or(19,n,t,o)).elementType=_,e.lanes=s,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case v:case y:a=10;break e;case g:a=9;break e;case b:a=11;break e;case S:a=14;break e;case E:a=16,i=null;break e}a=29,n=Error(r(130,null===e?"null":typeof e,"")),i=null}return(t=Or(a,n,t,o)).elementType=e,t.type=i,t.lanes=s,t}function Fr(e,t,n,r){return(e=Or(7,e,r,t)).lanes=n,e}function Ur(e,t,n){return(e=Or(6,e,null,t)).lanes=n,e}function Br(e,t,n){return(t=Or(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hr=[],$r=0,Vr=null,qr=0,Gr=[],zr=0,Kr=null,Wr=1,Jr="";function Yr(e,t){Hr[$r++]=qr,Hr[$r++]=Vr,Vr=e,qr=t}function Xr(e,t,n){Gr[zr++]=Wr,Gr[zr++]=Jr,Gr[zr++]=Kr,Kr=e;var r=Wr;e=Jr;var i=32-ue(r)-1;r&=~(1<<i),n+=1;var o=32-ue(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Wr=1<<32-ue(t)+i|n<<i|r,Jr=o+e}else Wr=1<<o|n<<i|r,Jr=e}function Qr(e){null!==e.return&&(Yr(e,1),Xr(e,1,0))}function Zr(e){for(;e===Vr;)Vr=Hr[--$r],Hr[$r]=null,qr=Hr[--$r],Hr[$r]=null;for(;e===Kr;)Kr=Gr[--zr],Gr[zr]=null,Jr=Gr[--zr],Gr[zr]=null,Wr=Gr[--zr],Gr[zr]=null}var ei=null,ti=null,ni=!1,ri=null,ii=!1,oi=Error(r(519));function si(e){throw hi(_r(Error(r(418,"")),e)),oi}function ai(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[xe]=e,t[Pe]=r,n){case"dialog":Au("cancel",t),Au("close",t);break;case"iframe":case"object":case"embed":Au("load",t);break;case"video":case"audio":for(n=0;n<Lu.length;n++)Au(Lu[n],t);break;case"source":Au("error",t);break;case"img":case"image":case"link":Au("error",t),Au("load",t);break;case"details":Au("toggle",t);break;case"input":Au("invalid",t),ft(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),lt(t);break;case"select":Au("invalid",t);break;case"textarea":Au("invalid",t),yt(t,r.value,r.defaultValue,r.children),lt(t)}"string"!=typeof(n=r.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||Ku(t.textContent,n)?(null!=r.popover&&(Au("beforetoggle",t),Au("toggle",t)),null!=r.onScroll&&Au("scroll",t),null!=r.onScrollEnd&&Au("scrollend",t),null!=r.onClick&&(t.onclick=Wu),t=!0):t=!1,t||si(e)}function li(e){for(ei=e.return;ei;)switch(ei.tag){case 5:case 13:return void(ii=!1);case 27:case 3:return void(ii=!0);default:ei=ei.return}}function ci(e){if(e!==ei)return!1;if(!ni)return li(e),ni=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||rd(e.type,e.memoizedProps)),t=!t),t&&ti&&si(e),li(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){ti=fd(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}ti=null}}else 27===n?(n=ti,ud(e.type)?(e=md,md=null,ti=e):ti=n):ti=ei?fd(e.stateNode.nextSibling):null;return!0}function ui(){ti=ei=null,ni=!1}function di(){var e=ri;return null!==e&&(null===vc?vc=e:vc.push.apply(vc,e),ri=null),e}function hi(e){null===ri?ri=[e]:ri.push(e)}var pi=N(null),fi=null,mi=null;function vi(e,t,n){F(pi,t._currentValue),t._currentValue=n}function gi(e){e._currentValue=pi.current,j(pi)}function yi(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function bi(e,t,n,i){var o=e.child;for(null!==o&&(o.return=e);null!==o;){var s=o.dependencies;if(null!==s){var a=o.child;s=s.firstContext;e:for(;null!==s;){var l=s;s=o;for(var c=0;c<t.length;c++)if(l.context===t[c]){s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),yi(s.return,n,e),i||(a=null);break e}s=l.next}}else if(18===o.tag){if(null===(a=o.return))throw Error(r(341));a.lanes|=n,null!==(s=a.alternate)&&(s.lanes|=n),yi(a,n,e),a=null}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===e){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}}function wi(e,t,n,i){e=null;for(var o=t,s=!1;null!==o;){if(!s)if(524288&o.flags)s=!0;else if(262144&o.flags)break;if(10===o.tag){var a=o.alternate;if(null===a)throw Error(r(387));if(null!==(a=a.memoizedProps)){var l=o.type;zn(o.pendingProps.value,a.value)||(null!==e?e.push(l):e=[l])}}else if(o===$.current){if(null===(a=o.alternate))throw Error(r(387));a.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(null!==e?e.push(Gd):e=[Gd])}o=o.return}null!==e&&bi(t,e,n,i),t.flags|=262144}function _i(e){for(e=e.firstContext;null!==e;){if(!zn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Si(e){fi=e,mi=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ei(e){return ki(fi,e)}function Ci(e,t){return null===fi&&Si(e),ki(e,t)}function ki(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===mi){if(null===e)throw Error(r(308));mi=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else mi=mi.next=t;return n}var Ti=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ri=e.unstable_scheduleCallback,Ii=e.unstable_NormalPriority,xi={$$typeof:y,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pi(){return{controller:new Ti,data:new Map,refCount:0}}function Li(e){e.refCount--,0===e.refCount&&Ri(Ii,function(){e.controller.abort()})}var Mi=null,Oi=0,Ai=0,Di=null;function Ni(){if(0===--Oi&&null!==Mi){null!==Di&&(Di.status="fulfilled");var e=Mi;Mi=null,Ai=0,Di=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var ji=L.S;L.S=function(e,t){"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Mi){var n=Mi=[];Oi=0,Ai=Tu(),Di={status:"pending",value:void 0,then:function(e){n.push(e)}}}Oi++,t.then(Ni,Ni)}(0,t),null!==ji&&ji(e,t)};var Fi=N(null);function Ui(){var e=Fi.current;return null!==e?e:ec.pooledCache}function Bi(e,t){F(Fi,null===t?Fi.current:t.pool)}function Hi(){var e=Ui();return null===e?null:{parent:xi._currentValue,pool:e}}var $i=Error(r(460)),Vi=Error(r(474)),qi=Error(r(542)),Gi={then:function(){}};function zi(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Ki(){}function Wi(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Ki,Ki),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw Xi(e=t.reason),e;default:if("string"==typeof t.status)t.then(Ki,Ki);else{if(null!==(e=ec)&&100<e.shellSuspendCounter)throw Error(r(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw Xi(e=t.reason),e}throw Ji=t,$i}}var Ji=null;function Yi(){if(null===Ji)throw Error(r(459));var e=Ji;return Ji=null,e}function Xi(e){if(e===$i||e===qi)throw Error(r(483))}var Qi=!1;function Zi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function eo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function to(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function no(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Zl){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=Pr(e),xr(e,null,n),t}return Tr(e,r,t,n),Pr(e)}function ro(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ce(e,n)}}function io(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var oo=!1;function so(){if(oo){if(null!==Di)throw Di}}function ao(e,t,n,r){oo=!1;var i=e.updateQueue;Qi=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,u=l.next;l.next=null,null===s?o=u:s.next=u,s=l;var d=e.alternate;null!==d&&((a=(d=d.updateQueue).lastBaseUpdate)!==s&&(null===a?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(null!==o){var h=i.baseState;for(s=0,d=u=l=null,a=o;;){var p=-536870913&a.lane,f=p!==a.lane;if(f?(nc&p)===p:(r&p)===p){0!==p&&p===Ai&&(oo=!0),null!==d&&(d=d.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});e:{var m=e,v=a;p=t;var g=n;switch(v.tag){case 1:if("function"==typeof(m=v.payload)){h=m.call(g,h,p);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(p="function"==typeof(m=v.payload)?m.call(g,h,p):m))break e;h=c({},h,p);break e;case 2:Qi=!0}}null!==(p=a.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=i.callbacks)?i.callbacks=[p]:f.push(p))}else f={lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===d?(u=d=f,l=h):d=d.next=f,s|=p;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(f=a).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}null===d&&(l=h),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=d,null===o&&(i.shared.lanes=0),uc|=s,e.lanes=s,e.memoizedState=h}}function lo(e,t){if("function"!=typeof e)throw Error(r(191,e));e.call(t)}function co(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)lo(n[e],t)}var uo=N(null),ho=N(0);function po(e,t){F(ho,e=lc),F(uo,t),lc=e|t.baseLanes}function fo(){F(ho,lc),F(uo,uo.current)}function mo(){lc=ho.current,j(uo),j(ho)}var vo=0,go=null,yo=null,bo=null,wo=!1,_o=!1,So=!1,Eo=0,Co=0,ko=null,To=0;function Ro(){throw Error(r(321))}function Io(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!zn(e[n],t[n]))return!1;return!0}function xo(e,t,n,r,i,o){return vo=o,go=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,L.H=null===e||null===e.memoizedState?Vs:qs,So=!1,o=n(r,i),So=!1,_o&&(o=Lo(t,n,r,i)),Po(e),o}function Po(e){L.H=$s;var t=null!==yo&&null!==yo.next;if(vo=0,bo=yo=go=null,wo=!1,Co=0,ko=null,t)throw Error(r(300));null===e||Ca||null!==(e=e.dependencies)&&_i(e)&&(Ca=!0)}function Lo(e,t,n,i){go=e;var o=0;do{if(_o&&(ko=null),Co=0,_o=!1,25<=o)throw Error(r(301));if(o+=1,bo=yo=null,null!=e.updateQueue){var s=e.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,null!=s.memoCache&&(s.memoCache.index=0)}L.H=Gs,s=t(n,i)}while(_o);return s}function Mo(){var e=L.H,t=e.useState()[0];return t="function"==typeof t.then?Fo(t):t,e=e.useState()[0],(null!==yo?yo.memoizedState:null)!==e&&(go.flags|=1024),t}function Oo(){var e=0!==Eo;return Eo=0,e}function Ao(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Do(e){if(wo){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}wo=!1}vo=0,bo=yo=go=null,_o=!1,Co=Eo=0,ko=null}function No(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===bo?go.memoizedState=bo=e:bo=bo.next=e,bo}function jo(){if(null===yo){var e=go.alternate;e=null!==e?e.memoizedState:null}else e=yo.next;var t=null===bo?go.memoizedState:bo.next;if(null!==t)bo=t,yo=e;else{if(null===e)throw null===go.alternate?Error(r(467)):Error(r(310));e={memoizedState:(yo=e).memoizedState,baseState:yo.baseState,baseQueue:yo.baseQueue,queue:yo.queue,next:null},null===bo?go.memoizedState=bo=e:bo=bo.next=e}return bo}function Fo(e){var t=Co;return Co+=1,null===ko&&(ko=[]),e=Wi(ko,e,t),t=go,null===(null===bo?t.memoizedState:bo.next)&&(t=t.alternate,L.H=null===t||null===t.memoizedState?Vs:qs),e}function Uo(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return Fo(e);if(e.$$typeof===y)return Ei(e)}throw Error(r(438,String(e)))}function Bo(e){var t=null,n=go.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=go.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},go.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=k;return t.index++,n}function Ho(e,t){return"function"==typeof t?t(e):t}function $o(e){return Vo(jo(),yo,e)}function Vo(e,t,n){var i=e.queue;if(null===i)throw Error(r(311));i.lastRenderedReducer=n;var o=e.baseQueue,s=i.pending;if(null!==s){if(null!==o){var a=o.next;o.next=s.next,s.next=a}t.baseQueue=o=s,i.pending=null}if(s=e.baseState,null===o)e.memoizedState=s;else{var l=a=null,c=null,u=t=o.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(nc&h)===h:(vo&h)===h){var p=u.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===Ai&&(d=!0);else{if((vo&p)===p){u=u.next,p===Ai&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,a=s):c=c.next=h,go.lanes|=p,uc|=p}h=u.action,So&&n(s,h),s=u.hasEagerState?u.eagerState:n(s,h)}else p={lane:h,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,a=s):c=c.next=p,go.lanes|=h,uc|=h;u=u.next}while(null!==u&&u!==t);if(null===c?a=s:c.next=l,!zn(s,e.memoizedState)&&(Ca=!0,d&&null!==(n=Di)))throw n;e.memoizedState=s,e.baseState=a,e.baseQueue=c,i.lastRenderedState=s}return null===o&&(i.lanes=0),[e.memoizedState,i.dispatch]}function qo(e){var t=jo(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,o=n.pending,s=t.memoizedState;if(null!==o){n.pending=null;var a=o=o.next;do{s=e(s,a.action),a=a.next}while(a!==o);zn(s,t.memoizedState)||(Ca=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function Go(e,t,n){var i=go,o=jo(),s=ni;if(s){if(void 0===n)throw Error(r(407));n=n()}else n=t();var a=!zn((yo||o).memoizedState,n);if(a&&(o.memoizedState=n,Ca=!0),o=o.queue,fs(2048,8,Wo.bind(null,i,o,e),[e]),o.getSnapshot!==t||a||null!==bo&&1&bo.memoizedState.tag){if(i.flags|=2048,ds(9,{destroy:void 0,resource:void 0},Ko.bind(null,i,o,n,t),null),null===ec)throw Error(r(349));s||124&vo||zo(i,t,n)}return n}function zo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=go.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},go.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ko(e,t,n,r){t.value=n,t.getSnapshot=r,Jo(t)&&Yo(e)}function Wo(e,t,n){return n(function(){Jo(t)&&Yo(e)})}function Jo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!zn(e,n)}catch{return!0}}function Yo(e){var t=Ir(e,2);null!==t&&Oc(t,e,2)}function Xo(e){var t=No();if("function"==typeof e){var n=e;if(e=n(),So){ce(!0);try{n()}finally{ce(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:e},t}function Qo(e,t,n,r){return e.baseState=n,Vo(e,yo,"function"==typeof r?r:Ho)}function Zo(e,t,n,i,o){if(Us(e))throw Error(r(485));if(null!==(e=t.action)){var s={payload:o,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){s.listeners.push(e)}};null!==L.T?n(!0):s.isTransition=!1,i(s),null===(n=t.pending)?(s.next=t.pending=s,es(t,s)):(s.next=n.next,t.pending=n.next=s)}}function es(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var o=L.T,s={};L.T=s;try{var a=n(i,r),l=L.S;null!==l&&l(s,a),ts(e,t,a)}catch(n){rs(e,t,n)}finally{L.T=o}}else try{ts(e,t,o=n(i,r))}catch(n){rs(e,t,n)}}function ts(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){ns(e,t,n)},function(n){return rs(e,t,n)}):ns(e,t,n)}function ns(e,t,n){t.status="fulfilled",t.value=n,is(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,es(e,n)))}function rs(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,is(t),t=t.next}while(t!==r)}e.action=null}function is(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function os(e,t){return t}function ss(e,t){if(ni){var n=ec.formState;if(null!==n){e:{var r=go;if(ni){if(ti){t:{for(var i=ti,o=ii;8!==i.nodeType;){if(!o){i=null;break t}if(null===(i=fd(i.nextSibling))){i=null;break t}}i="F!"===(o=i.data)||"F"===o?i:null}if(i){ti=fd(i.nextSibling),r="F!"===i.data;break e}}si(r)}r=!1}r&&(t=n[0])}}return(n=No()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:os,lastRenderedState:t},n.queue=r,n=Ns.bind(null,go,r),r.dispatch=n,r=Xo(!1),o=Fs.bind(null,go,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=No()).queue=i,n=Zo.bind(null,go,i,o,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function as(e){return ls(jo(),yo,e)}function ls(e,t,n){if(t=Vo(e,t,os)[0],e=$o(Ho)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var r=Fo(t)}catch(e){throw e===$i?qi:e}else r=t;var i=(t=jo()).queue,o=i.dispatch;return n!==t.memoizedState&&(go.flags|=2048,ds(9,{destroy:void 0,resource:void 0},cs.bind(null,i,n),null)),[r,o,e]}function cs(e,t){e.action=t}function us(e){var t=jo(),n=yo;if(null!==n)return ls(t,n,e);jo(),t=t.memoizedState;var r=(n=jo()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function ds(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=go.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},go.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function hs(){return jo().memoizedState}function ps(e,t,n,r){var i=No();r=void 0===r?null:r,go.flags|=e,i.memoizedState=ds(1|t,{destroy:void 0,resource:void 0},n,r)}function fs(e,t,n,r){var i=jo();r=void 0===r?null:r;var o=i.memoizedState.inst;null!==yo&&null!==r&&Io(r,yo.memoizedState.deps)?i.memoizedState=ds(t,o,n,r):(go.flags|=e,i.memoizedState=ds(1|t,o,n,r))}function ms(e,t){ps(8390656,8,e,t)}function vs(e,t){fs(2048,8,e,t)}function gs(e,t){return fs(4,2,e,t)}function ys(e,t){return fs(4,4,e,t)}function bs(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function ws(e,t,n){n=null!=n?n.concat([e]):null,fs(4,4,bs.bind(null,t,e),n)}function _s(){}function Ss(e,t){var n=jo();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&Io(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Es(e,t){var n=jo();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&Io(t,r[1]))return r[0];if(r=e(),So){ce(!0);try{e()}finally{ce(!1)}}return n.memoizedState=[r,t],r}function Cs(e,t,n){return void 0===n||1073741824&vo?e.memoizedState=t:(e.memoizedState=n,e=Mc(),go.lanes|=e,uc|=e,n)}function ks(e,t,n,r){return zn(n,t)?n:null!==uo.current?(e=Cs(e,n,r),zn(e,t)||(Ca=!0),e):42&vo?(e=Mc(),go.lanes|=e,uc|=e,t):(Ca=!0,e.memoizedState=n)}function Ts(e,t,n,r,i){var o=M.p;M.p=0!==o&&8>o?o:8;var s=L.T,a={};L.T=a,Fs(e,!1,t,n);try{var l=i(),c=L.S;if(null!==c&&c(a,l),null!==l&&"object"==typeof l&&"function"==typeof l.then){var u=function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}(l,r);js(e,t,u,Lc())}else js(e,t,r,Lc())}catch(n){js(e,t,{then:function(){},status:"rejected",reason:n},Lc())}finally{M.p=o,L.T=s}}function Rs(){}function Is(e,t,n,i){if(5!==e.tag)throw Error(r(476));var o=xs(e).queue;Ts(e,o,t,O,null===n?Rs:function(){return Ps(e),n(i)})}function xs(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:O,baseState:O,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:O},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Ps(e){js(e,xs(e).next.queue,{},Lc())}function Ls(){return Ei(Gd)}function Ms(){return jo().memoizedState}function Os(){return jo().memoizedState}function As(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Lc(),r=no(t,e=to(n),n);return null!==r&&(Oc(r,t,n),ro(r,t,n)),t={cache:Pi()},void(e.payload=t)}t=t.return}}function Ds(e,t,n){var r=Lc();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Us(e)?Bs(t,n):null!==(n=Rr(e,t,n,r))&&(Oc(n,e,r),Hs(n,t,r))}function Ns(e,t,n){js(e,t,n,Lc())}function js(e,t,n,r){var i={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Us(e))Bs(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,zn(a,s))return Tr(e,t,i,0),null===ec&&kr(),!1}catch{}if(null!==(n=Rr(e,t,i,r)))return Oc(n,e,r),Hs(n,t,r),!0}return!1}function Fs(e,t,n,i){if(i={lane:2,revertLane:Tu(),action:i,hasEagerState:!1,eagerState:null,next:null},Us(e)){if(t)throw Error(r(479))}else null!==(t=Rr(e,n,i,2))&&Oc(t,e,2)}function Us(e){var t=e.alternate;return e===go||null!==t&&t===go}function Bs(e,t){_o=wo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Hs(e,t,n){if(4194048&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ce(e,n)}}var $s={readContext:Ei,use:Uo,useCallback:Ro,useContext:Ro,useEffect:Ro,useImperativeHandle:Ro,useLayoutEffect:Ro,useInsertionEffect:Ro,useMemo:Ro,useReducer:Ro,useRef:Ro,useState:Ro,useDebugValue:Ro,useDeferredValue:Ro,useTransition:Ro,useSyncExternalStore:Ro,useId:Ro,useHostTransitionStatus:Ro,useFormState:Ro,useActionState:Ro,useOptimistic:Ro,useMemoCache:Ro,useCacheRefresh:Ro},Vs={readContext:Ei,use:Uo,useCallback:function(e,t){return No().memoizedState=[e,void 0===t?null:t],e},useContext:Ei,useEffect:ms,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,ps(4194308,4,bs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ps(4194308,4,e,t)},useInsertionEffect:function(e,t){ps(4,2,e,t)},useMemo:function(e,t){var n=No();t=void 0===t?null:t;var r=e();if(So){ce(!0);try{e()}finally{ce(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=No();if(void 0!==n){var i=n(t);if(So){ce(!0);try{n(t)}finally{ce(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=Ds.bind(null,go,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},No().memoizedState=e},useState:function(e){var t=(e=Xo(e)).queue,n=Ns.bind(null,go,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:_s,useDeferredValue:function(e,t){return Cs(No(),e,t)},useTransition:function(){var e=Xo(!1);return e=Ts.bind(null,go,e.queue,!0,!1),No().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=go,o=No();if(ni){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===ec)throw Error(r(349));124&nc||zo(i,t,n)}o.memoizedState=n;var s={value:n,getSnapshot:t};return o.queue=s,ms(Wo.bind(null,i,s,e),[e]),i.flags|=2048,ds(9,{destroy:void 0,resource:void 0},Ko.bind(null,i,s,n,t),null),n},useId:function(){var e=No(),t=ec.identifierPrefix;if(ni){var n=Jr;t="«"+t+"R"+(n=(Wr&~(1<<32-ue(Wr)-1)).toString(32)+n),0<(n=Eo++)&&(t+="H"+n.toString(32)),t+="»"}else t="«"+t+"r"+(n=To++).toString(32)+"»";return e.memoizedState=t},useHostTransitionStatus:Ls,useFormState:ss,useActionState:ss,useOptimistic:function(e){var t=No();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Fs.bind(null,go,!0,n),n.dispatch=t,[e,t]},useMemoCache:Bo,useCacheRefresh:function(){return No().memoizedState=As.bind(null,go)}},qs={readContext:Ei,use:Uo,useCallback:Ss,useContext:Ei,useEffect:vs,useImperativeHandle:ws,useInsertionEffect:gs,useLayoutEffect:ys,useMemo:Es,useReducer:$o,useRef:hs,useState:function(){return $o(Ho)},useDebugValue:_s,useDeferredValue:function(e,t){return ks(jo(),yo.memoizedState,e,t)},useTransition:function(){var e=$o(Ho)[0],t=jo().memoizedState;return["boolean"==typeof e?e:Fo(e),t]},useSyncExternalStore:Go,useId:Ms,useHostTransitionStatus:Ls,useFormState:as,useActionState:as,useOptimistic:function(e,t){return Qo(jo(),0,e,t)},useMemoCache:Bo,useCacheRefresh:Os},Gs={readContext:Ei,use:Uo,useCallback:Ss,useContext:Ei,useEffect:vs,useImperativeHandle:ws,useInsertionEffect:gs,useLayoutEffect:ys,useMemo:Es,useReducer:qo,useRef:hs,useState:function(){return qo(Ho)},useDebugValue:_s,useDeferredValue:function(e,t){var n=jo();return null===yo?Cs(n,e,t):ks(n,yo.memoizedState,e,t)},useTransition:function(){var e=qo(Ho)[0],t=jo().memoizedState;return["boolean"==typeof e?e:Fo(e),t]},useSyncExternalStore:Go,useId:Ms,useHostTransitionStatus:Ls,useFormState:us,useActionState:us,useOptimistic:function(e,t){var n=jo();return null!==yo?Qo(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Bo,useCacheRefresh:Os},zs=null,Ks=0;function Ws(e){var t=Ks;return Ks+=1,null===zs&&(zs=[]),Wi(zs,e,t)}function Js(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Ys(e,t){throw t.$$typeof===u?Error(r(525)):(e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function Xs(e){return(0,e._init)(e._payload)}function Qs(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function o(e,t){return(e=Dr(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Ur(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===p?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"==typeof i&&null!==i&&i.$$typeof===E&&Xs(i)===t.type)?(Js(t=o(t,n.props),n),t.return=e,t):(Js(t=jr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Br(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function f(e,t,n,r,i){return null===t||7!==t.tag?((t=Fr(n,e.mode,r,i)).return=e,t):((t=o(t,n)).return=e,t)}function m(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Ur(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case d:return Js(n=jr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case h:return(t=Br(t,e.mode,n)).return=e,t;case E:return m(e,t=(0,t._init)(t._payload),n)}if(P(t)||R(t))return(t=Fr(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return m(e,Ws(t),n);if(t.$$typeof===y)return m(e,Ci(e,t),n);Ys(e,t)}return null}function v(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case d:return n.key===i?c(e,t,n,r):null;case h:return n.key===i?u(e,t,n,r):null;case E:return v(e,t,n=(i=n._init)(n._payload),r)}if(P(n)||R(n))return null!==i?null:f(e,t,n,r,null);if("function"==typeof n.then)return v(e,t,Ws(n),r);if(n.$$typeof===y)return v(e,t,Ci(e,n),r);Ys(e,n)}return null}function g(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case d:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case h:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case E:return g(e,t,n,r=(0,r._init)(r._payload),i)}if(P(r)||R(r))return f(t,e=e.get(n)||null,r,i,null);if("function"==typeof r.then)return g(e,t,n,Ws(r),i);if(r.$$typeof===y)return g(e,t,n,Ci(t,r),i);Ys(t,r)}return null}function b(l,c,u,f){if("object"==typeof u&&null!==u&&u.type===p&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case d:e:{for(var w=u.key;null!==c;){if(c.key===w){if((w=u.type)===p){if(7===c.tag){n(l,c.sibling),(f=o(c,u.props.children)).return=l,l=f;break e}}else if(c.elementType===w||"object"==typeof w&&null!==w&&w.$$typeof===E&&Xs(w)===c.type){n(l,c.sibling),Js(f=o(c,u.props),u),f.return=l,l=f;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===p?((f=Fr(u.props.children,l.mode,f,u.key)).return=l,l=f):(Js(f=jr(u.type,u.key,u.props,null,l.mode,f),u),f.return=l,l=f)}return a(l);case h:e:{for(w=u.key;null!==c;){if(c.key===w){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(f=o(c,u.children||[])).return=l,l=f;break e}n(l,c);break}t(l,c),c=c.sibling}(f=Br(u,l.mode,f)).return=l,l=f}return a(l);case E:return b(l,c,u=(w=u._init)(u._payload),f)}if(P(u))return function(r,o,a,l){for(var c=null,u=null,d=o,h=o=0,p=null;null!==d&&h<a.length;h++){d.index>h?(p=d,d=null):p=d.sibling;var f=v(r,d,a[h],l);if(null===f){null===d&&(d=p);break}e&&d&&null===f.alternate&&t(r,d),o=s(f,o,h),null===u?c=f:u.sibling=f,u=f,d=p}if(h===a.length)return n(r,d),ni&&Yr(r,h),c;if(null===d){for(;h<a.length;h++)null!==(d=m(r,a[h],l))&&(o=s(d,o,h),null===u?c=d:u.sibling=d,u=d);return ni&&Yr(r,h),c}for(d=i(d);h<a.length;h++)null!==(p=g(d,r,h,a[h],l))&&(e&&null!==p.alternate&&d.delete(null===p.key?h:p.key),o=s(p,o,h),null===u?c=p:u.sibling=p,u=p);return e&&d.forEach(function(e){return t(r,e)}),ni&&Yr(r,h),c}(l,c,u,f);if(R(u)){if("function"!=typeof(w=R(u)))throw Error(r(150));return function(o,a,l,c){if(null==l)throw Error(r(151));for(var u=null,d=null,h=a,p=a=0,f=null,y=l.next();null!==h&&!y.done;p++,y=l.next()){h.index>p?(f=h,h=null):f=h.sibling;var b=v(o,h,y.value,c);if(null===b){null===h&&(h=f);break}e&&h&&null===b.alternate&&t(o,h),a=s(b,a,p),null===d?u=b:d.sibling=b,d=b,h=f}if(y.done)return n(o,h),ni&&Yr(o,p),u;if(null===h){for(;!y.done;p++,y=l.next())null!==(y=m(o,y.value,c))&&(a=s(y,a,p),null===d?u=y:d.sibling=y,d=y);return ni&&Yr(o,p),u}for(h=i(h);!y.done;p++,y=l.next())null!==(y=g(h,o,p,y.value,c))&&(e&&null!==y.alternate&&h.delete(null===y.key?p:y.key),a=s(y,a,p),null===d?u=y:d.sibling=y,d=y);return e&&h.forEach(function(e){return t(o,e)}),ni&&Yr(o,p),u}(l,c,u=w.call(u),f)}if("function"==typeof u.then)return b(l,c,Ws(u),f);if(u.$$typeof===y)return b(l,c,Ci(l,u),f);Ys(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u||"bigint"==typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(f=o(c,u)).return=l,l=f):(n(l,c),(f=Ur(u,l.mode,f)).return=l,l=f),a(l)):n(l,c)}return function(e,t,n,r){try{Ks=0;var i=b(e,t,n,r);return zs=null,i}catch(t){if(t===$i||t===qi)throw t;var o=Or(29,t,null,e.mode);return o.lanes=r,o.return=e,o}}}var Zs=Qs(!0),ea=Qs(!1),ta=N(null),na=null;function ra(e){var t=e.alternate;F(aa,1&aa.current),F(ta,e),null===na&&(null===t||null!==uo.current||null!==t.memoizedState)&&(na=e)}function ia(e){if(22===e.tag){if(F(aa,aa.current),F(ta,e),null===na){var t=e.alternate;null!==t&&null!==t.memoizedState&&(na=e)}}else oa()}function oa(){F(aa,aa.current),F(ta,ta.current)}function sa(e){j(ta),na===e&&(na=null),j(aa)}var aa=N(0);function la(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||pd(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ca(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:c({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ua={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Lc(),i=to(r);i.payload=t,null!=n&&(i.callback=n),null!==(t=no(e,i,r))&&(Oc(t,e,r),ro(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Lc(),i=to(r);i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=no(e,i,r))&&(Oc(t,e,r),ro(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Lc(),r=to(n);r.tag=2,null!=t&&(r.callback=t),null!==(t=no(e,r,n))&&(Oc(t,e,n),ro(t,e,n))}};function da(e,t,n,r,i,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!Kn(n,r)||!Kn(i,o))}function ha(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ua.enqueueReplaceState(t,t.state,null)}function pa(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=c({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}var fa="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function ma(e){fa(e)}function va(e){console.error(e)}function ga(e){fa(e)}function ya(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(e){setTimeout(function(){throw e})}}function ba(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(e){setTimeout(function(){throw e})}}function wa(e,t,n){return(n=to(n)).tag=3,n.payload={element:null},n.callback=function(){ya(e,t)},n}function _a(e){return(e=to(e)).tag=3,e}function Sa(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"==typeof i){var o=r.value;e.payload=function(){return i(o)},e.callback=function(){ba(t,n,r)}}var s=n.stateNode;null!==s&&"function"==typeof s.componentDidCatch&&(e.callback=function(){ba(t,n,r),"function"!=typeof i&&(null===_c?_c=new Set([this]):_c.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Ea=Error(r(461)),Ca=!1;function ka(e,t,n,r){t.child=null===e?ea(t,null,n,r):Zs(t,e.child,n,r)}function Ta(e,t,n,r,i){n=n.render;var o=t.ref;if("ref"in r){var s={};for(var a in r)"ref"!==a&&(s[a]=r[a])}else s=r;return Si(t),r=xo(e,t,n,s,o,i),a=Oo(),null===e||Ca?(ni&&a&&Qr(t),t.flags|=1,ka(e,t,r,i),t.child):(Ao(e,t,i),za(e,t,i))}function Ra(e,t,n,r,i){if(null===e){var o=n.type;return"function"!=typeof o||Ar(o)||void 0!==o.defaultProps||null!==n.compare?((e=jr(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ia(e,t,o,r,i))}if(o=e.child,!Ka(e,i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:Kn)(s,r)&&e.ref===t.ref)return za(e,t,i)}return t.flags|=1,(e=Dr(o,r)).ref=t.ref,e.return=t,t.child=e}function Ia(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(Kn(o,r)&&e.ref===t.ref){if(Ca=!1,t.pendingProps=r=o,!Ka(e,i))return t.lanes=e.lanes,za(e,t,i);131072&e.flags&&(Ca=!0)}}return Ma(e,t,n,r,i)}function xa(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode){if(128&t.flags){if(r=null!==o?o.baseLanes|n:n,null!==e){for(i=t.child=e.child,o=0;null!==i;)o=o|i.lanes|i.childLanes,i=i.sibling;t.childLanes=o&~r}else t.childLanes=0,t.child=null;return Pa(e,t,r,n)}if(!(536870912&n))return t.lanes=t.childLanes=536870912,Pa(e,t,null!==o?o.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Bi(0,null!==o?o.cachePool:null),null!==o?po(t,o):fo(),ia(t)}else null!==o?(Bi(0,o.cachePool),po(t,o),oa(),t.memoizedState=null):(null!==e&&Bi(0,null),fo(),oa());return ka(e,t,i,n),t.child}function Pa(e,t,n,r){var i=Ui();return i=null===i?null:{parent:xi._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&Bi(0,null),fo(),ia(t),null!==e&&wi(e,t,r,!0),null}function La(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(r(284));(null===e||e.ref!==n)&&(t.flags|=4194816)}}function Ma(e,t,n,r,i){return Si(t),n=xo(e,t,n,r,void 0,i),r=Oo(),null===e||Ca?(ni&&r&&Qr(t),t.flags|=1,ka(e,t,n,i),t.child):(Ao(e,t,i),za(e,t,i))}function Oa(e,t,n,r,i,o){return Si(t),t.updateQueue=null,n=Lo(t,r,n,i),Po(e),r=Oo(),null===e||Ca?(ni&&r&&Qr(t),t.flags|=1,ka(e,t,n,o),t.child):(Ao(e,t,o),za(e,t,o))}function Aa(e,t,n,r,i){if(Si(t),null===t.stateNode){var o=Lr,s=n.contextType;"object"==typeof s&&null!==s&&(o=Ei(s)),o=new n(r,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=ua,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=r,o.state=t.memoizedState,o.refs={},Zi(t),s=n.contextType,o.context="object"==typeof s&&null!==s?Ei(s):Lr,o.state=t.memoizedState,"function"==typeof(s=n.getDerivedStateFromProps)&&(ca(t,n,s,r),o.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(s=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),s!==o.state&&ua.enqueueReplaceState(o,o.state,null),ao(t,r,o,i),so(),o.state=t.memoizedState),"function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){o=t.stateNode;var a=t.memoizedProps,l=pa(n,a);o.props=l;var c=o.context,u=n.contextType;s=Lr,"object"==typeof u&&null!==u&&(s=Ei(u));var d=n.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof o.getSnapshotBeforeUpdate,a=t.pendingProps!==a,u||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a||c!==s)&&ha(t,o,r,s),Qi=!1;var h=t.memoizedState;o.state=h,ao(t,r,o,i),so(),c=t.memoizedState,a||h!==c||Qi?("function"==typeof d&&(ca(t,n,d,r),c=t.memoizedState),(l=Qi||da(t,n,l,r,h,c,s))?(u||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=s,r=l):("function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,eo(e,t),u=pa(n,s=t.memoizedProps),o.props=u,d=t.pendingProps,h=o.context,c=n.contextType,l=Lr,"object"==typeof c&&null!==c&&(l=Ei(c)),(c="function"==typeof(a=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==d||h!==l)&&ha(t,o,r,l),Qi=!1,h=t.memoizedState,o.state=h,ao(t,r,o,i),so();var p=t.memoizedState;s!==d||h!==p||Qi||null!==e&&null!==e.dependencies&&_i(e.dependencies)?("function"==typeof a&&(ca(t,n,a,r),p=t.memoizedState),(u=Qi||da(t,n,u,r,h,p,l)||null!==e&&null!==e.dependencies&&_i(e.dependencies))?(c||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=l,r=u):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return o=r,La(e,t),r=!!(128&t.flags),o||r?(o=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&r?(t.child=Zs(t,e.child,null,i),t.child=Zs(t,null,n,i)):ka(e,t,n,i),t.memoizedState=o.state,e=t.child):e=za(e,t,i),e}function Da(e,t,n,r){return ui(),t.flags|=256,ka(e,t,n,r),t.child}var Na={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ja(e){return{baseLanes:e,cachePool:Hi()}}function Fa(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=pc),e}function Ua(e,t,n){var i,o=t.pendingProps,s=!1,a=!!(128&t.flags);if((i=a)||(i=(null===e||null!==e.memoizedState)&&!!(2&aa.current)),i&&(s=!0,t.flags&=-129),i=!!(32&t.flags),t.flags&=-33,null===e){if(ni){if(s?ra(t):oa(),ni){var l,c=ti;if(l=c){e:{for(l=c,c=ii;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=fd(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Kr?{id:Wr,overflow:Jr}:null,retryLane:536870912,hydrationErrors:null},(l=Or(18,null,null,0)).stateNode=c,l.return=t,t.child=l,ei=t,ti=null,l=!0):l=!1}l||si(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return pd(c)?t.lanes=32:t.lanes=536870912,null;sa(t)}return c=o.children,o=o.fallback,s?(oa(),c=Ha({mode:"hidden",children:c},s=t.mode),o=Fr(o,s,n,null),c.return=t,o.return=t,c.sibling=o,t.child=c,(s=t.child).memoizedState=ja(n),s.childLanes=Fa(e,i,n),t.memoizedState=Na,o):(ra(t),Ba(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(a)256&t.flags?(ra(t),t.flags&=-257,t=$a(e,t,n)):null!==t.memoizedState?(oa(),t.child=e.child,t.flags|=128,t=null):(oa(),s=o.fallback,c=t.mode,o=Ha({mode:"visible",children:o.children},c),(s=Fr(s,c,n,null)).flags|=2,o.return=t,s.return=t,o.sibling=s,t.child=o,Zs(t,e.child,null,n),(o=t.child).memoizedState=ja(n),o.childLanes=Fa(e,i,n),t.memoizedState=Na,t=s);else if(ra(t),pd(c)){if(i=c.nextSibling&&c.nextSibling.dataset)var u=i.dgst;i=u,(o=Error(r(419))).stack="",o.digest=i,hi({value:o,source:null,stack:null}),t=$a(e,t,n)}else if(Ca||wi(e,t,n,!1),i=0!==(n&e.childLanes),Ca||i){if(null!==(i=ec)&&(0!==(o=0!==((o=42&(o=n&-n)?1:ke(o))&(i.suspendedLanes|n))?0:o)&&o!==l.retryLane))throw l.retryLane=o,Ir(e,o),Oc(i,e,o),Ea;"$?"===c.data||qc(),t=$a(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,ti=fd(c.nextSibling),ei=t,ni=!0,ri=null,ii=!1,null!==e&&(Gr[zr++]=Wr,Gr[zr++]=Jr,Gr[zr++]=Kr,Wr=e.id,Jr=e.overflow,Kr=t),(t=Ba(t,o.children)).flags|=4096);return t}return s?(oa(),s=o.fallback,c=t.mode,u=(l=e.child).sibling,(o=Dr(l,{mode:"hidden",children:o.children})).subtreeFlags=65011712&l.subtreeFlags,null!==u?s=Dr(u,s):(s=Fr(s,c,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,null===(c=e.child.memoizedState)?c=ja(n):(null!==(l=c.cachePool)?(u=xi._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Hi(),c={baseLanes:c.baseLanes|n,cachePool:l}),s.memoizedState=c,s.childLanes=Fa(e,i,n),t.memoizedState=Na,o):(ra(t),e=(n=e.child).sibling,(n=Dr(n,{mode:"visible",children:o.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function Ba(e,t){return(t=Ha({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ha(e,t){return(e=Or(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function $a(e,t,n){return Zs(t,e.child,null,n),(e=Ba(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Va(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),yi(e.return,t,n)}function qa(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Ga(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(ka(e,t,r.children,n),2&(r=aa.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Va(e,n,t);else if(19===e.tag)Va(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(F(aa,r),i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===la(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),qa(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===la(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}qa(t,!0,n,null,o);break;case"together":qa(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function za(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),uc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(wi(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Dr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ka(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!_i(e))}function Wa(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ca=!0;else{if(!(Ka(e,n)||128&t.flags))return Ca=!1,function(e,t,n){switch(t.tag){case 3:V(t,t.stateNode.containerInfo),vi(0,xi,e.memoizedState.cache),ui();break;case 27:case 5:G(t);break;case 4:V(t,t.stateNode.containerInfo);break;case 10:vi(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(ra(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Ua(e,t,n):(ra(t),null!==(e=za(e,t,n))?e.sibling:null);ra(t);break;case 19:var i=!!(128&e.flags);if((r=0!==(n&t.childLanes))||(wi(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return Ga(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),F(aa,aa.current),r)break;return null;case 22:case 23:return t.lanes=0,xa(e,t,n);case 24:vi(0,xi,e.memoizedState.cache)}return za(e,t,n)}(e,t,n);Ca=!!(131072&e.flags)}else Ca=!1,ni&&1048576&t.flags&&Xr(t,qr,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,o=i._init;if(i=o(i._payload),t.type=i,"function"!=typeof i){if(null!=i){if((o=i.$$typeof)===b){t.tag=11,t=Ta(null,t,i,e,n);break e}if(o===S){t.tag=14,t=Ra(null,t,i,e,n);break e}}throw t=x(i)||i,Error(r(306,t,""))}Ar(i)?(e=pa(i,e),t.tag=1,t=Aa(null,t,i,e,n)):(t.tag=0,t=Ma(null,t,i,e,n))}return t;case 0:return Ma(e,t,t.type,t.pendingProps,n);case 1:return Aa(e,t,i=t.type,o=pa(i,t.pendingProps),n);case 3:e:{if(V(t,t.stateNode.containerInfo),null===e)throw Error(r(387));i=t.pendingProps;var s=t.memoizedState;o=s.element,eo(e,t),ao(t,i,null,n);var a=t.memoizedState;if(i=a.cache,vi(0,xi,i),i!==s.cache&&bi(t,[xi],n,!0),so(),i=a.element,s.isDehydrated){if(s={element:i,isDehydrated:!1,cache:a.cache},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Da(e,t,i,n);break e}if(i!==o){hi(o=_r(Error(r(424)),t)),t=Da(e,t,i,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ti=fd(e.firstChild),ei=t,ni=!0,ri=null,ii=!0,n=ea(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ui(),i===o){t=za(e,t,n);break e}ka(e,t,i,n)}t=t.child}return t;case 26:return La(e,t),null===e?(n=kd(t.type,null,t.pendingProps,null))?t.memoizedState=n:ni||(n=t.type,e=t.pendingProps,(i=ed(H.current).createElement(n))[xe]=t,i[Pe]=e,Xu(i,n,e),$e(i),t.stateNode=i):t.memoizedState=kd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return G(t),null===e&&ni&&(i=t.stateNode=gd(t.type,t.pendingProps,H.current),ei=t,ii=!0,o=ti,ud(t.type)?(md=o,ti=fd(i.firstChild)):ti=o),ka(e,t,t.pendingProps.children,n),La(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&ni&&((o=i=ti)&&(i=function(e,t,n,r){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[Ne])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var o=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===o)return e}if(null===(e=fd(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,ii),null!==i?(t.stateNode=i,ei=t,ti=fd(i.firstChild),ii=!1,o=!0):o=!1),o||si(t)),G(t),o=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,i=s.children,rd(o,s)?i=null:null!==a&&rd(o,a)&&(t.flags|=32),null!==t.memoizedState&&(o=xo(e,t,Mo,null,null,n),Gd._currentValue=o),La(e,t),ka(e,t,i,n),t.child;case 6:return null===e&&ni&&((e=n=ti)&&(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;)if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n||null===(e=fd(e.nextSibling)))return null;return e}(n,t.pendingProps,ii),null!==n?(t.stateNode=n,ei=t,ti=null,e=!0):e=!1),e||si(t)),null;case 13:return Ua(e,t,n);case 4:return V(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Zs(t,null,i,n):ka(e,t,i,n),t.child;case 11:return Ta(e,t,t.type,t.pendingProps,n);case 7:return ka(e,t,t.pendingProps,n),t.child;case 8:case 12:return ka(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,vi(0,t.type,i.value),ka(e,t,i.children,n),t.child;case 9:return o=t.type._context,i=t.pendingProps.children,Si(t),i=i(o=Ei(o)),t.flags|=1,ka(e,t,i,n),t.child;case 14:return Ra(e,t,t.type,t.pendingProps,n);case 15:return Ia(e,t,t.type,t.pendingProps,n);case 19:return Ga(e,t,n);case 31:return i=t.pendingProps,n=t.mode,i={mode:i.mode,children:i.children},null===e?((n=Ha(i,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Dr(e.child,i)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return xa(e,t,n);case 24:return Si(t),i=Ei(xi),null===e?(null===(o=Ui())&&(o=ec,s=Pi(),o.pooledCache=s,s.refCount++,null!==s&&(o.pooledCacheLanes|=n),o=s),t.memoizedState={parent:i,cache:o},Zi(t),vi(0,xi,o)):(0!==(e.lanes&n)&&(eo(e,t),ao(t,null,null,n),so()),o=e.memoizedState,s=t.memoizedState,o.parent!==i?(o={parent:i,cache:i},t.memoizedState=o,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=o),vi(0,xi,i)):(i=s.cache,vi(0,xi,i),i!==o.cache&&bi(t,[xi],n,!0))),ka(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function Ja(e){e.flags|=4}function Ya(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!Fd(t)){if(null!==(t=ta.current)&&((4194048&nc)===nc?null!==na:(62914560&nc)!==nc&&!(536870912&nc)||t!==na))throw Ji=Gi,Vi;e.flags|=8192}}function Xa(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?we():536870912,e.lanes|=t,fc|=t)}function Qa(e,t){if(!ni)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Za(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function el(e,t,n){var i=t.pendingProps;switch(Zr(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Za(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),gi(xi),q(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(null===e||null===e.child)&&(ci(t)?Ja(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,di())),Za(t),null;case 26:return n=t.memoizedState,null===e?(Ja(t),null!==n?(Za(t),Ya(t,n)):(Za(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Ja(t),Za(t),Ya(t,n)):(Za(t),t.flags&=-16777217):(e.memoizedProps!==i&&Ja(t),Za(t),t.flags&=-16777217),null;case 27:z(t),n=H.current;var o=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Ja(t);else{if(!i){if(null===t.stateNode)throw Error(r(166));return Za(t),null}e=U.current,ci(t)?ai(t):(e=gd(o,i,n),t.stateNode=e,Ja(t))}return Za(t),null;case 5:if(z(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Ja(t);else{if(!i){if(null===t.stateNode)throw Error(r(166));return Za(t),null}if(e=U.current,ci(t))ai(t);else{switch(o=ed(H.current),e){case 1:e=o.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=o.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=o.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=o.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=o.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"==typeof i.is?o.createElement("select",{is:i.is}):o.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e="string"==typeof i.is?o.createElement(n,{is:i.is}):o.createElement(n)}}e[xe]=t,e[Pe]=i;e:for(o=t.child;null!==o;){if(5===o.tag||6===o.tag)e.appendChild(o.stateNode);else if(4!==o.tag&&27!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break e;for(;null===o.sibling;){if(null===o.return||o.return===t)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}t.stateNode=e;e:switch(Xu(e,n,i),n){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Ja(t)}}return Za(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&Ja(t);else{if("string"!=typeof i&&null===t.stateNode)throw Error(r(166));if(e=H.current,ci(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(o=ei))switch(o.tag){case 27:case 5:i=o.memoizedProps}e[xe]=t,(e=!!(e.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||Ku(e.nodeValue,n)))||si(t)}else(e=ed(e).createTextNode(i))[xe]=t,t.stateNode=e}return Za(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(o=ci(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(r(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(r(317));o[xe]=t}else ui(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Za(t),o=!1}else o=di(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=o),o=!0;if(!o)return 256&t.flags?(sa(t),t):(sa(t),null)}if(sa(t),128&t.flags)return t.lanes=n,t;if(n=null!==i,e=null!==e&&null!==e.memoizedState,n){o=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(o=i.alternate.memoizedState.cachePool.pool);var s=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(s=i.memoizedState.cachePool.pool),s!==o&&(i.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),Xa(t,t.updateQueue),Za(t),null;case 4:return q(),null===e&&ju(t.stateNode.containerInfo),Za(t),null;case 10:return gi(t.type),Za(t),null;case 19:if(j(aa),null===(o=t.memoizedState))return Za(t),null;if(i=!!(128&t.flags),null===(s=o.rendering))if(i)Qa(o,!1);else{if(0!==cc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(s=la(e))){for(t.flags|=128,Qa(o,!1),e=s.updateQueue,t.updateQueue=e,Xa(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Nr(n,e),n=n.sibling;return F(aa,1&aa.current|2),t.child}e=e.sibling}null!==o.tail&&Q()>bc&&(t.flags|=128,i=!0,Qa(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=la(s))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,Xa(t,e),Qa(o,!0),null===o.tail&&"hidden"===o.tailMode&&!s.alternate&&!ni)return Za(t),null}else 2*Q()-o.renderingStartTime>bc&&536870912!==n&&(t.flags|=128,i=!0,Qa(o,!1),t.lanes=4194304);o.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=o.last)?e.sibling=s:t.child=s,o.last=s)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Q(),t.sibling=null,e=aa.current,F(aa,i?1&e|2:1&e),t):(Za(t),null);case 22:case 23:return sa(t),mo(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?!!(536870912&n)&&!(128&t.flags)&&(Za(t),6&t.subtreeFlags&&(t.flags|=8192)):Za(t),null!==(n=t.updateQueue)&&Xa(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&j(Fi),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),gi(xi),Za(t),null;case 25:case 30:return null}throw Error(r(156,t.tag))}function tl(e,t){switch(Zr(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return gi(xi),q(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return z(t),null;case 13:if(sa(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));ui()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return j(aa),null;case 4:return q(),null;case 10:return gi(t.type),null;case 22:case 23:return sa(t),mo(),null!==e&&j(Fi),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return gi(xi),null;default:return null}}function nl(e,t){switch(Zr(t),t.tag){case 3:gi(xi),q();break;case 26:case 27:case 5:z(t);break;case 4:q();break;case 13:sa(t);break;case 19:j(aa);break;case 10:gi(t.type);break;case 22:case 23:sa(t),mo(),null!==e&&j(Fi);break;case 24:gi(xi)}}function rl(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var o=n.create,s=n.inst;r=o(),s.destroy=r}n=n.next}while(n!==i)}}catch(e){au(t,t.return,e)}}function il(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var o=i.next;r=o;do{if((r.tag&e)===e){var s=r.inst,a=s.destroy;if(void 0!==a){s.destroy=void 0,i=t;var l=n,c=a;try{c()}catch(e){au(i,l,e)}}}r=r.next}while(r!==o)}}catch(e){au(t,t.return,e)}}function ol(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{co(t,n)}catch(t){au(e,e.return,t)}}}function sl(e,t,n){n.props=pa(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(n){au(e,t,n)}}function al(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"==typeof n?e.refCleanup=n(r):n.current=r}}catch(n){au(e,t,n)}}function ll(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"==typeof r)try{r()}catch(n){au(e,t,n)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(n){au(e,t,n)}else n.current=null}function cl(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(t){au(e,e.return,t)}}function ul(e,t,n){try{var i=e.stateNode;(function(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,s=null,a=null,l=null,c=null,u=null,d=null;for(f in n){var h=n[f];if(n.hasOwnProperty(f)&&null!=h)switch(f){case"checked":case"value":break;case"defaultValue":c=h;default:i.hasOwnProperty(f)||Ju(e,t,f,null,i,h)}}for(var p in i){var f=i[p];if(h=n[p],i.hasOwnProperty(p)&&(null!=f||null!=h))switch(p){case"type":s=f;break;case"name":o=f;break;case"checked":u=f;break;case"defaultChecked":d=f;break;case"value":a=f;break;case"defaultValue":l=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(r(137,t));break;default:f!==h&&Ju(e,t,p,f,i,h)}}return void pt(e,a,l,c,u,d,s,o);case"select":for(s in f=a=l=p=null,n)if(c=n[s],n.hasOwnProperty(s)&&null!=c)switch(s){case"value":break;case"multiple":f=c;default:i.hasOwnProperty(s)||Ju(e,t,s,null,i,c)}for(o in i)if(s=i[o],c=n[o],i.hasOwnProperty(o)&&(null!=s||null!=c))switch(o){case"value":p=s;break;case"defaultValue":l=s;break;case"multiple":a=s;default:s!==c&&Ju(e,t,o,s,i,c)}return t=l,n=a,i=f,void(null!=p?vt(e,!!n,p,!1):!!i!=!!n&&(null!=t?vt(e,!!n,t,!0):vt(e,!!n,n?[]:"",!1)));case"textarea":for(l in f=p=null,n)if(o=n[l],n.hasOwnProperty(l)&&null!=o&&!i.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Ju(e,t,l,null,i,o)}for(a in i)if(o=i[a],s=n[a],i.hasOwnProperty(a)&&(null!=o||null!=s))switch(a){case"value":p=o;break;case"defaultValue":f=o;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(r(91));break;default:o!==s&&Ju(e,t,a,o,i,s)}return void gt(e,p,f);case"option":for(var m in n)if(p=n[m],n.hasOwnProperty(m)&&null!=p&&!i.hasOwnProperty(m))if("selected"===m)e.selected=!1;else Ju(e,t,m,null,i,p);for(c in i)if(p=i[c],f=n[c],i.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f))if("selected"===c)e.selected=p&&"function"!=typeof p&&"symbol"!=typeof p;else Ju(e,t,c,p,i,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var v in n)p=n[v],n.hasOwnProperty(v)&&null!=p&&!i.hasOwnProperty(v)&&Ju(e,t,v,null,i,p);for(u in i)if(p=i[u],f=n[u],i.hasOwnProperty(u)&&p!==f&&(null!=p||null!=f))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(r(137,t));break;default:Ju(e,t,u,p,i,f)}return;default:if(Et(t)){for(var g in n)p=n[g],n.hasOwnProperty(g)&&void 0!==p&&!i.hasOwnProperty(g)&&Yu(e,t,g,void 0,i,p);for(d in i)p=i[d],f=n[d],!i.hasOwnProperty(d)||p===f||void 0===p&&void 0===f||Yu(e,t,d,p,i,f);return}}for(var y in n)p=n[y],n.hasOwnProperty(y)&&null!=p&&!i.hasOwnProperty(y)&&Ju(e,t,y,null,i,p);for(h in i)p=i[h],f=n[h],!i.hasOwnProperty(h)||p===f||null==p&&null==f||Ju(e,t,h,p,i,f)})(i,e.type,n,t),i[Pe]=t}catch(t){au(e,e.return,t)}}function dl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&ud(e.type)||4===e.tag}function hl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||dl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&ud(e.type)||2&e.flags||null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function pl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Wu));else if(4!==r&&(27===r&&ud(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(pl(e,t,n),e=e.sibling;null!==e;)pl(e,t,n),e=e.sibling}function fl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&ud(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(fl(e,t,n),e=e.sibling;null!==e;)fl(e,t,n),e=e.sibling}function ml(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);Xu(t,r,n),t[xe]=e,t[Pe]=n}catch(t){au(e,e.return,t)}}var vl=!1,gl=!1,yl=!1,bl="function"==typeof WeakSet?WeakSet:Set,wl=null;function _l(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Al(e,n),4&r&&rl(5,n);break;case 1:if(Al(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(e){au(n,n.return,e)}else{var i=pa(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(e){au(n,n.return,e)}}64&r&&ol(n),512&r&&al(n,n.return);break;case 3:if(Al(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{co(e,t)}catch(e){au(n,n.return,e)}}break;case 27:null===t&&4&r&&ml(n);case 26:case 5:Al(e,n),null===t&&4&r&&cl(n),512&r&&al(n,n.return);break;case 12:Al(e,n);break;case 13:Al(e,n),4&r&&Rl(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=du.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||vl)){t=null!==t&&null!==t.memoizedState||gl,i=vl;var o=gl;vl=r,(gl=t)&&!o?Nl(e,n,!!(8772&n.subtreeFlags)):Al(e,n),vl=i,gl=o}break;case 30:break;default:Al(e,n)}}function Sl(e){var t=e.alternate;null!==t&&(e.alternate=null,Sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&je(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var El=null,Cl=!1;function kl(e,t,n){for(n=n.child;null!==n;)Tl(e,t,n),n=n.sibling}function Tl(e,t,n){if(le&&"function"==typeof le.onCommitFiberUnmount)try{le.onCommitFiberUnmount(ae,n)}catch{}switch(n.tag){case 26:gl||ll(n,t),kl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:gl||ll(n,t);var r=El,i=Cl;ud(n.type)&&(El=n.stateNode,Cl=!1),kl(e,t,n),yd(n.stateNode),El=r,Cl=i;break;case 5:gl||ll(n,t);case 6:if(r=El,i=Cl,El=null,kl(e,t,n),Cl=i,null!==(El=r))if(Cl)try{(9===El.nodeType?El.body:"HTML"===El.nodeName?El.ownerDocument.body:El).removeChild(n.stateNode)}catch(e){au(n,t,e)}else try{El.removeChild(n.stateNode)}catch(e){au(n,t,e)}break;case 18:null!==El&&(Cl?(dd(9===(e=El).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Ch(e)):dd(El,n.stateNode));break;case 4:r=El,i=Cl,El=n.stateNode.containerInfo,Cl=!0,kl(e,t,n),El=r,Cl=i;break;case 0:case 11:case 14:case 15:gl||il(2,n,t),gl||il(4,n,t),kl(e,t,n);break;case 1:gl||(ll(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&sl(n,t,r)),kl(e,t,n);break;case 21:kl(e,t,n);break;case 22:gl=(r=gl)||null!==n.memoizedState,kl(e,t,n),gl=r;break;default:kl(e,t,n)}}function Rl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Ch(e)}catch(e){au(t,t.return,e)}}function Il(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new bl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new bl),t;default:throw Error(r(435,e.tag))}}(e);t.forEach(function(t){var r=hu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function xl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var o=n[i],s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 27:if(ud(l.type)){El=l.stateNode,Cl=!1;break e}break;case 5:El=l.stateNode,Cl=!1;break e;case 3:case 4:El=l.stateNode.containerInfo,Cl=!0;break e}l=l.return}if(null===El)throw Error(r(160));Tl(s,a,o),El=null,Cl=!1,null!==(s=o.alternate)&&(s.return=null),o.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Ll(t,e),t=t.sibling}var Pl=null;function Ll(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:xl(t,e),Ml(e),4&i&&(il(3,e,e.return),rl(3,e),il(5,e,e.return));break;case 1:xl(t,e),Ml(e),512&i&&(gl||null===n||ll(n,n.return)),64&i&&vl&&(null!==(e=e.updateQueue)&&(null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i))));break;case 26:var o=Pl;if(xl(t,e),Ml(e),512&i&&(gl||null===n||ll(n,n.return)),4&i){var s=null!==n?n.memoizedState:null;if(i=e.memoizedState,null===n)if(null===i)if(null===e.stateNode){e:{i=e.type,n=e.memoizedProps,o=o.ownerDocument||o;t:switch(i){case"title":(!(s=o.getElementsByTagName("title")[0])||s[Ne]||s[xe]||"http://www.w3.org/2000/svg"===s.namespaceURI||s.hasAttribute("itemprop"))&&(s=o.createElement(i),o.head.insertBefore(s,o.querySelector("head > title"))),Xu(s,i,n),s[xe]=e,$e(s),i=s;break e;case"link":var a=Nd("link","href",o).get(i+(n.href||""));if(a)for(var l=0;l<a.length;l++)if((s=a[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&s.getAttribute("rel")===(null==n.rel?null:n.rel)&&s.getAttribute("title")===(null==n.title?null:n.title)&&s.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){a.splice(l,1);break t}Xu(s=o.createElement(i),i,n),o.head.appendChild(s);break;case"meta":if(a=Nd("meta","content",o).get(i+(n.content||"")))for(l=0;l<a.length;l++)if((s=a[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&s.getAttribute("name")===(null==n.name?null:n.name)&&s.getAttribute("property")===(null==n.property?null:n.property)&&s.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&s.getAttribute("charset")===(null==n.charSet?null:n.charSet)){a.splice(l,1);break t}Xu(s=o.createElement(i),i,n),o.head.appendChild(s);break;default:throw Error(r(468,i))}s[xe]=e,$e(s),i=s}e.stateNode=i}else jd(o,e.type,e.stateNode);else e.stateNode=Ld(o,i,e.memoizedProps);else s!==i?(null===s?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):s.count--,null===i?jd(o,e.type,e.stateNode):Ld(o,i,e.memoizedProps)):null===i&&null!==e.stateNode&&ul(e,e.memoizedProps,n.memoizedProps)}break;case 27:xl(t,e),Ml(e),512&i&&(gl||null===n||ll(n,n.return)),null!==n&&4&i&&ul(e,e.memoizedProps,n.memoizedProps);break;case 5:if(xl(t,e),Ml(e),512&i&&(gl||null===n||ll(n,n.return)),32&e.flags){o=e.stateNode;try{bt(o,"")}catch(t){au(e,e.return,t)}}4&i&&null!=e.stateNode&&ul(e,o=e.memoizedProps,null!==n?n.memoizedProps:o),1024&i&&(yl=!0);break;case 6:if(xl(t,e),Ml(e),4&i){if(null===e.stateNode)throw Error(r(162));i=e.memoizedProps,n=e.stateNode;try{n.nodeValue=i}catch(t){au(e,e.return,t)}}break;case 3:if(Dd=null,o=Pl,Pl=_d(t.containerInfo),xl(t,e),Pl=o,Ml(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Ch(t.containerInfo)}catch(t){au(e,e.return,t)}yl&&(yl=!1,Ol(e));break;case 4:i=Pl,Pl=_d(e.stateNode.containerInfo),xl(t,e),Ml(e),Pl=i;break;case 12:default:xl(t,e),Ml(e);break;case 13:xl(t,e),Ml(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(yc=Q()),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Il(e,i)));break;case 22:o=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=vl,d=gl;if(vl=u||o,gl=d||c,xl(t,e),gl=d,vl=u,Ml(e),8192&i)e:for(t=e.stateNode,t._visibility=o?-2&t._visibility:1|t._visibility,o&&(null===n||c||vl||gl||Dl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(s=c.stateNode,o)"function"==typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var h=c.memoizedProps.style,p=null!=h&&h.hasOwnProperty("display")?h.display:null;l.style.display=null==p||"boolean"==typeof p?"":(""+p).trim()}}catch(e){au(c,c.return,e)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=o?"":c.memoizedProps}catch(e){au(c,c.return,e)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&(null!==(i=e.updateQueue)&&(null!==(n=i.retryQueue)&&(i.retryQueue=null,Il(e,n))));break;case 19:xl(t,e),Ml(e),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Il(e,i)));case 30:case 21:}}function Ml(e){var t=e.flags;if(2&t){try{for(var n,i=e.return;null!==i;){if(dl(i)){n=i;break}i=i.return}if(null==n)throw Error(r(160));switch(n.tag){case 27:var o=n.stateNode;fl(e,hl(e),o);break;case 5:var s=n.stateNode;32&n.flags&&(bt(s,""),n.flags&=-33),fl(e,hl(e),s);break;case 3:case 4:var a=n.stateNode.containerInfo;pl(e,hl(e),a);break;default:throw Error(r(161))}}catch(t){au(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ol(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Ol(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Al(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)_l(e,t.alternate,t),t=t.sibling}function Dl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:il(4,t,t.return),Dl(t);break;case 1:ll(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&sl(t,t.return,n),Dl(t);break;case 27:yd(t.stateNode);case 26:case 5:ll(t,t.return),Dl(t);break;case 22:null===t.memoizedState&&Dl(t);break;default:Dl(t)}e=e.sibling}}function Nl(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,o=t,s=o.flags;switch(o.tag){case 0:case 11:case 15:Nl(i,o,n),rl(4,o);break;case 1:if(Nl(i,o,n),"function"==typeof(i=(r=o).stateNode).componentDidMount)try{i.componentDidMount()}catch(e){au(r,r.return,e)}if(null!==(i=(r=o).updateQueue)){var a=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)lo(l[i],a)}catch(e){au(r,r.return,e)}}n&&64&s&&ol(o),al(o,o.return);break;case 27:ml(o);case 26:case 5:Nl(i,o,n),n&&null===r&&4&s&&cl(o),al(o,o.return);break;case 12:Nl(i,o,n);break;case 13:Nl(i,o,n),n&&4&s&&Rl(i,o);break;case 22:null===o.memoizedState&&Nl(i,o,n),al(o,o.return);break;case 30:break;default:Nl(i,o,n)}t=t.sibling}}function jl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Li(n))}function Fl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Li(e))}function Ul(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Bl(e,t,n,r),t=t.sibling}function Bl(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:Ul(e,t,n,r),2048&i&&rl(9,t);break;case 1:case 13:default:Ul(e,t,n,r);break;case 3:Ul(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Li(e)));break;case 12:if(2048&i){Ul(e,t,n,r),e=t.stateNode;try{var o=t.memoizedProps,s=o.id,a=o.onPostCommit;"function"==typeof a&&a(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(e){au(t,t.return,e)}}else Ul(e,t,n,r);break;case 23:break;case 22:o=t.stateNode,s=t.alternate,null!==t.memoizedState?2&o._visibility?Ul(e,t,n,r):$l(e,t):2&o._visibility?Ul(e,t,n,r):(o._visibility|=2,Hl(e,t,n,r,!!(10256&t.subtreeFlags))),2048&i&&jl(s,t);break;case 24:Ul(e,t,n,r),2048&i&&Fl(t.alternate,t)}}function Hl(e,t,n,r,i){for(i=i&&!!(10256&t.subtreeFlags),t=t.child;null!==t;){var o=e,s=t,a=n,l=r,c=s.flags;switch(s.tag){case 0:case 11:case 15:Hl(o,s,a,l,i),rl(8,s);break;case 23:break;case 22:var u=s.stateNode;null!==s.memoizedState?2&u._visibility?Hl(o,s,a,l,i):$l(o,s):(u._visibility|=2,Hl(o,s,a,l,i)),i&&2048&c&&jl(s.alternate,s);break;case 24:Hl(o,s,a,l,i),i&&2048&c&&Fl(s.alternate,s);break;default:Hl(o,s,a,l,i)}t=t.sibling}}function $l(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:$l(n,r),2048&i&&jl(r.alternate,r);break;case 24:$l(n,r),2048&i&&Fl(r.alternate,r);break;default:$l(n,r)}t=t.sibling}}var Vl=8192;function ql(e){if(e.subtreeFlags&Vl)for(e=e.child;null!==e;)Gl(e),e=e.sibling}function Gl(e){switch(e.tag){case 26:ql(e),e.flags&Vl&&null!==e.memoizedState&&function(e,t,n){if(null===Ud)throw Error(r(475));var i=Ud;if(!("stylesheet"!==t.type||"string"==typeof n.media&&!1===matchMedia(n.media).matches||4&t.state.loading)){if(null===t.instance){var o=Td(n.href),s=e.querySelector(Rd(o));if(s)return null!==(e=s._p)&&"object"==typeof e&&"function"==typeof e.then&&(i.count++,i=Hd.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=s,void $e(s);s=e.ownerDocument||e,n=Id(n),(o=bd.get(o))&&Od(n,o),$e(s=s.createElement("link"));var a=s;a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),Xu(s,"link",n),t.instance=s}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&!(3&t.state.loading)&&(i.count++,t=Hd.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}(Pl,e.memoizedState,e.memoizedProps);break;case 5:default:ql(e);break;case 3:case 4:var t=Pl;Pl=_d(e.stateNode.containerInfo),ql(e),Pl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Vl,Vl=16777216,ql(e),Vl=t):ql(e))}}function zl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Kl(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];wl=r,Yl(r,e)}zl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Wl(e),e=e.sibling}function Wl(e){switch(e.tag){case 0:case 11:case 15:Kl(e),2048&e.flags&&il(9,e,e.return);break;case 3:case 12:default:Kl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Jl(e)):Kl(e)}}function Jl(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];wl=r,Yl(r,e)}zl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:il(8,t,t.return),Jl(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Jl(t));break;default:Jl(t)}e=e.sibling}}function Yl(e,t){for(;null!==wl;){var n=wl;switch(n.tag){case 0:case 11:case 15:il(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Li(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,wl=r;else e:for(n=e;null!==wl;){var i=(r=wl).sibling,o=r.return;if(Sl(r),r===n){wl=null;break e}if(null!==i){i.return=o,wl=i;break e}wl=o}}}var Xl={getCacheForType:function(e){var t=Ei(xi),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},Ql="function"==typeof WeakMap?WeakMap:Map,Zl=0,ec=null,tc=null,nc=0,rc=0,ic=null,oc=!1,sc=!1,ac=!1,lc=0,cc=0,uc=0,dc=0,hc=0,pc=0,fc=0,mc=null,vc=null,gc=!1,yc=0,bc=1/0,wc=null,_c=null,Sc=0,Ec=null,Cc=null,kc=0,Tc=0,Rc=null,Ic=null,xc=0,Pc=null;function Lc(){if(2&Zl&&0!==nc)return nc&-nc;if(null!==L.T){return 0!==Ai?Ai:Tu()}return Re()}function Mc(){0===pc&&(pc=536870912&nc&&!ni?536870912:be());var e=ta.current;return null!==e&&(e.flags|=32),pc}function Oc(e,t,n){(e===ec&&(2===rc||9===rc)||null!==e.cancelPendingCommit)&&(Bc(e,0),jc(e,nc,pc,!1)),Se(e,n),(!(2&Zl)||e!==ec)&&(e===ec&&(!(2&Zl)&&(dc|=n),4===cc&&jc(e,nc,pc,!1)),bu(e))}function Ac(e,t,n){if(6&Zl)throw Error(r(327));for(var i=!n&&!(124&t)&&0===(t&e.expiredLanes)||ge(e,t),o=i?function(e,t){var n=Zl;Zl|=2;var i=$c(),o=Vc();ec!==e||nc!==t?(wc=null,bc=Q()+500,Bc(e,t)):sc=ge(e,t);e:for(;;)try{if(0!==rc&&null!==tc){t=tc;var s=ic;t:switch(rc){case 1:rc=0,ic=null,Yc(e,t,s,1);break;case 2:case 9:if(zi(s)){rc=0,ic=null,Jc(t);break}t=function(){2!==rc&&9!==rc||ec!==e||(rc=7),bu(e)},s.then(t,t);break e;case 3:rc=7;break e;case 4:rc=5;break e;case 7:zi(s)?(rc=0,ic=null,Jc(t)):(rc=0,ic=null,Yc(e,t,s,7));break;case 5:var a=null;switch(tc.tag){case 26:a=tc.memoizedState;case 5:case 27:var l=tc;if(!a||Fd(a)){rc=0,ic=null;var c=l.sibling;if(null!==c)tc=c;else{var u=l.return;null!==u?(tc=u,Xc(u)):tc=null}break t}}rc=0,ic=null,Yc(e,t,s,5);break;case 6:rc=0,ic=null,Yc(e,t,s,6);break;case 8:Uc(),cc=6;break e;default:throw Error(r(462))}}Kc();break}catch(t){Hc(e,t)}return mi=fi=null,L.H=i,L.A=o,Zl=n,null!==tc?0:(ec=null,nc=0,kr(),cc)}(e,t):Gc(e,t,!0),s=i;;){if(0===o){sc&&!i&&jc(e,t,0,!1);break}if(n=e.current.alternate,!s||Nc(n)){if(2===o){if(s=t,e.errorRecoveryDisabledLanes&s)var a=0;else a=0!==(a=-536870913&e.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){t=a;e:{var l=e;o=mc;var c=l.current.memoizedState.isDehydrated;if(c&&(Bc(l,a).flags|=256),2!==(a=Gc(l,a,!1))){if(ac&&!c){l.errorRecoveryDisabledLanes|=s,dc|=s,o=4;break e}s=vc,vc=o,null!==s&&(null===vc?vc=s:vc.push.apply(vc,s))}o=a}if(s=!1,2!==o)continue}}if(1===o){Bc(e,0),jc(e,t,0,!0);break}e:{switch(i=e,s=o){case 0:case 1:throw Error(r(345));case 4:if((4194048&t)!==t)break;case 6:jc(i,t,pc,!oc);break e;case 2:vc=null;break;case 3:case 5:break;default:throw Error(r(329))}if((62914560&t)===t&&10<(o=yc+300-Q())){if(jc(i,t,pc,!oc),0!==ve(i,0,!0))break e;i.timeoutHandle=od(Dc.bind(null,i,n,vc,wc,gc,t,pc,dc,fc,oc,s,2,-0,0),o)}else Dc(i,n,vc,wc,gc,t,pc,dc,fc,oc,s,0,-0,0)}break}o=Gc(e,t,!1),s=!1}bu(e)}function Dc(e,t,n,i,o,s,a,l,c,u,d,h,p,f){if(e.timeoutHandle=-1,(8192&(h=t.subtreeFlags)||!(16785408&~h))&&(Ud={stylesheets:null,count:0,unsuspend:Bd},Gl(t),h=function(){if(null===Ud)throw Error(r(475));var e=Ud;return e.stylesheets&&0===e.count&&Vd(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Vd(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}(),null!==h))return e.cancelPendingCommit=h(Zc.bind(null,e,t,s,n,i,o,a,l,c,d,1,p,f)),void jc(e,s,a,!u);Zc(e,t,s,n,i,o,a,l,c)}function Nc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!zn(o(),i))return!1}catch{return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function jc(e,t,n,r){t&=~hc,t&=~dc,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var o=31-ue(i),s=1<<o;r[o]=-1,i&=~s}0!==n&&Ee(e,n,t)}function Fc(){return!!(6&Zl)||(wu(0),!1)}function Uc(){if(null!==tc){if(0===rc)var e=tc.return;else mi=fi=null,Do(e=tc),zs=null,Ks=0,e=tc;for(;null!==e;)nl(e.alternate,e),e=e.return;tc=null}}function Bc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,sd(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Uc(),ec=e,tc=n=Dr(e.current,null),nc=t,rc=0,ic=null,oc=!1,sc=ge(e,t),ac=!1,fc=pc=hc=dc=uc=cc=0,vc=mc=null,gc=!1,8&t&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-ue(r),o=1<<i;t|=e[i],r&=~o}return lc=t,kr(),n}function Hc(e,t){go=null,L.H=$s,t===$i||t===qi?(t=Yi(),rc=3):t===Vi?(t=Yi(),rc=4):rc=t===Ea?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,ic=t,null===tc&&(cc=1,ya(e,_r(t,e.current)))}function $c(){var e=L.H;return L.H=$s,null===e?$s:e}function Vc(){var e=L.A;return L.A=Xl,e}function qc(){cc=4,oc||(4194048&nc)!==nc&&null!==ta.current||(sc=!0),!(134217727&uc)&&!(134217727&dc)||null===ec||jc(ec,nc,pc,!1)}function Gc(e,t,n){var r=Zl;Zl|=2;var i=$c(),o=Vc();(ec!==e||nc!==t)&&(wc=null,Bc(e,t)),t=!1;var s=cc;e:for(;;)try{if(0!==rc&&null!==tc){var a=tc,l=ic;switch(rc){case 8:Uc(),s=6;break e;case 3:case 2:case 9:case 6:null===ta.current&&(t=!0);var c=rc;if(rc=0,ic=null,Yc(e,a,l,c),n&&sc){s=0;break e}break;default:c=rc,rc=0,ic=null,Yc(e,a,l,c)}}zc(),s=cc;break}catch(t){Hc(e,t)}return t&&e.shellSuspendCounter++,mi=fi=null,Zl=r,L.H=i,L.A=o,null===tc&&(ec=null,nc=0,kr()),s}function zc(){for(;null!==tc;)Wc(tc)}function Kc(){for(;null!==tc&&!Y();)Wc(tc)}function Wc(e){var t=Wa(e.alternate,e,lc);e.memoizedProps=e.pendingProps,null===t?Xc(e):tc=t}function Jc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Oa(n,t,t.pendingProps,t.type,void 0,nc);break;case 11:t=Oa(n,t,t.pendingProps,t.type.render,t.ref,nc);break;case 5:Do(t);default:nl(n,t),t=Wa(n,t=tc=Nr(t,lc),lc)}e.memoizedProps=e.pendingProps,null===t?Xc(e):tc=t}function Yc(e,t,n,i){mi=fi=null,Do(t),zs=null,Ks=0;var o=t.return;try{if(function(e,t,n,i,o){if(n.flags|=32768,null!==i&&"object"==typeof i&&"function"==typeof i.then){if(null!==(t=n.alternate)&&wi(t,n,o,!0),null!==(n=ta.current)){switch(n.tag){case 13:return null===na?qc():null===n.alternate&&0===cc&&(cc=3),n.flags&=-257,n.flags|=65536,n.lanes=o,i===Gi?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),lu(e,i,o)),!1;case 22:return n.flags|=65536,i===Gi?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),lu(e,i,o)),!1}throw Error(r(435,n.tag))}return lu(e,i,o),qc(),!1}if(ni)return null!==(t=ta.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=o,i!==oi&&hi(_r(e=Error(r(422),{cause:i}),n))):(i!==oi&&hi(_r(t=Error(r(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,o&=-o,e.lanes|=o,i=_r(i,n),io(e,o=wa(e.stateNode,i,o)),4!==cc&&(cc=2)),!1;var s=Error(r(520),{cause:i});if(s=_r(s,n),null===mc?mc=[s]:mc.push(s),4!==cc&&(cc=2),null===t)return!0;i=_r(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=o&-o,n.lanes|=e,io(n,e=wa(n.stateNode,i,e)),!1;case 1:if(t=n.type,s=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===s||"function"!=typeof s.componentDidCatch||null!==_c&&_c.has(s))))return n.flags|=65536,o&=-o,n.lanes|=o,Sa(o=_a(o),e,n,i),io(n,o),!1}n=n.return}while(null!==n);return!1}(e,o,t,n,nc))return cc=1,ya(e,_r(n,e.current)),void(tc=null)}catch(t){if(null!==o)throw tc=o,t;return cc=1,ya(e,_r(n,e.current)),void(tc=null)}32768&t.flags?(ni||1===i?e=!0:sc||536870912&nc?e=!1:(oc=e=!0,(2===i||9===i||3===i||6===i)&&(null!==(i=ta.current)&&13===i.tag&&(i.flags|=16384))),Qc(t,e)):Xc(t)}function Xc(e){var t=e;do{if(32768&t.flags)return void Qc(t,oc);e=t.return;var n=el(t.alternate,t,lc);if(null!==n)return void(tc=n);if(null!==(t=t.sibling))return void(tc=t);tc=t=e}while(null!==t);0===cc&&(cc=5)}function Qc(e,t){do{var n=tl(e.alternate,e);if(null!==n)return n.flags&=32767,void(tc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(tc=e);tc=e=n}while(null!==e);cc=6,tc=null}function Zc(e,t,n,i,o,s,a,l,c){e.cancelPendingCommit=null;do{iu()}while(0!==Sc);if(6&Zl)throw Error(r(327));if(null!==t){if(t===e.current)throw Error(r(177));if(s=t.lanes|t.childLanes,function(e,t,n,r,i,o){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var a=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var u=31-ue(n),d=1<<u;a[u]=0,l[u]=-1;var h=c[u];if(null!==h)for(c[u]=null,u=0;u<h.length;u++){var p=h[u];null!==p&&(p.lane&=-536870913)}n&=~d}0!==r&&Ee(e,r,0),0!==o&&0===i&&0!==e.tag&&(e.suspendedLanes|=o&~(s&~t))}(e,n,s|=Cr,a,l,c),e===ec&&(tc=ec=null,nc=0),Cc=t,Ec=e,kc=n,Tc=s,Rc=o,Ic=i,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,function(e,t){W(e,t)}(ne,function(){return ou(),null})):(e.callbackNode=null,e.callbackPriority=0),i=!!(13878&t.flags),13878&t.subtreeFlags||i){i=L.T,L.T=null,o=M.p,M.p=2,a=Zl,Zl|=4;try{!function(e,t){if(e=e.containerInfo,Qu=Zd,Qn(e=Xn(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var o=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==o&&3!==h.nodeType||(l=a+o),h!==s||0!==i&&3!==h.nodeType||(c=a+i),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===o&&(l=a),p===s&&++d===i&&(c=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Zu={focusedElem:e,selectionRange:n},Zd=!1,wl=t;null!==wl;)if(e=(t=wl).child,1024&t.subtreeFlags&&null!==e)e.return=t,wl=e;else for(;null!==wl;){switch(s=(t=wl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==s){e=void 0,n=t,o=s.memoizedProps,s=s.memoizedState,i=n.stateNode;try{var m=pa(n.type,o,(n.elementType,n.type));e=i.getSnapshotBeforeUpdate(m,s),i.__reactInternalSnapshotBeforeUpdate=e}catch(e){au(n,n.return,e)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))hd(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":hd(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(r(163))}if(null!==(e=t.sibling)){e.return=t.return,wl=e;break}wl=t.return}}(e,t)}finally{Zl=a,M.p=o,L.T=i}}Sc=1,eu(),tu(),nu()}}function eu(){if(1===Sc){Sc=0;var e=Ec,t=Cc,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=L.T,L.T=null;var r=M.p;M.p=2;var i=Zl;Zl|=4;try{Ll(t,e);var o=Zu,s=Xn(e.containerInfo),a=o.focusedElem,l=o.selectionRange;if(s!==a&&a&&a.ownerDocument&&Yn(a.ownerDocument.documentElement,a)){if(null!==l&&Qn(a)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in a)a.selectionStart=c,a.selectionEnd=Math.min(u,a.value.length);else{var d=a.ownerDocument||document,h=d&&d.defaultView||window;if(h.getSelection){var p=h.getSelection(),f=a.textContent.length,m=Math.min(l.start,f),v=void 0===l.end?m:Math.min(l.end,f);!p.extend&&m>v&&(s=v,v=m,m=s);var g=Jn(a,m),y=Jn(a,v);if(g&&y&&(1!==p.rangeCount||p.anchorNode!==g.node||p.anchorOffset!==g.offset||p.focusNode!==y.node||p.focusOffset!==y.offset)){var b=d.createRange();b.setStart(g.node,g.offset),p.removeAllRanges(),m>v?(p.addRange(b),p.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),p.addRange(b))}}}}for(d=[],p=a;p=p.parentNode;)1===p.nodeType&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"==typeof a.focus&&a.focus(),a=0;a<d.length;a++){var w=d[a];w.element.scrollLeft=w.left,w.element.scrollTop=w.top}}Zd=!!Qu,Zu=Qu=null}finally{Zl=i,M.p=r,L.T=n}}e.current=t,Sc=2}}function tu(){if(2===Sc){Sc=0;var e=Ec,t=Cc,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=L.T,L.T=null;var r=M.p;M.p=2;var i=Zl;Zl|=4;try{_l(e,t.alternate,t)}finally{Zl=i,M.p=r,L.T=n}}Sc=3}}function nu(){if(4===Sc||3===Sc){Sc=0,X();var e=Ec,t=Cc,n=kc,r=Ic;10256&t.subtreeFlags||10256&t.flags?Sc=5:(Sc=0,Cc=Ec=null,ru(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(_c=null),Te(n),t=t.stateNode,le&&"function"==typeof le.onCommitFiberRoot)try{le.onCommitFiberRoot(ae,t,void 0,!(128&~t.current.flags))}catch{}if(null!==r){t=L.T,i=M.p,M.p=2,L.T=null;try{for(var o=e.onRecoverableError,s=0;s<r.length;s++){var a=r[s];o(a.value,{componentStack:a.stack})}}finally{L.T=t,M.p=i}}!!(3&kc)&&iu(),bu(e),i=e.pendingLanes,4194090&n&&42&i?e===Pc?xc++:(xc=0,Pc=e):xc=0,wu(0)}}function ru(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Li(t)))}function iu(e){return eu(),tu(),nu(),ou()}function ou(){if(5!==Sc)return!1;var e=Ec,t=Tc;Tc=0;var n=Te(kc),i=L.T,o=M.p;try{M.p=32>n?32:n,L.T=null,n=Rc,Rc=null;var s=Ec,a=kc;if(Sc=0,Cc=Ec=null,kc=0,6&Zl)throw Error(r(331));var l=Zl;if(Zl|=4,Wl(s.current),Bl(s,s.current,a,n),Zl=l,wu(0,!1),le&&"function"==typeof le.onPostCommitFiberRoot)try{le.onPostCommitFiberRoot(ae,s)}catch{}return!0}finally{M.p=o,L.T=i,ru(e,t)}}function su(e,t,n){t=_r(n,t),null!==(e=no(e,t=wa(e.stateNode,t,2),2))&&(Se(e,2),bu(e))}function au(e,t,n){if(3===e.tag)su(e,e,n);else for(;null!==t;){if(3===t.tag){su(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===_c||!_c.has(r))){e=_r(n,e),null!==(r=no(t,n=_a(2),2))&&(Sa(n,r,t,e),Se(r,2),bu(r));break}}t=t.return}}function lu(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Ql;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(ac=!0,i.add(n),e=cu.bind(null,e,t,n),t.then(e,e))}function cu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,ec===e&&(nc&n)===n&&(4===cc||3===cc&&(62914560&nc)===nc&&300>Q()-yc?!(2&Zl)&&Bc(e,0):hc|=n,fc===nc&&(fc=0)),bu(e)}function uu(e,t){0===t&&(t=we()),null!==(e=Ir(e,t))&&(Se(e,t),bu(e))}function du(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),uu(e,n)}function hu(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(r(314))}null!==i&&i.delete(t),uu(e,n)}var pu=null,fu=null,mu=!1,vu=!1,gu=!1,yu=0;function bu(e){e!==fu&&null===e.next&&(null===fu?pu=fu=e:fu=fu.next=e),vu=!0,mu||(mu=!0,ld(function(){6&Zl?W(ee,_u):Su()}))}function wu(e,t){if(!gu&&vu){gu=!0;do{for(var n=!1,r=pu;null!==r;){if(0!==e){var i=r.pendingLanes;if(0===i)var o=0;else{var s=r.suspendedLanes,a=r.pingedLanes;o=(1<<31-ue(42|e)+1)-1,o=201326741&(o&=i&~(s&~a))?201326741&o|1:o?2|o:0}0!==o&&(n=!0,ku(r,o))}else o=nc,!(3&(o=ve(r,r===ec?o:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||ge(r,o)||(n=!0,ku(r,o));r=r.next}}while(n);gu=!1}}function _u(){Su()}function Su(){vu=mu=!1;var e=0;0!==yu&&(function(){var e=window.event;return e&&"popstate"===e.type?e!==id&&(id=e,!0):(id=null,!1)}()&&(e=yu),yu=0);for(var t=Q(),n=null,r=pu;null!==r;){var i=r.next,o=Eu(r,t);0===o?(r.next=null,null===n?pu=i:n.next=i,null===i&&(fu=n)):(n=r,(0!==e||!!(3&o))&&(vu=!0)),r=i}wu(e)}function Eu(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var s=31-ue(o),a=1<<s,l=i[s];-1===l?(0===(a&n)||0!==(a&r))&&(i[s]=ye(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}if(n=nc,n=ve(e,e===(t=ec)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===rc||9===rc)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&J(r),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||ge(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&J(r),Te(n)){case 2:case 8:n=te;break;case 32:default:n=ne;break;case 268435456:n=ie}return r=Cu.bind(null,e),n=W(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&J(r),e.callbackPriority=2,e.callbackNode=null,2}function Cu(e,t){if(0!==Sc&&5!==Sc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(iu()&&e.callbackNode!==n)return null;var r=nc;return 0===(r=ve(e,e===ec?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Ac(e,r,t),Eu(e,Q()),null!=e.callbackNode&&e.callbackNode===n?Cu.bind(null,e):null)}function ku(e,t){if(iu())return null;Ac(e,t,!0)}function Tu(){return 0===yu&&(yu=be()),yu}function Ru(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Tt(""+e)}function Iu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var xu=0;xu<yr.length;xu++){var Pu=yr[xu];br(Pu.toLowerCase(),"on"+(Pu[0].toUpperCase()+Pu.slice(1)))}br(ur,"onAnimationEnd"),br(dr,"onAnimationIteration"),br(hr,"onAnimationStart"),br("dblclick","onDoubleClick"),br("focusin","onFocus"),br("focusout","onBlur"),br(pr,"onTransitionRun"),br(fr,"onTransitionStart"),br(mr,"onTransitionCancel"),br(vr,"onTransitionEnd"),ze("onMouseEnter",["mouseout","mouseover"]),ze("onMouseLeave",["mouseout","mouseover"]),ze("onPointerEnter",["pointerout","pointerover"]),ze("onPointerLeave",["pointerout","pointerover"]),Ge("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ge("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ge("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ge("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ge("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ge("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Lu));function Ou(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;o=a,i.currentTarget=c;try{o(i)}catch(e){fa(e)}i.currentTarget=null,o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;o=a,i.currentTarget=c;try{o(i)}catch(e){fa(e)}i.currentTarget=null,o=l}}}}function Au(e,t){var n=t[Me];void 0===n&&(n=t[Me]=new Set);var r=e+"__bubble";n.has(r)||(Fu(t,e,2,!1),n.add(r))}function Du(e,t,n){var r=0;t&&(r|=4),Fu(n,e,r,t)}var Nu="_reactListening"+Math.random().toString(36).slice(2);function ju(e){if(!e[Nu]){e[Nu]=!0,Ve.forEach(function(t){"selectionchange"!==t&&(Mu.has(t)||Du(t,!1,e),Du(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Nu]||(t[Nu]=!0,Du("selectionchange",!1,t))}}function Fu(e,t,n,r){switch(sh(t)){case 2:var i=eh;break;case 8:i=th;break;default:i=nh}n=i.bind(null,t,n,e),i=void 0,!Nt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Uu(e,t,n,r,i){var s=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var l=r.stateNode.containerInfo;if(l===i)break;if(4===a)for(a=r.return;null!==a;){var c=a.tag;if((3===c||4===c)&&a.stateNode.containerInfo===i)return;a=a.return}for(;null!==l;){if(null===(a=Fe(l)))return;if(5===(c=a.tag)||6===c||26===c||27===c){r=s=a;continue e}l=l.parentNode}}r=r.return}Ot(function(){var r=s,i=It(n),a=[];e:{var l=gr.get(e);if(void 0!==l){var c=Yt,u=e;switch(e){case"keypress":if(0===$t(n))break e;case"keydown":case"keyup":c=hn;break;case"focusin":u="focus",c=nn;break;case"focusout":u="blur",c=nn;break;case"beforeblur":case"afterblur":c=nn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=en;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=tn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=fn;break;case ur:case dr:case hr:c=rn;break;case vr:c=mn;break;case"scroll":case"scrollend":c=Qt;break;case"wheel":c=vn;break;case"copy":case"cut":case"paste":c=on;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=pn;break;case"toggle":case"beforetoggle":c=gn}var d=!!(4&t),h=!d&&("scroll"===e||"scrollend"===e),p=d?null!==l?l+"Capture":null:l;d=[];for(var f,m=r;null!==m;){var v=m;if(f=v.stateNode,5!==(v=v.tag)&&26!==v&&27!==v||null===f||null===p||null!=(v=At(m,p))&&d.push(Bu(m,v,f)),h)break;m=m.return}0<d.length&&(l=new c(l,u,null,n,i),a.push({event:l,listeners:d}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||n===Rt||!(u=n.relatedTarget||n.fromElement)||!Fe(u)&&!u[Le])&&(c||l)&&(l=i.window===i?i:(l=i.ownerDocument)?l.defaultView||l.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?Fe(u):null)&&(h=o(u),d=u.tag,u!==h||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=r),c!==u)){if(d=en,v="onMouseLeave",p="onMouseEnter",m="mouse",("pointerout"===e||"pointerover"===e)&&(d=pn,v="onPointerLeave",p="onPointerEnter",m="pointer"),h=null==c?l:Be(c),f=null==u?l:Be(u),(l=new d(v,m+"leave",c,n,i)).target=h,l.relatedTarget=f,v=null,Fe(i)===r&&((d=new d(p,m+"enter",u,n,i)).target=f,d.relatedTarget=h,v=d),h=v,c&&u)e:{for(p=u,m=0,f=d=c;f;f=$u(f))m++;for(f=0,v=p;v;v=$u(v))f++;for(;0<m-f;)d=$u(d),m--;for(;0<f-m;)p=$u(p),f--;for(;m--;){if(d===p||null!==p&&d===p.alternate)break e;d=$u(d),p=$u(p)}d=null}else d=null;null!==c&&Vu(a,l,c,d,!1),null!==u&&null!==h&&Vu(a,h,u,d,!0)}if("select"===(c=(l=r?Be(r):window).nodeName&&l.nodeName.toLowerCase())||"input"===c&&"file"===l.type)var g=Dn;else if(xn(l))if(Nn)g=Gn;else{g=Vn;var y=$n}else!(c=l.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?r&&Et(r.elementType)&&(g=Dn):g=qn;switch(g&&(g=g(e,r))?Pn(a,g,n,i):(y&&y(e,l,r),"focusout"===e&&r&&"number"===l.type&&null!=r.memoizedProps.value&&mt(l,"number",l.value)),y=r?Be(r):window,e){case"focusin":(xn(y)||"true"===y.contentEditable)&&(er=y,tr=r,nr=null);break;case"focusout":nr=tr=er=null;break;case"mousedown":rr=!0;break;case"contextmenu":case"mouseup":case"dragend":rr=!1,ir(a,n,i);break;case"selectionchange":if(Zn)break;case"keydown":case"keyup":ir(a,n,i)}var b;if(bn)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Rn?kn(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(Sn&&"ko"!==n.locale&&(Rn||"onCompositionStart"!==w?"onCompositionEnd"===w&&Rn&&(b=Ht()):(Ut="value"in(Ft=i)?Ft.value:Ft.textContent,Rn=!0)),0<(y=Hu(r,w)).length&&(w=new sn(w,e,null,n,i),a.push({event:w,listeners:y}),b?w.data=b:null!==(b=Tn(n))&&(w.data=b))),(b=_n?function(e,t){switch(e){case"compositionend":return Tn(t);case"keypress":return 32!==t.which?null:(Cn=!0,En);case"textInput":return(e=t.data)===En&&Cn?null:e;default:return null}}(e,n):function(e,t){if(Rn)return"compositionend"===e||!bn&&kn(e,t)?(e=Ht(),Bt=Ut=Ft=null,Rn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Sn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(w=Hu(r,"onBeforeInput")).length&&(y=new sn("onBeforeInput","beforeinput",null,n,i),a.push({event:y,listeners:w}),y.data=b)),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var o=Ru((i[Pe]||null).action),s=r.submitter;s&&null!==(t=(t=s[Pe]||null)?Ru(t.formAction):s.getAttribute("formAction"))&&(o=t,s=null);var a=new Yt("action","action",null,r,i);e.push({event:a,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==yu){var e=s?Iu(i,s):new FormData(i);Is(n,{pending:!0,data:e,method:i.method,action:o},null,e)}}else"function"==typeof o&&(a.preventDefault(),e=s?Iu(i,s):new FormData(i),Is(n,{pending:!0,data:e,method:i.method,action:o},o,e))},currentTarget:i}]})}}(a,e,r,n,i)}Ou(a,t)})}function Bu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hu(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===o||(null!=(i=At(e,n))&&r.unshift(Bu(e,i,o)),null!=(i=At(e,t))&&r.push(Bu(e,i,o))),3===e.tag)return r;e=e.return}return[]}function $u(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Vu(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===r)break;5!==a&&26!==a&&27!==a||null===c||(l=c,i?null!=(c=At(n,o))&&s.unshift(Bu(n,c,l)):i||null!=(c=At(n,o))&&s.push(Bu(n,c,l))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var qu=/\r\n?/g,Gu=/\u0000|\uFFFD/g;function zu(e){return("string"==typeof e?e:""+e).replace(qu,"\n").replace(Gu,"")}function Ku(e,t){return t=zu(t),zu(e)===t}function Wu(){}function Ju(e,t,n,i,o,s){switch(n){case"children":"string"==typeof i?"body"===t||"textarea"===t&&""===i||bt(e,i):("number"==typeof i||"bigint"==typeof i)&&"body"!==t&&bt(e,""+i);break;case"className":Ze(e,"class",i);break;case"tabIndex":Ze(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":Ze(e,n,i);break;case"style":St(e,i,s);break;case"data":if("object"!==t){Ze(e,"data",i);break}case"src":case"href":if(""===i&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==i||"function"==typeof i||"symbol"==typeof i||"boolean"==typeof i){e.removeAttribute(n);break}i=Tt(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if("function"==typeof i){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof s&&("formAction"===n?("input"!==t&&Ju(e,t,"name",o.name,o,null),Ju(e,t,"formEncType",o.formEncType,o,null),Ju(e,t,"formMethod",o.formMethod,o,null),Ju(e,t,"formTarget",o.formTarget,o,null)):(Ju(e,t,"encType",o.encType,o,null),Ju(e,t,"method",o.method,o,null),Ju(e,t,"target",o.target,o,null))),null==i||"symbol"==typeof i||"boolean"==typeof i){e.removeAttribute(n);break}i=Tt(""+i),e.setAttribute(n,i);break;case"onClick":null!=i&&(e.onclick=Wu);break;case"onScroll":null!=i&&Au("scroll",e);break;case"onScrollEnd":null!=i&&Au("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!=typeof i||!("__html"in i))throw Error(r(61));if(null!=(n=i.__html)){if(null!=o.children)throw Error(r(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&"function"!=typeof i&&"symbol"!=typeof i;break;case"muted":e.muted=i&&"function"!=typeof i&&"symbol"!=typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==i||"function"==typeof i||"boolean"==typeof i||"symbol"==typeof i){e.removeAttribute("xlink:href");break}n=Tt(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===i?e.setAttribute(n,""):!1!==i&&null!=i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"==typeof i||"symbol"==typeof i||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":Au("beforetoggle",e),Au("toggle",e),Qe(e,"popover",i);break;case"xlinkActuate":et(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":et(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":et(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":et(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":et(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":et(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":et(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":et(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":et(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":Qe(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&Qe(e,n=Ct.get(n)||n,i)}}function Yu(e,t,n,i,o,s){switch(n){case"style":St(e,i,s);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!=typeof i||!("__html"in i))throw Error(r(61));if(null!=(n=i.__html)){if(null!=o.children)throw Error(r(60));e.innerHTML=n}}break;case"children":"string"==typeof i?bt(e,i):("number"==typeof i||"bigint"==typeof i)&&bt(e,""+i);break;case"onScroll":null!=i&&Au("scroll",e);break;case"onScrollEnd":null!=i&&Au("scrollend",e);break;case"onClick":null!=i&&(e.onclick=Wu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:qe.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(o=n.endsWith("Capture"),t=n.slice(2,o?n.length-7:void 0),"function"==typeof(s=null!=(s=e[Pe]||null)?s[n]:null)&&e.removeEventListener(t,s,o),"function"!=typeof i)?n in e?e[n]=i:!0===i?e.setAttribute(n,""):Qe(e,n,i):("function"!=typeof s&&null!==s&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,o)))}}function Xu(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Au("error",e),Au("load",e);var i,o=!1,s=!1;for(i in n)if(n.hasOwnProperty(i)){var a=n[i];if(null!=a)switch(i){case"src":o=!0;break;case"srcSet":s=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:Ju(e,t,i,a,n,null)}}return s&&Ju(e,t,"srcSet",n.srcSet,n,null),void(o&&Ju(e,t,"src",n.src,n,null));case"input":Au("invalid",e);var l=i=a=s=null,c=null,u=null;for(o in n)if(n.hasOwnProperty(o)){var d=n[o];if(null!=d)switch(o){case"name":s=d;break;case"type":a=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":i=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(r(137,t));break;default:Ju(e,t,o,d,n,null)}}return ft(e,i,l,c,u,a,s,!1),void lt(e);case"select":for(s in Au("invalid",e),o=a=i=null,n)if(n.hasOwnProperty(s)&&null!=(l=n[s]))switch(s){case"value":i=l;break;case"defaultValue":a=l;break;case"multiple":o=l;default:Ju(e,t,s,l,n,null)}return t=i,n=a,e.multiple=!!o,void(null!=t?vt(e,!!o,t,!1):null!=n&&vt(e,!!o,n,!0));case"textarea":for(a in Au("invalid",e),i=s=o=null,n)if(n.hasOwnProperty(a)&&null!=(l=n[a]))switch(a){case"value":o=l;break;case"defaultValue":s=l;break;case"children":i=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(r(91));break;default:Ju(e,t,a,l,n,null)}return yt(e,o,s,i),void lt(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(o=n[c]))if("selected"===c)e.selected=o&&"function"!=typeof o&&"symbol"!=typeof o;else Ju(e,t,c,o,n,null);return;case"dialog":Au("beforetoggle",e),Au("toggle",e),Au("cancel",e),Au("close",e);break;case"iframe":case"object":Au("load",e);break;case"video":case"audio":for(o=0;o<Lu.length;o++)Au(Lu[o],e);break;case"image":Au("error",e),Au("load",e);break;case"details":Au("toggle",e);break;case"embed":case"source":case"link":Au("error",e),Au("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(o=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:Ju(e,t,u,o,n,null)}return;default:if(Et(t)){for(d in n)n.hasOwnProperty(d)&&(void 0!==(o=n[d])&&Yu(e,t,d,o,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(o=n[l])&&Ju(e,t,l,o,n,null))}var Qu=null,Zu=null;function ed(e){return 9===e.nodeType?e:e.ownerDocument}function td(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function nd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function rd(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var id=null;var od="function"==typeof setTimeout?setTimeout:void 0,sd="function"==typeof clearTimeout?clearTimeout:void 0,ad="function"==typeof Promise?Promise:void 0,ld="function"==typeof queueMicrotask?queueMicrotask:typeof ad<"u"?function(e){return ad.resolve(null).then(e).catch(cd)}:od;function cd(e){setTimeout(function(){throw e})}function ud(e){return"head"===e}function dd(e,t){var n=t,r=0,i=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0<r&&8>r){n=r;var s=e.ownerDocument;if(1&n&&yd(s.documentElement),2&n&&yd(s.body),4&n)for(yd(n=s.head),s=n.firstChild;s;){var a=s.nextSibling,l=s.nodeName;s[Ne]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===s.rel.toLowerCase()||n.removeChild(s),s=a}}if(0===i)return e.removeChild(o),void Ch(t);i--}else"$"===n||"$?"===n||"$!"===n?i++:r=n.charCodeAt(0)-48;else r=0;n=o}while(n);Ch(t)}function hd(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":hd(n),je(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function pd(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function fd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var md=null;function vd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function gd(e,t,n){switch(t=ed(n),e){case"html":if(!(e=t.documentElement))throw Error(r(452));return e;case"head":if(!(e=t.head))throw Error(r(453));return e;case"body":if(!(e=t.body))throw Error(r(454));return e;default:throw Error(r(451))}}function yd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);je(e)}var bd=new Map,wd=new Set;function _d(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Sd=M.d;M.d={f:function(){var e=Sd.f(),t=Fc();return e||t},r:function(e){var t=Ue(e);null!==t&&5===t.tag&&"form"===t.type?Ps(t):Sd.r(e)},D:function(e){Sd.D(e),Cd("dns-prefetch",e,null)},C:function(e,t){Sd.C(e,t),Cd("preconnect",e,t)},L:function(e,t,n){Sd.L(e,t,n);var r=Ed;if(r&&e&&t){var i='link[rel="preload"][as="'+ht(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+ht(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(i+='[imagesizes="'+ht(n.imageSizes)+'"]')):i+='[href="'+ht(e)+'"]';var o=i;switch(t){case"style":o=Td(e);break;case"script":o=xd(e)}bd.has(o)||(e=c({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),bd.set(o,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(Rd(o))||"script"===t&&r.querySelector(Pd(o))||(Xu(t=r.createElement("link"),"link",e),$e(t),r.head.appendChild(t)))}},m:function(e,t){Sd.m(e,t);var n=Ed;if(n&&e){var r=t&&"string"==typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+ht(r)+'"][href="'+ht(e)+'"]',o=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=xd(e)}if(!bd.has(o)&&(e=c({rel:"modulepreload",href:e},t),bd.set(o,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Pd(o)))return}Xu(r=n.createElement("link"),"link",e),$e(r),n.head.appendChild(r)}}},X:function(e,t){Sd.X(e,t);var n=Ed;if(n&&e){var r=He(n).hoistableScripts,i=xd(e),o=r.get(i);o||((o=n.querySelector(Pd(i)))||(e=c({src:e,async:!0},t),(t=bd.get(i))&&Ad(e,t),$e(o=n.createElement("script")),Xu(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}},S:function(e,t,n){Sd.S(e,t,n);var r=Ed;if(r&&e){var i=He(r).hoistableStyles,o=Td(e);t=t||"default";var s=i.get(o);if(!s){var a={loading:0,preload:null};if(s=r.querySelector(Rd(o)))a.loading=5;else{e=c({rel:"stylesheet",href:e,"data-precedence":t},n),(n=bd.get(o))&&Od(e,n);var l=s=r.createElement("link");$e(l),Xu(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){a.loading|=1}),l.addEventListener("error",function(){a.loading|=2}),a.loading|=4,Md(s,t,r)}s={type:"stylesheet",instance:s,count:1,state:a},i.set(o,s)}}},M:function(e,t){Sd.M(e,t);var n=Ed;if(n&&e){var r=He(n).hoistableScripts,i=xd(e),o=r.get(i);o||((o=n.querySelector(Pd(i)))||(e=c({src:e,async:!0,type:"module"},t),(t=bd.get(i))&&Ad(e,t),$e(o=n.createElement("script")),Xu(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}}};var Ed=typeof document>"u"?null:document;function Cd(e,t,n){var r=Ed;if(r&&"string"==typeof t&&t){var i=ht(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"==typeof n&&(i+='[crossorigin="'+n+'"]'),wd.has(i)||(wd.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(Xu(t=r.createElement("link"),"link",e),$e(t),r.head.appendChild(t)))}}function kd(e,t,n,i){var o=(o=H.current)?_d(o):null;if(!o)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=Td(n.href),(i=(n=He(o).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=Td(n.href);var s=He(o).hoistableStyles,a=s.get(e);if(a||(o=o.ownerDocument||o,a={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},s.set(e,a),(s=o.querySelector(Rd(e)))&&!s._p&&(a.instance=s,a.state.loading=5),bd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},bd.set(e,n),s||function(e,t,n,r){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?r.loading=1:(t=e.createElement("link"),r.preload=t,t.addEventListener("load",function(){return r.loading|=1}),t.addEventListener("error",function(){return r.loading|=2}),Xu(t,"link",n),$e(t),e.head.appendChild(t))}(o,e,n,a.state))),t&&null===i)throw Error(r(528,""));return a}if(t&&null!==i)throw Error(r(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=xd(n),(i=(n=He(o).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function Td(e){return'href="'+ht(e)+'"'}function Rd(e){return'link[rel="stylesheet"]['+e+"]"}function Id(e){return c({},e,{"data-precedence":e.precedence,precedence:null})}function xd(e){return'[src="'+ht(e)+'"]'}function Pd(e){return"script[async]"+e}function Ld(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+ht(n.href)+'"]');if(i)return t.instance=i,$e(i),i;var o=c({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return $e(i=(e.ownerDocument||e).createElement("style")),Xu(i,"style",o),Md(i,n.precedence,e),t.instance=i;case"stylesheet":o=Td(n.href);var s=e.querySelector(Rd(o));if(s)return t.state.loading|=4,t.instance=s,$e(s),s;i=Id(n),(o=bd.get(o))&&Od(i,o),$e(s=(e.ownerDocument||e).createElement("link"));var a=s;return a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),Xu(s,"link",i),t.state.loading|=4,Md(s,n.precedence,e),t.instance=s;case"script":return s=xd(n.src),(o=e.querySelector(Pd(s)))?(t.instance=o,$e(o),o):(i=n,(o=bd.get(s))&&Ad(i=c({},n),o),$e(o=(e=e.ownerDocument||e).createElement("script")),Xu(o,"link",i),e.head.appendChild(o),t.instance=o);case"void":return null;default:throw Error(r(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,Md(i,n.precedence,e));return t.instance}function Md(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,o=i,s=0;s<r.length;s++){var a=r[s];if(a.dataset.precedence===t)o=a;else if(o!==i)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Od(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Ad(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Dd=null;function Nd(e,t,n){if(null===Dd){var r=new Map,i=Dd=new Map;i.set(n,r)}else(r=(i=Dd).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var o=n[i];if(!(o[Ne]||o[xe]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var s=o.getAttribute(t)||"";s=e+s;var a=r.get(s);a?a.push(o):r.set(s,[o])}}return r}function jd(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Fd(e){return!("stylesheet"===e.type&&!(3&e.state.loading))}var Ud=null;function Bd(){}function Hd(){if(this.count--,0===this.count)if(this.stylesheets)Vd(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var $d=null;function Vd(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,$d=new Map,t.forEach(qd,e),$d=null,Hd.call(e))}function qd(e,t){if(!(4&t.state.loading)){var n=$d.get(e);if(n)var r=n.get(null);else{n=new Map,$d.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<i.length;o++){var s=i[o];("LINK"===s.nodeName||"not all"!==s.getAttribute("media"))&&(n.set(s.dataset.precedence,s),r=s)}r&&n.set(null,r)}s=(i=t.instance).getAttribute("data-precedence"),(o=n.get(s)||r)===r&&n.set(null,i),n.set(s,i),this.count++,r=Hd.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),o?o.parentNode.insertBefore(i,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var Gd={$$typeof:y,Provider:null,Consumer:null,_currentValue:O,_currentValue2:O,_threadCount:0};function zd(e,t,n,r,i,o,s,a){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_e(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_e(0),this.hiddenUpdates=_e(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=o,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function Kd(e,t,n,r,i,o,s,a,l,c,u,d){return e=new zd(e,t,n,s,a,l,c,d),t=1,!0===o&&(t|=24),o=Or(3,null,null,t),e.current=o,o.stateNode=e,(t=Pi()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:r,isDehydrated:n,cache:t},Zi(o),e}function Wd(e){return e?e=Lr:Lr}function Jd(e,t,n,r,i,o){i=Wd(i),null===r.context?r.context=i:r.pendingContext=i,(r=to(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(r.callback=o),null!==(n=no(e,r,t))&&(Oc(n,0,t),ro(n,e,t))}function Yd(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Xd(e,t){Yd(e,t),(e=e.alternate)&&Yd(e,t)}function Qd(e){if(13===e.tag){var t=Ir(e,67108864);null!==t&&Oc(t,0,67108864),Xd(e,67108864)}}var Zd=!0;function eh(e,t,n,r){var i=L.T;L.T=null;var o=M.p;try{M.p=2,nh(e,t,n,r)}finally{M.p=o,L.T=i}}function th(e,t,n,r){var i=L.T;L.T=null;var o=M.p;try{M.p=8,nh(e,t,n,r)}finally{M.p=o,L.T=i}}function nh(e,t,n,r){if(Zd){var i=rh(r);if(null===i)Uu(e,t,r,ih,n),mh(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return lh=vh(lh,e,t,n,r,i),!0;case"dragenter":return ch=vh(ch,e,t,n,r,i),!0;case"mouseover":return uh=vh(uh,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return dh.set(o,vh(dh.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,hh.set(o,vh(hh.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(mh(e,r),4&t&&-1<fh.indexOf(e)){for(;null!==i;){var o=Ue(i);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var s=me(o.pendingLanes);if(0!==s){var a=o;for(a.pendingLanes|=2,a.entangledLanes|=2;s;){var l=1<<31-ue(s);a.entanglements[1]|=l,s&=~l}bu(o),!(6&Zl)&&(bc=Q()+500,wu(0))}}break;case 13:null!==(a=Ir(o,2))&&Oc(a,0,2),Fc(),Xd(o,2)}if(null===(o=rh(r))&&Uu(e,t,r,ih,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Uu(e,t,r,null,n)}}function rh(e){return oh(e=It(e))}var ih=null;function oh(e){if(ih=null,null!==(e=Fe(e))){var t=o(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=s(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return ih=e,null}function sh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Z()){case ee:return 2;case te:return 8;case ne:case re:return 32;case ie:return 268435456;default:return 32}default:return 32}}var ah=!1,lh=null,ch=null,uh=null,dh=new Map,hh=new Map,ph=[],fh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function mh(e,t){switch(e){case"focusin":case"focusout":lh=null;break;case"dragenter":case"dragleave":ch=null;break;case"mouseover":case"mouseout":uh=null;break;case"pointerover":case"pointerout":dh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":hh.delete(t.pointerId)}}function vh(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=Ue(t))&&Qd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function gh(e){var t=Fe(e.target);if(null!==t){var n=o(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=s(n)))return e.blockedOn=t,void function(e,t){var n=M.p;try{return M.p=e,t()}finally{M.p=n}}(e.priority,function(){if(13===n.tag){var e=Lc();e=ke(e);var t=Ir(n,e);null!==t&&Oc(t,0,e),Xd(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function yh(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=rh(e.nativeEvent);if(null!==n)return null!==(t=Ue(n))&&Qd(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Rt=r,n.target.dispatchEvent(r),Rt=null,t.shift()}return!0}function bh(e,t,n){yh(e)&&n.delete(t)}function wh(){ah=!1,null!==lh&&yh(lh)&&(lh=null),null!==ch&&yh(ch)&&(ch=null),null!==uh&&yh(uh)&&(uh=null),dh.forEach(bh),hh.forEach(bh)}function _h(t,n){t.blockedOn===n&&(t.blockedOn=null,ah||(ah=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,wh)))}var Sh=null;function Eh(t){Sh!==t&&(Sh=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Sh===t&&(Sh=null);for(var e=0;e<t.length;e+=3){var n=t[e],r=t[e+1],i=t[e+2];if("function"!=typeof r){if(null===oh(r||n))continue;break}var o=Ue(n);null!==o&&(t.splice(e,3),e-=3,Is(o,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function Ch(e){function t(t){return _h(t,e)}null!==lh&&_h(lh,e),null!==ch&&_h(ch,e),null!==uh&&_h(uh,e),dh.forEach(t),hh.forEach(t);for(var n=0;n<ph.length;n++){var r=ph[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<ph.length&&null===(n=ph[0]).blockedOn;)gh(n),null===n.blockedOn&&ph.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],s=i[Pe]||null;if("function"==typeof o)s||Eh(n);else if(s){var a=null;if(o&&o.hasAttribute("formAction")){if(i=o,s=o[Pe]||null)a=s.formAction;else if(null!==oh(i))continue}else a=s.action;"function"==typeof a?n[r+1]=a:(n.splice(r,3),r-=3),Eh(n)}}}function kh(e){this._internalRoot=e}function Th(e){this._internalRoot=e}Th.prototype.render=kh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));Jd(t.current,Lc(),e,t,null,null)},Th.prototype.unmount=kh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Jd(e.current,2,null,e,null,null),Fc(),t[Le]=null}},Th.prototype.unstable_scheduleHydration=function(e){if(e){var t=Re();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ph.length&&0!==t&&t<ph[n].priority;n++);ph.splice(n,0,e),0===n&&gh(e)}};var Rh=t.version;if("19.1.0"!==Rh)throw Error(r(527,Rh,"19.1.0"));M.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t)throw"function"==typeof e.render?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=function(e){var t=e.alternate;if(!t){if(null===(t=o(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,i=t;;){var s=n.return;if(null===s)break;var l=s.alternate;if(null===l){if(null!==(i=s.return)){n=i;continue}break}if(s.child===l.child){for(l=s.child;l;){if(l===n)return a(s),e;if(l===i)return a(s),t;l=l.sibling}throw Error(r(188))}if(n.return!==i.return)n=s,i=l;else{for(var c=!1,u=s.child;u;){if(u===n){c=!0,n=s,i=l;break}if(u===i){c=!0,i=s,n=l;break}u=u.sibling}if(!c){for(u=l.child;u;){if(u===n){c=!0,n=l,i=s;break}if(u===i){c=!0,i=l,n=s;break}u=u.sibling}if(!c)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?l(e):null)?null:e.stateNode};var Ih={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xh.isDisabled&&xh.supportsFiber)try{ae=xh.inject(Ih),le=xh}catch{}}return w0.createRoot=function(e,t){if(!i(e))throw Error(r(299));var n=!1,o="",s=ma,a=va,l=ga;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(o=t.identifierPrefix),void 0!==t.onUncaughtError&&(s=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Kd(e,1,!1,null,0,n,o,s,a,l,0,null),e[Le]=t.current,ju(e),new kh(t)},w0.hydrateRoot=function(e,t,n){if(!i(e))throw Error(r(299));var o=!1,s="",a=ma,l=va,c=ga,u=null;return null!=n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=Kd(e,1,!0,t,0,o,s,a,l,c,0,u)).context=Wd(null),n=t.current,(s=to(o=ke(o=Lc()))).callback=null,no(n,s,o),n=o,t.current.lanes=n,Se(t,n),bu(t),e[Le]=t.current,ju(e),new Th(t)},w0.version="19.1.0",w0}function mbe(){if(yB)return Pk.exports;return yB=1,function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||"function"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),Pk.exports=pbe(),Pk.exports}var gbe=mbe(),bB={};function vbe(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var ybe=Object.defineProperty,bbe=(e,t,n)=>t in e?ybe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_B=(e,t,n)=>bbe(e,"symbol"!=typeof t?t+"":t,n);let ds=class{constructor(){_B(this,"_locking"),_B(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise(t=>e=()=>{this._locks-=1,t()}),n=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),n}};function gr(e,t){if(!e)throw new Error(t)}const _be=34028234663852886e22,Sbe=-34028234663852886e22,Ebe=4294967295,wbe=2147483647,Cbe=-2147483648;function GE(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>wbe||e<Cbe)throw new Error("invalid int 32: "+e)}function vA(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>Ebe||e<0)throw new Error("invalid uint 32: "+e)}function wQ(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>_be||e<Sbe))throw new Error("invalid float 32: "+e)}const CQ=Symbol("@bufbuild/protobuf/enum-type");function Tbe(e){const t=e[CQ];return gr(t,"missing enum type on enum object"),t}function TQ(e,t,n,r){e[CQ]=RQ(t,n.map(t=>({no:t.no,name:t.name,localName:e[t.no]})))}function RQ(e,t,n){const r=Object.create(null),i=Object.create(null),o=[];for(const e of t){const t=IQ(e);o.push(t),r[e.name]=t,i[e.no]=t}return{typeName:e,values:o,findName:e=>r[e],findNumber:e=>i[e]}}function Rbe(e,t,n){const r={};for(const e of t){const t=IQ(e);r[t.localName]=t.no,r[t.no]=t.localName}return TQ(r,e,t),r}function IQ(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class nO{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,r=n.makeReadOptions(t);return n.readMessage(this,r.readerFactory(e),e.byteLength,r),this}fromJson(e,t){const n=this.getType(),r=n.runtime.json,i=r.makeReadOptions(t);return r.readMessage(n,e,i,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),r=n.writerFactory();return t.writeMessage(this,r,n),r.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Ibe(e,t,n,r){var i;const o=null!==(i=null==r?void 0:r.localName)&&void 0!==i?i:t.substring(t.lastIndexOf(".")+1),s={[o]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[o];return Object.setPrototypeOf(s.prototype,new nO),Object.assign(s,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new s).fromBinary(e,t),fromJson:(e,t)=>(new s).fromJson(e,t),fromJsonString:(e,t)=>(new s).fromJsonString(e,t),equals:(t,n)=>e.util.equals(s,t,n)}),s}function kbe(){let e=0,t=0;for(let n=0;n<28;n+=7){let r=this.buf[this.pos++];if(e|=(127&r)<<n,!(128&r))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,!(128&n))return this.assertBounds(),[e,t];for(let n=3;n<=31;n+=7){let r=this.buf[this.pos++];if(t|=(127&r)<<n,!(128&r))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function Nk(e,t,n){for(let r=0;r<28;r+=7){const i=e>>>r,o=!(!(i>>>7)&&0==t),s=255&(o?128|i:i);if(n.push(s),!o)return}const r=e>>>28&15|(7&t)<<4,i=!!(t>>3);if(n.push(255&(i?128|r:r)),i){for(let e=3;e<31;e+=7){const r=t>>>e,i=!!(r>>>7),o=255&(i?128|r:r);if(n.push(o),!i)return}n.push(t>>>31&1)}}const KE=4294967296;function SB(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let r=0,i=0;function o(t,o){const s=Number(e.slice(t,o));i*=n,r=r*n+s,r>=KE&&(i+=r/KE|0,r%=KE)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),t?xQ(r,i):rO(r,i)}function xbe(e,t){let n=rO(e,t);const r=2147483648&n.hi;r&&(n=xQ(n.lo,n.hi));const i=kQ(n.lo,n.hi);return r?"-"+i:i}function kQ(e,t){if(({lo:e,hi:t}=Abe(e,t)),t<=2097151)return String(KE*t+e);const n=16777215&(e>>>24|t<<8),r=t>>16&65535;let i=(16777215&e)+6777216*n+6710656*r,o=n+8147497*r,s=2*r;const a=1e7;return i>=a&&(o+=Math.floor(i/a),i%=a),o>=a&&(s+=Math.floor(o/a),o%=a),s.toString()+EB(o)+EB(i)}function Abe(e,t){return{lo:e>>>0,hi:t>>>0}}function rO(e,t){return{lo:0|e,hi:0|t}}function xQ(e,t){return t=~t,e?e=1+~e:t+=1,rO(e,t)}const EB=e=>{const t=String(e);return"0000000".slice(t.length)+t};function wB(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function Lbe(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;128&e&&t<10;t++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function Pbe(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"object"!=typeof bB||"1"!==bB.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),r=BigInt("0"),i=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const r="bigint"==typeof e?e:BigInt(e);if(r>n||r<t)throw new Error("int64 invalid: ".concat(e));return r},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>i||t<r)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>gr(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>gr(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),SB(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),SB(e)),dec:(e,t)=>xbe(e,t),uDec:(e,t)=>kQ(e,t)}}const Jn=Pbe();var be,hf,Tr;function _d(e,t,n){if(t===n)return!0;if(e==be.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array&&t.length===n.length))return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case be.UINT64:case be.FIXED64:case be.INT64:case be.SFIXED64:case be.SINT64:return t==n}return!1}function ev(e,t){switch(e){case be.BOOL:return!1;case be.UINT64:case be.FIXED64:case be.INT64:case be.SFIXED64:case be.SINT64:return 0==t?Jn.zero:"0";case be.DOUBLE:case be.FLOAT:return 0;case be.BYTES:return new Uint8Array(0);case be.STRING:return"";default:return 0}}function AQ(e,t){switch(e){case be.BOOL:return!1===t;case be.STRING:return""===t;case be.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(be||(be={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(hf||(hf={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(Tr||(Tr={}));class Obe{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),n=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],n),n+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(vA(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return GE(e),wB(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){wQ(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){vA(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){GE(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return GE(e),wB(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),r=Jn.enc(e);return n.setInt32(0,r.lo,!0),n.setInt32(4,r.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),r=Jn.uEnc(e);return n.setInt32(0,r.lo,!0),n.setInt32(4,r.hi,!0),this.raw(t)}int64(e){let t=Jn.enc(e);return Nk(t.lo,t.hi,this.buf),this}sint64(e){let t=Jn.enc(e),n=t.hi>>31;return Nk(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=Jn.uEnc(e);return Nk(t.lo,t.hi,this.buf),this}}class Mbe{constructor(e,t){this.varint64=kbe,this.uint32=Lbe,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case Tr.Varint:for(;128&this.buf[this.pos++];);break;case Tr.Bit64:this.pos+=4;case Tr.Bit32:this.pos+=4;break;case Tr.LengthDelimited:let n=this.uint32();this.pos+=n;break;case Tr.StartGroup:for(;;){const[e,n]=this.tag();if(n===Tr.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return Jn.dec(...this.varint64())}uint64(){return Jn.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,Jn.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Jn.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Jn.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function Dbe(e,t,n,r){let i;return{typeName:t,extendee:n,get field(){if(!i){const n="function"==typeof r?r():r;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),i=e.util.newFieldList([n]).list()[0]}return i},runtime:e}}function LQ(e){const t=e.field.localName,n=Object.create(null);return n[t]=Nbe(e),[n,()=>n[t]]}function Nbe(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return ev(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}function Ube(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(e=>e.no===t.no)}let ru="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),X3=[];for(let e=0;e<ru.length;e++)X3[ru[e].charCodeAt(0)]=e;X3[45]=ru.indexOf("+"),X3[95]=ru.indexOf("/");const PQ={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,r=new Uint8Array(t),i=0,o=0,s=0;for(let t=0;t<e.length;t++){if(n=X3[e.charCodeAt(t)],void 0===n)switch(e[t]){case"=":o=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:s=n,o=1;break;case 1:r[i++]=s<<2|(48&n)>>4,s=n,o=2;break;case 2:r[i++]=(15&s)<<4|(60&n)>>2,s=n,o=3;break;case 3:r[i++]=(3&s)<<6|n,o=0}}if(1==o)throw Error("invalid base64 string.");return r.subarray(0,i)},enc(e){let t,n="",r=0,i=0;for(let o=0;o<e.length;o++)switch(t=e[o],r){case 0:n+=ru[t>>2],i=(3&t)<<4,r=1;break;case 1:n+=ru[i|t>>4],i=(15&t)<<2,r=2;break;case 2:n+=ru[i|t>>6],n+=ru[63&t],r=0}return r&&(n+=ru[i],n+="=",1==r&&(n+="=")),n}};function jbe(e,t,n){MQ(t,e);const r=t.runtime.bin.makeReadOptions(n),i=Ube(e.getType().runtime.bin.listUnknownFields(e),t.field),[o,s]=LQ(t);for(const e of i)t.runtime.bin.readField(o,r.readerFactory(e.data),t.field,e.wireType,r);return s()}function Fbe(e,t,n,r){MQ(t,e);const i=t.runtime.bin.makeReadOptions(r),o=t.runtime.bin.makeWriteOptions(r);if(OQ(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter(e=>e.no!=t.field.no);e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const s=o.writerFactory();let a=t.field;!a.opt&&!a.repeated&&("enum"==a.kind||"scalar"==a.kind)&&(a=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(a,n,s,o);const l=i.readerFactory(s.finish());for(;l.pos<l.len;){const[t,n]=l.tag(),r=l.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,r)}}function OQ(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(e=>e.no==t.field.no)}function MQ(e,t){gr(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function DQ(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!AQ(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function CB(e,t){const n=e.localName,r=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=r?e.T.values[0].no:void 0;break;case"scalar":t[n]=r?ev(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function iu(e,t){if(null===e||"object"!=typeof e||!Object.getOwnPropertyNames(nO.prototype).every(t=>t in e&&"function"==typeof e[t]))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function NQ(e,t){return iu(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}be.DOUBLE,be.FLOAT,be.INT64,be.UINT64,be.INT32,be.UINT32,be.BOOL,be.STRING,be.BYTES;const TB={ignoreUnknownFields:!1},RB={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function $be(e){return e?Object.assign(Object.assign({},TB),e):TB}function Bbe(e){return e?Object.assign(Object.assign({},RB),e):RB}const cC=Symbol(),zE=Symbol();function Hbe(){return{makeReadOptions:$be,makeWriteOptions:Bbe,readMessage(e,t,n,r){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(jc(t)));r=r??new e;const i=new Map,o=n.typeRegistry;for(const[s,a]of Object.entries(t)){const t=e.fields.findJsonName(s);if(t){if(t.oneof){if(null===a&&"scalar"==t.kind)continue;const n=i.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(s,'"'));i.set(t.oneof,s)}IB(r,a,t,n,e)}else{let t=!1;if(null!=o&&o.findExtension&&s.startsWith("[")&&s.endsWith("]")){const i=o.findExtension(s.substring(1,s.length-1));if(i&&i.extendee.typeName==e.typeName){t=!0;const[e,o]=LQ(i);IB(e,a,i.field,n,i),Fbe(r,i,o(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(s,'" is unknown'))}}return r},writeMessage(e,t){const n=e.getType(),r={};let i;try{for(i of n.fields.byNumber()){if(!DQ(i,e)){if(i.req)throw"required field not set";if(!t.emitDefaultValues||!qbe(i))continue}const n=kB(i,i.oneof?e[i.oneof.localName].value:e[i.localName],t);void 0!==n&&(r[t.useProtoFieldName?i.name:i.jsonName]=n)}const o=t.typeRegistry;if(null!=o&&o.findExtensionFor)for(const i of n.runtime.bin.listUnknownFields(e)){const s=o.findExtensionFor(n.typeName,i.no);if(s&&OQ(e,s)){const n=jbe(e,s,t),i=kB(s.field,n,t);void 0!==i&&(r[s.field.jsonName]=i)}}}catch(e){const t=i?"cannot encode field ".concat(n.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),r=e instanceof Error?e.message:String(e);throw new Error(t+(r.length>0?": ".concat(r):""))}return r},readScalar:(e,t,n)=>Cy(e,t,n??hf.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t&&(n||AQ(e,t)))return WE(e,t)},debug:jc}}function jc(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function IB(e,t,n,r,i){let o=n.localName;if(n.repeated){if(gr("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(jc(t)));const s=e[o];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(jc(e)));switch(n.kind){case"message":s.push(n.T.fromJson(e,r));break;case"enum":const t=Uk(n.T,e,r.ignoreUnknownFields,!0);t!==zE&&s.push(t);break;case"scalar":try{s.push(Cy(n.T,e,n.L,!0))}catch(t){let r="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(jc(e));throw t instanceof Error&&t.message.length>0&&(r+=": ".concat(t.message)),new Error(r)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(jc(t)));const s=e[o];for(const[e,o]of Object.entries(t)){if(null===o)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: map value null"));let a;try{a=Vbe(n.K,e)}catch(e){let r="cannot decode map key for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(jc(t));throw e instanceof Error&&e.message.length>0&&(r+=": ".concat(e.message)),new Error(r)}switch(n.V.kind){case"message":s[a]=n.V.T.fromJson(o,r);break;case"enum":const e=Uk(n.V.T,o,r.ignoreUnknownFields,!0);e!==zE&&(s[a]=e);break;case"scalar":try{s[a]=Cy(n.V.T,o,hf.BIGINT,!0)}catch(e){let r="cannot decode map value for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(jc(t));throw e instanceof Error&&e.message.length>0&&(r+=": ".concat(e.message)),new Error(r)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const s=n.T;if(null===t&&"google.protobuf.Value"!=s.typeName)return;let a=e[o];iu(a)?a.fromJson(t,r):(e[o]=a=s.fromJson(t,r),s.fieldWrapper&&!n.oneof&&(e[o]=s.fieldWrapper.unwrapField(a)));break;case"enum":const l=Uk(n.T,t,r.ignoreUnknownFields,!1);switch(l){case cC:CB(n,e);break;case zE:break;default:e[o]=l}break;case"scalar":try{const r=Cy(n.T,t,n.L,!1);if(r===cC)CB(n,e);else e[o]=r}catch(e){let r="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(jc(t));throw e instanceof Error&&e.message.length>0&&(r+=": ".concat(e.message)),new Error(r)}}}function Vbe(e,t){if(e===be.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return Cy(e,t,hf.BIGINT,!0).toString()}function Cy(e,t,n,r){if(null===t)return r?ev(e,n):cC;switch(e){case be.DOUBLE:case be.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t||"string"==typeof t&&t.trim().length!==t.length||"string"!=typeof t&&"number"!=typeof t)break;const r=Number(t);if(Number.isNaN(r)||!Number.isFinite(r))break;return e==be.FLOAT&&wQ(r),r;case be.INT32:case be.FIXED32:case be.SFIXED32:case be.SINT32:case be.UINT32:let i;if("number"==typeof t?i=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(i=Number(t)),void 0===i)break;return e==be.UINT32||e==be.FIXED32?vA(i):GE(i),i;case be.INT64:case be.SFIXED64:case be.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=Jn.parse(t);return n?o.toString():o;case be.FIXED64:case be.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const s=Jn.uParse(t);return n?s.toString():s;case be.BOOL:if("boolean"!=typeof t)break;return t;case be.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case be.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return PQ.dec(t)}throw new Error}function Uk(e,t,n,r){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:r?e.values[0].no:cC;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const r=e.findName(t);if(void 0!==r)return r.no;if(n)return zE}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(jc(t)))}function qbe(e){return!(!e.repeated&&"map"!=e.kind)||!(e.oneof||"message"==e.kind||e.opt||e.req)}function kB(e,t,n){if("map"==e.kind){gr("object"==typeof t&&null!=t);const r={},i=Object.entries(t);switch(e.V.kind){case"scalar":for(const[t,n]of i)r[t.toString()]=WE(e.V.T,n);break;case"message":for(const[e,t]of i)r[e.toString()]=t.toJson(n);break;case"enum":const t=e.V.T;for(const[e,o]of i)r[e.toString()]=jk(t,o,n.enumAsInteger)}return n.emitDefaultValues||i.length>0?r:void 0}if(e.repeated){gr(Array.isArray(t));const r=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)r.push(WE(e.T,t[n]));break;case"enum":for(let i=0;i<t.length;i++)r.push(jk(e.T,t[i],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)r.push(t[e].toJson(n))}return n.emitDefaultValues||r.length>0?r:void 0}switch(e.kind){case"scalar":return WE(e.T,t);case"enum":return jk(e.T,t,n.enumAsInteger);case"message":return NQ(e.T,t).toJson(n)}}function jk(e,t,n){var r;if(gr("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const i=e.findNumber(t);return null!==(r=null==i?void 0:i.name)&&void 0!==r?r:t}function WE(e,t){switch(e){case be.INT32:case be.SFIXED32:case be.SINT32:case be.FIXED32:case be.UINT32:return gr("number"==typeof t),t;case be.FLOAT:case be.DOUBLE:return gr("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case be.STRING:return gr("string"==typeof t),t;case be.BOOL:return gr("boolean"==typeof t),t;case be.UINT64:case be.FIXED64:case be.INT64:case be.SFIXED64:case be.SINT64:return gr("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case be.BYTES:return gr(t instanceof Uint8Array),PQ.enc(t)}}const xm=Symbol("@bufbuild/protobuf/unknown-fields"),xB={readUnknownFields:!0,readerFactory:e=>new Mbe(e)},AB={writeUnknownFields:!0,writerFactory:()=>new Obe};function Gbe(e){return e?Object.assign(Object.assign({},xB),e):xB}function Kbe(e){return e?Object.assign(Object.assign({},AB),e):AB}function zbe(){return{makeReadOptions:Gbe,makeWriteOptions:Kbe,listUnknownFields(e){var t;return null!==(t=e[xm])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[xm]},writeUnknownFields(e,t){const n=e[xm];if(n)for(const e of n)t.tag(e.no,e.wireType).raw(e.data)},onUnknownField(e,t,n,r){const i=e;Array.isArray(i[xm])||(i[xm]=[]),i[xm].push({no:t,wireType:n,data:r})},readMessage(e,t,n,r,i){const o=e.getType(),s=i?t.len:t.pos+n;let a,l;for(;t.pos<s&&([a,l]=t.tag(),!0!==i||l!=Tr.EndGroup);){const n=o.fields.find(a);if(!n){const n=t.skip(l,a);r.readUnknownFields&&this.onUnknownField(e,a,l,n);continue}LB(e,t,n,l,r)}if(i&&(l!=Tr.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:LB,writeMessage(e,t,n){const r=e.getType();for(const i of r.fields.byNumber()){if(!DQ(i,e)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}PB(i,i.oneof?e[i.oneof.localName].value:e[i.localName],t,n)}return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,r){void 0!==t&&PB(e,t,n,r)}}}function LB(e,t,n,r,i){let{repeated:o,localName:s}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=s&&delete e.value,e.case=s,s="value"),n.kind){case"scalar":case"enum":const a="enum"==n.kind?be.INT32:n.T;let l=lC;if("scalar"==n.kind&&n.L>0&&(l=Ybe),o){let n=e[s];if(r==Tr.LengthDelimited&&a!=be.STRING&&a!=be.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(l(t,a))}else n.push(l(t,a))}else e[s]=l(t,a);break;case"message":const c=n.T;o?e[s].push(YE(t,new c,i,n)):iu(e[s])?YE(t,e[s],i,n):(e[s]=YE(t,new c,i,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(e[s]=c.fieldWrapper.unwrapField(e[s])));break;case"map":let[u,d]=Wbe(n,t,i);e[s][u]=d}}function YE(e,t,n,r){const i=t.getType().runtime.bin,o=null==r?void 0:r.delimited;return i.readMessage(t,e,o?r.no:e.uint32(),n,o),t}function Wbe(e,t,n){const r=t.uint32(),i=t.pos+r;let o,s;for(;t.pos<i;){const[r]=t.tag();switch(r){case 1:o=lC(t,e.K);break;case 2:switch(e.V.kind){case"scalar":s=lC(t,e.V.T);break;case"enum":s=t.int32();break;case"message":s=YE(t,new e.V.T,n,void 0)}}}if(void 0===o&&(o=ev(e.K,hf.BIGINT)),"string"!=typeof o&&"number"!=typeof o&&(o=o.toString()),void 0===s)switch(e.V.kind){case"scalar":s=ev(e.V.T,hf.BIGINT);break;case"enum":s=e.V.T.values[0].no;break;case"message":s=new e.V.T}return[o,s]}function Ybe(e,t){const n=lC(e,t);return"bigint"==typeof n?n.toString():n}function lC(e,t){switch(t){case be.STRING:return e.string();case be.BOOL:return e.bool();case be.DOUBLE:return e.double();case be.FLOAT:return e.float();case be.INT32:return e.int32();case be.INT64:return e.int64();case be.UINT64:return e.uint64();case be.FIXED64:return e.fixed64();case be.BYTES:return e.bytes();case be.FIXED32:return e.fixed32();case be.SFIXED32:return e.sfixed32();case be.SFIXED64:return e.sfixed64();case be.SINT64:return e.sint64();case be.UINT32:return e.uint32();case be.SINT32:return e.sint32()}}function PB(e,t,n,r){gr(void 0!==t);const i=e.repeated;switch(e.kind){case"scalar":case"enum":let o="enum"==e.kind?be.INT32:e.T;if(i)if(gr(Array.isArray(t)),e.packed)Jbe(n,o,e.no,t);else for(const r of t)Ty(n,o,e.no,r);else Ty(n,o,e.no,t);break;case"message":if(i){gr(Array.isArray(t));for(const i of t)OB(n,r,e,i)}else OB(n,r,e,t);break;case"map":gr("object"==typeof t&&null!=t);for(const[i,o]of Object.entries(t))Xbe(n,r,e,i,o)}}function Xbe(e,t,n,r,i){e.tag(n.no,Tr.LengthDelimited),e.fork();let o=r;switch(n.K){case be.INT32:case be.FIXED32:case be.UINT32:case be.SFIXED32:case be.SINT32:o=Number.parseInt(r);break;case be.BOOL:gr("true"==r||"false"==r),o="true"==r}switch(Ty(e,n.K,1,o),n.V.kind){case"scalar":Ty(e,n.V.T,2,i);break;case"enum":Ty(e,be.INT32,2,i);break;case"message":gr(void 0!==i),e.tag(2,Tr.LengthDelimited).bytes(i.toBinary(t))}e.join()}function OB(e,t,n,r){const i=NQ(n.T,r);n.delimited?e.tag(n.no,Tr.StartGroup).raw(i.toBinary(t)).tag(n.no,Tr.EndGroup):e.tag(n.no,Tr.LengthDelimited).bytes(i.toBinary(t))}function Ty(e,t,n,r){gr(void 0!==r);let[i,o]=UQ(t);e.tag(n,i)[o](r)}function Jbe(e,t,n,r){if(!r.length)return;e.tag(n,Tr.LengthDelimited).fork();let[,i]=UQ(t);for(let t=0;t<r.length;t++)e[i](r[t]);e.join()}function UQ(e){let t=Tr.Varint;switch(e){case be.BYTES:case be.STRING:t=Tr.LengthDelimited;break;case be.DOUBLE:case be.FIXED64:case be.SFIXED64:t=Tr.Bit64;break;case be.FIXED32:case be.SFIXED32:case be.FLOAT:t=Tr.Bit32}return[t,be[e].toLowerCase()]}function Qbe(){return{setEnumType:TQ,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const r of n.fields.byMember()){const n=r.localName,i=t,o=e;if(null!=o[n])switch(r.kind){case"oneof":const e=o[n].case;if(void 0===e)continue;const t=r.findField(e);let s=o[n].value;t&&"message"==t.kind&&!iu(s,t.T)?s=new t.T(s):t&&"scalar"===t.kind&&t.T===be.BYTES&&(s=C0(s)),i[n]={case:e,value:s};break;case"scalar":case"enum":let a=o[n];r.T===be.BYTES&&(a=r.repeated?a.map(C0):C0(a)),i[n]=a;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===be.BYTES)for(const[e,t]of Object.entries(o[n]))i[n][e]=C0(t);else Object.assign(i[n],o[n]);break;case"message":const e=r.V.T;for(const t of Object.keys(o[n])){let r=o[n][t];e.fieldWrapper||(r=new e(r)),i[n][t]=r}}break;case"message":const l=r.T;if(r.repeated)i[n]=o[n].map(e=>iu(e,l)?e:new l(e));else{const e=o[n];l.fieldWrapper?"google.protobuf.BytesValue"===l.typeName?i[n]=C0(e):i[n]=e:i[n]=iu(e,l)?e:new l(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every(e=>{const r=t[e.localName],i=n[e.localName];if(e.repeated){if(r.length!==i.length)return!1;switch(e.kind){case"message":return r.every((t,n)=>e.T.equals(t,i[n]));case"scalar":return r.every((t,n)=>_d(e.T,t,i[n]));case"enum":return r.every((e,t)=>_d(be.INT32,e,i[t]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":let t=r,n=i;return e.T.fieldWrapper&&(void 0!==t&&!iu(t)&&(t=e.T.fieldWrapper.wrapField(t)),void 0!==n&&!iu(n)&&(n=e.T.fieldWrapper.wrapField(n))),e.T.equals(t,n);case"enum":return _d(be.INT32,r,i);case"scalar":return _d(e.T,r,i);case"oneof":if(r.case!==i.case)return!1;const o=e.findField(r.case);if(void 0===o)return!0;switch(o.kind){case"message":return o.T.equals(r.value,i.value);case"enum":return _d(be.INT32,r.value,i.value);case"scalar":return _d(o.T,r.value,i.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const s=Object.keys(r).concat(Object.keys(i));switch(e.V.kind){case"message":const t=e.V.T;return s.every(e=>t.equals(r[e],i[e]));case"enum":return s.every(e=>_d(be.INT32,r[e],i[e]));case"scalar":const n=e.V.T;return s.every(e=>_d(n,r[e],i[e]))}}}),clone(e){const t=e.getType(),n=new t,r=n;for(const n of t.fields.byMember()){const t=e[n.localName];let i;if(n.repeated)i=t.map(C2);else if("map"==n.kind){i=r[n.localName];for(const[e,n]of Object.entries(t))i[e]=C2(n)}else i="oneof"==n.kind?n.findField(t.case)?{case:t.case,value:C2(t.value)}:{case:void 0}:C2(t);r[n.localName]=i}for(const n of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(r,n.no,n.wireType,n.data);return n}}}function C2(e){if(void 0===e)return e;if(iu(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function C0(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function Zbe(e,t,n){return{syntax:e,json:Hbe(),bin:zbe(),util:Object.assign(Object.assign({},Qbe()),{newFieldList:t,initFields:n}),makeMessageType(e,t,n){return Ibe(this,e,t,n)},makeEnum:Rbe,makeEnumType:RQ,getEnumType:Tbe,makeExtension(e,t,n){return Dbe(this,e,t,n)}}}class e_e{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function jQ(e,t){const n=FQ(e);return t?n:o_e(s_e(n))}function t_e(e){return jQ(e,!1)}const n_e=FQ;function FQ(e){let t=!1;const n=[];for(let r=0;r<e.length;r++){let i=e.charAt(r);switch(i){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),t=!1;break;default:t&&(t=!1,i=i.toUpperCase()),n.push(i)}}return n.join("")}const r_e=new Set(["constructor","toString","toJSON","valueOf"]),i_e=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),$Q=e=>"".concat(e,"$"),s_e=e=>i_e.has(e)?$Q(e):e,o_e=e=>r_e.has(e)?$Q(e):e;class a_e{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=t_e(e)}addField(e){gr(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}function c_e(e,t){var n,r,i,o,s,a;const l=[];let c;for(const t of"function"==typeof e?e():e){const e=t;if(e.localName=jQ(t.name,void 0!==t.oneof),e.jsonName=null!==(n=t.jsonName)&&void 0!==n?n:n_e(t.name),e.repeated=null!==(r=t.repeated)&&void 0!==r&&r,"scalar"==t.kind&&(e.L=null!==(i=t.L)&&void 0!==i?i:hf.BIGINT),e.delimited=null!==(o=t.delimited)&&void 0!==o&&o,e.req=null!==(s=t.req)&&void 0!==s&&s,e.opt=null!==(a=t.opt)&&void 0!==a&&a,void 0===t.packed&&(e.packed="enum"==t.kind||"scalar"==t.kind&&t.T!=be.BYTES&&t.T!=be.STRING),void 0!==t.oneof){const n="string"==typeof t.oneof?t.oneof:t.oneof.name;(!c||c.name!=n)&&(c=new a_e(n)),e.oneof=c,c.addField(e)}l.push(e)}return l}const de=Zbe("proto3",e=>new e_e(e,e=>c_e(e)),e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,r=e;if(t.repeated)r[n]=[];else switch(t.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=ev(t.T,t.L)}}});class Os extends nO{constructor(e){super(),this.seconds=Jn.zero,this.nanos=0,de.util.initPartial(e,this)}fromJson(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(de.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Jn.parse(r/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return Os.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Os({seconds:Jn.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new Os).fromBinary(e,t)}static fromJson(e,t){return(new Os).fromJson(e,t)}static fromJsonString(e,t){return(new Os).fromJsonString(e,t)}static equals(e,t){return de.util.equals(Os,e,t)}}Os.runtime=de,Os.typeName="google.protobuf.Timestamp",Os.fields=de.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const l_e=de.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Os},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:u_e,repeated:!0},{no:5,name:"events",kind:"message",T:f_e,repeated:!0}]),u_e=de.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:d_e,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),d_e=de.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Os},{no:3,name:"value",kind:"scalar",T:2}]),f_e=de.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Os},{no:7,name:"normalized_end_timestamp",kind:"message",T:Os,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),BQ=de.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Ka=de.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ur=de.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),iO=de.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),oy=de.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),db=de.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Xa=de.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Am=de.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),h_e=de.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),bi=de.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),J3=de.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:uC,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:eZ}]),uC=de.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),p_e=de.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:de.getEnumType(Ur),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Jh=de.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:de.getEnumType(Eg)},{no:4,name:"tracks",kind:"message",T:rg,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:p_e},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:de.getEnumType(fb)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:de.getEnumType(Xa)},{no:18,name:"kind_details",kind:"enum",T:de.getEnumType(m_e),repeated:!0}]),Eg=de.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),fb=de.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),m_e=de.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),yo=de.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),g_e=de.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Fh,repeated:!0}]),rg=de.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:de.getEnumType(Ka)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:de.getEnumType(Ur)},{no:10,name:"layers",kind:"message",T:Fh,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:g_e,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:de.getEnumType(yo)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:eZ},{no:19,name:"audio_features",kind:"enum",T:de.getEnumType(bi),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:de.getEnumType(BQ)}]),Fh=de.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:de.getEnumType(iO)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Ms=de.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:de.getEnumType(Rt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:VQ,oneof:"value"},{no:3,name:"speaker",kind:"message",T:v_e,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:qQ,oneof:"value"},{no:7,name:"transcription",kind:"message",T:y_e,oneof:"value"},{no:8,name:"metrics",kind:"message",T:l_e,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:yA,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:GQ,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:KQ,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:zQ,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:_A,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:SA,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:EA,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Rt=de.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),v_e=de.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:HQ,repeated:!0}]),HQ=de.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),VQ=de.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),qQ=de.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),y_e=de.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:b_e,repeated:!0}]),b_e=de.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),yA=de.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),GQ=de.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),KQ=de.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),zQ=de.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:WQ,oneof:"value"}]),WQ=de.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),YQ=de.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),XQ=de.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:de.getEnumType(JQ)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),JQ=de.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),__e=de.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:de.getEnumType(QQ)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),QQ=de.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),ZQ=de.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:MB},{no:2,name:"screen",kind:"message",T:MB},{no:3,name:"resume_connection",kind:"enum",T:de.getEnumType(db)},{no:4,name:"disabled_codecs",kind:"message",T:S_e},{no:5,name:"force_relay",kind:"enum",T:de.getEnumType(db)}]),MB=de.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:de.getEnumType(db)}]),S_e=de.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:uC,repeated:!0},{no:2,name:"publish",kind:"message",T:uC,repeated:!0}]),eZ=de.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),bA=de.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),tZ=de.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:de.getEnumType(bA)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),nZ=de.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),_A=de.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:de.getEnumType(yo)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:tZ,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:nZ,oneof:"content_header"}],{localName:"DataStream_Header"}),SA=de.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),EA=de.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),za=de.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),wA=de.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),E_e=de.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),w_e=de.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Qh,oneof:"message"},{no:2,name:"answer",kind:"message",T:Qh,oneof:"message"},{no:3,name:"trickle",kind:"message",T:sO,oneof:"message"},{no:4,name:"add_track",kind:"message",T:TA,oneof:"message"},{no:5,name:"mute",kind:"message",T:oO,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Q3,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:rZ,oneof:"message"},{no:8,name:"leave",kind:"message",T:Z3,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:sZ,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:lZ,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:uZ,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Mc,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:oZ,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:hZ,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:iZ,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:k_e,oneof:"message"}]),DB=de.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:C_e,oneof:"message"},{no:2,name:"answer",kind:"message",T:Qh,oneof:"message"},{no:3,name:"offer",kind:"message",T:Qh,oneof:"message"},{no:4,name:"trickle",kind:"message",T:sO,oneof:"message"},{no:5,name:"update",kind:"message",T:I_e,oneof:"message"},{no:6,name:"track_published",kind:"message",T:aO,oneof:"message"},{no:8,name:"leave",kind:"message",T:Z3,oneof:"message"},{no:9,name:"mute",kind:"message",T:oO,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:x_e,oneof:"message"},{no:11,name:"room_update",kind:"message",T:A_e,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:P_e,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:M_e,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:N_e,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:U_e,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:R_e,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:T_e,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:F_e,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:H_e,oneof:"message"},{no:22,name:"request_response",kind:"message",T:V_e,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:q_e,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:j_e,oneof:"message"}]),CA=de.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),TA=de.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:de.getEnumType(Ka)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:de.getEnumType(Ur)},{no:9,name:"layers",kind:"message",T:Fh,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:CA,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:de.getEnumType(yo)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:de.getEnumType(BQ)},{no:17,name:"audio_features",kind:"enum",T:de.getEnumType(bi),repeated:!0}]),sO=de.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:de.getEnumType(za)},{no:3,name:"final",kind:"scalar",T:8}]),oO=de.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),C_e=de.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:J3},{no:2,name:"participant",kind:"message",T:Jh},{no:3,name:"other_participants",kind:"message",T:Jh,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:aZ,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ZQ},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:XQ},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:uC,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),T_e=de.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:aZ,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ZQ},{no:3,name:"server_info",kind:"message",T:XQ},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),aO=de.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:rg}]),R_e=de.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Qh=de.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),I_e=de.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Jh,repeated:!0}]),Q3=de.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:YQ,repeated:!0}]),rZ=de.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:de.getEnumType(iO)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),iZ=de.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:de.getEnumType(bi),repeated:!0}]),k_e=de.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Z3=de.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:de.getEnumType(Xa)},{no:3,name:"action",kind:"enum",T:de.getEnumType(wg)},{no:4,name:"regions",kind:"message",T:$_e}]),wg=de.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),sZ=de.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Fh,repeated:!0}]),oZ=de.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),aZ=de.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),x_e=de.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:HQ,repeated:!0}]),A_e=de.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:J3}]),L_e=de.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:de.getEnumType(oy)},{no:3,name:"score",kind:"scalar",T:2}]),P_e=de.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:L_e,repeated:!0}]),O_e=de.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:de.getEnumType(wA)}]),M_e=de.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:O_e,repeated:!0}]),cO=de.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:de.getEnumType(iO)},{no:2,name:"enabled",kind:"scalar",T:8}]),D_e=de.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:cO,repeated:!0}]),N_e=de.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:cO,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:D_e,repeated:!0}]),cZ=de.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),lZ=de.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:cZ,repeated:!0}]),U_e=de.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),j_e=de.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:J3},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Jh},{no:4,name:"other_participants",kind:"message",T:Jh,repeated:!0}]),uZ=de.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Qh},{no:2,name:"subscription",kind:"message",T:Q3},{no:3,name:"publish_tracks",kind:"message",T:aO,repeated:!0},{no:4,name:"data_channels",kind:"message",T:fZ,repeated:!0},{no:5,name:"offer",kind:"message",T:Qh},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:dZ,repeated:!0}]),dZ=de.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),fZ=de.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:de.getEnumType(za)}]),Mc=de.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:de.getEnumType(E_e),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),hZ=de.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),F_e=de.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),$_e=de.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:B_e,repeated:!0}]),B_e=de.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),H_e=de.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:de.getEnumType(h_e)}]),V_e=de.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:de.getEnumType(lO)},{no:3,name:"message",kind:"scalar",T:9}]),lO=de.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),q_e=de.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function G_e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var NB,XE={exports:{}},K_e=XE.exports;function z_e(){return NB||(NB=1,t=K_e,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return c??a??s},d.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=f(o.getLevel())),l.call(d),o===d)for(var e in i)i[e].rebuild()},s=f(o?o.getLevel():"WARN");var m=p();null!=m&&(c=f(m)),l.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},(e=XE).exports?e.exports=n():t.log=n()),XE.exports;var e,t,n}var hb,nc,l_=z_e();!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(hb||(hb={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(nc||(nc={}));let kt=l_.getLogger("livekit");const pZ=Object.values(nc).map(e=>l_.getLogger(e));function Tu(e){const t=l_.getLogger(e);return t.setDefaultLevel(kt.getLevel()),t}function mZ(e,t){if(t)l_.getLogger(t).setLevel(e);else for(const t of pZ)t.setLevel(e)}function W_e(e,t){pZ.forEach(t=>{const n=t.methodFactory;t.methodFactory=(t,r,i)=>{const o=n(t,r,i),s=hb[t],a=s>=r&&s<hb.silent;return(t,n)=>{n?o(t,n):o(t),a&&e(s,t,n)}},t.setLevel(t.getLevel())})}kt.setDefaultLevel(hb.info);const Y_e=l_.getLogger("lk-e2ee"),T0=7e3,X_e=[0,300,1200,2700,4800,T0,T0,T0,T0,T0];class gZ{constructor(e){this._retryDelays=void 0!==e?[...e]:X_e}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}}function J_e(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function J(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())})}function UB(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function su(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof UB?UB(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,i,(t=e[n](t)).done,t.value)})}}}var jB,T2={exports:{}};function Q_e(){if(jB)return T2.exports;jB=1;var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}T2.exports=i,T2.exports.once=function(e,t){return new Promise(function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}f(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&f(e,"error",t,n)}(e,i,{once:!0})})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,l;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),l=o[t]),void 0===l)l=o[t]=n,++e._eventsCount;else if("function"==typeof l?l=o[t]=r?[n,l]:[l,n]:r?l.unshift(n):l.push(n),(i=a(e))>0&&l.length>i&&!l.warned){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=l.length,function(e){console&&console.warn&&console.warn(e)}(c)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=c.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function f(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)})}}return Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return a(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var c=l.length,u=p(l,c);for(r=0;r<c;++r)n(u[r],this,t)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){return s(t),this.on(e,u(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,u(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return d(this,e,!0)},i.prototype.rawListeners=function(e){return d(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},T2.exports}var ul=Q_e();let vZ=!0,yZ=!0;function ay(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseFloat(r[n],10)}function bp(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Z_e(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(vZ=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function eSe(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(yZ=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function bZ(){if("object"==typeof window){if(vZ)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function uO(e,t){yZ&&console.warn(e+" is deprecated, please use "+t+" instead.")}function tSe(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find(e=>"Chromium"===e.brand);if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(ay(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(ay(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(ay(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=ay(n.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}function FB(e){return"[object Object]"===Object.prototype.toString.call(e)}function _Z(e){return FB(e)?Object.keys(e).reduce(function(t,n){const r=FB(e[n]),i=r?_Z(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})},{}):e}function RA(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?RA(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(t=>{RA(e,e.get(t),n)})}))}function $B(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&RA(e,n,i)})}),i}const BB=bZ;function SZ(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:("user"===o.exact||"user"===o.ideal)&&(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let s=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!s&&n.length&&t.includes("back")&&(s=n[n.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),BB("chrome: "+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return BB("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,e=>{n.webkitGetUserMedia(e,t,e=>{r&&r(o(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(o(e))))}}}function EZ(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function wZ(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else bp(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function CZ(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function TZ(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>$B(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),bp(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>$B(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function RZ(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function IZ(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return RZ(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>o(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]});const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function IA(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})}function kZ(e,t){bp(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var HB=Object.freeze({__proto__:null,fixNegotiationNeeded:kZ,shimAddTrackRemoveTrack:IZ,shimAddTrackRemoveTrackWithNative:RZ,shimGetSendersWithDtmf:CZ,shimGetUserMedia:SZ,shimMediaStream:EZ,shimOnTrack:wZ,shimPeerConnection:IA,shimSenderReceiverGetStats:TZ});function xZ(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){uO("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function nSe(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function AZ(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kA(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,o)}}function LZ(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function PZ(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),bp(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function OZ(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){uO("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function MZ(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function DZ(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function NZ(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function UZ(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function jZ(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var VB=Object.freeze({__proto__:null,shimAddTransceiver:DZ,shimCreateAnswer:jZ,shimCreateOffer:UZ,shimGetDisplayMedia:nSe,shimGetParameters:NZ,shimGetUserMedia:xZ,shimOnTrack:AZ,shimPeerConnection:kA,shimRTCDataChannel:MZ,shimReceiverGetStats:PZ,shimRemoveStream:OZ,shimSenderGetStats:LZ});function FZ(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function $Z(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function BZ(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=a}function HZ(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(VZ(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function VZ(e){return e&&void 0!==e.video?Object.assign({},e,{video:_Z(e.video)}):e}function qZ(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];void 0===r.urls&&r.url?(uO("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function GZ(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function KZ(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0===e.offerToReceiveAudio&&!t&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0===e.offerToReceiveVideo&&!n&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function zZ(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var GB,qB=Object.freeze({__proto__:null,shimAudioContext:zZ,shimCallbacksAPI:BZ,shimConstraints:VZ,shimCreateOfferLegacy:KZ,shimGetUserMedia:HZ,shimLocalStreamsAPI:FZ,shimRTCIceServerUrls:qZ,shimRemoteStreamsAPI:$Z,shimTrackEventTransceiver:GZ}),Fk={exports:{}};function rSe(){return GB||(GB=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let i=3;i<r.length;i++){const o=r[i],s=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){const r=t.parseRtpMap(s),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{i.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)});let i=0;return n.codecs.forEach(e=>{e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{r+=t.writeExtmap(e)}),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),a=s.length>0&&s[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));c.length>0&&c[0].length>1&&c[0][0]===a&&(l=c[0][1]),r.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&l&&(t.rtx={ssrc:l}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=u})),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}(Fk)),Fk.exports}var WZ=rSe(),Cg=G_e(WZ),iSe=vbe({__proto__:null,default:Cg},[WZ]);function JE(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Cg.parseCandidate(e.candidate);for(const e in r)e in n||Object.defineProperty(n,e,{value:r[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,bp(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function xA(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||bp(e,"icecandidate",e=>{if(e.candidate){const t=Cg.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function QE(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Cg.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Cg.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),r=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Cg.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],e);let i;i=0===n&&0===r?Number.POSITIVE_INFINITY:0===n||0===r?Math.max(n,r):Math.min(n,r);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>i}),this._sctp=o}return n.apply(this,arguments)}}function ZE(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},bp(e,"datachannel",e=>(t(e.channel,e.target),e))}function AA(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function LA(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function ew(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||0===n.length||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function tw(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||0===n.length||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var sSe=Object.freeze({__proto__:null,removeExtmapAllowMixed:LA,shimAddIceCandidateNullOrEmpty:ew,shimConnectionState:AA,shimMaxMessageSize:QE,shimParameterlessSetLocalDescription:tw,shimRTCIceCandidate:JE,shimRTCIceCandidateRelayProtocol:xA,shimSendThrowTypeError:ZE});function oSe(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=bZ,r=tSe(e),i={browserDetails:r,commonShim:sSe,extractVersion:ay,disableLog:Z_e,disableWarnings:eSe,sdp:iSe};switch(r.browser){case"chrome":if(!HB||!IA||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=HB,ew(e,r),tw(e),SZ(e,r),EZ(e),IA(e,r),wZ(e),IZ(e,r),CZ(e),TZ(e),kZ(e,r),JE(e),xA(e),AA(e),QE(e,r),ZE(e),LA(e,r);break;case"firefox":if(!VB||!kA||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=VB,ew(e,r),tw(e),xZ(e,r),kA(e,r),AZ(e),OZ(e),LZ(e),PZ(e),MZ(e),DZ(e),NZ(e),UZ(e),jZ(e),JE(e),AA(e),QE(e,r),ZE(e);break;case"safari":if(!qB||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=qB,ew(e,r),tw(e),qZ(e),KZ(e),BZ(e),FZ(e),$Z(e),GZ(e),HZ(e),zZ(e),JE(e),xA(e),QE(e,r),ZE(e),LA(e,r);break;default:n("Unsupported browser!")}return i}oSe({window:typeof window>"u"?void 0:window});const aSe=10,R0="lk_e2ee",cSe="LKFrameEncryptionKey",lSe={sharedKey:!1,ratchetSalt:cSe,ratchetWindowSize:8,failureTolerance:10,keyringSize:16};var tf,KB,Gd,zB,Bt,Wa,dC,XB,ue,ae,Oe,Re;function YZ(){return uSe()||PA()}function PA(){return typeof window.RTCRtpScriptTransform<"u"}function uSe(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function dSe(e){return J(this,void 0,void 0,function*(){let t=new TextEncoder;return yield crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])})}function fSe(e){return J(this,void 0,void 0,function*(){return yield crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"])})}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(tf||(tf={})),(KB||(KB={})).KeyRatcheted="keyRatcheted",function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(Gd||(Gd={})),(zB||(zB={})).Error="cryptorError";class XZ extends ul.EventEmitter{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.onKeyRatcheted=(e,t,n)=>{kt.debug("key ratcheted event received",{ratchetResult:e,participantId:t,keyIndex:n})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},lSe),e),this.on(tf.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,n){const r={key:e,participantIdentity:t,keyIndex:n};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(n??0),r),this.emit(tf.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(tf.RatchetRequest,e,t)}}class hSe extends XZ{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1}))}setKey(e){return J(this,void 0,void 0,function*(){const t="string"==typeof e?yield dSe(e):yield fSe(e);this.onSetEncryptionKey(t)})}}class Fu extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout"}(Bt||(Bt={}));class _n extends Fu{constructor(e,t,n,r){super(1,e),this.name="ConnectionError",this.status=n,this.reason=t,this.context=r,this.reasonName=Bt[t]}}class dO extends Fu{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class ou extends Fu{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class pSe extends Fu{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class zr extends Fu{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class OA extends Fu{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class WB extends Fu{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class YB extends Fu{constructor(e,t){super(15,e),this.reason=t,this.reasonName="string"==typeof t?t:lO[t]}}!function(e){e[e.AlreadyOpened=0]="AlreadyOpened",e[e.AbnormalEnd=1]="AbnormalEnd",e[e.DecodeFailed=2]="DecodeFailed",e[e.LengthExceeded=3]="LengthExceeded",e[e.Incomplete=4]="Incomplete",e[e.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered"}(Wa||(Wa={}));class jd extends Fu{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=Wa[t]}}function mSe(e){return typeof e>"u"?e:"function"==typeof structuredClone?"object"==typeof e&&null!==e?structuredClone(Object.assign({},e)):structuredClone(e):JSON.parse(JSON.stringify(e))}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(dC||(dC={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(dC||(dC={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(XB||(XB={})),function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.Moved="moved",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.ParticipantActive="participantActive",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(ue||(ue={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackCpuConstrained="localTrackCpuConstrained",e.LocalSenderCreated="localSenderCreated",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.TrackCpuConstrained="trackCpuConstrained",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage",e.Active="active"}(ae||(ae={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected",e.RoomMoved="roomMoved"}(Oe||(Oe={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.CpuConstrained="cpuConstrained",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate",e.PreConnectBufferFlushed="preConnectBufferFlushed"}(Re||(Re={}));const gSe=/version\/(\d+(\.?_?\d+)+)/i;let $k;function wo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(void 0===$k||t){const e=vSe.find(e=>{let{test:t}=e;return t.test(n)});$k=null==e?void 0:e.describe(n)}return $k}const vSe=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:nw(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Bk(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:nw(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Bk(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:nw(gSe,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:Bk(e)})}];function nw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=t.match(e);return r&&r.length>=n&&r[n]||""}function Bk(e){return e.includes("mac os")?nw(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}var ySe="2.15.5";const bSe=ySe,_Se=16;class Ni{}Ni.setTimeout=function(){return setTimeout(...arguments)},Ni.setInterval=function(){return setInterval(...arguments)},Ni.clearTimeout=function(){return clearTimeout(...arguments)},Ni.clearInterval=function(){return clearInterval(...arguments)};const SSe=5e3,I0=[];var _o;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(_o||(_o={}));let he=class e extends ul.EventEmitter{constructor(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=e.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=kt,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),SSe):this.handleAppVisibilityChanged()},this.log=Tu(null!==(i=r.loggerName)&&void 0!==i?i:nc.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=e.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Lt(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===e.Kind.Video&&(n="video"),0===this.attachedElements.length&&this.kind===e.Kind.Video&&this.addAppVisibilityListener(),t||("audio"===n&&(I0.forEach(e=>{null===e.parentElement&&!t&&(t=e)}),t&&I0.splice(I0.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),ig(this.mediaStreamTrack,t);const r=t.srcObject.getTracks(),i=r.some(e=>"audio"===e.kind);return t.play().then(()=>{this.emit(i?Re.AudioPlaybackStarted:Re.VideoPlaybackStarted)}).catch(e=>{"NotAllowedError"===e.name?this.emit(i?Re.AudioPlaybackFailed:Re.VideoPlaybackFailed,e):"AbortError"===e.name?kt.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):kt.warn("could not playback ".concat(i?"audio":"video"),e),i&&t&&r.some(e=>"video"===e.kind)&&"NotAllowedError"===e.name&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(Re.ElementAttached,t),t}detach(e){try{if(e){Tg(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(Re.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(e=>{Tg(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(Re.ElementDetached,e)}),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Tu(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),I0.forEach(e=>{e.parentElement||(t=!1)}),t&&I0.push(e)}}handleAppVisibilityChanged(){return J(this,void 0,void 0,function*(){this.isInBackground="hidden"===document.visibilityState,!this.isInBackground&&this.kind===e.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Us()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Us()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}};function ig(e,t){let n,r;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,r="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),r.includes(e)||(r.forEach(e=>{n.removeTrack(e)}),n.addTrack(e)),Zh()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(Zh()||tv())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function Tg(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){let t;var n;let r,i;(n=t=e.Kind||(e.Kind={})).Audio="audio",n.Video="video",n.Unknown="unknown",function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(r=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return Ka.AUDIO;case t.Video:return Ka.VIDEO;default:return Ka.DATA}},e.kindFromProto=function(e){switch(e){case Ka.AUDIO:return t.Audio;case Ka.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case r.Camera:return Ur.CAMERA;case r.Microphone:return Ur.MICROPHONE;case r.ScreenShare:return Ur.SCREEN_SHARE;case r.ScreenShareAudio:return Ur.SCREEN_SHARE_AUDIO;default:return Ur.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case Ur.CAMERA:return r.Camera;case Ur.MICROPHONE:return r.Microphone;case Ur.SCREEN_SHARE:return r.ScreenShare;case Ur.SCREEN_SHARE_AUDIO:return r.ScreenShareAudio;default:return r.Unknown}},e.streamStateFromProto=function(e){switch(e){case wA.ACTIVE:return i.Active;case wA.PAUSED:return i.Paused;default:return i.Unknown}}}(he||(he={}));class bn{constructor(e,t,n,r,i){if("object"==typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:r,priority:i}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const ESe=["vp8","h264"],wSe=["vp8","h264","vp9","av1","h265"];function CSe(e){return!!ESe.find(t=>t===e)}var JB,fC;!function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"}(JB||(JB={})),function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}(fC||(fC={}));const zc={h90:new bn(160,90,9e4,20),h180:new bn(320,180,16e4,20),h216:new bn(384,216,18e4,20),h360:new bn(640,360,45e4,20),h540:new bn(960,540,8e5,25),h720:new bn(1280,720,17e5,30),h1080:new bn(1920,1080,3e6,30),h1440:new bn(2560,1440,5e6,30),h2160:new bn(3840,2160,8e6,30)},MA={h120:new bn(160,120,7e4,20),h180:new bn(240,180,125e3,20),h240:new bn(320,240,14e4,20),h360:new bn(480,360,33e4,20),h480:new bn(640,480,5e5,20),h540:new bn(720,540,6e5,25),h720:new bn(960,720,13e5,30),h1080:new bn(1440,1080,23e5,30),h1440:new bn(1920,1440,38e5,30)},eT={h360fps3:new bn(640,360,2e5,3,"medium"),h360fps15:new bn(640,360,4e5,15,"medium"),h720fps5:new bn(1280,720,8e5,5,"medium"),h720fps15:new bn(1280,720,15e5,15,"medium"),h720fps30:new bn(1280,720,2e6,30,"medium"),h1080fps15:new bn(1920,1080,25e5,15,"medium"),h1080fps30:new bn(1920,1080,5e6,30,"medium"),original:new bn(0,0,7e6,30,"medium")},TSe="|",QB="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function RSe(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}function Bs(e){return J(this,void 0,void 0,function*(){return new Promise(t=>Ni.setTimeout(t,e))})}function DA(){return"addTransceiver"in RTCPeerConnection.prototype}function NA(){return"addTrack"in RTCPeerConnection.prototype}function ISe(){if(!("getCapabilities"in RTCRtpSender)||Zh())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}function kSe(){if(!("getCapabilities"in RTCRtpSender)||tv())return!1;if(Zh()){const e=wo();if(null!=e&&e.version&&nl(e.version,"16")<0||"iOS"===(null==e?void 0:e.os)&&null!=e&&e.osVersion&&nl(e.osVersion,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}function qc(e){return"av1"===e||"vp9"===e}function UA(e){return!(!document||hC())&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function xSe(){return!(typeof RTCPeerConnection>"u")&&(DA()||NA())}function tv(){var e;return"Firefox"===(null===(e=wo())||void 0===e?void 0:e.name)}function Zh(){var e;return"Safari"===(null===(e=wo())||void 0===e?void 0:e.name)}function hC(){const e=wo();return"Safari"===(null==e?void 0:e.name)||"iOS"===(null==e?void 0:e.os)}function ASe(){const e=wo();return"Safari"===(null==e?void 0:e.name)&&e.version.startsWith("17.")||"iOS"===(null==e?void 0:e.os)&&!(null==e||!e.osVersion)&&nl(e.osVersion,"17")>=0}function LSe(e){return e||(e=wo()),"Safari"===(null==e?void 0:e.name)&&nl(e.version,"18.3")>0||"iOS"===(null==e?void 0:e.os)&&!(null==e||!e.osVersion)&&nl(e.osVersion,"18.3")>0}function JZ(){var e,t;return!!Us()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function PSe(){const e=wo(),t="17.2";if(e)return!!("Safari"!==e.name&&"iOS"!==e.os||"iOS"===e.os&&e.osVersion&&nl(t,e.osVersion)>=0)||"Safari"===e.name&&nl(t,e.version)>=0}function Us(){return typeof document<"u"}function tl(){return"ReactNative"==navigator.product}function jA(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function QZ(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function ZZ(){if(!tl())return;let e=QZ();return e?e.platform:void 0}function ZB(){if(Us())return window.devicePixelRatio;if(tl()){let e=QZ();if(e)return e.devicePixelRatio}return 1}function nl(e,t){const n=e.split("."),r=t.split("."),i=Math.min(n.length,r.length);for(let e=0;e<i;++e){const t=parseInt(n[e],10),o=parseInt(r[e],10);if(t>o)return 1;if(t<o)return-1;if(e===i-1&&t===o)return 0}return""===e&&""!==t?-1:""===t?1:n.length==r.length?0:n.length<r.length?-1:1}function OSe(e){for(const t of e)t.target.handleResize(t)}function MSe(e){for(const t of e)t.target.handleVisibilityChanged(t)}let Hk=null;const eH=()=>(Hk||(Hk=new ResizeObserver(OSe)),Hk);let Vk=null;const tH=()=>(Vk||(Vk=new IntersectionObserver(MSe,{root:null,rootMargin:"0px"})),Vk);function DSe(){var e;const t=new __e({sdk:QQ.JS,protocol:16,version:bSe});return tl()&&(t.os=null!==(e=ZZ())&&void 0!==e?e:""),t}function nH(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=document.createElement("canvas");i.width=e,i.height=t;const o=i.getContext("2d");null==o||o.fillRect(0,0,i.width,i.height),r&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,2*Math.PI,!0),o.closePath(),o.fillStyle="grey",o.fill());const s=i.captureStream(),[a]=s.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let k0;function qk(){if(!k0){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const r=e.createMediaStreamDestination();if(t.connect(n),n.connect(r),t.start(),[k0]=r.stream.getAudioTracks(),!k0)throw Error("Could not get empty media stream audio track");k0.enabled=!1}return k0.clone()}class Wc{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise((t,n)=>J(this,void 0,void 0,function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})).finally(()=>{var e;this._isResolved=!0,null===(e=this.onFinally)||void 0===e||e.call(this)})}}function NSe(e){return wSe.includes(e)}function nf(e){if("string"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))return e[0];if(void 0!==e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(void 0!==e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function USe(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}function FA(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function jSe(e,t){return e.segments.map(e=>{let{id:n,text:r,language:i,startTime:o,endTime:s,final:a}=e;var l;const c=null!==(l=t.get(n))&&void 0!==l?l:Date.now(),u=Date.now();return a?t.delete(n):t.set(n,c),{id:n,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(s.toString()),final:a,language:i,firstReceivedTime:c,lastReceivedTime:u}})}function FSe(e){const{id:t,timestamp:n,message:r,editTimestamp:i}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}function rH(e){switch(e.reason){case Bt.LeaveRequest:return e.context;case Bt.Cancelled:return Xa.CLIENT_INITIATED;case Bt.NotAllowed:return Xa.USER_REJECTED;case Bt.ServerUnreachable:return Xa.JOIN_FAILURE;default:return Xa.UNKNOWN_REASON}}function rw(e){return void 0!==e?Number(e):void 0}function Th(e){return void 0!==e?BigInt(e):void 0}function $h(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function Jc(e){return!!e&&e.kind==he.Kind.Audio}function _p(e){return!!e&&e.kind==he.Kind.Video}function Sd(e){return $h(e)&&_p(e)}function Bl(e){return $h(e)&&Jc(e)}function $A(e){return!!e&&!e.isLocal}function $Se(e){return!!e&&!e.isLocal}function Gk(e){return $A(e)&&_p(e)}function BSe(e){return e.isLocal}function HSe(e,t){const n=[];let r=(new TextEncoder).encode(e);for(;r.length>t;){let e=t;for(;e>0;){const t=r[e];if(void 0!==t&&128!=(192&t))break;e--}n.push(r.slice(0,e)),r=r.slice(e)}return r.length>0&&n.push(r),n}function eee(e,t,n){var r,i,o,s;const{optionsWithoutProcessor:a,audioProcessor:l,videoProcessor:c}=ree(e??{}),u=null==t?void 0:t.processor,d=null==n?void 0:n.processor,h=a??{};return!0===h.audio&&(h.audio={}),!0===h.video&&(h.video={}),h.audio&&(BA(h.audio,t),null!==(r=(o=h.audio).deviceId)&&void 0!==r||(o.deviceId={ideal:"default"}),(l||u)&&(h.audio.processor=l??u)),h.video&&(BA(h.video,n),null!==(i=(s=h.video).deviceId)&&void 0!==i||(s.deviceId={ideal:"default"}),(c||d)&&(h.video.processor=c??d)),h}function BA(e,t){return Object.keys(t).forEach(n=>{void 0===e[n]&&(e[n]=t[n])}),e}function fO(e){var t,n,r,i;const o={};if(e.video)if("object"==typeof e.video){const n={},i=n,s=e.video;Object.keys(s).forEach(e=>{if("resolution"===e)BA(i,s.resolution);else i[e]=s[e]}),o.video=n,null!==(t=(r=o.video).deviceId)&&void 0!==t||(r.deviceId={ideal:"default"})}else o.video=!!e.video&&{deviceId:{ideal:"default"}};else o.video=!1;return e.audio?"object"==typeof e.audio?(o.audio=e.audio,null!==(n=(i=o.audio).deviceId)&&void 0!==n||(i.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function tee(e){return J(this,arguments,void 0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=nee();if(n){const r=n.createAnalyser();r.fftSize=2048;const i=r.frequencyBinCount,o=new Uint8Array(i);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Bs(t),r.getByteTimeDomainData(o);const s=o.some(e=>128!==e&&0!==e);return n.close(),!s}return!1}()})}function nee(){var e;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if("suspended"===n.state&&typeof window<"u"&&null!==(e=window.document)&&void 0!==e&&e.body){const e=()=>J(this,void 0,void 0,function*(){var t;try{"suspended"===n.state&&(yield n.resume())}catch(e){console.warn("Error trying to auto-resume audio context",e)}null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e)});window.document.body.addEventListener("click",e)}return n}}function VSe(e){return"audioinput"===e?he.Source.Microphone:"videoinput"===e?he.Source.Camera:he.Source.Unknown}function HA(e){return e===he.Source.Microphone?"audioinput":e===he.Source.Camera?"videoinput":void 0}function qSe(e){var t,n;let r=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(r="boolean"==typeof r?{}:r,r=Zh()?Object.assign(Object.assign({},r),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},r),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:r,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function iw(e){return e.split("/")[1].toLowerCase()}function GSe(e){const t=[];return e.forEach(e=>{void 0!==e.track&&t.push(new aO({cid:e.track.mediaStreamID,track:e.trackInfo}))}),t}function Lt(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?Lt(e.track):{})}}function KSe(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function zSe(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const r=[...Object.keys(t),...Object.keys(e)],i={};for(const o of r)e[o]!==t[o]&&(i[o]=null!==(n=t[o])&&void 0!==n?n:"");return i}function ree(e){const t=Object.assign({},e);let n,r;return"object"==typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"==typeof t.video&&t.video.processor&&(r=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:r,optionsWithoutProcessor:mSe(t)}}function WSe(e){switch(e){case Ur.CAMERA:return he.Source.Camera;case Ur.MICROPHONE:return he.Source.Microphone;case Ur.SCREEN_SHARE:return he.Source.ScreenShare;case Ur.SCREEN_SHARE_AUDIO:return he.Source.ScreenShareAudio;default:return he.Source.Unknown}}function iH(e,t){return e.width*e.height<t.width*t.height}function YSe(e,t){var n;return null===(n=e.layers)||void 0===n?void 0:n.find(e=>e.quality===t)}class XSe extends ul.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:r,data:i}=e.data;switch(r){case"error":kt.error(i.error.message),this.emit(Gd.EncryptionError,i.error);break;case"initAck":i.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)});break;case"enable":if(i.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)}),this.encryptionEnabled!==i.enabled&&i.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(Gd.ParticipantEncryptionStatusChanged,i.enabled,this.room.localParticipant),this.encryptionEnabled=i.enabled;else if(i.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(i.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(i.participantIdentity));this.emit(Gd.ParticipantEncryptionStatusChanged,i.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(tf.KeyRatcheted,i.ratchetResult,i.participantIdentity,i.keyIndex)}},this.onWorkerError=e=>{kt.error("e2ee worker encountered an error:",{error:e.error}),this.emit(Gd.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!YZ())throw new dO("tried to setup end-to-end encryption on an unsupported browser");if(kt.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Y_e.getLevel()}};this.worker&&(kt.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){kt.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):kt.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(Oe.RTPVideoMapUpdate,e=>{this.postRTPMap(e)})}setupEventListeners(e,t){e.on(ue.TrackPublished,(e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==yo.NONE,t.identity)),e.on(ue.ConnectionStateChanged,t=>{t===Pt.Connected&&e.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==yo.NONE,e.identity)})})}).on(ue.TrackUnsubscribed,(e,t,n)=>{var r;const i={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(r=this.worker)||void 0===r||r.postMessage(i)}).on(ue.TrackSubscribed,(e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)}).on(ue.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(e=>{this.postKey(e)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ae.LocalSenderCreated,(e,t)=>J(this,void 0,void 0,function*(){this.setupE2EESender(t,e)})),t.on(tf.SetKey,e=>this.postKey(e)).on(tf.RatchetRequest,(e,t)=>this.postRatchetRequest(e,t))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:r}=e;var i;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity),key:t,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(null===(t=this.room)||void 0===t||!t.localParticipant.identity)throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(null==n||!n.mimeType||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?iw(n.mimeType):void 0)}}setupE2EESender(e,t){$h(e)&&t?this.handleSender(t,e.mediaStreamID,void 0):t||kt.warn("early return because sender is not ready")}handleReceiver(e,t,n,r){return J(this,void 0,void 0,function*(){if(this.worker){if(PA()){const i={kind:"decode",participantIdentity:n,trackId:t,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{if(R0 in e&&r){const e={kind:"updateCodec",data:{trackId:t,codec:r,participantIdentity:n}};return void this.worker.postMessage(e)}let i=e.writableStream,o=e.readableStream;if(!i||!o){const t=e.createEncodedStreams();e.writableStream=t.writable,i=t.writable,e.readableStream=t.readable,o=t.readable}const s={kind:"decode",data:{readableStream:o,writableStream:i,trackId:t,codec:r,participantIdentity:n,isReuse:R0 in e}};this.worker.postMessage(s,[o,i])}e[R0]=!0}})}handleSender(e,t,n){var r;if(!(R0 in e)&&this.worker){if(null===(r=this.room)||void 0===r||!r.localParticipant.identity||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(PA()){kt.info("initialize script transform");const r={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{kt.info("initialize encoded streams");const r=e.createEncodedStreams(),i={kind:"encode",data:{readableStream:r.readable,writableStream:r.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(i,[r.readable,r.writable])}e[R0]=!0}}}const Kk="default";class _i{constructor(){this._previousDevices=[]}static getInstance(){return void 0===this.instance&&(this.instance=new _i),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return J(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r;if((null===(r=_i.userMediaPromiseMap)||void 0===r?void 0:r.size)>0){kt.debug("awaiting getUserMedia promise");try{e?yield _i.userMediaPromiseMap.get(e):yield Promise.all(_i.userMediaPromiseMap.values())}catch{kt.warn("error waiting for media permissons")}}let i=yield navigator.mediaDevices.enumerateDevices();if(n&&(!Zh()||!t.hasDeviceInUse(e))&&(0===i.filter(t=>t.kind===e).length||i.some(t=>{const n=""===t.label,r=!e||t.kind===e;return n&&r}))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e&&{deviceId:{ideal:"default"}}},n=yield navigator.mediaDevices.getUserMedia(t);i=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach(e=>{e.stop()})}return t._previousDevices=i,e&&(i=i.filter(t=>t.kind===e)),i}()})}normalizeDeviceId(e,t,n){return J(this,void 0,void 0,function*(){if(t!==Kk)return t;const r=yield this.getDevices(e),i=r.find(e=>e.deviceId===Kk);if(!i)return void kt.warn("could not reliably determine default device");const o=r.find(e=>e.deviceId!==Kk&&e.groupId===(n??i.groupId));if(o)return null==o?void 0:o.deviceId;kt.warn("could not reliably determine default device")})}hasDeviceInUse(e){return e?_i.userMediaPromiseMap.has(e):_i.userMediaPromiseMap.size>0}}var Ry;_i.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],_i.userMediaPromiseMap=new Map,function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Ry||(Ry={}));class JSe{constructor(){this.pendingTasks=new Map,this.taskMutex=new ds,this.nextTaskIndex=0}run(e){return J(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ry.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Ry.RUNNING,yield e()}finally{t.status=Ry.COMPLETED,this.pendingTasks.delete(t.id),n()}})}flush(){return J(this,void 0,void 0,function*(){return this.run(()=>J(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function QSe(e,t){const n=new URL(USe(e));return t.forEach((e,t)=>{n.searchParams.set(t,e)}),iee(n,"rtc")}function ZSe(e){return iee(new URL(FA(e)),"validate")}function e2e(e){return e.endsWith("/")?e:"".concat(e,"/")}function iee(e,t){return e.pathname="".concat(e2e(e.pathname)).concat(t),e.toString()}const t2e=["syncState","trickle","offer","answer","simulate","leave"];function n2e(e){const t=t2e.indexOf(e.case)>=0;return kt.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}var jn;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(jn||(jn={}));class hO{get currentState(){return this.state}get isDisconnected(){return this.state===jn.DISCONNECTING||this.state===jn.DISCONNECTED}get isEstablishingConnection(){return this.state===jn.CONNECTING||this.state===jn.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=jn.DISCONNECTED,this.log=kt,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Tu(null!==(n=t.loggerName)&&void 0!==n?n:nc.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new JSe,this.queuedRequests=[],this.closingLock=new ds,this.connectionLock=new ds,this.state=jn.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,r){return J(this,void 0,void 0,function*(){return this.state=jn.CONNECTING,this.options=n,yield this.connect(e,t,n,r)})}reconnect(e,t,n,r){return J(this,void 0,void 0,function*(){if(this.options)return this.state=jn.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:r}));this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext)})}connect(e,t,n,r){this.connectOptions=n;const i=QSe(e,r2e(t,DSe(),n)),o=ZSe(i);return new Promise((e,t)=>J(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();try{const s=()=>J(this,void 0,void 0,function*(){this.close(),clearTimeout(a),t(new _n("room connection has been cancelled (signal)",Bt.Cancelled))}),a=setTimeout(()=>{this.close(),t(new _n("room connection has timed out (signal)",Bt.ServerUnreachable))},n.websocketTimeout);null!=r&&r.aborted&&s(),null==r||r.addEventListener("abort",s);const l=new URL(i);l.searchParams.has("access_token")&&l.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(l),Object.assign({reconnect:n.reconnect,reconnectReason:n.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(i),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(a)},this.ws.onerror=e=>J(this,void 0,void 0,function*(){if(this.state===jn.CONNECTED)this.handleWSError(e);else{this.state=jn.DISCONNECTED,clearTimeout(a);try{const n=yield fetch(o);if(n.status.toFixed(0).startsWith("4")){const e=yield n.text();t(new _n(e,Bt.NotAllowed,n.status))}else t(new _n("Encountered unknown websocket error during connection: ".concat(e.toString()),Bt.InternalError,n.status))}catch(e){t(new _n(e instanceof Error?e.message:"server was not reachable",Bt.ServerUnreachable))}}}),this.ws.onmessage=i=>J(this,void 0,void 0,function*(){var o,a,l;let c;if("string"==typeof i.data){const e=JSON.parse(i.data);c=DB.fromJson(e,{ignoreUnknownFields:!0})}else{if(!(i.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof i.data),this.logContext);c=DB.fromBinary(new Uint8Array(i.data))}if(this.state!==jn.CONNECTED){let i=!1;if("join"===(null===(o=c.message)||void 0===o?void 0:o.case)?(this.state=jn.CONNECTED,null==r||r.removeEventListener("abort",s),this.pingTimeoutDuration=c.message.value.pingTimeout,this.pingIntervalDuration=c.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),e(c.message.value)):this.state===jn.RECONNECTING&&"leave"!==c.message.case?(this.state=jn.CONNECTED,null==r||r.removeEventListener("abort",s),this.startPingInterval(),"reconnect"===(null===(a=c.message)||void 0===a?void 0:a.case)?e(c.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),e(void 0),i=!0)):this.isEstablishingConnection&&"leave"===c.message.case?t(new _n("Received leave request while trying to (re)connect",Bt.LeaveRequest,void 0,c.message.value.reason)):n.reconnect||t(new _n("did not receive join response, got ".concat(null===(l=c.message)||void 0===l?void 0:l.case," instead"),Bt.InternalError)),!i)return}this.signalLatency&&(yield Bs(this.signalLatency)),this.handleSignalResponse(c)}),this.ws.onclose=e=>{this.isEstablishingConnection&&t(new _n("Websocket got closed during a (re)connection attempt",Bt.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:this.state})),this.handleOnClose(e.reason)}}finally{s()}}))}close(){return J(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=jn.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise(t=>{e.ws?e.ws.onclose=()=>{t()}:t()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,Bs(250)])),e.ws=void 0}}finally{t&&(e.state=jn.DISCONNECTED),n()}}()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:pC(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:pC(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new sO({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new oO({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return J(this,arguments,void 0,function(e,t){var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const i=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new oZ({requestId:i,metadata:e,name:t,attributes:r})}),i}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new sZ({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new lZ({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Jn.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new hZ({timestamp:Jn.parse(Date.now()),rtt:Jn.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new iZ({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new Z3({reason:Xa.CLIENT_INITIATED,action:wg.DISCONNECT})})}sendRequest(e){return J(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){if(!n&&!n2e(e)&&t.state===jn.RECONNECTING)return void t.queuedRequests.push(()=>J(t,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield Bs(t.signalLatency)),t.isDisconnected)return void t.log.debug("skipping signal request (type: ".concat(e.case,") - SignalClient disconnected"));if(!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.case),t.logContext);const r=new w_e({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(e){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:e}))}}()})}handleSignalResponse(e){var t,n;const r=e.message;if(null==r)return void this.log.debug("received unsupported message",this.logContext);let i=!1;if("answer"===r.case){const e=sH(r.value);this.onAnswer&&this.onAnswer(e,r.value.id)}else if("offer"===r.case){const e=sH(r.value);this.onOffer&&this.onOffer(e,r.value.id)}else if("trickle"===r.case){const e=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(e,r.value.target)}else"update"===r.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=r.value.participants)&&void 0!==t?t:[]):"trackPublished"===r.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):"speakersChanged"===r.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=r.value.speakers)&&void 0!==n?n:[]):"leave"===r.case?this.onLeave&&this.onLeave(r.value):"mute"===r.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):"roomUpdate"===r.case?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):"connectionQuality"===r.case?this.onConnectionQuality&&this.onConnectionQuality(r.value):"streamStateUpdate"===r.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):"subscribedQualityUpdate"===r.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):"subscriptionPermissionUpdate"===r.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):"refreshToken"===r.case?this.onTokenRefresh&&this.onTokenRefresh(r.value):"trackUnpublished"===r.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):"subscriptionResponse"===r.case?this.onSubscriptionError&&this.onSubscriptionError(r.value):"pong"===r.case||("pongResp"===r.case?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),i=!0):"requestResponse"===r.case?this.onRequestResponse&&this.onRequestResponse(r.value):"trackSubscribed"===r.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):"roomMoved"===r.case?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));i||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return J(this,void 0,void 0,function*(){if(this.state===jn.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Ni.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Ni.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Ni.setInterval(()=>{this.sendPing()},1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ni.clearInterval(this.pingInterval)}}function sH(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function pC(e,t){return new Qh({sdp:e.sdp,type:e.type,id:t})}function r2e(e,t,n){var r;const i=new URLSearchParams;return i.set("access_token",e),n.reconnect&&(i.set("reconnect","1"),n.sid&&i.set("sid",n.sid)),i.set("auto_subscribe",n.autoSubscribe?"1":"0"),i.set("sdk",tl()?"reactnative":"js"),i.set("version",t.version),i.set("protocol",t.protocol.toString()),t.deviceModel&&i.set("device_model",t.deviceModel),t.os&&i.set("os",t.os),t.osVersion&&i.set("os_version",t.osVersion),t.browser&&i.set("browser",t.browser),t.browserVersion&&i.set("browser_version",t.browserVersion),n.adaptiveStream&&i.set("adaptive_stream","1"),n.reconnectReason&&i.set("reconnect_reason",n.reconnectReason.toString()),!(null===(r=navigator.connection)||void 0===r)&&r.type&&i.set("network",navigator.connection.type),i}class oH{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class i2e{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const n=Date.now();n-this._lastCleanup>this.ttl/2&&this.cleanup();const r=n+this.ttl;return this._map.set(e,{value:t,expiresAt:r}),this}get(e){const t=this._map.get(e);if(t)return t.expiresAt<Date.now()?void this._map.delete(e):t.value}has(e){const t=this._map.get(e);return!!t&&(!(t.expiresAt<Date.now())||(this._map.delete(e),!1))}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,n]of this._map.entries())n.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e(n.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],n=this.asValueMap();for(const[r,i]of n.entries())t.push(e(i,r,n));return t}asValueMap(){const e=new Map;for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e.set(t,n.value);return e}}var aH,cH,Yk,lH,uH,Pa={},zk={},Wk={exports:{}};function pO(){if(aH)return Wk.exports;aH=1;var e=Wk.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){e[t].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),Wk.exports}function s2e(){return cH||(cH=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,r){var i=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:i&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:i?n[e.name]:n;(function(e,n,r,i){if(i&&!r)n[i]=t(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(n[r[o]]=t(e[o+1]))})(r.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},r=pO(),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),s=o[o.length-1]);for(var a=0;a<(r[t]||[]).length;a+=1){var l=r[t][a];if(l.reg.test(i))return n(l,s,i)}}),t.media=o,t};var o=function(e,n){var r=n.split(/=(.+)/,2);return 2===r.length?e[r[0]]=t(r[1]):1===r.length&&n.length>1&&(e[r[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],r=e.split(" ").map(t),i=0;i<r.length;i+=3)n.push({component:r[i],ip:r[i+1],port:r[i+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,r=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),r=!0),{scid:n,paused:r}})})}}(zk)),zk}function o2e(){if(lH)return Yk;lH=1;var e=pO(),t=/%[sdv%]/g,n=function(e){var n=1,r=arguments,i=r.length;return e.replace(t,function(e){if(n>=i)return e;var t=r[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},r=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?i.push(r[t.name][s]):i.push(r[t.names[o]])}else i.push(r[t.name]);return n.apply(null,i)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return Yk=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var s=n.outerOrder||i,a=n.innerOrder||o,l=[];return s.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?l.push(r(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){l.push(r(n,e,t))})})}),t.media.forEach(function(t){l.push(r("m",e.m[0],t)),a.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?l.push(r(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){l.push(r(n,e,t))})})})}),l.join("\r\n")+"\r\n"}}function a2e(){if(uH)return Pa;uH=1;var e=s2e(),t=o2e(),n=pO();return Pa.grammar=n,Pa.write=t,Pa.parse=e.parse,Pa.parseParams=e.parseParams,Pa.parseFmtpConfig=e.parseFmtpConfig,Pa.parsePayloads=e.parsePayloads,Pa.parseRemoteCandidates=e.parseRemoteCandidates,Pa.parseImageAttributes=e.parseImageAttributes,Pa.parseSimulcastStreamList=e.parseSimulcastStreamList,Pa}var xd=a2e();function mO(e,t,n){var r,i,o;void 0===t&&(t=50),void 0===n&&(n={});var s=null!=(r=n.isImmediate)&&r,a=null!=(i=n.callback)&&i,l=n.maxWait,c=Date.now(),u=[];var d=function(){var n=[].slice.call(arguments),r=this;return new Promise(function(i,d){var h=s&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,c=Date.now(),!s){var t=e.apply(r,n);a&&a(t),u.forEach(function(e){return(0,e.resolve)(t)}),u=[]}},function(){if(void 0!==l){var e=Date.now()-c;if(e+t>=l)return l-e}return t}()),h){var p=e.apply(r,n);return a&&a(p),i(p)}u.push({resolve:i,reject:d})})};return d.cancel=function(e){void 0!==o&&clearTimeout(o),u.forEach(function(t){return(0,t.reject)(e)}),u=[]},d}const c2e=.7,l2e=20,Rg={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class dH extends ul.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=kt,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=mO(e=>J(this,void 0,void 0,function*(){this.emit(Rg.NegotiationStarted);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Tu(null!==(n=t.loggerName)&&void 0!==n?n:nc.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new ds}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return J(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return J(this,void 0,void 0,function*(){var n;if("answer"===e.type&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let r;if("offer"===e.type){let{stereoMids:t,nackMids:n}=u2e(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const t=xd.parse(null!==(n=e.sdp)&&void 0!==n?n:"");t.media.forEach(e=>{"audio"===e.type&&this.trackBitrates.some(t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;let r=!1;for(const i of e.fmtp)if(i.payload===n){i.config=i.config.split(";").filter(e=>!e.includes("maxaveragebitrate")).join(";"),t.maxbr>0&&(i.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),r=!0;break}return r||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0})}),r=xd.write(t)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(e=>{this.pc.addIceCandidate(e)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):"answer"===e.type&&(this.emit(Rg.NegotiationComplete),e.sdp&&xd.parse(e.sdp).media.forEach(e=>{"video"===e.type&&this.emit(Rg.RTPVideoPayloadTypes,e.rtp)})),!0})}createAndSendOffer(e){return J(this,void 0,void 0,function*(){var t;const n=yield this.offerLock.lock();try{if(void 0===this.onOffer)return;if(null!=e&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(null==e||!e.iceRestart||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=this.latestOfferId+1;this.latestOfferId=n;const r=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const i=xd.parse(null!==(t=r.sdp)&&void 0!==t?t:"");if(i.media.forEach(e=>{hH(e),"audio"===e.type?fH(e,[],[]):"video"===e.type&&this.trackBitrates.some(t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n||(qc(t.codec)&&!Zh()&&this.ensureVideoDDExtensionForSVC(e,i),"av1"!==t.codec))return!0;const r=Math.round(.7*t.maxbr);for(const t of e.fmtp)if(t.payload===n){t.config.includes("x-google-start-bitrate")||(t.config+=";x-google-start-bitrate=".concat(r));break}return!0})}),this.latestOfferId>n)return void this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:n}));yield this.setMungedSDP(r,xd.write(i)),this.onOffer(r,this.latestOfferId)}finally{n()}})}createAndSetAnswer(){return J(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),n=xd.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach(e=>{hH(e),"audio"===e.type&&fH(e,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,xd.write(n)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new zr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new zr("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!(null===(e=this._pc)||void 0===e||!e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return J(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const n=new Map,r=new Map;if((yield this._pc.getStats()).forEach(e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":r.set(e.id,"".concat(e.address,":").concat(e.port))}}),""===t)return;const i=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==i?r.get(i):void 0})}setMungedSDP(e,t,n){return J(this,void 0,void 0,function*(){if(t){const r=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(n){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:n,sdp:t})),e.sdp=r}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(t){let r="unknown error";t instanceof Error?r=t.message:"string"==typeof t&&(r=t);const i={error:r,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(i.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:i})),new OA(r)}})}ensureVideoDDExtensionForSVC(e,t){var n,r;if(!(null===(n=e.ext)||void 0===n?void 0:n.some(e=>e.uri===QB))){if(0===this.ddExtID){let e=0;t.media.forEach(t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach(t=>{t.value>e&&(e=t.value)}))}),this.ddExtID=e+1}null===(r=e.ext)||void 0===r||r.push({value:this.ddExtID,uri:QB})}}}function fH(e,t,n){let r=0;e.rtp.some(e=>"opus"===e.codec&&(r=e.payload,!0)),r>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some(e=>e.payload===r&&"nack"===e.type)&&e.rtcpFb.push({payload:r,type:"nack"}),t.includes(e.mid)&&e.fmtp.some(e=>e.payload===r&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0)))}function u2e(e){var t;const n=[],r=[],i=xd.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let o=0;return i.media.forEach(e=>{var t;"audio"===e.type&&(e.rtp.some(e=>"opus"===e.codec&&(o=e.payload,!0)),!(null===(t=e.rtcpFb)||void 0===t)&&t.some(e=>e.payload===o&&"nack"===e.type)&&r.push(e.mid),e.fmtp.some(t=>t.payload===o&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0)))}),{stereoMids:n,nackMids:r}}function hH(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}const VA="vp8",d2e={audioPreset:fC.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:eT.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:VA,backupCodec:!0,preConnectBuffer:!1},see={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},oee={deviceId:{ideal:"default"},resolution:zc.h720.resolution},f2e={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new gZ,disconnectOnPageLeave:!0,webAudioMix:!1},gO={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var pr;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(pr||(pr={}));class h2e{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var r;this.peerConnectionTimeout=gO.peerConnectionTimeout,this.log=kt,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map(e=>e.getConnectionState());n.every(e=>"connected"===e)?this.state=pr.CONNECTED:n.some(e=>"failed"===e)?this.state=pr.FAILED:n.some(e=>"connecting"===e)?this.state=pr.CONNECTING:n.every(e=>"closed"===e)?this.state=pr.CLOSED:n.some(e=>"closed"===e)?this.state=pr.CLOSING:n.every(e=>"new"===e)&&(this.state=pr.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(pr[t]," to ").concat(pr[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Tu(null!==(r=n.loggerName)&&void 0!==r?r:nc.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new dH(e,n),this.subscriber=new dH(e,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,za.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,za.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=(e,t)=>{var n;null===(n=this.onPublisherOffer)||void 0===n||n.call(this,e,t)},this.state=pr.NEW,this.connectionLock=new ds,this.remoteOfferLock=new ds}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return J(this,void 0,void 0,function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return J(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return J(this,void 0,void 0,function*(){t===za.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return J(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,t))?yield this.subscriber.createAndSetAnswer():void 0}finally{n()}})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return J(this,void 0,void 0,function*(){var n;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map(n=>this.ensureTransportConnected(n,e,t)))}finally{r()}})}negotiate(e){return J(this,void 0,void 0,function*(){return new Promise((t,n)=>J(this,void 0,void 0,function*(){const r=setTimeout(()=>{n("negotiation timed out")},this.peerConnectionTimeout);e.signal.addEventListener("abort",()=>{clearTimeout(r),n("negotiation aborted")}),this.publisher.once(Rg.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Rg.NegotiationComplete,()=>{clearTimeout(r),t()})}),yield this.publisher.negotiate(e=>{clearTimeout(r),n(e)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===za.PUBLISHER||e===za.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return J(this,arguments,void 0,function(e,t){var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise((e,i)=>J(n,void 0,void 0,function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),Ni.clearTimeout(o),i(new _n("room connection has been cancelled",Bt.Cancelled))};null!=t&&t.signal.aborted&&n(),null==t||t.signal.addEventListener("abort",n);const o=Ni.setTimeout(()=>{null==t||t.signal.removeEventListener("abort",n),i(new _n("could not establish pc connection",Bt.InternalError))},r);for(;this.state!==pr.CONNECTED;)if(yield Bs(50),null!=t&&t.signal.aborted)return void i(new _n("room connection has been cancelled",Bt.Cancelled));Ni.clearTimeout(o),null==t||t.signal.removeEventListener("abort",n),e()}))}()})}}class vr extends Error{constructor(e,t,n){super(t),this.code=e,this.message=pH(t,vr.MAX_MESSAGE_BYTES),this.data=n?pH(n,vr.MAX_DATA_BYTES):void 0}static fromProto(e){return new vr(e.code,e.message,e.data)}toProto(){return new WQ({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new vr(vr.ErrorCode[e],vr.ErrorMessage[e],t)}}vr.MAX_MESSAGE_BYTES=256,vr.MAX_DATA_BYTES=15360,vr.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},vr.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const aee=15360;function vO(e){return(new TextEncoder).encode(e).length}function pH(e,t){if(vO(e)<=t)return e;let n=0,r=e.length;const i=new TextEncoder;for(;n<r;){const o=Math.floor((n+r+1)/2);i.encode(e.slice(0,o)).length<=t?n=o:r=o-1}return e.slice(0,n)}const yO=2e3;function tT(e,t){if(!t)return 0;let n,r;return"bytesReceived"in e?(n=e.bytesReceived,r=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,r=t.bytesSent),void 0===n||void 0===r||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-r)*1e3/(e.timestamp-t.timestamp)}const bO=typeof MediaRecorder<"u";class p2e{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const m2e=bO?MediaRecorder:p2e;class g2e extends m2e{constructor(e,t){if(!bO)throw new Error("MediaRecorder is not available in this environment");let n,r;super(new MediaStream([e.mediaStreamTrack]),t);const i=()=>{this.removeEventListener("dataavailable",n),this.removeEventListener("stop",i),this.removeEventListener("error",o),null==r||r.close(),r=void 0},o=e=>{null==r||r.error(e),this.removeEventListener("dataavailable",n),this.removeEventListener("stop",i),this.removeEventListener("error",o),r=void 0};this.byteStream=new ReadableStream({start:e=>{r=e,n=t=>J(this,void 0,void 0,function*(){let n;if(t.data.arrayBuffer){const e=yield t.data.arrayBuffer();n=new Uint8Array(e)}else{if(!t.data.byteArray)throw new Error("no data available!");n=t.data.byteArray}void 0===r||e.enqueue(n)}),this.addEventListener("dataavailable",n)},cancel:()=>{i()}}),this.addEventListener("stop",i),this.addEventListener("error",o)}}function v2e(){return bO}const y2e=1e3,b2e=1e4;class _O extends he{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=mO(()=>J(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>J(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Re.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new ds,this.pauseUpstreamLock=new ds,this.trackChangeLock=new ds,this.trackChangeLock.lock().then(t=>J(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{t()}})),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==he.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return J(this,void 0,void 0,function*(){var n;if(e===this._mediaStreamTrack&&!t)return;let r;if(this._mediaStreamTrack&&(this.attachedElements.forEach(e=>{Tg(this._mediaStreamTrack,e)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(ig(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&"closed"!==(null===(n=this.sender.transport)||void 0===n?void 0:n.state)&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(t=>{ig(r??e,t)}))})}waitForDimensions(){return J(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y2e;return function*(){var n;if(e.kind===he.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=wo())||void 0===n?void 0:n.os)&&(yield Bs(10));const r=Date.now();for(;Date.now()-r<t;){const t=e.dimensions;if(t)return t;yield Bs(50)}throw new ou("unable to get track dimensions after timeout")}()})}setDeviceId(e){return J(this,void 0,void 0,function*(){return!!(this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===nf(e)||(this._constraints.deviceId=e,this.isMuted))||(yield this.restartTrack(),nf(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return J(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===he.Source.ScreenShare)return;const{deviceId:n,groupId:r}=e._mediaStreamTrack.getSettings(),i=e.kind===he.Kind.Audio?"audioinput":"videoinput";return t?_i.getInstance().normalizeDeviceId(i,n,r):n}()})}mute(){return J(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return J(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return J(this,void 0,void 0,function*(){const n=yield this.trackChangeLock.lock();try{if(!this.sender)throw new ou("unable to replace an unpublished track");let n,r;return"boolean"==typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,r=t.stopProcessor),this.providedByUser=n??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.internalStopProcessor()),this}finally{n()}})}restart(e){return J(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:t,facingMode:n}=e,r=J_e(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const i={audio:!1,video:!1};this.kind===he.Kind.Video?i.video=!t&&!n||{deviceId:t,facingMode:n}:i.audio=!t||{deviceId:t},this.attachedElements.forEach(e=>{Tg(this.mediaStreamTrack,e)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const o=(yield navigator.mediaDevices.getUserMedia(i)).getTracks()[0];return yield o.applyConstraints(r),o.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(o),this._constraints=e,this.emit(Re.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),(this.isMuted!==e||this._mediaStreamTrack.enabled===e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Re.Muted:Re.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),JZ()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return J(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(Re.UpstreamPaused,this);const t=wo();if("Safari"===(null==t?void 0:t.name)&&nl(t.version,"12.0")<0)throw new dO("pauseUpstream is not supported on Safari < 12.");"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return J(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(Re.UpstreamResumed,this),"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return J(this,void 0,void 0,function*(){var e;return null!==(e=this.sender)&&void 0!==e&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return J(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r;const i=yield t.trackChangeLock.lock();try{t.log.debug("setting up processor",t.logContext);const i=document.createElement(t.kind),o={kind:t.kind,track:t._mediaStreamTrack,element:i,audioContext:t.audioContext};if(yield e.init(o),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.internalStopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(ig(t._mediaStreamTrack,i),i.muted=!0,i.play().catch(e=>{e instanceof DOMException&&"AbortError"===e.name?(t.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},t.logContext),{error:e})),setTimeout(()=>{i.play().catch(e=>{t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{err:e}))})},100)):t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e}))}),t.processor=e,t.processorElement=i,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(Tg(t._mediaStreamTrack,e),ig(t.processor.processedTrack,e));yield null===(r=t.sender)||void 0===r?void 0:r.replaceTrack(t.processor.processedTrack)}t.emit(Re.TrackProcessorUpdate,t.processor)}finally{i()}}()})}getProcessor(){return this.processor}stopProcessor(){return J(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{n()}}()})}internalStopProcessor(){return J(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,r;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(r=e.processorElement)||void 0===r||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Re.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(v2e())if(this.localTrackRecorder)this.log.warn("preconnect buffer already started");else{{let e="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(e)||(e="video/mp4"),this.localTrackRecorder=new g2e(this,{mimeType:e})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},b2e)}else this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.mimeType}}class mC extends _O{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;super(e,he.Kind.Audio,t,n,i),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>J(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}e&&this.prevStats&&(this._currentBitrate=tT(e,this.prevStats)),this.prevStats=e}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Re.AudioTrackFeatureUpdate,this,bi.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Re.AudioTrackFeatureUpdate,this,bi.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return J(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===he.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return J(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==nf(this._constraints.deviceId);return this.source===he.Source.Microphone&&(this.stopOnMute||"ended"===this._mediaStreamTrack.readyState||t)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return J(this,void 0,void 0,function*(){let t;if(e){const n=fO({audio:e});"boolean"!=typeof n.audio&&(t=n.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return J(this,void 0,void 0,function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n})}startMonitor(){Us()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},yO)))}setProcessor(e){return J(this,void 0,void 0,function*(){var t;const n=yield this.trackChangeLock.lock();try{if(!tl()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Re.TrackProcessorUpdate,this.processor)}finally{n()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return J(this,void 0,void 0,function*(){var e;if(null===(e=this.sender)||void 0===e||!e.getStats)return;let t;return(yield this.sender.getStats()).forEach(e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})}),t})}checkForSilence(){return J(this,void 0,void 0,function*(){const e=yield tee(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Re.AudioSilenceDetected)),e})}}function _2e(e,t,n){switch(e.kind){case"audio":return new mC(e,t,!1,void 0,n);case"video":return new nv(e,t,!1,n);default:throw new ou("unsupported track type: ".concat(e.kind))}}const S2e=Object.values(zc),E2e=Object.values(MA),w2e=Object.values(eT),C2e=[zc.h180,zc.h360],T2e=[MA.h180,MA.h360],R2e=e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map(t=>{var n,r;return new bn(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(n=e.encoding.maxFramerate)&&void 0!==n?n:30)/(null!==(r=t.fps)&&void 0!==r?r:30))))),t.fps,e.encoding.priority)}),qA=["q","h","f"];function GA(e,t,n,r){var i,o;let s=null==r?void 0:r.videoEncoding;e&&(s=null==r?void 0:r.screenShareEncoding);const a=null==r?void 0:r.simulcast,l=null==r?void 0:r.scalabilityMode,c=null==r?void 0:r.videoCodec;if(!s&&!a&&!l||!t||!n)return[{}];s||(s=k2e(e,t,n,c),kt.debug("using video encoding",s));const u=s.maxFramerate,d=new bn(t,n,s.maxBitrate,s.maxFramerate,s.priority);if(l&&qc(c)){const e=new cee(l),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const n=wo();if(hC()||tl()||"Chrome"===(null==n?void 0:n.name)&&nl(null==n?void 0:n.version,"113")<0){const r="h"==e.suffix?2:3,i=LSe(n);for(let n=0;n<e.spatial;n+=1)t.push({rid:qA[2-n],maxBitrate:s.maxBitrate/Math.pow(r,n),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:i?Math.pow(2,n):void 0});t[0].scalabilityMode=l}else t.push({maxBitrate:s.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(t[0].priority=d.encoding.priority,t[0].networkPriority=d.encoding.priority),kt.debug("using svc encoding",{encodings:t}),t}if(!a)return[s];let h,p=[];if(p=e?null!==(i=gH(null==r?void 0:r.screenShareSimulcastLayers))&&void 0!==i?i:mH(e,d):null!==(o=gH(null==r?void 0:r.videoSimulcastLayers))&&void 0!==o?o:mH(e,d),p.length>0){const e=p[0];p.length>1&&([,h]=p);const r=Math.max(t,n);if(r>=960&&h)return Xk(t,n,[e,h,d],u);if(r>=480)return Xk(t,n,[e,d],u)}return Xk(t,n,[d])}function I2e(e,t,n){var r,i,o,s;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&kt.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const a=e.mediaStreamTrack.getSettings(),l=null!==(r=a.width)&&void 0!==r?r:null===(i=e.dimensions)||void 0===i?void 0:i.width,c=null!==(o=a.height)&&void 0!==o?o:null===(s=e.dimensions)||void 0===s?void 0:s.height;return e.source===he.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),GA(e.source===he.Source.ScreenShare,l,c,n)}function k2e(e,t,n,r){const i=x2e(e,t,n);let{encoding:o}=i[0];const s=Math.max(t,n);for(let e=0;e<i.length;e+=1){const t=i[e];if(o=t.encoding,t.width>=s)break}if(r)switch(r){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=.7*o.maxBitrate;break;case"vp9":o=Object.assign({},o),o.maxBitrate=.85*o.maxBitrate}return o}function x2e(e,t,n){if(e)return w2e;const r=t>n?t/n:n/t;return Math.abs(r-16/9)<Math.abs(r-4/3)?S2e:E2e}function mH(e,t){if(e)return R2e(t);const{width:n,height:r}=t,i=n>r?n/r:r/n;return Math.abs(i-16/9)<Math.abs(i-4/3)?C2e:T2e}function Xk(e,t,n,r){const i=[];if(n.forEach((n,o)=>{if(o>=qA.length)return;const s=Math.min(e,t),a={rid:qA[o],scaleResolutionDownBy:Math.max(1,s/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},l=r&&n.encoding.maxFramerate?Math.min(r,n.encoding.maxFramerate):n.encoding.maxFramerate;l&&(a.maxFramerate=l);const c=tv()||0===o;n.encoding.priority&&c&&(a.priority=n.encoding.priority,a.networkPriority=n.encoding.priority),i.push(a)}),tl()&&"ios"===ZZ()){let e;i.forEach(t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate});let t=!0;i.forEach(n=>{var r;n.maxFramerate!=e&&(t&&(t=!1,kt.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),kt.info('Setting framerate of encoding "'.concat(null!==(r=n.rid)&&void 0!==r?r:"",'" to ').concat(e)),n.maxFramerate=e)})}return i}function gH(e){if(e)return e.sort((e,t)=>{const{encoding:n}=e,{encoding:r}=t;return n.maxBitrate>r.maxBitrate?1:n.maxBitrate<r.maxBitrate?-1:n.maxBitrate===r.maxBitrate&&n.maxFramerate&&r.maxFramerate?n.maxFramerate>r.maxFramerate?1:-1:0})}class cee{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}function A2e(e){return e.source===he.Source.ScreenShare||e.constraints.height&&nf(e.constraints.height)>=1080?"maintain-resolution":"balanced"}const L2e=5e3;class nv extends _O{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0;super(e,he.Kind.Video,t,n,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>J(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}const t=new Map(e.map(e=>[e.rid,e])),n=e.some(e=>"cpu"===e.qualityLimitationReason);if(n!==this.isCpuConstrained&&(this.isCpuConstrained=n,this.isCpuConstrained&&this.emit(Re.CpuConstrained)),this.prevStats){let e=0;t.forEach((t,n)=>{var r;const i=null===(r=this.prevStats)||void 0===r?void 0:r.get(n);e+=tT(t,i)}),this._currentBitrate=e}this.prevStats=t}),this.senderLock=new ds}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Us())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},yO))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return J(this,void 0,void 0,function*(){var t,n,r,i,o;yield e.pauseUpstream.call(this);try{for(var s,a=!0,l=su(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);a=!0)i=s.value,a=!1,yield null===(o=i.sender)||void 0===o?void 0:o.replaceTrack(null)}catch(e){n={error:e}}finally{try{!a&&!t&&(r=l.return)&&(yield r.call(l))}finally{if(n)throw n.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return J(this,void 0,void 0,function*(){var t,n,r,i,o;yield e.resumeUpstream.call(this);try{for(var s,a=!0,l=su(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);a=!0){i=s.value,a=!1;const e=i;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(e.mediaStreamTrack)}}catch(e){n={error:e}}finally{try{!a&&!t&&(r=l.return)&&(yield r.call(l))}finally{if(n)throw n.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return J(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===he.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return J(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===he.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return J(this,void 0,void 0,function*(){var e;if(null===(e=this.sender)||void 0===e||!e.getStats)return[];const t=[],n=yield this.sender.getStats();return n.forEach(e=>{var r;if("outbound-rtp"===e.type){const i={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(r=e.rid)&&void 0!==r?r:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},o=n.get(e.remoteId);o&&(i.jitter=o.jitter,i.packetsLost=o.packetsLost,i.roundTripTime=o.roundTripTime),t.push(i)}}),t.sort((e,t)=>{var n,r;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(r=e.frameWidth)&&void 0!==r?r:0)}),t})}setPublishingQuality(e){const t=[];for(let n=_o.LOW;n<=_o.HIGH;n+=1)t.push(new cO({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(qc(this.codec),t)}restartTrack(e){return J(this,void 0,void 0,function*(){var t,n,r,i,o;let s;if(e){const t=fO({video:e});"boolean"!=typeof t.video&&(s=t.video)}yield this.restart(s),this.isCpuConstrained=!1;try{for(var a,l=!0,c=su(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);l=!0){i=a.value,l=!1;const e=i;e.sender&&"closed"!==(null===(o=e.sender.transport)||void 0===o?void 0:o.state)&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(e){n={error:e}}finally{try{!l&&!t&&(r=c.return)&&(yield r.call(c))}finally{if(n)throw n.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return J(this,arguments,void 0,function(e){var n=this;let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i,o,s,a,l,c;if(yield t.setProcessor.call(n,e,r),null!==(l=n.processor)&&void 0!==l&&l.processedTrack)try{for(var u,d=!0,h=su(n.simulcastCodecs.values());!(i=(u=yield h.next()).done);d=!0)a=u.value,d=!1,yield null===(c=a.sender)||void 0===c?void 0:c.replaceTrack(n.processor.processedTrack)}catch(e){o={error:e}}finally{try{!d&&!i&&(s=h.return)&&(yield s.call(h))}finally{if(o)throw o.error}}}()})}setDegradationPreference(e){return J(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(e){this.log.warn("failed to set degradationPreference",Object.assign({error:e},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},L2e))}setPublishingCodecs(e){return J(this,void 0,void 0,function*(){var t,n,r,i,o,s,a;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(qc(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(t=!0,n=su(e);!(i=(r=yield n.next()).done);t=!0){a=r.value,t=!1;const e=a;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield vH(t.sender,t.encodings,e.qualities,this.senderLock,qc(e.codec),this.log,this.logContext));else for(const t of e.qualities)if(t.enabled){l.push(e.codec);break}}else yield this.setPublishingLayers(qc(e.codec),e.qualities)}}catch(e){o={error:e}}finally{try{!t&&!i&&(s=n.return)&&(yield s.call(n))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,t){return J(this,void 0,void 0,function*(){this.optimizeForPerformance?this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t})):(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),this.sender&&this.encodings&&(yield vH(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext)))})}prioritizePerformance(){return J(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const e=this.sender.getParameters();e.encodings=e.encodings.map((e,t)=>{var n;return Object.assign(Object.assign({},e),{active:0===t,scaleResolutionDownBy:Math.max(1,Math.ceil((null!==(n=this.mediaStreamTrack.getSettings().height)&&void 0!==n?n:360)/360)),scalabilityMode:0===t&&qc(this.codec)?"L1T3":void 0,maxFramerate:0===t?15:0,maxBitrate:0===t?e.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:e.encodings})),this.encodings=e.encodings,yield this.sender.setParameters(e)}catch(e){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:e})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),JZ()&&this.isInBackground&&this.source===he.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function vH(e,t,n,r,i,o,s){return J(this,void 0,void 0,function*(){const a=yield r.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:e,qualities:n,senderEncodings:t}));try{const r=e.getParameters(),{encodings:a}=r;if(!a)return;if(a.length!==t.length)return void o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:a,senderEncodings:t}));let l=!1;i&&n.some(e=>e.enabled)&&n.forEach(e=>e.enabled=!0),a.forEach((e,r)=>{var i;let a=null!==(i=e.rid)&&void 0!==i?i:"";""===a&&(a="q");const c=lee(a),u=n.find(e=>e.quality===c);u&&e.active!==u.enabled&&(l=!0,e.active=u.enabled,o.debug("setting layer ".concat(u.quality," to ").concat(e.active?"enabled":"disabled"),s),tv()&&(u.enabled?(e.scaleResolutionDownBy=t[r].scaleResolutionDownBy,e.maxBitrate=t[r].maxBitrate,e.maxFrameRate=t[r].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))}),l&&(r.encodings=a,o.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:r.encodings})),yield e.setParameters(r))}finally{a()}})}function lee(e){switch(e){case"f":default:return _o.HIGH;case"h":return _o.MEDIUM;case"q":return _o.LOW}}function yH(e,t,n,r){if(!n)return[new Fh({quality:_o.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(r){const r=n[0].scalabilityMode,i=new cee(r),o=[],s="h"==i.suffix?1.5:2,a="h"==i.suffix?2:3;for(let r=0;r<i.spatial;r+=1)o.push(new Fh({quality:Math.min(_o.HIGH,i.spatial-1)-r,width:Math.ceil(e/Math.pow(s,r)),height:Math.ceil(t/Math.pow(s,r)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(a,r)):0,ssrc:0}));return o}return n.map(n=>{var r,i,o;const s=null!==(r=n.scaleResolutionDownBy)&&void 0!==r?r:1;let a=lee(null!==(i=n.rid)&&void 0!==i?i:"");return new Fh({quality:a,width:Math.ceil(e/s),height:Math.ceil(t/s),bitrate:null!==(o=n.maxBitrate)&&void 0!==o?o:0,ssrc:0})})}const bH="_lossy",_H="_reliable",P2e=2e3,Jk="leave-reconnect",O2e=3e4;var Da;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Da||(Da={}));class M2e extends ul.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=gO.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Da.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=kt,this.reliableDataSequence=1,this.reliableMessageBuffer=new oH,this.reliableReceivedState=new i2e(O2e),this.handleDataChannel=e=>J(this,[e],void 0,function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===_H)t.reliableDCSub=n;else{if(n.label!==bH)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()}),this.handleDataMessage=e=>J(this,void 0,void 0,function*(){var t,n;const r=yield this.dataProcessLock.lock();try{let r;if(e.data instanceof ArrayBuffer)r=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));r=yield e.data.arrayBuffer()}const i=Ms.fromBinary(new Uint8Array(r));if(i.sequence>0&&""!==i.participantSid){const e=this.reliableReceivedState.get(i.participantSid);if(e&&i.sequence<=e)return;this.reliableReceivedState.set(i.participantSid,i.sequence)}"speaker"===(null===(t=i.value)||void 0===t?void 0:t.case)?this.emit(Oe.ActiveSpeakersUpdate,i.value.value.speakers):("user"===(null===(n=i.value)||void 0===n?void 0:n.case)&&N2e(i,i.value.value),this.emit(Oe.DataPacketReceived,i))}finally{r()}}),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?Rt.LOSSY:Rt.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(Oe.Disconnected),this.close()},r=Date.now()-this.reconnectStart;let i=this.getNextRetryDelay({elapsedMs:r,retryCount:this.reconnectAttempts});null!==i?(e===Jk&&(i=0),this.log.debug("reconnecting in ".concat(i,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ni.setTimeout(()=>this.attemptReconnect(t).finally(()=>this.reconnectTimeout=void 0),i)):n(r)},this.waitForRestarted=()=>new Promise((e,t)=>{this.pcState===Da.Connected&&e();const n=()=>{this.off(Oe.Disconnected,r),e()},r=()=>{this.off(Oe.Restarted,n),t()};this.once(Oe.Restarted,n),this.once(Oe.Disconnected,r)}),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);typeof t<"u"&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(Oe.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return e===Rt.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(t.bufferedAmount),t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===jn.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Am.RR_SIGNAL_DISCONNECTED))},this.log=Tu(null!==(t=e.loggerName)&&void 0!==t?t:nc.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new hO(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new ds,this.dataProcessLock=new ds,this.dcBufferStatus=new Map([[Rt.LOSSY,!0],[Rt.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(Oe.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(Oe.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(Oe.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(Oe.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(Oe.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(Oe.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(Oe.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(Oe.SignalRequestResponse,e)}get logContext(){var e,t,n,r,i,o;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(r=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===r?void 0:r.sid,participant:null===(o=null===(i=this.latestJoinResponse)||void 0===i?void 0:i.participant)||void 0===o?void 0:o.identity,pID:this.participantSid}}join(e,t,n,r){return J(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const i=yield this.client.join(e,t,n,r);return this._isClosed=!1,this.latestJoinResponse=i,this.subscriberPrimary=i.subscriberPrimary,this.pcManager||(yield this.configure(i)),(!this.subscriberPrimary||i.fastPublish)&&this.negotiate(),this.clientConfiguration=i.clientConfiguration,this.emit(Oe.SignalConnected,i),i}catch(i){if(i instanceof _n&&i.reason===Bt.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,r);throw i}})}close(){return J(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(Oe.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return J(this,void 0,void 0,function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new oH,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return J(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new ou("a track with the same ID has already been published");return new Promise((t,n)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],n(new _n("publication of local track timed out, no response from server",Bt.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(r),t(e)},reject:()=>{clearTimeout(r),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(e){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:e}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return J(this,void 0,void 0,function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return J(this,void 0,void 0,function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==pr.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new h2e(r,e.subscriberPrimary,this.loggerOptions),this.emit(Oe.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=(e,t)=>{this.client.sendOffer(e,t)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,r)=>J(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===pr.CONNECTED){const t=this.pcState===Da.New;this.pcState=Da.Connected,t&&this.emit(Oe.Connected,e)}else t===pr.FAILED&&this.pcState===Da.Connected&&(this.pcState=Da.Disconnected,this.handleDisconnect("peerconnection failed","failed"===r?Am.RR_SUBSCRIBER_FAILED:Am.RR_PUBLISHER_FAILED));const i=this.client.isDisconnected||this.client.currentState===jn.RECONNECTING,o=[pr.FAILED,pr.CLOSING,pr.CLOSED].includes(t);i&&o&&!this._isClosed&&this.emit(Oe.Offline)}),this.pcManager.onTrack=e=>{this.emit(Oe.MediaTrackAdded,e.track,e.streams[0],e.receiver)},D2e(null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t)=>J(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t)=>J(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);n&&this.client.sendAnswer(n,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(Oe.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(Oe.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(Oe.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(Oe.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(Oe.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Am.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null==e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case wg.DISCONNECT:this.emit(Oe.Disconnected,null==e?void 0:e.reason),this.close();break;case wg.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Jk);break;case wg.RESUME:this.handleDisconnect(Jk)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if(!(null===(t=this.signalOpts)||void 0===t)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach(e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)}),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===db.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(bH,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(_H,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return J(this,void 0,void 0,function*(){if(DA())return yield this.createTransceiverRTCRtpSender(e,t,n);if(NA())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new zr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,n,r){return J(this,void 0,void 0,function*(){if(DA())return this.createSimulcastTransceiverSender(e,t,n,r);if(NA())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new zr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,n){return J(this,void 0,void 0,function*(){if(!this.pcManager)throw new zr("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),_p(e)&&(e.codec=t.videoCodec);const i={direction:"sendonly",streams:r};return n&&(i.sendEncodings=n),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,i)).sender})}createSimulcastTransceiverSender(e,t,n,r){return J(this,void 0,void 0,function*(){if(!this.pcManager)throw new zr("publisher is closed");const i={direction:"sendonly"};r&&(i.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,i);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return J(this,void 0,void 0,function*(){if(!this.pcManager)throw new zr("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return J(this,void 0,void 0,function*(){var t,n,r;if(!this._isClosed){if(this.attemptingReconnect)return void kt.warn("already attempting reconnect, returning early",this.logContext);((null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)===db.DISABLED||(null!==(r=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==r?r:pr.NEW)===pr.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(e){this.reconnectAttempts+=1;let t=!0;e instanceof zr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:e})),t=!1):e instanceof Lm||(this.fullReconnectOnNext=!0),t?this.handleDisconnect("reconnect",Am.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Oe.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:e}))}return null}restartConnection(e){return J(this,void 0,void 0,function*(){var t,n,r;try{if(!this.url||!this.token)throw new zr("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Oe.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Lm;n=yield this.join(e??this.url,this.token,this.signalOpts)}catch(e){throw e instanceof _n&&e.reason===Bt.NotAllowed?new zr("could not reconnect, token might be expired"):new Lm}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Oe.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==jn.CONNECTED)throw new Lm("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(Oe.Restarted)}catch(e){const t=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(t)return void(yield this.restartConnection(t));throw null===(r=this.regionUrlProvider)||void 0===r||r.resetAttempts(),e}})}resumeConnection(e){return J(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new zr("could not reconnect, url or token not saved");if(!this.pcManager)throw new zr("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Oe.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(e){let t="";throw e instanceof Error&&(t=e.message,this.log.error(e.message,Object.assign(Object.assign({},this.logContext),{error:e}))),e instanceof _n&&e.reason===Bt.NotAllowed?new zr("could not reconnect, token might be expired"):e instanceof _n&&e.reason===Bt.LeaveRequest?e:new Lm(t)}if(this.emit(Oe.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=n.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==jn.CONNECTED)throw new Lm("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),null!=n&&n.lastMessageSeq&&this.resendReliableMessagesForResume(n.lastMessageSeq),this.emit(Oe.Resumed)})}waitForPCInitialConnection(e,t){return J(this,void 0,void 0,function*(){if(!this.pcManager)throw new zr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return J(this,void 0,void 0,function*(){this.pcState=Da.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Bs(P2e),!this.pcManager)throw new zr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Da.Connected}catch(e){throw this.pcState=Da.Disconnected,new _n("could not establish PC connection, ".concat(e.message),Bt.InternalError)}})}publishRpcResponse(e,t,n,r){return J(this,void 0,void 0,function*(){const i=new Ms({destinationIdentities:[e],kind:Rt.RELIABLE,value:{case:"rpcResponse",value:new zQ({requestId:t,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:n??""}})}});yield this.sendDataPacket(i,Rt.RELIABLE)})}publishRpcAck(e,t){return J(this,void 0,void 0,function*(){const n=new Ms({destinationIdentities:[e],kind:Rt.RELIABLE,value:{case:"rpcAck",value:new KQ({requestId:t})}});yield this.sendDataPacket(n,Rt.RELIABLE)})}sendDataPacket(e,t){return J(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(t),t===Rt.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const n=e.toBinary(),r=this.dataChannelForKind(t);if(r){if(t===Rt.RELIABLE&&this.reliableMessageBuffer.push({data:n,sequence:e.sequence}),this.attemptingReconnect)return;r.send(n)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return J(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Rt.RELIABLE);const t=this.dataChannelForKind(Rt.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(e=>{t.send(e.data)})),this.updateAndEmitDCBufferStatus(Rt.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((t,n)=>J(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const r=()=>n("Engine closed");for(this.once(Oe.Closing,r);!this.dcBufferStatus.get(e);)yield Bs(10);this.off(Oe.Closing,r),t()}}))}ensureDataTransportConnected(e){return J(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var r;if(!t.pcManager)throw new zr("PC manager is closed");const i=n?t.pcManager.subscriber:t.pcManager.publisher,o=n?"Subscriber":"Publisher";if(!i)throw new _n("".concat(o," connection not set"),Bt.InternalError);let s=!1;!n&&!t.dataChannelForKind(e,n)&&(t.createDataChannels(),s=!0),!s&&!n&&!t.pcManager.publisher.isICEConnected&&"checking"!==t.pcManager.publisher.getICEConnectionState()&&(s=!0),s&&t.negotiate();const a=t.dataChannelForKind(e,n);if("open"===(null==a?void 0:a.readyState))return;const l=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<l;){if(i.isICEConnected&&"open"===(null===(r=t.dataChannelForKind(e,n))||void 0===r?void 0:r.readyState))return;yield Bs(50)}throw new _n("could not establish ".concat(o," connection, state: ").concat(i.getICEConnectionState()),Bt.InternalError)}()})}ensurePublisherConnected(e){return J(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==pr.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return J(this,void 0,void 0,function*(){return new Promise((e,t)=>J(this,void 0,void 0,function*(){if(!this.pcManager)return void t(new OA("PC manager is closed"));this.pcManager.requirePublisher(),0==this.pcManager.publisher.getTransceivers().length&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const n=new AbortController,r=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(Oe.Closing,r),this.pcManager.publisher.once(Rg.RTPVideoPayloadTypes,e=>{const t=new Map;e.forEach(e=>{const n=e.codec.toLowerCase();NSe(n)&&t.set(e.payload,n)}),this.emit(Oe.RTPVideoMapUpdate,t)});try{yield this.pcManager.negotiate(n),e()}catch(e){e instanceof OA&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Am.RR_UNKNOWN),t(e)}finally{this.off(Oe.Closing,r)}}))})}dataChannelForKind(e,t){if(t){if(e===Rt.LOSSY)return this.lossyDCSub;if(e===Rt.RELIABLE)return this.reliableDCSub}else{if(e===Rt.LOSSY)return this.lossyDC;if(e===Rt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,r;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const i=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),s=null===(r=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===r||r,a=new Array,l=new Array;e.forEach(e=>{e.isDesired!==s&&a.push(e.trackSid),e.isEnabled||l.push(e.trackSid)}),this.client.sendSyncState(new uZ({answer:i?pC({sdp:i.sdp,type:i.type}):void 0,offer:o?pC({sdp:o.sdp,type:o.type}):void 0,subscription:new Q3({trackSids:a,subscribe:!s,participantTracks:[]}),publishTracks:GSe(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l,datachannelReceiveStates:this.reliableReceivedState.map((e,t)=>new dZ({publisherSid:t,lastSeq:e}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null==t?void 0:t.id)&&null!==t.id&&e.push(new fZ({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(Rt.LOSSY),za.PUBLISHER),t(this.dataChannelForKind(Rt.RELIABLE),za.PUBLISHER),t(this.dataChannelForKind(Rt.LOSSY,!0),za.SUBSCRIBER),t(this.dataChannelForKind(Rt.RELIABLE,!0),za.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ni.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Us()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Us()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Lm extends Error{}function D2e(e){return void 0!==e&&e>13}function N2e(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const r=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=r,t.destinationIdentities=r}class KA{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return jA(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return J(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(t=>t.url===e.url));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),kt.debug("next region: ".concat(e.region)),e.url}return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return J(this,void 0,void 0,function*(){const t=yield fetch("".concat(U2e(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new _n("Could not fetch region settings: ".concat(t.statusText),401===t.status?Bt.NotAllowed:Bt.InternalError,t.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function U2e(e){return"".concat(e.protocol.replace("ws","http"),"//").concat(e.host,"/settings")}class uee{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("number"==typeof this.totalByteSize&&0!==this.totalByteSize){if(e&&this.bytesReceived<this.totalByteSize)throw new jd("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Wa.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new jd("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Wa.LengthExceeded)}}constructor(e,t,n,r){this.reader=t,this.totalByteSize=n,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class j2e extends uee{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const n=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,n)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new Wc,n=null,r=null;if(this.signal){const e=this.signal;r=()=>{var n;null===(n=t.reject)||void 0===n||n.call(t,e.reason)},e.addEventListener("abort",r),n=e}const i=()=>{e.releaseLock(),n&&r&&n.removeEventListener("abort",r),this.signal=void 0};return{next:()=>J(this,void 0,void 0,function*(){var n,r;try{const{done:i,value:o}=yield Promise.race([e.read(),t.promise,null!==(r=null===(n=this.outOfBandFailureRejectingFuture)||void 0===n?void 0:n.promise)&&void 0!==r?r:new Promise(()=>{})]);return i?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(o),{done:!1,value:o.content})}catch(e){throw i(),e}}),return(){return J(this,void 0,void 0,function*(){return i(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return J(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){var n,r,i,o;let s=new Set;const a=t.signal?e.withAbortSignal(t.signal):e;try{for(var l,c=!0,u=su(a);!(n=(l=yield u.next()).done);c=!0){o=l.value,c=!1;const e=o;s.add(e)}}catch(e){r={error:e}}finally{try{!c&&!n&&(i=u.return)&&(yield i.call(u))}finally{if(r)throw r.error}}return Array.from(s)}()})}}class F2e extends uee{constructor(e,t,n,r){super(e,t,n,r),this.receivedChunks=new Map}handleChunkReceived(e){var t;const n=rw(e.chunkIndex),r=this.receivedChunks.get(n);if(r&&r.version>e.version)return;this.receivedChunks.set(n,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let n=new Wc,r=null,i=null;if(this.signal){const e=this.signal;i=()=>{var t;null===(t=n.reject)||void 0===t||t.call(n,e.reason)},e.addEventListener("abort",i),r=e}const o=()=>{e.releaseLock(),r&&i&&r.removeEventListener("abort",i),this.signal=void 0};return{next:()=>J(this,void 0,void 0,function*(){var r,i;try{const{done:o,value:s}=yield Promise.race([e.read(),n.promise,null!==(i=null===(r=this.outOfBandFailureRejectingFuture)||void 0===r?void 0:r.promise)&&void 0!==i?i:new Promise(()=>{})]);if(o)return this.validateBytesReceived(!0),{done:!0,value:void 0};{let e;this.handleChunkReceived(s);try{e=t.decode(s.content)}catch(e){throw new jd("Cannot decode datastream chunk ".concat(s.chunkIndex," as text: ").concat(e),Wa.DecodeFailed)}return{done:!1,value:e}}}catch(e){throw o(),e}}),return(){return J(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return J(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){var n,r,i,o;let s="";const a=t.signal?e.withAbortSignal(t.signal):e;try{for(var l,c=!0,u=su(a);!(n=(l=yield u.next()).done);c=!0)o=l.value,c=!1,s+=o}catch(e){r={error:e}}finally{try{!c&&!n&&(i=u.return)&&(yield i.call(u))}finally{if(r)throw r.error}}return s}()})}}class $2e{constructor(){this.log=kt,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new jd('A text stream handler for topic "'.concat(e,'" has already been set.'),Wa.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new jd('A byte stream handler for topic "'.concat(e,'" has already been set.'),Wa.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,n,r,i;const o=Array.from(this.textStreamControllers.entries()).filter(t=>t[1].sendingParticipantIdentity===e),s=Array.from(this.byteStreamControllers.entries()).filter(t=>t[1].sendingParticipantIdentity===e);if(o.length>0||s.length>0){const a=new jd("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Wa.AbnormalEnd);for(const[e,r]of s)null===(n=(t=r.outOfBandFailureRejectingFuture).reject)||void 0===n||n.call(t,a),this.byteStreamControllers.delete(e);for(const[e,t]of o)null===(i=(r=t.outOfBandFailureRejectingFuture).reject)||void 0===i||i.call(r,a),this.textStreamControllers.delete(e)}}handleDataStreamPacket(e){return J(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity);case"streamChunk":return this.handleStreamChunk(e.value.value);case"streamTrailer":return this.handleStreamTrailer(e.value.value);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,t){return J(this,void 0,void 0,function*(){var n;if("byteHeader"===e.contentHeader.case){const r=this.byteStreamHandlers.get(e.topic);if(!r)return void this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);let i;const o=new Wc,s={id:e.streamId,name:null!==(n=e.contentHeader.value.name)&&void 0!==n?n:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:rw(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:n=>{if(i=n,this.textStreamControllers.has(e.streamId))throw new jd("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Wa.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:s,controller:i,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:o})}});r(new j2e(s,a,rw(e.totalLength),o),{identity:t})}else if("textHeader"===e.contentHeader.case){const n=this.textStreamHandlers.get(e.topic);if(!n)return void this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);let r;const i=new Wc,o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},s=new ReadableStream({start:n=>{if(r=n,this.textStreamControllers.has(e.streamId))throw new jd("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Wa.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:o,controller:r,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:i})}});n(new F2e(o,s,rw(e.totalLength),i),{identity:t})}})}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const n=this.textStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const n=this.byteStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.byteStreamControllers.delete(e.streamId))}}class dee{constructor(e,t,n){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=n,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return J(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),null===(e=this.onClose)||void 0===e||e.call(this)})}}class B2e extends dee{}class H2e extends dee{}const SH=15e3;class V2e{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return J(this,void 0,void 0,function*(){var n;const r=crypto.randomUUID(),i=(new TextEncoder).encode(e).byteLength,o=null===(n=null==t?void 0:t.attachments)||void 0===n?void 0:n.map(()=>crypto.randomUUID()),s=new Array(o?o.length+1:1).fill(0),a=(e,n)=>{var r;s[n]=e;const i=s.reduce((e,t)=>e+t,0);null===(r=null==t?void 0:t.onProgress)||void 0===r||r.call(t,i)},l=yield this.streamText({streamId:r,totalSize:i,destinationIdentities:null==t?void 0:t.destinationIdentities,topic:null==t?void 0:t.topic,attachedStreamIds:o,attributes:null==t?void 0:t.attributes});return yield l.write(e),a(1,0),yield l.close(),null!=t&&t.attachments&&o&&(yield Promise.all(t.attachments.map((e,n)=>J(this,void 0,void 0,function*(){return this._sendFile(o[n],e,{topic:t.topic,mimeType:e.type,onProgress:e=>{a(e,n+1)}})})))),l.info})}streamText(e){return J(this,void 0,void 0,function*(){var t,n;const r=null!==(t=null==e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),i={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:null!==(n=null==e?void 0:e.topic)&&void 0!==n?n:"",size:null==e?void 0:e.totalSize,attributes:null==e?void 0:e.attributes},o=new _A({streamId:r,mimeType:i.mimeType,topic:i.topic,timestamp:Th(i.timestamp),totalLength:Th(null==e?void 0:e.totalSize),attributes:i.attributes,contentHeader:{case:"textHeader",value:new tZ({version:null==e?void 0:e.version,attachedStreamIds:null==e?void 0:e.attachedStreamIds,replyToStreamId:null==e?void 0:e.replyToStreamId,operationType:"update"===(null==e?void 0:e.type)?bA.UPDATE:bA.CREATE})}}),s=null==e?void 0:e.destinationIdentities,a=new Ms({destinationIdentities:s,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(a,Rt.RELIABLE);let l=0;const c=this.engine,u=new WritableStream({write(e){return J(this,void 0,void 0,function*(){for(const t of HSe(e,SH)){yield c.waitForBufferStatusLow(Rt.RELIABLE);const e=new SA({content:t,streamId:r,chunkIndex:Th(l)}),n=new Ms({destinationIdentities:s,value:{case:"streamChunk",value:e}});yield c.sendDataPacket(n,Rt.RELIABLE),l+=1}})},close(){return J(this,void 0,void 0,function*(){const e=new EA({streamId:r}),t=new Ms({destinationIdentities:s,value:{case:"streamTrailer",value:e}});yield c.sendDataPacket(t,Rt.RELIABLE)})},abort(e){console.log("Sink error:",e)}});let d=()=>J(this,void 0,void 0,function*(){yield h.close()});c.once(Oe.Closing,d);const h=new B2e(u,i,()=>this.engine.off(Oe.Closing,d));return h})}sendFile(e,t){return J(this,void 0,void 0,function*(){const n=crypto.randomUUID();return yield this._sendFile(n,e,t),{id:n}})}_sendFile(e,t,n){return J(this,void 0,void 0,function*(){var r;const i=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:null!==(r=null==n?void 0:n.mimeType)&&void 0!==r?r:t.type,topic:null==n?void 0:n.topic,destinationIdentities:null==n?void 0:n.destinationIdentities}),o=t.stream().getReader();for(;;){const{done:e,value:t}=yield o.read();if(e)break;yield i.write(t)}return yield i.close(),i.info})}streamBytes(e){return J(this,void 0,void 0,function*(){var t,n,r,i,o;const s=null!==(t=null==e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),a=null==e?void 0:e.destinationIdentities,l={id:s,mimeType:null!==(n=null==e?void 0:e.mimeType)&&void 0!==n?n:"application/octet-stream",topic:null!==(r=null==e?void 0:e.topic)&&void 0!==r?r:"",timestamp:Date.now(),attributes:null==e?void 0:e.attributes,size:null==e?void 0:e.totalSize,name:null!==(i=null==e?void 0:e.name)&&void 0!==i?i:"unknown"},c=new _A({totalLength:Th(null!==(o=l.size)&&void 0!==o?o:0),mimeType:l.mimeType,streamId:s,topic:l.topic,timestamp:Th(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new nZ({name:l.name})}}),u=new Ms({destinationIdentities:a,value:{case:"streamHeader",value:c}});yield this.engine.sendDataPacket(u,Rt.RELIABLE);let d=0;const h=new ds,p=this.engine,f=this.log,m=new WritableStream({write(e){return J(this,void 0,void 0,function*(){const t=yield h.lock();let n=0;try{for(;n<e.byteLength;){const t=e.slice(n,n+SH);yield p.waitForBufferStatusLow(Rt.RELIABLE);const r=new Ms({destinationIdentities:a,value:{case:"streamChunk",value:new SA({content:t,streamId:s,chunkIndex:Th(d)})}});yield p.sendDataPacket(r,Rt.RELIABLE),d+=1,n+=t.byteLength}}finally{t()}})},close(){return J(this,void 0,void 0,function*(){const e=new EA({streamId:s}),t=new Ms({destinationIdentities:a,value:{case:"streamTrailer",value:e}});yield p.sendDataPacket(t,Rt.RELIABLE)})},abort(e){f.error("Sink error:",e)}});return new H2e(m,l)})}}class SO extends he{constructor(e,t,n,r,i){super(e,n,i),this.sid=t,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Re.Muted:Re.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Re.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return J(this,void 0,void 0,function*(){var e;return null!==(e=this.receiver)&&void 0!==e&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),yO)),KSe()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(Re.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class fee extends SO{constructor(e,t,n,r,i,o){super(e,t,he.Kind.Audio,n,o),this.monitorReceiver=()=>J(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=tT(e,this.prevStats)),this.prevStats=e}),this.audioContext=r,this.webAudioPluginNodes=[],i&&(this.sinkId=i.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;tl()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(tl())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return J(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(UA(t))return t.setSinkId(e)}))})}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&UA(e)&&e.setSinkId(this.sinkId).catch(e=>{this.log.error("Failed to set sink id on remote audio track",e,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach(e=>{n.connect(e),n=e}),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then(()=>{"running"!==e.state&&this.emit(Re.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(e=>{this.emit(Re.AudioPlaybackFailed,e)})}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return J(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach(t=>{"inbound-rtp"===t.type&&(e={type:"audio",streamId:t.id,timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})}),e})}}const Qk=100;class q2e extends SO{constructor(e,t,n,r,i){super(e,t,he.Kind.Video,n,i),this.elementInfos=[],this.monitorReceiver=()=>J(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=tT(e,this.prevStats)),this.prevStats=e}),this.debouncedHandleResize=mO(()=>{this.updateDimensions()},Qk),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?Tg(this._mediaStreamTrack,t):ig(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t.element===e)){const t=new G2e(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t===e)?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter(t=>t===e);for(const e of t)e.stopObserving();this.elementInfos=this.elementInfos.filter(t=>t!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const e of t)this.stopObservingElement(e);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return J(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",r=new Map;return e.forEach(e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&r.set(e.id,e)}),t&&""!==n&&r.get(n)&&(t.mimeType=r.get(n).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(t=>t.element===e);for(const e of t)this.stopObservingElementInfo(e)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const n=this.elementInfos.reduce((e,t)=>Math.max(e,t.visibilityChangedAt||0),0),r=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,i=this.elementInfos.some(e=>e.pictureInPicture),o=this.elementInfos.some(e=>e.visible)&&!r||i;if(this.lastVisible!==o){if(!o&&Date.now()-n<Qk)return void Ni.setTimeout(()=>{this.updateVisibility()},Qk);this.lastVisible=o,this.emit(Re.VisibilityChanged,o,this)}}updateDimensions(){var e,t;let n=0,r=0;const i=this.getPixelDensity();for(const e of this.elementInfos){const t=e.width()*i,o=e.height()*i;t+o>n+r&&(n=t,r=o)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===r||(this.lastDimensions={width:n,height:r},this.emit(Re.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;return"screen"===t?ZB():t||(ZB()>2?2:1)}}class G2e{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:r}=e;n===this.element&&(this.isIntersecting=r,this.isPiP=x0(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=x0(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=x0(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=t??zA(e),this.isPiP=Us()&&x0(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=zA(this.element),this.isPiP=x0(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,tH().observe(this.element),eH().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,r,i;null===(e=tH())||void 0===e||e.unobserve(this.element),null===(t=eH())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(i=null===(r=window.documentPictureInPicture)||void 0===r?void 0:r.window)||void 0===i||i.removeEventListener("pagehide",this.onLeavePiP)}}function x0(e){var t,n;return document.pictureInPictureElement===e||!(null===(t=window.documentPictureInPicture)||void 0===t||!t.window)&&zA(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function zA(e,t){const n=t||window;let r=e.offsetTop,i=e.offsetLeft;const o=e.offsetWidth,s=e.offsetHeight,{hidden:a}=e,{display:l}=getComputedStyle(e);for(;e.offsetParent;)r+=(e=e.offsetParent).offsetTop,i+=e.offsetLeft;return r<n.pageYOffset+n.innerHeight&&i<n.pageXOffset+n.innerWidth&&r+s>n.pageYOffset&&i+o>n.pageXOffset&&!a&&"none"!==l}class Ql extends ul.EventEmitter{constructor(e,t,n,r){var i;super(),this.metadataMuted=!1,this.encryption=yo.NONE,this.log=kt,this.handleMuted=()=>{this.emit(Re.Muted)},this.handleUnmuted=()=>{this.emit(Re.Unmuted)},this.log=Tu(null!==(i=null==r?void 0:r.loggerName)&&void 0!==i?i:nc.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=he.Source.Unknown}setTrack(e){this.track&&(this.track.off(Re.Muted,this.handleMuted),this.track.off(Re.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Re.Muted,this.handleMuted),e.on(Re.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Lt(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==yo.NONE}get audioTrack(){if(Jc(this.track))return this.track}get videoTrack(){if(_p(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=he.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===he.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(e.PermissionStatus||(e.PermissionStatus={}))}(Ql||(Ql={}));class WA extends Ql{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,r){super(e,t.sid,t.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Re.Ended)},this.handleCpuConstrained=()=>{this.track&&_p(this.track)&&this.emit(Re.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&(this.track.off(Re.Ended,this.handleTrackEnded),this.track.off(Re.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(Re.Ended,this.handleTrackEnded),e.on(Re.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return J(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()})}unmute(){return J(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()})}pauseUpstream(){return J(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()})}resumeUpstream(){return J(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Jc(this.track)){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(bi.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(bi.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(bi.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(bi.TF_STEREO),!(null===(e=this.options)||void 0===e)&&e.dtx||n.add(bi.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(bi.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function u_(e,t){return J(this,void 0,void 0,function*(){e??(e={});let n=!1;const{audioProcessor:r,videoProcessor:i,optionsWithoutProcessor:o}=ree(e);let s=o.audio,a=o.video;if(r&&"object"==typeof o.audio&&(o.audio.processor=r),i&&"object"==typeof o.video&&(o.video.processor=i),e.audio&&"object"==typeof o.audio&&"string"==typeof o.audio.deviceId){const e=o.audio.deviceId;o.audio.deviceId={exact:e},n=!0,s=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:e}})}if(o.video&&"object"==typeof o.video&&"string"==typeof o.video.deviceId){const e=o.video.deviceId;o.video.deviceId={exact:e},n=!0,a=Object.assign(Object.assign({},o.video),{deviceId:{ideal:e}})}(!0===o.audio||"object"==typeof o.audio&&!o.audio.deviceId)&&(o.audio={deviceId:"default"}),!0===o.video?o.video={deviceId:"default"}:"object"==typeof o.video&&!o.video.deviceId&&(o.video.deviceId="default");const l=eee(o,see,oee),c=fO(l),u=navigator.mediaDevices.getUserMedia(c);o.audio&&(_i.userMediaPromiseMap.set("audioinput",u),u.catch(()=>_i.userMediaPromiseMap.delete("audioinput"))),o.video&&(_i.userMediaPromiseMap.set("videoinput",u),u.catch(()=>_i.userMediaPromiseMap.delete("videoinput")));try{const e=yield u;return yield Promise.all(e.getTracks().map(n=>J(this,void 0,void 0,function*(){const o="audio"===n.kind;let s,a=o?l.audio:l.video;("boolean"==typeof a||!a)&&(a={});const u=o?c.audio:c.video;"boolean"!=typeof u&&(s=u);const d=n.getSettings().deviceId;null!=s&&s.deviceId&&nf(s.deviceId)!==d?s.deviceId=d:s||(s={deviceId:d});const h=_2e(n,s,t);return h.kind===he.Kind.Video?h.source=he.Source.Camera:h.kind===he.Kind.Audio&&(h.source=he.Source.Microphone),h.mediaStream=e,Jc(h)&&r?yield h.setProcessor(r):_p(h)&&i&&(yield h.setProcessor(i)),h})))}catch(r){if(!n)throw r;return u_(Object.assign(Object.assign({},e),{audio:s,video:a}),t)}})}function K2e(e){return J(this,void 0,void 0,function*(){return(yield u_({audio:!1,video:!0}))[0]})}function z2e(e){return J(this,void 0,void 0,function*(){return(yield u_({audio:!0,video:!1}))[0]})}var Fd,Pt;function W2e(e){switch(e){case oy.EXCELLENT:return Fd.Excellent;case oy.GOOD:return Fd.Good;case oy.POOR:return Fd.Poor;case oy.LOST:return Fd.Lost;default:return Fd.Unknown}}!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(Fd||(Fd={}));class hee extends ul.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===fb.AGENT}get isActive(){var e;return(null===(e=this.participantInfo)||void 0===e?void 0:e.state)===Eg.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:fb.STANDARD;var a;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Fd.Unknown,this.log=kt,this.log=Tu(null!==(a=null==o?void 0:o.loggerName)&&void 0!==a?a:nc.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=s,this._attributes=i??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():(this.activeFuture||(this.activeFuture=new Wc,this.once(ae.Active,()=>{var e,t;null===(t=null===(e=this.activeFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.activeFuture=void 0})),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(he.Source.Camera);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(he.Source.Microphone);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(he.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){var t;return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Eg.ACTIVE&&(null===(t=this.participantInfo)||void 0===t?void 0:t.state)!==Eg.ACTIVE&&this.emit(ae.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(ae.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ae.ParticipantNameChanged,e)}_setAttributes(e){const t=zSe(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(ae.AttributesChanged,t)}setPermissions(e){var t,n,r,i,o,s;const a=this.permissions,l=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(r=this.permissions)||void 0===r?void 0:r.canPublishData)||e.hidden!==(null===(i=this.permissions)||void 0===i?void 0:i.hidden)||e.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])})||e.canSubscribeMetrics!==(null===(s=this.permissions)||void 0===s?void 0:s.canSubscribeMetrics);return this.permissions=e,l&&this.emit(ae.ParticipantPermissionsChanged,a),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ae.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=W2e(e),t!==this._connectionQuality&&this.emit(ae.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&(null===(t=(e=this.activeFuture).reject)||void 0===t||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>Jc(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(Re.Muted,()=>{this.emit(ae.TrackMuted,e)}),e.on(Re.Unmuted,()=>{this.emit(ae.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case he.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case he.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}function Y2e(e){var t,n,r;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new cZ({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(r=e.allowAll)&&void 0!==r&&r,trackSids:e.allowedTrackSids||[]})}class X2e extends hee{constructor(e,t,n,r,i,o){super(e,t,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=yo.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Wc)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var e,t,n,r,i,o;this.reconnectFuture&&(this.reconnectFuture.promise.catch(e=>this.log.warn(e.message,this.logContext)),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&(null===(r=(n=this.signalConnectedFuture).reject)||void 0===r||r.call(n,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),null===(o=null===(i=this.activeAgentFuture)||void 0===i?void 0:i.reject)||void 0===o||o.call(i,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=e=>{var t,n;e.participant&&this.updateInfo(e.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Wc),null===(n=(t=this.signalConnectedFuture).resolve)||void 0===n||n.call(t)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:r}=e,i=this.pendingSignalRequests.get(t);i&&(n!==lO.OK&&i.reject(new YB(r,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcResponse":let t=e.value.value,n=null,r=null;"payload"===t.value.case?n=t.value.value:"error"===t.value.case&&(r=vr.fromProto(t.value.value)),this.handleIncomingRpcResponse(t.requestId,n,r);break;case"rpcAck":let i=e.value.value;this.handleIncomingRpcAck(i.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(e=>Y2e(e)))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Lt(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Lt(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Lt(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.onTrackCpuConstrained=(e,t)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Lt(t))),this.emit(ae.LocalTrackCpuConstrained,e,t)},this.handleSubscribedQualityUpdate=e=>J(this,void 0,void 0,function*(){var t,n,r,i,o;if(null===(o=this.roomOptions)||void 0===o||!o.dynacast)return;const s=this.videoTrackPublications.get(e.trackSid);if(!s)return void this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}));if(!s.videoTrack)return;const a=yield s.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var l,c=!0,u=su(a);!(t=(l=yield u.next()).done);c=!0){i=l.value,c=!1;const e=i;CSe(e)&&(this.log.debug("publish ".concat(e," for ").concat(s.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Lt(s))),yield this.publishAdditionalCodecForTrack(s.videoTrack,e,s.options))}}catch(e){n={error:e}}finally{try{!c&&!t&&(r=u.return)&&(yield r.call(u))}finally{if(n)throw n.error}}}),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>J(this,void 0,void 0,function*(){if(e.source===he.Source.ScreenShare||e.source===he.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Lt(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(Bl(e)||Sd(e))try{if(Us())try{const t=yield null==navigator?void 0:navigator.permissions.query({name:e.source===he.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),Lt(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Lt(e))),Bl(e)?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Lt(e))),yield e.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=r,this.setupEngine(n),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=i,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==yo.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(Oe.RemoteMute,(e,t)=>{const n=this.trackPublications.get(e);!n||!n.track||(t?n.mute():n.unmute())}),!(null===(t=this.signalConnectedFuture)||void 0===t)&&t.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(Oe.Connected,this.handleReconnected).on(Oe.SignalConnected,this.handleSignalConnected).on(Oe.SignalRestarted,this.handleReconnected).on(Oe.SignalResumed,this.handleReconnected).on(Oe.Restarting,this.handleReconnecting).on(Oe.Resuming,this.handleReconnecting).on(Oe.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Oe.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Oe.Closing,this.handleClosing).on(Oe.SignalRequestResponse,this.handleSignalRequestResponse).on(Oe.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return J(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return J(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return J(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return J(this,arguments,void 0,function(e){var t=this;let{metadata:n,name:r,attributes:i}=e;return function*(){return new Promise((e,o)=>J(t,void 0,void 0,function*(){var t,s;try{let a=!1;const l=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=n??this.metadata)&&void 0!==t?t:"",null!==(s=r??this.name)&&void 0!==s?s:"",i),c=performance.now();for(this.pendingSignalRequests.set(l,{resolve:e,reject:e=>{o(e),a=!0},values:{name:r,metadata:n,attributes:i}});performance.now()-c<5e3&&!a;){if((!r||this.name===r)&&(!n||this.metadata===n)&&(!i||Object.entries(i).every(e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]})))return this.pendingSignalRequests.delete(l),void e();yield Bs(50)}o(new YB("Request to update local metadata timed out","TimeoutError"))}catch(e){e instanceof Error&&o(e)}}))}()})}setCameraEnabled(e,t,n){return this.setTrackEnabled(he.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(he.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(he.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(ae.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return J(this,void 0,void 0,function*(){this.encryptionType=e?yo.GCM:yo.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,n,r){return J(this,void 0,void 0,function*(){var i,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let s=this.getTrackPublication(e);if(t)if(s)yield s.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield null==t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case he.Source.Camera:t=yield this.createTracks({video:null===(i=n)||void 0===i||i});break;case he.Source.Microphone:t=yield this.createTracks({audio:null===(o=n)||void 0===o||o});break;case he.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new ou(e)}}catch(n){throw null==t||t.forEach(e=>{e.stop()}),n instanceof Error&&this.emit(ae.MediaDevicesError,n,HA(e)),this.pendingPublishing.delete(e),n}for(const r of t){const t=Object.assign(Object.assign({},this.roomOptions.publishDefaults),n);e===he.Source.Microphone&&Jc(r)&&t.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),r.startPreConnectBuffer())}try{const e=[];for(const n of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Lt(n))),e.push(this.publishTrack(n,r));[s]=yield Promise.all(e)}catch(e){throw null==t||t.forEach(e=>{e.stop()}),e}finally{this.pendingPublishing.delete(e)}}else if(!(null!=s&&s.track)&&this.pendingPublishing.has(e)&&(s=yield this.waitForPendingPublicationOfSource(e),s||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),s&&s.track)if(e===he.Source.ScreenShare){s=yield this.unpublishTrack(s.track);const e=this.getTrackPublication(he.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield s.mute();return s})}enableCameraAndMicrophone(){return J(this,void 0,void 0,function*(){if(!this.pendingPublishing.has(he.Source.Camera)&&!this.pendingPublishing.has(he.Source.Microphone)){this.pendingPublishing.add(he.Source.Camera),this.pendingPublishing.add(he.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(e=>this.publishTrack(e)))}finally{this.pendingPublishing.delete(he.Source.Camera),this.pendingPublishing.delete(he.Source.Microphone)}}})}createTracks(e){return J(this,void 0,void 0,function*(){var t,n;e??(e={});const r=eee(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults);try{return(yield u_(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(e=>(Jc(e)&&(this.microphoneError=void 0,e.setAudioContext(this.audioContext),e.source=he.Source.Microphone,this.emit(ae.AudioStreamAcquired)),_p(e)&&(this.cameraError=void 0,e.source=he.Source.Camera),e))}catch(t){throw t instanceof Error&&(e.audio&&(this.microphoneError=t),e.video&&(this.cameraError=t)),t}})}createScreenTracks(e){return J(this,void 0,void 0,function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new dO("getDisplayMedia not supported");void 0===e.resolution&&!ASe()&&(e.resolution=eT.h1080fps30.resolution);const t=qSe(e),n=yield navigator.mediaDevices.getDisplayMedia(t),r=n.getVideoTracks();if(0===r.length)throw new ou("no video track found");const i=new nv(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});i.source=he.Source.ScreenShare,e.contentHint&&(i.mediaStreamTrack.contentHint=e.contentHint);const o=[i];if(n.getAudioTracks().length>0){this.emit(ae.AudioStreamAcquired);const e=new mC(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=he.Source.ScreenShareAudio,o.push(e)}return o})}publishTrack(e,t){return J(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return J(this,arguments,void 0,function(e,t){var n=this;let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var i,o,s,a;let l,c;if(Bl(e)&&e.setAudioContext(n.audioContext),yield null===(i=n.reconnectFuture)||void 0===i?void 0:i.promise,n.republishPromise&&!r&&(yield n.republishPromise),$h(e)&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)l=e.getConstraints();else{let t;switch(l=e.constraints,e.source){case he.Source.Microphone:t="audioinput";break;case he.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(l=Object.assign(Object.assign({},l),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new mC(e,l,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new nv(e,l,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new ou("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach(t=>{t.track&&t.track===e&&(c=t)}),c)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),Lt(c))),c;const u="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,d=null!==(o=null==t?void 0:t.forceStereo)&&void 0!==o?o:u;d&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),Lt(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(s=t.dtx)&&void 0!==s||(t.dtx=!1),null!==(a=t.red)&&void 0!==a||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!PSe()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=new Promise((t,r)=>J(n,void 0,void 0,function*(){try{if(this.engine.client.currentState!==jn.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Lt(e)}));const n=setTimeout(()=>{r(new WB("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(n);const i=yield this.publish(e,h,d);t(i)}else try{const n=yield this.publish(e,h,d);t(n)}catch(e){r(e)}}catch(e){r(e)}}));n.pendingPublishPromises.set(e,p);try{return yield p}catch(e){throw e}finally{n.pendingPublishPromises.delete(e)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Wc),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Lt(e))),!1;const{canPublish:t,canPublishSources:n}=this.permissions;return!(!t||0!==n.length&&!n.map(e=>WSe(e)).includes(e.source))||(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Lt(e))),!1)}publish(e,t,n){return J(this,void 0,void 0,function*(){var r,i,o,s,a,l,c,u,d,h;if(!this.hasPermissionsToPublish(e))throw new WB("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(t=>$h(e)&&t.source===e.source)&&e.source!==he.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Lt(e))),t.stopMicTrackOnMute&&Jc(e)&&(e.stopOnMute=!0),e.source===he.Source.ScreenShare&&tv()&&(t.simulcast=!1),"av1"===t.videoCodec&&!ISe()&&(t.videoCodec=void 0),"vp9"===t.videoCodec&&!kSe()&&(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=VA),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(e=>t.videoCodec===iw(e.mime))||(t.videoCodec=iw(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(Re.Muted,this.onTrackMuted),e.on(Re.Unmuted,this.onTrackUnmuted),e.on(Re.Ended,this.handleTrackEnded),e.on(Re.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Re.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Re.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const f=[],m=!(null===(r=t.dtx)||void 0===r||r),v=e.getSourceTrackSettings();v.autoGainControl&&f.push(bi.TF_AUTO_GAIN_CONTROL),v.echoCancellation&&f.push(bi.TF_ECHO_CANCELLATION),v.noiseSuppression&&f.push(bi.TF_NOISE_SUPPRESSION),v.channelCount&&v.channelCount>1&&f.push(bi.TF_STEREO),m&&f.push(bi.TF_NO_DTX),Bl(e)&&e.hasPreConnectBuffer&&f.push(bi.TF_PRECONNECT_BUFFER);const g=new TA({cid:e.mediaStreamTrack.id,name:t.name,type:he.kindToProto(e.kind),muted:e.isMuted,source:he.sourceToProto(e.source),disableDtx:m,encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(i=t.red)||void 0===i||i),stream:null==t?void 0:t.stream,backupCodecPolicy:null==t?void 0:t.backupCodecPolicy,audioFeatures:f});let y;if(e.kind===he.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch{const t=null!==(s=null===(o=this.roomOptions.videoCaptureDefaults)||void 0===o?void 0:o.resolution)&&void 0!==s?s:zc.h720.resolution;n={width:t.width,height:t.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{dims:n}))}g.width=n.width,g.height=n.height,Sd(e)&&(qc(p)&&(e.source===he.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Lt(e))))),t.scalabilityMode=null!==(a=t.scalabilityMode)&&void 0!==a?a:"L3T3_KEY"),g.simulcastCodecs=[new CA({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:VA}),t.backupCodec&&p!==t.backupCodec.codec&&g.encryption===yo.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),g.simulcastCodecs.push(new CA({codec:t.backupCodec.codec,cid:""})))),y=GA(e.source===he.Source.ScreenShare,g.width,g.height,t),g.layers=yH(g.width,g.height,y,qc(t.videoCodec))}else e.kind===he.Kind.Audio&&(y=[{maxBitrate:null===(l=t.audioPreset)||void 0===l?void 0:l.maxBitrate,priority:null!==(u=null===(c=t.audioPreset)||void 0===c?void 0:c.priority)&&void 0!==u?u:"high",networkPriority:null!==(h=null===(d=t.audioPreset)||void 0===d?void 0:d.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new zr("cannot publish track when not connected");const b=()=>J(this,void 0,void 0,function*(){var n,r,i;if(!this.engine.pcManager)throw new zr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,y),this.emit(ae.LocalSenderCreated,e.sender,e),Sd(e)&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=A2e(e)),e.setDegradationPreference(t.degradationPreference)),y)if(tv()&&e.kind===he.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:null!==(r=y[0])&&void 0!==r&&r.maxBitrate?y[0].maxBitrate/1e3:0})}else e.codec&&qc(e.codec)&&null!==(i=y[0])&&void 0!==i&&i.maxBitrate&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:g.cid,codec:e.codec,maxbr:y[0].maxBitrate/1e3});yield this.engine.negotiate()});let w;const _=new Promise((t,n)=>J(this,void 0,void 0,function*(){var r;try{w=yield this.engine.addTrack(g),t(w)}catch(t){e.sender&&!(null===(r=this.engine.pcManager)||void 0===r)&&r.publisher&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(t=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{error:t}))})),n(t)}}));if(this.enabledPublishVideoCodecs.length>0)w=(yield Promise.all([_,b()]))[0];else{let n;if(w=yield _,w.codecs.forEach(e=>{void 0===n&&(n=e.mimeType)}),n&&e.kind===he.Kind.Video){const r=iw(n);r!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{codec:r})),t.videoCodec=r,y=GA(e.source===he.Source.ScreenShare,g.width,g.height,t))}yield b()}const S=new WA(e.kind,w,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(S.on(Re.CpuConstrained,e=>this.onTrackCpuConstrained(e,S)),S.options=t,e.sid=w.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:w})),Sd(e)?e.startMonitor(this.engine.client):Bl(e)&&e.startMonitor(),this.addTrackPublication(S),this.emit(ae.LocalTrackPublished,S),Bl(e)&&w.audioFeatures.includes(bi.TF_PRECONNECT_BUFFER)){const t=e.getPreConnectBuffer(),n=e.getPreConnectBufferMimeType();this.on(ae.LocalTrackSubscribed,t=>{if(t.trackSid===w.sid){if(!e.hasPreConnectBuffer)return void this.log.warn("subscribe event came to late, buffer already closed",this.logContext);this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Lt(e))),e.stopPreConnectBuffer()}}),t&&new Promise((r,i)=>J(this,void 0,void 0,function*(){var o,s,a,l,c,u;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Lt(e)));const f=setTimeout(()=>{i(new Error("agent not active within 10 seconds"))},1e4),m=yield this.waitUntilActiveAgentPresent();clearTimeout(f),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Lt(e)));const g=yield this.streamBytes({name:"preconnect-buffer",mimeType:n,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[m.identity],attributes:{trackId:S.trackSid,sampleRate:String(null!==(c=v.sampleRate)&&void 0!==c?c:"48000"),channels:String(null!==(u=v.channelCount)&&void 0!==u?u:"1")}});try{for(var d,h=!0,p=su(t);!(o=(d=yield p.next()).done);h=!0){l=d.value,h=!1;const e=l;yield g.write(e)}}catch(e){s={error:e}}finally{try{!h&&!o&&(a=p.return)&&(yield a.call(p))}finally{if(s)throw s.error}}yield g.close(),r()}catch(e){i(e)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Lt(e)))}).catch(t=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{error:t}))})}return S})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return J(this,void 0,void 0,function*(){var r;if(this.encryptionType!==yo.NONE)return;let i;if(this.trackPublications.forEach(t=>{t.track&&t.track===e&&(i=t)}),!i)throw new ou("track is not published");if(!Sd(e))throw new ou("track is not a video track");const o=Object.assign(Object.assign({},null===(r=this.roomOptions)||void 0===r?void 0:r.publishDefaults),n),s=I2e(e,t,o);if(!s)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Lt(e)));const a=e.addSimulcastTrack(t,s);if(!a)return;const l=new TA({cid:a.mediaStreamTrack.id,type:he.kindToProto(e.kind),muted:e.isMuted,source:he.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:a.mediaStreamTrack.id}]});if(l.layers=yH(l.width,l.height,s),!this.engine||this.engine.isClosed)throw new zr("cannot publish track when not connected");const c=(yield Promise.all([this.engine.addTrack(l),(()=>J(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,a,o,s),yield this.engine.negotiate()}))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:s,trackInfo:c}))})}unpublishTrack(e,t){return J(this,void 0,void 0,function*(){var n,r;if($h(e)){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Lt(e))),yield t)}const i=this.getPublicationForTrack(e),o=i?Lt(i):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!i||!i.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));(e=i.track).off(Re.Muted,this.onTrackMuted),e.off(Re.Unmuted,this.onTrackUnmuted),e.off(Re.Ended,this.handleTrackEnded),e.off(Re.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Re.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Re.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(r=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===r||r),t?e.stop():e.stopMonitor();let s=!1;const a=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<pr.FAILED&&a)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===a&&(e.direction="inactive",s=!0);if(this.engine.removeTrack(a)&&(s=!0),Sd(e)){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(s=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(e){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:e}))}switch(this.trackPublications.delete(i.trackSid),i.kind){case he.Kind.Audio:this.audioTrackPublications.delete(i.trackSid);break;case he.Kind.Video:this.videoTrackPublications.delete(i.trackSid)}return this.emit(ae.LocalTrackUnpublished,i),i.setTrack(void 0),s&&(yield this.engine.negotiate()),i})}unpublishTracks(e){return J(this,void 0,void 0,function*(){return(yield Promise.all(e.map(e=>this.unpublishTrack(e)))).filter(e=>!!e)})}republishAllTracks(e){return J(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise((r,i)=>J(t,void 0,void 0,function*(){try{const t=[];this.trackPublications.forEach(n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))}),yield Promise.all(t.map(e=>J(this,void 0,void 0,function*(){const t=e.track;yield this.unpublishTrack(t,!1),n&&!t.isMuted&&t.source!==he.Source.ScreenShare&&t.source!==he.Source.ScreenShareAudio&&(Bl(t)||Sd(t))&&!t.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))),r()}catch(e){i(e)}finally{this.republishPromise=void 0}})),yield t.republishPromise}()})}publishData(e){return J(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const r=n.reliable?Rt.RELIABLE:Rt.LOSSY,i=n.destinationIdentities,o=n.topic,s=new Ms({kind:r,value:{case:"user",value:new VQ({participantIdentity:t.identity,payload:e,destinationIdentities:i,topic:o})}});yield t.engine.sendDataPacket(s,r)}()})}publishDtmf(e,t){return J(this,void 0,void 0,function*(){const n=new Ms({kind:Rt.RELIABLE,value:{case:"sipDtmf",value:new qQ({code:e,digit:t})}});yield this.engine.sendDataPacket(n,Rt.RELIABLE)})}sendChatMessage(e,t){return J(this,void 0,void 0,function*(){const n={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:null==t?void 0:t.attachments},r=new Ms({value:{case:"chatMessage",value:new yA(Object.assign(Object.assign({},n),{timestamp:Jn.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(r,Rt.RELIABLE),this.emit(ae.ChatMessage,n),n})}editChatMessage(e,t){return J(this,void 0,void 0,function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),r=new Ms({value:{case:"chatMessage",value:new yA(Object.assign(Object.assign({},n),{timestamp:Jn.parse(n.timestamp),editTimestamp:Jn.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Rt.RELIABLE),this.emit(ae.ChatMessage,n),n})}sendText(e,t){return J(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)})}streamText(e){return J(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,t){return J(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)})}streamBytes(e){return J(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return J(this,arguments,void 0,function(e){var t=this;let{destinationIdentity:n,method:r,payload:i,responseTimeout:o=1e4}=e;return function*(){return new Promise((e,s)=>J(t,void 0,void 0,function*(){var t,a,l,c;if(vO(i)>aee)return void s(vr.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if(null!==(a=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)&&void 0!==a&&a.version&&nl(null===(c=null===(l=this.engine.latestJoinResponse)||void 0===l?void 0:l.serverInfo)||void 0===c?void 0:c.version,"1.8.0")<0)return void s(vr.builtIn("UNSUPPORTED_SERVER"));const u=crypto.randomUUID();yield this.publishRpcRequest(n,u,r,i,o-2e3);const d=setTimeout(()=>{this.pendingAcks.delete(u),s(vr.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(u),clearTimeout(h)},2e3);this.pendingAcks.set(u,{resolve:()=>{clearTimeout(d)},participantIdentity:n});const h=setTimeout(()=>{this.pendingResponses.delete(u),s(vr.builtIn("RESPONSE_TIMEOUT"))},o);this.pendingResponses.set(u,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(u)&&(console.warn("RPC response received before ack",u),this.pendingAcks.delete(u),clearTimeout(d)),n?s(n):e(t??"")},participantIdentity:n})}))}()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const r=this.pendingResponses.get(e);r?(r.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,n,r,i){return J(this,void 0,void 0,function*(){const o=new Ms({destinationIdentities:[e],kind:Rt.RELIABLE,value:{case:"rpcRequest",value:new GQ({id:t,method:n,payload:r,responseTimeoutMs:i,version:1})}});yield this.engine.sendDataPacket(o,Rt.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:r}]of this.pendingResponses)n===e&&(r(null,vr.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(e=>"video"===e.mime.split("/")[0].toLowerCase())}updateInfo(e){return!!super.updateInfo(e)&&(e.tracks.forEach(e=>{var t,n;const r=this.trackPublications.get(e.sid);if(r){const i=r.isMuted||null!==(n=null===(t=r.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;i!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(r)),{mutedOnServer:i})),this.engine.client.sendMuteTrack(e.sid,i))}}),!0)}setActiveAgent(e){var t,n,r,i;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?null===(n=null===(t=this.activeAgentFuture)||void 0===t?void 0:t.resolve)||void 0===n||n.call(t,e):null===(i=null===(r=this.activeAgentFuture)||void 0===r?void 0:r.reject)||void 0===i||i.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Wc),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(n=>{const r=n.track;r&&(e instanceof MediaStreamTrack?(Bl(r)||Sd(r))&&r.mediaStreamTrack===e&&(t=n):e===r&&(t=n))}),t}waitForPendingPublicationOfSource(e){return J(this,void 0,void 0,function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find(t=>{let[n]=t;return n.source===e});if(t)return t[1];yield Bs(20)}})}}class gC extends Ql{constructor(e,t,n,r){super(e,t.sid,t.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=e=>{this.setTrack(void 0),this.emit(Re.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.visible=e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensionsAdaptiveStream=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Q3({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new YQ({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Re.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?Ql.SubscriptionStatus.Unsubscribed:super.isSubscribed?Ql.SubscriptionStatus.Subscribed:Ql.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Ql.PermissionStatus.Allowed:Ql.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return void 0!==this.requestedDisabled?!this.requestedDisabled:!this.isAdaptiveStream||this.visible}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.requestedVideoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.requestedVideoDimensions)||void 0===n?void 0:n.height)===e.height||(Gk(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Gk(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return null!==(e=this.requestedMaxQuality)&&void 0!==e?e:_o.HIGH}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(Re.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(Re.VisibilityChanged,this.handleVisibilityChange),r.off(Re.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(Re.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Re.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Re.VisibilityChanged,this.handleVisibilityChange),e.on(Re.Ended,this.handleEnded),this.emit(Re.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Re.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Re.Muted:Re.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Re.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Re.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Gk(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new rZ({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===he.Kind.Video){let t=this.requestedVideoDimensions;if(void 0!==this.videoDimensionsAdaptiveStream)if(t)iH(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream);else if(void 0!==this.requestedMaxQuality&&this.trackInfo){const e=YSe(this.trackInfo,this.requestedMaxQuality);e&&iH(this.videoDimensionsAdaptiveStream,e)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):void 0!==this.requestedMaxQuality?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:_o.HIGH})),e.quality=_o.HIGH)}this.emit(Re.UpdateSettings,e)}}class vC extends hee{static fromParticipantInfo(e,t,n){return new vC(e,t.sid,t.identity,t.name,t.metadata,t.attributes,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,r,i,o,s){super(t,n||"",r,i,o,s,arguments.length>7&&void 0!==arguments[7]?arguments[7]:fb.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Re.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(Re.UpdateSubscription,e=>{e.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(e)}),e.on(Re.SubscriptionPermissionChanged,t=>{this.emit(ae.TrackSubscriptionPermissionChanged,e,t)}),e.on(Re.SubscriptionStatusChanged,t=>{this.emit(ae.TrackSubscriptionStatusChanged,e,t)}),e.on(Re.Subscribed,t=>{this.emit(ae.TrackSubscribed,t,e)}),e.on(Re.Unsubscribed,t=>{this.emit(ae.TrackUnsubscribed,t,e)}),e.on(Re.SubscriptionFailed,t=>{this.emit(ae.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,r,i,o){let s=this.getTrackPublicationBySid(t);if(s||t.startsWith("TR")||this.trackPublications.forEach(t=>{!s&&e.kind===t.kind.toString()&&(s=t)}),!s)return 0===o?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(ae.TrackSubscriptionFailed,t)):(void 0===o&&(o=20),void setTimeout(()=>{this.addSubscribedMediaTrack(e,t,n,r,i,o-1)},150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Lt(s))),void this.emit(ae.TrackSubscriptionFailed,t);let a;return a="video"===e.kind?new q2e(e,t,r,i):new fee(e,t,r,this.audioContext,this.audioOutput),a.source=s.source,a.isMuted=s.isMuted,a.setMediaStream(n),a.start(),s.setTrack(a),this.volumeMap.has(s.source)&&$A(a)&&Jc(a)&&a.setVolume(this.volumeMap.get(s.source)),s}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach(e=>{var r,i;let o=this.getTrackPublicationBySid(e.sid);if(o)o.updateInfo(e);else{const t=he.kindFromProto(e.type);if(!t)return;o=new gC(t,e,null===(r=this.signalClient.connectOptions)||void 0===r?void 0:r.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(i=this.loggerOptions)||void 0===i?void 0:i.loggerName}),o.updateInfo(e),n.set(e.sid,o);const s=Array.from(this.trackPublications.values()).find(e=>e.source===(null==o?void 0:o.source));s&&o.source!==he.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Lt(s),newTrack:Lt(o)})),this.addTrackPublication(o)}t.set(e.sid,o)}),this.trackPublications.forEach(e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Lt(e))),this.unpublishTrack(e.trackSid,!0))}),n.forEach(e=>{this.emit(ae.TrackPublished,e)}),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:r}=n;switch(r&&(r.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case he.Kind.Audio:this.audioTrackPublications.delete(e);break;case he.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(ae.TrackUnpublished,n)}setAudioOutput(e){return J(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(n=>{var r;Jc(n.track)&&$A(n.track)&&t.push(n.track.setSinkId(null!==(r=e.deviceId)&&void 0!==r?r:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(Pt||(Pt={}));const J2e=4e3;class Ru extends ul.EventEmitter{constructor(e){var t,n,r,i;if(super(),t=this,this.state=Pt.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=kt,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(e,t,n)=>J(this,void 0,void 0,function*(){var r;if(!xSe())throw tl()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const i=yield this.disconnectLock.lock();if(this.state===Pt.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),i(),Promise.resolve();if(this.connectFuture)return i(),this.connectFuture.promise;this.setAndEmitConnectionState(Pt.Connecting),(null===(r=this.regionUrlProvider)||void 0===r?void 0:r.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),jA(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new KA(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then(e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)}).catch(e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))}));const o=(r,s,a)=>J(this,void 0,void 0,function*(){var l,c;this.abortController&&this.abortController.abort();const u=new AbortController;this.abortController=u,null==i||i();try{yield this.attemptConnection(a??e,t,n,u),this.abortController=void 0,r()}catch(e){if(this.regionUrlProvider&&e instanceof _n&&e.reason!==Bt.Cancelled&&e.reason!==Bt.NotAllowed){let t=null;try{t=yield this.regionUrlProvider.getNextBestRegionUrl(null===(l=this.abortController)||void 0===l?void 0:l.signal)}catch(e){if(e instanceof _n&&(401===e.status||e.reason===Bt.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void s(e)}!t||null!==(c=this.abortController)&&void 0!==c&&c.signal.aborted?(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,rH(e)),s(e)):(this.log.info("Initial connection failed with ConnectionError: ".concat(e.message,". Retrying with another region: ").concat(t),this.logContext),this.recreateEngine(),yield o(r,s,t))}else{let t=Xa.UNKNOWN_REASON;e instanceof _n&&(t=rH(e)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t),s(e)}}}),s=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Wc((e,t)=>{o(e,t,s)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(e,t,n,r,i,o)=>J(this,void 0,void 0,function*(){var s,a,l;const c=yield n.join(e,t,{autoSubscribe:r.autoSubscribe,adaptiveStream:"object"==typeof i.adaptiveStream||i.adaptiveStream,maxRetries:r.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:r.websocketTimeout},o.signal);let u=c.serverInfo;if(u||(u={version:c.serverVersion,region:c.serverRegion}),this.serverInfo=u,this.log.debug("connected to Livekit Server ".concat(Object.entries(u).map(e=>{let[t,n]=e;return"".concat(t,": ").concat(n)}).join(", ")),{room:null===(s=c.room)||void 0===s?void 0:s.name,roomSid:null===(a=c.room)||void 0===a?void 0:a.sid,identity:null===(l=c.participant)||void 0===l?void 0:l.identity}),!u.version)throw new pSe("unknown server version");return"0.15.1"===u.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),i.dynacast=!1),c}),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(e){this.log.error(e instanceof Error?e.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:e}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,r)=>J(this,void 0,void 0,function*(){var i,o;this.state===Pt.Reconnecting||this.isResuming||null!==(i=this.engine)&&void 0!==i&&i.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!(null===(o=this.regionUrlProvider)||void 0===o)&&o.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},gO),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,r);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(ue.SignalConnected)}catch(e){yield this.engine.close(),this.recreateEngine();const t=new _n("could not establish signal connection",Bt.ServerUnreachable);throw e instanceof Error&&(t.message="".concat(t.message,": ").concat(e.message)),e instanceof _n&&(t.reason=e.reason,t.status=e.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:e})),t}if(r.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new _n("Connection attempt aborted",Bt.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,r)}catch(e){throw yield this.engine.close(),this.recreateEngine(),e}Us()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Us()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Pt.Connected),this.emit(ue.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return J(t,[...n],void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,r,i,o;const s=yield e.disconnectLock.lock();try{if(e.state===Pt.Disconnected)return void e.log.debug("already disconnected",e.logContext);e.log.info("disconnect from room",Object.assign({},e.logContext)),(e.state===Pt.Connecting||e.state===Pt.Reconnecting||e.isResuming)&&(e.log.warn("abort connection attempt",e.logContext),null===(n=e.abortController)||void 0===n||n.abort(),null===(i=null===(r=e.connectFuture)||void 0===r?void 0:r.reject)||void 0===i||i.call(r,new _n("Client initiated disconnect",Bt.Cancelled)),e.connectFuture=void 0),!(null===(o=e.engine)||void 0===o)&&o.client.isDisconnected||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,Xa.CLIENT_INITIATED),e.engine=void 0}finally{s()}}()})},this.onPageLeave=()=>J(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>J(this,void 0,void 0,function*(){const e=[],t=wo();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=qk();e.enabled=!0;const r=new MediaStream([e]);n.srcObject=r,document.addEventListener("visibilitychange",()=>{n&&(n.srcObject=document.hidden?null:r,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(n),this.once(ue.Disconnected,()=>{null==n||n.remove(),n=null})}e.push(n)}this.remoteParticipants.forEach(t=>{t.audioTrackPublications.forEach(t=>{t.track&&t.track.attachedElements.forEach(t=>{e.push(t)})})});try{yield Promise.all([this.acquireAudioContext(),...e.map(e=>(e.muted=!1,e.play()))]),this.handleAudioPlaybackStarted()}catch(e){throw this.handleAudioPlaybackFailed(e),e}}),this.startVideo=()=>J(this,void 0,void 0,function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach(t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach(t=>{e.includes(t)||e.push(t)})});yield Promise.all(e.map(e=>e.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(Pt.Reconnecting)&&this.emit(ue.Reconnecting)},this.handleSignalRestarted=e=>J(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(e){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:e}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch{return}this.setAndEmitConnectionState(Pt.Connected),this.emit(ue.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=e=>{e.forEach(e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===Eg.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)})},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach(e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}}),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))}),this.activeSpeakers=t,this.emitWhenConnected(ue.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach(e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)}),e.forEach(e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))});const n=Array.from(t.values());n.sort((e,t)=>t.audioLevel-e.audioLevel),this.activeSpeakers=n,this.emitWhenConnected(ue.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach(e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const r=he.streamStateFromProto(e.state);r!==n.track.streamState&&(n.track.streamState=r,t.emit(ae.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(ue.TrackStreamStateChanged,n,n.track.streamState,t))})},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find(t=>t.trackPublications.has(e.trackSid));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);if("user"===e.value.case)this.handleUserPacket(t,e.value.value,e.kind);else if("transcription"===e.value.case)this.handleTranscription(t,e.value.value);else if("sipDtmf"===e.value.case)this.handleSipDtmf(t,e.value.value);else if("chatMessage"===e.value.case)this.handleChatMessage(t,e.value.value);else if("metrics"===e.value.case)this.handleMetrics(e.value.value,t);else if("streamHeader"===e.value.case||"streamChunk"===e.value.case||"streamTrailer"===e.value.case)this.handleDataStream(e);else if("rpcRequest"===e.value.case){const t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version)}},this.handleUserPacket=(e,t,n)=>{this.emit(ue.DataReceived,t.payload,e,n,t.topic),null==e||e.emit(ae.DataReceived,t.payload,n)},this.handleSipDtmf=(e,t)=>{this.emit(ue.SipDTMFReceived,t,e),null==e||e.emit(ae.SipDTMFReceived,t)},this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),r=null==n?void 0:n.trackPublications.get(t.trackId),i=jSe(t,this.transcriptionReceivedTimes);null==r||r.emit(Re.TranscriptionReceived,i),null==n||n.emit(ae.TranscriptionReceived,i,r),this.emit(ue.TranscriptionReceived,i,n,r)},this.handleChatMessage=(e,t)=>{const n=FSe(t);this.emit(ue.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(ue.MetricsReceived,e,t)},this.handleDataStream=e=>{this.incomingDataStreamManager.handleDataStreamPacket(e)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(ue.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(ue.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(ue.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(ue.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>J(this,void 0,void 0,function*(){var e;"iOS"!==(null===(e=wo())||void 0===e?void 0:e.os)&&(yield this.selectDefaultDevices()),this.emit(ue.MediaDevicesChanged)}),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(ue.RoomMetadataChanged,e.metadata),(null==t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(ue.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach(e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)})},this.onLocalParticipantMetadataChanged=e=>{this.emit(ue.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(ue.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(ue.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(ue.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(ue.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null==e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>J(this,void 0,void 0,function*(){var t,n,r,i,o,s;null===(t=e.track)||void 0===t||t.on(Re.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(Re.Restarted,this.onLocalTrackRestarted),null===(o=null===(i=null===(r=e.track)||void 0===r?void 0:r.getProcessor())||void 0===i?void 0:i.onPublish)||void 0===o||o.call(i,this),this.emit(ue.LocalTrackPublished,e,this.localParticipant),Bl(e.track)&&(yield e.track.checkForSilence())&&this.emit(ue.LocalAudioSilenceDetected,e);const a=yield null===(s=e.track)||void 0===s?void 0:s.getDeviceId(!1),l=HA(e.source);l&&a&&a!==this.localParticipant.activeDeviceMap.get(l)&&(this.localParticipant.activeDeviceMap.set(l,a),this.emit(ue.ActiveDeviceChanged,l,a))}),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(Re.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(Re.Restarted,this.onLocalTrackRestarted),this.emit(ue.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>J(this,void 0,void 0,function*(){const t=yield e.getDeviceId(!1),n=HA(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(ue.ActiveDeviceChanged,n,t))}),this.onLocalConnectionQualityChanged=e=>{this.emit(ue.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=(e,t)=>{this.emit(ue.MediaDevicesError,e,t)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(ue.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(ue.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},f2e),e),this.log=Tu(null!==(n=this.options.loggerName)&&void 0!==n?n:nc.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},see),null==e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},oee),null==e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},d2e),null==e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new $2e,this.outgoingDataStreamManager=new V2e(this.engine,this.log),this.disconnectLock=new ds,this.localParticipant=new X2e("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",nf(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",nf(this.options.audioCaptureDefaults.deviceId)),!(null===(r=this.options.audioOutput)||void 0===r)&&r.deviceId&&this.switchActiveDevice("audiooutput",nf(this.options.audioOutput.deviceId)).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),Us()){const e=new AbortController;null===(i=navigator.mediaDevices)||void 0===i||i.addEventListener("devicechange",this.handleDeviceChange,{signal:e.signal}),Ru.cleanupRegistry&&Ru.cleanupRegistry.register(this,()=>{e.abort()})}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return J(this,void 0,void 0,function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new XSe(this.options.e2ee),this.e2eeManager.on(Gd.ParticipantEncryptionStatusChanged,(e,t)=>{BSe(t)&&(this.isE2EEEnabled=e),this.emit(ue.ParticipantEncryptionStatusChanged,e,t)}),this.e2eeManager.on(Gd.EncryptionError,e=>this.emit(ue.EncryptionError,e)),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return J(this,void 0,void 0,function*(){return this.state===Pt.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(Oe.RoomUpdate,n),e(t.sid))};this.engine.on(Oe.RoomUpdate,n),this.once(ue.Disconnected,()=>{this.engine.off(Oe.RoomUpdate,n),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new M2e(this.options),this.engine.on(Oe.ParticipantUpdate,this.handleParticipantUpdates).on(Oe.RoomUpdate,this.handleRoomUpdate).on(Oe.SpeakersChanged,this.handleSpeakersChanged).on(Oe.StreamStateChanged,this.handleStreamStateUpdate).on(Oe.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Oe.SubscriptionError,this.handleSubscriptionError).on(Oe.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Oe.MediaTrackAdded,(e,t,n)=>{this.onTrackAdded(e,t,n)}).on(Oe.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(Oe.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Oe.DataPacketReceived,this.handleDataPacket).on(Oe.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Pt.SignalReconnecting)&&this.emit(ue.SignalReconnecting)}).on(Oe.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Pt.Connected)&&this.emit(ue.Reconnected)}).on(Oe.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Pt.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(Oe.Restarting,this.handleRestarting).on(Oe.SignalRestarted,this.handleSignalRestarted).on(Oe.Offline,()=>{this.setAndEmitConnectionState(Pt.Reconnecting)&&this.emit(ue.Reconnecting)}).on(Oe.DCBufferStatusChanged,(e,t)=>{this.emit(ue.DCBufferStatusChanged,e,t)}).on(Oe.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(t=>{let{trackSid:n}=t;return n===e});t?(this.localParticipant.emit(ae.LocalTrackSubscribed,t),this.emitWhenConnected(ue.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)}).on(Oe.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((e,t)=>{this.handleParticipantDisconnected(t,e)}),this.emit(ue.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return _i.getInstance().getDevices(e,t)}prepareConnection(e,t){return J(this,void 0,void 0,function*(){if(this.state===Pt.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(jA(new URL(e))&&t){this.regionUrlProvider=new KA(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===Pt.Disconnected&&(this.regionUrl=n,yield fetch(FA(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(FA(e),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return J(this,void 0,void 0,function*(){let n,r=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new Mc({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new Mc({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new Mc({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new Mc({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>J(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new Mc({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>J(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new Mc({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new Mc({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),r=()=>J(this,void 0,void 0,function*(){const e=this.engine.client.onLeave;e&&e(new Z3({reason:Xa.CLIENT_INITIATED,action:wg.RECONNECT}))});break;case"subscriber-bandwidth":if(void 0===t||"number"!=typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new Mc({scenario:{case:"subscriberBandwidth",value:Th(t)}});break;case"leave-full-reconnect":n=new Mc({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return J(this,arguments,void 0,function(e,t){var n=this;let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function*(){var i,o,s,a,l,c,u;let d=!0,h=!1;const p=r?{exact:t}:t;if("audioinput"===e){h=0===n.localParticipant.audioTrackPublications.size;const t=null!==(i=n.getActiveDevice(e))&&void 0!==i?i:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=p;const r=Array.from(n.localParticipant.audioTrackPublications.values()).filter(e=>e.source===he.Source.Microphone);try{d=(yield Promise.all(r.map(e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(e){throw n.options.audioCaptureDefaults.deviceId=t,e}const o=r.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});d&&o&&(h=!0)}else if("videoinput"===e){h=0===n.localParticipant.videoTrackPublications.size;const t=null!==(o=n.getActiveDevice(e))&&void 0!==o?o:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=p;const r=Array.from(n.localParticipant.videoTrackPublications.values()).filter(e=>e.source===he.Source.Camera);try{d=(yield Promise.all(r.map(e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(e){throw n.options.videoCaptureDefaults.deviceId=t,e}const i=r.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});d&&i&&(h=!0)}else if("audiooutput"===e){if(h=!0,!UA()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");n.options.webAudioMix&&(t=null!==(s=yield _i.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==s?s:""),null!==(a=(u=n.options).audioOutput)&&void 0!==a||(u.audioOutput={});const r=null!==(l=n.getActiveDevice(e))&&void 0!==l?l:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t;try{n.options.webAudioMix&&(null===(c=n.audioContext)||void 0===c||c.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map(e=>e.setAudioOutput({deviceId:t})))}catch(e){throw n.options.audioOutput.deviceId=r,e}}return h&&(n.localParticipant.activeDeviceMap.set(e,t),n.emit(ue.ActiveDeviceChanged,e,t)),d}()})}setupLocalParticipantEvents(){this.localParticipant.on(ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ae.AttributesChanged,this.onLocalAttributesChanged).on(ae.TrackMuted,this.onLocalTrackMuted).on(ae.TrackUnmuted,this.onLocalTrackUnmuted).on(ae.LocalTrackPublished,this.onLocalTrackPublished).on(ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ae.MediaDevicesError,this.onMediaDevicesError).on(ae.AudioStreamAcquired,this.startAudio).on(ae.ChatMessage,this.onLocalChatMessageSent).on(ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===Pt.Connecting||this.state===Pt.Reconnecting){const r=()=>{this.onTrackAdded(e,t,n),i()},i=()=>{this.off(ue.Reconnected,r),this.off(ue.Connected,r),this.off(ue.Disconnected,i)};return this.once(ue.Reconnected,r),this.once(ue.Connected,r),void this.once(ue.Disconnected,i)}if(this.state===Pt.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);if("ended"===e.readyState)return void this.log.info("skipping incoming track as it already ended",this.logContext);const r=RSe(t.id),i=r[0];let o=r[1],s=e.id;if(o&&o.startsWith("TR")&&(s=o),i===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const a=Array.from(this.remoteParticipants.values()).find(e=>e.sid===i);if(!a)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(i),this.logContext);let l;this.options.adaptiveStream&&(l="object"==typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),a.addSubscribedMediaTrack(e,s,t,n,l)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==Pt.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{e.unpublishTrack(t.trackSid)})}),this.localParticipant.trackPublications.forEach(t=>{var n,r,i;t.track&&this.localParticipant.unpublishTrack(t.track,e),e?(null===(n=t.track)||void 0===n||n.detach(),null===(r=t.track)||void 0===r||r.stop()):null===(i=t.track)||void 0===i||i.stopMonitor()}),this.localParticipant.off(ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ae.AttributesChanged,this.onLocalAttributesChanged).off(ae.TrackMuted,this.onLocalTrackMuted).off(ae.TrackUnmuted,this.onLocalTrackUnmuted).off(ae.LocalTrackPublished,this.onLocalTrackPublished).off(ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ae.MediaDevicesError,this.onMediaDevicesError).off(ae.AudioStreamAcquired,this.startAudio).off(ae.ChatMessage,this.onLocalChatMessageSent).off(ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Us()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Pt.Disconnected),this.emit(ue.Disconnected,t)}}}handleParticipantDisconnected(e,t){var n;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach(e=>{t.unpublishTrack(e.trackSid,!0)}),this.emit(ue.ParticipantDisconnected,t),t.setDisconnected(),null===(n=this.localParticipant)||void 0===n||n.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,n,r,i,o){return J(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),1!==o)return void(yield this.engine.publishRpcResponse(e,t,null,vr.builtIn("UNSUPPORTED_VERSION")));const s=this.rpcHandlers.get(n);if(!s)return void(yield this.engine.publishRpcResponse(e,t,null,vr.builtIn("UNSUPPORTED_METHOD")));let a=null,l=null;try{const o=yield s({requestId:t,callerIdentity:e,payload:r,responseTimeout:i});vO(o)>aee?(a=vr.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):l=o}catch(e){e instanceof vr?a=e:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),e),a=vr.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,l,a)})}selectDefaultDevices(){return J(this,void 0,void 0,function*(){var e,t,n;const r=_i.getInstance().previousDevices,i=yield _i.getInstance().getDevices(void 0,!1),o=wo();if("Chrome"===(null==o?void 0:o.name)&&"iOS"!==o.os)for(let e of i){const t=r.find(t=>t.deviceId===e.deviceId);t&&""!==t.label&&t.kind===e.kind&&t.label!==e.label&&"default"===this.getActiveDevice(e.kind)&&this.emit(ue.ActiveDeviceChanged,e.kind,e.deviceId)}const s=["audiooutput","audioinput","videoinput"];for(let o of s){const s=VSe(o),a=this.localParticipant.getTrackPublication(s);if(a&&null!==(e=a.track)&&void 0!==e&&e.isUserProvided)continue;const l=i.filter(e=>e.kind===o),c=this.getActiveDevice(o);c===(null===(t=r.filter(e=>e.kind===o)[0])||void 0===t?void 0:t.deviceId)&&l.length>0&&(null===(n=l[0])||void 0===n?void 0:n.deviceId)!==c?yield this.switchActiveDevice(o,l[0].deviceId):"audioinput"===o&&!hC()||"videoinput"===o||l.length>0&&!l.find(e=>e.deviceId===this.getActiveDevice(o))&&("audiooutput"!==o||!hC())&&(yield this.switchActiveDevice(o,l[0].deviceId))}})}acquireAudioContext(){return J(this,void 0,void 0,function*(){var e,t;if("boolean"!=typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||"closed"===this.audioContext.state)&&(this.audioContext=null!==(e=nee())&&void 0!==e?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(e=>e.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&"suspended"===this.audioContext.state)try{yield Promise.race([this.audioContext.resume(),Bs(200)])}catch(e){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:e}))}const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(ue.AudioPlaybackStatusChanged,n))})}createParticipant(e,t){var n;let r;return r=t?vC.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new vC(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!(null===(n=this.options.audioOutput)||void 0===n)&&n.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),r}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);return t&&n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(ue.ParticipantConnected,n),n.on(ae.TrackPublished,e=>{this.emitWhenConnected(ue.TrackPublished,e,n)}).on(ae.TrackSubscribed,(e,t)=>{e.kind===he.Kind.Audio?(e.on(Re.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(Re.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===he.Kind.Video&&(e.on(Re.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(Re.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(ue.TrackSubscribed,e,t,n)}).on(ae.TrackUnpublished,e=>{this.emit(ue.TrackUnpublished,e,n)}).on(ae.TrackUnsubscribed,(e,t)=>{this.emit(ue.TrackUnsubscribed,e,t,n)}).on(ae.TrackMuted,e=>{this.emitWhenConnected(ue.TrackMuted,e,n)}).on(ae.TrackUnmuted,e=>{this.emitWhenConnected(ue.TrackUnmuted,e,n)}).on(ae.ParticipantMetadataChanged,e=>{this.emitWhenConnected(ue.ParticipantMetadataChanged,e,n)}).on(ae.ParticipantNameChanged,e=>{this.emitWhenConnected(ue.ParticipantNameChanged,e,n)}).on(ae.AttributesChanged,e=>{this.emitWhenConnected(ue.ParticipantAttributesChanged,e,n)}).on(ae.ConnectionQualityChanged,e=>{this.emitWhenConnected(ue.ConnectionQualityChanged,e,n)}).on(ae.ParticipantPermissionsChanged,e=>{this.emitWhenConnected(ue.ParticipantPermissionsChanged,e,n)}).on(ae.TrackSubscriptionStatusChanged,(e,t)=>{this.emitWhenConnected(ue.TrackSubscriptionStatusChanged,e,t,n)}).on(ae.TrackSubscriptionFailed,(e,t)=>{this.emit(ue.TrackSubscriptionFailed,e,n,t)}).on(ae.TrackSubscriptionPermissionChanged,(e,t)=>{this.emitWhenConnected(ue.TrackSubscriptionPermissionChanged,e,t,n)}).on(ae.Active,()=>{this.emitWhenConnected(ue.ParticipantActive,n),n.kind===fb.AGENT&&this.localParticipant.setActiveAgent(n)}),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((e,t)=>(e.push(...t.getTrackPublications()),e),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&$Se(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ni.setInterval(()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Xa.STATE_MISMATCH)))},J2e)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ni.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(ue.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,n]=e;this.emit(t,...n)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.state===Pt.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===Pt.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return J(this,void 0,void 0,function*(){var t,n;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),i=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new J3({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Jn.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Jh({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(ue.SignalConnected),this.emit(ue.Connected),this.setAndEmitConnectionState(Pt.Connected),r.video){const e=new WA(he.Kind.Video,new rg({source:Ur.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Ka.AUDIO,name:"video-dummy"}),new nv(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:nH(160*(null!==(t=i.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(ae.LocalTrackPublished,e)}if(r.audio){const e=new WA(he.Kind.Audio,new rg({source:Ur.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Ka.AUDIO}),new mC(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:qk(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(ae.LocalTrackPublished,e)}for(let e=0;e<i.count-1;e+=1){let t=new Jh({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:Eg.ACTIVE,tracks:[],joinedAt:Jn.parse(Date.now())});const r=this.getOrCreateParticipant(t.identity,t);if(i.video){const o=nH(160*(null!==(n=i.aspectRatios[e%i.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),s=new rg({source:Ur.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Ka.AUDIO});r.addSubscribedMediaTrack(o,s.sid,new MediaStream([o]),new RTCRtpReceiver),t.tracks=[...t.tracks,s]}if(i.audio){const e=qk(),n=new rg({source:Ur.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Ka.AUDIO});r.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}r.updateInfo(t)}})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(e!==ue.ActiveSpeakersChanged&&e!==ue.TranscriptionReceived){const t=pee(n).filter(e=>void 0!==e);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function pee(e){return e.map(e=>{if(e)return Array.isArray(e)?pee(e):"object"==typeof e?"logContext"in e?e.logContext:void 0:e})}var $a;Ru.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(e=>{e()}),function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}($a||($a={}));class Lf extends ul.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.status=$a.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Ru(n.roomOptions),this.connectOptions=n.connectOptions,this.options=n}run(e){return J(this,void 0,void 0,function*(){if(this.status!==$a.IDLE)throw Error("check is running already");this.setStatus($a.RUNNING);try{yield this.perform()}catch(e){e instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(e.message):this.appendError(e.message))}return yield this.disconnect(),yield new Promise(e=>setTimeout(e,500)),this.status!==$a.SKIPPED&&this.setStatus(this.isSuccess()?$a.SUCCESS:$a.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>"error"===e.level)}connect(e){return J(this,void 0,void 0,function*(){return this.room.state===Pt.Connected||(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions)),this.room})}disconnect(){return J(this,void 0,void 0,function*(){this.room&&this.room.state!==Pt.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus($a.SKIPPED)}switchProtocol(e){return J(this,void 0,void 0,function*(){let t=!1,n=!1;if(this.room.on(ue.Reconnecting,()=>{t=!0}),this.room.once(ue.Reconnected,()=>{n=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(e=>setTimeout(e,1e3)),!t)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(n)return;yield Bs(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return null===(e=this.room)||void 0===e?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class Q2e extends Lf{get description(){return"Cloud regions"}perform(){return J(this,void 0,void 0,function*(){const e=new KA(this.url,this.token);if(!e.isCloud())return void this.skip();const t=[],n=new Set;for(let r=0;r<3;r++){const r=yield e.getNextBestRegionUrl();if(!r)break;if(n.has(r))continue;n.add(r);const i=yield this.checkCloudRegion(r);this.appendMessage("".concat(i.region," RTT: ").concat(i.rtt,"ms, duration: ").concat(i.duration,"ms")),t.push(i)}t.sort((e,t)=>.5*(e.duration-t.duration)+.5*(e.rtt-t.rtt));const r=t[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return J(this,void 0,void 0,function*(){var t,n;yield this.connect(e),"tcp"===this.options.protocol&&(yield this.switchProtocol("tcp"));const r=null===(t=this.room.serverInfo)||void 0===t?void 0:t.region;if(!r)throw new Error("Region not found");const i=yield this.room.localParticipant.streamText({topic:"test"}),o="A".repeat(1e3),s=Date.now();for(let e=0;e<1e3;e++)yield i.write(o);yield i.close();const a=Date.now(),l=yield null===(n=this.room.engine.pcManager)||void 0===n?void 0:n.publisher.getStats(),c={region:r,rtt:1e4,duration:a-s};return null==l||l.forEach(e=>{"candidate-pair"===e.type&&e.nominated&&(c.rtt=1e3*e.currentRoundTripTime)}),yield this.disconnect(),c})}}const Zk=1e4;class Z2e extends Lf{get description(){return"Connection via UDP vs TCP"}perform(){return J(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const n=this.bestStats;this.appendMessage("upstream bitrate: ".concat((n.bitrateTotal/n.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((n.rttTotal/n.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((n.jitterTotal/n.count*1e3).toFixed(2)," ms")),n.packetsLost>0&&this.appendWarning("packets lost: ".concat((n.packetsLost/n.packetsSent*100).toFixed(2),"%")),n.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((n.qualityLimitationDurations.bandwidth/10*100).toFixed(2),"%")),n.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((n.qualityLimitationDurations.cpu/10*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return J(this,void 0,void 0,function*(){yield this.connect(),"tcp"===e?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const n=t.getContext("2d");if(!n)throw new Error("Could not get canvas context");let r=0;const i=()=>{r=(r+1)%360,n.fillStyle="hsl(".concat(r,", 100%, 50%)"),n.fillRect(0,0,t.width,t.height),requestAnimationFrame(i)};i();const o=t.captureStream(30).getVideoTracks()[0],s=(yield this.room.localParticipant.publishTrack(o,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,a={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},l=setInterval(()=>J(this,void 0,void 0,function*(){const e=yield s.getRTCStatsReport();null==e||e.forEach(e=>{"outbound-rtp"===e.type?(a.packetsSent=e.packetsSent,a.qualityLimitationDurations=e.qualityLimitationDurations,a.bitrateTotal+=e.targetBitrate,a.count++):"remote-inbound-rtp"===e.type&&(a.packetsLost=e.packetsLost,a.rttTotal+=e.roundTripTime,a.jitterTotal+=e.jitter)})}),1e3);return yield new Promise(e=>setTimeout(e,Zk)),clearInterval(l),o.stop(),t.remove(),yield this.disconnect(),a})}}class eEe extends Lf{get description(){return"Can publish audio"}perform(){return J(this,void 0,void 0,function*(){var e;const t=yield this.connect(),n=yield z2e();if(yield tee(n,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(n),yield new Promise(e=>setTimeout(e,3e3));const r=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let i=0;if(r.forEach(e=>{"outbound-rtp"===e.type&&("audio"===e.kind||!e.kind&&"audio"===e.mediaType)&&(i=e.packetsSent)}),0===i)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(i," audio packets"))})}}class tEe extends Lf{get description(){return"Can publish video"}perform(){return J(this,void 0,void 0,function*(){var e;const t=yield this.connect(),n=yield K2e();yield this.checkForVideo(n.mediaStreamTrack),t.localParticipant.publishTrack(n),yield new Promise(e=>setTimeout(e,5e3));const r=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let i=0;if(r.forEach(e=>{"outbound-rtp"===e.type&&("video"===e.kind||!e.kind&&"video"===e.mediaType)&&(i+=e.packetsSent)}),0===i)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(i," video packets"))})}checkForVideo(e){return J(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const n=document.createElement("video");n.srcObject=t,n.muted=!0,yield new Promise(t=>{n.onplay=()=>{setTimeout(()=>{var r,i,o,s;const a=document.createElement("canvas"),l=e.getSettings(),c=null!==(i=null!==(r=l.width)&&void 0!==r?r:n.videoWidth)&&void 0!==i?i:1280,u=null!==(s=null!==(o=l.height)&&void 0!==o?o:n.videoHeight)&&void 0!==s?s:720;a.width=c,a.height=u;const d=a.getContext("2d");d.drawImage(n,0,0);const h=d.getImageData(0,0,a.width,a.height).data;let p=!0;for(let e=0;e<h.length;e+=4)if(0!==h[e]||0!==h[e+1]||0!==h[e+2]){p=!1;break}p?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),t()},1e3)},n.play()}),t.getTracks().forEach(e=>e.stop()),n.remove()})}}class nEe extends Lf{get description(){return"Resuming connection after interruption"}perform(){return J(this,void 0,void 0,function*(){var e;const t=yield this.connect();let n,r=!1,i=!1;const o=new Promise(e=>{setTimeout(e,5e3),n=e}),s=()=>{r=!0};t.on(ue.SignalReconnecting,s).on(ue.Reconnecting,s).on(ue.Reconnected,()=>{i=!0,n(!0)}),null===(e=t.engine.client.ws)||void 0===e||e.close();const a=t.engine.client.onClose;if(a&&a(""),yield o,!r)throw new Error("Did not attempt to reconnect");if(!i||t.state!==Pt.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")})}}class rEe extends Lf{get description(){return"Can connect via TURN"}perform(){return J(this,void 0,void 0,function*(){var e,t;const n=new hO,r=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let i=!1,o=!1,s=!1;for(let e of r.iceServers)for(let t of e.urls)t.startsWith("turn:")?(o=!0,s=!0):t.startsWith("turns:")&&(o=!0,s=!0,i=!0),t.startsWith("stun:")&&(s=!0);s?o&&!i&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield n.close(),null!==(t=null===(e=this.connectOptions)||void 0===e?void 0:e.rtcConfig)&&void 0!==t&&t.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(e=>setTimeout(e,0)))})}}class iEe extends Lf{get description(){return"Establishing WebRTC connection"}perform(){return J(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(ue.SignalConnected,()=>{const n=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,i)=>{if(r.candidate){const n=new RTCIceCandidate(r);let i="".concat(n.protocol," ").concat(n.address,":").concat(n.port," ").concat(n.type);n.address&&(sEe(n.address)?i+=" (private)":"tcp"===n.protocol&&"passive"===n.tcpType?(e=!0,i+=" (passive)"):"udp"===n.protocol&&(t=!0)),this.appendMessage(i)}n&&n(r,i)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=e=>{e instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(e.errorCode," ").concat(e.errorText," ").concat(e.url))})});try{yield this.connect(),kt.info("now the room is connected")}catch(e){throw this.appendWarning("ports need to be open on firewall in order to connect."),e}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function sEe(e){const t=e.split(".");if(4===t.length){if("10"===t[0])return!0;if("192"===t[0]&&"168"===t[1])return!0;if("172"===t[0]){const e=parseInt(t[1],10);if(e>=16&&e<=31)return!0}}return!1}class oEe extends Lf{get description(){return"Connecting to signal connection via WebSocket"}perform(){return J(this,void 0,void 0,function*(){var e,t,n;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new hO;const i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(i.serverVersion,".")),(null===(e=i.serverInfo)||void 0===e?void 0:e.edition)===JQ.Cloud&&!(null===(t=i.serverInfo)||void 0===t)&&t.region&&this.appendMessage("LiveKit Cloud: ".concat(null===(n=i.serverInfo)||void 0===n?void 0:n.region)),yield r.close()})}}class Uot extends ul.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=n}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:$a.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==$a.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return J(this,void 0,void 0,function*(){const t=this.getNextCheckId(),n=new e(this.url,this.token,this.options),r=e=>{this.updateCheck(t,e)};n.on("update",r);const i=yield n.run();return n.off("update",r),i})}checkWebsocket(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(oEe)})}checkWebRTC(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(iEe)})}checkTURN(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(rEe)})}checkReconnect(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(nEe)})}checkPublishAudio(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(eEe)})}checkPublishVideo(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(tEe)})}checkConnectionProtocol(){return J(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(Z2e);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(Q2e)})}}function YA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const r=$h(e)?e.mediaStreamTrack:e,i=r.getSettings();let o={facingMode:null!==(n=t.defaultFacingMode)&&void 0!==n?n:"user",confidence:"low"};if("facingMode"in i){const e=i.facingMode;kt.trace("rawFacingMode",{rawFacingMode:e}),e&&"string"==typeof e&&lEe(e)&&(o={facingMode:e,confidence:"high"})}if(["low","medium"].includes(o.confidence)){kt.trace("Try to get facing mode from device label: (".concat(r.label,")"));const e=cEe(r.label);void 0!==e&&(o=e)}return o}const EH=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),aEe=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function cEe(e){var t;const n=e.trim().toLowerCase();if(""!==n)return EH.has(n)?EH.get(n):null===(t=Array.from(aEe.entries()).find(e=>{let[t]=e;return n.includes(t)}))||void 0===t?void 0:t[1]}function lEe(e){return void 0===e||["user","environment","left","right"].includes(e)}var wH="popstate";function uEe(e={}){return fEe(function(e,t){let{pathname:n,search:r,hash:i}=e.location;return XA("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"==typeof t?t:pb(t)},null,e)}function ir(e,t){if(!1===e||null===e||typeof e>"u")throw new Error(t)}function rl(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function dEe(){return Math.random().toString(36).substring(2,10)}function CH(e,t){return{usr:e.state,key:e.key,idx:t}}function XA(e,t,n=null,r){return{pathname:"string"==typeof e?e:e.pathname,search:"",hash:"",..."string"==typeof t?Dv(t):t,state:n,key:t&&t.key||r||dEe()}}function pb({pathname:e="/",search:t="",hash:n=""}){return t&&"?"!==t&&(e+="?"===t.charAt(0)?t:"?"+t),n&&"#"!==n&&(e+="#"===n.charAt(0)?n:"#"+n),e}function Dv(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function fEe(e,t,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,s=i.history,a="POP",l=null,c=u();function u(){return(s.state||{idx:null}).idx}function d(){a="POP";let e=u(),t=null==e?null:e-c;c=e,l&&l({action:a,location:p.location,delta:t})}function h(e){return hEe(e)}null==c&&(c=0,s.replaceState({...s.state,idx:c},""));let p={get action(){return a},get location(){return e(i,s)},listen(e){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(wH,d),l=e,()=>{i.removeEventListener(wH,d),l=null}},createHref:e=>t(i,e),createURL:h,encodeLocation(e){let t=h(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){a="PUSH";let n=XA(p.location,e,t);c=u()+1;let r=CH(n,c),d=p.createHref(n);try{s.pushState(r,"",d)}catch(e){if(e instanceof DOMException&&"DataCloneError"===e.name)throw e;i.location.assign(d)}o&&l&&l({action:a,location:p.location,delta:1})},replace:function(e,t){a="REPLACE";let n=XA(p.location,e,t);c=u();let r=CH(n,c),i=p.createHref(n);s.replaceState(r,"",i),o&&l&&l({action:a,location:p.location,delta:0})},go:e=>s.go(e)};return p}function hEe(e,t=!1){let n="http://localhost";typeof window<"u"&&(n="null"!==window.location.origin?window.location.origin:window.location.href),ir(n,"No window.location.(origin|href) available to create URL");let r="string"==typeof e?e:pb(e);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function EO(e,t,n="/"){return pEe(e,t,n,!1)}function pEe(e,t,n,r){let i=Iu(("string"==typeof t?Dv(t):t).pathname||"/",n);if(null==i)return null;let o=mee(e);mEe(o);let s=null;for(let e=0;null==s&&e<o.length;++e){let t=REe(i);s=CEe(o[e],t,r)}return s}function mee(e,t=[],n=[],r=""){let i=(e,i,o)=>{let s={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};s.relativePath.startsWith("/")&&(ir(s.relativePath.startsWith(r),`Absolute route path "${s.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),s.relativePath=s.relativePath.slice(r.length));let a=gu([r,s.relativePath]),l=n.concat(s);e.children&&e.children.length>0&&(ir(!0!==e.index,`Index routes must not have child routes. Please remove all child routes from route path "${a}".`),mee(e.children,t,l,a)),(null!=e.path||e.index)&&t.push({path:a,score:EEe(a,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let n of gee(e.path))i(e,t,n);else i(e,t)}),t}function gee(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let s=gee(r.join("/")),a=[];return a.push(...s.map(e=>""===e?o:[o,e].join("/"))),i&&a.push(...s),a.map(t=>e.startsWith("/")&&""===t?"/":t)}function mEe(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:wEe(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}var gEe=/^:[\w-]+$/,vEe=3,yEe=2,bEe=1,_Ee=10,SEe=-2,TH=e=>"*"===e;function EEe(e,t){let n=e.split("/"),r=n.length;return n.some(TH)&&(r+=SEe),t&&(r+=yEe),n.filter(e=>!TH(e)).reduce((e,t)=>e+(gEe.test(t)?vEe:""===t?bEe:_Ee),r)}function wEe(e,t){return e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n])?e[e.length-1]-t[t.length-1]:0}function CEe(e,t,n=!1){let{routesMeta:r}=e,i={},o="/",s=[];for(let e=0;e<r.length;++e){let a=r[e],l=e===r.length-1,c="/"===o?t:t.slice(o.length)||"/",u=yC({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},c),d=a.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=yC({path:a.relativePath,caseSensitive:a.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),s.push({params:i,pathname:gu([o,u.pathname]),pathnameBase:AEe(gu([o,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(o=gu([o,u.pathnameBase]))}return s}function yC(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=TEe(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((e,{paramName:t,isOptional:n},r)=>{if("*"===t){let e=a[r]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const i=a[r];return e[t]=n&&!i?void 0:(i||"").replace(/%2F/g,"/"),e},{}),pathname:o,pathnameBase:s,pattern:e}}function TEe(e,t=!1,n=!0){rl("*"===e||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),r]}function REe(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return rl(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Iu(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function IEe(e,t="/"){let{pathname:n,search:r="",hash:i=""}="string"==typeof e?Dv(e):e;return{pathname:n?n.startsWith("/")?n:kEe(n,t):t,search:LEe(r),hash:PEe(i)}}function kEe(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function e6(e,t,n,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function xEe(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function vee(e){let t=xEe(e);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function yee(e,t,n,r=!1){let i;"string"==typeof e?i=Dv(e):(i={...e},ir(!i.pathname||!i.pathname.includes("?"),e6("?","pathname","search",i)),ir(!i.pathname||!i.pathname.includes("#"),e6("#","pathname","hash",i)),ir(!i.search||!i.search.includes("#"),e6("#","search","hash",i)));let o,s=""===e||""===i.pathname,a=s?"/":i.pathname;if(null==a)o=n;else{let e=t.length-1;if(!r&&a.startsWith("..")){let t=a.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}o=e>=0?t[e]:"/"}let l=IEe(i,o),c=a&&"/"!==a&&a.endsWith("/"),u=(s||"."===a)&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var gu=e=>e.join("/").replace(/\/\/+/g,"/"),AEe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),LEe=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",PEe=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function OEe(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}var bee=["POST","PUT","PATCH","DELETE"];new Set(bee);var MEe=["GET",...bee];new Set(MEe);var Nv=_.createContext(null);Nv.displayName="DataRouter";var nT=_.createContext(null);nT.displayName="DataRouterState",_.createContext(!1);var _ee=_.createContext({isTransitioning:!1});_ee.displayName="ViewTransition";var DEe=_.createContext(new Map);DEe.displayName="Fetchers";var NEe=_.createContext(null);NEe.displayName="Await";var dl=_.createContext(null);dl.displayName="Navigation";var Uv=_.createContext(null);Uv.displayName="Location";var $u=_.createContext({outlet:null,matches:[],isDataRoute:!1});$u.displayName="Route";var wO=_.createContext(null);function See(e,{relative:t}={}){ir(d_(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=_.useContext(dl),{hash:i,pathname:o,search:s}=f_(e,{relative:t}),a=o;return"/"!==n&&(a="/"===o?n:gu([n,o])),r.createHref({pathname:a,search:s,hash:i})}function d_(){return null!=_.useContext(Uv)}function ts(){return ir(d_(),"useLocation() may be used only in the context of a <Router> component."),_.useContext(Uv).location}function UEe(){return _.useContext(Uv).navigationType}wO.displayName="RouteError";var Eee="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function wee(e){_.useContext(dl).static||_.useLayoutEffect(e)}function fl(){let{isDataRoute:e}=_.useContext($u);return e?XEe():jEe()}function jEe(){ir(d_(),"useNavigate() may be used only in the context of a <Router> component.");let e=_.useContext(Nv),{basename:t,navigator:n}=_.useContext(dl),{matches:r}=_.useContext($u),{pathname:i}=ts(),o=JSON.stringify(vee(r)),s=_.useRef(!1);return wee(()=>{s.current=!0}),_.useCallback((r,a={})=>{if(rl(s.current,Eee),!s.current)return;if("number"==typeof r)return void n.go(r);let l=yee(r,JSON.parse(o),i,"path"===a.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:gu([t,l.pathname])),(a.replace?n.replace:n.push)(l,a.state,a)},[t,n,o,i,e])}function f_(e,{relative:t}={}){let{matches:n}=_.useContext($u),{pathname:r}=ts(),i=JSON.stringify(vee(n));return _.useMemo(()=>yee(e,JSON.parse(i),r,"path"===t),[e,i,r,t])}function FEe(e,t){return Cee(e,t)}function Cee(e,t,n,r){var i;ir(d_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=_.useContext(dl),{matches:s}=_.useContext($u),a=s[s.length-1],l=a?a.params:{},c=a?a.pathname:"/",u=a?a.pathnameBase:"/",d=a&&a.route;{let e=d&&d.path||"";Tee(c,!d||e.endsWith("*")||e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="${e}"> to <Route path="${"/"===e?"*":`${e}/*`}">.`)}let h,p=ts();if(t){let e="string"==typeof t?Dv(t):t;ir("/"===u||(null==(i=e.pathname)?void 0:i.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${e.pathname}" was given in the \`location\` prop.`),h=e}else h=p;let f=h.pathname||"/",m=f;if("/"!==u){let e=u.replace(/^\//,"").split("/");m="/"+f.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=EO(e,{pathname:m});rl(d||null!=v,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),rl(null==v||void 0!==v[v.length-1].route.element||void 0!==v[v.length-1].route.Component||void 0!==v[v.length-1].route.lazy,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=qEe(v&&v.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:gu([u,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:gu([u,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),s,n,r);return t&&g?_.createElement(Uv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...h},navigationType:"POP"}},g):g}function $Ee(){let e=YEe(),t=OEe(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},s=null;return console.error("Error handled by React Router default ErrorBoundary:",e),s=_.createElement(_.Fragment,null,_.createElement("p",null,"💿 Hey developer 👋"),_.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_.createElement("code",{style:o},"ErrorBoundary")," or"," ",_.createElement("code",{style:o},"errorElement")," prop on your route.")),_.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},t),n?_.createElement("pre",{style:i},n):null,s)}_.createContext(null);var BEe=_.createElement($Ee,null),HEe=class extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?_.createElement($u.Provider,{value:this.props.routeContext},_.createElement(wO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function VEe({routeContext:e,match:t,children:n}){let r=_.useContext(Nv);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),_.createElement($u.Provider,{value:e},n)}function qEe(e,t=[],n=null,r=null){if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==t.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let i=e,o=null==n?void 0:n.errors;if(null!=o){let e=i.findIndex(e=>e.route.id&&void 0!==(null==o?void 0:o[e.route.id]));ir(e>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,e+1))}let s=!1,a=-1;if(n)for(let e=0;e<i.length;e++){let t=i[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(a=e),t.route.id){let{loaderData:e,errors:r}=n,o=t.route.loader&&!e.hasOwnProperty(t.route.id)&&(!r||void 0===r[t.route.id]);if(t.route.lazy||o){s=!0,i=a>=0?i.slice(0,a+1):[i[0]];break}}}return i.reduceRight((e,r,l)=>{let c,u=!1,d=null,h=null;n&&(c=o&&r.route.id?o[r.route.id]:void 0,d=r.route.errorElement||BEe,s&&(a<0&&0===l?(Tee("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),u=!0,h=null):a===l&&(u=!0,h=r.route.hydrateFallbackElement||null)));let p=t.concat(i.slice(0,l+1)),f=()=>{let t;return t=c?d:u?h:r.route.Component?_.createElement(r.route.Component,null):r.route.element?r.route.element:e,_.createElement(VEe,{match:r,routeContext:{outlet:e,matches:p,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===l)?_.createElement(HEe,{location:n.location,revalidation:n.revalidation,component:d,error:c,children:f(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):f()},null)}function CO(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function GEe(e){let t=_.useContext(Nv);return ir(t,CO(e)),t}function KEe(e){let t=_.useContext(nT);return ir(t,CO(e)),t}function zEe(e){let t=_.useContext($u);return ir(t,CO(e)),t}function TO(e){let t=zEe(e),n=t.matches[t.matches.length-1];return ir(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function WEe(){return TO("useRouteId")}function YEe(){var e;let t=_.useContext(wO),n=KEe("useRouteError"),r=TO("useRouteError");return void 0!==t?t:null==(e=n.errors)?void 0:e[r]}function XEe(){let{router:e}=GEe("useNavigate"),t=TO("useNavigate"),n=_.useRef(!1);return wee(()=>{n.current=!0}),_.useCallback(async(r,i={})=>{rl(n.current,Eee),n.current&&("number"==typeof r?e.navigate(r):await e.navigate(r,{fromRouteId:t,...i}))},[e,t])}var RH={};function Tee(e,t,n){!t&&!RH[e]&&(RH[e]=!0,rl(!1,n))}function JEe({routes:e,future:t,state:n}){return Cee(e,void 0,n,t)}function Ree(e){ir(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function QEe({basename:e="/",children:t=null,location:n,navigationType:r="POP",navigator:i,static:o=!1}){ir(!d_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=e.replace(/^\/*/,"/"),a=_.useMemo(()=>({basename:s,navigator:i,static:o,future:{}}),[s,i,o]);"string"==typeof n&&(n=Dv(n));let{pathname:l="/",search:c="",hash:u="",state:d=null,key:h="default"}=n,p=_.useMemo(()=>{let e=Iu(l,s);return null==e?null:{location:{pathname:e,search:c,hash:u,state:d,key:h},navigationType:r}},[s,l,c,u,d,h,r]);return rl(null!=p,`<Router basename="${s}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),null==p?null:_.createElement(dl.Provider,{value:a},_.createElement(Uv.Provider,{children:t,value:p}))}function ZEe({children:e,location:t}){return FEe(bC(e),t)}function bC(e,t=[]){let n=[];return _.Children.forEach(e,(e,r)=>{if(!_.isValidElement(e))return;let i=[...t,r];if(e.type===_.Fragment)return void n.push.apply(n,bC(e.props.children,i));ir(e.type===Ree,`[${"string"==typeof e.type?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ir(!e.props.index||!e.props.children,"An index route cannot have child routes.");let o={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=bC(e.props.children,i)),n.push(o)}),n}_.memo(JEe);var sw="get",ow="application/x-www-form-urlencoded";function rT(e){return null!=e&&"string"==typeof e.tagName}function ewe(e){return rT(e)&&"button"===e.tagName.toLowerCase()}function twe(e){return rT(e)&&"form"===e.tagName.toLowerCase()}function nwe(e){return rT(e)&&"input"===e.tagName.toLowerCase()}function rwe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function iwe(e,t){return!(0!==e.button||t&&"_self"!==t||rwe(e))}var R2=null;function swe(){if(null===R2)try{new FormData(document.createElement("form"),0),R2=!1}catch{R2=!0}return R2}var owe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function t6(e){return null==e||owe.has(e)?e:(rl(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ow}"`),null)}function awe(e,t){let n,r,i,o,s;if(twe(e)){let s=e.getAttribute("action");r=s?Iu(s,t):null,n=e.getAttribute("method")||sw,i=t6(e.getAttribute("enctype"))||ow,o=new FormData(e)}else if(ewe(e)||nwe(e)&&("submit"===e.type||"image"===e.type)){let s=e.form;if(null==s)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let a=e.getAttribute("formaction")||s.getAttribute("action");if(r=a?Iu(a,t):null,n=e.getAttribute("formmethod")||s.getAttribute("method")||sw,i=t6(e.getAttribute("formenctype"))||t6(s.getAttribute("enctype"))||ow,o=new FormData(s,e),!swe()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?`${t}.`:"";o.append(`${e}x`,"0"),o.append(`${e}y`,"0")}else t&&o.append(t,r)}}else{if(rT(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=sw,r=null,i=ow,s=e}return o&&"text/plain"===i&&(s=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:s}}function RO(e,t){if(!1===e||null===e||typeof e>"u")throw new Error(t)}function cwe(e,t,n){let r="string"==typeof e?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return"/"===r.pathname?r.pathname=`_root.${n}`:t&&"/"===Iu(r.pathname,t)?r.pathname=`${t.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function lwe(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(t){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function uwe(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"==typeof e.imageSrcSet&&"string"==typeof e.imageSizes:"string"==typeof e.rel&&"string"==typeof e.href)}async function dwe(e,t,n){return mwe((await Promise.all(e.map(async e=>{let r=t.routes[e.route.id];if(r){let e=await lwe(r,n);return e.links?e.links():[]}return[]}))).flat(1).filter(uwe).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?{...e,rel:"prefetch",as:"style"}:{...e,rel:"prefetch"}))}function IH(e,t,n,r,i,o){let s=(e,t)=>!n[t]||e.route.id!==n[t].route.id,a=(e,t)=>{var r;return n[t].pathname!==e.pathname||(null==(r=n[t].route.path)?void 0:r.endsWith("*"))&&n[t].params["*"]!==e.params["*"]};return"assets"===o?t.filter((e,t)=>s(e,t)||a(e,t)):"data"===o?t.filter((t,o)=>{var l;let c=r.routes[t.route.id];if(!c||!c.hasLoader)return!1;if(s(t,o)||a(t,o))return!0;if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:(null==(l=n[0])?void 0:l.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"==typeof r)return r}return!0}):[]}function fwe(e,t,{includeHydrateFallback:n}={}){return hwe(e.map(e=>{let r=t.routes[e.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function hwe(e){return[...new Set(e)]}function pwe(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}function mwe(e,t){let n=new Set;return new Set(t),e.reduce((e,t)=>{let r=JSON.stringify(pwe(t));return n.has(r)||(n.add(r),e.push({key:r,link:t})),e},[])}function Iee(){let e=_.useContext(Nv);return RO(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function gwe(){let e=_.useContext(nT);return RO(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var IO=_.createContext(void 0);function kee(){let e=_.useContext(IO);return RO(e,"You must render this element inside a <HydratedRouter> element"),e}function vwe(e,t){let n=_.useContext(IO),[r,i]=_.useState(!1),[o,s]=_.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=t,h=_.useRef(null);_.useEffect(()=>{if("render"===e&&s(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{s(e.isIntersecting)})},{threshold:.5});return h.current&&e.observe(h.current),()=>{e.disconnect()}}},[e]),_.useEffect(()=>{if(r){let e=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(e)}}},[r]);let p=()=>{i(!0)},f=()=>{i(!1),s(!1)};return n?"intent"!==e?[o,h,{}]:[o,h,{onFocus:A0(a,p),onBlur:A0(l,f),onMouseEnter:A0(c,p),onMouseLeave:A0(u,f),onTouchStart:A0(d,p)}]:[!1,h,{}]}function A0(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function ywe({page:e,...t}){let{router:n}=Iee(),r=_.useMemo(()=>EO(n.routes,e,n.basename),[n.routes,e,n.basename]);return r?_.createElement(_we,{page:e,matches:r,...t}):null}function bwe(e){let{manifest:t,routeModules:n}=kee(),[r,i]=_.useState([]);return _.useEffect(()=>{let r=!1;return dwe(e,t,n).then(e=>{r||i(e)}),()=>{r=!0}},[e,t,n]),r}function _we({page:e,matches:t,...n}){let r=ts(),{manifest:i,routeModules:o}=kee(),{basename:s}=Iee(),{loaderData:a,matches:l}=gwe(),c=_.useMemo(()=>IH(e,t,l,i,r,"data"),[e,t,l,i,r]),u=_.useMemo(()=>IH(e,t,l,i,r,"assets"),[e,t,l,i,r]),d=_.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let n=new Set,l=!1;if(t.forEach(e=>{var t;let r=i.routes[e.route.id];!r||!r.hasLoader||(!c.some(t=>t.route.id===e.route.id)&&e.route.id in a&&null!=(t=o[e.route.id])&&t.shouldRevalidate||r.hasClientLoader?l=!0:n.add(e.route.id))}),0===n.size)return[];let u=cwe(e,s,"data");return l&&n.size>0&&u.searchParams.set("_routes",t.filter(e=>n.has(e.route.id)).map(e=>e.route.id).join(",")),[u.pathname+u.search]},[s,a,r,i,c,t,e,o]),h=_.useMemo(()=>fwe(u,i),[u,i]),p=bwe(u);return _.createElement(_.Fragment,null,d.map(e=>_.createElement("link",{key:e,rel:"prefetch",as:"fetch",href:e,...n})),h.map(e=>_.createElement("link",{key:e,rel:"modulepreload",href:e,...n})),p.map(({key:e,link:t})=>_.createElement("link",{key:e,...t})))}function Swe(...e){return t=>{e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}}IO.displayName="FrameworkContext";var xee=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{xee&&(window.__reactRouterVersion="7.7.1")}catch{}function Ewe({basename:e,children:t,window:n}){let r=_.useRef();null==r.current&&(r.current=uEe({window:n,v5Compat:!0}));let i=r.current,[o,s]=_.useState({action:i.action,location:i.location}),a=_.useCallback(e=>{_.startTransition(()=>s(e))},[s]);return _.useLayoutEffect(()=>i.listen(a),[i,a]),_.createElement(QEe,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:i})}var Aee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,iT=_.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:i,replace:o,state:s,target:a,to:l,preventScrollReset:c,viewTransition:u,...d},h){let p,{basename:f}=_.useContext(dl),m="string"==typeof l&&Aee.test(l),v=!1;if("string"==typeof l&&m&&(p=l,xee))try{let e=new URL(window.location.href),t=l.startsWith("//")?new URL(e.protocol+l):new URL(l),n=Iu(t.pathname,f);t.origin===e.origin&&null!=n?l=n+t.search+t.hash:v=!0}catch{rl(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let g=See(l,{relative:r}),[y,b,w]=vwe(n,d),S=Pee(l,{replace:o,state:s,target:a,preventScrollReset:c,relative:r,viewTransition:u});let E=_.createElement("a",{...d,...w,href:p||g,onClick:v||i?e:function(t){e&&e(t),t.defaultPrevented||S(t)},ref:Swe(h,b),target:a,"data-discover":m||"render"!==t?void 0:"true"});return y&&!m?_.createElement(_.Fragment,null,E,_.createElement(ywe,{page:g})):E});iT.displayName="Link";var wwe=_.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:i,to:o,viewTransition:s,children:a,...l},c){let u=f_(o,{relative:l.relative}),d=ts(),h=_.useContext(nT),{navigator:p,basename:f}=_.useContext(dl),m=null!=h&&Awe(u)&&!0===s,v=p.encodeLocation?p.encodeLocation(u).pathname:u.pathname,g=d.pathname,y=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;t||(g=g.toLowerCase(),y=y?y.toLowerCase():null,v=v.toLowerCase()),y&&f&&(y=Iu(y,f)||y);const b="/"!==v&&v.endsWith("/")?v.length-1:v.length;let w,S=g===v||!r&&g.startsWith(v)&&"/"===g.charAt(b),E=null!=y&&(y===v||!r&&y.startsWith(v)&&"/"===y.charAt(v.length)),C={isActive:S,isPending:E,isTransitioning:m},k=S?e:void 0;w="function"==typeof n?n(C):[n,S?"active":null,E?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let T="function"==typeof i?i(C):i;return _.createElement(iT,{...l,"aria-current":k,className:w,ref:c,style:T,to:o,viewTransition:s},"function"==typeof a?a(C):a)});wwe.displayName="NavLink";var Cwe=_.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:r,replace:i,state:o,method:s=sw,action:a,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,...h},p)=>{let f=kwe(),m=xwe(a,{relative:c}),v="get"===s.toLowerCase()?"get":"post",g="string"==typeof a&&Aee.test(a);return _.createElement("form",{ref:p,method:v,action:m,onSubmit:r?l:e=>{if(l&&l(e),e.defaultPrevented)return;e.preventDefault();let r=e.nativeEvent.submitter,a=(null==r?void 0:r.getAttribute("formmethod"))||s;f(r||e.currentTarget,{fetcherKey:t,method:a,navigate:n,replace:i,state:o,relative:c,preventScrollReset:u,viewTransition:d})},...h,"data-discover":g||"render"!==e?void 0:"true"})});function Twe(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Lee(e){let t=_.useContext(Nv);return ir(t,Twe(e)),t}function Pee(e,{target:t,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:s}={}){let a=fl(),l=ts(),c=f_(e,{relative:o});return _.useCallback(u=>{if(iwe(u,t)){u.preventDefault();let t=void 0!==n?n:pb(l)===pb(c);a(e,{replace:t,state:r,preventScrollReset:i,relative:o,viewTransition:s})}},[l,a,c,n,r,t,e,i,o,s])}Cwe.displayName="Form";var Rwe=0,Iwe=()=>`__${String(++Rwe)}__`;function kwe(){let{router:e}=Lee("useSubmit"),{basename:t}=_.useContext(dl),n=WEe();return _.useCallback(async(r,i={})=>{let{action:o,method:s,encType:a,formData:l,body:c}=awe(r,t);if(!1===i.navigate){let t=i.fetcherKey||Iwe();await e.fetch(t,n,i.action||o,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||s,formEncType:i.encType||a,flushSync:i.flushSync})}else await e.navigate(i.action||o,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||s,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[e,t,n])}function xwe(e,{relative:t}={}){let{basename:n}=_.useContext(dl),r=_.useContext($u);ir(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...f_(e||".",{relative:t})},s=ts();if(null==e){o.search=s.search;let e=new URLSearchParams(o.search),t=e.getAll("index");if(t.some(e=>""===e)){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let n=e.toString();o.search=n?`?${n}`:""}}return(!e||"."===e)&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),"/"!==n&&(o.pathname="/"===o.pathname?n:gu([n,o.pathname])),pb(o)}function Awe(e,{relative:t}={}){let n=_.useContext(_ee);ir(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Lee("useViewTransitionState"),i=f_(e,{relative:t});if(!n.isTransitioning)return!1;let o=Iu(n.currentLocation.pathname,r)||n.currentLocation.pathname,s=Iu(n.nextLocation.pathname,r)||n.nextLocation.pathname;return null!=yC(i.pathname,s)||null!=yC(i.pathname,o)}var jv=EQ();const Oee=ac(jv),_t=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Bh="8.55.0",Yt=globalThis;function sT(e,t,n){const r=n||Yt,i=r.__SENTRY__=r.__SENTRY__||{},o=i[Bh]=i[Bh]||{};return o[e]||(o[e]=t())}const Pf=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Lwe="Sentry Logger ",JA=["debug","info","warn","error","log","assert","trace"],_C={};function Sp(e){if(!("console"in Yt))return e();const t=Yt.console,n={},r=Object.keys(_C);r.forEach(e=>{const r=_C[e];n[e]=t[e],t[e]=r});try{return e()}finally{r.forEach(e=>{t[e]=n[e]})}}function Pwe(){let e=!1;const t={enable:()=>{e=!0},disable:()=>{e=!1},isEnabled:()=>e};return Pf?JA.forEach(n=>{t[n]=(...t)=>{e&&Sp(()=>{Yt.console[n](`${Lwe}[${n}]:`,...t)})}}):JA.forEach(e=>{t[e]=()=>{}}),t}const Ue=sT("logger",Pwe),Mee=50,ep="?",kH=/\(error: (.*)\)/,xH=/captureMessage|captureException/;function Dee(...e){const t=e.sort((e,t)=>e[0]-t[0]).map(e=>e[1]);return(e,n=0,r=0)=>{const i=[],o=e.split("\n");for(let e=n;e<o.length;e++){const n=o[e];if(n.length>1024)continue;const s=kH.test(n)?n.replace(kH,"$1"):n;if(!s.match(/\S*Error: /)){for(const e of t){const t=e(s);if(t){i.push(t);break}}if(i.length>=50+r)break}}return Mwe(i.slice(r))}}function Owe(e){return Array.isArray(e)?Dee(...e):e}function Mwe(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(I2(t).function||"")&&t.pop(),t.reverse(),xH.test(I2(t).function||"")&&(t.pop(),xH.test(I2(t).function||"")&&t.pop()),t.slice(0,50).map(e=>({...e,filename:e.filename||I2(t).filename,function:e.function||ep}))}function I2(e){return e[e.length-1]||{}}const n6="<anonymous>";function ku(e){try{return e&&"function"==typeof e&&e.name||n6}catch{return n6}}function AH(e){const t=e.exception;if(t){const e=[];try{return t.values.forEach(t=>{t.stacktrace.frames&&e.push(...t.stacktrace.frames)}),e}catch{return}}}const aw={},LH={};function Of(e,t){aw[e]=aw[e]||[],aw[e].push(t)}function Mf(e,t){if(!LH[e]){LH[e]=!0;try{t()}catch(t){Pf&&Ue.error(`Error while instrumenting ${e}`,t)}}}function ua(e,t){const n=e&&aw[e];if(n)for(const r of n)try{r(t)}catch(t){Pf&&Ue.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${ku(r)}\nError:`,t)}}let r6=null;function Nee(e){const t="error";Of(t,e),Mf(t,Dwe)}function Dwe(){r6=Yt.onerror,Yt.onerror=function(e,t,n,r,i){return ua("error",{column:r,error:i,line:n,msg:e,url:t}),!!r6&&r6.apply(this,arguments)},Yt.onerror.__SENTRY_INSTRUMENTED__=!0}let i6=null;function Uee(e){const t="unhandledrejection";Of(t,e),Mf(t,Nwe)}function Nwe(){i6=Yt.onunhandledrejection,Yt.onunhandledrejection=function(e){return ua("unhandledrejection",e),!i6||i6.apply(this,arguments)},Yt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Ep(){return kO(Yt),Yt}function kO(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||Bh,t[Bh]=t[Bh]||{}}const jee=Object.prototype.toString;function oT(e){switch(jee.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return xu(e,Error)}}function Fv(e,t){return jee.call(e)===`[object ${t}]`}function Fee(e){return Fv(e,"ErrorEvent")}function PH(e){return Fv(e,"DOMError")}function Uwe(e){return Fv(e,"DOMException")}function vu(e){return Fv(e,"String")}function xO(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function AO(e){return null===e||xO(e)||"object"!=typeof e&&"function"!=typeof e}function rv(e){return Fv(e,"Object")}function aT(e){return typeof Event<"u"&&xu(e,Event)}function jwe(e){return typeof Element<"u"&&xu(e,Element)}function Fwe(e){return Fv(e,"RegExp")}function cT(e){return!(!e||!e.then||"function"!=typeof e.then)}function $we(e){return rv(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function xu(e,t){try{return e instanceof t}catch{return!1}}function $ee(e){return!("object"!=typeof e||null===e||!e.__isVue&&!e._isVue)}const Ig=Yt,Bwe=80;function tp(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,i=[];let o=0,s=0;const a=" > ",l=a.length;let c;const u=Array.isArray(t)?t:t.keyAttrs,d=!Array.isArray(t)&&t.maxStringLength||80;for(;n&&o++<r&&(c=Hwe(n,u),!("html"===c||o>1&&s+i.length*l+c.length>=d));)i.push(c),s+=c.length,n=n.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}function Hwe(e,t){const n=e,r=[];if(!n||!n.tagName)return"";if(Ig.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const i=t&&t.length?t.filter(e=>n.getAttribute(e)).map(e=>[e,n.getAttribute(e)]):null;if(i&&i.length)i.forEach(e=>{r.push(`[${e[0]}="${e[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const e=n.className;if(e&&vu(e)){const t=e.split(/\s+/);for(const e of t)r.push(`.${e}`)}}const o=["aria-label","type","name","title","alt"];for(const e of o){const t=n.getAttribute(e);t&&r.push(`[${e}="${t}"]`)}return r.join("")}function Vwe(){try{return Ig.document.location.href}catch{return""}}function qwe(e){return Ig.document&&Ig.document.querySelector?Ig.document.querySelector(e):null}function Bee(e){if(!Ig.HTMLElement)return null;let t=e;for(let e=0;e<5;e++){if(!t)return null;if(t instanceof HTMLElement){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}t=t.parentNode}return null}function kg(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function OH(e,t){if(!Array.isArray(e))return"";const n=[];for(let t=0;t<e.length;t++){const r=e[t];try{$ee(r)?n.push("[VueViewModel]"):n.push(String(r))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}function Gwe(e,t,n=!1){return!!vu(e)&&(Fwe(t)?t.test(e):!!vu(t)&&(n?e===t:e.includes(t)))}function Hh(e,t=[],n=!1){return t.some(t=>Gwe(e,t,n))}function So(e,t,n){if(!(t in e))return;const r=e[t],i=n(r);"function"==typeof i&&Hee(i,r);try{e[t]=i}catch{Pf&&Ue.log(`Failed to replace method "${t}" in object`,e)}}function ga(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{Pf&&Ue.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function Hee(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,ga(e,"__sentry_original__",t)}catch{}}function LO(e){return e.__sentry_original__}function Vee(e){if(oT(e))return{message:e.message,name:e.name,stack:e.stack,...DH(e)};if(aT(e)){const t={type:e.type,target:MH(e.target),currentTarget:MH(e.currentTarget),...DH(e)};return typeof CustomEvent<"u"&&xu(e,CustomEvent)&&(t.detail=e.detail),t}return e}function MH(e){try{return jwe(e)?tp(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}}function DH(e){if("object"==typeof e&&null!==e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return{}}function Kwe(e,t=40){const n=Object.keys(Vee(e));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=t)return kg(r,t);for(let e=n.length;e>0;e--){const r=n.slice(0,e).join(", ");if(!(r.length>t))return e===n.length?r:kg(r,t)}return""}function Ui(e){return QA(e,new Map)}function QA(e,t){if(zwe(e)){const n=t.get(e);if(void 0!==n)return n;const r={};t.set(e,r);for(const n of Object.getOwnPropertyNames(e))typeof e[n]<"u"&&(r[n]=QA(e[n],t));return r}if(Array.isArray(e)){const n=t.get(e);if(void 0!==n)return n;const r=[];return t.set(e,r),e.forEach(e=>{r.push(QA(e,t))}),r}return e}function zwe(e){if(!rv(e))return!1;try{const t=Object.getPrototypeOf(e).constructor.name;return!t||"Object"===t}catch{return!0}}const qee=1e3;function h_(){return Date.now()/qee}function Wwe(){const{performance:e}=Yt;if(!e||!e.now)return h_;const t=Date.now()-e.now(),n=null==e.timeOrigin?t:e.timeOrigin;return()=>(n+e.now())/qee}const fs=Wwe(),Ks=(()=>{const{performance:e}=Yt;if(!e||!e.now)return;const t=36e5,n=e.now(),r=Date.now(),i=e.timeOrigin?Math.abs(e.timeOrigin+n-r):t,o=i<t,s=e.timing&&e.timing.navigationStart,a="number"==typeof s?Math.abs(s+n-r):t;return o||a<t?i<=a?e.timeOrigin:s:r})();function da(){const e=Yt,t=e.crypto||e.msCrypto;let n=()=>16*Math.random();try{if(t&&t.randomUUID)return t.randomUUID().replace(/-/g,"");t&&t.getRandomValues&&(n=()=>{const e=new Uint8Array(1);return t.getRandomValues(e),e[0]})}catch{}return"10000000100040008000100000000000".replace(/[018]/g,e=>(e^(15&n())>>e/4).toString(16))}function Gee(e){return e.exception&&e.exception.values?e.exception.values[0]:void 0}function Md(e){const{message:t,event_id:n}=e;if(t)return t;const r=Gee(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function ZA(e,t,n){const r=e.exception=e.exception||{},i=r.values=r.values||[],o=i[0]=i[0]||{};o.value||(o.value=t||""),o.type||(o.type="Error")}function iv(e,t){const n=Gee(e);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...t},t&&"data"in t){const e={...r&&r.data,...t.data};n.mechanism.data=e}}function NH(e){if(Ywe(e))return!0;try{ga(e,"__sentry_captured__",!0)}catch{}return!1}function Ywe(e){try{return e.__sentry_captured__}catch{}}var Gl;function np(e){return new Zo(t=>{t(e)})}function SC(e){return new Zo((t,n)=>{n(e)})}!function(e){e[e.PENDING=0]="PENDING";e[e.RESOLVED=1]="RESOLVED";e[e.REJECTED=2]="REJECTED"}(Gl||(Gl={}));class Zo{constructor(e){Zo.prototype.__init.call(this),Zo.prototype.__init2.call(this),Zo.prototype.__init3.call(this),Zo.prototype.__init4.call(this),this._state=Gl.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}then(e,t){return new Zo((n,r)=>{this._handlers.push([!1,t=>{if(e)try{n(e(t))}catch(e){r(e)}else n(t)},e=>{if(t)try{n(t(e))}catch(e){r(e)}else r(e)}]),this._executeHandlers()})}catch(e){return this.then(e=>e,e)}finally(e){return new Zo((t,n)=>{let r,i;return this.then(t=>{i=!1,r=t,e&&e()},t=>{i=!0,r=t,e&&e()}).then(()=>{i?n(r):t(r)})})}__init(){this._resolve=e=>{this._setResult(Gl.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Gl.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{if(this._state===Gl.PENDING){if(cT(t))return void t.then(this._resolve,this._reject);this._state=e,this._value=t,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===Gl.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(e=>{e[0]||(this._state===Gl.RESOLVED&&e[1](this._value),this._state===Gl.REJECTED&&e[2](this._value),e[0]=!0)})}}}function Xwe(e){const t=fs(),n={sid:da(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>Qwe(n)};return e&&sv(n,e),n}function sv(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||fs(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:da()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function Jwe(e,t){let n={};"ok"===e.status&&(n={status:"exited"}),sv(e,n)}function Qwe(e){return Ui({sid:`${e.sid}`,init:e.init,started:new Date(1e3*e.started).toISOString(),timestamp:new Date(1e3*e.timestamp).toISOString(),status:e.status,errors:e.errors,did:"number"==typeof e.did||"string"==typeof e.did?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}})}function pf(){return da()}function mf(){return da().substring(16)}function lT(e,t,n=2){if(!t||"object"!=typeof t||n<=0)return t;if(e&&t&&0===Object.keys(t).length)return e;const r={...e};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=lT(r[e],t[e],n-1));return r}const eL="_sentrySpan";function mb(e,t){t?ga(e,eL,t):delete e[eL]}function EC(e){return e[eL]}const Zwe=100;class PO{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:pf(),spanId:mf()}}clone(){const e=new PO;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,mb(e,EC(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&sv(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,[n,r]=t instanceof gf?[t.getScopeData(),t.getRequestSession()]:rv(t)?[e,e.requestSession]:[],{tags:i,extra:o,user:s,contexts:a,level:l,fingerprint:c=[],propagationContext:u}=n||{};return this._tags={...this._tags,...i},this._extra={...this._extra,...o},this._contexts={...this._contexts,...a},s&&Object.keys(s).length&&(this._user=s),l&&(this._level=l),c.length&&(this._fingerprint=c),u&&(this._propagationContext=u),r&&(this._requestSession=r),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,mb(this,void 0),this._attachments=[],this.setPropagationContext({traceId:pf()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const n="number"==typeof t?t:100;if(n<=0)return this;const r={timestamp:h_(),...e};return this._breadcrumbs.push(r),this._breadcrumbs.length>n&&(this._breadcrumbs=this._breadcrumbs.slice(-n),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:EC(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=lT(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:mf(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t&&t.event_id?t.event_id:da();if(!this._client)return Ue.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:r,...t,event_id:n},this),n}captureMessage(e,t,n){const r=n&&n.event_id?n.event_id:da();if(!this._client)return Ue.warn("No client configured on scope - will not capture message!"),r;const i=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureEvent(e,t){const n=t&&t.event_id?t.event_id:da();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(Ue.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const gf=PO;function eCe(){return sT("defaultCurrentScope",()=>new gf)}function tCe(){return sT("defaultIsolationScope",()=>new gf)}class nCe{constructor(e,t){let n,r;n=e||new gf,r=t||new gf,this._stack=[{scope:n}],this._isolationScope=r}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(e){throw this._popScope(),e}return cT(n)?n.then(e=>(this._popScope(),e),e=>{throw this._popScope(),e}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function ov(){const e=kO(Ep());return e.stack=e.stack||new nCe(eCe(),tCe())}function rCe(e){return ov().withScope(e)}function iCe(e,t){const n=ov();return n.withScope(()=>(n.getStackTop().scope=e,t(e)))}function UH(e){return ov().withScope(()=>e(ov().getIsolationScope()))}function sCe(){return{withIsolationScope:UH,withScope:rCe,withSetScope:iCe,withSetIsolationScope:(e,t)=>UH(t),getCurrentScope:()=>ov().getScope(),getIsolationScope:()=>ov().getIsolationScope()}}function $v(e){const t=kO(e);return t.acs?t.acs:sCe()}function Ln(){return $v(Ep()).getCurrentScope()}function hl(){return $v(Ep()).getIsolationScope()}function oCe(){return sT("globalScope",()=>new gf)}function uT(...e){const t=$v(Ep());if(2===e.length){const[n,r]=e;return n?t.withSetScope(n,r):t.withScope(r)}return t.withScope(e[0])}function tn(){return Ln().getClient()}function aCe(e){const t=e.getPropagationContext(),{traceId:n,spanId:r,parentSpanId:i}=t;return Ui({trace_id:n,span_id:r,parent_span_id:i})}const cCe="_sentryMetrics";function tL(e){const t=e[cCe];if(!t)return;const n={};for(const[,[e,r]]of t)(n[e]||(n[e]=[])).push(Ui(r));return n}const oa="sentry.source",Kee="sentry.sample_rate",Au="sentry.op",Hr="sentry.origin",nL="sentry.idle_span_finish_reason",dT="sentry.measurement_unit",fT="sentry.measurement_value",jH="sentry.custom_span_name",lCe="sentry.profile_id",OO="sentry.exclusive_time",uCe=0,zee=1,hi=2;function dCe(e){if(e<400&&e>=100)return{code:1};if(e>=400&&e<500)switch(e){case 401:return{code:2,message:"unauthenticated"};case 403:return{code:2,message:"permission_denied"};case 404:return{code:2,message:"not_found"};case 409:return{code:2,message:"already_exists"};case 413:return{code:2,message:"failed_precondition"};case 429:return{code:2,message:"resource_exhausted"};case 499:return{code:2,message:"cancelled"};default:return{code:2,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:2,message:"unimplemented"};case 503:return{code:2,message:"unavailable"};case 504:return{code:2,message:"deadline_exceeded"};default:return{code:2,message:"internal_error"}}return{code:2,message:"unknown_error"}}function Wee(e,t){e.setAttribute("http.response.status_code",t);const n=dCe(t);"unknown_error"!==n.message&&e.setStatus(n)}const MO="sentry-",fCe=/^sentry-/,hCe=8192;function Yee(e){const t=mCe(e);if(!t)return;const n=Object.entries(t).reduce((e,[t,n])=>{if(t.match(fCe)){e[t.slice(7)]=n}return e},{});return Object.keys(n).length>0?n:void 0}function pCe(e){if(!e)return;return gCe(Object.entries(e).reduce((e,[t,n])=>(n&&(e[`${MO}${t}`]=n),e),{}))}function mCe(e){if(e&&(vu(e)||Array.isArray(e)))return Array.isArray(e)?e.reduce((e,t)=>{const n=FH(t);return Object.entries(n).forEach(([t,n])=>{e[t]=n}),e},{}):FH(e)}function FH(e){return e.split(",").map(e=>e.split("=").map(e=>decodeURIComponent(e.trim()))).reduce((e,[t,n])=>(t&&n&&(e[t]=n),e),{})}function gCe(e){if(0!==Object.keys(e).length)return Object.entries(e).reduce((e,[t,n],r)=>{const i=`${encodeURIComponent(t)}=${encodeURIComponent(n)}`,o=0===r?i:`${e},${i}`;return o.length>hCe?(Pf&&Ue.warn(`Not adding key: ${t} with val: ${n} to baggage header due to exceeding baggage size limits.`),e):o},"")}const Xee=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function vCe(e){if(!e)return;const t=e.match(Xee);if(!t)return;let n;return"1"===t[3]?n=!0:"0"===t[3]&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}function yCe(e,t){const n=vCe(e),r=Yee(t);if(!n||!n.traceId)return{traceId:pf(),spanId:mf()};const{traceId:i,parentSpanId:o,parentSampled:s}=n;return{traceId:i,parentSpanId:o,spanId:mf(),sampled:s,dsc:r||{}}}function Jee(e=pf(),t=mf(),n){let r="";return void 0!==n&&(r=n?"-1":"-0"),`${e}-${t}${r}`}const Qee=0,Zee=1;let $H=!1;function bCe(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:i,parent_span_id:o,status:s,origin:a}=en(e);return Ui({parent_span_id:o,span_id:t,trace_id:n,data:r,op:i,status:s,origin:a})}function _Ce(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext();return Ui({parent_span_id:r?t:en(e).parent_span_id,span_id:r?mf():t,trace_id:n})}function SCe(e){const{traceId:t,spanId:n}=e.spanContext();return Jee(t,n,wp(e))}function Vh(e){return"number"==typeof e?BH(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?BH(e.getTime()):fs()}function BH(e){return e>9999999999?e/1e3:e}function en(e){if(wCe(e))return e.getSpanJSON();try{const{spanId:t,traceId:n}=e.spanContext();if(ECe(e)){const{attributes:r,startTime:i,name:o,endTime:s,parentSpanId:a,status:l}=e;return Ui({span_id:t,trace_id:n,data:r,description:o,parent_span_id:a,start_timestamp:Vh(i),timestamp:Vh(s)||void 0,status:ete(l),op:r[Au],origin:r[Hr],_metrics_summary:tL(e)})}return{span_id:t,trace_id:n}}catch{return{}}}function ECe(e){const t=e;return!!(t.attributes&&t.startTime&&t.name&&t.endTime&&t.status)}function wCe(e){return"function"==typeof e.getSpanJSON}function wp(e){const{traceFlags:t}=e.spanContext();return 1===t}function ete(e){if(e&&0!==e.code)return 1===e.code?"ok":e.message||"unknown_error"}const qh="_sentryChildSpans",rL="_sentryRootSpan";function tte(e,t){const n=e[rL]||e;ga(t,rL,n),e[qh]?e[qh].add(t):ga(e,qh,new Set([t]))}function CCe(e,t){e[qh]&&e[qh].delete(t)}function cw(e){const t=new Set;return function e(n){if(!t.has(n)&&wp(n)){t.add(n);const r=n[qh]?Array.from(n[qh]):[];for(const t of r)e(t)}}(e),Array.from(t)}function ji(e){return e[rL]||e}function Bi(){const e=$v(Ep());return e.getActiveSpan?e.getActiveSpan():EC(Ln())}function nte(){$H||(Sp(()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")}),$H=!0)}let HH=!1;function TCe(){HH||(HH=!0,Nee(iL),Uee(iL))}function iL(){const e=Bi(),t=e&&ji(e);if(t){const e="internal_error";_t&&Ue.log(`[Tracing] Root span: ${e} -> Global error occurred`),t.setStatus({code:2,message:e})}}iL.tag="sentry_tracingErrorCallback";const rte="_sentryScope",ite="_sentryIsolationScope";function RCe(e,t,n){e&&(ga(e,ite,n),ga(e,rte,t))}function VH(e){return{scope:e[rte],isolationScope:e[ite]}}function vf(e){if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const t=tn(),n=e||t&&t.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}class Bv{constructor(e={}){this._traceId=e.traceId||pf(),this._spanId=e.spanId||mf()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:0}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,n){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}const DO="production",ste="_frozenDsc";function qH(e,t){ga(e,ste,t)}function ote(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},i=Ui({environment:n.environment||DO,release:n.release,public_key:r,trace_id:e});return t.emit("createDsc",i),i}function ate(e,t){const n=t.getPropagationContext();return n.dsc||ote(n.traceId,e)}function Hv(e){const t=tn();if(!t)return{};const n=ji(e),r=n[ste];if(r)return r;const i=n.spanContext().traceState,o=i&&i.get("sentry.dsc"),s=o&&Yee(o);if(s)return s;const a=ote(e.spanContext().traceId,t),l=en(n),c=l.data||{},u=c[Kee];null!=u&&(a.sample_rate=`${u}`);const d=c[oa],h=l.description;return"url"!==d&&h&&(a.transaction=h),vf()&&(a.sampled=String(wp(n))),t.emit("createDsc",a,n),a}function ICe(e){if(!_t)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=en(e),{spanId:i}=e.spanContext(),o=wp(e),s=ji(e),a=s===e,l=`[Tracing] Starting ${o?"sampled":"unsampled"} ${a?"root ":""}span`,c=[`op: ${n}`,`name: ${t}`,`ID: ${i}`];if(r&&c.push(`parent ID: ${r}`),!a){const{op:e,description:t}=en(s);c.push(`root ID: ${s.spanContext().spanId}`),e&&c.push(`root op: ${e}`),t&&c.push(`root description: ${t}`)}Ue.log(`${l}\n  ${c.join("\n  ")}`)}function kCe(e){if(!_t)return;const{description:t="< unknown name >",op:n="< unknown op >"}=en(e),{spanId:r}=e.spanContext(),i=`[Tracing] Finishing "${n}" ${ji(e)===e?"root ":""}span "${t}" with ID ${r}`;Ue.log(i)}function cte(e){if("boolean"==typeof e)return Number(e);const t="string"==typeof e?parseFloat(e):e;if(!("number"!=typeof t||isNaN(t)||t<0||t>1))return t;_t&&Ue.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(e)} of type ${JSON.stringify(typeof e)}.`)}function xCe(e,t){if(!vf(e))return[!1];const n=hl().getScopeData().sdkProcessingMetadata.normalizedRequest,r={...t,normalizedRequest:t.normalizedRequest||n};let i;i="function"==typeof e.tracesSampler?e.tracesSampler(r):void 0!==r.parentSampled?r.parentSampled:typeof e.tracesSampleRate<"u"?e.tracesSampleRate:1;const o=cte(i);return void 0===o?(_t&&Ue.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):o?Math.random()<o?[!0,o]:(_t&&Ue.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),[!1,o]):(_t&&Ue.log("[Tracing] Discarding transaction because "+("function"==typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),[!1,o])}const ACe=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function LCe(e){return"http"===e||"https"===e}function Vv(e,t=!1){const{host:n,path:r,pass:i,port:o,projectId:s,protocol:a,publicKey:l}=e;return`${a}://${l}${t&&i?`:${i}`:""}@${n}${o?`:${o}`:""}/${r&&`${r}/`}${s}`}function PCe(e){const t=ACe.exec(e);if(!t)return void Sp(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});const[n,r,i="",o="",s="",a=""]=t.slice(1);let l="",c=a;const u=c.split("/");if(u.length>1&&(l=u.slice(0,-1).join("/"),c=u.pop()),c){const e=c.match(/^\d+/);e&&(c=e[0])}return lte({host:o,pass:i,path:l,projectId:c,port:s,protocol:n,publicKey:r})}function lte(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function OCe(e){if(!Pf)return!0;const{port:t,projectId:n,protocol:r}=e;return!["protocol","publicKey","host","projectId"].find(t=>!e[t]&&(Ue.error(`Invalid Sentry Dsn: ${t} missing`),!0))&&(n.match(/^\d+$/)?LCe(r)?!t||!isNaN(parseInt(t,10))||(Ue.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):(Ue.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(Ue.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1))}function ute(e){const t="string"==typeof e?PCe(e):lte(e);if(t&&OCe(t))return t}function MCe(){const e="function"==typeof WeakSet,t=e?new WeakSet:[];return[function(n){if(e)return!!t.has(n)||(t.add(n),!1);for(let e=0;e<t.length;e++)if(t[e]===n)return!0;return t.push(n),!1},function(n){if(e)t.delete(n);else for(let e=0;e<t.length;e++)if(t[e]===n){t.splice(e,1);break}}]}function Kl(e,t=100,n=1/0){try{return sL("",e,t,n)}catch(e){return{ERROR:`**non-serializable** (${e})`}}}function dte(e,t=3,n=102400){const r=Kl(e,t);return jCe(r)>n?dte(e,t-1,n):r}function sL(e,t,n=1/0,r=1/0,i=MCe()){const[o,s]=i;if(null==t||["boolean","string"].includes(typeof t)||"number"==typeof t&&Number.isFinite(t))return t;const a=DCe(e,t);if(!a.startsWith("[object "))return a;if(t.__sentry_skip_normalization__)return t;const l="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:n;if(0===l)return a.replace("object ","");if(o(t))return"[Circular ~]";const c=t;if(c&&"function"==typeof c.toJSON)try{return sL("",c.toJSON(),l-1,r,i)}catch{}const u=Array.isArray(t)?[]:{};let d=0;const h=Vee(t);for(const e in h){if(!Object.prototype.hasOwnProperty.call(h,e))continue;if(d>=r){u[e]="[MaxProperties ~]";break}const t=h[e];u[e]=sL(e,t,l-1,r,i),d++}return s(t),u}function DCe(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if(typeof global<"u"&&t===global)return"[Global]";if(typeof window<"u"&&t===window)return"[Window]";if(typeof document<"u"&&t===document)return"[Document]";if($ee(t))return"[VueViewModel]";if($we(t))return"[SyntheticEvent]";if("number"==typeof t&&!Number.isFinite(t))return`[${t}]`;if("function"==typeof t)return`[Function: ${ku(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const n=NCe(t);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(e){return`**non-serializable** (${e})`}}function NCe(e){const t=Object.getPrototypeOf(e);return t?t.constructor.name:"null prototype"}function UCe(e){return~-encodeURI(e).split(/%..|./).length}function jCe(e){return UCe(JSON.stringify(e))}function qv(e,t=[]){return[e,t]}function FCe(e,t){const[n,r]=e;return[n,[...r,t]]}function GH(e,t){const n=e[1];for(const e of n){if(t(e,e[0].type))return!0}return!1}function oL(e){return Yt.__SENTRY__&&Yt.__SENTRY__.encodePolyfill?Yt.__SENTRY__.encodePolyfill(e):(new TextEncoder).encode(e)}function $Ce(e){const[t,n]=e;let r=JSON.stringify(t);function i(e){"string"==typeof r?r="string"==typeof e?r+e:[oL(r),e]:r.push("string"==typeof e?oL(e):e)}for(const e of n){const[t,n]=e;if(i(`\n${JSON.stringify(t)}\n`),"string"==typeof n||n instanceof Uint8Array)i(n);else{let e;try{e=JSON.stringify(n)}catch{e=JSON.stringify(Kl(n))}i(e)}}return"string"==typeof r?r:BCe(r)}function BCe(e){const t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}function HCe(e){return[{type:"span"},e]}function VCe(e){const t="string"==typeof e.data?oL(e.data):e.data;return[Ui({type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType}),t]}const qCe={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function KH(e){return qCe[e]}function fte(e){if(!e||!e.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function GCe(e,t,n,r){const i=e.sdkProcessingMetadata&&e.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:Vv(r)},...i&&{trace:Ui({...i})}}}function KCe(e,t){return t&&(e.sdk=e.sdk||{},e.sdk.name=e.sdk.name||t.name,e.sdk.version=e.sdk.version||t.version,e.sdk.integrations=[...e.sdk.integrations||[],...t.integrations||[]],e.sdk.packages=[...e.sdk.packages||[],...t.packages||[]]),e}function zCe(e,t,n,r){const i=fte(n);return qv({sent_at:(new Date).toISOString(),...i&&{sdk:i},...!!r&&t&&{dsn:Vv(t)}},["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}function WCe(e,t,n,r){const i=fte(n),o=e.type&&"replay_event"!==e.type?e.type:"event";KCe(e,n&&n.sdk);const s=GCe(e,i,r,t);return delete e.sdkProcessingMetadata,qv(s,[[{type:o},e]])}function YCe(e,t){const n=Hv(e[0]),r=t&&t.getDsn(),i=t&&t.getOptions().tunnel,o={sent_at:(new Date).toISOString(),...(c=n,!!c.trace_id&&!!c.public_key&&{trace:n}),...!!i&&r&&{dsn:Vv(r)}},s=t&&t.getOptions().beforeSendSpan,a=s?e=>{const t=s(en(e));return t||nte(),t}:e=>en(e),l=[];var c;for(const t of e){const e=a(t);e&&l.push(HCe(e))}return qv(o,l)}function XCe(e,t,n,r=Bi()){const i=r&&ji(r);i&&(_t&&Ue.log(`[Measurement] Setting measurement on root span: ${e} = ${t} ${n}`),i.addEvent(e,{[fT]:t,[dT]:n}))}function zH(e){if(!e||0===e.length)return;const t={};return e.forEach(e=>{const n=e.attributes||{},r=n[dT],i=n[fT];"string"==typeof r&&"number"==typeof i&&(t[e.name]={value:i,unit:r})}),t}const WH=1e3;class NO{constructor(e={}){this._traceId=e.traceId||pf(),this._spanId=e.spanId||mf(),this._startTime=e.startTimestamp||fs(),this._attributes={},this.setAttributes({[Hr]:"manual",[Au]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?1:0}}setAttribute(e,t){return void 0===t?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach(t=>this.setAttribute(t,e[t])),this}updateStartTime(e){this._startTime=Vh(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(oa,"custom"),this}end(e){this._endTime||(this._endTime=Vh(e),kCe(this),this._onSpanEnded())}getSpanJSON(){return Ui({data:this._attributes,description:this._name,op:this._attributes[Au],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:ete(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Hr],_metrics_summary:tL(this),profile_id:this._attributes[lCe],exclusive_time:this._attributes[OO],measurements:zH(this._events),is_segment:this._isStandaloneSpan&&ji(this)===this||void 0,segment_id:this._isStandaloneSpan?ji(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,n){_t&&Ue.log("[Tracing] Adding an event to span:",e);const r=YH(t)?t:n||fs(),i=YH(t)?{}:t||{},o={name:e,time:Vh(r),attributes:i};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=tn();if(e&&e.emit("spanEnd",this),!this._isStandaloneSpan&&this!==ji(this))return;if(this._isStandaloneSpan)return void(this._sampled?QCe(YCe([this],e)):(_t&&Ue.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span")));const t=this._convertSpanToTransaction();t&&(VH(this).scope||Ln()).captureEvent(t)}_convertSpanToTransaction(){if(!XH(en(this)))return;this._name||(_t&&Ue.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=VH(this),n=(e||Ln()).getClient()||tn();if(!0!==this._sampled)return _t&&Ue.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),void(n&&n.recordDroppedEvent("sample_rate","transaction"));const r=cw(this).filter(e=>e!==this&&!JCe(e)).map(e=>en(e)).filter(XH),i=this._attributes[oa];delete this._attributes[jH],r.forEach(e=>{e.data&&delete e.data[jH]});const o={contexts:{trace:bCe(this)},spans:r.length>WH?r.sort((e,t)=>e.start_timestamp-t.start_timestamp).slice(0,WH):r,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,...Ui({dynamicSamplingContext:Hv(this)})},_metrics_summary:tL(this),...i&&{transaction_info:{source:i}}},s=zH(this._events);return s&&Object.keys(s).length&&(_t&&Ue.log("[Measurements] Adding measurements to transaction event",JSON.stringify(s,void 0,2)),o.measurements=s),o}}function YH(e){return e&&"number"==typeof e||e instanceof Date||Array.isArray(e)}function XH(e){return!!(e.start_timestamp&&e.timestamp&&e.span_id&&e.trace_id)}function JCe(e){return e instanceof NO&&e.isStandaloneSpan()}function QCe(e){const t=tn();if(!t)return;const n=e[1];n&&0!==n.length?t.sendEnvelope(e):t.recordDroppedEvent("before_send","span")}const hte="__SENTRY_SUPPRESS_TRACING__";function p_(e){const t=mte();if(t.startInactiveSpan)return t.startInactiveSpan(e);const n=e3e(e),{forceTransaction:r,parentSpan:i}=e;return(e.scope?t=>uT(e.scope,t):void 0!==i?e=>pte(i,e):e=>e())(()=>{const t=Ln(),i=n3e(t);return e.onlyIfParent&&!i?new Bv:ZCe({parentSpan:i,spanArguments:n,forceTransaction:r,scope:t})})}function pte(e,t){const n=mte();return n.withActiveSpan?n.withActiveSpan(e,t):uT(n=>(mb(n,e||void 0),t(n)))}function ZCe({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!vf())return new Bv;const i=hl();let o;if(e&&!n)o=t3e(e,r,t),tte(e,o);else if(e){const n=Hv(e),{traceId:i,spanId:s}=e.spanContext(),a=wp(e);o=JH({traceId:i,parentSpanId:s,...t},r,a),qH(o,n)}else{const{traceId:e,dsc:n,parentSpanId:s,sampled:a}={...i.getPropagationContext(),...r.getPropagationContext()};o=JH({traceId:e,parentSpanId:s,...t},r,a),n&&qH(o,n)}return ICe(o),RCe(o,r,i),o}function e3e(e){const t={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const n={...t};return n.startTimestamp=Vh(e.startTime),delete n.startTime,n}return t}function mte(){return $v(Ep())}function JH(e,t,n){const r=tn(),i=r&&r.getOptions()||{},{name:o="",attributes:s}=e,[a,l]=t.getScopeData().sdkProcessingMetadata[hte]?[!1]:xCe(i,{name:o,parentSampled:n,attributes:s,transactionContext:{name:o,parentSampled:n}}),c=new NO({...e,attributes:{[oa]:"custom",...e.attributes},sampled:a});return void 0!==l&&c.setAttribute(Kee,l),r&&r.emit("spanStart",c),c}function t3e(e,t,n){const{spanId:r,traceId:i}=e.spanContext(),o=!t.getScopeData().sdkProcessingMetadata[hte]&&wp(e),s=o?new NO({...n,parentSpanId:r,traceId:i,sampled:o}):new Bv({traceId:i});tte(e,s);const a=tn();return a&&(a.emit("spanStart",s),n.endTimestamp&&a.emit("spanEnd",s)),s}function n3e(e){const t=EC(e);if(!t)return;const n=tn();return(n?n.getOptions():{}).parentSpanIsAlwaysRootSpan?ji(t):t}const lw={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3},r3e="heartbeatFailed",i3e="idleTimeout",s3e="finalTimeout",o3e="externalFinish";function gte(e,t={}){const n=new Map;let r,i=!1,o=o3e,s=!t.disableAutoFinish;const a=[],{idleTimeout:l=lw.idleTimeout,finalTimeout:c=lw.finalTimeout,childSpanTimeout:u=lw.childSpanTimeout,beforeSpanEnd:d}=t,h=tn();if(!h||!vf())return new Bv;const p=Ln(),f=Bi(),m=a3e(e);function v(){r&&(clearTimeout(r),r=void 0)}function g(e){v(),r=setTimeout(()=>{!i&&0===n.size&&s&&(o=i3e,m.end(e))},l)}function y(e){r=setTimeout(()=>{!i&&s&&(o=r3e,m.end(e))},u)}function b(e){i=!0,n.clear(),a.forEach(e=>e()),mb(p,f);const t=en(m),{start_timestamp:r}=t;if(!r)return;(t.data||{})[nL]||m.setAttribute(nL,o),Ue.log(`[Tracing] Idle span "${t.op}" finished`);const s=cw(m).filter(e=>e!==m);let u=0;s.forEach(t=>{t.isRecording()&&(t.setStatus({code:2,message:"cancelled"}),t.end(e),_t&&Ue.log("[Tracing] Cancelling span since span ended early",JSON.stringify(t,void 0,2)));const n=en(t),{timestamp:r=0,start_timestamp:i=0}=n,o=i<=e,s=r-i<=(c+l)/1e3;if(_t){const e=JSON.stringify(t,void 0,2);o?s||Ue.log("[Tracing] Discarding span since it finished after idle span final timeout",e):Ue.log("[Tracing] Discarding span since it happened after idle span was finished",e)}(!s||!o)&&(CCe(m,t),u++)}),u>0&&m.setAttribute("sentry.idle_span_discarded_spans",u)}return m.end=new Proxy(m.end,{apply(e,t,n){d&&d(m);const[r,...i]=n,o=Vh(r||fs()),s=cw(m).filter(e=>e!==m);if(!s.length)return b(o),Reflect.apply(e,t,[o,...i]);const a=s.map(e=>en(e).timestamp).filter(e=>!!e),l=a.length?Math.max(...a):void 0,u=en(m).start_timestamp,h=Math.min(u?u+c/1e3:1/0,Math.max(u||-1/0,Math.min(o,l||1/0)));return b(h),Reflect.apply(e,t,[h,...i])}}),a.push(h.on("spanStart",e=>{i||e===m||en(e).timestamp||cw(m).includes(e)&&function(e){v(),n.set(e,!0),y(fs()+u/1e3)}(e.spanContext().spanId)})),a.push(h.on("spanEnd",e=>{i||function(e){n.has(e)&&n.delete(e),0===n.size&&g(fs()+l/1e3)}(e.spanContext().spanId)})),a.push(h.on("idleSpanEnableAutoFinish",e=>{e===m&&(s=!0,g(),n.size&&y())})),t.disableAutoFinish||g(),setTimeout(()=>{i||(m.setStatus({code:2,message:"deadline_exceeded"}),o=s3e,m.end())},c),m}function a3e(e){const t=p_(e);return mb(Ln(),t),_t&&Ue.log("[Tracing] Started span is an idle span"),t}function aL(e,t,n,r=0){return new Zo((i,o)=>{const s=e[r];if(null===t||"function"!=typeof s)i(t);else{const a=s({...t},n);_t&&s.id&&null===a&&Ue.log(`Event processor "${s.id}" dropped event`),cT(a)?a.then(t=>aL(e,t,n,r+1).then(i)).then(null,o):aL(e,a,n,r+1).then(i).then(null,o)}})}let k2,QH,x2;function c3e(e){const t=Yt._sentryDebugIds;if(!t)return{};const n=Object.keys(t);return x2&&n.length===QH||(QH=n.length,x2=n.reduce((n,r)=>{k2||(k2={});const i=k2[r];if(i)n[i[0]]=i[1];else{const i=e(r);for(let e=i.length-1;e>=0;e--){const o=i[e],s=o&&o.filename,a=t[r];if(s&&a){n[s]=a,k2[r]=[s,a];break}}}return n},{})),x2}function l3e(e,t){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:o}=t;u3e(e,t),r&&h3e(e,r),p3e(e,n),d3e(e,i),f3e(e,o)}function ZH(e,t){const{extra:n,tags:r,user:i,contexts:o,level:s,sdkProcessingMetadata:a,breadcrumbs:l,fingerprint:c,eventProcessors:u,attachments:d,propagationContext:h,transactionName:p,span:f}=t;A2(e,"extra",n),A2(e,"tags",r),A2(e,"user",i),A2(e,"contexts",o),e.sdkProcessingMetadata=lT(e.sdkProcessingMetadata,a,2),s&&(e.level=s),p&&(e.transactionName=p),f&&(e.span=f),l.length&&(e.breadcrumbs=[...e.breadcrumbs,...l]),c.length&&(e.fingerprint=[...e.fingerprint,...c]),u.length&&(e.eventProcessors=[...e.eventProcessors,...u]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...h}}function A2(e,t,n){e[t]=lT(e[t],n,1)}function u3e(e,t){const{extra:n,tags:r,user:i,contexts:o,level:s,transactionName:a}=t,l=Ui(n);l&&Object.keys(l).length&&(e.extra={...l,...e.extra});const c=Ui(r);c&&Object.keys(c).length&&(e.tags={...c,...e.tags});const u=Ui(i);u&&Object.keys(u).length&&(e.user={...u,...e.user});const d=Ui(o);d&&Object.keys(d).length&&(e.contexts={...d,...e.contexts}),s&&(e.level=s),a&&"transaction"!==e.type&&(e.transaction=a)}function d3e(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}function f3e(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}function h3e(e,t){e.contexts={trace:_Ce(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:Hv(t),...e.sdkProcessingMetadata};const n=en(ji(t)).description;n&&!e.transaction&&"transaction"===e.type&&(e.transaction=n)}function p3e(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint}function m3e(e,t,n,r,i,o){const{normalizeDepth:s=3,normalizeMaxBreadth:a=1e3}=e,l={...t,event_id:t.event_id||n.event_id||da(),timestamp:t.timestamp||h_()},c=n.integrations||e.integrations.map(e=>e.name);g3e(l,e),b3e(l,c),i&&i.emit("applyFrameMetadata",t),void 0===t.type&&v3e(l,e.stackParser);const u=S3e(r,n.captureContext);n.mechanism&&iv(l,n.mechanism);const d=i?i.getEventProcessors():[],h=oCe().getScopeData();if(o){ZH(h,o.getScopeData())}if(u){ZH(h,u.getScopeData())}const p=[...n.attachments||[],...h.attachments];p.length&&(n.attachments=p),l3e(l,h);return aL([...d,...h.eventProcessors],l,n).then(e=>(e&&y3e(e),"number"==typeof s&&s>0?_3e(e,s,a):e))}function g3e(e,t){const{environment:n,release:r,dist:i,maxValueLength:o=250}=t;e.environment=e.environment||n||DO,!e.release&&r&&(e.release=r),!e.dist&&i&&(e.dist=i),e.message&&(e.message=kg(e.message,o));const s=e.exception&&e.exception.values&&e.exception.values[0];s&&s.value&&(s.value=kg(s.value,o));const a=e.request;a&&a.url&&(a.url=kg(a.url,o))}function v3e(e,t){const n=c3e(t);try{e.exception.values.forEach(e=>{e.stacktrace.frames.forEach(e=>{n&&e.filename&&(e.debug_id=n[e.filename])})})}catch{}}function y3e(e){const t={};try{e.exception.values.forEach(e=>{e.stacktrace.frames.forEach(e=>{e.debug_id&&(e.abs_path?t[e.abs_path]=e.debug_id:e.filename&&(t[e.filename]=e.debug_id),delete e.debug_id)})})}catch{}if(0===Object.keys(t).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach(([e,t])=>{n.push({type:"sourcemap",code_file:e,debug_id:t})})}function b3e(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function _3e(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(e=>({...e,...e.data&&{data:Kl(e.data,t,n)}}))},...e.user&&{user:Kl(e.user,t,n)},...e.contexts&&{contexts:Kl(e.contexts,t,n)},...e.extra&&{extra:Kl(e.extra,t,n)}};return e.contexts&&e.contexts.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=Kl(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map(e=>({...e,...e.data&&{data:Kl(e.data,t,n)}}))),e.contexts&&e.contexts.flags&&r.contexts&&(r.contexts.flags=Kl(e.contexts.flags,3,n)),r}function S3e(e,t){if(!t)return e;const n=e?e.clone():new gf;return n.update(t),n}function E3e(e){if(e)return w3e(e)||T3e(e)?{captureContext:e}:e}function w3e(e){return e instanceof gf||"function"==typeof e}const C3e=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function T3e(e){return Object.keys(e).some(e=>C3e.includes(e))}function hT(e,t){return Ln().captureException(e,E3e(t))}function R3e(e,t){const n={captureContext:t};return Ln().captureMessage(e,void 0,n)}function vte(e,t){return Ln().captureEvent(e,t)}function I3e(e,t){hl().setContext(e,t)}function k3e(){return hl().lastEventId()}function x3e(){const e=tn();return!!e&&!1!==e.getOptions().enabled&&!!e.getTransport()}function eV(e){const t=tn(),n=hl(),r=Ln(),{release:i,environment:o=DO}=t&&t.getOptions()||{},{userAgent:s}=Yt.navigator||{},a=Xwe({release:i,environment:o,user:r.getUser()||n.getUser(),...s&&{userAgent:s},...e}),l=n.getSession();return l&&"ok"===l.status&&sv(l,{status:"exited"}),yte(),n.setSession(a),r.setSession(a),a}function yte(){const e=hl(),t=Ln(),n=t.getSession()||e.getSession();n&&Jwe(n),bte(),e.setSession(),t.setSession()}function bte(){const e=hl(),t=Ln(),n=tn(),r=t.getSession()||e.getSession();r&&n&&n.captureSession(r)}function tV(e=!1){e?yte():bte()}const A3e="7";function _te(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}function L3e(e){return`${_te(e)}${e.projectId}/envelope/`}function P3e(e,t){const n={sentry_version:"7"};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}function O3e(e,t,n){return t||`${L3e(e)}?${P3e(e,n)}`}function M3e(e,t){const n=ute(e);if(!n)return"";const r=`${_te(n)}embed/error-page/`;let i=`dsn=${Vv(n)}`;for(const e in t)if("dsn"!==e&&"onClose"!==e)if("user"===e){const e=t.user;if(!e)continue;e.name&&(i+=`&name=${encodeURIComponent(e.name)}`),e.email&&(i+=`&email=${encodeURIComponent(e.email)}`)}else i+=`&${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`;return`${r}?${i}`}const nV=[];function D3e(e){const t={};return e.forEach(e=>{const{name:n}=e,r=t[n];r&&!r.isDefaultInstance&&e.isDefaultInstance||(t[n]=e)}),Object.values(t)}function N3e(e){const t=e.defaultIntegrations||[],n=e.integrations;let r;if(t.forEach(e=>{e.isDefaultInstance=!0}),Array.isArray(n))r=[...t,...n];else if("function"==typeof n){const e=n(t);r=Array.isArray(e)?e:[e]}else r=t;const i=D3e(r),o=i.findIndex(e=>"Debug"===e.name);if(o>-1){const[e]=i.splice(o,1);i.push(e)}return i}function U3e(e,t){const n={};return t.forEach(t=>{t&&Ste(e,t,n)}),n}function rV(e,t){for(const n of t)n&&n.afterAllSetup&&n.afterAllSetup(e)}function Ste(e,t,n){if(n[t.name])_t&&Ue.log(`Integration skipped because it was already installed: ${t.name}`);else{if(n[t.name]=t,-1===nV.indexOf(t.name)&&"function"==typeof t.setupOnce&&(t.setupOnce(),nV.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),"function"==typeof t.preprocessEvent){const n=t.preprocessEvent.bind(t);e.on("preprocessEvent",(t,r)=>n(t,r,e))}if("function"==typeof t.processEvent){const n=t.processEvent.bind(t),r=Object.assign((t,r)=>n(t,r,e),{id:t.name});e.addEventProcessor(r)}_t&&Ue.log(`Integration installed: ${t.name}`)}}function j3e(e,t,n){return qv(t?{dsn:t}:{},[[{type:"client_report"},{timestamp:h_(),discarded_events:e}]])}class Va extends Error{constructor(e,t="warn"){super(e),this.message=e,this.logLevel=t}}const iV="Not capturing exception because it's already been captured.";class F3e{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=ute(e.dsn):_t&&Ue.warn("No DSN provided, client will not send events."),this._dsn){const t=O3e(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}const t=["enableTracing","tracesSampleRate","tracesSampler"].find(t=>t in e&&null==e[t]);t&&Sp(()=>{console.warn(`[Sentry] Deprecation warning: \`${t}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)})}captureException(e,t,n){const r=da();if(NH(e))return _t&&Ue.log(iV),r;const i={event_id:r,...t};return this._process(this.eventFromException(e,i).then(e=>this._captureEvent(e,i,n))),i.event_id}captureMessage(e,t,n,r){const i={event_id:da(),...n},o=xO(e)?e:String(e),s=AO(e)?this.eventFromMessage(o,t,i):this.eventFromException(e,i);return this._process(s.then(e=>this._captureEvent(e,i,r))),i.event_id}captureEvent(e,t,n){const r=da();if(t&&t.originalException&&NH(t.originalException))return _t&&Ue.log(iV),r;const i={event_id:r,...t},o=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,i,o||n)),i.event_id}captureSession(e){"string"!=typeof e.release?_t&&Ue.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),sv(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then(n=>t.flush(e).then(e=>n&&e))):np(!0)}close(e){return this.flush(e).then(e=>(this.getOptions().enabled=!1,this.emit("close"),e))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];Ste(this,e,this._integrations),t||rV(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=WCe(e,this._dsn,this._options._metadata,this._options.tunnel);for(const e of t.attachments||[])n=FCe(n,VCe(e));const r=this.sendEnvelope(n);r&&r.then(t=>this.emit("afterSendEvent",e,t),null)}sendSession(e){const t=zCe(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(t)}recordDroppedEvent(e,t,n){if(this._options.sendClientReports){const r="number"==typeof n?n:1,i=`${e}:${t}`;_t&&Ue.log(`Recording outcome: "${i}"${r>1?` (${r} times)`:""}`),this._outcomes[i]=(this._outcomes[i]||0)+r}}on(e,t){const n=this._hooks[e]=this._hooks[e]||[];return n.push(t),()=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)}}emit(e,...t){const n=this._hooks[e];n&&n.forEach(e=>e(...t))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,e=>(_t&&Ue.error("Error while sending envelope:",e),e)):(_t&&Ue.error("Transport disabled"),np({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=U3e(this,e),rV(this,e)}_updateSessionFromEvent(e,t){let n="fatal"===t.level,r=!1;const i=t.exception&&t.exception.values;if(i){r=!0;for(const e of i){const t=e.mechanism;if(t&&!1===t.handled){n=!0;break}}}const o="ok"===e.status;(o&&0===e.errors||o&&n)&&(sv(e,{...n&&{status:"crashed"},errors:e.errors||Number(r||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Zo(t=>{let n=0;const r=setInterval(()=>{0==this._numProcessing?(clearInterval(r),t(!0)):(n+=1,e&&n>=e&&(clearInterval(r),t(!1)))},1)})}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,n=Ln(),r=hl()){const i=this.getOptions(),o=Object.keys(this._integrations);return!t.integrations&&o.length>0&&(t.integrations=o),this.emit("preprocessEvent",e,t),e.type||r.setLastEventId(e.event_id||t.event_id),m3e(i,e,t,n,this,r).then(e=>{if(null===e)return e;e.contexts={trace:aCe(n),...e.contexts};const t=ate(this,n);return e.sdkProcessingMetadata={dynamicSamplingContext:t,...e.sdkProcessingMetadata},e})}_captureEvent(e,t={},n){return this._processEvent(e,t,n).then(e=>e.event_id,e=>{_t&&(e instanceof Va&&"log"===e.logLevel?Ue.log(e.message):Ue.warn(e))})}_processEvent(e,t,n){const r=this.getOptions(),{sampleRate:i}=r,o=wte(e),s=Ete(e),a=e.type||"error",l=`before send for type \`${a}\``,c=typeof i>"u"?void 0:cte(i);if(s&&"number"==typeof c&&Math.random()>c)return this.recordDroppedEvent("sample_rate","error",e),SC(new Va(`Discarding event because it's not included in the random sample (sampling rate = ${i})`,"log"));const u="replay_event"===a?"replay":a,d=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,t,n,d).then(n=>{if(null===n)throw this.recordDroppedEvent("event_processor",u,e),new Va("An event processor returned `null`, will not send event.","log");if(t.data&&!0===t.data.__sentry__)return n;return $3e(B3e(this,r,n,t),l)}).then(r=>{if(null===r){if(this.recordDroppedEvent("before_send",u,e),o){const t=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",t)}throw new Va(`${l} returned \`null\`, will not send event.`,"log")}const i=n&&n.getSession();if(!o&&i&&this._updateSessionFromEvent(i,r),o){const e=(r.sdkProcessingMetadata&&r.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(r.spans?r.spans.length:0);e>0&&this.recordDroppedEvent("before_send","span",e)}const s=r.transaction_info;if(o&&s&&r.transaction!==e.transaction){const e="custom";r.transaction_info={...s,source:e}}return this.sendEvent(r,t),r}).then(null,e=>{throw e instanceof Va?e:(this.captureException(e,{data:{__sentry__:!0},originalException:e}),new Va(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`))})}_process(e){this._numProcessing++,e.then(e=>(this._numProcessing--,e),e=>(this._numProcessing--,e))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([e,t])=>{const[n,r]=e.split(":");return{reason:n,category:r,quantity:t}})}_flushOutcomes(){_t&&Ue.log("Flushing outcomes...");const e=this._clearOutcomes();if(0===e.length)return void(_t&&Ue.log("No outcomes to send"));if(!this._dsn)return void(_t&&Ue.log("No dsn provided, will not send outcomes"));_t&&Ue.log("Sending outcomes:",e);const t=j3e(e,this._options.tunnel&&Vv(this._dsn));this.sendEnvelope(t)}}function $3e(e,t){const n=`${t} must return \`null\` or a valid event.`;if(cT(e))return e.then(e=>{if(!rv(e)&&null!==e)throw new Va(n);return e},e=>{throw new Va(`${t} rejected with ${e}`)});if(!rv(e)&&null!==e)throw new Va(n);return e}function B3e(e,t,n,r){const{beforeSend:i,beforeSendTransaction:o,beforeSendSpan:s}=t;if(Ete(n)&&i)return i(n,r);if(wte(n)){if(n.spans&&s){const t=[];for(const r of n.spans){const n=s(r);n?t.push(n):(nte(),e.recordDroppedEvent("before_send","span"))}n.spans=t}if(o){if(n.spans){const e=n.spans.length;n.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:e}}return o(n,r)}}return n}function Ete(e){return void 0===e.type}function wte(e){return"transaction"===e.type}function H3e(e,t){!0===t.debug&&(_t?Ue.enable():Sp(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),Ln().update(t.initialScope);const n=new e(t);return V3e(n),n.init(),n}function V3e(e){Ln().setClient(e)}function q3e(e){const t=[];function n(e){return t.splice(t.indexOf(e),1)[0]||Promise.resolve(void 0)}return{$:t,add:function(r){if(!(void 0===e||t.length<e))return SC(new Va("Not adding Promise because buffer limit was reached."));const i=r();return-1===t.indexOf(i)&&t.push(i),i.then(()=>n(i)).then(null,()=>n(i).then(null,()=>{})),i},drain:function(e){return new Zo((n,r)=>{let i=t.length;if(!i)return n(!0);const o=setTimeout(()=>{e&&e>0&&n(!1)},e);t.forEach(e=>{np(e).then(()=>{--i||(clearTimeout(o),n(!0))},r)})})}}}const G3e=6e4;function K3e(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${e}`);return isNaN(r)?G3e:r-t}function z3e(e,t){return e[t]||e.all||0}function W3e(e,t,n=Date.now()){return z3e(e,t)>n}function Y3e(e,{statusCode:t,headers:n},r=Date.now()){const i={...e},o=n&&n["x-sentry-rate-limits"],s=n&&n["retry-after"];if(o)for(const e of o.trim().split(",")){const[t,n,,,o]=e.split(":",5),s=parseInt(t,10),a=1e3*(isNaN(s)?60:s);if(n)for(const e of n.split(";"))"metric_bucket"===e?(!o||o.split(";").includes("custom"))&&(i[e]=r+a):i[e]=r+a;else i.all=r+a}else s?i.all=r+K3e(s,r):429===t&&(i.all=r+6e4);return i}const X3e=64;function J3e(e,t,n=q3e(e.bufferSize||64)){let r={};return{send:function(i){const o=[];if(GH(i,(t,n)=>{const i=KH(n);if(W3e(r,i)){const r=sV(t,n);e.recordDroppedEvent("ratelimit_backoff",i,r)}else o.push(t)}),0===o.length)return np({});const s=qv(i[0],o),a=t=>{GH(s,(n,r)=>{const i=sV(n,r);e.recordDroppedEvent(t,KH(r),i)})};return n.add(()=>t({body:$Ce(s)}).then(e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&_t&&Ue.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),r=Y3e(r,e),e),e=>{throw a("network_error"),e})).then(e=>e,e=>{if(e instanceof Va)return _t&&Ue.error("Skipped sending event because buffer is full."),a("queue_overflow"),np({});throw e})},flush:e=>n.drain(e)}}function sV(e,t){if("event"===t||"transaction"===t)return Array.isArray(e)?e[1]:void 0}function Cte(e,t,n=[t],r="npm"){const i=e._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${t}`,packages:n.map(e=>({name:`${r}:@sentry/${e}`,version:Bh})),version:Bh}),e._metadata=i}function Tte(e={}){const t=tn();if(!x3e()||!t)return{};const n=$v(Ep());if(n.getTraceData)return n.getTraceData(e);const r=Ln(),i=e.span||Bi(),o=i?SCe(i):Q3e(r),s=pCe(i?Hv(i):ate(t,r));return Xee.test(o)?{"sentry-trace":o,baggage:s}:(Ue.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function Q3e(e){const{traceId:t,sampled:n,spanId:r}=e.getPropagationContext();return Jee(t,r,n)}const Z3e=100;function rp(e,t){const n=tn(),r=hl();if(!n)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:o=Z3e}=n.getOptions();if(o<=0)return;const s={timestamp:h_(),...e},a=i?Sp(()=>i(s,t)):s;null!==a&&(n.emit&&n.emit("beforeAddBreadcrumb",a,t),r.addBreadcrumb(a,o))}let oV;const eTe="FunctionToString",aV=new WeakMap,tTe=()=>({name:eTe,setupOnce(){oV=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=LO(this),n=aV.has(tn())&&void 0!==t?t:this;return oV.apply(n,e)}}catch{}},setup(e){aV.set(e,!0)}}),nTe=tTe,rTe=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",'can\'t redefine non-configurable property "solana"',"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],iTe="InboundFilters",sTe=(e={})=>({name:iTe,processEvent(t,n,r){const i=r.getOptions();return cTe(t,aTe(e,i))?null:t}}),oTe=sTe;function aTe(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:rTe],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]],ignoreInternal:void 0===e.ignoreInternal||e.ignoreInternal}}function cTe(e,t){return t.ignoreInternal&&pTe(e)?(_t&&Ue.warn(`Event dropped due to being internal Sentry Error.\nEvent: ${Md(e)}`),!0):lTe(e,t.ignoreErrors)?(_t&&Ue.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${Md(e)}`),!0):gTe(e)?(_t&&Ue.warn(`Event dropped due to not having an error message, error type or stacktrace.\nEvent: ${Md(e)}`),!0):uTe(e,t.ignoreTransactions)?(_t&&Ue.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${Md(e)}`),!0):dTe(e,t.denyUrls)?(_t&&Ue.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${Md(e)}.\nUrl: ${wC(e)}`),!0):!fTe(e,t.allowUrls)&&(_t&&Ue.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${Md(e)}.\nUrl: ${wC(e)}`),!0)}function lTe(e,t){return!(e.type||!t||!t.length)&&hTe(e).some(e=>Hh(e,t))}function uTe(e,t){if("transaction"!==e.type||!t||!t.length)return!1;const n=e.transaction;return!!n&&Hh(n,t)}function dTe(e,t){if(!t||!t.length)return!1;const n=wC(e);return!!n&&Hh(n,t)}function fTe(e,t){if(!t||!t.length)return!0;const n=wC(e);return!n||Hh(n,t)}function hTe(e){const t=[];let n;e.message&&t.push(e.message);try{n=e.exception.values[e.exception.values.length-1]}catch{}return n&&n.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`)),t}function pTe(e){try{return"SentryError"===e.exception.values[0].type}catch{}return!1}function mTe(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}function wC(e){try{let t;try{t=e.exception.values[0].stacktrace.frames}catch{}return t?mTe(t):null}catch{return _t&&Ue.error(`Cannot extract url for event ${Md(e)}`),null}}function gTe(e){return!(e.type||!e.exception||!e.exception.values||0===e.exception.values.length)&&(!e.message&&!e.exception.values.some(e=>e.stacktrace||e.type&&"Error"!==e.type||e.value))}function vTe(e,t,n=250,r,i,o,s){if(!(o.exception&&o.exception.values&&s&&xu(s.originalException,Error)))return;const a=o.exception.values.length>0?o.exception.values[o.exception.values.length-1]:void 0;a&&(o.exception.values=yTe(cL(e,t,i,s.originalException,r,o.exception.values,a,0),n))}function cL(e,t,n,r,i,o,s,a){if(o.length>=n+1)return o;let l=[...o];if(xu(r[i],Error)){cV(s,a);const o=e(t,r[i]),c=l.length;lV(o,i,c,a),l=cL(e,t,n,r[i],i,[o,...l],o,c)}return Array.isArray(r.errors)&&r.errors.forEach((r,o)=>{if(xu(r,Error)){cV(s,a);const c=e(t,r),u=l.length;lV(c,`errors[${o}]`,u,a),l=cL(e,t,n,r,i,[c,...l],c,u)}}),l}function cV(e,t){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,..."AggregateError"===e.type&&{is_exception_group:!0},exception_id:t}}function lV(e,t,n,r){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}function yTe(e,t){return e.map(e=>(e.value&&(e.value=kg(e.value,t)),e))}function Gh(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function uV(e){return e.split(/\\?\//).filter(e=>e.length>0&&","!==e).length}function bTe(e){const t="console";Of(t,e),Mf(t,_Te)}function _Te(){"console"in Yt&&JA.forEach(function(e){e in Yt.console&&So(Yt.console,e,function(t){return _C[e]=t,function(...t){ua("console",{args:t,level:e});const n=_C[e];n&&n.apply(Yt.console,t)}})})}function STe(e){return"warn"===e?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}const ETe="Dedupe",wTe=()=>{let e;return{name:ETe,processEvent(t){if(t.type)return t;try{if(TTe(t,e))return _t&&Ue.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return e=t}}},CTe=wTe;function TTe(e,t){return!!t&&!(!RTe(e,t)&&!ITe(e,t))}function RTe(e,t){const n=e.message,r=t.message;return!(!n&&!r||n&&!r||!n&&r||n!==r||!Ite(e,t)||!Rte(e,t))}function ITe(e,t){const n=dV(t),r=dV(e);return!!(n&&r&&n.type===r.type&&n.value===r.value&&Ite(e,t)&&Rte(e,t))}function Rte(e,t){let n=AH(e),r=AH(t);if(!n&&!r)return!0;if(n&&!r||!n&&r||r.length!==n.length)return!1;for(let e=0;e<r.length;e++){const t=r[e],i=n[e];if(t.filename!==i.filename||t.lineno!==i.lineno||t.colno!==i.colno||t.function!==i.function)return!1}return!0}function Ite(e,t){let n=e.fingerprint,r=t.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return n.join("")===r.join("")}catch{return!1}}function dV(e){return e.exception&&e.exception.values&&e.exception.values[0]}function kTe(e,t,n,r,i="auto.http.browser"){if(!e.fetchData)return;const o=vf()&&t(e.fetchData.url);if(e.endTimestamp&&o){const t=e.fetchData.__span;if(!t)return;const n=r[t];return void(n&&(LTe(n,e),delete r[t]))}const{method:s,url:a}=e.fetchData,l=ATe(a),c=l?Gh(l).host:void 0,u=!!Bi(),d=o&&u?p_({name:`${s} ${a}`,attributes:{url:a,type:"fetch","http.method":s,"http.url":l,"server.address":c,[Hr]:i,[Au]:"http.client"}}):new Bv;if(e.fetchData.__span=d.spanContext().spanId,r[d.spanContext().spanId]=d,n(e.fetchData.url)){const t=e.args[0],n=e.args[1]||{},r=xTe(t,n,vf()&&u?d:void 0);r&&(e.args[1]=n,n.headers=r)}return d}function xTe(e,t,n){const r=Tte({span:n}),i=r["sentry-trace"],o=r.baggage;if(!i)return;const s=t.headers||(PTe(e)?e.headers:void 0);if(s){if(OTe(s)){const e=new Headers(s);if(e.set("sentry-trace",i),o){const t=e.get("baggage");if(t){const n=L2(t);e.set("baggage",n?`${n},${o}`:o)}else e.set("baggage",o)}return e}if(Array.isArray(s)){const e=[...s.filter(e=>!(Array.isArray(e)&&"sentry-trace"===e[0])).map(e=>{if(Array.isArray(e)&&"baggage"===e[0]&&"string"==typeof e[1]){const[t,n,...r]=e;return[t,L2(n),...r]}return e}),["sentry-trace",i]];return o&&e.push(["baggage",o]),e}{const e="baggage"in s?s.baggage:void 0;let t=[];return Array.isArray(e)?t=e.map(e=>"string"==typeof e?L2(e):e).filter(e=>""===e):e&&t.push(L2(e)),o&&t.push(o),{...s,"sentry-trace":i,baggage:t.length>0?t.join(","):void 0}}}return{...r}}function ATe(e){try{return new URL(e).href}catch{return}}function LTe(e,t){if(t.response){Wee(e,t.response.status);const n=t.response&&t.response.headers&&t.response.headers.get("content-length");if(n){const t=parseInt(n);t>0&&e.setAttribute("http.response_content_length",t)}}else t.error&&e.setStatus({code:2,message:"internal_error"});e.end()}function L2(e){return e.split(",").filter(e=>!e.split("=")[0].startsWith(MO)).join(",")}function PTe(e){return typeof Request<"u"&&xu(e,Request)}function OTe(e){return typeof Headers<"u"&&xu(e,Headers)}function kte(e){if(void 0!==e)return e>=400&&e<500?"warning":e>=500?"error":void 0}const lL=Yt;function xte(){if(!("fetch"in lL))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function uL(e){return e&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function MTe(){if("string"==typeof EdgeRuntime)return!0;if(!xte())return!1;if(uL(lL.fetch))return!0;let e=!1;const t=lL.document;if(t&&"function"==typeof t.createElement)try{const n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(e=uL(n.contentWindow.fetch)),t.head.removeChild(n)}catch(e){Pf&&Ue.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return e}function Ate(e,t){const n="fetch";Of(n,e),Mf(n,()=>Lte(void 0,t))}function DTe(e){const t="fetch-body-resolved";Of(t,e),Mf(t,()=>Lte(UTe))}function Lte(e,t=!1){t&&!MTe()||So(Yt,"fetch",function(t){return function(...n){const r=new Error,{method:i,url:o}=jTe(n),s={args:n,fetchData:{method:i,url:o},startTimestamp:1e3*fs(),virtualError:r};return e||ua("fetch",{...s}),t.apply(Yt,n).then(async t=>(e?e(t):ua("fetch",{...s,endTimestamp:1e3*fs(),response:t}),t),e=>{throw ua("fetch",{...s,endTimestamp:1e3*fs(),error:e}),oT(e)&&void 0===e.stack&&(e.stack=r.stack,ga(e,"framesToPop",1)),e})}})}async function NTe(e,t){if(e&&e.body){const n=e.body,r=n.getReader(),i=setTimeout(()=>{n.cancel().then(null,()=>{})},9e4);let o=!0;for(;o;){let e;try{e=setTimeout(()=>{n.cancel().then(null,()=>{})},5e3);const{done:i}=await r.read();clearTimeout(e),i&&(t(),o=!1)}catch{o=!1}finally{clearTimeout(e)}}clearTimeout(i),r.releaseLock(),n.cancel().then(null,()=>{})}}function UTe(e){let t;try{t=e.clone()}catch{return}NTe(t,()=>{ua("fetch-body-resolved",{endTimestamp:1e3*fs(),response:e})})}function dL(e,t){return!!e&&"object"==typeof e&&!!e[t]}function fV(e){return"string"==typeof e?e:e?dL(e,"url")?e.url:e.toString?e.toString():"":""}function jTe(e){if(0===e.length)return{method:"GET",url:""};if(2===e.length){const[t,n]=e;return{url:fV(t),method:dL(n,"method")?String(n.method).toUpperCase():"GET"}}const t=e[0];return{url:fV(t),method:dL(t,"method")?String(t.method).toUpperCase():"GET"}}function FTe(){return"npm"}const P2=Yt;function $Te(){const e=P2.chrome,t=e&&e.app&&e.app.runtime,n="history"in P2&&!!P2.history.pushState&&!!P2.history.replaceState;return!t&&n}const rt=Yt;let fL=0;function Pte(){return fL>0}function BTe(){fL++,setTimeout(()=>{fL--})}function av(e,t={}){if("function"!=typeof e)return e;try{const t=e.__sentry_wrapped__;if(t)return"function"==typeof t?t:e;if(LO(e))return e}catch{return e}const n=function(...n){try{const r=n.map(e=>av(e,t));return e.apply(this,r)}catch(e){throw BTe(),uT(r=>{r.addEventProcessor(e=>(t.mechanism&&(ZA(e,void 0),iv(e,t.mechanism)),e.extra={...e.extra,arguments:n},e)),hT(e)}),e}};try{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}catch{}Hee(n,e),ga(e,"__sentry_wrapped__",n);try{Object.getOwnPropertyDescriptor(n,"name").configurable&&Object.defineProperty(n,"name",{get:()=>e.name})}catch{}return n}const Co=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function UO(e,t){const n=jO(e,t),r={type:KTe(t),value:zTe(t)};return n.length&&(r.stacktrace={frames:n}),void 0===r.type&&""===r.value&&(r.value="Unrecoverable error caught"),r}function HTe(e,t,n,r){const i=tn(),o=i&&i.getOptions().normalizeDepth,s=QTe(t),a={__serialized__:dte(t,o)};if(s)return{exception:{values:[UO(e,s)]},extra:a};const l={exception:{values:[{type:aT(t)?t.constructor.name:r?"UnhandledRejection":"Error",value:XTe(t,{isUnhandledRejection:r})}]},extra:a};if(n){const t=jO(e,n);t.length&&(l.exception.values[0].stacktrace={frames:t})}return l}function s6(e,t){return{exception:{values:[UO(e,t)]}}}function jO(e,t){const n=t.stacktrace||t.stack||"",r=qTe(t),i=GTe(t);try{return e(n,r,i)}catch{}return[]}const VTe=/Minified React error #\d+;/i;function qTe(e){return e&&VTe.test(e.message)?1:0}function GTe(e){return"number"==typeof e.framesToPop?e.framesToPop:0}function Ote(e){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"&&e instanceof WebAssembly.Exception}function KTe(e){const t=e&&e.name;return!t&&Ote(e)?e.message&&Array.isArray(e.message)&&2==e.message.length?e.message[0]:"WebAssembly.Exception":t}function zTe(e){const t=e&&e.message;return t?t.error&&"string"==typeof t.error.message?t.error.message:Ote(e)&&Array.isArray(e.message)&&2==e.message.length?e.message[1]:t:"No error message"}function WTe(e,t,n,r){const i=FO(e,t,n&&n.syntheticException||void 0,r);return iv(i),i.level="error",n&&n.event_id&&(i.event_id=n.event_id),np(i)}function YTe(e,t,n="info",r,i){const o=hL(e,t,r&&r.syntheticException||void 0,i);return o.level=n,r&&r.event_id&&(o.event_id=r.event_id),np(o)}function FO(e,t,n,r,i){let o;if(Fee(t)&&t.error)return s6(e,t.error);if(PH(t)||Uwe(t)){const i=t;if("stack"in t)o=s6(e,t);else{const t=i.name||(PH(i)?"DOMError":"DOMException"),s=i.message?`${t}: ${i.message}`:t;o=hL(e,s,n,r),ZA(o,s)}return"code"in i&&(o.tags={...o.tags,"DOMException.code":`${i.code}`}),o}return oT(t)?s6(e,t):rv(t)||aT(t)?(o=HTe(e,t,n,i),iv(o,{synthetic:!0}),o):(o=hL(e,t,n,r),ZA(o,`${t}`),iv(o,{synthetic:!0}),o)}function hL(e,t,n,r){const i={};if(r&&n){const r=jO(e,n);r.length&&(i.exception={values:[{value:t,stacktrace:{frames:r}}]}),iv(i,{synthetic:!0})}if(xO(t)){const{__sentry_template_string__:e,__sentry_template_values__:n}=t;return i.logentry={message:e,params:n},i}return i.message=t,i}function XTe(e,{isUnhandledRejection:t}){const n=Kwe(e),r=t?"promise rejection":"exception";return Fee(e)?`Event \`ErrorEvent\` captured as ${r} with message \`${e.message}\``:aT(e)?`Event \`${JTe(e)}\` (type=${e.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}function JTe(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}function QTe(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}function ZTe(e,{metadata:t,tunnel:n,dsn:r}){return qv({event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&t.sdk&&{sdk:{name:t.sdk.name,version:t.sdk.version}},...!!n&&!!r&&{dsn:Vv(r)}},[eRe(e)])}function eRe(e){return[{type:"user_report"},e]}class tRe extends F3e{constructor(e){const t={parentSpanIsAlwaysRootSpan:!0,...e};Cte(t,"browser",["browser"],rt.SENTRY_SDK_SOURCE||FTe()),super(t),t.sendClientReports&&rt.document&&rt.document.addEventListener("visibilitychange",()=>{"hidden"===rt.document.visibilityState&&this._flushOutcomes()})}eventFromException(e,t){return WTe(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",n){return YTe(this._options.stackParser,e,t,n,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(Co&&Ue.warn("SDK not enabled, will not capture user feedback."));const t=ZTe(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(t)}_prepareEvent(e,t,n){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,n)}}const $O=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,nRe=(e,t)=>e>t[1]?"poor":e>t[0]?"needs-improvement":"good",Gv=(e,t,n,r)=>{let i,o;return s=>{t.value>=0&&(s||r)&&(o=t.value-(i||0),(o||void 0===i)&&(i=t.value,t.delta=o,t.rating=nRe(t.value,n),e(t)))}},lt=Yt,rRe=()=>`v4-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,m_=(e=!0)=>{const t=lt.performance&&lt.performance.getEntriesByType&&lt.performance.getEntriesByType("navigation")[0];if(!e||t&&t.responseStart>0&&t.responseStart<performance.now())return t},g_=()=>{const e=m_();return e&&e.activationStart||0},Kv=(e,t)=>{const n=m_();let r="navigate";return n&&(lt.document&&lt.document.prerendering||g_()>0?r="prerender":lt.document&&lt.document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:typeof t>"u"?-1:t,rating:"good",delta:0,entries:[],id:rRe(),navigationType:r}},Cp=(e,t,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const r=new PerformanceObserver(e=>{Promise.resolve().then(()=>{t(e.getEntries())})});return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch{}},zv=e=>{const t=t=>{("pagehide"===t.type||lt.document&&"hidden"===lt.document.visibilityState)&&e(t)};lt.document&&(addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0))},pT=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let Iy=-1;const iRe=()=>"hidden"!==lt.document.visibilityState||lt.document.prerendering?1/0:0,CC=e=>{"hidden"===lt.document.visibilityState&&Iy>-1&&(Iy="visibilitychange"===e.type?e.timeStamp:0,oRe())},sRe=()=>{addEventListener("visibilitychange",CC,!0),addEventListener("prerenderingchange",CC,!0)},oRe=()=>{removeEventListener("visibilitychange",CC,!0),removeEventListener("prerenderingchange",CC,!0)},mT=()=>(lt.document&&Iy<0&&(Iy=iRe(),sRe()),{get firstHiddenTime(){return Iy}}),v_=e=>{lt.document&&lt.document.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},aRe=[1800,3e3],cRe=(e,t={})=>{v_(()=>{const n=mT(),r=Kv("FCP");let i;const o=Cp("paint",e=>{e.forEach(e=>{"first-contentful-paint"===e.name&&(o.disconnect(),e.startTime<n.firstHiddenTime&&(r.value=Math.max(e.startTime-g_(),0),r.entries.push(e),i(!0)))})});o&&(i=Gv(e,r,aRe,t.reportAllChanges))})},lRe=[.1,.25],uRe=(e,t={})=>{cRe(pT(()=>{const n=Kv("CLS",0);let r,i=0,o=[];const s=e=>{e.forEach(e=>{if(!e.hadRecentInput){const t=o[0],n=o[o.length-1];i&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,o.push(e)):(i=e.value,o=[e])}}),i>n.value&&(n.value=i,n.entries=o,r())},a=Cp("layout-shift",s);a&&(r=Gv(e,n,lRe,t.reportAllChanges),zv(()=>{s(a.takeRecords()),r(!0)}),setTimeout(r,0))}))},dRe=[100,300],fRe=(e,t={})=>{v_(()=>{const n=mT(),r=Kv("FID");let i;const o=e=>{e.startTime<n.firstHiddenTime&&(r.value=e.processingStart-e.startTime,r.entries.push(e),i(!0))},s=e=>{e.forEach(o)},a=Cp("first-input",s);i=Gv(e,r,dRe,t.reportAllChanges),a&&zv(pT(()=>{s(a.takeRecords()),a.disconnect()}))})};let Mte=0,o6=1/0,O2=0;const hRe=e=>{e.forEach(e=>{e.interactionId&&(o6=Math.min(o6,e.interactionId),O2=Math.max(O2,e.interactionId),Mte=O2?(O2-o6)/7+1:0)})};let pL;const pRe=()=>pL?Mte:performance.interactionCount||0,mRe=()=>{"interactionCount"in performance||pL||(pL=Cp("event",hRe,{type:"event",buffered:!0,durationThreshold:0}))},zl=[],a6=new Map,gRe=40;let vRe=0;const yRe=()=>pRe()-vRe,bRe=()=>{const e=Math.min(zl.length-1,Math.floor(yRe()/50));return zl[e]},c6=10,_Re=[],SRe=e=>{if(_Re.forEach(t=>t(e)),!e.interactionId&&"first-input"!==e.entryType)return;const t=zl[zl.length-1],n=a6.get(e.interactionId);if(n||zl.length<10||t&&e.duration>t.latency){if(n)e.duration>n.latency?(n.entries=[e],n.latency=e.duration):e.duration===n.latency&&e.startTime===(n.entries[0]&&n.entries[0].startTime)&&n.entries.push(e);else{const t={id:e.interactionId,latency:e.duration,entries:[e]};a6.set(t.id,t),zl.push(t)}zl.sort((e,t)=>t.latency-e.latency),zl.length>10&&zl.splice(10).forEach(e=>a6.delete(e.id))}},Dte=e=>{const t=lt.requestIdleCallback||lt.setTimeout;let n=-1;return e=pT(e),lt.document&&"hidden"===lt.document.visibilityState?e():(n=t(e),zv(e)),n},ERe=[200,500],wRe=(e,t={})=>{"PerformanceEventTiming"in lt&&"interactionId"in PerformanceEventTiming.prototype&&v_(()=>{mRe();const n=Kv("INP");let r;const i=e=>{Dte(()=>{e.forEach(SRe);const t=bRe();t&&t.latency!==n.value&&(n.value=t.latency,n.entries=t.entries,r())})},o=Cp("event",i,{durationThreshold:null!=t.durationThreshold?t.durationThreshold:40});r=Gv(e,n,ERe,t.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),zv(()=>{i(o.takeRecords()),r(!0)}))})},CRe=[2500,4e3],hV={},TRe=(e,t={})=>{v_(()=>{const n=mT(),r=Kv("LCP");let i;const o=e=>{t.reportAllChanges||(e=e.slice(-1)),e.forEach(e=>{e.startTime<n.firstHiddenTime&&(r.value=Math.max(e.startTime-g_(),0),r.entries=[e],i())})},s=Cp("largest-contentful-paint",o);if(s){i=Gv(e,r,CRe,t.reportAllChanges);const n=pT(()=>{hV[r.id]||(o(s.takeRecords()),s.disconnect(),hV[r.id]=!0,i(!0))});["keydown","click"].forEach(e=>{lt.document&&addEventListener(e,()=>Dte(n),{once:!0,capture:!0})}),zv(n)}})},RRe=[800,1800],mL=e=>{lt.document&&lt.document.prerendering?v_(()=>mL(e)):lt.document&&"complete"!==lt.document.readyState?addEventListener("load",()=>mL(e),!0):setTimeout(e,0)},IRe=(e,t={})=>{const n=Kv("TTFB"),r=Gv(e,n,RRe,t.reportAllChanges);mL(()=>{const e=m_();e&&(n.value=Math.max(e.responseStart-g_(),0),n.entries=[e],r(!0))})},ky={},TC={};let Nte,Ute,jte,Fte,$te;function Bte(e,t=!1){return y_("cls",e,PRe,Nte,t)}function kRe(e,t=!1){return y_("lcp",e,MRe,jte,t)}function xRe(e){return y_("fid",e,ORe,Ute)}function ARe(e){return y_("ttfb",e,DRe,Fte)}function LRe(e){return y_("inp",e,NRe,$te)}function gb(e,t){return Hte(e,t),TC[e]||(URe(e),TC[e]=!0),Vte(e,t)}function Wv(e,t){const n=ky[e];if(n&&n.length)for(const r of n)try{r(t)}catch(t){$O&&Ue.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${ku(r)}\nError:`,t)}}function PRe(){return uRe(e=>{Wv("cls",{metric:e}),Nte=e},{reportAllChanges:!0})}function ORe(){return fRe(e=>{Wv("fid",{metric:e}),Ute=e})}function MRe(){return TRe(e=>{Wv("lcp",{metric:e}),jte=e},{reportAllChanges:!0})}function DRe(){return IRe(e=>{Wv("ttfb",{metric:e}),Fte=e})}function NRe(){return wRe(e=>{Wv("inp",{metric:e}),$te=e})}function y_(e,t,n,r,i=!1){let o;return Hte(e,t),TC[e]||(o=n(),TC[e]=!0),r&&t({metric:r}),Vte(e,t,i?o:void 0)}function URe(e){const t={};"event"===e&&(t.durationThreshold=0),Cp(e,t=>{Wv(e,{entries:t})},t)}function Hte(e,t){ky[e]=ky[e]||[],ky[e].push(t)}function Vte(e,t,n){return()=>{n&&n();const r=ky[e];if(!r)return;const i=r.indexOf(t);-1!==i&&r.splice(i,1)}}function jRe(e){return"duration"in e}function l6(e){return"number"==typeof e&&isFinite(e)}function Lu(e,t,n,{...r}){const i=en(e).start_timestamp;return i&&i>t&&"function"==typeof e.updateStartTime&&e.updateStartTime(t),pte(e,()=>{const e=p_({startTime:t,...r});return e&&e.end(n),e})}function qte(e){const t=tn();if(!t)return;const{name:n,transaction:r,attributes:i,startTime:o}=e,{release:s,environment:a}=t.getOptions(),l=t.getIntegrationByName("Replay"),c=l&&l.getReplayId(),u=Ln(),d=u.getUser(),h=void 0!==d?d.email||d.id||d.ip_address:void 0;let p;try{p=u.getScopeData().contexts.profile.profile_id}catch{}return p_({name:n,attributes:{release:s,environment:a,user:h||void 0,profile_id:p||void 0,replay_id:c||void 0,transaction:r,"user_agent.original":lt.navigator&&lt.navigator.userAgent,...i},startTime:o,experimental:{standalone:!0}})}function BO(){return lt&&lt.addEventListener&&lt.performance}function Rr(e){return e/1e3}function Gte(e){let t="unknown",n="unknown",r="";for(const i of e){if("/"===i){[t,n]=e.split("/");break}if(!isNaN(Number(i))){t="h"===r?"http":r,n=e.split(r)[1];break}r+=i}return r===e&&(t=r),{name:t,version:n}}function FRe(){let e,t,n=0;if(!BRe())return;let r=!1;function i(){r||(r=!0,t&&$Re(n,e,t),o())}const o=Bte(({metric:t})=>{const r=t.entries[t.entries.length-1];r&&(n=t.value,e=r)},!0);zv(()=>{i()}),setTimeout(()=>{const e=tn();if(!e)return;const n=e.on("startNavigationSpan",()=>{i(),n&&n()}),r=Bi(),o=r&&ji(r),s=o&&en(o);s&&"pageload"===s.op&&(t=o.spanContext().spanId)},0)}function $Re(e,t,n){$O&&Ue.log(`Sending CLS span (${e})`);const r=Rr((Ks||0)+(t&&t.startTime||0)),i=Ln().getScopeData().transactionName,o=qte({name:t?tp(t.sources[0]&&t.sources[0].node):"Layout shift",transaction:i,attributes:Ui({[Hr]:"auto.http.browser.cls",[Au]:"ui.webvital.cls",[OO]:t&&t.duration||0,"sentry.pageload.span_id":n}),startTime:r});o&&(o.addEvent("cls",{[dT]:"",[fT]:e}),o.end(r))}function BRe(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return!1}}const HRe=2147483647;let ks,xy,pV=0,Pi={};function VRe({recordClsStandaloneSpans:e}){const t=BO();if(t&&Ks){t.mark&&lt.performance.mark("sentry-tracing-init");const n=YRe(),r=WRe(),i=XRe(),o=e?FRe():zRe();return()=>{n(),r(),i(),o&&o()}}return()=>{}}function qRe(){gb("longtask",({entries:e})=>{const t=Bi();if(!t)return;const{op:n,start_timestamp:r}=en(t);for(const i of e){const e=Rr(Ks+i.startTime),o=Rr(i.duration);"navigation"===n&&r&&e<r||Lu(t,e,e+o,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[Hr]:"auto.ui.browser.metrics"}})}})}function GRe(){new PerformanceObserver(e=>{const t=Bi();if(t)for(const n of e.getEntries()){if(!n.scripts[0])continue;const e=Rr(Ks+n.startTime),{start_timestamp:r,op:i}=en(t);if("navigation"===i&&r&&e<r)continue;const o=Rr(n.duration),s={[Hr]:"auto.ui.browser.metrics"},a=n.scripts[0],{invoker:l,invokerType:c,sourceURL:u,sourceFunctionName:d,sourceCharPosition:h}=a;s["browser.script.invoker"]=l,s["browser.script.invoker_type"]=c,u&&(s["code.filepath"]=u),d&&(s["code.function"]=d),-1!==h&&(s["browser.script.source_char_position"]=h),Lu(t,e,e+o,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:s})}}).observe({type:"long-animation-frame",buffered:!0})}function KRe(){gb("event",({entries:e})=>{const t=Bi();if(t)for(const n of e)if("click"===n.name){const e=Rr(Ks+n.startTime),r=Rr(n.duration),i={name:tp(n.target),op:`ui.interaction.${n.name}`,startTime:e,attributes:{[Hr]:"auto.ui.browser.metrics"}},o=Bee(n.target);o&&(i.attributes["ui.component_name"]=o),Lu(t,e,e+r,i)}})}function zRe(){return Bte(({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(Pi.cls={value:e.value,unit:""},xy=t)},!0)}function WRe(){return kRe(({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(Pi.lcp={value:e.value,unit:"millisecond"},ks=t)},!0)}function YRe(){return xRe(({metric:e})=>{const t=e.entries[e.entries.length-1];if(!t)return;const n=Rr(Ks),r=Rr(t.startTime);Pi.fid={value:e.value,unit:"millisecond"},Pi["mark.fid"]={value:n+r,unit:"second"}})}function XRe(){return ARe(({metric:e})=>{e.entries[e.entries.length-1]&&(Pi.ttfb={value:e.value,unit:"millisecond"})})}function JRe(e,t){const n=BO();if(!n||!n.getEntries||!Ks)return;const r=Rr(Ks),i=n.getEntries(),{op:o,start_timestamp:s}=en(e);if(i.slice(pV).forEach(t=>{const n=Rr(t.startTime),i=Rr(Math.max(0,t.duration));if(!("navigation"===o&&s&&r+n<s))switch(t.entryType){case"navigation":ZRe(e,t,r);break;case"mark":case"paint":case"measure":{QRe(e,t,n,i,r);const o=mT(),s=t.startTime<o.firstHiddenTime;"first-paint"===t.name&&s&&(Pi.fp={value:t.startTime,unit:"millisecond"}),"first-contentful-paint"===t.name&&s&&(Pi.fcp={value:t.startTime,unit:"millisecond"});break}case"resource":n4e(e,t,t.name,n,i,r)}}),pV=Math.max(i.length-1,0),r4e(e),"pageload"===o){s4e(Pi);const n=Pi["mark.fid"];n&&Pi.fid&&(Lu(e,n.value,n.value+Rr(Pi.fid.value),{name:"first input delay",op:"ui.action",attributes:{[Hr]:"auto.ui.browser.metrics"}}),delete Pi["mark.fid"]),(!("fcp"in Pi)||!t.recordClsOnPageloadSpan)&&delete Pi.cls,Object.entries(Pi).forEach(([e,t])=>{XCe(e,t.value,t.unit)}),e.setAttribute("performance.timeOrigin",r),e.setAttribute("performance.activationStart",g_()),i4e(e)}ks=void 0,xy=void 0,Pi={}}function QRe(e,t,n,r,i){const o=m_(!1),s=Rr(o?o.requestStart:0),a=i+Math.max(n,s),l=i+n,c=l+r,u={[Hr]:"auto.resource.browser.metrics"};return a!==l&&(u["sentry.browser.measure_happened_before_request"]=!0,u["sentry.browser.measure_start_time"]=a),Lu(e,a,c,{name:t.name,op:t.entryType,attributes:u}),a}function ZRe(e,t,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{M2(e,t,r,n)}),M2(e,t,"secureConnection",n,"TLS/SSL"),M2(e,t,"fetch",n,"cache"),M2(e,t,"domainLookup",n,"DNS"),t4e(e,t,n)}function M2(e,t,n,r,i=n){const o=t[e4e(n)],s=t[`${n}Start`];!s||!o||Lu(e,r+Rr(s),r+Rr(o),{op:`browser.${i}`,name:t.name,attributes:{[Hr]:"auto.ui.browser.metrics"}})}function e4e(e){return"secureConnection"===e?"connectEnd":"fetch"===e?"domainLookupStart":`${e}End`}function t4e(e,t,n){const r=n+Rr(t.requestStart),i=n+Rr(t.responseEnd),o=n+Rr(t.responseStart);t.responseEnd&&(Lu(e,r,i,{op:"browser.request",name:t.name,attributes:{[Hr]:"auto.ui.browser.metrics"}}),Lu(e,o,i,{op:"browser.response",name:t.name,attributes:{[Hr]:"auto.ui.browser.metrics"}}))}function n4e(e,t,n,r,i,o){if("xmlhttprequest"===t.initiatorType||"fetch"===t.initiatorType)return;const s=Gh(n),a={[Hr]:"auto.resource.browser.metrics"};u6(a,t,"transferSize","http.response_transfer_size"),u6(a,t,"encodedBodySize","http.response_content_length"),u6(a,t,"decodedBodySize","http.decoded_response_content_length");const l=t.deliveryType;null!=l&&(a["http.response_delivery_type"]=l);const c=t.renderBlockingStatus;c&&(a["resource.render_blocking_status"]=c),s.protocol&&(a["url.scheme"]=s.protocol.split(":").pop()),s.host&&(a["server.address"]=s.host),a["url.same_origin"]=n.includes(lt.location.origin);const{name:u,version:d}=Gte(t.nextHopProtocol);a["network.protocol.name"]=u,a["network.protocol.version"]=d;const h=o+r;Lu(e,h,h+i,{name:n.replace(lt.location.origin,""),op:t.initiatorType?`resource.${t.initiatorType}`:"resource.other",attributes:a})}function r4e(e){const t=lt.navigator;if(!t)return;const n=t.connection;n&&(n.effectiveType&&e.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&e.setAttribute("connectionType",n.type),l6(n.rtt)&&(Pi["connection.rtt"]={value:n.rtt,unit:"millisecond"})),l6(t.deviceMemory)&&e.setAttribute("deviceMemory",`${t.deviceMemory} GB`),l6(t.hardwareConcurrency)&&e.setAttribute("hardwareConcurrency",String(t.hardwareConcurrency))}function i4e(e){ks&&(ks.element&&e.setAttribute("lcp.element",tp(ks.element)),ks.id&&e.setAttribute("lcp.id",ks.id),ks.url&&e.setAttribute("lcp.url",ks.url.trim().slice(0,200)),null!=ks.loadTime&&e.setAttribute("lcp.loadTime",ks.loadTime),null!=ks.renderTime&&e.setAttribute("lcp.renderTime",ks.renderTime),e.setAttribute("lcp.size",ks.size)),xy&&xy.sources&&xy.sources.forEach((t,n)=>e.setAttribute(`cls.source.${n+1}`,tp(t.node)))}function u6(e,t,n,r){const i=t[n];null!=i&&i<HRe&&(e[r]=i)}function s4e(e){const t=m_(!1);if(!t)return;const{responseStart:n,requestStart:r}=t;r<=n&&(e["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}const o4e=1e3;let mV,gL,vL,D2;function a4e(e){Of("dom",e),Mf("dom",c4e)}function c4e(){if(!lt.document)return;const e=ua.bind(null,"dom"),t=gV(e,!0);lt.document.addEventListener("click",t,!1),lt.document.addEventListener("keypress",t,!1),["EventTarget","Node"].forEach(t=>{const n=lt[t],r=n&&n.prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(So(r,"addEventListener",function(t){return function(n,r,i){if("click"===n||"keypress"==n)try{const r=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},o=r[n]=r[n]||{refCount:0};if(!o.handler){const r=gV(e);o.handler=r,t.call(this,n,r,i)}o.refCount++}catch{}return t.call(this,n,r,i)}}),So(r,"removeEventListener",function(e){return function(t,n,r){if("click"===t||"keypress"==t)try{const n=this.__sentry_instrumentation_handlers__||{},i=n[t];i&&(i.refCount--,i.refCount<=0&&(e.call(this,t,i.handler,r),i.handler=void 0,delete n[t]),0===Object.keys(n).length&&delete this.__sentry_instrumentation_handlers__)}catch{}return e.call(this,t,n,r)}}))})}function l4e(e){if(e.type!==gL)return!1;try{if(!e.target||e.target._sentryId!==vL)return!1}catch{}return!0}function u4e(e,t){return"keypress"===e&&(!t||!t.tagName||!("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable))}function gV(e,t=!1){return n=>{if(!n||n._sentryCaptured)return;const r=d4e(n);if(u4e(n.type,r))return;ga(n,"_sentryCaptured",!0),r&&!r._sentryId&&ga(r,"_sentryId",da());const i="keypress"===n.type?"input":n.type;l4e(n)||(e({event:n,name:i,global:t}),gL=n.type,vL=r?r._sentryId:void 0),clearTimeout(mV),mV=lt.setTimeout(()=>{vL=void 0,gL=void 0},o4e)}}function d4e(e){try{return e.target}catch{return null}}function HO(e){const t="history";Of(t,e),Mf(t,f4e)}function f4e(){if(!$Te())return;const e=lt.onpopstate;function t(e){return function(...t){const n=t.length>2?t[2]:void 0;if(n){const e=D2,t=String(n);D2=t,ua("history",{from:e,to:t})}return e.apply(this,t)}}lt.onpopstate=function(...t){const n=lt.location.href,r=D2;if(D2=n,ua("history",{from:r,to:n}),e)try{return e.apply(this,t)}catch{}},So(lt.history,"pushState",t),So(lt.history,"replaceState",t)}const uw={};function h4e(e){const t=uw[e];if(t)return t;let n=lt[e];if(uL(n))return uw[e]=n.bind(lt);const r=lt.document;if(r&&"function"==typeof r.createElement)try{const t=r.createElement("iframe");t.hidden=!0,r.head.appendChild(t);const i=t.contentWindow;i&&i[e]&&(n=i[e]),r.head.removeChild(t)}catch(t){$O&&Ue.warn(`Could not create sandbox iframe for ${e} check, bailing to window.${e}: `,t)}return n&&(uw[e]=n.bind(lt))}function vV(e){uw[e]=void 0}const sg="__sentry_xhr_v3__";function Kte(e){Of("xhr",e),Mf("xhr",p4e)}function p4e(){if(!lt.XMLHttpRequest)return;const e=XMLHttpRequest.prototype;e.open=new Proxy(e.open,{apply(e,t,n){const r=new Error,i=1e3*fs(),o=vu(n[0])?n[0].toUpperCase():void 0,s=m4e(n[1]);if(!o||!s)return e.apply(t,n);t[sg]={method:o,url:s,request_headers:{}},"POST"===o&&s.match(/sentry_key/)&&(t.__sentry_own_request__=!0);const a=()=>{const e=t[sg];if(e&&4===t.readyState){try{e.status_code=t.status}catch{}ua("xhr",{endTimestamp:1e3*fs(),startTimestamp:i,xhr:t,virtualError:r})}};return"onreadystatechange"in t&&"function"==typeof t.onreadystatechange?t.onreadystatechange=new Proxy(t.onreadystatechange,{apply:(e,t,n)=>(a(),e.apply(t,n))}):t.addEventListener("readystatechange",a),t.setRequestHeader=new Proxy(t.setRequestHeader,{apply(e,t,n){const[r,i]=n,o=t[sg];return o&&vu(r)&&vu(i)&&(o.request_headers[r.toLowerCase()]=i),e.apply(t,n)}}),e.apply(t,n)}}),e.send=new Proxy(e.send,{apply(e,t,n){const r=t[sg];if(!r)return e.apply(t,n);void 0!==n[0]&&(r.body=n[0]);return ua("xhr",{startTimestamp:1e3*fs(),xhr:t}),e.apply(t,n)}})}function m4e(e){if(vu(e))return e;try{return e.toString()}catch{}}const d6=[],dw=new Map;function g4e(){if(BO()&&Ks){const e=v4e();return()=>{e()}}return()=>{}}const yV={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function v4e(){return LRe(({metric:e})=>{if(null==e.value)return;const t=e.entries.find(t=>t.duration===e.value&&yV[t.name]);if(!t)return;const{interactionId:n}=t,r=yV[t.name],i=Rr(Ks+t.startTime),o=Rr(e.value),s=Bi(),a=s?ji(s):void 0,l=(null!=n?dw.get(n):void 0)||a,c=l?en(l).description:Ln().getScopeData().transactionName,u=qte({name:tp(t.target),transaction:c,attributes:Ui({[Hr]:"auto.http.browser.inp",[Au]:`ui.interaction.${r}`,[OO]:t.duration}),startTime:i});u&&(u.addEvent("inp",{[dT]:"millisecond",[fT]:e.value}),u.end(i+o))})}function y4e(e){const t=({entries:e})=>{const t=Bi(),n=t&&ji(t);e.forEach(e=>{if(!jRe(e)||!n)return;const t=e.interactionId;if(null!=t&&!dw.has(t)){if(d6.length>10){const e=d6.shift();dw.delete(e)}d6.push(t),dw.set(t,n)}})};gb("event",t),gb("first-input",t)}function b4e(e,t=h4e("fetch")){let n=0,r=0;return J3e(e,function(i){const o=i.body.length;n+=o,r++;const s={body:i.body,method:"POST",referrerPolicy:"origin",headers:e.headers,keepalive:n<=6e4&&r<15,...e.fetchOptions};if(!t)return vV("fetch"),SC("No fetch implementation available");try{return t(e.url,s).then(e=>(n-=o,r--,{statusCode:e.status,headers:{"x-sentry-rate-limits":e.headers.get("X-Sentry-Rate-Limits"),"retry-after":e.headers.get("Retry-After")}}))}catch(e){return vV("fetch"),n-=o,r--,SC(e)}})}const _4e=30,S4e=50;function yL(e,t,n,r){const i={filename:e,function:"<anonymous>"===t?ep:t,in_app:!0};return void 0!==n&&(i.lineno=n),void 0!==r&&(i.colno=r),i}const E4e=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,w4e=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,C4e=/\((\S*)(?::(\d+))(?::(\d+))\)/,T4e=e=>{const t=E4e.exec(e);if(t){const[,e,n,r]=t;return yL(e,ep,+n,+r)}const n=w4e.exec(e);if(n){if(n[2]&&0===n[2].indexOf("eval")){const e=C4e.exec(n[2]);e&&(n[2]=e[1],n[3]=e[2],n[4]=e[3])}const[e,t]=zte(n[1]||ep,n[2]);return yL(t,e,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}},R4e=[30,T4e],I4e=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,k4e=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,x4e=e=>{const t=I4e.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const e=k4e.exec(t[3]);e&&(t[1]=t[1]||"eval",t[3]=e[1],t[4]=e[2],t[5]="")}let e=t[3],n=t[1]||ep;return[n,e]=zte(n,e),yL(e,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},A4e=[50,x4e],L4e=[R4e,A4e],P4e=Dee(...L4e),zte=(e,t)=>{const n=-1!==e.indexOf("safari-extension"),r=-1!==e.indexOf("safari-web-extension");return n||r?[-1!==e.indexOf("@")?e.split("@")[0]:ep,n?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]},N2=1024,O4e="Breadcrumbs",M4e=(e={})=>{const t={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e};return{name:O4e,setup(e){t.console&&bTe(j4e(e)),t.dom&&a4e(U4e(e,t.dom)),t.xhr&&Kte(F4e(e)),t.fetch&&Ate($4e(e)),t.history&&HO(B4e(e)),t.sentry&&e.on("beforeSendEvent",N4e(e))}}},D4e=M4e;function N4e(e){return function(t){tn()===e&&rp({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:Md(t)},{event:t})}}function U4e(e,t){return function(n){if(tn()!==e)return;let r,i,o="object"==typeof t?t.serializeAttribute:void 0,s="object"==typeof t&&"number"==typeof t.maxStringLength?t.maxStringLength:void 0;s&&s>N2&&(Co&&Ue.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${s} was configured. Sentry will use 1024 instead.`),s=N2),"string"==typeof o&&(o=[o]);try{const e=n.event,t=H4e(e)?e.target:e;r=tp(t,{keyAttrs:o,maxStringLength:s}),i=Bee(t)}catch{r="<unknown>"}if(0===r.length)return;const a={category:`ui.${n.name}`,message:r};i&&(a.data={"ui.component_name":i}),rp(a,{event:n.event,name:n.name,global:n.global})}}function j4e(e){return function(t){if(tn()!==e)return;const n={category:"console",data:{arguments:t.args,logger:"console"},level:STe(t.level),message:OH(t.args," ")};if("assert"===t.level){if(!1!==t.args[0])return;n.message=`Assertion failed: ${OH(t.args.slice(1)," ")||"console.assert"}`,n.data.arguments=t.args.slice(1)}rp(n,{input:t.args,level:t.level})}}function F4e(e){return function(t){if(tn()!==e)return;const{startTimestamp:n,endTimestamp:r}=t,i=t.xhr[sg];if(!n||!r||!i)return;const{method:o,url:s,status_code:a,body:l}=i,c={method:o,url:s,status_code:a},u={xhr:t.xhr,input:l,startTimestamp:n,endTimestamp:r};rp({category:"xhr",data:c,type:"http",level:kte(a)},u)}}function $4e(e){return function(t){if(tn()!==e)return;const{startTimestamp:n,endTimestamp:r}=t;if(r&&(!t.fetchData.url.match(/sentry_key/)||"POST"!==t.fetchData.method))if(t.error){rp({category:"fetch",data:t.fetchData,level:"error",type:"http"},{data:t.error,input:t.args,startTimestamp:n,endTimestamp:r})}else{const e=t.response,i={...t.fetchData,status_code:e&&e.status},o={input:t.args,response:e,startTimestamp:n,endTimestamp:r};rp({category:"fetch",data:i,type:"http",level:kte(i.status_code)},o)}}}function B4e(e){return function(t){if(tn()!==e)return;let n=t.from,r=t.to;const i=Gh(rt.location.href);let o=n?Gh(n):void 0;const s=Gh(r);(!o||!o.path)&&(o=i),i.protocol===s.protocol&&i.host===s.host&&(r=s.relative),i.protocol===o.protocol&&i.host===o.host&&(n=o.relative),rp({category:"navigation",data:{from:n,to:r}})}}function H4e(e){return!!e&&!!e.target}const V4e=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],q4e="BrowserApiErrors",G4e=(e={})=>{const t={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...e};return{name:q4e,setupOnce(){t.setTimeout&&So(rt,"setTimeout",bV),t.setInterval&&So(rt,"setInterval",bV),t.requestAnimationFrame&&So(rt,"requestAnimationFrame",z4e),t.XMLHttpRequest&&"XMLHttpRequest"in rt&&So(XMLHttpRequest.prototype,"send",W4e);const e=t.eventTarget;e&&(Array.isArray(e)?e:V4e).forEach(Y4e)}}},K4e=G4e;function bV(e){return function(...t){const n=t[0];return t[0]=av(n,{mechanism:{data:{function:ku(e)},handled:!1,type:"instrument"}}),e.apply(this,t)}}function z4e(e){return function(t){return e.apply(this,[av(t,{mechanism:{data:{function:"requestAnimationFrame",handler:ku(e)},handled:!1,type:"instrument"}})])}}function W4e(e){return function(...t){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(e=>{e in n&&"function"==typeof n[e]&&So(n,e,function(t){const n={mechanism:{data:{function:e,handler:ku(t)},handled:!1,type:"instrument"}},r=LO(t);return r&&(n.mechanism.data.handler=ku(r)),av(t,n)})}),e.apply(this,t)}}function Y4e(e){const t=rt[e],n=t&&t.prototype;!n||!n.hasOwnProperty||!n.hasOwnProperty("addEventListener")||(So(n,"addEventListener",function(t){return function(n,r,i){try{X4e(r)&&(r.handleEvent=av(r.handleEvent,{mechanism:{data:{function:"handleEvent",handler:ku(r),target:e},handled:!1,type:"instrument"}}))}catch{}return t.apply(this,[n,av(r,{mechanism:{data:{function:"addEventListener",handler:ku(r),target:e},handled:!1,type:"instrument"}}),i])}}),So(n,"removeEventListener",function(e){return function(t,n,r){try{const i=n.__sentry_wrapped__;i&&e.call(this,t,i,r)}catch{}return e.call(this,t,n,r)}}))}function X4e(e){return"function"==typeof e.handleEvent}const J4e=()=>({name:"BrowserSession",setupOnce(){typeof rt.document>"u"?Co&&Ue.warn("Using the `browserSessionIntegration` in non-browser environments is not supported."):(eV({ignoreDuration:!0}),tV(),HO(({from:e,to:t})=>{void 0!==e&&e!==t&&(eV({ignoreDuration:!0}),tV())}))}}),Q4e="GlobalHandlers",Z4e=(e={})=>{const t={onerror:!0,onunhandledrejection:!0,...e};return{name:Q4e,setupOnce(){Error.stackTraceLimit=50},setup(e){t.onerror&&(tIe(e),_V("onerror")),t.onunhandledrejection&&(nIe(e),_V("onunhandledrejection"))}}},eIe=Z4e;function tIe(e){Nee(t=>{const{stackParser:n,attachStacktrace:r}=Wte();if(tn()!==e||Pte())return;const{msg:i,url:o,line:s,column:a,error:l}=t,c=sIe(FO(n,l||i,void 0,r,!1),o,s,a);c.level="error",vte(c,{originalException:l,mechanism:{handled:!1,type:"onerror"}})})}function nIe(e){Uee(t=>{const{stackParser:n,attachStacktrace:r}=Wte();if(tn()!==e||Pte())return;const i=rIe(t),o=AO(i)?iIe(i):FO(n,i,void 0,r,!0);o.level="error",vte(o,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function rIe(e){if(AO(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch{}return e}function iIe(e){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(e)}`}]}}}function sIe(e,t,n,r){const i=e.exception=e.exception||{},o=i.values=i.values||[],s=o[0]=o[0]||{},a=s.stacktrace=s.stacktrace||{},l=a.frames=a.frames||[],c=r,u=n,d=vu(t)&&t.length>0?t:Vwe();return 0===l.length&&l.push({colno:c,filename:d,function:ep,in_app:!0,lineno:u}),e}function _V(e){Co&&Ue.log(`Global Handler attached: ${e}`)}function Wte(){const e=tn();return e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const oIe=()=>({name:"HttpContext",preprocessEvent(e){if(!rt.navigator&&!rt.location&&!rt.document)return;const t=e.request&&e.request.url||rt.location&&rt.location.href,{referrer:n}=rt.document||{},{userAgent:r}=rt.navigator||{},i={...e.request&&e.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},o={...e.request,...t&&{url:t},headers:i};e.request=o}}),aIe="cause",cIe=5,lIe="LinkedErrors",uIe=(e={})=>{const t=e.limit||5,n=e.key||aIe;return{name:lIe,preprocessEvent(e,r,i){const o=i.getOptions();vTe(UO,o.stackParser,o.maxValueLength,n,t,e,r)}}},dIe=uIe;function fIe(e){const t=[oTe(),nTe(),K4e(),D4e(),eIe(),dIe(),CTe(),oIe()];return!1!==e.autoSessionTracking&&t.push(J4e()),t}function hIe(e={}){const t={defaultIntegrations:fIe(e),release:"string"==typeof __SENTRY_RELEASE__?__SENTRY_RELEASE__:rt.SENTRY_RELEASE&&rt.SENTRY_RELEASE.id?rt.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return null==e.defaultIntegrations&&delete e.defaultIntegrations,{...t,...e}}function pIe(){const e=typeof rt.window<"u"&&rt;if(!e)return!1;const t=e[e.chrome?"chrome":"browser"],n=t&&t.runtime&&t.runtime.id,r=rt.location&&rt.location.href||"",i=!!n&&rt===rt.top&&["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"].some(e=>r.startsWith(`${e}//`)),o=typeof e.nw<"u";return!!n&&!i&&!o}function mIe(e={}){const t=hIe(e);if(!t.skipBrowserExtensionCheck&&pIe())return void Sp(()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")});Co&&(xte()||Ue.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const n={...t,stackParser:Owe(t.stackParser||P4e),integrations:N3e(t),transport:t.transport||b4e};return H3e(tRe,n)}function SV(e={}){if(!rt.document)return void(Co&&Ue.error("Global document not defined in showReportDialog call"));const t=Ln(),n=t.getClient(),r=n&&n.getDsn();if(!r)return void(Co&&Ue.error("DSN not configured for showReportDialog call"));if(t&&(e.user={...t.getUser(),...e.user}),!e.eventId){const t=k3e();t&&(e.eventId=t)}const i=rt.document.createElement("script");i.async=!0,i.crossOrigin="anonymous",i.src=M3e(r,e),e.onLoad&&(i.onload=e.onLoad);const{onClose:o}=e;if(o){const e=t=>{if("__sentry_reportdialog_closed__"===t.data)try{o()}finally{rt.removeEventListener("message",e)}};rt.addEventListener("message",e)}const s=rt.document.head||rt.document.body;s?s.appendChild(i):Co&&Ue.error("Not injecting report dialog. No injection point found in HTML")}const EV=new WeakMap,f6=new Map,fw={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,trackFetchStreamPerformance:!1};function gIe(e,t){const{traceFetch:n,traceXHR:r,trackFetchStreamPerformance:i,shouldCreateSpanForRequest:o,enableHTTPTimings:s,tracePropagationTargets:a}={traceFetch:fw.traceFetch,traceXHR:fw.traceXHR,trackFetchStreamPerformance:fw.trackFetchStreamPerformance,...t},l="function"==typeof o?o:e=>!0,c=e=>bIe(e,a),u={};n&&(e.addEventProcessor(e=>("transaction"===e.type&&e.spans&&e.spans.forEach(e=>{if("http.client"===e.op){const t=f6.get(e.span_id);t&&(e.timestamp=t/1e3,f6.delete(e.span_id))}}),e)),i&&DTe(e=>{if(e.response){const t=EV.get(e.response);t&&e.endTimestamp&&f6.set(t,e.endTimestamp)}}),Ate(e=>{const t=kTe(e,l,c,u);if(e.response&&e.fetchData.__span&&EV.set(e.response,e.fetchData.__span),t){const n=Yte(e.fetchData.url),r=n?Gh(n).host:void 0;t.setAttributes({"http.url":n,"server.address":r})}s&&t&&wV(t)})),r&&Kte(e=>{const t=_Ie(e,l,c,u);s&&t&&wV(t)})}function vIe(e){return"resource"===e.entryType&&"initiatorType"in e&&"string"==typeof e.nextHopProtocol&&("fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType)}function wV(e){const{url:t}=en(e).data||{};if(!t||"string"!=typeof t)return;const n=gb("resource",({entries:r})=>{r.forEach(r=>{vIe(r)&&r.name.endsWith(t)&&(yIe(r).forEach(t=>e.setAttribute(...t)),setTimeout(n))})})}function Cc(e=0){return((Ks||performance.timeOrigin)+e)/1e3}function yIe(e){const{name:t,version:n}=Gte(e.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",t]),Ks?[...r,["http.request.redirect_start",Cc(e.redirectStart)],["http.request.fetch_start",Cc(e.fetchStart)],["http.request.domain_lookup_start",Cc(e.domainLookupStart)],["http.request.domain_lookup_end",Cc(e.domainLookupEnd)],["http.request.connect_start",Cc(e.connectStart)],["http.request.secure_connection_start",Cc(e.secureConnectionStart)],["http.request.connection_end",Cc(e.connectEnd)],["http.request.request_start",Cc(e.requestStart)],["http.request.response_start",Cc(e.responseStart)],["http.request.response_end",Cc(e.responseEnd)]]:r}function bIe(e,t){const n=rt.location&&rt.location.href;if(n){let r,i;try{r=new URL(e,n),i=new URL(n).origin}catch{return!1}const o=r.origin===i;return t?Hh(r.toString(),t)||o&&Hh(r.pathname,t):o}{const n=!!e.match(/^\/(?!\/)/);return t?Hh(e,t):n}}function _Ie(e,t,n,r){const i=e.xhr,o=i&&i[sg];if(!i||i.__sentry_own_request__||!o)return;const s=vf()&&t(o.url);if(e.endTimestamp&&s){const e=i.__sentry_xhr_span_id__;if(!e)return;const t=r[e];return void(t&&void 0!==o.status_code&&(Wee(t,o.status_code),t.end(),delete r[e]))}const a=Yte(o.url),l=a?Gh(a).host:void 0,c=!!Bi(),u=s&&c?p_({name:`${o.method} ${o.url}`,attributes:{type:"xhr","http.method":o.method,"http.url":a,url:o.url,"server.address":l,[Hr]:"auto.http.browser",[Au]:"http.client"}}):new Bv;return i.__sentry_xhr_span_id__=u.spanContext().spanId,r[i.__sentry_xhr_span_id__]=u,n(o.url)&&SIe(i,vf()&&c?u:void 0),u}function SIe(e,t){const{"sentry-trace":n,baggage:r}=Tte({span:t});n&&EIe(e,n,r)}function EIe(e,t,n){try{e.setRequestHeader("sentry-trace",t),n&&e.setRequestHeader("baggage",n)}catch{}}function Yte(e){try{return new URL(e,rt.location.origin).href}catch{return}}function wIe(){rt&&rt.document?rt.document.addEventListener("visibilitychange",()=>{const e=Bi();if(!e)return;const t=ji(e);if(rt.document.hidden&&t){const e="cancelled",{op:n,status:r}=en(t);Co&&Ue.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${n}`),r||t.setStatus({code:2,message:e}),t.setAttribute("sentry.cancellation_reason","document.hidden"),t.end()}}):Co&&Ue.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const CIe="BrowserTracing",TIe={...lw,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...fw},RIe=(e={})=>{TCe();const{enableInp:t,enableLongTask:n,enableLongAnimationFrame:r,_experiments:{enableInteractions:i,enableStandaloneClsSpans:o},beforeStartSpan:s,idleTimeout:a,finalTimeout:l,childSpanTimeout:c,markBackgroundSpan:u,traceFetch:d,traceXHR:h,trackFetchStreamPerformance:p,shouldCreateSpanForRequest:f,enableHTTPTimings:m,instrumentPageLoad:v,instrumentNavigation:g}={...TIe,...e},y=VRe({recordClsStandaloneSpans:o||!1});t&&g4e(),r&&Yt.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?GRe():n&&qRe(),i&&KRe();const b={name:void 0,source:void 0};function w(e,t){const n="pageload"===t.op,r=s?s(t):t,i=r.attributes||{};t.name!==r.name&&(i[oa]="custom",r.attributes=i),b.name=r.name,b.source=i[oa];const u=gte(r,{idleTimeout:a,finalTimeout:l,childSpanTimeout:c,disableAutoFinish:n,beforeSpanEnd:e=>{y(),JRe(e,{recordClsOnPageloadSpan:!o})}});function d(){["interactive","complete"].includes(rt.document.readyState)&&e.emit("idleSpanEnableAutoFinish",u)}return n&&rt.document&&(rt.document.addEventListener("readystatechange",()=>{d()}),d()),u}return{name:CIe,afterAllSetup(e){let n,r=rt.location&&rt.location.href;function o(){n&&!en(n).timestamp&&(Co&&Ue.log(`[Tracing] Finishing current active span with op: ${en(n).op}`),n.end())}e.on("startNavigationSpan",t=>{tn()===e&&(o(),n=w(e,{op:"navigation",...t}))}),e.on("startPageLoadSpan",(t,r={})=>{if(tn()!==e)return;o();const i=yCe(r.sentryTrace||CV("sentry-trace"),r.baggage||CV("baggage"));Ln().setPropagationContext(i),n=w(e,{op:"pageload",...t})}),e.on("spanEnd",e=>{const t=en(e).op;if(e!==ji(e)||"navigation"!==t&&"pageload"!==t)return;const n=Ln(),r=n.getPropagationContext();n.setPropagationContext({...r,sampled:void 0!==r.sampled?r.sampled:wp(e),dsc:r.dsc||Hv(e)})}),rt.location&&(v&&Xte(e,{name:rt.location.pathname,startTime:Ks?Ks/1e3:void 0,attributes:{[oa]:"url",[Hr]:"auto.pageload.browser"}}),g&&HO(({to:t,from:n})=>{void 0===n&&r&&-1!==r.indexOf(t)?r=void 0:n!==t&&(r=void 0,Jte(e,{name:rt.location.pathname,attributes:{[oa]:"url",[Hr]:"auto.navigation.browser"}}))})),u&&wIe(),i&&IIe(a,l,c,b),t&&y4e(),gIe(e,{traceFetch:d,traceXHR:h,trackFetchStreamPerformance:p,tracePropagationTargets:e.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:f,enableHTTPTimings:m})}}};function Xte(e,t,n){e.emit("startPageLoadSpan",t,n),Ln().setTransactionName(t.name);const r=Bi();return"pageload"===(r&&en(r).op)?r:void 0}function Jte(e,t){hl().setPropagationContext({traceId:pf()}),Ln().setPropagationContext({traceId:pf()}),e.emit("startNavigationSpan",t),Ln().setTransactionName(t.name);const n=Bi();return"navigation"===(n&&en(n).op)?n:void 0}function CV(e){const t=qwe(`meta[name=${e}]`);return t?t.getAttribute("content"):void 0}function IIe(e,t,n,r){let i;rt.document&&addEventListener("click",()=>{const o="ui.action.click",s=Bi(),a=s&&ji(s);if(a){const e=en(a).op;if(["navigation","pageload"].includes(e))return void(Co&&Ue.warn(`[Tracing] Did not create ${o} span because a pageload or navigation span is in progress.`))}i&&(i.setAttribute(nL,"interactionInterrupted"),i.end(),i=void 0),r.name?i=gte({name:r.name,op:o,attributes:{[oa]:r.source||"url"}},{idleTimeout:e,finalTimeout:t,childSpanTimeout:n}):Co&&Ue.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`)},{once:!1,capture:!0})}function kIe(e){const t={...e};return Cte(t,"react"),I3e("react",{version:_.version}),mIe(t)}function xIe(e){const t=e.match(/^([^.]+)/);return null!==t&&parseInt(t[0])>=17}function AIe(e,t){const n=new WeakSet;!function e(t,r){if(!n.has(t)){if(t.cause)return n.add(t),e(t.cause,r);t.cause=r}}(e,t)}function LIe(e,{componentStack:t},n){if(xIe(_.version)&&oT(e)&&t){const n=new Error(e.message);n.name=`React ErrorBoundary ${e.name}`,n.stack=t,AIe(e,n)}return hT(e,{...n,captureContext:{contexts:{react:{componentStack:t}}}})}var TV,RV,p6,IV,h6={exports:{}},nn={};function PIe(){if(TV)return nn;TV=1;var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,h=e?Symbol.for("react.suspense_list"):60120,p=e?Symbol.for("react.memo"):60115,f=e?Symbol.for("react.lazy"):60116,m=e?Symbol.for("react.block"):60121,v=e?Symbol.for("react.fundamental"):60117,g=e?Symbol.for("react.responder"):60118,y=e?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var h=e.$$typeof;switch(h){case t:switch(e=e.type){case l:case c:case r:case o:case i:case d:return e;default:switch(e=e&&e.$$typeof){case a:case u:case f:case p:case s:return e;default:return h}}case n:return h}}}function w(e){return b(e)===c}return nn.AsyncMode=l,nn.ConcurrentMode=c,nn.ContextConsumer=a,nn.ContextProvider=s,nn.Element=t,nn.ForwardRef=u,nn.Fragment=r,nn.Lazy=f,nn.Memo=p,nn.Portal=n,nn.Profiler=o,nn.StrictMode=i,nn.Suspense=d,nn.isAsyncMode=function(e){return w(e)||b(e)===l},nn.isConcurrentMode=w,nn.isContextConsumer=function(e){return b(e)===a},nn.isContextProvider=function(e){return b(e)===s},nn.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},nn.isForwardRef=function(e){return b(e)===u},nn.isFragment=function(e){return b(e)===r},nn.isLazy=function(e){return b(e)===f},nn.isMemo=function(e){return b(e)===p},nn.isPortal=function(e){return b(e)===n},nn.isProfiler=function(e){return b(e)===o},nn.isStrictMode=function(e){return b(e)===i},nn.isSuspense=function(e){return b(e)===d},nn.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===c||e===o||e===i||e===d||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===f||e.$$typeof===p||e.$$typeof===s||e.$$typeof===a||e.$$typeof===u||e.$$typeof===v||e.$$typeof===g||e.$$typeof===y||e.$$typeof===m)},nn.typeOf=b,nn}function OIe(){return RV||(RV=1,h6.exports=PIe()),h6.exports}function MIe(){if(IV)return p6;IV=1;var e=OIe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};function o(n){return e.isMemo(n)?r:i[n.$$typeof]||t}i[e.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i[e.Memo]=r;var s=Object.defineProperty,a=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,c=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,d=Object.prototype;return p6=function e(t,r,i){if("string"!=typeof r){if(d){var h=u(r);h&&h!==d&&e(t,h,i)}var p=a(r);l&&(p=p.concat(l(r)));for(var f=o(t),m=o(r),v=0;v<p.length;++v){var g=p[v];if(!(n[g]||i&&i[g]||m&&m[g]||f&&f[g])){var y=c(r,g);try{s(t,g,y)}catch{}}}}return t},p6}var DIe=MIe();const NIe=ac(DIe),Qte=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,kV={componentStack:null,error:null,eventId:null};class gT extends _.Component{constructor(e){super(e),gT.prototype.__init.call(this),this.state=kV,this._openFallbackReportDialog=!0;const t=tn();t&&e.showDialog&&(this._openFallbackReportDialog=!1,this._cleanupHook=t.on("afterSendEvent",t=>{!t.type&&this._lastEventId&&t.event_id===this._lastEventId&&SV({...e.dialogOptions,eventId:this._lastEventId})}))}componentDidCatch(e,t){const{componentStack:n}=t,r=n??void 0,{beforeCapture:i,onError:o,showDialog:s,dialogOptions:a}=this.props;uT(l=>{i&&i(l,e,r);const c=null!=this.props.handled?this.props.handled:!!this.props.fallback,u=LIe(e,t,{mechanism:{handled:c}});o&&o(e,r,u),s&&(this._lastEventId=u,this._openFallbackReportDialog&&SV({...a,eventId:u})),this.setState({error:e,componentStack:n,eventId:u})})}componentDidMount(){const{onMount:e}=this.props;e&&e()}componentWillUnmount(){const{error:e,componentStack:t,eventId:n}=this.state,{onUnmount:r}=this.props;r&&r(e,t,n),this._cleanupHook&&(this._cleanupHook(),this._cleanupHook=void 0)}__init(){this.resetErrorBoundary=()=>{const{onReset:e}=this.props,{error:t,componentStack:n,eventId:r}=this.state;e&&e(t,n,r),this.setState(kV)}}render(){const{fallback:e,children:t}=this.props,n=this.state;if(n.error){let t;return t="function"==typeof e?_.createElement(e,{error:n.error,componentStack:n.componentStack,resetError:this.resetErrorBoundary,eventId:n.eventId}):e,_.isValidElement(t)?t:(e&&Qte&&Ue.warn("fallback did not produce a valid ReactElement"),null)}return"function"==typeof t?t():t}}let hw,pw,mw,gw,ip,og=!1;const Zte=new WeakSet,m6=new Set;function UIe(e,t){const n=RIe({...e,instrumentPageLoad:!1,instrumentNavigation:!1}),{useEffect:r,useLocation:i,useNavigationType:o,createRoutesFromChildren:s,matchRoutes:a,stripBasename:l,instrumentPageLoad:c=!0,instrumentNavigation:u=!0}=e;return{...n,setup(){hw=r,pw=i,mw=o,ip=a,gw=s,og=l||!1},afterAllSetup(e){n.afterAllSetup(e);const r=rt&&rt.location&&rt.location.pathname;c&&r&&Xte(e,{name:r,attributes:{[oa]:"url",[Au]:"pageload",[Hr]:`auto.pageload.react.reactrouter_v${t}`}}),u&&Zte.add(e)}}}function jIe(e){const{location:t,routes:n,navigationType:r,version:i,matches:o,basename:s,allRoutes:a}=e,l=Array.isArray(o)?o:ip(n,t,s),c=tn();if(c&&Zte.has(c)&&("PUSH"===r||"POP"===r)&&l){let e,r="url";const o=tne(t,a||n);o&&(e=vb(VO(a||n,t)),r="route"),(!o||!e)&&([e,r]=rne(n,t,l,s)),Jte(c,{name:e,attributes:{[oa]:r,[Au]:"navigation",[Hr]:`auto.navigation.react.reactrouter_v${i}`}})}}function RC(e,t){if(!t||"/"===t||!e.toLowerCase().startsWith(t.toLowerCase()))return e;const n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?e:e.slice(n)||"/"}function FIe(e,t,n){const r=e||og?RC(t,n):t;return["/"===r[r.length-1]||"/*"===r.slice(-2)?r.slice(0,-1):r,"route"]}function ene(e){return e.endsWith("*")}function xV(e,t){return ene(e)&&t.route.children&&t.route.children.length>0||!1}function $Ie(e){return!(e.children||!e.element||!e.path||!e.path.endsWith("/*"))}function tne(e,t){const n=ip(t,e);if(n)for(const e of n)if($Ie(e.route)&&HIe(e))return!0;return!1}function nne(e,t=new Set){return t.has(e)||(t.add(e),e.children&&!e.index&&e.children.forEach(e=>{nne(e,t).forEach(e=>t.add(e))})),t}function BIe(e){return VIe(e.route.path||"")}function HIe(e){return e.params["*"]||""}function VIe(e){return"*"===e[e.length-1]?e.slice(0,-1):e}function Ay(e){return"/"===e[e.length-1]?e.slice(0,-1):e}function vb(e){return"/"===e[0]?e:`/${e}`}function VO(e,t){const n=ip(e,t);if(!n||0===n.length)return"";for(const r of n)if(r.route.path&&"*"!==r.route.path){const n=BIe(r),i=RC(t.pathname,vb(r.pathnameBase));return Ay(Ay(n||"")+vb(VO(e.filter(e=>e!==r.route),{pathname:i})))}return""}function rne(e,t,n,r=""){if(!e||0===e.length)return[og?RC(t.pathname,r):t.pathname,"url"];let i="";if(n)for(const e of n){const n=e.route;if(n){if(n.index)return FIe(i,e.pathname,r);const o=n.path;if(o&&!xV(o,e)){const n="/"===o[0]||"/"===i[i.length-1]?o:`/${o}`;if(i=Ay(i)+vb(n),Ay(t.pathname)===Ay(r+e.pathname))return uV(i)===uV(e.pathname)||ene(i)?(xV(i,e)&&(i=i.slice(0,-1)),[(og?"":r)+i,"route"]):[(og?"":r)+n,"route"]}}}return[og?RC(t.pathname,r):t.pathname||"/","url"]}function qIe(e,t,n,r,i,o){const s=Array.isArray(r)?r:ip(o||n,t,i);if(s){let r,a="url";const l=tne(t,o||n);l&&(r=vb(VO(o||n,t)),a="route"),(!l||!r)&&([r,a]=rne(n,t,s,i)),Ln().setTransactionName(r||"/"),e&&(e.updateName(r),e.setAttribute(oa,a))}}function GIe(e,t){if(!(hw&&pw&&mw&&gw&&ip))return Qte&&Ue.warn(`reactRouterV6Instrumentation was unable to wrap Routes because of one or more missing parameters.\n      useEffect: ${hw}. useLocation: ${pw}. useNavigationType: ${mw}.\n      createRoutesFromChildren: ${gw}. matchRoutes: ${ip}.`),e;const n=n=>{const r=_.useRef(!0),i=pw(),o=mw();return hw(()=>{const e=gw(n.children);r.current?(e.forEach(e=>{nne(e).forEach(e=>{m6.add(e)})}),qIe(KIe(),i,e,void 0,void 0,Array.from(m6)),r.current=!1):jIe({location:i,routes:e,navigationType:o,version:t,allRoutes:Array.from(m6)})},[i,o]),_.createElement(e,{...n})};return NIe(n,e),n}function KIe(){const e=Bi(),t=e?ji(e):void 0;if(!t)return;const n=en(t).op;return"navigation"===n||"pageload"===n?t:void 0}function zIe(e){return UIe(e,"7")}function WIe(e){return GIe(e,"7")}var AV,g6={exports:{}};function YIe(){return AV||(AV=1,e=g6,function(){var t={}.hasOwnProperty;function n(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=i(e,r(n)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var r="";for(var o in e)t.call(e,o)&&e[o]&&(r=i(r,o));return r}function i(e,t){return t?e?e+" "+t:e+t:e}e.exports?(n.default=n,e.exports=n):window.classNames=n}()),g6.exports;var e}var XIe=YIe();const Ne=ac(XIe);function ine(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"m10.6 13.8-2.15-2.15a.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275.95.95 0 0 0-.275.7q0 .425.275.7L9.9 15.9q.3.3.7.3t.7-.3l5.65-5.65a.95.95 0 0 0 .275-.7.95.95 0 0 0-.275-.7.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275zM12 22a9.7 9.7 0 0 1-3.9-.788 10.1 10.1 0 0 1-3.175-2.137q-1.35-1.35-2.137-3.175A9.7 9.7 0 0 1 2 12q0-2.075.788-3.9a10.1 10.1 0 0 1 2.137-3.175q1.35-1.35 3.175-2.137A9.7 9.7 0 0 1 12 2q2.075 0 3.9.788a10.1 10.1 0 0 1 3.175 2.137q1.35 1.35 2.137 3.175A9.7 9.7 0 0 1 22 12a9.7 9.7 0 0 1-.788 3.9 10.1 10.1 0 0 1-2.137 3.175q-1.35 1.35-3.175 2.137A9.7 9.7 0 0 1 12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4 6.325 6.325 4 12t2.325 5.675T12 20"})})}ine.displayName="CheckCircleIcon";const JIe=_.forwardRef(ine);function sne(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M12 17q.424 0 .713-.288A.97.97 0 0 0 13 16a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 15a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 16q0 .424.287.712.288.288.713.288m0-4q.424 0 .713-.287A.97.97 0 0 0 13 12V8a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 7a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 8v4q0 .424.287.713.288.287.713.287m0 9a9.7 9.7 0 0 1-3.9-.788 10.1 10.1 0 0 1-3.175-2.137q-1.35-1.35-2.137-3.175A9.7 9.7 0 0 1 2 12q0-2.075.788-3.9a10.1 10.1 0 0 1 2.137-3.175q1.35-1.35 3.175-2.137A9.7 9.7 0 0 1 12 2q2.075 0 3.9.788a10.1 10.1 0 0 1 3.175 2.137q1.35 1.35 2.137 3.175A9.7 9.7 0 0 1 22 12a9.7 9.7 0 0 1-.788 3.9 10.1 10.1 0 0 1-2.137 3.175q-1.35 1.35-3.175 2.137A9.7 9.7 0 0 1 12 22"})})}sne.displayName="ErrorSolidIcon";const vT=_.forwardRef(sne);function one(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{d:"M11.288 7.288A.97.97 0 0 1 12 7q.424 0 .713.287Q13 7.576 13 8t-.287.713A.97.97 0 0 1 12 9a.97.97 0 0 1-.713-.287A.97.97 0 0 1 11 8q0-.424.287-.713m.001 4.001A.97.97 0 0 1 12 11q.424 0 .713.287.287.288.287.713v4q0 .424-.287.712A.97.97 0 0 1 12 17a.97.97 0 0 1-.713-.288A.97.97 0 0 1 11 16v-4q0-.424.287-.713"}),w.jsx("path",{fillRule:"evenodd",d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10m-2 0a8 8 0 1 1-16 0 8 8 0 0 1 16 0",clipRule:"evenodd"})]})}one.displayName="InfoIcon";const QIe=_.forwardRef(one);function ane(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M6.293 6.293a1 1 0 0 1 1.414 0L12 10.586l4.293-4.293a1 1 0 1 1 1.414 1.414L13.414 12l4.293 4.293a1 1 0 0 1-1.414 1.414L12 13.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 12 6.293 7.707a1 1 0 0 1 0-1.414"})})}ane.displayName="CloseIcon";const yT=_.forwardRef(ane),ZIe="_alert_zx76t_10",eke="_content_zx76t_37",tke="_icon_zx76t_48",nke="_actions_zx76t_64",Pm={alert:ZIe,content:eke,"text-content":"_text-content_zx76t_44",icon:tke,actions:nke},rke="_typography_6v6n8_153",LV={"font-body-xs-regular":"_font-body-xs-regular_6v6n8_12","font-body-xs-semibold":"_font-body-xs-semibold_6v6n8_17","font-body-xs-medium":"_font-body-xs-medium_6v6n8_22","font-body-sm-regular":"_font-body-sm-regular_6v6n8_31","font-body-sm-semibold":"_font-body-sm-semibold_6v6n8_36","font-body-sm-medium":"_font-body-sm-medium_6v6n8_41","font-body-md-regular":"_font-body-md-regular_6v6n8_50","font-body-md-semibold":"_font-body-md-semibold_6v6n8_55","font-body-md-medium":"_font-body-md-medium_6v6n8_60","font-body-lg-regular":"_font-body-lg-regular_6v6n8_69","font-body-lg-semibold":"_font-body-lg-semibold_6v6n8_74","font-body-lg-medium":"_font-body-lg-medium_6v6n8_79","font-heading-sm-regular":"_font-heading-sm-regular_6v6n8_88","font-heading-sm-semibold":"_font-heading-sm-semibold_6v6n8_93","font-heading-sm-medium":"_font-heading-sm-medium_6v6n8_98","font-heading-md-regular":"_font-heading-md-regular_6v6n8_107","font-heading-md-semibold":"_font-heading-md-semibold_6v6n8_112","font-heading-lg-regular":"_font-heading-lg-regular_6v6n8_121","font-heading-lg-semibold":"_font-heading-lg-semibold_6v6n8_126","font-heading-xl-regular":"_font-heading-xl-regular_6v6n8_135","font-heading-xl-semibold":"_font-heading-xl-semibold_6v6n8_140",typography:rke},cne=({as:e,children:t,type:n="body",weight:r="regular",size:i="md",className:o,...s})=>{const a=e||"p";return w.jsx(a,{...s,className:Ne(LV.typography,LV[`font-${n}-${i}-${r}`],o),children:t})},on=({as:e="p",children:t,...n})=>w.jsx(cne,{as:e,type:"body",...n,children:t}),ike="_destructive_1pz9o_95",v6={"icon-button":"_icon-button_1pz9o_8","no-background":"_no-background_1pz9o_42",destructive:ike},lne=_.forwardRef(function({as:e,children:t,className:n,disabled:r,...i},o){const s=e||"button",{onClick:a,onSubmit:l,onPointerDown:c,onPointerUp:u,onKeyDown:d,onKeyUp:h,onKeyPress:p,...f}=i,m=r?{}:{onClick:a,onSubmit:l,onPointerDown:c,onPointerUp:u,onKeyDown:d,onKeyUp:h,onKeyPress:p};return w.jsx(s,{...f,ref:o,className:n,role:"a"===e?"link":"button",tabIndex:0,...m,"aria-disabled":r,children:t})}),ske={"indicator-icon":"_indicator-icon_zr2a0_17"},oke=_.forwardRef(function({children:e,className:t,size:n="100%",colour:r,indicator:i},o){const s=Ne(ske["indicator-icon"],t);return w.jsx("div",{ref:o,className:s,"data-indicator":i,style:{"--cpd-icon-button-size":n,"--cpd-color-icon-tertiary":r},children:Te.Children.only(e)})}),une=_.createContext(null);function qO(){const e=_.useContext(une);if(null==e)throw new Error("Tooltip components must be wrapped in <Tooltip />");return e}function bT(){return typeof window<"u"}function Yv(e){return dne(e)?(e.nodeName||"").toLowerCase():"#document"}function Hs(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function pl(e){var t;return null==(t=(dne(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function dne(e){return!!bT()&&(e instanceof Node||e instanceof Hs(e).Node)}function Dn(e){return!!bT()&&(e instanceof Element||e instanceof Hs(e).Element)}function To(e){return!!bT()&&(e instanceof HTMLElement||e instanceof Hs(e).HTMLElement)}function bL(e){return!(!bT()||typeof ShadowRoot>"u")&&(e instanceof ShadowRoot||e instanceof Hs(e).ShadowRoot)}function b_(e){const{overflow:t,overflowX:n,overflowY:r,display:i}=Ro(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(i)}function ake(e){return["table","td","th"].includes(Yv(e))}function _T(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function GO(e){const t=ST(),n=Dn(e)?Ro(e):e;return["transform","translate","scale","rotate","perspective"].some(e=>!!n[e]&&"none"!==n[e])||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","translate","scale","rotate","perspective","filter"].some(e=>(n.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(n.contain||"").includes(e))}function cke(e){let t=Pu(e);for(;To(t)&&!yu(t);){if(GO(t))return t;if(_T(t))return null;t=Pu(t)}return null}function ST(){return!(typeof CSS>"u"||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function yu(e){return["html","body","#document"].includes(Yv(e))}function Ro(e){return Hs(e).getComputedStyle(e)}function ET(e){return Dn(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Pu(e){if("html"===Yv(e))return e;const t=e.assignedSlot||e.parentNode||bL(e)&&e.host||pl(e);return bL(t)?t.host:t}function fne(e){const t=Pu(e);return yu(t)?e.ownerDocument?e.ownerDocument.body:e.body:To(t)&&b_(t)?t:fne(t)}function rf(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=!0);const i=fne(e),o=i===(null==(r=e.ownerDocument)?void 0:r.body),s=Hs(i);if(o){const e=_L(s);return t.concat(s,s.visualViewport||[],b_(i)?i:[],e&&n?rf(e):[])}return t.concat(i,rf(i,[],n))}function _L(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function SL(e){let t=e.activeElement;for(;null!=(null==(n=t)||null==(n=n.shadowRoot)?void 0:n.activeElement);){var n;t=t.shadowRoot.activeElement}return t}function cv(e,t){if(!e||!t)return!1;const n=null==t.getRootNode?void 0:t.getRootNode();if(e.contains(t))return!0;if(n&&bL(n)){let n=t;for(;n;){if(e===n)return!0;n=n.parentNode||n.host}}return!1}function hne(){const e=navigator.userAgentData;return null!=e&&e.platform?e.platform:navigator.platform}function pne(){const e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(e=>{let{brand:t,version:n}=e;return t+"/"+n}).join(" "):navigator.userAgent}function lke(e){return!dke()&&(!PV()&&0===e.width&&0===e.height||PV()&&1===e.width&&1===e.height&&0===e.pressure&&0===e.detail&&"mouse"===e.pointerType||e.width<1&&e.height<1&&0===e.pressure&&0===e.detail&&"touch"===e.pointerType)}function mne(){return/apple/i.test(navigator.vendor)}function PV(){const e=/android/i;return e.test(hne())||e.test(pne())}function uke(){return hne().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints}function dke(){return pne().includes("jsdom/")}function EL(e,t){const n=["mouse","pen"];return n.push("",void 0),n.includes(e)}function fke(e){return"nativeEvent"in e}function hke(e){return e.matches("html,body")}function Kd(e){return(null==e?void 0:e.ownerDocument)||document}function y6(e,t){if(null==t)return!1;if("composedPath"in e)return e.composedPath().includes(t);const n=e;return null!=n.target&&t.contains(n.target)}function Jm(e){return"composedPath"in e?e.composedPath()[0]:e.target}const pke="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function mke(e){return To(e)&&e.matches(pke)}const gke=["top","right","bottom","left"],yf=Math.min,bo=Math.max,IC=Math.round,U2=Math.floor,Qc=e=>({x:e,y:e}),vke={left:"right",right:"left",bottom:"top",top:"bottom"},yke={start:"end",end:"start"};function wL(e,t,n){return bo(e,yf(t,n))}function Ou(e,t){return"function"==typeof e?e(t):e}function Mu(e){return e.split("-")[0]}function Xv(e){return e.split("-")[1]}function KO(e){return"x"===e?"y":"x"}function zO(e){return"y"===e?"height":"width"}function bf(e){return["top","bottom"].includes(Mu(e))?"y":"x"}function WO(e){return KO(bf(e))}function bke(e,t,n){void 0===n&&(n=!1);const r=Xv(e),i=WO(e),o=zO(i);let s="x"===i?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[o]>t.floating[o]&&(s=kC(s)),[s,kC(s)]}function _ke(e){const t=kC(e);return[CL(e),t,CL(t)]}function CL(e){return e.replace(/start|end/g,e=>yke[e])}function Ske(e,t,n){const r=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(e){case"top":case"bottom":return n?t?i:r:t?r:i;case"left":case"right":return t?o:s;default:return[]}}function Eke(e,t,n,r){const i=Xv(e);let o=Ske(Mu(e),"start"===n,r);return i&&(o=o.map(e=>e+"-"+i),t&&(o=o.concat(o.map(CL)))),o}function kC(e){return e.replace(/left|right|bottom|top/g,e=>vke[e])}function wke(e){return{top:0,right:0,bottom:0,left:0,...e}}function gne(e){return"number"!=typeof e?wke(e):{top:e,right:e,bottom:e,left:e}}function xC(e){const{x:t,y:n,width:r,height:i}=e;return{width:r,height:i,top:n,left:t,right:t+r,bottom:n+i,x:t,y:n}}var Cke=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],TL=Cke.join(","),vne=typeof Element>"u",yb=vne?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,AC=!vne&&Element.prototype.getRootNode?function(e){var t;return null==e||null===(t=e.getRootNode)||void 0===t?void 0:t.call(e)}:function(e){return null==e?void 0:e.ownerDocument},LC=function e(t,n){var r;void 0===n&&(n=!0);var i=null==t||null===(r=t.getAttribute)||void 0===r?void 0:r.call(t,"inert");return""===i||"true"===i||n&&t&&e(t.parentNode)},Tke=function(e){var t,n=null==e||null===(t=e.getAttribute)||void 0===t?void 0:t.call(e,"contenteditable");return""===n||"true"===n},Rke=function(e,t,n){if(LC(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(TL));return t&&yb.call(e,TL)&&r.unshift(e),r=r.filter(n)},Ike=function e(t,n,r){for(var i=[],o=Array.from(t);o.length;){var s=o.shift();if(!LC(s,!1))if("SLOT"===s.tagName){var a=s.assignedElements(),l=e(a.length?a:s.children,!0,r);r.flatten?i.push.apply(i,l):i.push({scopeParent:s,candidates:l})}else{yb.call(s,TL)&&r.filter(s)&&(n||!t.includes(s))&&i.push(s);var c=s.shadowRoot||"function"==typeof r.getShadowRoot&&r.getShadowRoot(s),u=!LC(c,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(s));if(c&&u){var d=e(!0===c?s.children:c.children,!0,r);r.flatten?i.push.apply(i,d):i.push({scopeParent:s,candidates:d})}else o.unshift.apply(o,s.children)}}return i},yne=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},bne=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Tke(e))&&!yne(e)?0:e.tabIndex},kke=function(e,t){var n=bne(e);return n<0&&t&&!yne(e)?0:n},xke=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},_ne=function(e){return"INPUT"===e.tagName},Ake=function(e){return _ne(e)&&"hidden"===e.type},Lke=function(e){return"DETAILS"===e.tagName&&Array.prototype.slice.apply(e.children).some(function(e){return"SUMMARY"===e.tagName})},Pke=function(e,t){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===t)return e[n]},Oke=function(e){if(!e.name)return!0;var t,n=e.form||AC(e),r=function(e){return n.querySelectorAll('input[type="radio"][name="'+e+'"]')};if(typeof window<"u"&&typeof window.CSS<"u"&&"function"==typeof window.CSS.escape)t=r(window.CSS.escape(e.name));else try{t=r(e.name)}catch(e){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",e.message),!1}var i=Pke(t,e.form);return!i||i===e},Mke=function(e){return _ne(e)&&"radio"===e.type},Dke=function(e){return Mke(e)&&!Oke(e)},Nke=function(e){var t,n,r,i,o=e&&AC(e),s=null===(t=o)||void 0===t?void 0:t.host,a=!1;if(o&&o!==e)for(a=!!(null!==(n=s)&&void 0!==n&&null!==(r=n.ownerDocument)&&void 0!==r&&r.contains(s)||null!=e&&null!==(i=e.ownerDocument)&&void 0!==i&&i.contains(e));!a&&s;){var l,c,u;a=!(null===(c=s=null===(l=o=AC(s))||void 0===l?void 0:l.host)||void 0===c||null===(u=c.ownerDocument)||void 0===u||!u.contains(s))}return a},OV=function(e){var t=e.getBoundingClientRect(),n=t.width,r=t.height;return 0===n&&0===r},Uke=function(e,t){var n=t.displayCheck,r=t.getShadowRoot;if("hidden"===getComputedStyle(e).visibility)return!0;var i=yb.call(e,"details>summary:first-of-type")?e.parentElement:e;if(yb.call(i,"details:not([open]) *"))return!0;if(n&&"full"!==n&&"legacy-full"!==n){if("non-zero-area"===n)return OV(e)}else{if("function"==typeof r){for(var o=e;e;){var s=e.parentElement,a=AC(e);if(s&&!s.shadowRoot&&!0===r(s))return OV(e);e=e.assignedSlot?e.assignedSlot:s||a===e.ownerDocument?s:a.host}e=o}if(Nke(e))return!e.getClientRects().length;if("legacy-full"!==n)return!0}return!1},jke=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if("FIELDSET"===t.tagName&&t.disabled){for(var n=0;n<t.children.length;n++){var r=t.children.item(n);if("LEGEND"===r.tagName)return!!yb.call(t,"fieldset[disabled] *")||!r.contains(e)}return!0}t=t.parentElement}return!1},Fke=function(e,t){return!(t.disabled||LC(t)||Ake(t)||Uke(t,e)||Lke(t)||jke(t))},MV=function(e,t){return!(Dke(t)||bne(t)<0||!Fke(e,t))},$ke=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(t)||t>=0)},Bke=function e(t){var n=[],r=[];return t.forEach(function(t,i){var o=!!t.scopeParent,s=o?t.scopeParent:t,a=kke(s,o),l=o?e(t.candidates):s;0===a?o?n.push.apply(n,l):n.push(s):r.push({documentOrder:i,tabIndex:a,item:t,isScope:o,content:l})}),r.sort(xke).reduce(function(e,t){return t.isScope?e.push.apply(e,t.content):e.push(t.content),e},[]).concat(n)},Sne=function(e,t){var n;return n=(t=t||{}).getShadowRoot?Ike([e],t.includeContainer,{filter:MV.bind(null,t),flatten:!1,getShadowRoot:t.getShadowRoot,shadowRootFilter:$ke}):Rke(e,t.includeContainer,MV.bind(null,t)),Bke(n)};function DV(e,t,n){let{reference:r,floating:i}=e;const o=bf(t),s=WO(t),a=zO(s),l=Mu(t),c="y"===o,u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-i.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(Xv(t)){case"start":p[s]-=h*(n&&c?-1:1);break;case"end":p[s]+=h*(n&&c?-1:1)}return p}const Hke=async(e,t,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=await(null==s.isRTL?void 0:s.isRTL(t));let c=await s.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=DV(c,r,l),h=r,p={},f=0;for(let n=0;n<a.length;n++){const{name:o,fn:m}=a[n],{x:v,y:g,data:y,reset:b}=await m({x:u,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:s,elements:{reference:e,floating:t}});u=v??u,d=g??d,p={...p,[o]:{...p[o],...y}},b&&f<=50&&(f++,"object"==typeof b&&(b.placement&&(h=b.placement),b.rects&&(c=!0===b.rects?await s.getElementRects({reference:e,floating:t,strategy:i}):b.rects),({x:u,y:d}=DV(c,h,l))),n=-1)}return{x:u,y:d,placement:h,strategy:i,middlewareData:p}};async function bb(e,t){var n;void 0===t&&(t={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=Ou(t,e),f=gne(p),m=a[h?"floating"===d?"reference":"floating":d],v=xC(await o.getClippingRect({element:null==(n=await(null==o.isElement?void 0:o.isElement(m)))||n?m:m.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),g="floating"===d?{x:r,y:i,width:s.floating.width,height:s.floating.height}:s.reference,y=await(null==o.getOffsetParent?void 0:o.getOffsetParent(a.floating)),b=await(null==o.isElement?void 0:o.isElement(y))&&await(null==o.getScale?void 0:o.getScale(y))||{x:1,y:1},w=xC(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:g,offsetParent:y,strategy:l}):g);return{top:(v.top-w.top+f.top)/b.y,bottom:(w.bottom-v.bottom+f.bottom)/b.y,left:(v.left-w.left+f.left)/b.x,right:(w.right-v.right+f.right)/b.x}}const Vke=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=Ou(e,t)||{};if(null==c)return{};const d=gne(u),h={x:n,y:r},p=WO(i),f=zO(p),m=await s.getDimensions(c),v="y"===p,g=v?"top":"left",y=v?"bottom":"right",b=v?"clientHeight":"clientWidth",w=o.reference[f]+o.reference[p]-h[p]-o.floating[f],_=h[p]-o.reference[p],S=await(null==s.getOffsetParent?void 0:s.getOffsetParent(c));let E=S?S[b]:0;(!E||!await(null==s.isElement?void 0:s.isElement(S)))&&(E=a.floating[b]||o.floating[f]);const C=w/2-_/2,k=E/2-m[f]/2-1,T=yf(d[g],k),R=yf(d[y],k),I=T,x=E-m[f]-R,P=E/2-m[f]/2+C,L=wL(I,P,x),M=!l.arrow&&null!=Xv(i)&&P!==L&&o.reference[f]/2-(P<I?T:R)-m[f]/2<0,O=M?P<I?P-I:P-x:0;return{[p]:h[p]+O,data:{[p]:L,centerOffset:P-L-O,...M&&{alignmentOffset:O}},reset:M}}}),qke=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:i,middlewareData:o,rects:s,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:m=!0,...v}=Ou(e,t);if(null!=(n=o.arrow)&&n.alignmentOffset)return{};const g=Mu(i),y=bf(a),b=Mu(a)===a,w=await(null==l.isRTL?void 0:l.isRTL(c.floating)),_=h||(b||!m?[kC(a)]:_ke(a)),S="none"!==f;!h&&S&&_.push(...Eke(a,m,f,w));const E=[a,..._],C=await bb(t,v),k=[];let T=(null==(r=o.flip)?void 0:r.overflows)||[];if(u&&k.push(C[g]),d){const e=bke(i,s,w);k.push(C[e[0]],C[e[1]])}if(T=[...T,{placement:i,overflows:k}],!k.every(e=>e<=0)){var R,I;const e=((null==(R=o.flip)?void 0:R.index)||0)+1,t=E[e];if(t)return{data:{index:e,overflows:T},reset:{placement:t}};let n=null==(I=T.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:I.placement;if(!n)switch(p){case"bestFit":{var x;const e=null==(x=T.filter(e=>{if(S){const t=bf(e.placement);return t===y||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:x[0];e&&(n=e);break}case"initialPlacement":n=a}if(i!==n)return{reset:{placement:n}}}return{}}}};function NV(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function UV(e){return gke.some(t=>e[t]>=0)}const Gke=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...i}=Ou(e,t);switch(r){case"referenceHidden":{const e=NV(await bb(t,{...i,elementContext:"reference"}),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:UV(e)}}}case"escaped":{const e=NV(await bb(t,{...i,altBoundary:!0}),n.floating);return{data:{escapedOffsets:e,escaped:UV(e)}}}default:return{}}}}};async function Kke(e,t){const{placement:n,platform:r,elements:i}=e,o=await(null==r.isRTL?void 0:r.isRTL(i.floating)),s=Mu(n),a=Xv(n),l="y"===bf(n),c=["left","top"].includes(s)?-1:1,u=o&&l?-1:1,d=Ou(t,e);let{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&"number"==typeof f&&(p="end"===a?-1*f:f),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const zke=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:i,y:o,placement:s,middlewareData:a}=t,l=await Kke(t,e);return s===(null==(n=a.offset)?void 0:n.placement)&&null!=(r=a.arrow)&&r.alignmentOffset?{}:{x:i+l.x,y:o+l.y,data:{...l,placement:s}}}}},Wke=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:i}=t,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...l}=Ou(e,t),c={x:n,y:r},u=await bb(t,l),d=bf(Mu(i)),h=KO(d);let p=c[h],f=c[d];if(o){const e="y"===h?"bottom":"right";p=wL(p+u["y"===h?"top":"left"],p,p-u[e])}if(s){const e="y"===d?"bottom":"right";f=wL(f+u["y"===d?"top":"left"],f,f-u[e])}const m=a.fn({...t,[h]:p,[d]:f});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[h]:o,[d]:s}}}}}},Yke=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:i,rects:o,middlewareData:s}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Ou(e,t),u={x:n,y:r},d=bf(i),h=KO(d);let p=u[h],f=u[d];const m=Ou(a,t),v="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const e="y"===h?"height":"width",t=o.reference[h]-o.floating[e]+v.mainAxis,n=o.reference[h]+o.reference[e]-v.mainAxis;p<t?p=t:p>n&&(p=n)}if(c){var g,y;const e="y"===h?"width":"height",t=["top","left"].includes(Mu(i)),n=o.reference[d]-o.floating[e]+(t&&(null==(g=s.offset)?void 0:g[d])||0)+(t?0:v.crossAxis),r=o.reference[d]+o.reference[e]+(t?0:(null==(y=s.offset)?void 0:y[d])||0)-(t?v.crossAxis:0);f<n?f=n:f>r&&(f=r)}return{[h]:p,[d]:f}}}},Xke=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:i,rects:o,platform:s,elements:a}=t,{apply:l=()=>{},...c}=Ou(e,t),u=await bb(t,c),d=Mu(i),h=Xv(i),p="y"===bf(i),{width:f,height:m}=o.floating;let v,g;"top"===d||"bottom"===d?(v=d,g=h===(await(null==s.isRTL?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(g=d,v="end"===h?"top":"bottom");const y=m-u.top-u.bottom,b=f-u.left-u.right,w=yf(m-u[v],y),_=yf(f-u[g],b),S=!t.middlewareData.shift;let E=w,C=_;if(null!=(n=t.middlewareData.shift)&&n.enabled.x&&(C=b),null!=(r=t.middlewareData.shift)&&r.enabled.y&&(E=y),S&&!h){const e=bo(u.left,0),t=bo(u.right,0),n=bo(u.top,0),r=bo(u.bottom,0);p?C=f-2*(0!==e||0!==t?e+t:bo(u.left,u.right)):E=m-2*(0!==n||0!==r?n+r:bo(u.top,u.bottom))}await l({...t,availableWidth:C,availableHeight:E});const k=await s.getDimensions(a.floating);return f!==k.width||m!==k.height?{reset:{rects:!0}}:{}}}};function Ene(e){const t=Ro(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const i=To(e),o=i?e.offsetWidth:n,s=i?e.offsetHeight:r,a=IC(n)!==o||IC(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function YO(e){return Dn(e)?e:e.contextElement}function xg(e){const t=YO(e);if(!To(t))return Qc(1);const n=t.getBoundingClientRect(),{width:r,height:i,$:o}=Ene(t);let s=(o?IC(n.width):n.width)/r,a=(o?IC(n.height):n.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Jke=Qc(0);function wne(e){const t=Hs(e);return ST()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:Jke}function Qke(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==Hs(e))&&t}function sp(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1);const i=e.getBoundingClientRect(),o=YO(e);let s=Qc(1);t&&(r?Dn(r)&&(s=xg(r)):s=xg(e));const a=Qke(o,n,r)?wne(o):Qc(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,u=i.width/s.x,d=i.height/s.y;if(o){const e=Hs(o),t=r&&Dn(r)?Hs(r):r;let n=e,i=_L(n);for(;i&&r&&t!==n;){const e=xg(i),t=i.getBoundingClientRect(),r=Ro(i),o=t.left+(i.clientLeft+parseFloat(r.paddingLeft))*e.x,s=t.top+(i.clientTop+parseFloat(r.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,d*=e.y,l+=o,c+=s,n=Hs(i),i=_L(n)}}return xC({width:u,height:d,x:l,y:c})}function XO(e,t){const n=ET(e).scrollLeft;return t?t.left+n:sp(pl(e)).left+n}function Cne(e,t,n){void 0===n&&(n=!1);const r=e.getBoundingClientRect();return{x:r.left+t.scrollLeft-(n?0:XO(e,r)),y:r.top+t.scrollTop}}function Zke(e){let{elements:t,rect:n,offsetParent:r,strategy:i}=e;const o="fixed"===i,s=pl(r),a=!!t&&_T(t.floating);if(r===s||a&&o)return n;let l={scrollLeft:0,scrollTop:0},c=Qc(1);const u=Qc(0),d=To(r);if((d||!d&&!o)&&(("body"!==Yv(r)||b_(s))&&(l=ET(r)),To(r))){const e=sp(r);c=xg(r),u.x=e.x+r.clientLeft,u.y=e.y+r.clientTop}const h=!s||d||o?Qc(0):Cne(s,l,!0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:n.y*c.y-l.scrollTop*c.y+u.y+h.y}}function e6e(e){return Array.from(e.getClientRects())}function t6e(e){const t=pl(e),n=ET(e),r=e.ownerDocument.body,i=bo(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=bo(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+XO(e);const a=-n.scrollTop;return"rtl"===Ro(r).direction&&(s+=bo(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}function n6e(e,t){const n=Hs(e),r=pl(e),i=n.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const e=ST();(!e||e&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function r6e(e,t){const n=sp(e,!0,"fixed"===t),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=To(e)?xg(e):Qc(1);return{width:e.clientWidth*o.x,height:e.clientHeight*o.y,x:i*o.x,y:r*o.y}}function jV(e,t,n){let r;if("viewport"===t)r=n6e(e,n);else if("document"===t)r=t6e(pl(e));else if(Dn(t))r=r6e(t,n);else{const n=wne(e);r={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return xC(r)}function Tne(e,t){const n=Pu(e);return!(n===t||!Dn(n)||yu(n))&&("fixed"===Ro(n).position||Tne(n,t))}function i6e(e,t){const n=t.get(e);if(n)return n;let r=rf(e,[],!1).filter(e=>Dn(e)&&"body"!==Yv(e)),i=null;const o="fixed"===Ro(e).position;let s=o?Pu(e):e;for(;Dn(s)&&!yu(s);){const t=Ro(s),n=GO(s);!n&&"fixed"===t.position&&(i=null),(o?!n&&!i:!n&&"static"===t.position&&i&&["absolute","fixed"].includes(i.position)||b_(s)&&!n&&Tne(e,s))?r=r.filter(e=>e!==s):i=t,s=Pu(s)}return t.set(e,r),r}function s6e(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e;const o=[..."clippingAncestors"===n?_T(t)?[]:i6e(t,this._c):[].concat(n),r],s=o[0],a=o.reduce((e,n)=>{const r=jV(t,n,i);return e.top=bo(r.top,e.top),e.right=yf(r.right,e.right),e.bottom=yf(r.bottom,e.bottom),e.left=bo(r.left,e.left),e},jV(t,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function o6e(e){const{width:t,height:n}=Ene(e);return{width:t,height:n}}function a6e(e,t,n){const r=To(t),i=pl(t),o="fixed"===n,s=sp(e,!0,o,t);let a={scrollLeft:0,scrollTop:0};const l=Qc(0);if(r||!r&&!o)if(("body"!==Yv(t)||b_(i))&&(a=ET(t)),r){const e=sp(t,!0,o,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&(l.x=XO(i));const c=!i||r||o?Qc(0):Cne(i,a);return{x:s.left+a.scrollLeft-l.x-c.x,y:s.top+a.scrollTop-l.y-c.y,width:s.width,height:s.height}}function b6(e){return"static"===Ro(e).position}function FV(e,t){if(!To(e)||"fixed"===Ro(e).position)return null;if(t)return t(e);let n=e.offsetParent;return pl(e)===n&&(n=n.ownerDocument.body),n}function Rne(e,t){const n=Hs(e);if(_T(e))return n;if(!To(e)){let t=Pu(e);for(;t&&!yu(t);){if(Dn(t)&&!b6(t))return t;t=Pu(t)}return n}let r=FV(e,t);for(;r&&ake(r)&&b6(r);)r=FV(r,t);return r&&yu(r)&&b6(r)&&!GO(r)?n:r||cke(e)||n}const c6e=async function(e){const t=this.getOffsetParent||Rne,n=this.getDimensions,r=await n(e.floating);return{reference:a6e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function l6e(e){return"rtl"===Ro(e).direction}const u6e={convertOffsetParentRelativeRectToViewportRelativeRect:Zke,getDocumentElement:pl,getClippingRect:s6e,getOffsetParent:Rne,getElementRects:c6e,getClientRects:e6e,getDimensions:o6e,getScale:xg,isElement:Dn,isRTL:l6e};function Ine(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function d6e(e,t){let n,r=null;const i=pl(e);function o(){var e;clearTimeout(n),null==(e=r)||e.disconnect(),r=null}return function s(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),o();const c=e.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=c;if(a||t(),!h||!p)return;const f={rootMargin:-U2(d)+"px "+-U2(i.clientWidth-(u+h))+"px "+-U2(i.clientHeight-(d+p))+"px "+-U2(u)+"px",threshold:bo(0,yf(1,l))||1};let m=!0;function v(t){const r=t[0].intersectionRatio;if(r!==l){if(!m)return s();r?s(!1,r):n=setTimeout(()=>{s(!1,1e-7)},1e3)}1===r&&!Ine(c,e.getBoundingClientRect())&&s(),m=!1}try{r=new IntersectionObserver(v,{...f,root:i.ownerDocument})}catch{r=new IntersectionObserver(v,f)}r.observe(e)}(!0),o}function kne(e,t,n,r){void 0===r&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s="function"==typeof ResizeObserver,layoutShift:a="function"==typeof IntersectionObserver,animationFrame:l=!1}=r,c=YO(e),u=i||o?[...c?rf(c):[],...rf(t)]:[];u.forEach(e=>{i&&e.addEventListener("scroll",n,{passive:!0}),o&&e.addEventListener("resize",n)});const d=c&&a?d6e(c,n):null;let h=-1,p=null;s&&(p=new ResizeObserver(e=>{let[r]=e;r&&r.target===c&&p&&(p.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var e;null==(e=p)||e.observe(t)})),n()}),c&&!l&&p.observe(c),p.observe(t));let f,m=l?sp(e):null;return l&&function t(){const r=sp(e);m&&!Ine(m,r)&&n(),m=r,f=requestAnimationFrame(t)}(),n(),()=>{var e;u.forEach(e=>{i&&e.removeEventListener("scroll",n),o&&e.removeEventListener("resize",n)}),null==d||d(),null==(e=p)||e.disconnect(),p=null,l&&cancelAnimationFrame(f)}}const f6e=zke,h6e=Wke,p6e=qke,m6e=Xke,g6e=Gke,$V=Vke,v6e=Yke,y6e=(e,t,n)=>{const r=new Map,i={platform:u6e,...n},o={...i.platform,_c:r};return Hke(e,t,{...i,platform:o})};var vw=typeof document<"u"?_.useLayoutEffect:_.useEffect;function PC(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let n,r,i;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;0!==r--;)if(!PC(e[r],t[r]))return!1;return!0}if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;0!==r--;)if(!{}.hasOwnProperty.call(t,i[r]))return!1;for(r=n;0!==r--;){const n=i[r];if(!("_owner"===n&&e.$$typeof||PC(e[n],t[n])))return!1}return!0}return e!=e&&t!=t}function xne(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function BV(e,t){const n=xne(e);return Math.round(t*n)/n}function _6(e){const t=_.useRef(e);return vw(()=>{t.current=e}),t}function Ane(e){void 0===e&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=e,[u,d]=_.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[h,p]=_.useState(r);PC(h,r)||p(r);const[f,m]=_.useState(null),[v,g]=_.useState(null),y=_.useCallback(e=>{e!==E.current&&(E.current=e,m(e))},[]),b=_.useCallback(e=>{e!==C.current&&(C.current=e,g(e))},[]),w=o||f,S=s||v,E=_.useRef(null),C=_.useRef(null),k=_.useRef(u),T=null!=l,R=_6(l),I=_6(i),x=_6(c),P=_.useCallback(()=>{if(!E.current||!C.current)return;const e={placement:t,strategy:n,middleware:h};I.current&&(e.platform=I.current),y6e(E.current,C.current,e).then(e=>{const t={...e,isPositioned:!1!==x.current};L.current&&!PC(k.current,t)&&(k.current=t,jv.flushSync(()=>{d(t)}))})},[h,t,n,I,x]);vw(()=>{!1===c&&k.current.isPositioned&&(k.current.isPositioned=!1,d(e=>({...e,isPositioned:!1})))},[c]);const L=_.useRef(!1);vw(()=>(L.current=!0,()=>{L.current=!1}),[]),vw(()=>{if(w&&(E.current=w),S&&(C.current=S),w&&S){if(R.current)return R.current(w,S,P);P()}},[w,S,P,R,T]);const M=_.useMemo(()=>({reference:E,floating:C,setReference:y,setFloating:b}),[y,b]),O=_.useMemo(()=>({reference:w,floating:S}),[w,S]),A=_.useMemo(()=>{const e={position:n,left:0,top:0};if(!O.floating)return e;const t=BV(O.floating,u.x),r=BV(O.floating,u.y);return a?{...e,transform:"translate("+t+"px, "+r+"px)",...xne(O.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:t,top:r}},[n,a,O.floating,u.x,u.y]);return _.useMemo(()=>({...u,update:P,refs:M,elements:O,floatingStyles:A}),[u,P,M,O,A])}const b6e=e=>({name:"arrow",options:e,fn(t){const{element:n,padding:r}="function"==typeof e?e(t):e;return n&&function(e){return{}.hasOwnProperty.call(e,"current")}(n)?null!=n.current?$V({element:n.current,padding:r}).fn(t):{}:n?$V({element:n,padding:r}).fn(t):{}}}),Lne=(e,t)=>({...f6e(e),options:[e,t]}),Pne=(e,t)=>({...h6e(e),options:[e,t]}),_6e=(e,t)=>({...v6e(e),options:[e,t]}),One=(e,t)=>({...p6e(e),options:[e,t]}),S6e=(e,t)=>({...m6e(e),options:[e,t]}),E6e=(e,t)=>({...g6e(e),options:[e,t]}),Mne=(e,t)=>({...b6e(e),options:[e,t]});function Dne(e){return _.useMemo(()=>e.every(e=>null==e)?null:t=>{e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})},e)}const Nne={...c_},w6e=Nne.useInsertionEffect,C6e=w6e||(e=>e());function au(e){const t=_.useRef(()=>{});return C6e(()=>{t.current=e}),_.useCallback(function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return null==t.current?void 0:t.current(...n)},[])}var hs=typeof document<"u"?_.useLayoutEffect:_.useEffect;let HV=!1,T6e=0;const VV=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+T6e++;function R6e(){const[e,t]=_.useState(()=>HV?VV():void 0);return hs(()=>{null==e&&t(VV())},[]),_.useEffect(()=>{HV=!0},[]),e}const I6e=Nne.useId,lv=I6e||R6e,k6e=_.forwardRef(function(e,t){const{context:{placement:n,elements:{floating:r},middlewareData:{arrow:i,shift:o}},width:s=14,height:a=7,tipRadius:l=0,strokeWidth:c=0,staticOffset:u,stroke:d,d:h,style:{transform:p,...f}={},...m}=e,v=lv(),[g,y]=_.useState(!1);if(hs(()=>{r&&"rtl"===Ro(r).direction&&y(!0)},[r]),!r)return null;const[b,S]=n.split("-"),E="top"===b||"bottom"===b;let C=u;(E&&null!=o&&o.x||!E&&null!=o&&o.y)&&(C=null);const k=2*c,T=k/2,R=s/2*(l/-8+1),I=a/2*l/4,x=!!h,P=C&&"end"===S?"bottom":"top";let L=C&&"end"===S?"right":"left";C&&g&&(L="end"===S?"left":"right");const M=null!=(null==i?void 0:i.x)?C||i.x:"",O=null!=(null==i?void 0:i.y)?C||i.y:"",A=h||"M0,0 H"+s+" L"+(s-R)+","+(a-I)+" Q"+s/2+","+a+" "+R+","+(a-I)+" Z",D={top:x?"rotate(180deg)":"",left:x?"rotate(90deg)":"rotate(-90deg)",bottom:x?"":"rotate(180deg)",right:x?"rotate(-90deg)":"rotate(90deg)"}[b];return w.jsxs("svg",{...m,"aria-hidden":!0,ref:t,width:x?s:s+k,height:s,viewBox:"0 0 "+s+" "+(a>s?a:s),style:{position:"absolute",pointerEvents:"none",[L]:M,[P]:O,[b]:E||x?"100%":"calc(100% - "+k/2+"px)",transform:[D,p].filter(e=>!!e).join(" "),...f},children:[k>0&&w.jsx("path",{clipPath:"url(#"+v+")",fill:"none",stroke:d,strokeWidth:k+(h?0:1),d:A}),w.jsx("path",{stroke:k&&!h?m.fill:"none",d:A}),w.jsx("clipPath",{id:v,children:w.jsx("rect",{x:-T,y:T*(x?-1:1),width:s+k,height:s})})]})});function x6e(){const e=new Map;return{emit(t,n){var r;null==(r=e.get(t))||r.forEach(e=>e(n))},on(t,n){e.set(t,[...e.get(t)||[],n])},off(t,n){var r;e.set(t,(null==(r=e.get(t))?void 0:r.filter(e=>e!==n))||[])}}}const A6e=_.createContext(null),L6e=_.createContext(null),JO=()=>{var e;return(null==(e=_.useContext(A6e))?void 0:e.id)||null},QO=()=>_.useContext(L6e);function __(e){return"data-floating-ui-"+e}function S6(e){const t=_.useRef(e);return hs(()=>{t.current=e}),t}const qV=__("safe-polygon");function yw(e,t,n){return n&&!EL(n)?0:"number"==typeof e?e:null==e?void 0:e[t]}function P6e(e,t){void 0===t&&(t={});const{open:n,onOpenChange:r,dataRef:i,events:o,elements:s}=e,{enabled:a=!0,delay:l=0,handleClose:c=null,mouseOnly:u=!1,restMs:d=0,move:h=!0}=t,p=QO(),f=JO(),m=S6(c),v=S6(l),g=S6(n),y=_.useRef(),b=_.useRef(-1),w=_.useRef(),S=_.useRef(-1),E=_.useRef(!0),C=_.useRef(!1),k=_.useRef(()=>{}),T=_.useRef(!1),R=_.useCallback(()=>{var e;const t=null==(e=i.current.openEvent)?void 0:e.type;return(null==t?void 0:t.includes("mouse"))&&"mousedown"!==t},[i]);_.useEffect(()=>{if(a)return o.on("openchange",e),()=>{o.off("openchange",e)};function e(e){let{open:t}=e;t||(clearTimeout(b.current),clearTimeout(S.current),E.current=!0,T.current=!1)}},[a,o]),_.useEffect(()=>{if(!a||!m.current||!n)return;function e(e){R()&&r(!1,e,"hover")}const t=Kd(s.floating).documentElement;return t.addEventListener("mouseleave",e),()=>{t.removeEventListener("mouseleave",e)}},[s.floating,n,r,a,m,R]);const I=_.useCallback(function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n="hover");const i=yw(v.current,"close",y.current);i&&!w.current?(clearTimeout(b.current),b.current=window.setTimeout(()=>r(!1,e,n),i)):t&&(clearTimeout(b.current),r(!1,e,n))},[v,r]),x=au(()=>{k.current(),w.current=void 0}),P=au(()=>{if(C.current){const e=Kd(s.floating).body;e.style.pointerEvents="",e.removeAttribute(qV),C.current=!1}}),L=au(()=>!!i.current.openEvent&&["click","mousedown"].includes(i.current.openEvent.type));_.useEffect(()=>{if(a&&Dn(s.domReference)){var e;const r=s.domReference;return n&&r.addEventListener("mouseleave",l),null==(e=s.floating)||e.addEventListener("mouseleave",l),h&&r.addEventListener("mousemove",t,{once:!0}),r.addEventListener("mouseenter",t),r.addEventListener("mouseleave",o),()=>{var e;n&&r.removeEventListener("mouseleave",l),null==(e=s.floating)||e.removeEventListener("mouseleave",l),h&&r.removeEventListener("mousemove",t),r.removeEventListener("mouseenter",t),r.removeEventListener("mouseleave",o)}}function t(e){if(clearTimeout(b.current),E.current=!1,u&&!EL(y.current)||d>0&&!yw(v.current,"open"))return;const t=yw(v.current,"open",y.current);t?b.current=window.setTimeout(()=>{g.current||r(!0,e,"hover")},t):n||r(!0,e,"hover")}function o(e){if(L())return;k.current();const t=Kd(s.floating);if(clearTimeout(S.current),T.current=!1,m.current&&i.current.floatingContext){n||clearTimeout(b.current),w.current=m.current({...i.current.floatingContext,tree:p,x:e.clientX,y:e.clientY,onClose(){P(),x(),L()||I(e,!0,"safe-polygon")}});const r=w.current;return t.addEventListener("mousemove",r),void(k.current=()=>{t.removeEventListener("mousemove",r)})}("touch"!==y.current||!cv(s.floating,e.relatedTarget))&&I(e)}function l(e){L()||i.current.floatingContext&&(null==m.current||m.current({...i.current.floatingContext,tree:p,x:e.clientX,y:e.clientY,onClose(){P(),x(),L()||I(e)}})(e))}},[s,a,e,u,d,h,I,x,P,r,n,g,p,v,m,i,L]),hs(()=>{var e;if(a&&n&&null!=(e=m.current)&&e.__options.blockPointerEvents&&R()){C.current=!0;const e=s.floating;if(Dn(s.domReference)&&e){var t;const n=Kd(s.floating).body;n.setAttribute(qV,"");const r=s.domReference,i=null==p||null==(t=p.nodesRef.current.find(e=>e.id===f))||null==(t=t.context)?void 0:t.elements.floating;return i&&(i.style.pointerEvents=""),n.style.pointerEvents="none",r.style.pointerEvents="auto",e.style.pointerEvents="auto",()=>{n.style.pointerEvents="",r.style.pointerEvents="",e.style.pointerEvents=""}}}},[a,n,f,s,p,m,R]),hs(()=>{n||(y.current=void 0,T.current=!1,x(),P())},[n,x,P]),_.useEffect(()=>()=>{x(),clearTimeout(b.current),clearTimeout(S.current),P()},[a,s.domReference,x,P]);const M=_.useMemo(()=>{function e(e){y.current=e.pointerType}return{onPointerDown:e,onPointerEnter:e,onMouseMove(e){const{nativeEvent:t}=e;function i(){!E.current&&!g.current&&r(!0,t,"hover")}u&&!EL(y.current)||n||0===d||T.current&&e.movementX**2+e.movementY**2<2||(clearTimeout(S.current),"touch"===y.current?i():(T.current=!0,S.current=window.setTimeout(i,d)))}}},[u,r,n,g,d]),O=_.useMemo(()=>({onMouseEnter(){clearTimeout(b.current)},onMouseLeave(e){L()||I(e.nativeEvent,!1)}}),[I,L]);return _.useMemo(()=>a?{reference:M,floating:O}:{},[a,M,O])}const RL=()=>{},Une=_.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:RL,setState:RL,isInstantPhase:!1}),O6e=()=>_.useContext(Une);function M6e(e){const{children:t,delay:n,timeoutMs:r=0}=e,[i,o]=_.useReducer((e,t)=>({...e,...t}),{delay:n,timeoutMs:r,initialDelay:n,currentId:null,isInstantPhase:!1}),s=_.useRef(null),a=_.useCallback(e=>{o({currentId:e})},[]);return hs(()=>{i.currentId?null===s.current?s.current=i.currentId:i.isInstantPhase||o({isInstantPhase:!0}):(i.isInstantPhase&&o({isInstantPhase:!1}),s.current=null)},[i.currentId,i.isInstantPhase]),w.jsx(Une.Provider,{value:_.useMemo(()=>({...i,setState:o,setCurrentId:a}),[i,a]),children:t})}function D6e(e,t){void 0===t&&(t={});const{open:n,onOpenChange:r,floatingId:i}=e,{id:o,enabled:s=!0}=t,a=o??i,l=O6e(),{currentId:c,setCurrentId:u,initialDelay:d,setState:h,timeoutMs:p}=l;return hs(()=>{s&&c&&(h({delay:{open:1,close:yw(d,"close")}}),c!==a&&r(!1))},[s,a,r,h,c,d]),hs(()=>{function e(){r(!1),h({delay:d,currentId:null})}if(s&&c&&!n&&c===a){if(p){const t=window.setTimeout(e,p);return()=>{clearTimeout(t)}}e()}},[s,n,h,c,a,r,d,p]),hs(()=>{s&&(u===RL||!n||u(a))},[s,n,u,a]),l}function E6(e,t){let n=e.filter(e=>{var n;return e.parentId===t&&(null==(n=e.context)?void 0:n.open)}),r=n;for(;r.length;)r=e.filter(e=>{var t;return null==(t=r)?void 0:t.some(t=>{var n;return e.parentId===t.id&&(null==(n=e.context)?void 0:n.open)})}),n=n.concat(r);return n}const jne=()=>({getShadowRoot:!0,displayCheck:"function"==typeof ResizeObserver&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function Fne(e,t){const n=Sne(e,jne());"prev"===t&&n.reverse();const r=n.indexOf(SL(Kd(e)));return n.slice(r+1)[0]}function N6e(){return Fne(document.body,"next")}function U6e(){return Fne(document.body,"prev")}function w6(e,t){const n=t||e.currentTarget,r=e.relatedTarget;return!r||!cv(n,r)}function j6e(e){Sne(e,jne()).forEach(e=>{e.dataset.tabindex=e.getAttribute("tabindex")||"",e.setAttribute("tabindex","-1")})}function GV(e){e.querySelectorAll("[data-tabindex]").forEach(e=>{const t=e.dataset.tabindex;delete e.dataset.tabindex,t?e.setAttribute("tabindex",t):e.removeAttribute("tabindex")})}const $ne={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0};let F6e;function KV(e){"Tab"===e.key&&(e.target,clearTimeout(F6e))}const zV=_.forwardRef(function(e,t){const[n,r]=_.useState();hs(()=>(mne()&&r("button"),document.addEventListener("keydown",KV),()=>{document.removeEventListener("keydown",KV)}),[]);const i={ref:t,tabIndex:0,role:n,"aria-hidden":!n||void 0,[__("focus-guard")]:"",style:$ne};return w.jsx("span",{...e,...i})}),Bne=_.createContext(null),WV=__("portal");function $6e(e){void 0===e&&(e={});const{id:t,root:n}=e,r=lv(),i=H6e(),[o,s]=_.useState(null),a=_.useRef(null);return hs(()=>()=>{null==o||o.remove(),queueMicrotask(()=>{a.current=null})},[o]),hs(()=>{if(!r||a.current)return;const e=t?document.getElementById(t):null;if(!e)return;const n=document.createElement("div");n.id=r,n.setAttribute(WV,""),e.appendChild(n),a.current=n,s(n)},[t,r]),hs(()=>{if(null===n||!r||a.current)return;let e=n||(null==i?void 0:i.portalNode);e&&!Dn(e)&&(e=e.current),e=e||document.body;let o=null;t&&(o=document.createElement("div"),o.id=t,e.appendChild(o));const l=document.createElement("div");l.id=r,l.setAttribute(WV,""),e=o||e,e.appendChild(l),a.current=l,s(l)},[t,n,r,i]),o}function B6e(e){const{children:t,id:n,root:r,preserveTabOrder:i=!0}=e,o=$6e({id:n,root:r}),[s,a]=_.useState(null),l=_.useRef(null),c=_.useRef(null),u=_.useRef(null),d=_.useRef(null),h=null==s?void 0:s.modal,p=null==s?void 0:s.open,f=!!s&&!s.modal&&s.open&&i&&!(!r&&!o);return _.useEffect(()=>{if(o&&i&&!h)return o.addEventListener("focusin",e,!0),o.addEventListener("focusout",e,!0),()=>{o.removeEventListener("focusin",e,!0),o.removeEventListener("focusout",e,!0)};function e(e){o&&w6(e)&&("focusin"===e.type?GV:j6e)(o)}},[o,i,h]),_.useEffect(()=>{o&&(p||GV(o))},[p,o]),w.jsxs(Bne.Provider,{value:_.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:l,afterOutsideRef:c,beforeInsideRef:u,afterInsideRef:d,portalNode:o,setFocusManagerState:a}),[i,o]),children:[f&&o&&w.jsx(zV,{"data-type":"outside",ref:l,onFocus:e=>{if(w6(e,o)){var t;null==(t=u.current)||t.focus()}else{const e=U6e()||(null==s?void 0:s.domReference);null==e||e.focus()}}}),f&&o&&w.jsx("span",{"aria-owns":o.id,style:$ne}),o&&jv.createPortal(t,o),f&&o&&w.jsx(zV,{"data-type":"outside",ref:c,onFocus:e=>{if(w6(e,o)){var t;null==(t=d.current)||t.focus()}else{const t=N6e()||(null==s?void 0:s.domReference);null==t||t.focus(),null!=s&&s.closeOnFocusOut&&(null==s||s.onOpenChange(!1,e.nativeEvent,"focus-out"))}}})]})}const H6e=()=>_.useContext(Bne),V6e="data-floating-ui-focusable",q6e={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},G6e={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},YV=e=>{var t,n;return{escapeKey:"boolean"==typeof e?e:null!=(t=null==e?void 0:e.escapeKey)&&t,outsidePress:"boolean"==typeof e?e:null==(n=null==e?void 0:e.outsidePress)||n}};function K6e(e,t){void 0===t&&(t={});const{open:n,onOpenChange:r,elements:i,dataRef:o}=e,{enabled:s=!0,escapeKey:a=!0,outsidePress:l=!0,outsidePressEvent:c="pointerdown",referencePress:u=!1,referencePressEvent:d="pointerdown",ancestorScroll:h=!1,bubbles:p,capture:f}=t,m=QO(),v=au("function"==typeof l?l:()=>!1),g="function"==typeof l?v:l,y=_.useRef(!1),b=_.useRef(!1),{escapeKey:w,outsidePress:S}=YV(p),{escapeKey:E,outsidePress:C}=YV(f),k=_.useRef(!1),T=au(e=>{var t;if(!n||!s||!a||"Escape"!==e.key||k.current)return;const i=null==(t=o.current.floatingContext)?void 0:t.nodeId,l=m?E6(m.nodesRef.current,i):[];if(!w&&(e.stopPropagation(),l.length>0)){let e=!0;if(l.forEach(t=>{var n;null==(n=t.context)||!n.open||t.context.dataRef.current.__escapeKeyBubbles||(e=!1)}),!e)return}r(!1,fke(e)?e.nativeEvent:e,"escape-key")}),R=au(e=>{var t;const n=()=>{var t;T(e),null==(t=Jm(e))||t.removeEventListener("keydown",n)};null==(t=Jm(e))||t.addEventListener("keydown",n)}),I=au(e=>{var t;const n=y.current;y.current=!1;const s=b.current;if(b.current=!1,"click"===c&&s||n||"function"==typeof g&&!g(e))return;const a=Jm(e),l="["+__("inert")+"]",u=Kd(i.floating).querySelectorAll(l);let d=Dn(a)?a:null;for(;d&&!yu(d);){const e=Pu(d);if(yu(e)||!Dn(e))break;d=e}if(u.length&&Dn(a)&&!hke(a)&&!cv(a,i.floating)&&Array.from(u).every(e=>!cv(d,e)))return;if(To(a)&&L){const t=yu(a),n=Ro(a),r=/auto|scroll/,i=t||r.test(n.overflowX),o=t||r.test(n.overflowY),s=i&&a.clientWidth>0&&a.scrollWidth>a.clientWidth,l=o&&a.clientHeight>0&&a.scrollHeight>a.clientHeight,c="rtl"===n.direction,u=l&&(c?e.offsetX<=a.offsetWidth-a.clientWidth:e.offsetX>a.clientWidth),d=s&&e.offsetY>a.clientHeight;if(u||d)return}const h=null==(t=o.current.floatingContext)?void 0:t.nodeId,p=m&&E6(m.nodesRef.current,h).some(t=>{var n;return y6(e,null==(n=t.context)?void 0:n.elements.floating)});if(y6(e,i.floating)||y6(e,i.domReference)||p)return;const f=m?E6(m.nodesRef.current,h):[];if(f.length>0){let e=!0;if(f.forEach(t=>{var n;null==(n=t.context)||!n.open||t.context.dataRef.current.__outsidePressBubbles||(e=!1)}),!e)return}r(!1,e,"outside-press")}),x=au(e=>{var t;const n=()=>{var t;I(e),null==(t=Jm(e))||t.removeEventListener(c,n)};null==(t=Jm(e))||t.addEventListener(c,n)});_.useEffect(()=>{if(!n||!s)return;o.current.__escapeKeyBubbles=w,o.current.__outsidePressBubbles=S;let e=-1;function t(e){r(!1,e,"ancestor-scroll")}function l(){window.clearTimeout(e),k.current=!0}function u(){e=window.setTimeout(()=>{k.current=!1},ST()?5:0)}const d=Kd(i.floating);a&&(d.addEventListener("keydown",E?R:T,E),d.addEventListener("compositionstart",l),d.addEventListener("compositionend",u)),g&&d.addEventListener(c,C?x:I,C);let p=[];return h&&(Dn(i.domReference)&&(p=rf(i.domReference)),Dn(i.floating)&&(p=p.concat(rf(i.floating))),!Dn(i.reference)&&i.reference&&i.reference.contextElement&&(p=p.concat(rf(i.reference.contextElement)))),p=p.filter(e=>{var t;return e!==(null==(t=d.defaultView)?void 0:t.visualViewport)}),p.forEach(e=>{e.addEventListener("scroll",t,{passive:!0})}),()=>{a&&(d.removeEventListener("keydown",E?R:T,E),d.removeEventListener("compositionstart",l),d.removeEventListener("compositionend",u)),g&&d.removeEventListener(c,C?x:I,C),p.forEach(e=>{e.removeEventListener("scroll",t)}),window.clearTimeout(e)}},[o,i,a,g,c,n,r,h,s,w,S,T,E,R,I,C,x]),_.useEffect(()=>{y.current=!1},[g,c]);const P=_.useMemo(()=>({onKeyDown:T,...u&&{[q6e[d]]:e=>{r(!1,e.nativeEvent,"reference-press")},..."click"!==d&&{onClick(e){r(!1,e.nativeEvent,"reference-press")}}}}),[T,r,u,d]),L=_.useMemo(()=>({onKeyDown:T,onMouseDown(){b.current=!0},onMouseUp(){b.current=!0},[G6e[c]]:()=>{y.current=!0}}),[T,c]);return _.useMemo(()=>s?{reference:P,floating:L}:{},[s,P,L])}function z6e(e){const{open:t=!1,onOpenChange:n,elements:r}=e,i=lv(),o=_.useRef({}),[s]=_.useState(()=>x6e()),a=null!=JO(),[l,c]=_.useState(r.reference),u=au((e,t,r)=>{o.current.openEvent=e?t:void 0,s.emit("openchange",{open:e,event:t,reason:r,nested:a}),null==n||n(e,t,r)}),d=_.useMemo(()=>({setPositionReference:c}),[]),h=_.useMemo(()=>({reference:l||r.reference||null,floating:r.floating||null,domReference:r.reference}),[l,r.reference,r.floating]);return _.useMemo(()=>({dataRef:o,open:t,onOpenChange:u,elements:h,events:s,floatingId:i,refs:d}),[t,u,h,s,i,d])}function W6e(e){void 0===e&&(e={});const{nodeId:t}=e,n=z6e({...e,elements:{reference:null,floating:null,...e.elements}}),r=e.rootContext||n,i=r.elements,[o,s]=_.useState(null),[a,l]=_.useState(null),c=(null==i?void 0:i.domReference)||o,u=_.useRef(null),d=QO();hs(()=>{c&&(u.current=c)},[c]);const h=Ane({...e,elements:{...i,...a&&{reference:a}}}),p=_.useCallback(e=>{const t=Dn(e)?{getBoundingClientRect:()=>e.getBoundingClientRect(),contextElement:e}:e;l(t),h.refs.setReference(t)},[h.refs]),f=_.useCallback(e=>{(Dn(e)||null===e)&&(u.current=e,s(e)),(Dn(h.refs.reference.current)||null===h.refs.reference.current||null!==e&&!Dn(e))&&h.refs.setReference(e)},[h.refs]),m=_.useMemo(()=>({...h.refs,setReference:f,setPositionReference:p,domReference:u}),[h.refs,f,p]),v=_.useMemo(()=>({...h.elements,domReference:c}),[h.elements,c]),g=_.useMemo(()=>({...h,...r,refs:m,elements:v,nodeId:t}),[h,m,v,t,r]);return hs(()=>{r.dataRef.current.floatingContext=g;const e=null==d?void 0:d.nodesRef.current.find(e=>e.id===t);e&&(e.context=g)}),_.useMemo(()=>({...h,context:g,refs:m,elements:v}),[h,m,v,g])}function Y6e(e,t){void 0===t&&(t={});const{open:n,onOpenChange:r,events:i,dataRef:o,elements:s}=e,{enabled:a=!0,visibleOnly:l=!0}=t,c=_.useRef(!1),u=_.useRef(),d=_.useRef(!0);_.useEffect(()=>{if(!a)return;const e=Hs(s.domReference);function t(){!n&&To(s.domReference)&&s.domReference===SL(Kd(s.domReference))&&(c.current=!0)}function r(){d.current=!0}return e.addEventListener("blur",t),e.addEventListener("keydown",r,!0),()=>{e.removeEventListener("blur",t),e.removeEventListener("keydown",r,!0)}},[s.domReference,n,a]),_.useEffect(()=>{if(a)return i.on("openchange",e),()=>{i.off("openchange",e)};function e(e){let{reason:t}=e;("reference-press"===t||"escape-key"===t)&&(c.current=!0)}},[i,a]),_.useEffect(()=>()=>{clearTimeout(u.current)},[]);const h=_.useMemo(()=>({onPointerDown(e){lke(e.nativeEvent)||(d.current=!1)},onMouseLeave(){c.current=!1},onFocus(e){if(c.current)return;const t=Jm(e.nativeEvent);if(l&&Dn(t))try{if(mne()&&uke())throw Error();if(!t.matches(":focus-visible"))return}catch{if(!d.current&&!mke(t))return}r(!0,e.nativeEvent,"focus")},onBlur(e){c.current=!1;const t=e.relatedTarget,n=e.nativeEvent,i=Dn(t)&&t.hasAttribute(__("focus-guard"))&&"outside"===t.getAttribute("data-type");u.current=window.setTimeout(()=>{var e;const a=SL(s.domReference?s.domReference.ownerDocument:document);!t&&a===s.domReference||cv(null==(e=o.current.floatingContext)?void 0:e.refs.floating.current,a)||cv(s.domReference,a)||i||r(!1,n,"focus")})}}),[o,s.domReference,r,l]);return _.useMemo(()=>a?{reference:h}:{},[a,h])}const XV="active",JV="selected";function C6(e,t,n){const r=new Map,i="item"===n;let o=e;if(i&&e){const{[XV]:t,[JV]:n,...r}=e;o=r}return{..."floating"===n&&{tabIndex:-1,[V6e]:""},...o,...t.map(t=>{const r=t?t[n]:null;return"function"==typeof r?e?r(e):null:r}).concat(e).reduce((e,t)=>(t&&Object.entries(t).forEach(t=>{let[n,o]=t;if(!i||![XV,JV].includes(n))if(0===n.indexOf("on")){var s;if(r.has(n)||r.set(n,[]),"function"==typeof o)null==(s=r.get(n))||s.push(o),e[n]=function(){for(var e,t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return null==(e=r.get(n))?void 0:e.map(e=>e(...i)).find(e=>void 0!==e)}}else e[n]=o}),e),{})}}function X6e(e){void 0===e&&(e=[]);const t=e.map(e=>null==e?void 0:e.reference),n=e.map(e=>null==e?void 0:e.floating),r=e.map(e=>null==e?void 0:e.item),i=_.useCallback(t=>C6(t,e,"reference"),t),o=_.useCallback(t=>C6(t,e,"floating"),n),s=_.useCallback(t=>C6(t,e,"item"),r);return _.useMemo(()=>({getReferenceProps:i,getFloatingProps:o,getItemProps:s}),[i,o,s])}const J6e=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function Q6e(e,t){var n;void 0===t&&(t={});const{open:r,floatingId:i}=e,{enabled:o=!0,role:s="dialog"}=t,a=null!=(n=J6e.get(s))?n:s,l=lv(),c=null!=JO(),u=_.useMemo(()=>"tooltip"===a||"label"===s?{["aria-"+("label"===s?"labelledby":"describedby")]:r?i:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":"alertdialog"===a?"dialog":a,"aria-controls":r?i:void 0,..."listbox"===a&&{role:"combobox"},..."menu"===a&&{id:l},..."menu"===a&&c&&{role:"menuitem"},..."select"===s&&{"aria-autocomplete":"none"},..."combobox"===s&&{"aria-autocomplete":"list"}},[a,i,c,r,l,s]),d=_.useMemo(()=>{const e={id:i,...a&&{role:a}};return"tooltip"===a||"label"===s?e:{...e,..."menu"===a&&{"aria-labelledby":l}}},[a,i,l,s]),h=_.useCallback(e=>{let{active:t,selected:n}=e;const r={role:"option",...t&&{id:i+"-option"}};switch(s){case"select":return{...r,"aria-selected":t&&n};case"combobox":return{...r,...t&&{"aria-selected":!0}}}return{}},[i,s]);return _.useMemo(()=>o?{reference:u,floating:d,item:h}:{},[o,u,d,h])}const Z6e="_tooltip_6ode6_8",exe="_invisible_6ode6_21",txe="_caption_6ode6_28",nxe="_arrow_6ode6_33",bw={tooltip:Z6e,invisible:exe,caption:txe,arrow:nxe},Hne={open:300,close:0},Vne=({children:e})=>w.jsx(M6e,{delay:Hne,timeoutMs:300,children:e});function rxe({open:e,disabled:t=!1,onOpenChange:n,placement:r="bottom",isTriggerInteractive:i,caption:o,"aria-atomic":s,"aria-live":a,...l}){const c=lv(),u=lv(),d=_.useRef(null),[h,p]=_.useState(!1),f=!t&&(e??h),m=(t,r,i)=>{null==n||n(t,r,i),void 0===e&&p(t)},v=W6e({placement:r,open:f,onOpenChange:m,whileElementsMounted:kne,middleware:[Lne(6),One({crossAxis:r.includes("-"),fallbackAxisSideDirection:"start",padding:5}),Pne({padding:5}),Mne({element:d})]}),g=v.context,{delay:y,initialDelay:b}=D6e(g);if(b!==Hne)throw new Error("Tooltips must be wrapped in a global <TooltipProvider>");const w=P6e(g,{move:!1,enabled:void 0===e,delay:i?y:{},mouseOnly:!0}),S=Y6e(g,{enabled:void 0===e}),E=_.useRef(void 0);_.useEffect(()=>()=>window.clearTimeout(E.current),[]);const C=_.useMemo(()=>{const e=()=>{void 0===E.current?E.current=window.setTimeout(()=>{m(!1),E.current=void 0},1500):window.clearTimeout(E.current)};return{reference:{onTouchStart:()=>{void 0!==E.current&&window.clearTimeout(E.current),E.current=window.setTimeout(()=>{m(!0),E.current=void 0},500)},onTouchEnd:e,onTouchCancel:e}}},[]),k=K6e(g),T="label"in l?"label":"description",R=Q6e(g,{enabled:"description"===T,role:"tooltip"}),I=X6e([w,S,C,k,R,_.useMemo(()=>"label"===T?{reference:{"aria-labelledby":c,"aria-describedby":o?u:void 0}}:{},[T,c,u])]);return _.useMemo(()=>({labelId:c,captionId:o?u:void 0,caption:o,purpose:T,open:f,setOpen:m,tooltipProps:{"aria-atomic":s,"aria-live":a},...I,...v,arrowRef:d}),[c,u,o,R,f,m,I,v,d])}Vne.displayName="TooltipProvider";const ixe=e=>"label"in e&&!!e.label;function Fi({children:e,isTriggerInteractive:t=!0,nonInteractiveTriggerTabIndex:n=0,...r}){const i=rxe({isTriggerInteractive:t,...r});return w.jsxs(une.Provider,{value:i,children:[w.jsx(axe,{isTriggerInteractive:t,nonInteractiveTriggerTabIndex:n,children:e}),w.jsxs(oxe,{children:[w.jsx("span",{id:i.labelId,children:ixe(r)?r.label:r.description}),w.jsx(sxe,{})]})]})}function sxe(){const{caption:e,captionId:t}=qO();if(!e)return null;const n="string"==typeof e?"span":"div";return w.jsx(n,{id:t,className:Ne(bw.caption,"cpd-theme-dark"),children:e})}function oxe({children:e}){const{context:t,open:n,arrowRef:r,purpose:i,...o}=qO();return n||"label"===i?w.jsx(B6e,{children:w.jsxs("div",{ref:o.refs.setFloating,style:o.floatingStyles,...o.tooltipProps,...o.getFloatingProps(),className:Ne(bw.tooltip,{[bw.invisible]:"label"===i&&!n}),children:[w.jsx(k6e,{ref:r,context:t,width:10,height:6,className:bw.arrow}),e]})}):null}const axe=({children:e,isTriggerInteractive:t,nonInteractiveTriggerTabIndex:n})=>{const r=qO(),i=null==e?void 0:e.ref,o=Dne([r.refs.setReference,i]),s=_.useMemo(()=>{if(_.isValidElement(e)){if(t){const t=r.getReferenceProps({..."object"==typeof e.props?e.props:{},ref:o});return _.cloneElement(e,t)}{const t=r.getReferenceProps({ref:o,tabIndex:n}),{"aria-labelledby":i,"aria-describedby":s,...a}=t;return w.jsx("span",{tabIndex:n,...a,children:_.cloneElement(e,{"aria-labelledby":i,"aria-describedby":s})})}}},[r,o,e]);if(!s)throw new Error("Tooltip anchor must be a single valid React element");return s},wT=_.forwardRef(function({kind:e="primary",children:t,className:n,indicator:r,size:i="32px",style:o,disabled:s,destructive:a,tooltip:l,noBackground:c=!1,...u},d){const h=Ne(v6["icon-button"],n,{[v6.destructive]:a,[v6["no-background"]]:c}),p=w.jsx(lne,{as:"button",ref:d,className:h,style:{"--cpd-icon-button-size":i,...o},disabled:s,...u,"data-indicator":r,"data-kind":e,children:w.jsx(oke,{indicator:r,colour:s?"var(--cpd-color-icon-disabled)":void 0,children:Te.Children.only(t)})});return l?w.jsx(Fi,{label:l,children:p}):p}),cxe=({type:e,title:t,children:n,className:r,actions:i,onClose:o,...s})=>{const a=Ne(Pm.alert,r),l=_.useCallback(t=>{switch(e){case"critical":return w.jsx(vT,{...t});case"info":return w.jsx(QIe,{...t});case"success":return w.jsx(JIe,{...t})}},[e]);return w.jsxs("div",{...s,className:a,"data-type":e,children:[l({width:24,height:24,className:Pm.icon,"aria-hidden":!0}),w.jsxs("div",{className:Pm.content,children:[w.jsxs("div",{className:Pm["text-content"],children:[w.jsx(on,{size:"md",weight:"semibold",children:t}),w.jsx(on,{size:"sm",weight:"regular",children:n})]}),i&&w.jsx("div",{className:Pm.actions,children:i})]}),o&&w.jsx(wT,{onClick:o,"aria-label":"Close",role:"button",className:Pm.close,children:w.jsx(yT,{})})]})},lxe="@",uxe="#",dxe="+",fxe=new Intl.Segmenter;function hxe(e){if(e.length<1)return"";const t=e[0];[lxe,uxe,dxe].includes(t)&&(e=e.substring(1));const n=fxe.segment(e)[Symbol.iterator]().next();return n.done?"":n.value.segment}const pxe="_avatar_1qbcf_8",mxe="_image_1qbcf_41",T6={avatar:pxe,image:mxe,"avatar-imageless":"_avatar-imageless_1qbcf_52"};function gxe(e){return e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%6+1}function vxe(e){return!!(e.onClick||e.onKeyDown||e.onKeyUp)}const yxe=_.forwardRef(function({src:e,id:t,name:n="",type:r="round",className:i="",size:o,style:s={},onError:a,...l},c){return Te.createElement(vxe(l)?"button":"span",{ref:c,role:"img","aria-label":t,...l,"data-type":r,"data-color":gxe(t),className:Ne(T6.avatar,i,{[T6["avatar-imageless"]]:!e}),style:{...s,"--cpd-avatar-size":o}},w.jsx(Te.Fragment,{children:e?w.jsx("img",{loading:"lazy",alt:"",src:e,referrerPolicy:"no-referrer",className:Ne(T6.image),"data-type":r,style:s,width:o,height:o,onError:a}):hxe(n)}))});function Ct(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}function Tp(e,t=[]){let n=[];const r=()=>{const t=n.map(e=>_.createContext(e));return function(n){const r=(null==n?void 0:n[e])||t;return _.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){const i=_.createContext(r),o=n.length;n=[...n,r];const s=t=>{var n;const{scope:r,children:s,...a}=t,l=(null==(n=null==r?void 0:r[e])?void 0:n[o])||i,c=_.useMemo(()=>a,Object.values(a));return w.jsx(l.Provider,{value:c,children:s})};return s.displayName=t+"Provider",[s,function(n,s){var a;const l=(null==(a=null==s?void 0:s[e])?void 0:a[o])||i,c=_.useContext(l);if(c)return c;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},bxe(r,...t)]}function bxe(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return _.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}function QV(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function CT(...e){return t=>{let n=!1;const r=e.map(e=>{const r=QV(e,t);return!n&&"function"==typeof r&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():QV(e[t],null)}}}}function ps(...e){return _.useCallback(CT(...e),e)}var uv=_.forwardRef((e,t)=>{const{children:n,...r}=e,i=_.Children.toArray(n),o=i.find(Sxe);if(o){const e=o.props.children,n=i.map(t=>t===o?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t);return w.jsx(IL,{...r,ref:t,children:_.isValidElement(e)?_.cloneElement(e,void 0,n):null})}return w.jsx(IL,{...r,ref:t,children:n})});uv.displayName="Slot";var IL=_.forwardRef((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=wxe(n);return _.cloneElement(n,{...Exe(r,n.props),ref:t?CT(t,e):e})}return _.Children.count(n)>1?_.Children.only(null):null});IL.displayName="SlotClone";var _xe=({children:e})=>w.jsx(w.Fragment,{children:e});function Sxe(e){return _.isValidElement(e)&&e.type===_xe}function Exe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function wxe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var Cxe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Ar=Cxe.reduce((e,t)=>{const n=_.forwardRef((e,n)=>{const{asChild:r,...i}=e,o=r?uv:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(o,{...i,ref:n})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function Txe(e,t){e&&jv.flushSync(()=>e.dispatchEvent(t))}function qne(e){const t=e+"CollectionProvider",[n,r]=Tp(t),[i,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e=>{const{scope:t,children:n}=e,r=Te.useRef(null),o=Te.useRef(new Map).current;return w.jsx(i,{scope:t,itemMap:o,collectionRef:r,children:n})};s.displayName=t;const a=e+"CollectionSlot",l=Te.forwardRef((e,t)=>{const{scope:n,children:r}=e,i=ps(t,o(a,n).collectionRef);return w.jsx(uv,{ref:i,children:r})});l.displayName=a;const c=e+"CollectionItemSlot",u="data-radix-collection-item",d=Te.forwardRef((e,t)=>{const{scope:n,children:r,...i}=e,s=Te.useRef(null),a=ps(t,s),l=o(c,n);return Te.useEffect(()=>(l.itemMap.set(s,{ref:s,...i}),()=>{l.itemMap.delete(s)})),w.jsx(uv,{[u]:"",ref:a,children:r})});return d.displayName=c,[{Provider:s,Slot:l,ItemSlot:d},function(t){const n=o(e+"CollectionConsumer",t);return Te.useCallback(()=>{const e=n.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${u}]`));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])},r]}var Rxe=_.createContext(void 0);function Gne(e){const t=_.useContext(Rxe);return e||t||"ltr"}function R6(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}function ZV(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function Kne(...e){return t=>{let n=!1;const r=e.map(e=>{const r=ZV(e,t);return!n&&"function"==typeof r&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():ZV(e[t],null)}}}}function zne(...e){return _.useCallback(Kne(...e),e)}function Ixe(e){const t=kxe(e),n=_.forwardRef((e,n)=>{const{children:r,...i}=e,o=_.Children.toArray(r),s=o.find(Axe);if(s){const e=s.props.children,r=o.map(t=>t===s?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t);return w.jsx(t,{...i,ref:n,children:_.isValidElement(e)?_.cloneElement(e,void 0,r):null})}return w.jsx(t,{...i,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function kxe(e){const t=_.forwardRef((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=Pxe(n),i=Lxe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Kne(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var xxe=Symbol("radix.slottable");function Axe(e){return _.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===xxe}function Lxe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{const t=o(...e);return i(...e),t}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function Pxe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var Oxe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Wne=Oxe.reduce((e,t)=>{const n=Ixe(`Primitive.${t}`),r=_.forwardRef((e,r)=>{const{asChild:i,...o}=e,s=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(s,{...o,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function Mxe(e,t){e&&jv.flushSync(()=>e.dispatchEvent(t))}function Yne(e){const t=_.useRef(e);return _.useEffect(()=>{t.current=e}),_.useMemo(()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)},[])}function Dxe(e){const t=_.useRef(e);return _.useEffect(()=>{t.current=e}),_.useMemo(()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)},[])}function Nxe(e,t=(null==globalThis?void 0:globalThis.document)){const n=Dxe(e);_.useEffect(()=>{const e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[n,t])}var eq,Uxe="DismissableLayer",kL="dismissableLayer.update",jxe="dismissableLayer.pointerDownOutside",Fxe="dismissableLayer.focusOutside",Xne=_.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ZO=_.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:o,onInteractOutside:s,onDismiss:a,...l}=e,c=_.useContext(Xne),[u,d]=_.useState(null),h=(null==u?void 0:u.ownerDocument)??(null==globalThis?void 0:globalThis.document),[,p]=_.useState({}),f=zne(t,e=>d(e)),m=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),g=m.indexOf(v),y=u?m.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,S=y>=g,E=Hxe(e=>{const t=e.target,n=[...c.branches].some(e=>e.contains(t));!S||n||(null==i||i(e),null==s||s(e),e.defaultPrevented||null==a||a())},h),C=Vxe(e=>{const t=e.target;[...c.branches].some(e=>e.contains(t))||(null==o||o(e),null==s||s(e),e.defaultPrevented||null==a||a())},h);return Nxe(e=>{y===c.layers.size-1&&(null==r||r(e),!e.defaultPrevented&&a&&(e.preventDefault(),a()))},h),_.useEffect(()=>{if(u)return n&&(0===c.layersWithOutsidePointerEventsDisabled.size&&(eq=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),tq(),()=>{n&&1===c.layersWithOutsidePointerEventsDisabled.size&&(h.body.style.pointerEvents=eq)}},[u,h,n,c]),_.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),tq())},[u,c]),_.useEffect(()=>{const e=()=>p({});return document.addEventListener(kL,e),()=>document.removeEventListener(kL,e)},[]),w.jsx(Wne.div,{...l,ref:f,style:{pointerEvents:b?S?"auto":"none":void 0,...e.style},onFocusCapture:R6(e.onFocusCapture,C.onFocusCapture),onBlurCapture:R6(e.onBlurCapture,C.onBlurCapture),onPointerDownCapture:R6(e.onPointerDownCapture,E.onPointerDownCapture)})});ZO.displayName=Uxe;var $xe="DismissableLayerBranch",Bxe=_.forwardRef((e,t)=>{const n=_.useContext(Xne),r=_.useRef(null),i=zne(t,r);return _.useEffect(()=>{const e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),w.jsx(Wne.div,{...e,ref:i})});function Hxe(e,t=(null==globalThis?void 0:globalThis.document)){const n=Yne(e),r=_.useRef(!1),i=_.useRef(()=>{});return _.useEffect(()=>{const e=e=>{if(e.target&&!r.current){let r=function(){Jne(jxe,n,o,{discrete:!0})};const o={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",i.current),i.current=r,t.addEventListener("click",i.current,{once:!0})):r()}else t.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",e),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function Vxe(e,t=(null==globalThis?void 0:globalThis.document)){const n=Yne(e),r=_.useRef(!1);return _.useEffect(()=>{const e=e=>{e.target&&!r.current&&Jne(Fxe,n,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function tq(){const e=new CustomEvent(kL);document.dispatchEvent(e)}function Jne(e,t,n,{discrete:r}){const i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?Mxe(i,o):i.dispatchEvent(o)}Bxe.displayName=$xe;var I6=0;function Qne(){_.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??nq()),document.body.insertAdjacentElement("beforeend",e[1]??nq()),I6++,()=>{1===I6&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),I6--}},[])}function nq(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}function Du(e){const t=_.useRef(e);return _.useEffect(()=>{t.current=e}),_.useMemo(()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)},[])}var k6="focusScope.autoFocusOnMount",x6="focusScope.autoFocusOnUnmount",rq={bubbles:!1,cancelable:!0},qxe="FocusScope",Zne=_.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=e,[a,l]=_.useState(null),c=Du(i),u=Du(o),d=_.useRef(null),h=ps(t,e=>l(e)),p=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let e=function(e){if(p.paused||!a)return;const t=e.target;a.contains(t)?d.current=t:Ad(d.current,{select:!0})},t=function(e){if(p.paused||!a)return;const t=e.relatedTarget;null!==t&&(a.contains(t)||Ad(d.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&Ad(a)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(n);return a&&r.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}},[r,a,p.paused]),_.useEffect(()=>{if(a){sq.add(p);const e=document.activeElement;if(!a.contains(e)){const t=new CustomEvent(k6,rq);a.addEventListener(k6,c),a.dispatchEvent(t),t.defaultPrevented||(Gxe(Xxe(ere(a)),{select:!0}),document.activeElement===e&&Ad(a))}return()=>{a.removeEventListener(k6,c),setTimeout(()=>{const t=new CustomEvent(x6,rq);a.addEventListener(x6,u),a.dispatchEvent(t),t.defaultPrevented||Ad(e??document.body,{select:!0}),a.removeEventListener(x6,u),sq.remove(p)},0)}}},[a,c,u,p]);const f=_.useCallback(e=>{if(!n&&!r||p.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){const t=e.currentTarget,[r,o]=Kxe(t);r&&o?e.shiftKey||i!==o?e.shiftKey&&i===r&&(e.preventDefault(),n&&Ad(o,{select:!0})):(e.preventDefault(),n&&Ad(r,{select:!0})):i===t&&e.preventDefault()}},[n,r,p.paused]);return w.jsx(Ar.div,{tabIndex:-1,...s,ref:h,onKeyDown:f})});function Gxe(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Ad(r,{select:t}),document.activeElement!==n)return}function Kxe(e){const t=ere(e);return[iq(t,e),iq(t.reverse(),e)]}function ere(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function iq(e,t){for(const n of e)if(!zxe(n,{upTo:t}))return n}function zxe(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function Wxe(e){return e instanceof HTMLInputElement&&"select"in e}function Ad(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&Wxe(e)&&t&&e.select()}}Zne.displayName=qxe;var sq=Yxe();function Yxe(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=oq(e,t),e.unshift(t)},remove(t){var n;e=oq(e,t),null==(n=e[0])||n.resume()}}}function oq(e,t){const n=[...e],r=n.indexOf(t);return-1!==r&&n.splice(r,1),n}function Xxe(e){return e.filter(e=>"A"!==e.tagName)}var Jxe=null!=globalThis&&globalThis.document?_.useLayoutEffect:()=>{},Qxe=c_.useId||(()=>{}),Zxe=0;function dv(e){const[t,n]=_.useState(Qxe());return Jxe(()=>{n(e=>e??String(Zxe++))},[e]),e||(t?`radix-${t}`:"")}var e5e="Arrow",tre=_.forwardRef((e,t)=>{const{children:n,width:r=10,height:i=5,...o}=e;return w.jsx(Ar.svg,{...o,ref:t,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:w.jsx("polygon",{points:"0,0 30,0 15,10"})})});tre.displayName=e5e;var t5e=tre,xL=null!=globalThis&&globalThis.document?_.useLayoutEffect:()=>{};function n5e(e){const[t,n]=_.useState(void 0);return xL(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver(t=>{if(!Array.isArray(t)||!t.length)return;const r=t[0];let i,o;if("borderBoxSize"in r){const e=r.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,o=t.blockSize}else i=e.offsetWidth,o=e.offsetHeight;n({width:i,height:o})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}var eM="Popper",[nre,rre]=Tp(eM),[r5e,ire]=nre(eM),sre=e=>{const{__scopePopper:t,children:n}=e,[r,i]=_.useState(null);return w.jsx(r5e,{scope:t,anchor:r,onAnchorChange:i,children:n})};sre.displayName=eM;var ore="PopperAnchor",are=_.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...i}=e,o=ire(ore,n),s=_.useRef(null),a=ps(t,s);return _.useEffect(()=>{o.onAnchorChange((null==r?void 0:r.current)||s.current)}),r?null:w.jsx(Ar.div,{...i,ref:a})});are.displayName=ore;var tM="PopperContent",[i5e,s5e]=nre(tM),cre=_.forwardRef((e,t)=>{var n,r,i,o,s,a;const{__scopePopper:l,side:c="bottom",sideOffset:u=0,align:d="center",alignOffset:h=0,arrowPadding:p=0,avoidCollisions:f=!0,collisionBoundary:m=[],collisionPadding:v=0,sticky:g="partial",hideWhenDetached:y=!1,updatePositionStrategy:b="optimized",onPlaced:S,...E}=e,C=ire(tM,l),[k,T]=_.useState(null),R=ps(t,e=>T(e)),[I,x]=_.useState(null),P=n5e(I),L=(null==P?void 0:P.width)??0,M=(null==P?void 0:P.height)??0,O=c+("center"!==d?"-"+d:""),A="number"==typeof v?v:{top:0,right:0,bottom:0,left:0,...v},D=Array.isArray(m)?m:[m],N=D.length>0,j={padding:A,boundary:D.filter(a5e),altBoundary:N},{refs:F,floatingStyles:U,placement:B,isPositioned:H,middlewareData:$}=Ane({strategy:"fixed",placement:O,whileElementsMounted:(...e)=>kne(...e,{animationFrame:"always"===b}),elements:{reference:C.anchor},middleware:[Lne({mainAxis:u+M,alignmentAxis:h}),f&&Pne({mainAxis:!0,crossAxis:!1,limiter:"partial"===g?_6e():void 0,...j}),f&&One({...j}),S6e({...j,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{const{width:i,height:o}=t.reference,s=e.floating.style;s.setProperty("--radix-popper-available-width",`${n}px`),s.setProperty("--radix-popper-available-height",`${r}px`),s.setProperty("--radix-popper-anchor-width",`${i}px`),s.setProperty("--radix-popper-anchor-height",`${o}px`)}}),I&&Mne({element:I,padding:p}),c5e({arrowWidth:L,arrowHeight:M}),y&&E6e({strategy:"referenceHidden",...j})]}),[V,q]=dre(B),G=Du(S);xL(()=>{H&&(null==G||G())},[H,G]);const z=null==(n=$.arrow)?void 0:n.x,K=null==(r=$.arrow)?void 0:r.y,W=0!==(null==(i=$.arrow)?void 0:i.centerOffset),[J,Y]=_.useState();return xL(()=>{k&&Y(window.getComputedStyle(k).zIndex)},[k]),w.jsx("div",{ref:F.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:H?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:J,"--radix-popper-transform-origin":[null==(o=$.transformOrigin)?void 0:o.x,null==(s=$.transformOrigin)?void 0:s.y].join(" "),...(null==(a=$.hide)?void 0:a.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:w.jsx(i5e,{scope:l,placedSide:V,onArrowChange:x,arrowX:z,arrowY:K,shouldHideArrow:W,children:w.jsx(Ar.div,{"data-side":V,"data-align":q,...E,ref:R,style:{...E.style,animation:H?void 0:"none"}})})})});cre.displayName=tM;var lre="PopperArrow",o5e={top:"bottom",right:"left",bottom:"top",left:"right"},ure=_.forwardRef(function(e,t){const{__scopePopper:n,...r}=e,i=s5e(lre,n),o=o5e[i.placedSide];return w.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:w.jsx(t5e,{...r,ref:t,style:{...r.style,display:"block"}})})});function a5e(e){return null!==e}ure.displayName=lre;var c5e=e=>({name:"transformOrigin",options:e,fn(t){var n,r,i;const{placement:o,rects:s,middlewareData:a}=t,l=0!==(null==(n=a.arrow)?void 0:n.centerOffset),c=l?0:e.arrowWidth,u=l?0:e.arrowHeight,[d,h]=dre(o),p={start:"0%",center:"50%",end:"100%"}[h],f=((null==(r=a.arrow)?void 0:r.x)??0)+c/2,m=((null==(i=a.arrow)?void 0:i.y)??0)+u/2;let v="",g="";return"bottom"===d?(v=l?p:`${f}px`,g=-u+"px"):"top"===d?(v=l?p:`${f}px`,g=`${s.floating.height+u}px`):"right"===d?(v=-u+"px",g=l?p:`${m}px`):"left"===d&&(v=`${s.floating.width+u}px`,g=l?p:`${m}px`),{data:{x:v,y:g}}}});function dre(e){const[t,n="center"]=e.split("-");return[t,n]}var l5e=sre,u5e=are,d5e=cre,f5e=ure,AL=null!=globalThis&&globalThis.document?_.useLayoutEffect:()=>{},h5e="Portal",fre=_.forwardRef((e,t)=>{var n;const{container:r,...i}=e,[o,s]=_.useState(!1);AL(()=>s(!0),[]);const a=r||o&&(null==(n=null==globalThis?void 0:globalThis.document)?void 0:n.body);return a?Oee.createPortal(w.jsx(Ar.div,{...i,ref:t}),a):null});function p5e(e,t){return _.useReducer((e,n)=>t[e][n]??e,e)}fre.displayName=h5e;var S_=e=>{const{present:t,children:n}=e,r=m5e(t),i="function"==typeof n?n({present:r.isPresent}):_.Children.only(n),o=ps(r.ref,g5e(i));return"function"==typeof n||r.isPresent?_.cloneElement(i,{ref:o}):null};function m5e(e){const[t,n]=_.useState(),r=_.useRef({}),i=_.useRef(e),o=_.useRef("none"),s=e?"mounted":"unmounted",[a,l]=p5e(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const e=j2(r.current);o.current="mounted"===a?e:"none"},[a]),AL(()=>{const t=r.current,n=i.current;if(n!==e){const r=o.current,s=j2(t);e?l("MOUNT"):"none"===s||"none"===(null==t?void 0:t.display)?l("UNMOUNT"):l(n&&r!==s?"ANIMATION_OUT":"UNMOUNT"),i.current=e}},[e,l]),AL(()=>{if(t){let e;const n=t.ownerDocument.defaultView??window,s=o=>{const s=j2(r.current).includes(o.animationName);if(o.target===t&&s&&(l("ANIMATION_END"),!i.current)){const r=t.style.animationFillMode;t.style.animationFillMode="forwards",e=n.setTimeout(()=>{"forwards"===t.style.animationFillMode&&(t.style.animationFillMode=r)})}},a=e=>{e.target===t&&(o.current=j2(r.current))};return t.addEventListener("animationstart",a),t.addEventListener("animationcancel",s),t.addEventListener("animationend",s),()=>{n.clearTimeout(e),t.removeEventListener("animationstart",a),t.removeEventListener("animationcancel",s),t.removeEventListener("animationend",s)}}l("ANIMATION_END")},[t,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(e=>{e&&(r.current=getComputedStyle(e)),n(e)},[])}}function j2(e){return(null==e?void 0:e.animationName)||"none"}function g5e(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}function hre({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,i]=v5e({defaultProp:t,onChange:n}),o=void 0!==e,s=o?e:r,a=Du(n);return[s,_.useCallback(t=>{if(o){const n="function"==typeof t?t(e):t;n!==e&&a(n)}else i(t)},[o,e,i,a])]}function v5e({defaultProp:e,onChange:t}){const n=_.useState(e),[r]=n,i=_.useRef(r),o=Du(t);return _.useEffect(()=>{i.current!==r&&(o(r),i.current=r)},[r,i,o]),n}S_.displayName="Presence";var A6="rovingFocusGroup.onEntryFocus",y5e={bubbles:!1,cancelable:!0},TT="RovingFocusGroup",[LL,pre,b5e]=qne(TT),[_5e,mre]=Tp(TT,[b5e]),[S5e,E5e]=_5e(TT),gre=_.forwardRef((e,t)=>w.jsx(LL.Provider,{scope:e.__scopeRovingFocusGroup,children:w.jsx(LL.Slot,{scope:e.__scopeRovingFocusGroup,children:w.jsx(w5e,{...e,ref:t})})}));gre.displayName=TT;var w5e=_.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...d}=e,h=_.useRef(null),p=ps(t,h),f=Gne(o),[m=null,v]=hre({prop:s,defaultProp:a,onChange:l}),[g,y]=_.useState(!1),b=Du(c),S=pre(n),E=_.useRef(!1),[C,k]=_.useState(0);return _.useEffect(()=>{const e=h.current;if(e)return e.addEventListener(A6,b),()=>e.removeEventListener(A6,b)},[b]),w.jsx(S5e,{scope:n,orientation:r,dir:f,loop:i,currentTabStopId:m,onItemFocus:_.useCallback(e=>v(e),[v]),onItemShiftTab:_.useCallback(()=>y(!0),[]),onFocusableItemAdd:_.useCallback(()=>k(e=>e+1),[]),onFocusableItemRemove:_.useCallback(()=>k(e=>e-1),[]),children:w.jsx(Ar.div,{tabIndex:g||0===C?-1:0,"data-orientation":r,...d,ref:p,style:{outline:"none",...e.style},onMouseDown:Ct(e.onMouseDown,()=>{E.current=!0}),onFocus:Ct(e.onFocus,e=>{const t=!E.current;if(e.target===e.currentTarget&&t&&!g){const t=new CustomEvent(A6,y5e);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=S().filter(e=>e.focusable);bre([e.find(e=>e.active),e.find(e=>e.id===m),...e].filter(Boolean).map(e=>e.ref.current),u)}}E.current=!1}),onBlur:Ct(e.onBlur,()=>y(!1))})})}),vre="RovingFocusGroupItem",yre=_.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,...s}=e,a=dv(),l=o||a,c=E5e(vre,n),u=c.currentTabStopId===l,d=pre(n),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return _.useEffect(()=>{if(r)return h(),()=>p()},[r,h,p]),w.jsx(LL.ItemSlot,{scope:n,id:l,focusable:r,active:i,children:w.jsx(Ar.span,{tabIndex:u?0:-1,"data-orientation":c.orientation,...s,ref:t,onMouseDown:Ct(e.onMouseDown,e=>{r?c.onItemFocus(l):e.preventDefault()}),onFocus:Ct(e.onFocus,()=>c.onItemFocus(l)),onKeyDown:Ct(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void c.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=R5e(e,c.orientation,c.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=d().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();const r=n.indexOf(e.currentTarget);n=c.loop?I5e(n,r+1):n.slice(r+1)}setTimeout(()=>bre(n))}})})})});yre.displayName=vre;var C5e={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function T5e(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}function R5e(e,t,n){const r=T5e(e.key,n);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(r)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(r)))return C5e[r]}function bre(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function I5e(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var k5e=gre,x5e=yre,A5e=function(e){return typeof document>"u"?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},Om=new WeakMap,F2=new WeakMap,$2={},L6=0,_re=function(e){return e&&(e.host||_re(e.parentNode))},L5e=function(e,t){return t.map(function(t){if(e.contains(t))return t;var n=_re(t);return n&&e.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)}).filter(function(e){return!!e})},P5e=function(e,t,n,r){var i=L5e(t,Array.isArray(e)?e:[e]);$2[n]||($2[n]=new WeakMap);var o=$2[n],s=[],a=new Set,l=new Set(i),c=function(e){!e||a.has(e)||(a.add(e),c(e.parentNode))};i.forEach(c);var u=function(e){!e||l.has(e)||Array.prototype.forEach.call(e.children,function(e){if(a.has(e))u(e);else try{var t=e.getAttribute(r),i=null!==t&&"false"!==t,l=(Om.get(e)||0)+1,c=(o.get(e)||0)+1;Om.set(e,l),o.set(e,c),s.push(e),1===l&&i&&F2.set(e,!0),1===c&&e.setAttribute(n,"true"),i||e.setAttribute(r,"true")}catch(t){console.error("aria-hidden: cannot operate on ",e,t)}})};return u(t),a.clear(),L6++,function(){s.forEach(function(e){var t=Om.get(e)-1,i=o.get(e)-1;Om.set(e,t),o.set(e,i),t||(F2.has(e)||e.removeAttribute(r),F2.delete(e)),i||e.removeAttribute(n)}),--L6||(Om=new WeakMap,Om=new WeakMap,F2=new WeakMap,$2={})}},Sre=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),i=A5e(e);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),P5e(r,i,n,"aria-hidden")):function(){return null}},PL=function(e,t){return(PL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function cc(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}PL(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Ei=function(){return Ei=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ei.apply(this,arguments)};function E_(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function Ere(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function wre(e,t){return function(n,r){t(n,r,e)}}function Cre(e,t,n,r,i,o){function s(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=r.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?r.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),h=!1,p=n.length-1;p>=0;p--){var f={};for(var m in r)f[m]="access"===m?{}:r[m];for(var m in r.access)f.access[m]=r.access[m];f.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(s(e||null))};var v=(0,n[p])("accessor"===l?{get:d.get,set:d.set}:d[c],f);if("accessor"===l){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(a=s(v.get))&&(d.get=a),(a=s(v.set))&&(d.set=a),(a=s(v.init))&&i.unshift(a)}else(a=s(v))&&("field"===l?i.unshift(a):d[c]=a)}u&&Object.defineProperty(u,r.name,d),h=!0}function Tre(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0}function Rre(e){return"symbol"==typeof e?e:"".concat(e)}function Ire(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function kre(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function nM(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())})}function RT(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}var IT=Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function xre(e,t){for(var n in e)"default"!==n&&!Object.prototype.hasOwnProperty.call(t,n)&&IT(t,e,n)}function _f(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function rc(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function Are(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(rc(arguments[t]));return e}function Lre(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function ic(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function bu(e){return this instanceof bu?(this.v=e,this):new bu(e)}function rM(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{!function(e){e.value instanceof bu?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(i[e](t))}catch(e){u(o[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function Pre(e){var t,n;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:bu(e[r](t)),done:!1}:i?i(t):t}:i}}function iM(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof _f?_f(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,i,(t=e[n](t)).done,t.value)})}}}function Ore(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var O5e=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},OL=function(e){return(OL=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(e)};function Mre(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=OL(e),r=0;r<n.length;r++)"default"!==n[r]&&IT(t,e,n[r]);return O5e(t,e),t}function Dre(e){return e&&e.__esModule?e:{default:e}}function Nre(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function Ure(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}function jre(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function Fre(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],n&&(i=r)}if("function"!=typeof r)throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t}var M5e="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function $re(e){function t(t){e.error=e.hasError?new M5e(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var n,r=0;return function i(){for(;n=e.stack.pop();)try{if(!n.async&&1===r)return r=0,e.stack.push(n),Promise.resolve().then(i);if(n.dispose){var o=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(o).then(i,function(e){return t(e),i()})}else r|=1}catch(e){t(e)}if(1===r)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function Bre(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,n,r,i,o){return n?t?".jsx":".js":!r||i&&o?r+i+"."+o.toLowerCase()+"js":e}):e}const D5e={__extends:cc,__assign:Ei,__rest:E_,__decorate:Ere,__param:wre,__esDecorate:Cre,__runInitializers:Tre,__propKey:Rre,__setFunctionName:Ire,__metadata:kre,__awaiter:nM,__generator:RT,__createBinding:IT,__exportStar:xre,__values:_f,__read:rc,__spread:Are,__spreadArrays:Lre,__spreadArray:ic,__await:bu,__asyncGenerator:rM,__asyncDelegator:Pre,__asyncValues:iM,__makeTemplateObject:Ore,__importStar:Mre,__importDefault:Dre,__classPrivateFieldGet:Nre,__classPrivateFieldSet:Ure,__classPrivateFieldIn:jre,__addDisposableResource:Fre,__disposeResources:$re,__rewriteRelativeImportExtension:Bre},jot=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Fre,get __assign(){return Ei},__asyncDelegator:Pre,__asyncGenerator:rM,__asyncValues:iM,__await:bu,__awaiter:nM,__classPrivateFieldGet:Nre,__classPrivateFieldIn:jre,__classPrivateFieldSet:Ure,__createBinding:IT,__decorate:Ere,__disposeResources:$re,__esDecorate:Cre,__exportStar:xre,__extends:cc,__generator:RT,__importDefault:Dre,__importStar:Mre,__makeTemplateObject:Ore,__metadata:kre,__param:wre,__propKey:Rre,__read:rc,__rest:E_,__rewriteRelativeImportExtension:Bre,__runInitializers:Tre,__setFunctionName:Ire,__spread:Are,__spreadArray:ic,__spreadArrays:Lre,__values:_f,default:D5e},Symbol.toStringTag,{value:"Module"}));var Ly="right-scroll-bar-position",Py="width-before-scroll-bar",N5e="with-scroll-bars-hidden",U5e="--removed-body-scroll-bar-size";function P6(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}function j5e(e,t){var n=_.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(e){var t=n.value;t!==e&&(n.value=e,n.callback(e,t))}}}})[0];return n.callback=t,n.facade}var F5e=typeof window<"u"?_.useLayoutEffect:_.useEffect,aq=new WeakMap;function Hre(e,t){var n=j5e(null,function(t){return e.forEach(function(e){return P6(e,t)})});return F5e(function(){var t=aq.get(n);if(t){var r=new Set(t),i=new Set(e),o=n.current;r.forEach(function(e){i.has(e)||P6(e,null)}),i.forEach(function(e){r.has(e)||P6(e,o)})}aq.set(n,e)},[e]),n}function $5e(e){return e}function B5e(e,t){void 0===t&&(t=$5e);var n=[],r=!1;return{read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var i=t(e,r);return n.push(i),function(){n=n.filter(function(e){return e!==i})}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var i=n;n=[],i.forEach(e),t=n}var o=function(){var n=t;t=[],n.forEach(e)},s=function(){return Promise.resolve().then(o)};s(),n={push:function(e){t.push(e),s()},filter:function(e){return t=t.filter(e),n}}}}}function Vre(e){void 0===e&&(e={});var t=B5e(null);return t.options=Ei({async:!0,ssr:!1},e),t}var qre=function(e){var t=e.sideCar,n=E_(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return _.createElement(r,Ei({},n))};function Gre(e,t){return e.useMedium(t),qre}qre.isSideCarExport=!0;var Kre=Vre(),O6=function(){},kT=_.forwardRef(function(e,t){var n=_.useRef(null),r=_.useState({onScrollCapture:O6,onWheelCapture:O6,onTouchMoveCapture:O6}),i=r[0],o=r[1],s=e.forwardProps,a=e.children,l=e.className,c=e.removeScrollBar,u=e.enabled,d=e.shards,h=e.sideCar,p=e.noIsolation,f=e.inert,m=e.allowPinchZoom,v=e.as,g=void 0===v?"div":v,y=e.gapMode,b=E_(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=h,S=Hre([n,t]),E=Ei(Ei({},b),i);return _.createElement(_.Fragment,null,u&&_.createElement(w,{sideCar:Kre,removeScrollBar:c,shards:d,noIsolation:p,inert:f,setCallbacks:o,allowPinchZoom:!!m,lockRef:n,gapMode:y}),s?_.cloneElement(_.Children.only(a),Ei(Ei({},E),{ref:S})):_.createElement(g,Ei({},E,{className:l,ref:S}),a))});kT.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},kT.classNames={fullWidth:Py,zeroRight:Ly};var H5e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function V5e(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=H5e();return t&&e.setAttribute("nonce",t),e}function q5e(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function G5e(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}var K5e=function(){var e=0,t=null;return{add:function(n){0==e&&(t=V5e())&&(q5e(t,n),G5e(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},z5e=function(){var e=K5e();return function(t,n){_.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},sM=function(){var e=z5e();return function(t){var n=t.styles,r=t.dynamic;return e(n,r),null}},W5e={left:0,top:0,right:0,gap:0},M6=function(e){return parseInt(e||"",10)||0},Y5e=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[M6(n),M6(r),M6(i)]},X5e=function(e){if(void 0===e&&(e="margin"),typeof window>"u")return W5e;var t=Y5e(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},J5e=sM(),Ag="data-scroll-locked",Q5e=function(e,t,n,r){var i=e.left,o=e.top,s=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat(N5e," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(a,"px ").concat(r,";\n  }\n  body[").concat(Ag,"] {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(o,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(Ly," {\n    right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(Py," {\n    margin-right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(Ly," .").concat(Ly," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(Py," .").concat(Py," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body[").concat(Ag,"] {\n    ").concat(U5e,": ").concat(a,"px;\n  }\n")},cq=function(){var e=parseInt(document.body.getAttribute(Ag)||"0",10);return isFinite(e)?e:0},Z5e=function(){_.useEffect(function(){return document.body.setAttribute(Ag,(cq()+1).toString()),function(){var e=cq()-1;e<=0?document.body.removeAttribute(Ag):document.body.setAttribute(Ag,e.toString())}},[])},zre=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,i=void 0===r?"margin":r;Z5e();var o=_.useMemo(function(){return X5e(i)},[i]);return _.createElement(J5e,{styles:Q5e(o,!t,i,n?"":"!important")})},ML=!1;if(typeof window<"u")try{var B2=Object.defineProperty({},"passive",{get:function(){return ML=!0,!0}});window.addEventListener("test",B2,B2),window.removeEventListener("test",B2,B2)}catch{ML=!1}var Mm=!!ML&&{passive:!1},eAe=function(e){return"TEXTAREA"===e.tagName},Wre=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!eAe(e)&&"visible"===n[t])},tAe=function(e){return Wre(e,"overflowY")},nAe=function(e){return Wre(e,"overflowX")},lq=function(e,t){var n=t.ownerDocument,r=t;do{if(typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host),Yre(e,r)){var i=Xre(e,r);if(i[1]>i[2])return!0}r=r.parentNode}while(r&&r!==n.body);return!1},rAe=function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]},iAe=function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]},Yre=function(e,t){return"v"===e?tAe(t):nAe(t)},Xre=function(e,t){return"v"===e?rAe(t):iAe(t)},sAe=function(e,t){return"h"===e&&"rtl"===t?-1:1},oAe=function(e,t,n,r,i){var o=sAe(e,window.getComputedStyle(t).direction),s=o*r,a=n.target,l=t.contains(a),c=!1,u=s>0,d=0,h=0;do{var p=Xre(e,a),f=p[0],m=p[1]-p[2]-o*f;(f||m)&&Yre(e,a)&&(d+=m,h+=f),a=a instanceof ShadowRoot?a.host:a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},H2=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},uq=function(e){return[e.deltaX,e.deltaY]},dq=function(e){return e&&"current"in e?e.current:e},aAe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},cAe=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},lAe=0,Dm=[];function uAe(e){var t=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(lAe++)[0],o=_.useState(sM)[0],s=_.useRef(e);_.useEffect(function(){s.current=e},[e]),_.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=ic([e.lockRef.current],(e.shards||[]).map(dq),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var a=_.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var i,o=H2(e),a=n.current,l="deltaX"in e?e.deltaX:a[0]-o[0],c="deltaY"in e?e.deltaY:a[1]-o[1],u=e.target,d=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=lq(d,u);if(!h)return!0;if(h?i=d:(i="v"===d?"h":"v",h=lq(d,u)),!h)return!1;if(!r.current&&"changedTouches"in e&&(l||c)&&(r.current=i),!i)return!0;var p=r.current||i;return oAe(p,t,e,"h"===p?l:c)},[]),l=_.useCallback(function(e){var n=e;if(Dm.length&&Dm[Dm.length-1]===o){var r="deltaY"in n?uq(n):H2(n),i=t.current.filter(function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&aAe(e.delta,r)})[0];if(i&&i.should)return void(n.cancelable&&n.preventDefault());if(!i){var l=(s.current.shards||[]).map(dq).filter(Boolean).filter(function(e){return e.contains(n.target)});(l.length>0?a(n,l[0]):!s.current.noIsolation)&&n.cancelable&&n.preventDefault()}}},[]),c=_.useCallback(function(e,n,r,i){var o={name:e,delta:n,target:r,should:i,shadowParent:dAe(r)};t.current.push(o),setTimeout(function(){t.current=t.current.filter(function(e){return e!==o})},1)},[]),u=_.useCallback(function(e){n.current=H2(e),r.current=void 0},[]),d=_.useCallback(function(t){c(t.type,uq(t),t.target,a(t,e.lockRef.current))},[]),h=_.useCallback(function(t){c(t.type,H2(t),t.target,a(t,e.lockRef.current))},[]);_.useEffect(function(){return Dm.push(o),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Mm),document.addEventListener("touchmove",l,Mm),document.addEventListener("touchstart",u,Mm),function(){Dm=Dm.filter(function(e){return e!==o}),document.removeEventListener("wheel",l,Mm),document.removeEventListener("touchmove",l,Mm),document.removeEventListener("touchstart",u,Mm)}},[]);var p=e.removeScrollBar,f=e.inert;return _.createElement(_.Fragment,null,f?_.createElement(o,{styles:cAe(i)}):null,p?_.createElement(zre,{gapMode:e.gapMode}):null)}function dAe(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const fAe=Gre(Kre,uAe);var Jre=_.forwardRef(function(e,t){return _.createElement(kT,Ei({},e,{ref:t,sideCar:fAe}))});Jre.classNames=kT.classNames;var DL=["Enter"," "],hAe=["ArrowDown","PageUp","Home"],Qre=["ArrowUp","PageDown","End"],pAe=[...hAe,...Qre],mAe={ltr:[...DL,"ArrowRight"],rtl:[...DL,"ArrowLeft"]},gAe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},w_="Menu",[_b,vAe,yAe]=qne(w_),[Rp,xT]=Tp(w_,[yAe,rre,mre]),AT=rre(),Zre=mre(),[bAe,Ip]=Rp(w_),[_Ae,C_]=Rp(w_),eie=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=e,a=AT(t),[l,c]=_.useState(null),u=_.useRef(!1),d=Du(o),h=Gne(i);return _.useEffect(()=>{const e=()=>{u.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>u.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),w.jsx(l5e,{...a,children:w.jsx(bAe,{scope:t,open:n,onOpenChange:d,content:l,onContentChange:c,children:w.jsx(_Ae,{scope:t,onClose:_.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:s,children:r})})})};eie.displayName=w_;var SAe="MenuAnchor",oM=_.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,i=AT(n);return w.jsx(u5e,{...i,...r,ref:t})});oM.displayName=SAe;var aM="MenuPortal",[EAe,tie]=Rp(aM,{forceMount:void 0}),nie=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:i}=e,o=Ip(aM,t);return w.jsx(EAe,{scope:t,forceMount:n,children:w.jsx(S_,{present:n||o.open,children:w.jsx(fre,{asChild:!0,container:i,children:r})})})};nie.displayName=aM;var fa="MenuContent",[wAe,cM]=Rp(fa),rie=_.forwardRef((e,t)=>{const n=tie(fa,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=Ip(fa,e.__scopeMenu),s=C_(fa,e.__scopeMenu);return w.jsx(_b.Provider,{scope:e.__scopeMenu,children:w.jsx(S_,{present:r||o.open,children:w.jsx(_b.Slot,{scope:e.__scopeMenu,children:s.modal?w.jsx(CAe,{...i,ref:t}):w.jsx(TAe,{...i,ref:t})})})})}),CAe=_.forwardRef((e,t)=>{const n=Ip(fa,e.__scopeMenu),r=_.useRef(null),i=ps(t,r);return _.useEffect(()=>{const e=r.current;if(e)return Sre(e)},[]),w.jsx(lM,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Ct(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),TAe=_.forwardRef((e,t)=>{const n=Ip(fa,e.__scopeMenu);return w.jsx(lM,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),lM=_.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,disableOutsideScroll:f,...m}=e,v=Ip(fa,n),g=C_(fa,n),y=AT(n),b=Zre(n),S=vAe(n),[E,C]=_.useState(null),k=_.useRef(null),T=ps(t,k,v.onContentChange),R=_.useRef(0),I=_.useRef(""),x=_.useRef(0),P=_.useRef(null),L=_.useRef("right"),M=_.useRef(0),O=f?Jre:_.Fragment,A=f?{as:uv,allowPinchZoom:!0}:void 0;_.useEffect(()=>()=>window.clearTimeout(R.current),[]),Qne();const D=_.useCallback(e=>{var t,n;return L.current===(null==(t=P.current)?void 0:t.side)&&FAe(e,null==(n=P.current)?void 0:n.area)},[]);return w.jsx(wAe,{scope:n,searchRef:I,onItemEnter:_.useCallback(e=>{D(e)&&e.preventDefault()},[D]),onItemLeave:_.useCallback(e=>{var t;D(e)||(null==(t=k.current)||t.focus(),C(null))},[D]),onTriggerLeave:_.useCallback(e=>{D(e)&&e.preventDefault()},[D]),pointerGraceTimerRef:x,onPointerGraceIntentChange:_.useCallback(e=>{P.current=e},[]),children:w.jsx(O,{...A,children:w.jsx(Zne,{asChild:!0,trapped:i,onMountAutoFocus:Ct(o,e=>{var t;e.preventDefault(),null==(t=k.current)||t.focus({preventScroll:!0})}),onUnmountAutoFocus:s,children:w.jsx(ZO,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,children:w.jsx(k5e,{asChild:!0,...b,dir:g.dir,orientation:"vertical",loop:r,currentTabStopId:E,onCurrentTabStopIdChange:C,onEntryFocus:Ct(l,e=>{g.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:w.jsx(d5e,{role:"menu","aria-orientation":"vertical","data-state":bie(v.open),"data-radix-menu-content":"",dir:g.dir,...y,...m,ref:T,style:{outline:"none",...m.style},onKeyDown:Ct(m.onKeyDown,e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&(e=>{var t,n;const r=I.current+e,i=S().filter(e=>!e.disabled),o=document.activeElement,s=null==(t=i.find(e=>e.ref.current===o))?void 0:t.textValue,a=UAe(i.map(e=>e.textValue),r,s),l=null==(n=i.find(e=>e.textValue===a))?void 0:n.ref.current;(function e(t){I.current=t,window.clearTimeout(R.current),""!==t&&(R.current=window.setTimeout(()=>e(""),1e3))})(r),l&&setTimeout(()=>l.focus())})(e.key));const i=k.current;if(e.target!==i||!pAe.includes(e.key))return;e.preventDefault();const o=S().filter(e=>!e.disabled).map(e=>e.ref.current);Qre.includes(e.key)&&o.reverse(),DAe(o)}),onBlur:Ct(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(R.current),I.current="")}),onPointerMove:Ct(e.onPointerMove,Sb(e=>{const t=e.target,n=M.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>M.current?"right":"left";L.current=t,M.current=e.clientX}}))})})})})})})});rie.displayName=fa;var RAe="MenuGroup",uM=_.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return w.jsx(Ar.div,{role:"group",...r,ref:t})});uM.displayName=RAe;var IAe="MenuLabel",iie=_.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return w.jsx(Ar.div,{...r,ref:t})});iie.displayName=IAe;var OC="MenuItem",fq="menu.itemSelect",LT=_.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...i}=e,o=_.useRef(null),s=C_(OC,e.__scopeMenu),a=cM(OC,e.__scopeMenu),l=ps(t,o),c=_.useRef(!1);return w.jsx(sie,{...i,ref:l,disabled:n,onClick:Ct(e.onClick,()=>{const e=o.current;if(!n&&e){const t=new CustomEvent(fq,{bubbles:!0,cancelable:!0});e.addEventListener(fq,e=>null==r?void 0:r(e),{once:!0}),Txe(e,t),t.defaultPrevented?c.current=!1:s.onClose()}}),onPointerDown:t=>{var n;null==(n=e.onPointerDown)||n.call(e,t),c.current=!0},onPointerUp:Ct(e.onPointerUp,e=>{var t;c.current||null==(t=e.currentTarget)||t.click()}),onKeyDown:Ct(e.onKeyDown,e=>{const t=""!==a.searchRef.current;n||t&&" "===e.key||DL.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});LT.displayName=OC;var sie=_.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...o}=e,s=cM(OC,n),a=Zre(n),l=_.useRef(null),c=ps(t,l),[u,d]=_.useState(!1),[h,p]=_.useState("");return _.useEffect(()=>{const e=l.current;e&&p((e.textContent??"").trim())},[o.children]),w.jsx(_b.ItemSlot,{scope:n,disabled:r,textValue:i??h,children:w.jsx(x5e,{asChild:!0,...a,focusable:!r,children:w.jsx(Ar.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...o,ref:c,onPointerMove:Ct(e.onPointerMove,Sb(e=>{r?s.onItemLeave(e):(s.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ct(e.onPointerLeave,Sb(e=>s.onItemLeave(e))),onFocus:Ct(e.onFocus,()=>d(!0)),onBlur:Ct(e.onBlur,()=>d(!1))})})})}),kAe="MenuCheckboxItem",oie=_.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...i}=e;return w.jsx(die,{scope:e.__scopeMenu,checked:n,children:w.jsx(LT,{role:"menuitemcheckbox","aria-checked":MC(n)?"mixed":n,...i,ref:t,"data-state":fM(n),onSelect:Ct(i.onSelect,()=>null==r?void 0:r(!!MC(n)||!n),{checkForDefaultPrevented:!1})})})});oie.displayName=kAe;var aie="MenuRadioGroup",[xAe,AAe]=Rp(aie,{value:void 0,onValueChange:()=>{}}),cie=_.forwardRef((e,t)=>{const{value:n,onValueChange:r,...i}=e,o=Du(r);return w.jsx(xAe,{scope:e.__scopeMenu,value:n,onValueChange:o,children:w.jsx(uM,{...i,ref:t})})});cie.displayName=aie;var lie="MenuRadioItem",uie=_.forwardRef((e,t)=>{const{value:n,...r}=e,i=AAe(lie,e.__scopeMenu),o=n===i.value;return w.jsx(die,{scope:e.__scopeMenu,checked:o,children:w.jsx(LT,{role:"menuitemradio","aria-checked":o,...r,ref:t,"data-state":fM(o),onSelect:Ct(r.onSelect,()=>{var e;return null==(e=i.onValueChange)?void 0:e.call(i,n)},{checkForDefaultPrevented:!1})})})});uie.displayName=lie;var dM="MenuItemIndicator",[die,LAe]=Rp(dM,{checked:!1}),fie=_.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...i}=e,o=LAe(dM,n);return w.jsx(S_,{present:r||MC(o.checked)||!0===o.checked,children:w.jsx(Ar.span,{...i,ref:t,"data-state":fM(o.checked)})})});fie.displayName=dM;var PAe="MenuSeparator",hie=_.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return w.jsx(Ar.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});hie.displayName=PAe;var OAe="MenuArrow",pie=_.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,i=AT(n);return w.jsx(f5e,{...i,...r,ref:t})});pie.displayName=OAe;var MAe="MenuSub",[Fot,mie]=Rp(MAe),cy="MenuSubTrigger",gie=_.forwardRef((e,t)=>{const n=Ip(cy,e.__scopeMenu),r=C_(cy,e.__scopeMenu),i=mie(cy,e.__scopeMenu),o=cM(cy,e.__scopeMenu),s=_.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:e.__scopeMenu},u=_.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return _.useEffect(()=>u,[u]),_.useEffect(()=>{const e=a.current;return()=>{window.clearTimeout(e),l(null)}},[a,l]),w.jsx(oM,{asChild:!0,...c,children:w.jsx(sie,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":bie(n.open),...e,ref:CT(t,i.onTriggerChange),onClick:t=>{var r;null==(r=e.onClick)||r.call(e,t),!e.disabled&&!t.defaultPrevented&&(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Ct(e.onPointerMove,Sb(t=>{o.onItemEnter(t),!t.defaultPrevented&&!e.disabled&&!n.open&&!s.current&&(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:Ct(e.onPointerLeave,Sb(e=>{var t,r;u();const i=null==(t=n.content)?void 0:t.getBoundingClientRect();if(i){const t=null==(r=n.content)?void 0:r.dataset.side,s="right"===t,l=s?-5:5,c=i[s?"left":"right"],u=i[s?"right":"left"];o.onPointerGraceIntentChange({area:[{x:e.clientX+l,y:e.clientY},{x:c,y:i.top},{x:u,y:i.top},{x:u,y:i.bottom},{x:c,y:i.bottom}],side:t}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(e),e.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:Ct(e.onKeyDown,t=>{var i;const s=""!==o.searchRef.current;e.disabled||s&&" "===t.key||mAe[r.dir].includes(t.key)&&(n.onOpenChange(!0),null==(i=n.content)||i.focus(),t.preventDefault())})})})});gie.displayName=cy;var vie="MenuSubContent",yie=_.forwardRef((e,t)=>{const n=tie(fa,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=Ip(fa,e.__scopeMenu),s=C_(fa,e.__scopeMenu),a=mie(vie,e.__scopeMenu),l=_.useRef(null),c=ps(t,l);return w.jsx(_b.Provider,{scope:e.__scopeMenu,children:w.jsx(S_,{present:r||o.open,children:w.jsx(_b.Slot,{scope:e.__scopeMenu,children:w.jsx(lM,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:c,align:"start",side:"rtl"===s.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;s.isUsingKeyboardRef.current&&(null==(t=l.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:Ct(e.onFocusOutside,e=>{e.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:Ct(e.onEscapeKeyDown,e=>{s.onClose(),e.preventDefault()}),onKeyDown:Ct(e.onKeyDown,e=>{var t;const n=e.currentTarget.contains(e.target),r=gAe[s.dir].includes(e.key);n&&r&&(o.onOpenChange(!1),null==(t=a.trigger)||t.focus(),e.preventDefault())})})})})})});function bie(e){return e?"open":"closed"}function MC(e){return"indeterminate"===e}function fM(e){return MC(e)?"indeterminate":e?"checked":"unchecked"}function DAe(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function NAe(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function UAe(e,t,n){const r=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,i=n?e.indexOf(n):-1;let o=NAe(e,Math.max(i,0));1===r.length&&(o=o.filter(e=>e!==n));const s=o.find(e=>e.toLowerCase().startsWith(r.toLowerCase()));return s!==n?s:void 0}function jAe(e,t){const{x:n,y:r}=e;let i=!1;for(let e=0,o=t.length-1;e<t.length;o=e++){const s=t[e].x,a=t[e].y,l=t[o].x,c=t[o].y;a>r!=c>r&&n<(l-s)*(r-a)/(c-a)+s&&(i=!i)}return i}function FAe(e,t){if(!t)return!1;return jAe({x:e.clientX,y:e.clientY},t)}function Sb(e){return t=>"mouse"===t.pointerType?e(t):void 0}yie.displayName=vie;var _ie=eie,Sie=oM,Eie=nie,wie=rie,Cie=uM,Tie=iie,Rie=LT,Iie=oie,kie=cie,xie=uie,Aie=fie,Lie=hie,Pie=pie,Oie=gie,Mie=yie,hM="ContextMenu",[$Ae,$ot]=Tp(hM,[xT]),vs=xT(),[BAe,Die]=$Ae(hM),Nie=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:r,dir:i,modal:o=!0}=e,[s,a]=_.useState(!1),l=vs(t),c=Du(r),u=_.useCallback(e=>{a(e),c(e)},[c]);return w.jsx(BAe,{scope:t,open:s,onOpenChange:u,modal:o,children:w.jsx(_ie,{...l,dir:i,open:s,onOpenChange:u,modal:o,children:n})})};Nie.displayName=hM;var Uie="ContextMenuTrigger",jie=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=e,o=Die(Uie,n),s=vs(n),a=_.useRef({x:0,y:0}),l=_.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=_.useRef(0),u=_.useCallback(()=>window.clearTimeout(c.current),[]),d=e=>{a.current={x:e.clientX,y:e.clientY},o.onOpenChange(!0)};return _.useEffect(()=>u,[u]),_.useEffect(()=>{r&&u()},[r,u]),w.jsxs(w.Fragment,{children:[w.jsx(Sie,{...s,virtualRef:l}),w.jsx(Ar.span,{"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:Ct(e.onContextMenu,e=>{u(),d(e),e.preventDefault()}),onPointerDown:r?e.onPointerDown:Ct(e.onPointerDown,V2(e=>{u(),c.current=window.setTimeout(()=>d(e),700)})),onPointerMove:r?e.onPointerMove:Ct(e.onPointerMove,V2(u)),onPointerCancel:r?e.onPointerCancel:Ct(e.onPointerCancel,V2(u)),onPointerUp:r?e.onPointerUp:Ct(e.onPointerUp,V2(u))})]})});jie.displayName=Uie;var HAe="ContextMenuPortal",Fie=e=>{const{__scopeContextMenu:t,...n}=e,r=vs(t);return w.jsx(Eie,{...r,...n})};Fie.displayName=HAe;var $ie="ContextMenuContent",Bie=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Die($ie,n),o=vs(n),s=_.useRef(!1);return w.jsx(wie,{...o,...r,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var n;null==(n=e.onCloseAutoFocus)||n.call(e,t),!t.defaultPrevented&&s.current&&t.preventDefault(),s.current=!1},onInteractOutside:t=>{var n;null==(n=e.onInteractOutside)||n.call(e,t),!t.defaultPrevented&&!i.modal&&(s.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Bie.displayName=$ie;var VAe="ContextMenuGroup",qAe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Cie,{...i,...r,ref:t})});qAe.displayName=VAe;var GAe="ContextMenuLabel",KAe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Tie,{...i,...r,ref:t})});KAe.displayName=GAe;var zAe="ContextMenuItem",Hie=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Rie,{...i,...r,ref:t})});Hie.displayName=zAe;var WAe="ContextMenuCheckboxItem",YAe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Iie,{...i,...r,ref:t})});YAe.displayName=WAe;var XAe="ContextMenuRadioGroup",JAe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(kie,{...i,...r,ref:t})});JAe.displayName=XAe;var QAe="ContextMenuRadioItem",ZAe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(xie,{...i,...r,ref:t})});ZAe.displayName=QAe;var eLe="ContextMenuItemIndicator",tLe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Aie,{...i,...r,ref:t})});tLe.displayName=eLe;var nLe="ContextMenuSeparator",rLe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Lie,{...i,...r,ref:t})});rLe.displayName=nLe;var iLe="ContextMenuArrow",sLe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Pie,{...i,...r,ref:t})});sLe.displayName=iLe;var oLe="ContextMenuSubTrigger",aLe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Oie,{...i,...r,ref:t})});aLe.displayName=oLe;var cLe="ContextMenuSubContent",lLe=_.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=vs(n);return w.jsx(Mie,{...i,...r,ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});function V2(e){return t=>"mouse"!==t.pointerType?e(t):void 0}lLe.displayName=cLe;var hq=Nie,uLe=jie,dLe=Fie,fLe=Bie;const hLe="_menu_19sse_8",pLe="_title_19sse_74",pq={menu:hLe,title:pLe},mLe={"menu-title":"_menu-title_1sgvx_8"},gLe=({title:e,id:t,className:n})=>{const r=Ne(mLe["menu-title"],n);return w.jsx(on,{as:"h3",id:t,className:r,size:"sm",weight:"semibold",children:e})},pM=_.forwardRef(({title:e,showTitle:t=!0,className:n,children:r,...i},o)=>{const s=_.useId();return w.jsxs("div",{role:"menu",ref:o,"aria-label":t?void 0:e,"aria-labelledby":t?s:void 0,className:Ne(n,pq.menu),...i,children:[t&&w.jsx(gLe,{className:pq.title,title:e,id:s}),r]})});function Oy(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}function mq(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function Vie(...e){return t=>{let n=!1;const r=e.map(e=>{const r=mq(e,t);return!n&&"function"==typeof r&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():mq(e[t],null)}}}}function mM(...e){return _.useCallback(Vie(...e),e)}function vLe(e,t){const n=_.createContext(t),r=e=>{const{children:t,...r}=e,i=_.useMemo(()=>r,Object.values(r));return w.jsx(n.Provider,{value:i,children:t})};return r.displayName=e+"Provider",[r,function(r){const i=_.useContext(n);if(i)return i;if(void 0!==t)return t;throw new Error(`\`${r}\` must be used within \`${e}\``)}]}function yLe(e,t=[]){let n=[];const r=()=>{const t=n.map(e=>_.createContext(e));return function(n){const r=(null==n?void 0:n[e])||t;return _.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){const i=_.createContext(r),o=n.length;n=[...n,r];const s=t=>{var n;const{scope:r,children:s,...a}=t,l=(null==(n=null==r?void 0:r[e])?void 0:n[o])||i,c=_.useMemo(()=>a,Object.values(a));return w.jsx(l.Provider,{value:c,children:s})};return s.displayName=t+"Provider",[s,function(n,s){var a;const l=(null==(a=null==s?void 0:s[e])?void 0:a[o])||i,c=_.useContext(l);if(c)return c;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},bLe(r,...t)]}function bLe(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return _.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}pM.displayName="FloatingMenu";var op=null!=globalThis&&globalThis.document?_.useLayoutEffect:()=>{},_Le=c_[" useId ".trim().toString()]||(()=>{}),SLe=0;function D6(e){const[t,n]=_.useState(_Le());return op(()=>{n(e=>e??String(SLe++))},[e]),e||(t?`radix-${t}`:"")}var ELe=c_[" useInsertionEffect ".trim().toString()]||op;function wLe({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){const[i,o,s]=CLe({defaultProp:t,onChange:n}),a=void 0!==e,l=a?e:i;{const t=_.useRef(void 0!==e);_.useEffect(()=>{const e=t.current;e!==a&&console.warn(`${r} is changing from ${e?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),t.current=a},[a,r])}return[l,_.useCallback(t=>{var n;if(a){const r=TLe(t)?t(e):t;r!==e&&(null==(n=s.current)||n.call(s,r))}else o(t)},[a,e,o,s])]}function CLe({defaultProp:e,onChange:t}){const[n,r]=_.useState(e),i=_.useRef(n),o=_.useRef(t);return ELe(()=>{o.current=t},[t]),_.useEffect(()=>{var e;i.current!==n&&(null==(e=o.current)||e.call(o,n),i.current=n)},[n,i]),[n,r,o]}function TLe(e){return"function"==typeof e}function gq(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function qie(...e){return t=>{let n=!1;const r=e.map(e=>{const r=gq(e,t);return!n&&"function"==typeof r&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():gq(e[t],null)}}}}function RLe(...e){return _.useCallback(qie(...e),e)}function ILe(e){const t=kLe(e),n=_.forwardRef((e,n)=>{const{children:r,...i}=e,o=_.Children.toArray(r),s=o.find(ALe);if(s){const e=s.props.children,r=o.map(t=>t===s?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t);return w.jsx(t,{...i,ref:n,children:_.isValidElement(e)?_.cloneElement(e,void 0,r):null})}return w.jsx(t,{...i,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function kLe(e){const t=_.forwardRef((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=PLe(n),i=LLe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?qie(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var xLe=Symbol("radix.slottable");function ALe(e){return _.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===xLe}function LLe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{const t=o(...e);return i(...e),t}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function PLe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var OLe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],MLe=OLe.reduce((e,t)=>{const n=ILe(`Primitive.${t}`),r=_.forwardRef((e,r)=>{const{asChild:i,...o}=e,s=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(s,{...o,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function vq(e){const t=_.useRef(e);return _.useEffect(()=>{t.current=e}),_.useMemo(()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)},[])}var N6="focusScope.autoFocusOnMount",U6="focusScope.autoFocusOnUnmount",yq={bubbles:!1,cancelable:!0},DLe="FocusScope",Gie=_.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=e,[a,l]=_.useState(null),c=vq(i),u=vq(o),d=_.useRef(null),h=RLe(t,e=>l(e)),p=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let e=function(e){if(p.paused||!a)return;const t=e.target;a.contains(t)?d.current=t:Ld(d.current,{select:!0})},t=function(e){if(p.paused||!a)return;const t=e.relatedTarget;null!==t&&(a.contains(t)||Ld(d.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&Ld(a)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(n);return a&&r.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}},[r,a,p.paused]),_.useEffect(()=>{if(a){_q.add(p);const e=document.activeElement;if(!a.contains(e)){const t=new CustomEvent(N6,yq);a.addEventListener(N6,c),a.dispatchEvent(t),t.defaultPrevented||(NLe(BLe(Kie(a)),{select:!0}),document.activeElement===e&&Ld(a))}return()=>{a.removeEventListener(N6,c),setTimeout(()=>{const t=new CustomEvent(U6,yq);a.addEventListener(U6,u),a.dispatchEvent(t),t.defaultPrevented||Ld(e??document.body,{select:!0}),a.removeEventListener(U6,u),_q.remove(p)},0)}}},[a,c,u,p]);const f=_.useCallback(e=>{if(!n&&!r||p.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){const t=e.currentTarget,[r,o]=ULe(t);r&&o?e.shiftKey||i!==o?e.shiftKey&&i===r&&(e.preventDefault(),n&&Ld(o,{select:!0})):(e.preventDefault(),n&&Ld(r,{select:!0})):i===t&&e.preventDefault()}},[n,r,p.paused]);return w.jsx(MLe.div,{tabIndex:-1,...s,ref:h,onKeyDown:f})});function NLe(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Ld(r,{select:t}),document.activeElement!==n)return}function ULe(e){const t=Kie(e);return[bq(t,e),bq(t.reverse(),e)]}function Kie(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function bq(e,t){for(const n of e)if(!jLe(n,{upTo:t}))return n}function jLe(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function FLe(e){return e instanceof HTMLInputElement&&"select"in e}function Ld(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&FLe(e)&&t&&e.select()}}Gie.displayName=DLe;var _q=$Le();function $Le(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=Sq(e,t),e.unshift(t)},remove(t){var n;e=Sq(e,t),null==(n=e[0])||n.resume()}}}function Sq(e,t){const n=[...e],r=n.indexOf(t);return-1!==r&&n.splice(r,1),n}function BLe(e){return e.filter(e=>"A"!==e.tagName)}function Eq(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function HLe(...e){return t=>{let n=!1;const r=e.map(e=>{const r=Eq(e,t);return!n&&"function"==typeof r&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():Eq(e[t],null)}}}}function VLe(e){const t=qLe(e),n=_.forwardRef((e,n)=>{const{children:r,...i}=e,o=_.Children.toArray(r),s=o.find(KLe);if(s){const e=s.props.children,r=o.map(t=>t===s?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t);return w.jsx(t,{...i,ref:n,children:_.isValidElement(e)?_.cloneElement(e,void 0,r):null})}return w.jsx(t,{...i,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function qLe(e){const t=_.forwardRef((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=WLe(n),i=zLe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?HLe(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var GLe=Symbol("radix.slottable");function KLe(e){return _.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===GLe}function zLe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{const t=o(...e);return i(...e),t}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function WLe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var YLe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],XLe=YLe.reduce((e,t)=>{const n=VLe(`Primitive.${t}`),r=_.forwardRef((e,r)=>{const{asChild:i,...o}=e,s=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(s,{...o,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),JLe="Portal",zie=_.forwardRef((e,t)=>{var n;const{container:r,...i}=e,[o,s]=_.useState(!1);op(()=>s(!0),[]);const a=r||o&&(null==(n=null==globalThis?void 0:globalThis.document)?void 0:n.body);return a?Oee.createPortal(w.jsx(XLe.div,{...i,ref:t}),a):null});function wq(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function QLe(...e){return t=>{let n=!1;const r=e.map(e=>{const r=wq(e,t);return!n&&"function"==typeof r&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():wq(e[t],null)}}}}function ZLe(...e){return _.useCallback(QLe(...e),e)}function e7e(e,t){return _.useReducer((e,n)=>t[e][n]??e,e)}zie.displayName=JLe;var PT=e=>{const{present:t,children:n}=e,r=t7e(t),i="function"==typeof n?n({present:r.isPresent}):_.Children.only(n),o=ZLe(r.ref,n7e(i));return"function"==typeof n||r.isPresent?_.cloneElement(i,{ref:o}):null};function t7e(e){const[t,n]=_.useState(),r=_.useRef(null),i=_.useRef(e),o=_.useRef("none"),s=e?"mounted":"unmounted",[a,l]=e7e(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const e=q2(r.current);o.current="mounted"===a?e:"none"},[a]),op(()=>{const t=r.current,n=i.current;if(n!==e){const r=o.current,s=q2(t);e?l("MOUNT"):"none"===s||"none"===(null==t?void 0:t.display)?l("UNMOUNT"):l(n&&r!==s?"ANIMATION_OUT":"UNMOUNT"),i.current=e}},[e,l]),op(()=>{if(t){let e;const n=t.ownerDocument.defaultView??window,s=o=>{const s=q2(r.current).includes(o.animationName);if(o.target===t&&s&&(l("ANIMATION_END"),!i.current)){const r=t.style.animationFillMode;t.style.animationFillMode="forwards",e=n.setTimeout(()=>{"forwards"===t.style.animationFillMode&&(t.style.animationFillMode=r)})}},a=e=>{e.target===t&&(o.current=q2(r.current))};return t.addEventListener("animationstart",a),t.addEventListener("animationcancel",s),t.addEventListener("animationend",s),()=>{n.clearTimeout(e),t.removeEventListener("animationstart",a),t.removeEventListener("animationcancel",s),t.removeEventListener("animationend",s)}}l("ANIMATION_END")},[t,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(e=>{r.current=e?getComputedStyle(e):null,n(e)},[])}}function q2(e){return(null==e?void 0:e.animationName)||"none"}function n7e(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}function Wie(e){const t=r7e(e),n=_.forwardRef((e,n)=>{const{children:r,...i}=e,o=_.Children.toArray(r),s=o.find(s7e);if(s){const e=s.props.children,r=o.map(t=>t===s?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t);return w.jsx(t,{...i,ref:n,children:_.isValidElement(e)?_.cloneElement(e,void 0,r):null})}return w.jsx(t,{...i,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function r7e(e){const t=_.forwardRef((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=a7e(n),i=o7e(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Vie(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}PT.displayName="Presence";var i7e=Symbol("radix.slottable");function s7e(e){return _.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===i7e}function o7e(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{const t=o(...e);return i(...e),t}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function a7e(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var c7e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],T_=c7e.reduce((e,t)=>{const n=Wie(`Primitive.${t}`),r=_.forwardRef((e,r)=>{const{asChild:i,...o}=e,s=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(s,{...o,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),Yie=Vre(),j6=function(){},OT=_.forwardRef(function(e,t){var n=_.useRef(null),r=_.useState({onScrollCapture:j6,onWheelCapture:j6,onTouchMoveCapture:j6}),i=r[0],o=r[1],s=e.forwardProps,a=e.children,l=e.className,c=e.removeScrollBar,u=e.enabled,d=e.shards,h=e.sideCar,p=e.noIsolation,f=e.inert,m=e.allowPinchZoom,v=e.as,g=void 0===v?"div":v,y=e.gapMode,b=E_(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=h,S=Hre([n,t]),E=Ei(Ei({},b),i);return _.createElement(_.Fragment,null,u&&_.createElement(w,{sideCar:Yie,removeScrollBar:c,shards:d,noIsolation:p,inert:f,setCallbacks:o,allowPinchZoom:!!m,lockRef:n,gapMode:y}),s?_.cloneElement(_.Children.only(a),Ei(Ei({},E),{ref:S})):_.createElement(g,Ei({},E,{className:l,ref:S}),a))});OT.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},OT.classNames={fullWidth:Py,zeroRight:Ly};var NL=!1;if(typeof window<"u")try{var G2=Object.defineProperty({},"passive",{get:function(){return NL=!0,!0}});window.addEventListener("test",G2,G2),window.removeEventListener("test",G2,G2)}catch{NL=!1}var Nm=!!NL&&{passive:!1},l7e=function(e){return"TEXTAREA"===e.tagName},Xie=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!l7e(e)&&"visible"===n[t])},u7e=function(e){return Xie(e,"overflowY")},d7e=function(e){return Xie(e,"overflowX")},Cq=function(e,t){var n=t.ownerDocument,r=t;do{if(typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host),Jie(e,r)){var i=Qie(e,r);if(i[1]>i[2])return!0}r=r.parentNode}while(r&&r!==n.body);return!1},f7e=function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]},h7e=function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]},Jie=function(e,t){return"v"===e?u7e(t):d7e(t)},Qie=function(e,t){return"v"===e?f7e(t):h7e(t)},p7e=function(e,t){return"h"===e&&"rtl"===t?-1:1},m7e=function(e,t,n,r,i){var o=p7e(e,window.getComputedStyle(t).direction),s=o*r,a=n.target,l=t.contains(a),c=!1,u=s>0,d=0,h=0;do{var p=Qie(e,a),f=p[0],m=p[1]-p[2]-o*f;(f||m)&&Jie(e,a)&&(d+=m,h+=f),a=a instanceof ShadowRoot?a.host:a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},K2=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Tq=function(e){return[e.deltaX,e.deltaY]},Rq=function(e){return e&&"current"in e?e.current:e},g7e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},v7e=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},y7e=0,Um=[];function b7e(e){var t=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(y7e++)[0],o=_.useState(sM)[0],s=_.useRef(e);_.useEffect(function(){s.current=e},[e]),_.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=ic([e.lockRef.current],(e.shards||[]).map(Rq),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var a=_.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var i,o=K2(e),a=n.current,l="deltaX"in e?e.deltaX:a[0]-o[0],c="deltaY"in e?e.deltaY:a[1]-o[1],u=e.target,d=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=Cq(d,u);if(!h)return!0;if(h?i=d:(i="v"===d?"h":"v",h=Cq(d,u)),!h)return!1;if(!r.current&&"changedTouches"in e&&(l||c)&&(r.current=i),!i)return!0;var p=r.current||i;return m7e(p,t,e,"h"===p?l:c)},[]),l=_.useCallback(function(e){var n=e;if(Um.length&&Um[Um.length-1]===o){var r="deltaY"in n?Tq(n):K2(n),i=t.current.filter(function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&g7e(e.delta,r)})[0];if(i&&i.should)return void(n.cancelable&&n.preventDefault());if(!i){var l=(s.current.shards||[]).map(Rq).filter(Boolean).filter(function(e){return e.contains(n.target)});(l.length>0?a(n,l[0]):!s.current.noIsolation)&&n.cancelable&&n.preventDefault()}}},[]),c=_.useCallback(function(e,n,r,i){var o={name:e,delta:n,target:r,should:i,shadowParent:_7e(r)};t.current.push(o),setTimeout(function(){t.current=t.current.filter(function(e){return e!==o})},1)},[]),u=_.useCallback(function(e){n.current=K2(e),r.current=void 0},[]),d=_.useCallback(function(t){c(t.type,Tq(t),t.target,a(t,e.lockRef.current))},[]),h=_.useCallback(function(t){c(t.type,K2(t),t.target,a(t,e.lockRef.current))},[]);_.useEffect(function(){return Um.push(o),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Nm),document.addEventListener("touchmove",l,Nm),document.addEventListener("touchstart",u,Nm),function(){Um=Um.filter(function(e){return e!==o}),document.removeEventListener("wheel",l,Nm),document.removeEventListener("touchmove",l,Nm),document.removeEventListener("touchstart",u,Nm)}},[]);var p=e.removeScrollBar,f=e.inert;return _.createElement(_.Fragment,null,f?_.createElement(o,{styles:v7e(i)}):null,p?_.createElement(zre,{gapMode:e.gapMode}):null)}function _7e(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const S7e=Gre(Yie,b7e);var Zie=_.forwardRef(function(e,t){return _.createElement(OT,Ei({},e,{ref:t,sideCar:S7e}))});Zie.classNames=OT.classNames;var MT="Dialog",[ese,Bot]=yLe(MT),[E7e,lc]=ese(MT),tse=e=>{const{__scopeDialog:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=e,a=_.useRef(null),l=_.useRef(null),[c,u]=wLe({prop:r,defaultProp:i??!1,onChange:o,caller:MT});return w.jsx(E7e,{scope:t,triggerRef:a,contentRef:l,contentId:D6(),titleId:D6(),descriptionId:D6(),open:c,onOpenChange:u,onOpenToggle:_.useCallback(()=>u(e=>!e),[u]),modal:s,children:n})};tse.displayName=MT;var nse="DialogTrigger",rse=_.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,i=lc(nse,n),o=mM(t,i.triggerRef);return w.jsx(T_.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":yM(i.open),...r,ref:o,onClick:Oy(e.onClick,i.onOpenToggle)})});rse.displayName=nse;var gM="DialogPortal",[w7e,ise]=ese(gM,{forceMount:void 0}),sse=e=>{const{__scopeDialog:t,forceMount:n,children:r,container:i}=e,o=lc(gM,t);return w.jsx(w7e,{scope:t,forceMount:n,children:_.Children.map(r,e=>w.jsx(PT,{present:n||o.open,children:w.jsx(zie,{asChild:!0,container:i,children:e})}))})};sse.displayName=gM;var DC="DialogOverlay",ose=_.forwardRef((e,t)=>{const n=ise(DC,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=lc(DC,e.__scopeDialog);return o.modal?w.jsx(PT,{present:r||o.open,children:w.jsx(T7e,{...i,ref:t})}):null});ose.displayName=DC;var C7e=Wie("DialogOverlay.RemoveScroll"),T7e=_.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,i=lc(DC,n);return w.jsx(Zie,{as:C7e,allowPinchZoom:!0,shards:[i.contentRef],children:w.jsx(T_.div,{"data-state":yM(i.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),ap="DialogContent",ase=_.forwardRef((e,t)=>{const n=ise(ap,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=lc(ap,e.__scopeDialog);return w.jsx(PT,{present:r||o.open,children:o.modal?w.jsx(R7e,{...i,ref:t}):w.jsx(I7e,{...i,ref:t})})});ase.displayName=ap;var R7e=_.forwardRef((e,t)=>{const n=lc(ap,e.__scopeDialog),r=_.useRef(null),i=mM(t,n.contentRef,r);return _.useEffect(()=>{const e=r.current;if(e)return Sre(e)},[]),w.jsx(cse,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Oy(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null==(t=n.triggerRef.current)||t.focus()}),onPointerDownOutside:Oy(e.onPointerDownOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()}),onFocusOutside:Oy(e.onFocusOutside,e=>e.preventDefault())})}),I7e=_.forwardRef((e,t)=>{const n=lc(ap,e.__scopeDialog),r=_.useRef(!1),i=_.useRef(!1);return w.jsx(cse,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,s;null==(o=e.onCloseAutoFocus)||o.call(e,t),t.defaultPrevented||(r.current||null==(s=n.triggerRef.current)||s.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var o,s;null==(o=e.onInteractOutside)||o.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"===t.detail.originalEvent.type&&(i.current=!0));const a=t.target;(null==(s=n.triggerRef.current)?void 0:s.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}})}),cse=_.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=e,a=lc(ap,n),l=_.useRef(null),c=mM(t,l);return Qne(),w.jsxs(w.Fragment,{children:[w.jsx(Gie,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o,children:w.jsx(ZO,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":yM(a.open),...s,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),w.jsxs(w.Fragment,{children:[w.jsx(x7e,{titleId:a.titleId}),w.jsx(L7e,{contentRef:l,descriptionId:a.descriptionId})]})]})}),vM="DialogTitle",lse=_.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,i=lc(vM,n);return w.jsx(T_.h2,{id:i.titleId,...r,ref:t})});lse.displayName=vM;var use="DialogDescription",k7e=_.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,i=lc(use,n);return w.jsx(T_.p,{id:i.descriptionId,...r,ref:t})});k7e.displayName=use;var dse="DialogClose",fse=_.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,i=lc(dse,n);return w.jsx(T_.button,{type:"button",...r,ref:t,onClick:Oy(e.onClick,()=>i.onOpenChange(!1))})});function yM(e){return e?"open":"closed"}fse.displayName=dse;var hse="DialogTitleWarning",[Hot,pse]=vLe(hse,{contentName:ap,titleName:vM,docsSlug:"dialog"}),x7e=({titleId:e})=>{const t=pse(hse),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.\n\nIf you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return _.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},A7e="DialogDescriptionWarning",L7e=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${pse(A7e).contentName}}.`;return _.useEffect(()=>{var r;const i=null==(r=e.current)?void 0:r.getAttribute("aria-describedby");t&&i&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},bM=tse,P7e=rse,_M=sse,SM=ose,EM=ase,wM=lse,mse=fse;function O7e(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}const gse=Te.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),R_=()=>{const e=Te.useContext(gse);if(!e)throw new Error("useDrawerContext must be used within a Drawer.Root");return e};function M7e(){const e=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(e)&&/Mobile/.test(e)||/FxiOS/.test(e))}function D7e(){return CM(/^Mac/)}function N7e(){return CM(/^iPhone/)}function Iq(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function U7e(){return CM(/^iPad/)||D7e()&&navigator.maxTouchPoints>1}function vse(){return N7e()||U7e()}function CM(e){return typeof window<"u"&&null!=window.navigator?e.test(window.navigator.platform):void 0}O7e("[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(\n[data-state=closed]\n){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}");const j7e=24,F7e=typeof window<"u"?_.useLayoutEffect:_.useEffect;function kq(...e){return(...t)=>{for(let n of e)"function"==typeof n&&n(...t)}}const F6=typeof document<"u"&&window.visualViewport;function xq(e){let t=window.getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowX+t.overflowY)}function yse(e){for(xq(e)&&(e=e.parentElement);e&&!xq(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement}const $7e=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let $6,z2=0;function B7e(e={}){let{isDisabled:t}=e;F7e(()=>{if(!t)return z2++,1===z2&&vse()&&($6=H7e()),()=>{z2--,0===z2&&(null==$6||$6())}},[t])}function H7e(){let e,t=0,n=window.pageXOffset,r=window.pageYOffset,i=kq(V7e(document.documentElement,"paddingRight",window.innerWidth-document.documentElement.clientWidth+"px"));window.scrollTo(0,0);let o=kq(L0(document,"touchstart",n=>{e=yse(n.target),(e!==document.documentElement||e!==document.body)&&(t=n.changedTouches[0].pageY)},{passive:!1,capture:!0}),L0(document,"touchmove",n=>{if(!e||e===document.documentElement||e===document.body)return void n.preventDefault();let r=n.changedTouches[0].pageY,i=e.scrollTop,o=e.scrollHeight-e.clientHeight;0!==o&&((i<=0&&r>t||i>=o&&r<t)&&n.preventDefault(),t=r)},{passive:!1,capture:!0}),L0(document,"touchend",e=>{let t=e.target;UL(t)&&t!==document.activeElement&&(e.preventDefault(),t.style.transform="translateY(-2000px)",t.focus(),requestAnimationFrame(()=>{t.style.transform=""}))},{passive:!1,capture:!0}),L0(document,"focus",e=>{let t=e.target;UL(t)&&(t.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{t.style.transform="",F6&&(F6.height<window.innerHeight?requestAnimationFrame(()=>{Aq(t)}):F6.addEventListener("resize",()=>Aq(t),{once:!0}))}))},!0),L0(window,"scroll",()=>{window.scrollTo(0,0)}));return()=>{i(),o(),window.scrollTo(n,r)}}function V7e(e,t,n){let r=e.style[t];return e.style[t]=n,()=>{e.style[t]=r}}function L0(e,t,n,r){return e.addEventListener(t,n,r),()=>{e.removeEventListener(t,n,r)}}function Aq(e){let t=document.scrollingElement||document.documentElement;for(;e&&e!==t;){let t=yse(e);if(t!==document.documentElement&&t!==document.body&&t!==e){let n=t.getBoundingClientRect().top,r=e.getBoundingClientRect().top;e.getBoundingClientRect().bottom>t.getBoundingClientRect().bottom+24&&(t.scrollTop+=r-n)}e=t.parentElement}}function UL(e){return e instanceof HTMLInputElement&&!$7e.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}function q7e(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function G7e(...e){return t=>e.forEach(e=>q7e(e,t))}function bse(...e){return _.useCallback(G7e(...e),e)}const _se=new WeakMap;function Wr(e,t,n=!1){if(!(e&&e instanceof HTMLElement))return;let r={};Object.entries(t).forEach(([t,n])=>{t.startsWith("--")?e.style.setProperty(t,n):(r[t]=e.style[t],e.style[t]=n)}),!n&&_se.set(e,r)}function K7e(e,t){if(!(e&&e instanceof HTMLElement))return;let n=_se.get(e);n&&(e.style[t]=n[t])}const Nr=e=>{switch(e){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return e}};function W2(e,t){if(!e)return null;const n=window.getComputedStyle(e),r=n.transform||n.webkitTransform||n.mozTransform;let i=r.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[Nr(t)?13:12]):(i=r.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[Nr(t)?5:4]):null)}function z7e(e){return 8*(Math.log(e+1)-2)}function B6(e,t){if(!e)return()=>{};const n=e.style.cssText;return Object.assign(e.style,t),()=>{e.style.cssText=n}}function W7e(...e){return(...t)=>{for(const n of e)"function"==typeof n&&n(...t)}}const tr={DURATION:.5,EASE:[.32,.72,0,1]},Sse=.4,Y7e=.25,X7e=100,Ese=8,Y2=16,jL=26,H6="vaul-dragging";function wse(e){const t=Te.useRef(e);return Te.useEffect(()=>{t.current=e}),Te.useMemo(()=>(...e)=>null==t.current?void 0:t.current.call(t,...e),[])}function J7e({defaultProp:e,onChange:t}){const n=Te.useState(e),[r]=n,i=Te.useRef(r),o=wse(t);return Te.useEffect(()=>{i.current!==r&&(o(r),i.current=r)},[r,i,o]),n}function Cse({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,i]=J7e({defaultProp:t,onChange:n}),o=void 0!==e,s=o?e:r,a=wse(n);return[s,Te.useCallback(t=>{if(o){const n="function"==typeof t?t(e):t;n!==e&&a(n)}else i(t)},[o,e,i,a])]}function Q7e({activeSnapPointProp:e,setActiveSnapPointProp:t,snapPoints:n,drawerRef:r,overlayRef:i,fadeFromIndex:o,onSnapPointChange:s,direction:a="bottom",container:l,snapToSequentialPoint:c}){const[u,d]=Cse({prop:e,defaultProp:null==n?void 0:n[0],onChange:t}),[h,p]=Te.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);Te.useEffect(()=>{function e(){p({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const f=Te.useMemo(()=>u===(null==n?void 0:n[n.length-1])||null,[n,u]),m=Te.useMemo(()=>{var e;return null!=(e=null==n?void 0:n.findIndex(e=>e===u))?e:null},[n,u]),v=n&&n.length>0&&(o||0===o)&&!Number.isNaN(o)&&n[o]===u||!n,g=Te.useMemo(()=>{const e=l?{width:l.getBoundingClientRect().width,height:l.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var t;return null!=(t=null==n?void 0:n.map(t=>{const n="string"==typeof t;let r=0;if(n&&(r=parseInt(t,10)),Nr(a)){const i=n?r:h?t*e.height:0;return h?"bottom"===a?e.height-i:-e.height+i:i}const i=n?r:h?t*e.width:0;return h?"right"===a?e.width-i:-e.width+i:i}))?t:[]},[n,h,l]),y=Te.useMemo(()=>null!==m?null==g?void 0:g[m]:null,[g,m]),b=Te.useCallback(e=>{var t;const l=null!=(t=null==g?void 0:g.findIndex(t=>t===e))?t:null;s(l),Wr(r.current,{transition:`transform ${tr.DURATION}s cubic-bezier(${tr.EASE.join(",")})`,transform:Nr(a)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`}),g&&l!==g.length-1&&void 0!==o&&l!==o&&l<o?Wr(i.current,{transition:`opacity ${tr.DURATION}s cubic-bezier(${tr.EASE.join(",")})`,opacity:"0"}):Wr(i.current,{transition:`opacity ${tr.DURATION}s cubic-bezier(${tr.EASE.join(",")})`,opacity:"1"}),d(null==n?void 0:n[Math.max(l,0)])},[r.current,n,g,o,i,d]);return Te.useEffect(()=>{if(u||e){var t;const r=null!=(t=null==n?void 0:n.findIndex(t=>t===e||t===u))?t:-1;g&&-1!==r&&"number"==typeof g[r]&&b(g[r])}},[u,e,n,g,b]),{isLastSnapPoint:f,activeSnapPoint:u,shouldFade:v,getPercentageDragged:function(e,t){if(!n||"number"!=typeof m||!g||void 0===o)return null;const r=m===o-1;if(m>=o&&t)return 0;if(r&&!t)return 1;if(!v&&!r)return null;const i=r?m+1:m-1,s=r?g[i]-g[i-1]:g[i+1]-g[i],a=e/Math.abs(s);return r?1-a:a},setActiveSnapPoint:d,activeSnapPointIndex:m,onRelease:function({draggedDistance:e,closeDrawer:t,velocity:r,dismissible:s}){if(void 0===o)return;const l="bottom"===a||"right"===a?(y??0)-e:(y??0)+e,u=0===m,d=e>0;if(m===o-1&&Wr(i.current,{transition:`opacity ${tr.DURATION}s cubic-bezier(${tr.EASE.join(",")})`}),!c&&r>2&&!d)return void(s?t():b(g[0]));if(!c&&r>2&&d&&g&&n)return void b(g[n.length-1]);const h=null==g?void 0:g.reduce((e,t)=>"number"!=typeof e||"number"!=typeof t?e:Math.abs(t-l)<Math.abs(e-l)?t:e),p=Nr(a)?window.innerHeight:window.innerWidth;if(r>.4&&Math.abs(e)<.4*p){const e=d?1:-1;if(e>0&&f&&n)return void b(g[n.length-1]);if(u&&e<0&&s&&t(),null===m)return;return void b(g[m+e])}b(h)},onDrag:function({draggedDistance:e}){if(null===y)return;const t="bottom"===a||"right"===a?y-e:y+e;("bottom"===a||"right"===a)&&t<g[g.length-1]||("top"===a||"left"===a)&&t>g[g.length-1]||Wr(r.current,{transform:Nr(a)?`translate3d(0, ${t}px, 0)`:`translate3d(${t}px, 0, 0)`})},snapPointsOffset:g}}const Z7e=()=>()=>{};function ePe(){const{direction:e,isOpen:t,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:i}=R_(),o=Te.useRef(null),s=_.useMemo(()=>document.body.style.backgroundColor,[]);function a(){return(window.innerWidth-26)/window.innerWidth}Te.useEffect(()=>{if(t&&n){o.current&&clearTimeout(o.current);const t=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!t)return;W7e(r&&!i?B6(document.body,{background:"black"}):Z7e,B6(t,{transformOrigin:Nr(e)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${tr.DURATION}s`,transitionTimingFunction:`cubic-bezier(${tr.EASE.join(",")})`}));const n=B6(t,{borderRadius:"8px",overflow:"hidden",...Nr(e)?{transform:`scale(${a()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${a()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{n(),o.current=window.setTimeout(()=>{s?document.body.style.background=s:document.body.style.removeProperty("background")},1e3*tr.DURATION)}}},[t,n,s])}let P0=null;function tPe({isOpen:e,modal:t,nested:n,hasBeenOpened:r,preventScrollRestoration:i,noBodyStyles:o}){const[s,a]=Te.useState(()=>typeof window<"u"?window.location.href:""),l=Te.useRef(0),c=Te.useCallback(()=>{if(Iq()&&null===P0&&e&&!o){P0={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:e,innerHeight:t}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:-l.current+"px",left:-e+"px",right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const e=t-window.innerHeight;e&&l.current>=t&&(document.body.style.top=-(l.current+e)+"px")}),300)}},[e]),u=Te.useCallback(()=>{if(Iq()&&null!==P0&&!o){const e=-parseInt(document.body.style.top,10),t=-parseInt(document.body.style.left,10);Object.assign(document.body.style,P0),window.requestAnimationFrame(()=>{i&&s!==window.location.href?a(window.location.href):window.scrollTo(t,e)}),P0=null}},[s]);return Te.useEffect(()=>{function e(){l.current=window.scrollY}return e(),window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}},[]),Te.useEffect(()=>{if(t)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||u()}},[t,u]),Te.useEffect(()=>{n||!r||(e?(!window.matchMedia("(display-mode: standalone)").matches&&c(),t||window.setTimeout(()=>{u()},500)):u())},[e,r,s,t,n,c,u]),{restorePositionSetting:u}}function nPe({open:e,onOpenChange:t,children:n,onDrag:r,onRelease:i,snapPoints:o,shouldScaleBackground:s=!1,setBackgroundColorOnScale:a=!0,closeThreshold:l=Y7e,scrollLockTimeout:c=100,dismissible:u=!0,handleOnly:d=!1,fadeFromIndex:h=o&&o.length-1,activeSnapPoint:p,setActiveSnapPoint:f,fixed:m,modal:v=!0,onClose:g,nested:y,noBodyStyles:b=!1,direction:w="bottom",defaultOpen:_=!1,disablePreventScroll:S=!0,snapToSequentialPoint:E=!1,preventScrollRestoration:C=!1,repositionInputs:k=!0,onAnimationEnd:T,container:R,autoFocus:I=!1}){var x,P;const[L=!1,M]=Cse({defaultProp:_,prop:e,onChange:e=>{null==t||t(e),!e&&!y&&ce(),setTimeout(()=>{null==T||T(e)},1e3*tr.DURATION),e&&!v&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),e||(document.body.style.pointerEvents="auto")}}),[O,A]=Te.useState(!1),[D,N]=Te.useState(!1),[j,F]=Te.useState(!1),U=Te.useRef(null),B=Te.useRef(null),H=Te.useRef(null),$=Te.useRef(null),V=Te.useRef(null),q=Te.useRef(!1),G=Te.useRef(null),z=Te.useRef(0),K=Te.useRef(!1),W=Te.useRef(!_),J=Te.useRef(0),Y=Te.useRef(null),X=Te.useRef((null==(x=Y.current)?void 0:x.getBoundingClientRect().height)||0),Q=Te.useRef((null==(P=Y.current)?void 0:P.getBoundingClientRect().width)||0),Z=Te.useRef(0),ee=Te.useCallback(e=>{o&&e===oe.length-1&&(B.current=new Date)},[]),{activeSnapPoint:te,activeSnapPointIndex:ne,setActiveSnapPoint:re,onRelease:ie,snapPointsOffset:oe,onDrag:se,shouldFade:ae,getPercentageDragged:le}=Q7e({snapPoints:o,activeSnapPointProp:p,setActiveSnapPointProp:f,drawerRef:Y,fadeFromIndex:h,overlayRef:U,onSnapPointChange:ee,direction:w,container:R,snapToSequentialPoint:E});B7e({isDisabled:!L||D||!v||j||!O||!k||!S});const{restorePositionSetting:ce}=tPe({isOpen:L,modal:v,nested:y??!1,hasBeenOpened:O,preventScrollRestoration:C,noBodyStyles:b});function ue(){return(window.innerWidth-26)/window.innerWidth}function de(e,t){var n;let r=e;const i=null==(n=window.getSelection())?void 0:n.toString(),o=Y.current?W2(Y.current,w):null,s=new Date;if("SELECT"===r.tagName||r.hasAttribute("data-vaul-no-drag")||r.closest("[data-vaul-no-drag]"))return!1;if("right"===w||"left"===w)return!0;if(B.current&&s.getTime()-B.current.getTime()<500)return!1;if(null!==o&&("bottom"===w?o>0:o<0))return!0;if(i&&i.length>0)return!1;if(V.current&&s.getTime()-V.current.getTime()<c&&0===o||t)return V.current=s,!1;for(;r;){if(r.scrollHeight>r.clientHeight){if(0!==r.scrollTop)return V.current=new Date,!1;if("dialog"===r.getAttribute("role"))return!0}r=r.parentNode}return!0}function he(e){!D||!Y.current||(Y.current.classList.remove(H6),q.current=!1,N(!1),$.current=new Date),null==g||g(),e||M(!1),setTimeout(()=>{o&&re(o[0])},1e3*tr.DURATION)}function pe(){if(!Y.current)return;const e=document.querySelector("[data-vaul-drawer-wrapper]"),t=W2(Y.current,w);Wr(Y.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${tr.DURATION}s cubic-bezier(${tr.EASE.join(",")})`}),Wr(U.current,{transition:`opacity ${tr.DURATION}s cubic-bezier(${tr.EASE.join(",")})`,opacity:"1"}),s&&t&&t>0&&L&&Wr(e,{borderRadius:"8px",overflow:"hidden",...Nr(w)?{transform:`scale(${ue()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${ue()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${tr.DURATION}s`,transitionTimingFunction:`cubic-bezier(${tr.EASE.join(",")})`},!0)}return Te.useEffect(()=>{window.requestAnimationFrame(()=>{W.current=!0})},[]),Te.useEffect(()=>{var e;function t(){if(!Y.current||!k)return;if(UL(document.activeElement)||K.current){var e;const t=(null==(e=window.visualViewport)?void 0:e.height)||0,n=window.innerHeight;let r=n-t;const i=Y.current.getBoundingClientRect().height||0,s=i>.8*n;Z.current||(Z.current=i);const a=Y.current.getBoundingClientRect().top;if(Math.abs(J.current-r)>60&&(K.current=!K.current),o&&o.length>0&&oe&&ne){r+=oe[ne]||0}if(J.current=r,i>t||K.current){const e=Y.current.getBoundingClientRect().height;let n=e;e>t&&(n=t-(s?a:26)),Y.current.style.height=m?e-Math.max(r,0)+"px":`${Math.max(n,t-a)}px`}else M7e()||(Y.current.style.height=`${Z.current}px`);o&&o.length>0&&!K.current?Y.current.style.bottom="0px":Y.current.style.bottom=`${Math.max(r,0)}px`}}return null==(e=window.visualViewport)||e.addEventListener("resize",t),()=>{var e;return null==(e=window.visualViewport)?void 0:e.removeEventListener("resize",t)}},[ne,o,oe]),Te.useEffect(()=>(L&&(Wr(document.documentElement,{scrollBehavior:"auto"}),B.current=new Date),()=>{K7e(document.documentElement,"scrollBehavior")}),[L]),Te.useEffect(()=>{v||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[v]),Te.createElement(bM,{defaultOpen:_,onOpenChange:e=>{!u&&!e||(e?A(!0):he(!0),M(e))},open:L},Te.createElement(gse.Provider,{value:{activeSnapPoint:te,snapPoints:o,setActiveSnapPoint:re,drawerRef:Y,overlayRef:U,onOpenChange:t,onPress:function(e){var t,n;!u&&!o||Y.current&&!Y.current.contains(e.target)||(X.current=(null==(t=Y.current)?void 0:t.getBoundingClientRect().height)||0,Q.current=(null==(n=Y.current)?void 0:n.getBoundingClientRect().width)||0,N(!0),H.current=new Date,vse()&&window.addEventListener("touchend",()=>q.current=!1,{once:!0}),e.target.setPointerCapture(e.pointerId),z.current=Nr(w)?e.pageY:e.pageX)},onRelease:function(e){if(!D||!Y.current)return;Y.current.classList.remove(H6),q.current=!1,N(!1),$.current=new Date;const t=W2(Y.current,w);if(!e||!de(e.target,!1)||!t||Number.isNaN(t)||null===H.current)return;const n=$.current.getTime()-H.current.getTime(),r=z.current-(Nr(w)?e.pageY:e.pageX),s=Math.abs(r)/n;if(s>.05&&(F(!0),setTimeout(()=>{F(!1)},200)),o)return ie({draggedDistance:r*("bottom"===w||"right"===w?1:-1),closeDrawer:he,velocity:s,dismissible:u}),void(null==i||i(e,!0));if("bottom"===w||"right"===w?r>0:r<0)return pe(),void(null==i||i(e,!0));if(s>.4)return he(),void(null==i||i(e,!1));var a;const c=Math.min(null!=(a=Y.current.getBoundingClientRect().height)?a:0,window.innerHeight);var d;const h=Math.min(null!=(d=Y.current.getBoundingClientRect().width)?d:0,window.innerWidth),p="left"===w||"right"===w;if(Math.abs(t)>=(p?h:c)*l)return he(),void(null==i||i(e,!1));null==i||i(e,!0),pe()},onDrag:function(e){if(Y.current&&D){const t="bottom"===w||"right"===w?1:-1,n=(z.current-(Nr(w)?e.pageY:e.pageX))*t,i=n>0,a=o&&!u&&!i;if(a&&0===ne)return;const l=Math.abs(n),c=document.querySelector("[data-vaul-drawer-wrapper]");let d=l/("bottom"===w||"top"===w?X.current:Q.current);const p=le(l,i);if(null!==p&&(d=p),a&&d>=1||!q.current&&!de(e.target,i))return;if(Y.current.classList.add(H6),q.current=!0,Wr(Y.current,{transition:"none"}),Wr(U.current,{transition:"none"}),o&&se({draggedDistance:n}),i&&!o){const e=z7e(n),r=Math.min(-1*e,0)*t;return void Wr(Y.current,{transform:Nr(w)?`translate3d(0, ${r}px, 0)`:`translate3d(${r}px, 0, 0)`})}const f=1-d;if((ae||h&&ne===h-1)&&(null==r||r(e,d),Wr(U.current,{opacity:`${f}`,transition:"none"},!0)),c&&U.current&&s){const e=Math.min(ue()+d*(1-ue()),1),t=8-8*d,n=Math.max(0,14-14*d);Wr(c,{borderRadius:`${t}px`,transform:Nr(w)?`scale(${e}) translate3d(0, ${n}px, 0)`:`scale(${e}) translate3d(${n}px, 0, 0)`,transition:"none"},!0)}if(!o){const e=l*t;Wr(Y.current,{transform:Nr(w)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`})}}},dismissible:u,shouldAnimate:W,handleOnly:d,isOpen:L,isDragging:D,shouldFade:ae,closeDrawer:he,onNestedDrag:function(e,t){if(t<0)return;const n=(window.innerWidth-16)/window.innerWidth,r=n+t*(1-n),i=16*t-16;Wr(Y.current,{transform:Nr(w)?`scale(${r}) translate3d(0, ${i}px, 0)`:`scale(${r}) translate3d(${i}px, 0, 0)`,transition:"none"})},onNestedOpenChange:function(e){const t=e?(window.innerWidth-16)/window.innerWidth:1,n=e?-16:0;G.current&&window.clearTimeout(G.current),Wr(Y.current,{transition:`transform ${tr.DURATION}s cubic-bezier(${tr.EASE.join(",")})`,transform:Nr(w)?`scale(${t}) translate3d(0, ${n}px, 0)`:`scale(${t}) translate3d(${n}px, 0, 0)`}),!e&&Y.current&&(G.current=setTimeout(()=>{const e=W2(Y.current,w);Wr(Y.current,{transition:"none",transform:Nr(w)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`})},500))},onNestedRelease:function(e,t){const n=Nr(w)?window.innerHeight:window.innerWidth,r=t?(n-16)/n:1,i=t?-16:0;t&&Wr(Y.current,{transition:`transform ${tr.DURATION}s cubic-bezier(${tr.EASE.join(",")})`,transform:Nr(w)?`scale(${r}) translate3d(0, ${i}px, 0)`:`scale(${r}) translate3d(${i}px, 0, 0)`})},keyboardIsOpen:K,modal:v,snapPointsOffset:oe,activeSnapPointIndex:ne,direction:w,shouldScaleBackground:s,setBackgroundColorOnScale:a,noBodyStyles:b,container:R,autoFocus:I}},n))}const Tse=Te.forwardRef(function({...e},t){const{overlayRef:n,snapPoints:r,onRelease:i,shouldFade:o,isOpen:s,modal:a,shouldAnimate:l}=R_(),c=bse(t,n),u=r&&r.length>0;if(!a)return null;const d=Te.useCallback(e=>i(e),[i]);return Te.createElement(SM,{onMouseUp:d,ref:c,"data-vaul-overlay":"","data-vaul-snap-points":s&&u?"true":"false","data-vaul-snap-points-overlay":s&&o?"true":"false","data-vaul-animate":null!=l&&l.current?"true":"false",...e})});Tse.displayName="Drawer.Overlay";const Rse=Te.forwardRef(function({onPointerDownOutside:e,style:t,onOpenAutoFocus:n,...r},i){const{drawerRef:o,onPress:s,onRelease:a,onDrag:l,keyboardIsOpen:c,snapPointsOffset:u,activeSnapPointIndex:d,modal:h,isOpen:p,direction:f,snapPoints:m,container:v,handleOnly:g,shouldAnimate:y,autoFocus:b}=R_(),[w,_]=Te.useState(!1),S=bse(i,o),E=Te.useRef(null),C=Te.useRef(null),k=Te.useRef(!1),T=m&&m.length>0;ePe();function R(e){E.current=null,k.current=!1,a(e)}return Te.useEffect(()=>{T&&window.requestAnimationFrame(()=>{_(!0)})},[]),Te.createElement(EM,{"data-vaul-drawer-direction":f,"data-vaul-drawer":"","data-vaul-delayed-snap-points":w?"true":"false","data-vaul-snap-points":p&&T?"true":"false","data-vaul-custom-container":v?"true":"false","data-vaul-animate":null!=y&&y.current?"true":"false",...r,ref:S,style:u&&u.length>0?{"--snap-point-height":`${u[d??0]}px`,...t}:t,onPointerDown:e=>{g||(null==r.onPointerDown||r.onPointerDown.call(r,e),E.current={x:e.pageX,y:e.pageY},s(e))},onOpenAutoFocus:e=>{null==n||n(e),b||e.preventDefault()},onPointerDownOutside:t=>{null==e||e(t),h&&!t.defaultPrevented?c.current&&(c.current=!1):t.preventDefault()},onFocusOutside:e=>{h||e.preventDefault()},onPointerMove:e=>{if(C.current=e,g||(null==r.onPointerMove||r.onPointerMove.call(r,e),!E.current))return;const t=e.pageY-E.current.y,n=e.pageX-E.current.x,i="touch"===e.pointerType?10:2;((e,t,n=0)=>{if(k.current)return!0;const r=Math.abs(e.y),i=Math.abs(e.x),o=i>r,s=["bottom","right"].includes(t)?1:-1;if("left"===t||"right"===t){if(!(e.x*s<0)&&i>=0&&i<=n)return o}else if(!(e.y*s<0)&&r>=0&&r<=n)return!o;return k.current=!0,!0})({x:n,y:t},f,i)?l(e):(Math.abs(n)>i||Math.abs(t)>i)&&(E.current=null)},onPointerUp:e=>{null==r.onPointerUp||r.onPointerUp.call(r,e),E.current=null,k.current=!1,a(e)},onPointerOut:e=>{null==r.onPointerOut||r.onPointerOut.call(r,e),R(C.current)},onContextMenu:e=>{null==r.onContextMenu||r.onContextMenu.call(r,e),C.current&&R(C.current)}})});Rse.displayName="Drawer.Content";const rPe=250,iPe=120,sPe=Te.forwardRef(function({preventCycle:e=!1,children:t,...n},r){const{closeDrawer:i,isDragging:o,snapPoints:s,activeSnapPoint:a,setActiveSnapPoint:l,dismissible:c,handleOnly:u,isOpen:d,onPress:h,onDrag:p}=R_(),f=Te.useRef(null),m=Te.useRef(!1);function v(){f.current&&window.clearTimeout(f.current),m.current=!1}return Te.createElement("div",{onClick:function(){m.current?v():window.setTimeout(()=>{!function(){if(o||e||m.current)return void v();if(v(),!s||0===s.length)return void(c||i());if(a===s[s.length-1]&&c)return void i();const t=s.findIndex(e=>e===a);if(-1===t)return;const n=s[t+1];l(n)}()},120)},onPointerCancel:v,onPointerDown:e=>{u&&h(e),f.current=window.setTimeout(()=>{m.current=!0},250)},onPointerMove:e=>{u&&p(e)},ref:r,"data-vaul-drawer-visible":d?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},Te.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},t))});function oPe(e){const t=R_(),{container:n=t.container,...r}=e;return Te.createElement(_M,{container:n,...r})}sPe.displayName="Drawer.Handle";const Ds={Root:nPe,Content:Rse,Overlay:Tse,Trigger:P7e,Portal:oPe,Title:wM},aPe="_bg_1y38p_8",cPe="_drawer_1y38p_17",lPe="_body_1y38p_51",NC={bg:aPe,drawer:cPe,body:lPe},uPe="_content_vnv5k_8",dPe={content:uPe},TM=_.createContext(null);function RM(){var e;const t=null==(e=globalThis.navigator)?void 0:e.userAgent;return/android/i.test(t)?"android":/iPad|iPhone|iPod|Mac/.test(t)&&"ontouchend"in document?"ios":"other"}const IM=_.forwardRef(({title:e,children:t,className:n,...r},i)=>w.jsx("div",{ref:i,className:Ne(n,NC.drawer),"aria-label":e,"data-platform":RM(),...r,role:"menu",children:w.jsx("div",{className:NC.body,children:t})}));IM.displayName="DrawerMenu";const fPe=({onSelect:e,children:t})=>w.jsx(Hie,{onSelect:e??void 0,asChild:!0,children:t}),hPe=({title:e,showTitle:t=!0,onOpenChange:n,trigger:r,hasAccessibleAlternative:i,children:o})=>{const[s,a]=_.useState(!1),l=_.useCallback(e=>{a(e),null==n||n(e)},[a,n]),c=RM(),u="android"===c||"ios"===c,d=_.useMemo(()=>({MenuItemWrapper:u?null:fPe,onOpenChange:l}),[l]),h=w.jsx(TM.Provider,{value:d,children:o}),p=w.jsx(uLe,{"aria-haspopup":"menu",tabIndex:i?void 0:0,asChild:!0,children:r});return u?w.jsxs(w.Fragment,{children:[w.jsx(hq,{onOpenChange:l,children:p}),w.jsx(Ds.Root,{open:s,onOpenChange:l,children:w.jsxs(Ds.Portal,{children:[w.jsx(Ds.Overlay,{className:Ne(NC.bg)}),w.jsx(Ds.Content,{asChild:!0,children:w.jsx(IM,{title:e,children:h})})]})})]}):w.jsxs(hq,{onOpenChange:l,children:[p,w.jsx(dLe,{children:w.jsx(fLe,{asChild:!0,className:Ne(dPe.content),children:w.jsx(pM,{showTitle:t,title:e,children:h})})})]})},pPe="_glass_sepwu_8",mPe={glass:pPe},Ise=_.forwardRef(({children:e,className:t,...n},r)=>w.jsx("div",{ref:r,className:Ne(t,mPe.glass),...n,children:_.Children.only(e)}));Ise.displayName="Glass";const ml=({as:e="h1",children:t,...n})=>w.jsx(cne,{as:e,type:"heading",...n,children:t}),gPe="_link_1v5rz_8",vPe={link:gPe},yPe=_.forwardRef(function({children:e,className:t,kind:n="primary",size:r="medium",...i},o){return w.jsx("a",{ref:o,...i,rel:"noreferrer noopener",className:Ne(vPe.link,t),"data-kind":n,"data-size":r,children:e})});var kM="DropdownMenu",[bPe,Vot]=Tp(kM,[xT]),ys=xT(),[_Pe,kse]=bPe(kM),xse=e=>{const{__scopeDropdownMenu:t,children:n,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=e,l=ys(t),c=_.useRef(null),[u=!1,d]=hre({prop:i,defaultProp:o,onChange:s});return w.jsx(_Pe,{scope:t,triggerId:dv(),triggerRef:c,contentId:dv(),open:u,onOpenChange:d,onOpenToggle:_.useCallback(()=>d(e=>!e),[d]),modal:a,children:w.jsx(_ie,{...l,open:u,onOpenChange:d,dir:r,modal:a,children:n})})};xse.displayName=kM;var Ase="DropdownMenuTrigger",Lse=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=e,o=kse(Ase,n),s=ys(n);return w.jsx(Sie,{asChild:!0,...s,children:w.jsx(Ar.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:CT(t,o.triggerRef),onPointerDown:Ct(e.onPointerDown,e=>{!r&&0===e.button&&!1===e.ctrlKey&&(o.onOpenToggle(),o.open||e.preventDefault())}),onKeyDown:Ct(e.onKeyDown,e=>{r||(["Enter"," "].includes(e.key)&&o.onOpenToggle(),"ArrowDown"===e.key&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});Lse.displayName=Ase;var SPe="DropdownMenuPortal",Pse=e=>{const{__scopeDropdownMenu:t,...n}=e,r=ys(t);return w.jsx(Eie,{...r,...n})};Pse.displayName=SPe;var Ose="DropdownMenuContent",Mse=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=kse(Ose,n),o=ys(n),s=_.useRef(!1);return w.jsx(wie,{id:i.contentId,"aria-labelledby":i.triggerId,...o,...r,ref:t,onCloseAutoFocus:Ct(e.onCloseAutoFocus,e=>{var t;s.current||null==(t=i.triggerRef.current)||t.focus(),s.current=!1,e.preventDefault()}),onInteractOutside:Ct(e.onInteractOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;(!i.modal||r)&&(s.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Mse.displayName=Ose;var EPe="DropdownMenuGroup",wPe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Cie,{...i,...r,ref:t})});wPe.displayName=EPe;var CPe="DropdownMenuLabel",TPe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Tie,{...i,...r,ref:t})});TPe.displayName=CPe;var RPe="DropdownMenuItem",Dse=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Rie,{...i,...r,ref:t})});Dse.displayName=RPe;var IPe="DropdownMenuCheckboxItem",kPe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Iie,{...i,...r,ref:t})});kPe.displayName=IPe;var xPe="DropdownMenuRadioGroup",APe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(kie,{...i,...r,ref:t})});APe.displayName=xPe;var LPe="DropdownMenuRadioItem",PPe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(xie,{...i,...r,ref:t})});PPe.displayName=LPe;var OPe="DropdownMenuItemIndicator",MPe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Aie,{...i,...r,ref:t})});MPe.displayName=OPe;var DPe="DropdownMenuSeparator",NPe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Lie,{...i,...r,ref:t})});NPe.displayName=DPe;var UPe="DropdownMenuArrow",jPe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Pie,{...i,...r,ref:t})});jPe.displayName=UPe;var FPe="DropdownMenuSubTrigger",$Pe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Oie,{...i,...r,ref:t})});$Pe.displayName=FPe;var BPe="DropdownMenuSubContent",HPe=_.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ys(n);return w.jsx(Mie,{...i,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});HPe.displayName=BPe;var VPe=xse,qPe=Lse,GPe=Pse,KPe=Mse;const zPe=({onSelect:e,children:t})=>w.jsx(Dse,{onSelect:e??void 0,asChild:!0,children:t}),xM=({title:e,showTitle:t=!0,open:n,onOpenChange:r,trigger:i,children:o,side:s="bottom",align:a="center"})=>{const l=RM(),c="android"===l||"ios"===l,u=_.useMemo(()=>({MenuItemWrapper:c?null:zPe,onOpenChange:r}),[r]),d=w.jsx(TM.Provider,{value:u,children:o});return c?w.jsxs(Ds.Root,{open:n,onOpenChange:r,children:[w.jsx(Ds.Trigger,{asChild:!0,children:i}),w.jsxs(Ds.Portal,{children:[w.jsx(Ds.Overlay,{className:Ne(NC.bg)}),w.jsx(Ds.Content,{asChild:!0,children:w.jsx(IM,{title:e,children:d})})]})]}):w.jsxs(VPe,{open:n,onOpenChange:r,children:[w.jsx(qPe,{asChild:!0,children:i}),w.jsx(GPe,{children:w.jsx(KPe,{asChild:!0,side:s,align:a,sideOffset:8,children:w.jsx(pM,{title:e,showTitle:t,children:d})})})]})},WPe="_item_dyt4i_8",YPe="_interactive_dyt4i_26",XPe="_label_dyt4i_34",JPe="_icon_dyt4i_50",QPe="_disabled_dyt4i_118",Nl={item:WPe,interactive:YPe,"no-label":"_no-label_dyt4i_30",label:XPe,"no-icon":"_no-icon_dyt4i_41",icon:JPe,"nav-hint":"_nav-hint_dyt4i_59",disabled:QPe};function Nse(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M8.7 17.3a.95.95 0 0 1-.275-.7q0-.425.275-.7l3.9-3.9-3.9-3.9a.95.95 0 0 1-.275-.7q0-.425.275-.7a.95.95 0 0 1 .7-.275q.425 0 .7.275l4.6 4.6q.15.15.213.325.062.175.062.375t-.062.375a.9.9 0 0 1-.213.325l-4.6 4.6a.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275"})})}Nse.displayName="ChevronRightIcon";const Use=_.forwardRef(Nse),fv=({as:e,className:t,Icon:n,label:r,labelProps:i,onSelect:o,kind:s="primary",children:a,onClick:l,disabled:c,hideChevron:u,...d})=>{const h=e??"button",p=_.useContext(TM),f=_.useCallback(e=>{if(null==l||l(e),null!==o&&null==(null==p?void 0:p.MenuItemWrapper)){const e=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});o(e),e.defaultPrevented||null==p||p.onOpenChange(!1)}},[p,o]),m=_.isValidElement(n),v=n,g=n,y=w.jsxs(h,{role:"menuitem",...d,className:Ne(t,Nl.item,{[Nl.interactive]:null!==o,[Nl["no-label"]]:null===r,[Nl["no-icon"]]:!n,[Nl.disabled]:c}),"data-kind":s,onClick:f,disabled:"button"===h?c:void 0,"aria-disabled":"button"===h?void 0:c,children:[n&&(m?w.jsx(uv,{className:Nl.icon,children:v}):w.jsx(g,{width:24,height:24,className:Nl.icon,"aria-hidden":!0})),null!==r&&w.jsx(on,{className:Nl.label,size:"md",weight:"medium",as:"span",...i,children:r}),!u&&("button"===h||"a"===h)&&w.jsx(Use,{width:8,height:24,className:Nl["nav-hint"],"aria-hidden":!0,viewBox:"8 0 8 24"}),a]});return null==(null==p?void 0:p.MenuItemWrapper)||null===o?y:w.jsx(p.MenuItemWrapper,{onSelect:o,children:y})};var ZPe="Label",jse=_.forwardRef((e,t)=>w.jsx(Ar.label,{...e,ref:t,onMouseDown:t=>{var n;t.target.closest("button, input, select, textarea")||(null==(n=e.onMouseDown)||n.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));jse.displayName=ZPe;var[AM,qot]=Tp("Form"),LM="Form",[eOe,I_]=AM(LM),[tOe,Fse]=AM(LM),$se=_.forwardRef((e,t)=>{const{__scopeForm:n,onClearServerErrors:r=()=>{},...i}=e,o=ps(t,_.useRef(null)),[s,a]=_.useState({}),l=_.useCallback(e=>s[e],[s]),c=_.useCallback((e,t)=>a(n=>({...n,[e]:{...n[e]??{},...t}})),[]),u=_.useCallback(e=>{a(t=>({...t,[e]:void 0})),g(t=>({...t,[e]:{}}))},[]),[d,h]=_.useState({}),p=_.useCallback(e=>d[e]??[],[d]),f=_.useCallback((e,t)=>{h(n=>({...n,[e]:[...n[e]??[],t]}))},[]),m=_.useCallback((e,t)=>{h(n=>({...n,[e]:(n[e]??[]).filter(e=>e.id!==t)}))},[]),[v,g]=_.useState({}),y=_.useCallback(e=>v[e]??{},[v]),b=_.useCallback((e,t)=>{g(n=>({...n,[e]:{...n[e]??{},...t}}))},[]),[S,E]=_.useState({}),C=_.useCallback((e,t)=>{E(n=>{const r=new Set(n[e]).add(t);return{...n,[e]:r}})},[]),k=_.useCallback((e,t)=>{E(n=>{const r=new Set(n[e]);return r.delete(t),{...n,[e]:r}})},[]),T=_.useCallback(e=>Array.from(S[e]??[]).join(" ")||void 0,[S]);return w.jsx(eOe,{scope:n,getFieldValidity:l,onFieldValidityChange:c,getFieldCustomMatcherEntries:p,onFieldCustomMatcherEntryAdd:f,onFieldCustomMatcherEntryRemove:m,getFieldCustomErrors:y,onFieldCustomErrorsChange:b,onFieldValiditionClear:u,children:w.jsx(tOe,{scope:n,onFieldMessageIdAdd:C,onFieldMessageIdRemove:k,getFieldDescription:T,children:w.jsx(Ar.form,{...i,ref:o,onInvalid:Ct(e.onInvalid,e=>{const t=qse(e.currentTarget);t===e.target&&t.focus(),e.preventDefault()}),onSubmit:Ct(e.onSubmit,r,{checkForDefaultPrevented:!1}),onReset:Ct(e.onReset,r)})})})});$se.displayName=LM;var PM="FormField",[nOe,OM]=AM(PM),Bse=_.forwardRef((e,t)=>{const{__scopeForm:n,name:r,serverInvalid:i=!1,...o}=e,s=I_(PM,n).getFieldValidity(r),a=dv();return w.jsx(nOe,{scope:n,id:a,name:r,serverInvalid:i,children:w.jsx(Ar.div,{"data-valid":DM(s,i),"data-invalid":NM(s,i),...o,ref:t})})});Bse.displayName=PM;var FL="FormLabel",Hse=_.forwardRef((e,t)=>{const{__scopeForm:n,...r}=e,i=I_(FL,n),o=OM(FL,n),s=r.htmlFor||o.id,a=i.getFieldValidity(o.name);return w.jsx(jse,{"data-valid":DM(a,o.serverInvalid),"data-invalid":NM(a,o.serverInvalid),...r,ref:t,htmlFor:s})});Hse.displayName=FL;var _w="FormControl",Vse=_.forwardRef((e,t)=>{const{__scopeForm:n,...r}=e,i=I_(_w,n),o=OM(_w,n),s=Fse(_w,n),a=_.useRef(null),l=ps(t,a),c=r.name||o.name,u=r.id||o.id,d=i.getFieldCustomMatcherEntries(c),{onFieldValidityChange:h,onFieldCustomErrorsChange:p,onFieldValiditionClear:f}=i,m=_.useCallback(async e=>{if(Gse(e.validity)){const t=V6(e.validity);return void h(c,t)}const t=e.form?new FormData(e.form):new FormData,n=[e.value,t],r=[],i=[];d.forEach(e=>{fOe(e,n)?i.push(e):hOe(e)&&r.push(e)});const o=r.map(({id:e,match:t})=>[e,t(...n)]),s=Object.fromEntries(o),a=Object.values(s).some(Boolean),l=a;e.setCustomValidity(l?Eb:"");const u=V6(e.validity);if(h(c,u),p(c,s),!a&&i.length>0){const t=i.map(({id:e,match:t})=>t(...n).then(t=>[e,t])),r=await Promise.all(t),o=Object.fromEntries(r),s=Object.values(o).some(Boolean);e.setCustomValidity(s?Eb:"");const a=V6(e.validity);h(c,a),p(c,o)}},[d,c,p,h]);_.useEffect(()=>{const e=a.current;if(e){const t=()=>m(e);return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}},[m]);const v=_.useCallback(()=>{const e=a.current;e&&(e.setCustomValidity(""),f(c))},[c,f]);_.useEffect(()=>{var e;const t=null==(e=a.current)?void 0:e.form;if(t)return t.addEventListener("reset",v),()=>t.removeEventListener("reset",v)},[v]),_.useEffect(()=>{const e=a.current,t=null==e?void 0:e.closest("form");if(t&&o.serverInvalid){const n=qse(t);n===e&&n.focus()}},[o.serverInvalid]);const g=i.getFieldValidity(c);return w.jsx(Ar.input,{"data-valid":DM(g,o.serverInvalid),"data-invalid":NM(g,o.serverInvalid),"aria-invalid":!!o.serverInvalid||void 0,"aria-describedby":s.getFieldDescription(c),title:"",...r,ref:l,id:u,name:c,onInvalid:Ct(e.onInvalid,e=>{const t=e.currentTarget;m(t)}),onChange:Ct(e.onChange,e=>{v()})})});Vse.displayName=_w;var Eb="This value is not valid",rOe={badInput:Eb,patternMismatch:"This value does not match the required pattern",rangeOverflow:"This value is too large",rangeUnderflow:"This value is too small",stepMismatch:"This value does not match the required step",tooLong:"This value is too long",tooShort:"This value is too short",typeMismatch:"This value does not match the required type",valid:void 0,valueMissing:"This value is missing"},k_="FormMessage",iOe=_.forwardRef((e,t)=>{const{match:n,name:r,...i}=e,o=OM(k_,e.__scopeForm),s=r??o.name;return void 0===n?w.jsx(MM,{...i,ref:t,name:s,children:e.children||Eb}):"function"==typeof n?w.jsx(oOe,{match:n,...i,ref:t,name:s}):w.jsx(sOe,{match:n,...i,ref:t,name:s})});iOe.displayName=k_;var sOe=_.forwardRef((e,t)=>{const{match:n,forceMatch:r=!1,name:i,children:o,...s}=e,a=I_(k_,s.__scopeForm).getFieldValidity(i);return r||(null==a?void 0:a[n])?w.jsx(MM,{ref:t,...s,name:i,children:o??rOe[n]}):null}),oOe=_.forwardRef((e,t)=>{const{match:n,forceMatch:r=!1,name:i,id:o,children:s,...a}=e,l=I_(k_,a.__scopeForm),c=ps(t,_.useRef(null)),u=dv(),d=o??u,h=_.useMemo(()=>({id:d,match:n}),[d,n]),{onFieldCustomMatcherEntryAdd:p,onFieldCustomMatcherEntryRemove:f}=l;_.useEffect(()=>(p(i,h),()=>f(i,h.id)),[h,i,p,f]);const m=l.getFieldValidity(i),v=l.getFieldCustomErrors(i)[d];return r||m&&!Gse(m)&&v?w.jsx(MM,{id:d,ref:c,...a,name:i,children:s??Eb}):null}),MM=_.forwardRef((e,t)=>{const{__scopeForm:n,id:r,name:i,...o}=e,s=Fse(k_,n),a=dv(),l=r??a,{onFieldMessageIdAdd:c,onFieldMessageIdRemove:u}=s;return _.useEffect(()=>(c(i,l),()=>u(i,l)),[i,l,c,u]),w.jsx(Ar.span,{id:l,...o,ref:t})}),aOe="FormSubmit",cOe=_.forwardRef((e,t)=>{const{__scopeForm:n,...r}=e;return w.jsx(Ar.button,{type:"submit",...r,ref:t})});function V6(e){const t={};for(const n in e)t[n]=e[n];return t}function lOe(e){return e instanceof HTMLElement}function uOe(e){return"validity"in e}function dOe(e){return uOe(e)&&(!1===e.validity.valid||"true"===e.getAttribute("aria-invalid"))}function qse(e){const t=e.elements,[n]=Array.from(t).filter(lOe).filter(dOe);return n}function fOe(e,t){return"AsyncFunction"===e.match.constructor.name||pOe(e.match,t)}function hOe(e){return"Function"===e.match.constructor.name}function pOe(e,t){return e(...t)instanceof Promise}function Gse(e){let t=!1;for(const n in e){if("valid"!==n&&"customError"!==n&&e[n]){t=!0;break}}return t}function DM(e,t){if(!0===(null==e?void 0:e.valid)&&!t)return!0}function NM(e,t){if(!1===(null==e?void 0:e.valid)||t)return!0}cOe.displayName=aOe;var mOe=$se,gOe=Bse,vOe=Hse,Kse=Vse;const yOe="_container_1e0uz_10",bOe="_input_1e0uz_18",_Oe="_ui_1e0uz_19",q6={container:yOe,input:bOe,ui:_Oe},SOe=_.forwardRef(function({className:e,...t},n){const r=Ne(q6.container,e);return w.jsxs("div",{className:r,children:[w.jsx("input",{ref:n,...t,className:q6.input,type:"radio"}),w.jsx("div",{className:q6.ui})]})}),EOe=_.forwardRef(function(e,t){return w.jsx(Kse,{asChild:!0,children:w.jsx(SOe,{ref:t,...e})})}),wOe="_root_19upo_16",COe="_label_19upo_59",My={root:wOe,"inline-field":"_inline-field_19upo_32","inline-field-body":"_inline-field-body_19upo_38","inline-field-control":"_inline-field-control_19upo_44",label:COe},TOe=_.forwardRef(function({children:e,...t},n){const r=Ne(My.label,t.className);return w.jsx(vOe,{ref:n,...t,className:r,children:e})});var ROe="Separator",Lq="horizontal",IOe=["horizontal","vertical"],zse=_.forwardRef((e,t)=>{const{decorative:n,orientation:r=Lq,...i}=e,o=kOe(r)?r:Lq,s=n?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"};return w.jsx(Ar.div,{"data-orientation":o,...s,...i,ref:t})});function kOe(e){return IOe.includes(e)}zse.displayName=ROe;var xOe=zse;const AOe="_separator_7ckbw_8",LOe={separator:AOe},Pq="--cpd-separator-spacing",UM=_.forwardRef(({className:e,spacing:t,kind:n="primary",...r},i)=>{const o=Ne(LOe.separator,e),s=_.useRef(null),a=Dne([s,i]);return _.useEffect(()=>{var e;const n=null==(e=s.current)?void 0:e.style;t?null==n||n.setProperty(Pq,t):null==n||n.removeProperty(Pq)},[t]),w.jsx(xOe,{...r,className:o,ref:a,"data-kind":n})});UM.displayName="Separator";const POe="_container_19o42_10",OOe="_input_19o42_24",MOe="_ui_19o42_34",G6={container:POe,input:OOe,ui:MOe},Wse=_.forwardRef(function({className:e,...t},n){const r=Ne(G6.container,e);return w.jsxs("div",{className:r,children:[w.jsx("input",{role:"switch",ref:n,className:G6.input,...t,type:"checkbox"}),w.jsx("div",{className:G6.ui})]})});_.forwardRef(function(e,t){return w.jsx(Kse,{asChild:!0,children:w.jsx(Wse,{ref:t,...e})})});const jM=_.forwardRef(function({className:e,Icon:t,label:n,onSelect:r,checked:i,disabled:o,onClick:s},a){const l=_.useId(),c=_.useCallback(()=>{},[]);return w.jsx(fv,{as:"div",role:"menuitemcheckbox","aria-checked":i,className:e,Icon:t,label:n,onSelect:r,disabled:o,onClick:s,children:w.jsx(Wse,{id:l,ref:a,"aria-hidden":!0,checked:i,disabled:o,onChange:c})})});function Yse(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M9.55 17.575q-.2 0-.375-.062a.9.9 0 0 1-.325-.213L4.55 13q-.274-.274-.262-.713.012-.437.287-.712a.95.95 0 0 1 .7-.275q.425 0 .7.275L9.55 15.15l8.475-8.475q.274-.275.713-.275.437 0 .712.275.275.274.275.713 0 .437-.275.712l-9.2 9.2q-.15.15-.325.212a1.1 1.1 0 0 1-.375.063"})})}Yse.displayName="CheckIcon";const Xse=_.forwardRef(Yse),Oq=_.forwardRef(function({children:e,...t},n){const r=Ne(My.root,t.className);return w.jsx(mOe,{ref:n,...t,className:r,children:e})}),DOe=_.forwardRef(function({className:e,control:t,children:n,...r},i){const o=Ne(My["inline-field"],e);return w.jsxs(gOe,{ref:i,...r,className:o,children:[w.jsx("div",{className:My["inline-field-control"],children:t}),w.jsx("div",{className:My["inline-field-body"],children:n})]})}),NOe="_icon_11k6c_18",UOe={icon:NOe};function Jse(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{fillRule:"evenodd",d:"M12 4.031a8 8 0 1 0 8 8 1 1 0 0 1 2 0c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10a1 1 0 1 1 0 2",clipRule:"evenodd"})})}Jse.displayName="SpinnerIcon";const jOe=_.forwardRef(Jse),FOe=_.forwardRef(function({size:e=20,...t},n){return w.jsx(jOe,{ref:n,className:UOe.icon,style:{width:e,height:e},...t})}),$Oe="_button_vczzf_8",BOe="_destructive_vczzf_107",O0={button:$Oe,"icon-only":"_icon-only_vczzf_50","has-icon":"_has-icon_vczzf_57",destructive:BOe},Ft=_.forwardRef(function({as:e,kind:t="primary",size:n="lg",children:r,className:i,iconOnly:o,Icon:s,destructive:a,disabled:l,...c},u){const[d,h]="destructive"===t?["secondary",!0]:[t,a],p=Ne(O0.button,i,{[O0["has-icon"]]:s,[O0["icon-only"]]:o,[O0.destructive]:h}),f=o&&"lg"===n?24:20;return w.jsxs(lne,{...c,as:e||"button",ref:u,className:p,"data-size":n,"data-kind":d,tabIndex:0,disabled:l,children:[s&&w.jsx(s,{width:f,height:f,className:O0.icon,"aria-hidden":!0}),r]})});function Qse(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M12 16q1.875 0 3.188-1.312Q16.5 13.375 16.5 11.5t-1.312-3.187T12 7 8.813 8.313 7.5 11.5t1.313 3.188T12 16m0-1.8q-1.125 0-1.912-.787A2.6 2.6 0 0 1 9.3 11.5q0-1.125.787-1.912A2.6 2.6 0 0 1 12 8.8q1.125 0 1.912.787.788.788.788 1.913t-.787 1.912A2.6 2.6 0 0 1 12 14.2m0 4.8q-3.475 0-6.35-1.837Q2.775 15.324 1.3 12.2a.8.8 0 0 1-.1-.312 3 3 0 0 1 0-.775.8.8 0 0 1 .1-.313q1.475-3.125 4.35-4.962Q8.525 4 12 4t6.35 1.838T22.7 10.8a.8.8 0 0 1 .1.313 3 3 0 0 1 0 .774.8.8 0 0 1-.1.313q-1.475 3.125-4.35 4.963Q15.475 19 12 19m0-2a9.54 9.54 0 0 0 5.188-1.488A9.77 9.77 0 0 0 20.8 11.5a9.77 9.77 0 0 0-3.613-4.012A9.54 9.54 0 0 0 12 6a9.55 9.55 0 0 0-5.187 1.487A9.77 9.77 0 0 0 3.2 11.5a9.77 9.77 0 0 0 3.613 4.012A9.54 9.54 0 0 0 12 17"})})}Qse.displayName="VisibilityOnIcon";const HOe=_.forwardRef(Qse),VOe="_content_o77nw_8",qOe="_destructive_o77nw_34",GOe="_success_o77nw_39",K6={content:VOe,destructive:qOe,success:GOe};function Zse({className:e,size:t="large",destructive:n=!1,success:r=!1,children:i}){return w.jsx("div",{className:Ne(K6.content,e,{[K6.destructive]:n,[K6.success]:r}),"data-size":t,children:Te.Children.only(i)})}const wb={"nav-bar":"_nav-bar_1fp3r_8","nav-bar-items":"_nav-bar-items_1fp3r_14","nav-tab":"_nav-tab_1fp3r_25","nav-item":"_nav-item_1fp3r_47"},KOe=({children:e,className:t,role:n,"aria-label":r,...i})=>{const o=Ne(t,wb["nav-bar"]),s="tablist"!==n?{role:"navigation","aria-label":r}:{role:"presentation"},a="tablist"===n?{role:"tablist","aria-label":r}:{};return w.jsx("nav",{...s,...i,className:o,children:w.jsx("ul",{...a,className:wb["nav-bar-items"],children:e})})},zOe=_.forwardRef(function({children:e,href:t,onClick:n,...r},i){return w.jsx("a",{href:t,onClick:n,className:wb["nav-item"],...r,ref:i,children:e})}),WOe=_.forwardRef(function({children:e,disabled:t,onClick:n,...r},i){return w.jsx("button",{onClick:n,className:wb["nav-item"],disabled:t,ref:i,...r,children:e})}),YOe=e=>"href"in e&&!!e.href,XOe=_.forwardRef(function(e,t){const n=e["aria-controls"],r=n?{"aria-controls":n,role:"tab","aria-selected":e.active}:{"aria-current":!!e.active||void 0},i={...e};let o;if(delete i.active,YOe(i)){const e=t;o=w.jsx(zOe,{...i,...r,ref:e})}else{const e=t;o=w.jsx(WOe,{...i,...r,ref:e})}return w.jsx("li",{className:wb["nav-tab"],"data-current":!!e.active||void 0,role:"presentation",children:o})});function eoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M12 14.95q-.2 0-.375-.062a.9.9 0 0 1-.325-.213l-4.6-4.6a.95.95 0 0 1-.275-.7q0-.425.275-.7a.95.95 0 0 1 .7-.275q.425 0 .7.275l3.9 3.9 3.9-3.9a.95.95 0 0 1 .7-.275q.425 0 .7.275a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7l-4.6 4.6q-.15.15-.325.212a1.1 1.1 0 0 1-.375.063"})})}eoe.displayName="ChevronDownIcon";const JOe=_.forwardRef(eoe);function toe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"m13.3 17.3-4.6-4.6a.9.9 0 0 1-.213-.325A1.1 1.1 0 0 1 8.425 12q0-.2.062-.375A.9.9 0 0 1 8.7 11.3l4.6-4.6a.95.95 0 0 1 .7-.275q.425 0 .7.275a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7L10.8 12l3.9 3.9a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275"})})}toe.displayName="ChevronLeftIcon";const QOe=_.forwardRef(toe);var z6,Mq;function ZOe(){return Mq||(Mq=1,z6={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),z6}var eMe=ZOe();const tMe=ac(eMe);var nMe=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function Dq(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(tMe[n[1]]||"/"===e.charAt(e.length-2))&&(t.voidElement=!0),t.name.startsWith("!--"))){var r=e.indexOf("--\x3e");return{type:"comment",comment:-1!==r?e.slice(4,r):""}}for(var i=new RegExp(nMe),o=null;null!==(o=i.exec(e));)if(o[0].trim())if(o[1]){var s=o[1].trim(),a=[s,""];s.indexOf("=")>-1&&(a=s.split("=")),t.attrs[a[0]]=a[1],i.lastIndex--}else o[2]&&(t.attrs[o[2]]=o[3].trim().substring(1,o[3].length-1));return t}var rMe=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,iMe=/^\s*$/,sMe=Object.create(null);function noe(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(e){var t=[];for(var n in e)t.push(n+'="'+e[n]+'"');return t.length?" "+t.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(noe,"")+"</"+t.name+">";case"comment":return e+"\x3c!--"+t.comment+"--\x3e"}}var oMe={parse:function(e,t){t||(t={}),t.components||(t.components=sMe);var n,r=[],i=[],o=-1,s=!1;if(0!==e.indexOf("<")){var a=e.indexOf("<");r.push({type:"text",content:-1===a?e:e.substring(0,a)})}return e.replace(rMe,function(a,l){if(s){if(a!=="</"+n.name+">")return;s=!1}var c,u="/"!==a.charAt(1),d=a.startsWith("\x3c!--"),h=l+a.length,p=e.charAt(h);if(d){var f=Dq(a);return o<0?(r.push(f),r):((c=i[o]).children.push(f),r)}if(u&&(o++,"tag"===(n=Dq(a)).type&&t.components[n.name]&&(n.type="component",s=!0),n.voidElement||s||!p||"<"===p||n.children.push({type:"text",content:e.slice(h,e.indexOf("<",h))}),0===o&&r.push(n),(c=i[o-1])&&c.children.push(n),i[o]=n),(!u||n.voidElement)&&(o>-1&&(n.voidElement||n.name===a.slice(2,-1))&&(o--,n=-1===o?r:i[o]),!s&&"<"!==p&&p)){c=-1===o?r:i[o].children;var m=e.indexOf("<",h),v=e.slice(h,-1===m?void 0:m);iMe.test(v)&&(v=" "),(m>-1&&o+c.length>=0||" "!==v)&&c.push({type:"text",content:v})}}),r},stringify:function(e){return e.reduce(function(e,t){return e+noe("",t)},"")}};const Sw=(e,t,n,r)=>{var i,o,s,a;const l=[n,{code:t,...r||{}}];if(null!=(o=null==(i=null==e?void 0:e.services)?void 0:i.logger)&&o.forward)return e.services.logger.forward(l,"warn","react-i18next::",!0);ha(l[0])&&(l[0]=`react-i18next:: ${l[0]}`),null!=(a=null==(s=null==e?void 0:e.services)?void 0:s.logger)&&a.warn?e.services.logger.warn(...l):null!=console&&console.warn&&console.warn(...l)},Nq={},Cb=(e,t,n,r)=>{ha(n)&&Nq[n]||(ha(n)&&(Nq[n]=new Date),Sw(e,t,n,r))},roe=(e,t)=>()=>{if(e.isInitialized)t();else{const n=()=>{setTimeout(()=>{e.off("initialized",n)},0),t()};e.on("initialized",n)}},$L=(e,t,n)=>{e.loadNamespaces(t,roe(e,n))},Uq=(e,t,n,r)=>{if(ha(n)&&(n=[n]),e.options.preload&&e.options.preload.indexOf(t)>-1)return $L(e,n,r);n.forEach(t=>{e.options.ns.indexOf(t)<0&&e.options.ns.push(t)}),e.loadLanguages(t,roe(e,r))},aMe=(e,t,n={})=>t.languages&&t.languages.length?t.hasLoadedNamespace(e,{lng:n.lng,precheck:(t,r)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!r(t.isLanguageChangingTo,e))return!1}}):(Cb(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0),ha=e=>"string"==typeof e,zd=e=>"object"==typeof e&&null!==e,cMe=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,lMe={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},uMe=e=>lMe[e],dMe=e=>e.replace(cMe,uMe);let BL={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:dMe};const fMe=(e={})=>{BL={...BL,...e}},ioe=()=>BL;let soe;const hMe=e=>{soe=e},FM=()=>soe,W6=(e,t)=>{var n;if(!e)return!1;const r=(null==(n=e.props)?void 0:n.children)??e.children;return t?r.length>0:!!r},Y6=e=>{var t,n;if(!e)return[];const r=(null==(t=e.props)?void 0:t.children)??e.children;return null!=(n=e.props)&&n.i18nIsDynamicList?ag(r):r},pMe=e=>Array.isArray(e)&&e.every(_.isValidElement),ag=e=>Array.isArray(e)?e:[e],mMe=(e,t)=>{const n={...t};return n.props=Object.assign(e.props,t.props),n},ooe=(e,t,n,r)=>{if(!e)return"";let i="";const o=ag(e),s=null!=t&&t.transSupportBasicHtmlNodes?t.transKeepBasicHtmlNodesFor??[]:[];return o.forEach((e,o)=>{if(ha(e))i+=`${e}`;else{if(_.isValidElement(e)){const{props:a,type:l}=e,c=Object.keys(a).length,u=s.indexOf(l)>-1,d=a.children;if(!d&&u&&!c)return void(i+=`<${l}/>`);if(!d&&(!u||c)||a.i18nIsDynamicList)return void(i+=`<${o}></${o}>`);if(u&&1===c&&ha(d))return void(i+=`<${l}>${d}</${l}>`);const h=ooe(d,t,n,r);return void(i+=`<${o}>${h}</${o}>`)}if(null!==e){if(zd(e)){const{format:t,...o}=e,s=Object.keys(o);if(1===s.length){const e=t?`${s[0]}, ${t}`:s[0];return void(i+=`{{${e}}}`)}return void Sw(n,"TRANS_INVALID_OBJ","Invalid child - Object should only have keys {{ value, format }} (format is optional).",{i18nKey:r,child:e})}Sw(n,"TRANS_INVALID_VAR","Passed in a variable like {number} - pass variables for interpolation as full objects like {{number}}.",{i18nKey:r,child:e})}else Sw(n,"TRANS_NULL_VALUE","Passed in a null value as child",{i18nKey:r})}}),i},gMe=(e,t,n,r,i,o,s)=>{if(""===n)return[];const a=i.transKeepBasicHtmlNodesFor||[],l=n&&new RegExp(a.map(e=>`<${e}`).join("|")).test(n);if(!(e||t||l||s))return[n];const c=t??{},u=e=>{ag(e).forEach(e=>{ha(e)||(W6(e)?u(Y6(e)):zd(e)&&!_.isValidElement(e)&&Object.assign(c,e))})};u(e);const d=oMe.parse(`<0>${n}</0>`),h={...c,...o},p=(e,t,n)=>{var r;const i=Y6(e),o=m(i,t.children,n);return pMe(i)&&0===o.length||null!=(r=e.props)&&r.i18nIsDynamicList?i:o},f=(e,t,n,r,i)=>{e.dummy?(e.children=t,n.push(_.cloneElement(e,{key:r},i?void 0:t))):n.push(..._.Children.map([e],e=>{const n={...e.props};return delete n.i18nIsDynamicList,_.createElement(e.type,{...n,key:r,ref:e.props.ref??e.ref},i?null:t)}))},m=(e,n,o)=>{const c=ag(e);return ag(n).reduce((e,n,u)=>{var d,v;const g=(null==(v=null==(d=n.children)?void 0:d[0])?void 0:v.content)&&r.services.interpolator.interpolate(n.children[0].content,h,r.language);if("tag"===n.type){let s=c[parseInt(n.name,10)];!s&&t&&(s=t[n.name]),1===o.length&&!s&&(s=o[0][n.name]),s||(s={});const d=0!==Object.keys(n.attrs).length?mMe({props:n.attrs},s):s,v=_.isValidElement(d),y=v&&W6(n,!0)&&!n.voidElement,b=l&&zd(d)&&d.dummy&&!v,w=zd(t)&&Object.hasOwnProperty.call(t,n.name);if(ha(d)){const t=r.services.interpolator.interpolate(d,h,r.language);e.push(t)}else if(W6(d)||y){const t=p(d,n,o);f(d,t,e,u)}else if(b){const t=m(c,n.children,o);f(d,t,e,u)}else if(Number.isNaN(parseFloat(n.name)))if(w){const t=p(d,n,o);f(d,t,e,u,n.voidElement)}else if(i.transSupportBasicHtmlNodes&&a.indexOf(n.name)>-1)if(n.voidElement)e.push(_.createElement(n.name,{key:`${n.name}-${u}`}));else{const t=m(c,n.children,o);e.push(_.createElement(n.name,{key:`${n.name}-${u}`},t))}else if(n.voidElement)e.push(`<${n.name} />`);else{const t=m(c,n.children,o);e.push(`<${n.name}>${t}</${n.name}>`)}else if(zd(d)&&!v){const t=n.children[0]?g:null;t&&e.push(t)}else f(d,g,e,u,1!==n.children.length||!g)}else if("text"===n.type){const t=i.transWrapTextNodes,o=s?i.unescape(r.services.interpolator.interpolate(n.content,h,r.language)):r.services.interpolator.interpolate(n.content,h,r.language);t?e.push(_.createElement(t,{key:`${n.name}-${u}`},o)):e.push(o)}return e},[])},v=m([{dummy:!0,children:e||[]}],d,ag(e||[]));return Y6(v[0])},aoe=(e,t,n)=>{const r=e.key||t,i=_.cloneElement(e,{key:r});if(!i.props||!i.props.children||n.indexOf(`${t}/>`)<0&&n.indexOf(`${t} />`)<0)return i;return _.createElement(function(){return _.createElement(_.Fragment,null,i)},{key:r})},vMe=(e,t)=>e.map((e,n)=>aoe(e,n,t)),yMe=(e,t)=>{const n={};return Object.keys(e).forEach(r=>{Object.assign(n,{[r]:aoe(e[r],r,t)})}),n},bMe=(e,t,n,r)=>e?Array.isArray(e)?vMe(e,t):zd(e)?yMe(e,t):(Cb(n,"TRANS_INVALID_COMPONENTS",'<Trans /> "components" prop expects an object or array',{i18nKey:r}),null):null,_Me=e=>!(!zd(e)||Array.isArray(e))&&Object.keys(e).reduce((e,t)=>e&&Number.isNaN(Number.parseFloat(t)),!0);function SMe({children:e,count:t,parent:n,i18nKey:r,context:i,tOptions:o={},values:s,defaults:a,components:l,ns:c,i18n:u,t:d,shouldUnescape:h,...p}){var f,m,v,g,y,b;const w=u||FM();if(!w)return Cb(w,"NO_I18NEXT_INSTANCE","Trans: You need to pass in an i18next instance using i18nextReactModule",{i18nKey:r}),e;const S=d||w.t.bind(w)||(e=>e),E={...ioe(),...null==(f=w.options)?void 0:f.react};let C=c||S.ns||(null==(m=w.options)?void 0:m.defaultNS);C=ha(C)?[C]:C||["translation"];const k=ooe(e,E,w,r),T=a||k||E.transEmptyNodeValue||r,{hashTransKey:R}=E,I=r||(R?R(k||T):k||T);null!=(g=null==(v=w.options)?void 0:v.interpolation)&&g.defaultVariables&&(s=s&&Object.keys(s).length>0?{...s,...w.options.interpolation.defaultVariables}:{...w.options.interpolation.defaultVariables});const x=!s&&(void 0===t||null!=(b=null==(y=w.options)?void 0:y.interpolation)&&b.alwaysFormat)&&e?{interpolation:{...o.interpolation,prefix:"#$?",suffix:"?$#"}}:o.interpolation,P={...o,context:i||o.context,count:t,...s,...x,defaultValue:T,ns:C},L=I?S(I,P):T,M=bMe(l,L,w,r);let O=M||e,A=null;_Me(M)&&(A=M,O=e);const D=gMe(O,A,L,w,E,P,h),N=n??E.defaultTransParent;return N?_.createElement(N,p,D):D}const EMe={type:"3rdParty",init(e){fMe(e.options.react),hMe(e)}},coe=_.createContext();class wMe{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(e=>{this.usedNamespaces[e]||(this.usedNamespaces[e]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function Vs({children:e,count:t,parent:n,i18nKey:r,context:i,tOptions:o={},values:s,defaults:a,components:l,ns:c,i18n:u,t:d,shouldUnescape:h,...p}){var f;const{i18n:m,defaultNS:v}=_.useContext(coe)||{},g=u||m||FM(),y=d||(null==g?void 0:g.t.bind(g));return SMe({children:e,count:t,parent:n,i18nKey:r,context:i,tOptions:o,values:s,defaults:a,components:l,ns:c||(null==y?void 0:y.ns)||v||(null==(f=null==g?void 0:g.options)?void 0:f.defaultNS),i18n:g,t:d,shouldUnescape:h,...p})}const CMe=(e,t)=>{const n=_.useRef();return _.useEffect(()=>{n.current=e},[e,t]),n.current},loe=(e,t,n,r)=>e.getFixedT(t,n,r),TMe=(e,t,n,r)=>_.useCallback(loe(e,t,n,r),[e,t,n,r]),Je=(e,t={})=>{var n,r,i,o;const{i18n:s}=t,{i18n:a,defaultNS:l}=_.useContext(coe)||{},c=s||a||FM();if(c&&!c.reportNamespaces&&(c.reportNamespaces=new wMe),!c){Cb(c,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const e=(e,t)=>ha(t)?t:zd(t)&&ha(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e,t=[e,{},!1];return t.t=e,t.i18n={},t.ready=!1,t}null!=(n=c.options.react)&&n.wait&&Cb(c,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const u={...ioe(),...c.options.react,...t},{useSuspense:d,keyPrefix:h}=u;let p=l||(null==(r=c.options)?void 0:r.defaultNS);p=ha(p)?[p]:p||["translation"],null==(o=(i=c.reportNamespaces).addUsedNamespaces)||o.call(i,p);const f=(c.isInitialized||c.initializedStoreOnce)&&p.every(e=>aMe(e,c,u)),m=TMe(c,t.lng||null,"fallback"===u.nsMode?p:p[0],h),v=()=>m,g=()=>loe(c,t.lng||null,"fallback"===u.nsMode?p:p[0],h),[y,b]=_.useState(v);let w=p.join();t.lng&&(w=`${t.lng}${w}`);const S=CMe(w),E=_.useRef(!0);_.useEffect(()=>{const{bindI18n:e,bindI18nStore:n}=u;E.current=!0,!f&&!d&&(t.lng?Uq(c,t.lng,p,()=>{E.current&&b(g)}):$L(c,p,()=>{E.current&&b(g)})),f&&S&&S!==w&&E.current&&b(g);const r=()=>{E.current&&b(g)};return e&&(null==c||c.on(e,r)),n&&(null==c||c.store.on(n,r)),()=>{E.current=!1,c&&e&&(null==e||e.split(" ").forEach(e=>c.off(e,r))),n&&c&&n.split(" ").forEach(e=>c.store.off(e,r))}},[c,w]),_.useEffect(()=>{E.current&&f&&b(v)},[c,h,f]);const C=[y,c,f];if(C.t=y,C.i18n=c,C.ready=f,f||!f&&!d)return C;throw new Promise(e=>{t.lng?Uq(c,t.lng,p,()=>e()):$L(c,p,()=>e())})};function uoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{fillRule:"evenodd",d:"m12 4.236-6 3V12c0 5.156 4.239 7.254 6 7.898 1.761-.644 6-2.742 6-7.898V7.236zm-.894-1.789a2 2 0 0 1 1.788 0l6 3A2 2 0 0 1 20 7.236V12c0 6.742-5.773 9.246-7.51 9.846-.32.111-.66.111-.98 0C9.774 21.246 4 18.743 4 12V7.236a2 2 0 0 1 1.106-1.789z",clipRule:"evenodd"})})}uoe.displayName="AdminIcon";const RMe=_.forwardRef(uoe);function doe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"m12 10.775-3.9 3.9a.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275.95.95 0 0 1-.275-.7q0-.425.275-.7l4.6-4.6q.15-.15.325-.212Q11.8 8.4 12 8.4t.375.063a.9.9 0 0 1 .325.212l4.6 4.6a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275z"})})}doe.displayName="ChevronUpIcon";const IMe=_.forwardRef(doe);function foe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M12 11.034a1 1 0 0 0 .29.702l.005.005c.18.18.43.29.705.29h8a1 1 0 0 0 0-2h-5.586L22 3.445a1 1 0 0 0-1.414-1.414L14 8.617V3.031a1 1 0 1 0-2 0zm0 1.963a1 1 0 0 0-.29-.702l-.005-.004A1 1 0 0 0 11 12H3a1 1 0 1 0 0 2h5.586L2 20.586A1 1 0 1 0 3.414 22L10 15.414V21a1 1 0 0 0 2 0z"})})}foe.displayName="CollapseIcon";const hoe=_.forwardRef(foe);function poe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M7 21q-.824 0-1.412-.587A1.93 1.93 0 0 1 5 19V6a.97.97 0 0 1-.713-.287A.97.97 0 0 1 4 5q0-.424.287-.713A.97.97 0 0 1 5 4h4q0-.424.287-.712A.97.97 0 0 1 10 3h4q.424 0 .713.288Q15 3.575 15 4h4q.424 0 .712.287Q20 4.576 20 5t-.288.713A.97.97 0 0 1 19 6v13q0 .824-.587 1.413A1.93 1.93 0 0 1 17 21zM7 6v13h10V6zm2 10q0 .424.287.712Q9.576 17 10 17t.713-.288A.97.97 0 0 0 11 16V9a.97.97 0 0 0-.287-.713A.97.97 0 0 0 10 8a.97.97 0 0 0-.713.287A.97.97 0 0 0 9 9zm4 0q0 .424.287.712.288.288.713.288.424 0 .713-.288A.97.97 0 0 0 15 16V9a.97.97 0 0 0-.287-.713A.97.97 0 0 0 14 8a.97.97 0 0 0-.713.287A.97.97 0 0 0 13 9z"})})}poe.displayName="DeleteIcon";const kMe=_.forwardRef(poe);function moe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{fillRule:"evenodd",d:"M15.706 2.637a2 2 0 0 1 2.829 0l2.828 2.828a2 2 0 0 1 0 2.829L9.605 20.052a1 1 0 0 1-.465.263L3.483 21.73a1 1 0 0 1-1.212-1.213l1.414-5.657a1 1 0 0 1 .263-.465zm1.224 7.262L14.102 7.07l-8.544 8.544-.943 3.771 3.771-.943z",clipRule:"evenodd"})})}moe.displayName="EditIcon";const jq=_.forwardRef(moe);function goe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"m2.765 16.02-2.47-2.416A1.02 1.02 0 0 1 0 12.852q0-.456.295-.751a15.6 15.6 0 0 1 5.316-3.786A15.9 15.9 0 0 1 12 7q3.355 0 6.39 1.329a16 16 0 0 1 5.315 3.772q.295.294.295.751t-.295.752l-2.47 2.416a1.047 1.047 0 0 1-1.396.108l-3.114-2.363a1.1 1.1 0 0 1-.322-.376 1.1 1.1 0 0 1-.108-.483v-2.27a13.6 13.6 0 0 0-2.12-.524C13.459 9.996 12 9.937 12 9.937s-1.459.059-2.174.175q-1.074.174-2.121.523v2.271q0 .268-.108.483a1.1 1.1 0 0 1-.322.376l-3.114 2.363a1.047 1.047 0 0 1-1.396-.107"})})}goe.displayName="EndCallIcon";const voe=_.forwardRef(goe);function yoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M21 3.997a1 1 0 0 0-.29-.702l-.005-.004A1 1 0 0 0 20 3h-8a1 1 0 1 0 0 2h5.586L5 17.586V12a1 1 0 1 0-2 0v8.003a1 1 0 0 0 .29.702l.005.004c.18.18.43.291.705.291h8a1 1 0 1 0 0-2H6.414L19 6.414V12a1 1 0 1 0 2 0z"})})}yoe.displayName="ExpandIcon";const boe=_.forwardRef(yoe);function _oe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M4 11a.97.97 0 0 1-.712-.287A.97.97 0 0 1 3 10V4q0-.424.288-.712A.97.97 0 0 1 4 3h6q.424 0 .713.288Q11 3.575 11 4v6q0 .424-.287.713A.97.97 0 0 1 10 11zm5-2V5H5v4zm5 12a.97.97 0 0 1-.713-.288A.97.97 0 0 1 13 20v-6q0-.424.287-.713A.97.97 0 0 1 14 13h6q.424 0 .712.287.288.288.288.713v6q0 .424-.288.712A.97.97 0 0 1 20 21zm5-2v-4h-4v4zM4 21a.97.97 0 0 1-.712-.288A.97.97 0 0 1 3 20v-6q0-.424.288-.713A.97.97 0 0 1 4 13h6q.424 0 .713.287.287.288.287.713v6q0 .424-.287.712A.97.97 0 0 1 10 21zm5-2v-4H5v4zm5-8a.97.97 0 0 1-.713-.287A.97.97 0 0 1 13 10V4q0-.424.287-.712A.97.97 0 0 1 14 3h6q.424 0 .712.288Q21 3.575 21 4v6q0 .424-.288.713A.97.97 0 0 1 20 11zm5-2V5h-4v4z"})})}_oe.displayName="GridIcon";const xMe=_.forwardRef(_oe);function Soe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{d:"M16.713 6.713A.97.97 0 0 1 16 7a.97.97 0 0 1-.713-.287A.97.97 0 0 1 15 6q0-.424.287-.713A.97.97 0 0 1 16 5q.424 0 .712.287Q17 5.576 17 6t-.288.713"}),w.jsx("path",{fillRule:"evenodd",d:"M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zm12 2H6v4h12zM6 12v-2h12v2zm0 2v2h12v-2zm0 6v-2h12v2z",clipRule:"evenodd"})]})}Soe.displayName="HostIcon";const AMe=_.forwardRef(Soe);function Eoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M12 19.071q-1.467 1.467-3.536 1.467-2.067 0-3.535-1.467t-1.467-3.535q0-2.07 1.467-3.536L7.05 9.879q.3-.3.707-.3t.707.3.301.707-.3.707l-2.122 2.121a2.9 2.9 0 0 0-.884 2.122q0 1.237.884 2.12.884.885 2.121.885t2.122-.884l2.121-2.121q.3-.3.707-.3t.707.3.3.707q0 .405-.3.707zm-1.414-4.243q-.3.3-.707.301a.97.97 0 0 1-.707-.3q-.3-.3-.301-.708 0-.405.3-.707l4.243-4.242q.3-.3.707-.3t.707.3.3.707-.3.707zm6.364-.707q-.3.3-.707.3a.97.97 0 0 1-.707-.3q-.3-.3-.301-.707 0-.405.3-.707l2.122-2.121q.884-.885.884-2.121 0-1.238-.884-2.122a2.9 2.9 0 0 0-2.121-.884q-1.237 0-2.122.884l-2.121 2.122q-.3.3-.707.3a.97.97 0 0 1-.707-.3q-.3-.3-.3-.708 0-.405.3-.707L12 4.93q1.467-1.467 3.536-1.467t3.535 1.467 1.467 3.536T19.071 12z"})})}Eoe.displayName="LinkIcon";const LMe=_.forwardRef(Eoe);function woe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M6 22q-.825 0-1.412-.587A1.93 1.93 0 0 1 4 20V10q0-.825.588-1.412a2 2 0 0 1 .702-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 1 1-1.414 1.414l-.896-.896A1.94 1.94 0 0 1 18 22zm14-4.834V10q0-.825-.587-1.412A1.93 1.93 0 0 0 18 8h-1V6q0-2.075-1.463-3.537Q14.075 1 12 1T8.463 2.463a4.9 4.9 0 0 0-1.22 1.946L9 6.166V6q0-1.25.875-2.125A2.9 2.9 0 0 1 12 3q1.25 0 2.125.875T15 6v2h-4.166z"})})}woe.displayName="LockOffIcon";const PMe=_.forwardRef(woe);function Coe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M6 22q-.824 0-1.412-.587A1.93 1.93 0 0 1 4 20V10q0-.825.588-1.412A1.93 1.93 0 0 1 6 8h1V6q0-2.075 1.463-3.537Q9.926 1 12 1q2.075 0 3.537 1.463Q17 3.925 17 6v2h1q.824 0 1.413.588Q20 9.175 20 10v10q0 .824-.587 1.413A1.93 1.93 0 0 1 18 22zM9 8h6V6q0-1.25-.875-2.125A2.9 2.9 0 0 0 12 3q-1.25 0-2.125.875A2.9 2.9 0 0 0 9 6z"})})}Coe.displayName="LockSolidIcon";const OMe=_.forwardRef(Coe);function Toe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M8 8v-.006l6.831 6.832-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.95 7.95 0 0 1 13 19.938V21a1 1 0 0 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5zm9.417 6.583 1.478 1.477A7.96 7.96 0 0 0 20 12a1 1 0 0 0-2 0c0 .925-.21 1.8-.583 2.583M8.073 5.238l7.793 7.793q.132-.495.134-1.031V6a4 4 0 0 0-7.927-.762"})})}Toe.displayName="MicOffSolidIcon";const Roe=_.forwardRef(Toe);function Ioe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{fillRule:"evenodd",d:"M8 8v-.006l2 2V10l3.414 3.414.003-.003 1.414 1.415-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.95 7.95 0 0 1 13 19.938V21a1 1 0 1 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5z",clipRule:"evenodd"}),w.jsx("path",{d:"M14 6v5.166l1.866 1.866q.132-.496.134-1.032V6a4 4 0 0 0-7.928-.762L10 7.166V6a2 2 0 1 1 4 0m3.417 8.583 1.477 1.477A7.96 7.96 0 0 0 20 12a1 1 0 1 0-2 0c0 .925-.21 1.8-.583 2.583"})]})}Ioe.displayName="MicOffIcon";const MMe=_.forwardRef(Ioe);function koe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{d:"M8 6a4 4 0 1 1 8 0v6a4 4 0 0 1-8 0z"}),w.jsx("path",{d:"M5 11a1 1 0 0 1 1 1 6 6 0 0 0 12 0 1 1 0 1 1 2 0 8 8 0 0 1-7 7.938V21a1 1 0 1 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 0 1 1-1"})]})}koe.displayName="MicOnSolidIcon";const $M=_.forwardRef(koe);function xoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414l4.113 4.114a5.5 5.5 0 0 0-.184 1.07A5.002 5.002 0 0 0 7 20h10.172l1.914 1.914A1 1 0 1 0 20.5 20.5l-.979-.979.004-.001L7.145 7.14l-.002.003zm18.5 12a4.48 4.48 0 0 1-.928 2.738L8.637 5.803A5.47 5.47 0 0 1 11.5 5a5.49 5.49 0 0 1 4.25 2.008 4 4 0 0 1 4.187 4.708A4.5 4.5 0 0 1 22 15.5"})})}xoe.displayName="OfflineIcon";const DMe=_.forwardRef(xoe);function Aoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M6 14q-.824 0-1.412-.588A1.93 1.93 0 0 1 4 12q0-.825.588-1.412A1.93 1.93 0 0 1 6 10q.824 0 1.412.588Q8 11.175 8 12t-.588 1.412A1.93 1.93 0 0 1 6 14m6 0q-.825 0-1.412-.588A1.93 1.93 0 0 1 10 12q0-.825.588-1.412A1.93 1.93 0 0 1 12 10q.825 0 1.412.588Q14 11.175 14 12t-.588 1.412A1.93 1.93 0 0 1 12 14m6 0q-.824 0-1.413-.588A1.93 1.93 0 0 1 16 12q0-.825.587-1.412A1.93 1.93 0 0 1 18 10q.824 0 1.413.588Q20 11.175 20 12t-.587 1.412A1.93 1.93 0 0 1 18 14"})})}Aoe.displayName="OverflowHorizontalIcon";const NMe=_.forwardRef(Aoe);function Loe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{d:"M5 3h6a1 1 0 1 1 0 2H5v14h14v-6a1 1 0 1 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2"}),w.jsx("path",{d:"M15 3h5a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V6.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L17.586 5H15a1 1 0 1 1 0-2"})]})}Loe.displayName="PopOutIcon";const Poe=_.forwardRef(Loe);function Ooe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M11 3a1 1 0 1 1 2 0v8.5a.5.5 0 0 0 1 0V4a1 1 0 1 1 2 0v10.2l3.284-2.597a1.081 1.081 0 0 1 1.47 1.577c-.613.673-1.214 1.367-1.818 2.064-1.267 1.463-2.541 2.934-3.943 4.235A6 6 0 0 1 5 15V7a1 1 0 0 1 1.999 0v5.5a.5.5 0 0 0 1 0V4a1 1 0 0 1 2 0v7.5a.5.5 0 0 0 1 0z"})})}Ooe.displayName="RaisedHandSolidIcon";const Moe=_.forwardRef(Ooe);function Doe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{fillRule:"evenodd",d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10m3.536-6.464a1 1 0 0 0-1.415-1.415A3 3 0 0 1 12 15a3 3 0 0 1-2.121-.879 1 1 0 1 0-1.414 1.415A5 5 0 0 0 12 17c1.38 0 2.632-.56 3.536-1.464M10 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m5.5 1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3",clipRule:"evenodd"})})}Doe.displayName="ReactionSolidIcon";const UMe=_.forwardRef(Doe);function Noe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M12.731 2C13.432 2 14 2.568 14 3.269c0 .578.396 1.074.935 1.286q.128.052.253.106c.531.23 1.162.16 1.572-.25a1.27 1.27 0 0 1 1.794 0l1.034 1.035a1.27 1.27 0 0 1 0 1.794c-.41.41-.48 1.04-.248 1.572l.105.253c.212.539.708.935 1.286.935.701 0 1.269.568 1.269 1.269v1.462c0 .701-.568 1.269-1.269 1.269-.578 0-1.074.396-1.287.935q-.05.128-.104.253c-.232.531-.161 1.162.248 1.572a1.27 1.27 0 0 1 0 1.794l-1.034 1.034a1.27 1.27 0 0 1-1.794 0c-.41-.41-1.04-.48-1.572-.248a8 8 0 0 1-.253.105c-.539.212-.935.708-.935 1.286 0 .701-.568 1.269-1.269 1.269H11.27c-.702 0-1.27-.568-1.27-1.269 0-.578-.396-1.074-.935-1.287a8 8 0 0 1-.253-.104c-.531-.232-1.162-.161-1.572.248a1.27 1.27 0 0 1-1.794 0l-1.034-1.034a1.27 1.27 0 0 1 0-1.794c.41-.41.48-1.04.249-1.572a8 8 0 0 1-.106-.253C4.343 14.396 3.847 14 3.27 14 2.568 14 2 13.432 2 12.731V11.27c0-.702.568-1.27 1.269-1.27.578 0 1.074-.396 1.286-.935q.052-.128.106-.253c.23-.531.16-1.162-.25-1.572a1.27 1.27 0 0 1 0-1.794l1.035-1.034a1.27 1.27 0 0 1 1.794 0c.41.41 1.04.48 1.572.249a8 8 0 0 1 .253-.106c.539-.212.935-.708.935-1.286C10 2.568 10.568 2 11.269 2zM12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8"})})}Noe.displayName="SettingsSolidIcon";const jMe=_.forwardRef(Noe);function Uoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M1.288 20.713Q1.575 21 2 21h20q.424 0 .712-.288A.97.97 0 0 0 23 20a.97.97 0 0 0-.288-.712A.97.97 0 0 0 22 19H2a.97.97 0 0 0-.712.288A.97.97 0 0 0 1 20q0 .424.288.712m1.3-3.299A1.93 1.93 0 0 1 2 16V5q0-.824.587-1.412A1.93 1.93 0 0 1 4 3h16q.824 0 1.413.587Q22 4.176 22 5v11q0 .824-.587 1.413A1.93 1.93 0 0 1 20 18H4q-.824 0-1.412-.587m10.12-10.12a1 1 0 0 0-1.415 0l-2.5 2.5a1 1 0 0 0 1.414 1.414l.793-.793V13a1 1 0 1 0 2 0v-2.586l.793.793a1 1 0 0 0 1.414-1.414z"})})}Uoe.displayName="ShareScreenSolidIcon";const FMe=_.forwardRef(Uoe);function joe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M12 16a.97.97 0 0 1-.713-.287A.97.97 0 0 1 11 15V7.85L9.125 9.725q-.3.3-.7.3T7.7 9.7a.93.93 0 0 1-.288-.713A.98.98 0 0 1 7.7 8.3l3.6-3.6q.15-.15.325-.213.175-.062.375-.062t.375.062a.9.9 0 0 1 .325.213l3.6 3.6q.3.3.287.712a.98.98 0 0 1-.287.688q-.3.3-.713.313a.93.93 0 0 1-.712-.288L13 7.85V15q0 .424-.287.713A.97.97 0 0 1 12 16m-6 4q-.824 0-1.412-.587A1.93 1.93 0 0 1 4 18v-2q0-.424.287-.713A.97.97 0 0 1 5 15q.424 0 .713.287Q6 15.576 6 16v2h12v-2q0-.424.288-.713A.97.97 0 0 1 19 15q.424 0 .712.287.288.288.288.713v2q0 .824-.587 1.413A1.93 1.93 0 0 1 18 20z"})})}joe.displayName="ShareIcon";const $Me=_.forwardRef(joe);function Foe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M5 5h14v8h-5a1 1 0 0 0-1 1v5H5zm10 14v-4h4v4zM5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2"})})}Foe.displayName="SpotlightIcon";const BMe=_.forwardRef(Foe);function $oe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{d:"M16.293 2.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-2 2a1 1 0 1 1-1.414-1.414L16.586 6H6a2 2 0 0 0-2 2v7a1 1 0 1 1-2 0V8a4 4 0 0 1 4-4h10.586l-.293-.293a1 1 0 0 1 0-1.414M18 18H7.414l.293-.293a1 1 0 1 0-1.414-1.414l-2 2a1 1 0 0 0 0 1.414l2 2a1 1 0 0 0 1.414-1.414L7.414 20H18a4 4 0 0 0 4-4V9a1 1 0 1 0-2 0v7a2 2 0 0 1-2 2"}),w.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6"})]})}$oe.displayName="SwitchCameraSolidIcon";const HMe=_.forwardRef($oe);function Boe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M12.999 13.012v-.005zm-9.411 7.401Q4.175 21 5 21h14q.824 0 1.413-.587Q21 19.825 21 19V5q0-.824-.587-1.412A1.93 1.93 0 0 0 19 3H5q-.824 0-1.412.587A1.93 1.93 0 0 0 3 5v14q0 .824.587 1.413M12 9a1 1 0 0 0-1 1 1 1 0 1 1-2 0 3 3 0 1 1 4.44 2.633 1.4 1.4 0 0 0-.383.288.3.3 0 0 0-.057.085A1 1 0 0 1 11 13c0-.58.253-1.047.539-1.38.281-.33.63-.572.94-.742A1 1 0 0 0 12 9m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})}Boe.displayName="UnknownSolidIcon";const VMe=_.forwardRef(Boe);function Hoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M10 12q-1.65 0-2.825-1.175T6 8t1.175-2.825T10 4t2.825 1.175T14 8t-1.175 2.825T10 12m-8 6v-.8q0-.85.438-1.562.437-.713 1.162-1.088a14.8 14.8 0 0 1 3.15-1.163A13.8 13.8 0 0 1 10 13q1.65 0 3.25.387 1.6.388 3.15 1.163.724.375 1.163 1.087Q18 16.35 18 17.2v.8q0 .824-.587 1.413A1.93 1.93 0 0 1 16 20H4q-.824 0-1.412-.587A1.93 1.93 0 0 1 2 18m2 0h12v-.8a.97.97 0 0 0-.5-.85q-1.35-.675-2.725-1.012a11.6 11.6 0 0 0-5.55 0Q5.85 15.675 4.5 16.35a.97.97 0 0 0-.5.85zm6-8q.825 0 1.412-.588Q12 8.826 12 8q0-.824-.588-1.412A1.93 1.93 0 0 0 10 6q-.825 0-1.412.588A1.93 1.93 0 0 0 8 8q0 .825.588 1.412Q9.175 10 10 10m7 1h2v2q0 .424.288.713.287.287.712.287.424 0 .712-.287A.97.97 0 0 0 21 13v-2h2q.424 0 .712-.287A.97.97 0 0 0 24 10a.97.97 0 0 0-.288-.713A.97.97 0 0 0 23 9h-2V7a.97.97 0 0 0-.288-.713A.97.97 0 0 0 20 6a.97.97 0 0 0-.712.287A.97.97 0 0 0 19 7v2h-2a.97.97 0 0 0-.712.287A.97.97 0 0 0 16 10q0 .424.288.713.287.287.712.287"})})}Hoe.displayName="UserAddIcon";const qMe=_.forwardRef(Hoe);function Voe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{d:"M9.175 13.825Q10.35 15 12 15t2.825-1.175T16 11t-1.175-2.825T12 7 9.175 8.175 8 11t1.175 2.825m4.237-1.412A1.93 1.93 0 0 1 12 13q-.825 0-1.412-.588A1.93 1.93 0 0 1 10 11q0-.825.588-1.412A1.93 1.93 0 0 1 12 9q.825 0 1.412.588Q14 10.175 14 11t-.588 1.412"}),w.jsx("path",{d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10m-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0"}),w.jsx("path",{d:"M16.23 18.792a13 13 0 0 0-1.455-.455 11.6 11.6 0 0 0-5.55 0q-.73.18-1.455.455a8 8 0 0 1-1.729-1.454q1.336-.618 2.709-.95A13.8 13.8 0 0 1 12 16q1.65 0 3.25.387 1.373.333 2.709.95a8 8 0 0 1-1.73 1.455"})]})}Voe.displayName="UserProfileIcon";const qoe=_.forwardRef(Voe);function Goe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M2.747 2.753 4.35 4.355l.007-.003L18 17.994v.012l3.247 3.247a1 1 0 0 1-1.414 1.414l-2.898-2.898A2 2 0 0 1 16 20H6a4 4 0 0 1-4-4V8c0-.892.292-1.715.785-2.38L1.333 4.166a1 1 0 0 1 1.414-1.414M18 15.166 6.834 4H16a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715z"})})}Goe.displayName="VideoCallOffSolidIcon";const GMe=_.forwardRef(Goe);function Koe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M6 4h10a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715V18a2 2 0 0 1-2 2H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4"})})}Koe.displayName="VideoCallSolidIcon";const zoe=_.forwardRef(Koe);function Woe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"m20.958 16.374.039 3.527q0 .427-.33.756-.33.33-.756.33a16 16 0 0 1-6.57-1.105 16.2 16.2 0 0 1-5.563-3.663 16.1 16.1 0 0 1-3.653-5.573 16.3 16.3 0 0 1-1.115-6.56q0-.427.33-.757T4.095 3l3.528.039a1.07 1.07 0 0 1 1.085.93l.543 3.954q.039.271-.039.504a1.1 1.1 0 0 1-.271.426l-1.64 1.64q.505 1.008 1.154 1.909c.433.6 1.444 1.696 1.444 1.696s1.095 1.01 1.696 1.444q.9.65 1.909 1.153l1.64-1.64q.193-.193.426-.27t.504-.04l3.954.543q.406.059.668.359t.262.727"})})}Woe.displayName="VoiceCallSolidIcon";const KMe=_.forwardRef(Woe);function Yoe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("g",{clipPath:"url(#a)",children:w.jsx("path",{fillRule:"evenodd",d:"M8.929 15.1a13.6 13.6 0 0 0 4.654 3.066q2.62 1.036 5.492.923h.008l.003-.004.003-.002-.034-3.124-3.52-.483-1.791 1.792-.645-.322a13.5 13.5 0 0 1-3.496-2.52 13.4 13.4 0 0 1-2.52-3.496l-.322-.644 1.792-1.792-.483-3.519-3.123-.034-.003.002-.003.004v.002a13.65 13.65 0 0 0 .932 5.492A13.4 13.4 0 0 0 8.93 15.1m3.92 4.926a15.6 15.6 0 0 1-5.334-3.511 15.4 15.4 0 0 1-3.505-5.346 15.6 15.6 0 0 1-1.069-6.274 1.93 1.93 0 0 1 .589-1.366c.366-.366.84-.589 1.386-.589h.01l3.163.035a1.96 1.96 0 0 1 1.958 1.694v.005l.487 3.545v.003c.043.297.025.605-.076.907a2 2 0 0 1-.485.773l-.762.762a11.4 11.4 0 0 0 3.206 3.54q.457.33.948.614l.762-.761a2 2 0 0 1 .774-.486c.302-.1.61-.118.907-.076l3.553.487a1.96 1.96 0 0 1 1.694 1.958l.034 3.174c0 .546-.223 1.02-.588 1.386-.361.36-.827.582-1.363.588a15.3 15.3 0 0 1-6.29-1.062",clipRule:"evenodd"})}),w.jsx("defs",{children:w.jsx("clipPath",{id:"a",children:w.jsx("path",{d:"M0 0h24v24H0z"})})})]})}Yoe.displayName="VoiceCallIcon";const zMe=_.forwardRef(Yoe);function Xoe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2l3.293 3.293c.63.63 1.707.184 1.707-.707v-3.758l7.086 7.086A1 1 0 0 0 20.5 20.5l-2.136-2.136.003-.003-1.414-1.414-.003.003-1.414-1.414.003-.003-1.415-1.415-.002.003L12 12v-.006L7.503 7.497 7.5 7.5zm11.496 8.662 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 3 3 0 0 1 .874 2.284m3.164 3.165 1.462 1.46A8.96 8.96 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.98 6.98 0 0 1 19 12a7 7 0 0 1-.84 3.326M8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707z"})})}Xoe.displayName="VolumeOffSolidIcon";const WMe=_.forwardRef(Xoe);function Joe(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"m3.5 3.5 4 4 .003-.003L8.917 8.91l-.003.003L10 10v-.006l2 2V12l2.122 2.121.002-.003 1.415 1.415-.003.003 1.414 1.414.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414L12 14.828v3.758c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h.172L2.086 4.914A1 1 0 0 1 3.5 3.5M7.172 10H5v4h2.828L10 16.17v-3.343zm7.824 2.162 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 3 3 0 0 1 .874 2.284m3.164 3.165 1.462 1.46A8.96 8.96 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.98 6.98 0 0 1 19 12a7 7 0 0 1-.84 3.326M8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707z"})})}Joe.displayName="VolumeOffIcon";const YMe=_.forwardRef(Joe);function Qoe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{d:"M3 14v-4a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2m11.122-5.536a1 1 0 0 1 1.414 0A5 5 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.536a1 1 0 0 1-1.415-1.415 3 3 0 0 0 .88-2.121c0-.829-.335-1.577-.88-2.121a1 1 0 0 1 0-1.415"}),w.jsx("path",{d:"M16.95 5.636a1 1 0 0 1 1.414 0A8.98 8.98 0 0 1 21 12a8.98 8.98 0 0 1-2.636 6.364 1 1 0 0 1-1.414-1.414A6.98 6.98 0 0 0 19 12a6.98 6.98 0 0 0-2.05-4.95 1 1 0 0 1 0-1.414"})]})}Qoe.displayName="VolumeOnSolidIcon";const XMe=_.forwardRef(Qoe);function Zoe(e,t){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[w.jsx("path",{d:"M3 10a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2zm4.828 4L10 16.172V7.828L7.828 10H5v4zm6.294-5.536a1 1 0 0 1 1.414 0A5 5 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.535a1 1 0 1 1-1.415-1.414 3 3 0 0 0 .88-2.121c0-.829-.335-1.578-.88-2.122a1 1 0 0 1 0-1.414"}),w.jsx("path",{d:"M18.364 5.636A1 1 0 1 0 16.95 7.05 6.98 6.98 0 0 1 19 12a6.98 6.98 0 0 1-2.05 4.95 1 1 0 0 0 1.414 1.414A8.98 8.98 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364"})]})}Zoe.displayName="VolumeOnIcon";const JMe=_.forwardRef(Zoe);function eae(e,t){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:w.jsx("path",{d:"M4 20q-.824 0-1.412-.587A1.93 1.93 0 0 1 2 18V6q0-.824.587-1.412A1.93 1.93 0 0 1 4 4h16q.824 0 1.413.588Q22 5.175 22 6v12q0 .824-.587 1.413A1.93 1.93 0 0 1 20 20zm0-2h16V8H4z"})})}eae.displayName="WebBrowserIcon";const QMe=_.forwardRef(eae),ZMe="_header_p1omj_8",e8e="_nav_p1omj_18",t8e="_headerLogo_p1omj_26",n8e="_leftNav_p1omj_33",r8e="_hideMobile_p1omj_33",i8e="_rightNav_p1omj_45",s8e="_roomHeaderInfo_p1omj_61",o8e="_roomAvatar_p1omj_76",a8e="_nameLine_p1omj_81",c8e="_participantsLine_p1omj_100",aa={header:ZMe,nav:e8e,headerLogo:t8e,leftNav:n8e,hideMobile:r8e,rightNav:i8e,roomHeaderInfo:s8e,roomAvatar:o8e,nameLine:a8e,participantsLine:c8e},l8e=(e,t)=>_.createElement("svg",{width:260,height:30,viewBox:"0 0 260 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("desc",null,"Element Call (Beta)"),_.createElement("circle",{cx:15,cy:15,r:13,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30ZM12.2579 6.98923C12.2579 6.38376 12.7497 5.89292 13.3565 5.89292C17.4687 5.89292 20.8024 9.21967 20.8024 13.3234C20.8024 13.9289 20.3106 14.4197 19.7038 14.4197C19.0971 14.4197 18.6052 13.9289 18.6052 13.3234C18.6052 10.4306 16.2553 8.08554 13.3565 8.08554C12.7497 8.08554 12.2579 7.59471 12.2579 6.98923ZM24.1066 13.3235C24.1066 12.7181 23.6148 12.2272 23.008 12.2272C22.4013 12.2272 21.9094 12.7181 21.9094 13.3235C21.9094 16.2163 19.5595 18.5614 16.6607 18.5614C16.0539 18.5614 15.5621 19.0523 15.5621 19.6577C15.5621 20.2632 16.0539 20.754 16.6607 20.754C20.7729 20.754 24.1066 17.4273 24.1066 13.3235ZM17.7601 23.011C17.7601 23.6164 17.2682 24.1073 16.6615 24.1073C12.5492 24.1073 9.21553 20.7805 9.21553 16.6768C9.21553 16.0713 9.70739 15.5805 10.3141 15.5805C10.9209 15.5805 11.4127 16.0713 11.4127 16.6768C11.4127 19.5696 13.7627 21.9146 16.6615 21.9146C17.2682 21.9146 17.7601 22.4055 17.7601 23.011ZM5.89281 16.6769C5.89281 17.2824 6.38466 17.7732 6.9914 17.7732C7.59813 17.7732 8.08999 17.2824 8.08999 16.6769C8.08999 13.7841 10.4399 11.439 13.3388 11.439C13.9455 11.439 14.4373 10.9482 14.4373 10.3427C14.4373 9.73722 13.9455 9.24639 13.3388 9.24639C9.22647 9.24639 5.89281 12.5731 5.89281 16.6769Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M53.5406 17.258H42.8052C42.932 18.3814 43.3397 19.2782 44.0282 19.9486C44.7167 20.6009 45.6227 20.927 46.746 20.927C47.4889 20.927 48.1593 20.7459 48.7572 20.3835C49.3551 20.0211 49.7809 19.5319 50.0346 18.9159H53.296C52.8611 20.3472 52.0458 21.5068 50.8499 22.3947C49.6722 23.2644 48.2771 23.6992 46.6645 23.6992C44.5627 23.6992 42.8596 23.0016 41.555 21.6065C40.2686 20.2114 39.6254 18.4448 39.6254 16.3068C39.6254 14.2231 40.2776 12.4747 41.5822 11.0614C42.8867 9.64814 44.5718 8.94151 46.6373 8.94151C48.7029 8.94151 50.3698 9.63908 51.6381 11.0342C52.9245 12.4112 53.5677 14.1506 53.5677 16.2524L53.5406 17.258ZM46.6373 11.5778C45.6227 11.5778 44.7801 11.8767 44.1098 12.4747C43.4394 13.0726 43.0226 13.8698 42.8596 14.8663H50.3607C50.2158 13.8698 49.8172 13.0726 49.1649 12.4747C48.5126 11.8767 47.6701 11.5778 46.6373 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M55.7934 19.1605V2.9895H59.0276V19.2148C59.0276 19.9396 59.4262 20.302 60.2234 20.302L60.7941 20.2748V23.3459C60.4861 23.4003 60.16 23.4274 59.8157 23.4274C58.4206 23.4274 57.3969 23.0741 56.7446 22.3675C56.1104 21.6609 55.7934 20.5919 55.7934 19.1605Z",fill:"currentColor"}),_.createElement("path",{d:"M75.8563 17.258H65.121C65.2478 18.3814 65.6555 19.2782 66.344 19.9486C67.0325 20.6009 67.9384 20.927 69.0618 20.927C69.8047 20.927 70.4751 20.7459 71.073 20.3835C71.6709 20.0211 72.0967 19.5319 72.3503 18.9159H75.6117C75.1769 20.3472 74.3615 21.5068 73.1657 22.3947C71.988 23.2644 70.5928 23.6992 68.9803 23.6992C66.8785 23.6992 65.1753 23.0016 63.8708 21.6065C62.5843 20.2114 61.9411 18.4448 61.9411 16.3068C61.9411 14.2231 62.5934 12.4747 63.898 11.0614C65.2025 9.64814 66.8875 8.94151 68.9531 8.94151C71.0186 8.94151 72.6855 9.63908 73.9539 11.0342C75.2403 12.4112 75.8835 14.1506 75.8835 16.2524L75.8563 17.258ZM68.9531 11.5778C67.9384 11.5778 67.0959 11.8767 66.4255 12.4747C65.7551 13.0726 65.3384 13.8698 65.1753 14.8663H72.6765C72.5315 13.8698 72.1329 13.0726 71.4806 12.4747C70.8284 11.8767 69.9859 11.5778 68.9531 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M90.448 15.274V23.3731H87.2138V14.9207C87.2138 12.7827 86.326 11.7137 84.5503 11.7137C83.59 11.7137 82.82 12.0217 82.2402 12.6377C81.6785 13.2538 81.3977 14.0963 81.3977 15.1653V23.3731H78.1635V9.26764H81.1531V11.1429C81.4973 10.5088 82.0228 9.98333 82.7294 9.5666C83.436 9.14987 84.3148 8.94151 85.3657 8.94151C87.3225 8.94151 88.7358 9.68438 89.6055 11.1701C90.8013 9.68438 92.3958 8.94151 94.3888 8.94151C96.0376 8.94151 97.3059 9.45789 98.1937 10.4907C99.0816 11.5053 99.5255 12.8461 99.5255 14.513V23.3731H96.2913V14.9207C96.2913 12.7827 95.4035 11.7137 93.6278 11.7137C92.6494 11.7137 91.8703 12.0308 91.2905 12.6649C90.7288 13.2809 90.448 14.1506 90.448 15.274Z",fill:"currentColor"}),_.createElement("path",{d:"M115.61 17.258H104.874C105.001 18.3814 105.409 19.2782 106.097 19.9486C106.786 20.6009 107.692 20.927 108.815 20.927C109.558 20.927 110.228 20.7459 110.826 20.3835C111.424 20.0211 111.85 19.5319 112.104 18.9159H115.365C114.93 20.3472 114.115 21.5068 112.919 22.3947C111.741 23.2644 110.346 23.6992 108.734 23.6992C106.632 23.6992 104.929 23.0016 103.624 21.6065C102.338 20.2114 101.694 18.4448 101.694 16.3068C101.694 14.2231 102.347 12.4747 103.651 11.0614C104.956 9.64814 106.641 8.94151 108.706 8.94151C110.772 8.94151 112.439 9.63908 113.707 11.0342C114.994 12.4112 115.637 14.1506 115.637 16.2524L115.61 17.258ZM108.706 11.5778C107.692 11.5778 106.849 11.8767 106.179 12.4747C105.508 13.0726 105.092 13.8698 104.929 14.8663H112.43C112.285 13.8698 111.886 13.0726 111.234 12.4747C110.582 11.8767 109.739 11.5778 108.706 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M120.906 9.26764V11.1429C121.232 10.5269 121.767 10.0105 122.51 9.59378C123.271 9.15893 124.186 8.94151 125.255 8.94151C126.922 8.94151 128.208 9.44883 129.114 10.4635C130.038 11.4781 130.5 12.828 130.5 14.513V23.3731H127.266V14.9207C127.266 13.9242 127.03 13.1451 126.559 12.5834C126.106 12.0036 125.409 11.7137 124.467 11.7137C123.434 11.7137 122.619 12.0217 122.021 12.6377C121.441 13.2538 121.151 14.1053 121.151 15.1925V23.3731H117.917V9.26764H120.906Z",fill:"currentColor"}),_.createElement("path",{d:"M139.946 20.4922V23.2915C139.547 23.4003 138.985 23.4546 138.261 23.4546C135.507 23.4546 134.13 22.0685 134.13 19.2964V11.8496H131.982V9.26764H134.13V5.5986H137.364V9.26764H140V11.8496H137.364V18.9702C137.364 20.0755 137.889 20.6281 138.94 20.6281L139.946 20.4922Z",fill:"currentColor"}),_.createElement("path",{d:"M148.304 20.864C146.768 19.184 146 17.056 146 14.48C146 11.904 146.768 9.784 148.304 8.12C149.856 6.44 151.896 5.6 154.424 5.6C156.504 5.6 158.264 6.176 159.704 7.328C161.144 8.48 162.064 10.024 162.464 11.96H160.616C160.28 10.52 159.552 9.376 158.432 8.528C157.312 7.68 155.976 7.256 154.424 7.256C152.44 7.256 150.84 7.92 149.624 9.248C148.424 10.576 147.824 12.32 147.824 14.48C147.824 16.64 148.424 18.384 149.624 19.712C150.84 21.04 152.44 21.704 154.424 21.704C155.976 21.704 157.312 21.28 158.432 20.432C159.552 19.584 160.28 18.44 160.616 17H162.464C162.064 18.936 161.144 20.48 159.704 21.632C158.264 22.784 156.504 23.36 154.424 23.36C151.896 23.36 149.856 22.528 148.304 20.864Z",fill:"currentColor"}),_.createElement("path",{d:"M173.63 17.192C171.438 17.192 169.942 17.24 169.142 17.336C168.358 17.416 167.782 17.552 167.414 17.744C166.758 18.112 166.43 18.704 166.43 19.52C166.43 21.088 167.358 21.872 169.214 21.872C170.638 21.872 171.726 21.552 172.478 20.912C173.246 20.272 173.63 19.416 173.63 18.344V17.192ZM169.022 23.288C167.63 23.288 166.566 22.952 165.83 22.28C165.11 21.592 164.75 20.688 164.75 19.568C164.75 18.832 164.942 18.176 165.326 17.6C165.726 17.024 166.27 16.6 166.958 16.328C167.534 16.104 168.278 15.96 169.19 15.896C170.102 15.816 171.582 15.776 173.63 15.776V14.984C173.63 12.968 172.478 11.96 170.174 11.96C168.19 11.96 167.038 12.768 166.718 14.384H165.062C165.238 13.2 165.742 12.256 166.574 11.552C167.422 10.848 168.646 10.496 170.246 10.496C171.958 10.496 173.23 10.896 174.062 11.696C174.91 12.496 175.334 13.6 175.334 15.008V23H173.702V21.224C172.854 22.6 171.294 23.288 169.022 23.288Z",fill:"currentColor"}),_.createElement("path",{d:"M179.418 20.312V5H181.122V20.12C181.122 20.616 181.202 20.96 181.362 21.152C181.538 21.344 181.85 21.44 182.298 21.44L182.778 21.392V22.952C182.506 23 182.21 23.024 181.89 23.024C180.242 23.024 179.418 22.12 179.418 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M185.582 20.312V5H187.286V20.12C187.286 20.616 187.366 20.96 187.526 21.152C187.702 21.344 188.014 21.44 188.462 21.44L188.942 21.392V22.952C188.67 23 188.374 23.024 188.054 23.024C186.406 23.024 185.582 22.12 185.582 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M201 10C201 5.58172 204.582 2 209 2H252C256.418 2 260 5.58172 260 10V20C260 24.4183 256.418 28 252 28H209C204.582 28 201 24.4183 201 20V10Z",fill:"#368BD6"}),_.createElement("path",{d:"M212.076 20H216.492C218.99 20 220.215 18.7269 220.215 17.0277C220.215 15.3764 219.043 14.407 217.882 14.3484V14.2418C218.947 13.9915 219.789 13.2457 219.789 11.9194C219.789 10.2947 218.617 9.09091 216.252 9.09091H212.076V20ZM214.052 18.3487V15.1527H216.231C217.451 15.1527 218.207 15.8984 218.207 16.8732C218.207 17.7415 217.61 18.3487 216.178 18.3487H214.052ZM214.052 13.7305V10.7209H216.05C217.211 10.7209 217.813 11.3335 217.813 12.1751C217.813 13.1339 217.035 13.7305 216.007 13.7305H214.052ZM221.934 20H229.072V18.3434H223.911V15.3658H228.662V13.7092H223.911V10.7475H229.03V9.09091H221.934V20ZM230.566 10.7475H233.938V20H235.898V10.7475H239.27V9.09091H230.566V10.7475ZM241.031 20L241.931 17.31H246.032L246.938 20H249.047L245.201 9.09091H242.762L238.921 20H241.031ZM242.464 15.7227L243.939 11.3281H244.024L245.5 15.7227H242.464Z",fill:"white"})),u8e=_.forwardRef(l8e);var Jv=(e=>(e.XS="xs",e.SM="sm",e.MD="md",e.LG="lg",e.XL="xl",e))(Jv||{});const d8e=new Map([["xs",22],["sm",32],["md",36],["lg",42],["xl",90]]);function f8e(e,t,n=96){const r=Math.floor(n*window.devicePixelRatio),i=Math.floor(n*window.devicePixelRatio),o=n<=96?"crop":"scale";return t?e.mxcUrlToHttp(t,r,i,o,!1,!0,!0):null}const Qv=({className:e,id:t,name:n,src:r,size:i="md",style:o,...s})=>{const a=Zv(),l=_.useMemo(()=>Object.values(Jv).includes(i)?d8e.get(i):i,[i]),[c,u]=_.useState(void 0);return _.useEffect(()=>{if("valid"!==(null==a?void 0:a.state))return;const{authenticated:e,supportedFeatures:t}=a,n=null==e?void 0:e.client;if(!(n&&r&&l&&t.thumbnails))return;const i=n.getAccessToken();if(!i)return;const o=f8e(n,r,l);if(!o)return void u(void 0);let s;return fetch(o,{headers:{Authorization:`Bearer ${i}`}}).then(async e=>e.blob()).then(e=>{s=URL.createObjectURL(e),u(s)}).catch(e=>{u(void 0)}),()=>{s&&URL.revokeObjectURL(s)}},[a,r,l]),w.jsx(yxe,{className:e,id:t,name:n,size:`${l}px`,src:c,style:o,...s})},h8e="_lock_zf62g_8",p8e={lock:h8e},m8e=({encrypted:e})=>{const{t}=Je(),n=e?OMe:PMe,r=t(e?"common.encrypted":"common.unencrypted");return w.jsx(Fi,{label:r,placement:"right",isTriggerInteractive:!1,children:w.jsx(n,{width:16,height:16,className:p8e.lock,"data-encrypted":e})})};function DT(e){const t=_.useMemo(()=>window.matchMedia(e),[e]),n=_.useCallback(e=>(t.addEventListener("change",e),()=>t.removeEventListener("change",e)),[t]),r=_.useCallback(()=>t.matches,[t]);return _.useSyncExternalStore(n,r)}const g8e="_banner_sye6n_8",v8e={banner:g8e},y8e=({children:e,className:t,...n})=>{const{t:r}=Je(),i=Zv();let o=!1;return"valid"===(null==i?void 0:i.state)&&(o=i.disconnected),w.jsx(w.Fragment,{children:o&&w.jsxs("div",{className:Ne(v8e.banner,t),...n,children:[e,r("disconnected_banner")]})})},Bu=({ref:e,children:t,className:n,disconnectedBanner:r=!0,...i})=>w.jsxs(w.Fragment,{children:[w.jsx("header",{ref:e,className:Ne(aa.header,n),...i,children:t}),r&&w.jsx(y8e,{})]});Bu.displayName="Header";const Df=({children:e,className:t,hideMobile:n,...r})=>w.jsx("div",{className:Ne(aa.nav,aa.leftNav,{[aa.hideMobile]:n},t),...r,children:e}),Nf=({children:e,className:t,hideMobile:n,...r})=>w.jsx("div",{className:Ne(aa.nav,aa.rightNav,{[aa.hideMobile]:n},t),...r,children:e}),cp=({className:e})=>{const{t}=Je();return w.jsx(iT,{className:Ne(aa.headerLogo,e),to:"/","aria-label":t("header_label"),children:w.jsx(u8e,{})})},tae=({id:e,name:t,avatarUrl:n,encrypted:r,participantCount:i})=>{const{t:o}=Je(),s=DT("(max-width: 550px)")?"sm":"lg";return w.jsxs("div",{className:aa.roomHeaderInfo,"data-size":s,children:[w.jsx(Qv,{className:aa.roomAvatar,id:e,name:t,size:"sm"===s?Jv.SM:56,src:n??void 0}),w.jsxs("div",{className:aa.nameLine,children:[w.jsx(ml,{type:"sm"===s?"body":"heading",size:"sm"===s?"lg":"md",weight:"semibold","data-testid":"roomHeader_roomName",children:t}),w.jsx(m8e,{encrypted:r})]}),(i??0)>0&&w.jsxs("div",{className:aa.participantsLine,children:[w.jsx(qoe,{width:20,height:20,"aria-label":o("header_participants_label")}),w.jsx(on,{as:"span",size:"sm",weight:"medium","data-testid":"roomHeader_participants_count",children:o("participant_count",{count:i??0})})]})]})},b8e="_page_fvtgn_8",_8e="_container_fvtgn_20",S8e="_content_fvtgn_28",X6={page:b8e,container:_8e,content:S8e};var nae="object"==typeof global&&global&&global.Object===Object&&global,E8e="object"==typeof self&&self&&self.Object===Object&&self,uc=nae||E8e||Function("return this")(),Sf=uc.Symbol,rae=Object.prototype,w8e=rae.hasOwnProperty,C8e=rae.toString,M0=Sf?Sf.toStringTag:void 0;function T8e(e){var t=w8e.call(e,M0),n=e[M0];try{e[M0]=void 0;var r=!0}catch{}var i=C8e.call(e);return r&&(t?e[M0]=n:delete e[M0]),i}var R8e=Object.prototype,I8e=R8e.toString;function k8e(e){return I8e.call(e)}var x8e="[object Null]",A8e="[object Undefined]",Fq=Sf?Sf.toStringTag:void 0;function kp(e){return null==e?void 0===e?A8e:x8e:Fq&&Fq in Object(e)?T8e(e):k8e(e)}function Ef(e){return null!=e&&"object"==typeof e}var L8e="[object Symbol]";function NT(e){return"symbol"==typeof e||Ef(e)&&kp(e)==L8e}function iae(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var sc=Array.isArray,$q=Sf?Sf.prototype:void 0,Bq=$q?$q.toString:void 0;function sae(e){if("string"==typeof e)return e;if(sc(e))return iae(e,sae)+"";if(NT(e))return Bq?Bq.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}var P8e=/\s/;function O8e(e){for(var t=e.length;t--&&P8e.test(e.charAt(t)););return t}var M8e=/^\s+/;function D8e(e){return e&&e.slice(0,O8e(e)+1).replace(M8e,"")}function zs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Hq=NaN,N8e=/^[-+]0x[0-9a-f]+$/i,U8e=/^0b[01]+$/i,j8e=/^0o[0-7]+$/i,F8e=parseInt;function Vq(e){if("number"==typeof e)return e;if(NT(e))return Hq;if(zs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=zs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=D8e(e);var n=U8e.test(e);return n||j8e.test(e)?F8e(e.slice(2),n?2:8):N8e.test(e)?Hq:+e}function BM(e){return e}var $8e="[object AsyncFunction]",B8e="[object Function]",H8e="[object GeneratorFunction]",V8e="[object Proxy]";function HM(e){if(!zs(e))return!1;var t=kp(e);return t==B8e||t==H8e||t==$8e||t==V8e}var J6=uc["__core-js_shared__"],qq=function(){var e=/[^.]+$/.exec(J6&&J6.keys&&J6.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function q8e(e){return!!qq&&qq in e}var G8e=Function.prototype,K8e=G8e.toString;function xp(e){if(null!=e){try{return K8e.call(e)}catch{}try{return e+""}catch{}}return""}var z8e=/[\\^$.*+?()[\]{}|]/g,W8e=/^\[object .+?Constructor\]$/,Y8e=Function.prototype,X8e=Object.prototype,J8e=Y8e.toString,Q8e=X8e.hasOwnProperty,Z8e=RegExp("^"+J8e.call(Q8e).replace(z8e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function e9e(e){return!(!zs(e)||q8e(e))&&(HM(e)?Z8e:W8e).test(xp(e))}function t9e(e,t){return null==e?void 0:e[t]}function Ap(e,t){var n=t9e(e,t);return e9e(n)?n:void 0}var HL=Ap(uc,"WeakMap"),Gq=Object.create,n9e=function(){function e(){}return function(t){if(!zs(t))return{};if(Gq)return Gq(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function r9e(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function i9e(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var s9e=800,o9e=16,a9e=Date.now;function c9e(e){var t=0,n=0;return function(){var r=a9e(),i=o9e-(r-n);if(n=r,i>0){if(++t>=s9e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function l9e(e){return function(){return e}}var UC=function(){try{var e=Ap(Object,"defineProperty");return e({},"",{}),e}catch{}}(),u9e=UC?function(e,t){return UC(e,"toString",{configurable:!0,enumerable:!1,value:l9e(t),writable:!0})}:BM,d9e=c9e(u9e),f9e=9007199254740991,h9e=/^(?:0|[1-9]\d*)$/;function UT(e,t){var n=typeof e;return!!(t=t??f9e)&&("number"==n||"symbol"!=n&&h9e.test(e))&&e>-1&&e%1==0&&e<t}function VM(e,t,n){"__proto__"==t&&UC?UC(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function x_(e,t){return e===t||e!=e&&t!=t}var p9e=Object.prototype,m9e=p9e.hasOwnProperty;function oae(e,t,n){var r=e[t];(!m9e.call(e,t)||!x_(r,n)||void 0===n&&!(t in e))&&VM(e,t,n)}function g9e(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],l=void 0;void 0===l&&(l=e[a]),i?VM(n,a,l):oae(n,a,l)}return n}var Kq=Math.max;function v9e(e,t,n){return t=Kq(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Kq(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(s),r9e(e,this,a)}}function y9e(e,t){return d9e(v9e(e,t,BM),e+"")}var b9e=9007199254740991;function qM(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=b9e}function jT(e){return null!=e&&qM(e.length)&&!HM(e)}function _9e(e,t,n){if(!zs(n))return!1;var r=typeof t;return!!("number"==r?jT(n)&&UT(t,n.length):"string"==r&&t in n)&&x_(n[t],e)}function S9e(e){return y9e(function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,s=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,s&&_9e(n[0],n[1],s)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,o)}return t})}var E9e=Object.prototype;function GM(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||E9e)}function w9e(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var C9e="[object Arguments]";function zq(e){return Ef(e)&&kp(e)==C9e}var aae=Object.prototype,T9e=aae.hasOwnProperty,R9e=aae.propertyIsEnumerable,jC=zq(function(){return arguments}())?zq:function(e){return Ef(e)&&T9e.call(e,"callee")&&!R9e.call(e,"callee")};function I9e(){return!1}var cae="object"==typeof exports&&exports&&!exports.nodeType&&exports,Wq=cae&&"object"==typeof module&&module&&!module.nodeType&&module,k9e=Wq&&Wq.exports===cae,Yq=k9e?uc.Buffer:void 0,x9e=Yq?Yq.isBuffer:void 0,FC=x9e||I9e,A9e="[object Arguments]",L9e="[object Array]",P9e="[object Boolean]",O9e="[object Date]",M9e="[object Error]",D9e="[object Function]",N9e="[object Map]",U9e="[object Number]",j9e="[object Object]",F9e="[object RegExp]",$9e="[object Set]",B9e="[object String]",H9e="[object WeakMap]",V9e="[object ArrayBuffer]",q9e="[object DataView]",G9e="[object Float32Array]",K9e="[object Float64Array]",z9e="[object Int8Array]",W9e="[object Int16Array]",Y9e="[object Int32Array]",X9e="[object Uint8Array]",J9e="[object Uint8ClampedArray]",Q9e="[object Uint16Array]",Z9e="[object Uint32Array]",Fn={};function eDe(e){return Ef(e)&&qM(e.length)&&!!Fn[kp(e)]}function tDe(e){return function(t){return e(t)}}Fn[G9e]=Fn[K9e]=Fn[z9e]=Fn[W9e]=Fn[Y9e]=Fn[X9e]=Fn[J9e]=Fn[Q9e]=Fn[Z9e]=!0,Fn[A9e]=Fn[L9e]=Fn[V9e]=Fn[P9e]=Fn[q9e]=Fn[O9e]=Fn[M9e]=Fn[D9e]=Fn[N9e]=Fn[U9e]=Fn[j9e]=Fn[F9e]=Fn[$9e]=Fn[B9e]=Fn[H9e]=!1;var lae="object"==typeof exports&&exports&&!exports.nodeType&&exports,Dy=lae&&"object"==typeof module&&module&&!module.nodeType&&module,nDe=Dy&&Dy.exports===lae,Q6=nDe&&nae.process,Xq=function(){try{return Dy&&Dy.require&&Dy.require("util").types||Q6&&Q6.binding&&Q6.binding("util")}catch{}}(),Jq=Xq&&Xq.isTypedArray,KM=Jq?tDe(Jq):eDe,rDe=Object.prototype,iDe=rDe.hasOwnProperty;function uae(e,t){var n=sc(e),r=!n&&jC(e),i=!n&&!r&&FC(e),o=!n&&!r&&!i&&KM(e),s=n||r||i||o,a=s?w9e(e.length,String):[],l=a.length;for(var c in e)(t||iDe.call(e,c))&&(!s||!("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||UT(c,l)))&&a.push(c);return a}function dae(e,t){return function(n){return e(t(n))}}var sDe=dae(Object.keys,Object),oDe=Object.prototype,aDe=oDe.hasOwnProperty;function cDe(e){if(!GM(e))return sDe(e);var t=[];for(var n in Object(e))aDe.call(e,n)&&"constructor"!=n&&t.push(n);return t}function fae(e){return jT(e)?uae(e):cDe(e)}function lDe(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var uDe=Object.prototype,dDe=uDe.hasOwnProperty;function fDe(e){if(!zs(e))return lDe(e);var t=GM(e),n=[];for(var r in e)"constructor"==r&&(t||!dDe.call(e,r))||n.push(r);return n}function zM(e){return jT(e)?uae(e,!0):fDe(e)}var hDe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,pDe=/^\w*$/;function WM(e,t){if(sc(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!NT(e))||(pDe.test(e)||!hDe.test(e)||null!=t&&e in Object(t))}var Tb=Ap(Object,"create");function mDe(){this.__data__=Tb?Tb(null):{},this.size=0}function gDe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var vDe="__lodash_hash_undefined__",yDe=Object.prototype,bDe=yDe.hasOwnProperty;function _De(e){var t=this.__data__;if(Tb){var n=t[e];return n===vDe?void 0:n}return bDe.call(t,e)?t[e]:void 0}var SDe=Object.prototype,EDe=SDe.hasOwnProperty;function wDe(e){var t=this.__data__;return Tb?void 0!==t[e]:EDe.call(t,e)}var CDe="__lodash_hash_undefined__";function TDe(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Tb&&void 0===t?CDe:t,this}function lp(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function RDe(){this.__data__=[],this.size=0}function FT(e,t){for(var n=e.length;n--;)if(x_(e[n][0],t))return n;return-1}lp.prototype.clear=mDe,lp.prototype.delete=gDe,lp.prototype.get=_De,lp.prototype.has=wDe,lp.prototype.set=TDe;var IDe=Array.prototype,kDe=IDe.splice;function xDe(e){var t=this.__data__,n=FT(t,e);return!(n<0)&&(n==t.length-1?t.pop():kDe.call(t,n,1),--this.size,!0)}function ADe(e){var t=this.__data__,n=FT(t,e);return n<0?void 0:t[n][1]}function LDe(e){return FT(this.__data__,e)>-1}function PDe(e,t){var n=this.__data__,r=FT(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function Hu(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Hu.prototype.clear=RDe,Hu.prototype.delete=xDe,Hu.prototype.get=ADe,Hu.prototype.has=LDe,Hu.prototype.set=PDe;var Rb=Ap(uc,"Map");function ODe(){this.size=0,this.__data__={hash:new lp,map:new(Rb||Hu),string:new lp}}function MDe(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function $T(e,t){var n=e.__data__;return MDe(t)?n["string"==typeof t?"string":"hash"]:n.map}function DDe(e){var t=$T(this,e).delete(e);return this.size-=t?1:0,t}function NDe(e){return $T(this,e).get(e)}function UDe(e){return $T(this,e).has(e)}function jDe(e,t){var n=$T(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Vu(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Vu.prototype.clear=ODe,Vu.prototype.delete=DDe,Vu.prototype.get=NDe,Vu.prototype.has=UDe,Vu.prototype.set=jDe;var FDe="Expected a function";function YM(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FDe);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=e.apply(this,r);return n.cache=o.set(i,s)||o,s};return n.cache=new(YM.Cache||Vu),n}YM.Cache=Vu;var $De=500;function BDe(e){var t=YM(e,function(e){return n.size===$De&&n.clear(),e}),n=t.cache;return t}var HDe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,VDe=/\\(\\)?/g,qDe=BDe(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(HDe,function(e,n,r,i){t.push(r?i.replace(VDe,"$1"):n||e)}),t});function GDe(e){return null==e?"":sae(e)}function BT(e,t){return sc(e)?e:WM(e,t)?[e]:qDe(GDe(e))}function A_(e){if("string"==typeof e||NT(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function XM(e,t){for(var n=0,r=(t=BT(t,e)).length;null!=e&&n<r;)e=e[A_(t[n++])];return n&&n==r?e:void 0}function KDe(e,t,n){var r=null==e?void 0:XM(e,t);return void 0===r?n:r}function hae(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var JM=dae(Object.getPrototypeOf,Object),zDe="[object Object]",WDe=Function.prototype,YDe=Object.prototype,pae=WDe.toString,XDe=YDe.hasOwnProperty,JDe=pae.call(Object);function QDe(e){if(!Ef(e)||kp(e)!=zDe)return!1;var t=JM(e);if(null===t)return!0;var n=XDe.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&pae.call(n)==JDe}function ZDe(){this.__data__=new Hu,this.size=0}function eNe(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function tNe(e){return this.__data__.get(e)}function nNe(e){return this.__data__.has(e)}var rNe=200;function iNe(e,t){var n=this.__data__;if(n instanceof Hu){var r=n.__data__;if(!Rb||r.length<rNe-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Vu(r)}return n.set(e,t),this.size=n.size,this}function Zc(e){var t=this.__data__=new Hu(e);this.size=t.size}Zc.prototype.clear=ZDe,Zc.prototype.delete=eNe,Zc.prototype.get=tNe,Zc.prototype.has=nNe,Zc.prototype.set=iNe;var mae="object"==typeof exports&&exports&&!exports.nodeType&&exports,Qq=mae&&"object"==typeof module&&module&&!module.nodeType&&module,sNe=Qq&&Qq.exports===mae,Zq=sNe?uc.Buffer:void 0;function oNe(e,t){return e.slice()}function aNe(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}function gae(){return[]}Zq&&Zq.allocUnsafe;var cNe=Object.prototype,lNe=cNe.propertyIsEnumerable,eG=Object.getOwnPropertySymbols,vae=eG?function(e){return null==e?[]:(e=Object(e),aNe(eG(e),function(t){return lNe.call(e,t)}))}:gae,uNe=Object.getOwnPropertySymbols,dNe=uNe?function(e){for(var t=[];e;)hae(t,vae(e)),e=JM(e);return t}:gae;function yae(e,t,n){var r=t(e);return sc(e)?r:hae(r,n(e))}function tG(e){return yae(e,fae,vae)}function fNe(e){return yae(e,zM,dNe)}var VL=Ap(uc,"DataView"),qL=Ap(uc,"Promise"),GL=Ap(uc,"Set"),nG="[object Map]",hNe="[object Object]",rG="[object Promise]",iG="[object Set]",sG="[object WeakMap]",oG="[object DataView]",pNe=xp(VL),mNe=xp(Rb),gNe=xp(qL),vNe=xp(GL),yNe=xp(HL),Dd=kp;(VL&&Dd(new VL(new ArrayBuffer(1)))!=oG||Rb&&Dd(new Rb)!=nG||qL&&Dd(qL.resolve())!=rG||GL&&Dd(new GL)!=iG||HL&&Dd(new HL)!=sG)&&(Dd=function(e){var t=kp(e),n=t==hNe?e.constructor:void 0,r=n?xp(n):"";if(r)switch(r){case pNe:return oG;case mNe:return nG;case gNe:return rG;case vNe:return iG;case yNe:return sG}return t});var $C=uc.Uint8Array;function bNe(e){var t=new e.constructor(e.byteLength);return new $C(t).set(new $C(e)),t}function _Ne(e,t){var n=bNe(e.buffer);return new e.constructor(n,e.byteOffset,e.length)}function SNe(e){return"function"!=typeof e.constructor||GM(e)?{}:n9e(JM(e))}var ENe="__lodash_hash_undefined__";function wNe(e){return this.__data__.set(e,ENe),this}function CNe(e){return this.__data__.has(e)}function BC(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Vu;++t<n;)this.add(e[t])}function TNe(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function RNe(e,t){return e.has(t)}BC.prototype.add=BC.prototype.push=wNe,BC.prototype.has=CNe;var INe=1,kNe=2;function bae(e,t,n,r,i,o){var s=n&INe,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(e),u=o.get(t);if(c&&u)return c==t&&u==e;var d=-1,h=!0,p=n&kNe?new BC:void 0;for(o.set(e,t),o.set(t,e);++d<a;){var f=e[d],m=t[d];if(r)var v=s?r(m,f,d,t,e,o):r(f,m,d,e,t,o);if(void 0!==v){if(v)continue;h=!1;break}if(p){if(!TNe(t,function(e,t){if(!RNe(p,t)&&(f===e||i(f,e,n,r,o)))return p.push(t)})){h=!1;break}}else if(f!==m&&!i(f,m,n,r,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function xNe(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function ANe(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var LNe=1,PNe=2,ONe="[object Boolean]",MNe="[object Date]",DNe="[object Error]",NNe="[object Map]",UNe="[object Number]",jNe="[object RegExp]",FNe="[object Set]",$Ne="[object String]",BNe="[object Symbol]",HNe="[object ArrayBuffer]",VNe="[object DataView]",aG=Sf?Sf.prototype:void 0,Z6=aG?aG.valueOf:void 0;function qNe(e,t,n,r,i,o,s){switch(n){case VNe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case HNe:return!(e.byteLength!=t.byteLength||!o(new $C(e),new $C(t)));case ONe:case MNe:case UNe:return x_(+e,+t);case DNe:return e.name==t.name&&e.message==t.message;case jNe:case $Ne:return e==t+"";case NNe:var a=xNe;case FNe:var l=r&LNe;if(a||(a=ANe),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;r|=PNe,s.set(e,t);var u=bae(a(e),a(t),r,i,o,s);return s.delete(e),u;case BNe:if(Z6)return Z6.call(e)==Z6.call(t)}return!1}var GNe=1,KNe=Object.prototype,zNe=KNe.hasOwnProperty;function WNe(e,t,n,r,i,o){var s=n&GNe,a=tG(e),l=a.length;if(l!=tG(t).length&&!s)return!1;for(var c=l;c--;){var u=a[c];if(!(s?u in t:zNe.call(t,u)))return!1}var d=o.get(e),h=o.get(t);if(d&&h)return d==t&&h==e;var p=!0;o.set(e,t),o.set(t,e);for(var f=s;++c<l;){var m=e[u=a[c]],v=t[u];if(r)var g=s?r(v,m,u,t,e,o):r(m,v,u,e,t,o);if(!(void 0===g?m===v||i(m,v,n,r,o):g)){p=!1;break}f||(f="constructor"==u)}if(p&&!f){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(p=!1)}return o.delete(e),o.delete(t),p}var YNe=1,cG="[object Arguments]",lG="[object Array]",X2="[object Object]",XNe=Object.prototype,uG=XNe.hasOwnProperty;function JNe(e,t,n,r,i,o){var s=sc(e),a=sc(t),l=s?lG:Dd(e),c=a?lG:Dd(t),u=(l=l==cG?X2:l)==X2,d=(c=c==cG?X2:c)==X2,h=l==c;if(h&&FC(e)){if(!FC(t))return!1;s=!0,u=!1}if(h&&!u)return o||(o=new Zc),s||KM(e)?bae(e,t,n,r,i,o):qNe(e,t,l,n,r,i,o);if(!(n&YNe)){var p=u&&uG.call(e,"__wrapped__"),f=d&&uG.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,v=f?t.value():t;return o||(o=new Zc),i(m,v,n,r,o)}}return!!h&&(o||(o=new Zc),WNe(e,t,n,r,i,o))}function QM(e,t,n,r,i){return e===t||(null==e||null==t||!Ef(e)&&!Ef(t)?e!=e&&t!=t:JNe(e,t,n,r,QM,i))}var QNe=1,ZNe=2;function eUe(e,t,n,r){var i=n.length,o=i;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var a=(s=n[i])[0],l=e[a],c=s[1];if(s[2]){if(void 0===l&&!(a in e))return!1}else{var u=new Zc;if(!QM(c,l,QNe|ZNe,r,u))return!1}}return!0}function _ae(e){return e==e&&!zs(e)}function tUe(e){for(var t=fae(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,_ae(i)]}return t}function Sae(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}function nUe(e){var t=tUe(e);return 1==t.length&&t[0][2]?Sae(t[0][0],t[0][1]):function(n){return n===e||eUe(n,e,t)}}function rUe(e,t){return null!=e&&t in Object(e)}function iUe(e,t,n){for(var r=-1,i=(t=BT(t,e)).length,o=!1;++r<i;){var s=A_(t[r]);if(!(o=null!=e&&n(e,s)))break;e=e[s]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&qM(i)&&UT(s,i)&&(sc(e)||jC(e))}function sUe(e,t){return null!=e&&iUe(e,t,rUe)}var oUe=1,aUe=2;function cUe(e,t){return WM(e)&&_ae(t)?Sae(A_(e),t):function(n){var r=KDe(n,e);return void 0===r&&r===t?sUe(n,e):QM(t,r,oUe|aUe)}}function lUe(e){return function(t){return null==t?void 0:t[e]}}function uUe(e){return function(t){return XM(t,e)}}function dUe(e){return WM(e)?lUe(A_(e)):uUe(e)}function fUe(e){return"function"==typeof e?e:null==e?BM:"object"==typeof e?sc(e)?cUe(e[0],e[1]):nUe(e):dUe(e)}function hUe(e){return function(e,t,n){for(var r=-1,i=Object(e),o=n(e),s=o.length;s--;){var a=o[++r];if(!1===t(i[a],a,i))break}return e}}var pUe=hUe(),ex=function(){return uc.Date.now()},mUe="Expected a function",gUe=Math.max,vUe=Math.min;function yUe(e,t,n){var r,i,o,s,a,l,c=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError(mUe);function p(t){var n=r,o=i;return r=i=void 0,c=t,s=e.apply(o,n)}function f(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=o}function m(){var e=ex();if(f(e))return v(e);a=setTimeout(m,function(e){var n=t-(e-l);return d?vUe(n,o-(e-c)):n}(e))}function v(e){return a=void 0,h&&r?p(e):(r=i=void 0,s)}function g(){var e=ex(),n=f(e);if(r=arguments,i=this,l=e,n){if(void 0===a)return function(e){return c=e,a=setTimeout(m,t),u?p(e):s}(l);if(d)return clearTimeout(a),a=setTimeout(m,t),p(l)}return void 0===a&&(a=setTimeout(m,t)),s}return t=Vq(t)||0,zs(n)&&(u=!!n.leading,o=(d="maxWait"in n)?gUe(Vq(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h),g.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=l=i=a=void 0},g.flush=function(){return void 0===a?s:v(ex())},g}function KL(e,t,n){(void 0!==n&&!x_(e[t],n)||void 0===n&&!(t in e))&&VM(e,t,n)}function bUe(e){return Ef(e)&&jT(e)}function zL(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function _Ue(e){return g9e(e,zM(e))}function SUe(e,t,n,r,i,o,s){var a=zL(e,n),l=zL(t,n),c=s.get(l);if(c)KL(e,n,c);else{var u=o?o(a,l,n+"",e,t,s):void 0,d=void 0===u;if(d){var h=sc(l),p=!h&&FC(l),f=!h&&!p&&KM(l);u=l,h||p||f?sc(a)?u=a:bUe(a)?u=i9e(a):p?(d=!1,u=oNe(l)):f?(d=!1,u=_Ne(l)):u=[]:QDe(l)||jC(l)?(u=a,jC(a)?u=_Ue(a):(!zs(a)||HM(a))&&(u=SNe(l))):d=!1}d&&(s.set(l,u),i(u,l,r,o,s),s.delete(l)),KL(e,n,u)}}function Eae(e,t,n,r,i){e!==t&&pUe(t,function(o,s){if(i||(i=new Zc),zs(o))SUe(e,t,s,n,Eae,r,i);else{var a=r?r(zL(e,s),o,s+"",e,t,i):void 0;void 0===a&&(a=o),KL(e,s,a)}},zM)}var EUe=S9e(function(e,t,n){Eae(e,t,n)});function wUe(e,t,n,r){if(!zs(e))return e;for(var i=-1,o=(t=BT(t,e)).length,s=o-1,a=e;null!=a&&++i<o;){var l=A_(t[i]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(i!=s){var u=a[l];void 0===(c=void 0)&&(c=zs(u)?u:UT(t[i+1])?[]:{})}oae(a,l,c),a=a[l]}return e}function CUe(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var s=t[r],a=XM(e,s);n(a,s)&&wUe(o,BT(s,e),a)}return o}function TUe(e,t){if(null==e)return{};var n=iae(fNe(e),function(e){return[e]});return t=fUe(t),CUe(e,n,function(e,n){return t(e,n[0])})}var RUe="Expected a function";function IUe(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError(RUe);return zs(n)&&(r=!("leading"in n)&&r,i="trailing"in n||i),yUe(e,t,{leading:r,maxWait:t,trailing:i})}const WL={default_server_config:{"m.homeserver":{base_url:"http://localhost:8008",server_name:"localhost"}},features:{feature_use_device_session_member_events:!0},ssla:"https://static.element.io/legal/element-software-and-services-license-agreement-uk-1.pdf",media_devices:{enable_audio:!0,enable_video:!0},app_prompt:!0};function ZM(e){return!(e.ok||e.url.startsWith("file:")&&0===e.status)}class Zt{static get(){var e;if(null==(e=this.internalInstance)||!e.config)throw new Error("Config instance read before config got initialized");return this.internalInstance.config}static async init(){var e;if(null==(e=Zt.internalInstance)||!e.initPromise){const e=new Zt;let t;Zt.internalInstance=e,t=window.location.pathname.endsWith("/room/")||window.location.pathname.endsWith("/room")?new URL("/config.json",window.location.href).href:"config.json",Zt.internalInstance.initPromise=kUe(t).then(t=>{e.config=EUe({},WL,t)})}return Zt.internalInstance.initPromise}static initDefault(){Zt.internalInstance=new Zt,Zt.internalInstance.config={...WL}}static defaultHomeserverUrl(){var e;return Fr().homeserver??(null==(e=Zt.get().default_server_config)?void 0:e["m.homeserver"].base_url)}static defaultServerName(){var e;const t=Fr().homeserver;return t?new URL(t).hostname:null==(e=Zt.get().default_server_config)?void 0:e["m.homeserver"].server_name}}async function kUe(e){const t=await fetch(e);return ZM(t)?WL:t.json()}var sn=(e=>(e[e.NONE=0]="NONE",e[e.PER_PARTICIPANT=1]="PER_PARTICIPANT",e[e.SHARED_KEY=2]="SHARED_KEY",e))(sn||{});let tc;tc=/android/i.test(navigator.userAgent)?"android":/iPad|iPhone|iPod|Mac/.test(navigator.userAgent)&&"ontouchend"in document?"ios":"desktop";const xUe=()=>{const{userAgent:e}=navigator;return e.includes("Firefox")};var wae=(e=>(e.StartNewCall="start_call",e.JoinExistingCall="join_existing",e.StartNewCallDM="start_call_dm",e.JoinExistingCallDM="join_existing_dm",e.Unknown="unknown",e))(wae||{}),Ib=(e=>(e.None="none",e.Standard="standard",e.AppBar="app_bar",e))(Ib||{});function AUe(e,t){const n=e.indexOf("?"),r=t(new URLSearchParams(-1===n?"":e.substring(n)));return`${e.substring(0,n)}?${r.toString()}`}class Cae{constructor(e,t){this.queryParams=new URLSearchParams(e);const n=t.indexOf("?");this.fragmentParams=new URLSearchParams(-1===n?"":t.substring(n))}getParam(e){return this.fragmentParams.get(e)??this.queryParams.get(e)}getEnumParam(e,t){const n=this.getParam(e);if(null!==n&&Object.values(t).includes(n))return n}getAllParams(e){return[...this.fragmentParams.getAll(e),...this.queryParams.getAll(e)]}getFlagParam(e,t=!1){const n=this.getParam(e);return null===n?t:"false"!==n}getFlag(e){const t=this.getParam(e);return null!==t?"false"!==t:void 0}}const Fr=(e=window.location.search,t=window.location.hash)=>{const n=new Cae(e,t),r=parseFloat(n.getParam("fontScale")??""),i=n.getParam("widgetId"),o=n.getParam("parentUrl"),s=!!i&&!!o,a=s?n.getEnumParam("intent",wae)??"unknown":"unknown";let l;const c={confineToRoom:!0,appPrompt:!1,preload:!0,header:"desktop"===tc?"none":"app_bar",showControls:!0,hideScreensharing:!1,allowIceFallback:!0,perParticipantE2EE:!0,controlledAudioDevices:"desktop"!==tc,skipLobby:!0,returnToLobby:!1,sendNotificationType:"notification",autoLeaveWhenOthersLeft:!1};switch(a){case"start_call":l={...c,skipLobby:!0};break;case"join_existing":l={...c,skipLobby:!1};break;case"start_call_dm":case"join_existing_dm":l={...c,skipLobby:!0,autoLeaveWhenOthersLeft:!0};break;default:l={confineToRoom:!1,appPrompt:!0,preload:!1,header:"standard",showControls:!0,hideScreensharing:!1,allowIceFallback:!1,perParticipantE2EE:!1,controlledAudioDevices:!1,skipLobby:!1,returnToLobby:!1,sendNotificationType:void 0,autoLeaveWhenOthersLeft:!1}}const u={widgetId:i,parentUrl:o,roomId:n.getParam("roomId"),password:n.getParam("password"),userId:s?n.getParam("userId"):null,displayName:n.getParam("displayName"),deviceId:s?n.getParam("deviceId"):null,baseUrl:s?n.getParam("baseUrl"):null,lang:n.getParam("lang"),fonts:n.getAllParams("font"),fontScale:Number.isNaN(r)?null:r,theme:n.getParam("theme"),viaServers:s?null:n.getParam("viaServers"),homeserver:s?null:n.getParam("homeserver"),posthogApiHost:n.getParam("posthogApiHost"),posthogApiKey:n.getParam("posthogApiKey"),posthogUserId:n.getParam("posthogUserId")??n.getParam("analyticsID"),rageshakeSubmitUrl:n.getParam("rageshakeSubmitUrl"),sentryDsn:n.getParam("sentryDsn"),sentryEnvironment:n.getParam("sentryEnvironment"),e2eEnabled:n.getFlagParam("enableE2EE",!0)},d={confineToRoom:n.getFlag("confineToRoom"),appPrompt:n.getFlag("appPrompt"),preload:s?n.getFlag("preload"):void 0,header:n.getEnumParam("header",Ib),showControls:n.getFlag("showControls"),hideScreensharing:n.getFlag("hideScreensharing"),allowIceFallback:n.getFlag("allowIceFallback"),perParticipantE2EE:n.getFlag("perParticipantE2EE"),controlledAudioDevices:n.getFlag("controlledAudioDevices"),skipLobby:!!s&&n.getFlag("skipLobby"),returnToLobby:!!s&&n.getFlag("returnToLobby"),sendNotificationType:n.getEnumParam("sendNotificationType",["ring","notification"]),autoLeaveWhenOthersLeft:n.getFlag("autoLeave")};return{...u,...l,...TUe(d,e=>void 0!==e)}},Xs=()=>{const{search:e,hash:t}=ts();return _.useMemo(()=>Fr(e,t),[e,t])};function LUe(e,t,n){let r=null;const i=(e=e.substring(1)).split("/"),o="room"==i[0],s=i.length>1;""===n||n.startsWith("#?")?(s&&o&&(r=i[1]),o||(r=i[0])):r=n,r=(null==r?void 0:r.split("?")[0])??null,r&&(r.length<=1?r=null:(r.startsWith("#")||(r=`#${r}`),r.includes(":")||(r=`${r}:${Zt.defaultServerName()}`)));const a=new Cae(t,n);let l=a.getParam("roomId");return null!==l&&(l=l.replaceAll(/^[^ -~]+|[^ -~]+$/g,""),l.startsWith("!")&&l.includes("")||(l=null)),{roomAlias:r,roomId:l,viaServers:a.getAllParams("viaServers")}}const PUe=()=>{const{pathname:e,search:t,hash:n}=ts();return _.useMemo(()=>LUe(e,t,n),[e,t,n])};function OUe(e,t,n){const r=new URLSearchParams;switch(null==t?void 0:t.kind){case sn.SHARED_KEY:{const e=encodeURIComponent(t.secret);e!==t.secret&&M.info("Encoded call password used non URL-safe chars: buggy client?"),r.set("password",e);break}case sn.PER_PARTICIPANT:r.set("perParticipantE2EE","true")}return r.set("roomId",e),r}const MUe="_rageshakeControl_65ekp_8",dG={rageshakeControl:MUe},fG=5242880,DUe=2e3,NUe=3;class UUe extends LX{constructor(){super(...arguments),this.logs="",this.log=(e,...t)=>{let n=`${(new Date).toISOString()} ${e} ${(t=t.map(e=>e instanceof DOMException?e.message+` (${e.name} | ${e.code})`:e instanceof Error?e.message+(e.stack?`\n${e.stack}`:""):"object"==typeof e?JSON.stringify(e,VUe()):e)).join(" ")}\n`;n=n.replace(/token=[a-zA-Z0-9-]+/gm,"token=xxxxx"),this.logs+=n,this.emit("log")}}popLogs(){const e=this.logs;return this.logs="",e}peekLogs(){return this.logs}}class jUe{constructor(e,t){this.indexedDB=e,this.loggerInstance=t,this.index=0,this.onLoggerLog=()=>{this.db&&this.throttledFlush()},this.throttledFlush=IUe(()=>this.flush,DUe,{leading:!1,trailing:!0}),this.flush=async()=>this.flushPromise?(this.flushAgainPromise||(this.flushAgainPromise=this.flushPromise.then(this.flush).then(()=>{this.flushAgainPromise=void 0})),this.flushAgainPromise):(this.flushPromise=new Promise((e,t)=>{if(!this.db)return void t(new Error("No connected database"));const n=this.loggerInstance.popLogs();if(0===n.length)return void e();const r=this.db.transaction(["logs","logslastmod"],"readwrite"),i=r.objectStore("logs");r.oncomplete=()=>{e()},r.onerror=e=>{var n;M.error("Failed to flush logs : ",e),t(new Error("Failed to write logs: "+(null==(n=null==r?void 0:r.error)?void 0:n.message)))},i.add(this.generateLogEntry(n)),r.objectStore("logslastmod").put(this.generateLastModifiedTime())}).then(()=>{this.flushPromise=void 0}),this.flushPromise),this.id="instance-"+Eo(16),t.on("log",this.onLoggerLog),window.addEventListener("beforeunload",()=>{this.flush().catch(e=>M.error("Failed to flush logs before unload",e))})}async connect(){const e=this.indexedDB.open("logs");return new Promise((t,n)=>{e.onsuccess=()=>{this.db=e.result,t()},e.onerror=()=>{var t;const r="Failed to open log database: "+(null==(t=null==e?void 0:e.error)?void 0:t.name);M.error(r),n(new Error(r))},e.onupgradeneeded=()=>{const t=e.result,n=t.createObjectStore("logs",{keyPath:["id","index"]});n.createIndex("id","id",{unique:!1}),n.add(this.generateLogEntry(new Date+" ::: Log database was created.")),t.createObjectStore("logslastmod",{keyPath:"id"}).add(this.generateLastModifiedTime())}})}async consume(){const e=this.db;if(!e)return Promise.reject(new Error("No connected database"));async function t(t,n){const r=e.transaction("logs","readonly").objectStore("logs");return new Promise((e,i)=>{const o=r.index("id").openCursor(IDBKeyRange.only(t),"prev");let s="";o.onerror=()=>{var e;i(new Error("Query failed: "+(null==(e=null==o?void 0:o.error)?void 0:e.message)))},o.onsuccess=()=>{const t=o.result;t?(s=t.value.lines+s,s.length>=n?e(s):t.continue()):e(s)}})}const n=await async function(){return FUe(e.transaction("logslastmod","readonly").objectStore("logslastmod"),void 0,e=>({id:e.value.id,ts:e.value.ts})).then(e=>e.sort((e,t)=>t.ts-e.ts).map(e=>e.id))}();let r=[];const i=[];let o=0;for(let e=0;e<n.length;e++){const s=await t(n[e],fG-o);if(i.push({lines:s,id:n[e]}),o+=s.length,o>=fG){r=n.slice(e+1).map(e=>parseInt(e,10));break}}return r.length>0&&(M.log("Removing logs: ",r),Promise.all(r.map(async t=>async function(t){return new Promise((n,r)=>{const i=e.transaction(["logs","logslastmod"],"readwrite"),o=i.objectStore("logs"),s=o.index("id").openKeyCursor(IDBKeyRange.only(t));s.onsuccess=()=>{const e=s.result;e&&(o.delete(e.primaryKey),e.continue())},i.oncomplete=()=>{n()},i.onerror=()=>{var e;r(new Error(`Failed to delete logs for '${t}' : ${null==(e=null==i?void 0:i.error)?void 0:e.message}`))},i.objectStore("logslastmod").delete(t)})}(t))).then(()=>{M.log(`Removed ${r.length} old logs.`)},e=>{M.error(e)})),i}generateLogEntry(e){return{id:this.id,lines:e,index:this.index++}}generateLastModifiedTime(){return{id:this.id,ts:Date.now()}}}async function FUe(e,t,n){const r=e.openCursor(t);return new Promise((e,t)=>{const i=[];r.onerror=()=>{var e;t(new Error("Query failed: "+(null==(e=null==r?void 0:r.error)?void 0:e.message)))},r.onsuccess=()=>{const t=r.result;t?(i.push(n(t)),t.continue()):e(i)}})}async function $Ue(){return global.mx_rage_logger=new UUe,qUe(M,global.mx_rage_logger.log),["trace","debug","info","warn","error"].forEach(e=>{const t=window.console[e];if(!t)return;const n=`${e.toUpperCase()} matrix_sdk`;window.console[e]=(...r)=>{t(...r),"string"==typeof r[0]&&r[0].startsWith(n)&&global.mx_rage_logger.log(e8[e],"matrix_sdk",...r)}}),BUe()}async function BUe(){if(global.mx_rage_initStoragePromise)return global.mx_rage_initStoragePromise;let e;M.log("Configuring rageshake persistence...");try{e=window.indexedDB}catch(e){M.warn("Could not get indexDB from window.",e)}return e?(global.mx_rage_store=new jUe(e,global.mx_rage_logger),global.mx_rage_initStoragePromise=global.mx_rage_store.connect(),global.mx_rage_initStoragePromise):(global.mx_rage_initStoragePromise=Promise.resolve(),global.mx_rage_initStoragePromise)}async function HUe(){if(!global.mx_rage_logger)throw new Error("No console logger, did you forget to call init()?");return global.mx_rage_store?(await global.mx_rage_store.flush(),global.mx_rage_store.consume()):[{lines:global.mx_rage_logger.peekLogs(),id:"-"}]}const VUe=()=>{const e=new WeakSet,t=new WeakMap;return function(n,r){if("object"==typeof r&&null!==r){if(e.has(r))return"<$ cycle-trimmed $>";e.add(r);let n=0;if(this&&(n=t.get(this)??0),t.set(r,n+1),n>3)return"<$ object-pruned $>"}return r}};var e8=(e=>(e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent",e))(e8||{});function qUe(e,t){const n=e,r=n.methodFactory;n.methodFactory=function(e,n,i){const o=r(e,n,i),s=e8[e],a=s>=n&&s<5;return(...e)=>{o.apply(this,e),a&&t(s,null==i?void 0:i.toString(),...e)}},n.setLevel(n.getLevel())}var GUe="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},Lh="1.9.0",hG=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function KUe(e){var t=new Set([e]),n=new Set,r=e.match(hG);if(!r)return function(){return!1};var i=+r[1],o=+r[2],s=+r[3];if(null!=r[4])return function(t){return t===e};function a(e){return n.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(hG);if(!r)return a(e);var c=+r[1],u=+r[2],d=+r[3];return null!=r[4]||i!==c?a(e):0===i?o===u&&s<=d?l(e):a(e):o<=u?l(e):a(e)}}var zUe=KUe(Lh),WUe=Lh.split(".")[0],kb=Symbol.for("opentelemetry.js.api."+WUe),xb=GUe;function HT(e,t,n,r){var i;void 0===r&&(r=!1);var o=xb[kb]=null!==(i=xb[kb])&&void 0!==i?i:{version:Lh};if(!r&&o[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(s.stack||s.message),!1}if(o.version!==Lh){s=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+Lh);return n.error(s.stack||s.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+Lh+"."),!0}function hv(e){var t,n,r=null===(t=xb[kb])||void 0===t?void 0:t.version;if(r&&zUe(r))return null===(n=xb[kb])||void 0===n?void 0:n[e]}function VT(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+Lh+".");var n=xb[kb];n&&delete n[e]}var go,YUe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},XUe=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},JUe=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return D0("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return D0("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return D0("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return D0("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return D0("verbose",this._namespace,e)},e}();function D0(e,t,n){var r=hv("diag");if(r)return n.unshift(t),r[e].apply(r,XUe([],YUe(n),!1))}function QUe(e,t){function n(n,r){var i=t[n];return"function"==typeof i&&e>=r?i.bind(t):function(){}}return e<go.NONE?e=go.NONE:e>go.ALL&&(e=go.ALL),t=t||{},{error:n("error",go.ERROR),warn:n("warn",go.WARN),info:n("info",go.INFO),debug:n("debug",go.DEBUG),verbose:n("verbose",go.VERBOSE)}}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(go||(go={}));var ZUe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},eje=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},tje="diag",wf=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=hv("diag");if(r)return r[e].apply(r,eje([],ZUe(t),!1))}}var t=this;t.setLogger=function(e,n){var r,i,o;if(void 0===n&&(n={logLevel:go.INFO}),e===t){var s=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=s.stack)&&void 0!==r?r:s.message),!1}"number"==typeof n&&(n={logLevel:n});var a=hv("diag"),l=QUe(null!==(i=n.logLevel)&&void 0!==i?i:go.INFO,e);if(a&&!n.suppressOverrideMessage){var c=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+c),l.warn("Current logger will overwrite one already registered from "+c)}return HT("diag",l,t,!0)},t.disable=function(){VT(tje,t)},t.createComponentLogger=function(e){return new JUe(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),nje=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},rje=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ije=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var t=nje(e,2);return[t[0],t[1]]})},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=new e(this._entries);try{for(var s=rje(r),a=s.next();!a.done;a=s.next()){var l=a.value;o._entries.delete(l)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o},e.prototype.clear=function(){return new e},e}(),sje=Symbol("BaggageEntryMetadata"),oje=wf.instance();function aje(e){return void 0===e&&(e={}),new ije(new Map(Object.entries(e)))}function cje(e){return"string"!=typeof e&&(oje.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:sje,toString:function(){return e}}}function t8(e){return Symbol.for(e)}var Nu,lje=function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var i=new e(n._currentContext);return i._currentContext.set(t,r),i},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},Qm=new lje,uje={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},dje={set:function(e,t,n){null!=e&&(e[t]=n)}},fje=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},hje=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},pje=function(){function e(){}return e.prototype.active=function(){return Qm},e.prototype.with=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t.call.apply(t,hje([n],fje(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),mje=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},gje=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},tx="context",vje=new pje,qT=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return HT(tx,e,wf.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return(r=this._getContextManager()).with.apply(r,gje([e,t,n],mje(i),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return hv(tx)||vje},e.prototype.disable=function(){this._getContextManager().disable(),VT(tx,wf.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(Nu||(Nu={}));var Tae="0000000000000000",Rae="00000000000000000000000000000000",Iae={traceId:Rae,spanId:Tae,traceFlags:Nu.NONE},Ny=function(){function e(e){void 0===e&&(e=Iae),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),n8=t8("OpenTelemetry Context Key SPAN");function r8(e){return e.getValue(n8)||void 0}function yje(){return r8(qT.getInstance().active())}function i8(e,t){return e.setValue(n8,t)}function bje(e){return e.deleteValue(n8)}function _je(e,t){return i8(e,new Ny(t))}function kae(e){var t;return null===(t=r8(e))||void 0===t?void 0:t.spanContext()}var Sje=/^([0-9a-f]{32})$/i,Eje=/^[0-9a-f]{16}$/i;function xae(e){return Sje.test(e)&&e!==Rae}function wje(e){return Eje.test(e)&&e!==Tae}function GT(e){return xae(e.traceId)&&wje(e.spanId)}function Cje(e){return new Ny(e)}var nx=qT.getInstance(),Aae=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(void 0===n&&(n=nx.active()),!(null==t||!t.root))return new Ny;var r=n&&kae(n);return Tje(r)&&GT(r)?new Ny(r):new Ny},e.prototype.startActiveSpan=function(e,t,n,r){var i,o,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(i=t,s=n):(i=t,o=n,s=r);var a=o??nx.active(),l=this.startSpan(e,i,a),c=i8(a,l);return nx.with(c,s,void 0,l)}},e}();function Tje(e){return"object"==typeof e&&"string"==typeof e.spanId&&"string"==typeof e.traceId&&"number"==typeof e.traceFlags}var HC,YL,XL,Rje=new Aae,Ije=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Rje},e}(),kje=function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new Aae},e}(),xje=new kje,pG=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return null!==(r=this.getDelegateTracer(e,t,n))&&void 0!==r?r:new Ije(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:xje},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,n)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(HC||(HC={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(YL||(YL={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(XL||(XL={}));var Kh=qT.getInstance(),vn=wf.instance(),Aje=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),s8=t8("OpenTelemetry Baggage Key");function Lae(e){return e.getValue(s8)||void 0}function Lje(){return Lae(qT.getInstance().active())}function Pje(e,t){return e.setValue(s8,t)}function Oje(e){return e.deleteValue(s8)}var rx="propagation",Mje=new Aje,Dje=function(){function e(){this.createBaggage=aje,this.getBaggage=Lae,this.getActiveBaggage=Lje,this.setBaggage=Pje,this.deleteBaggage=Oje}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return HT(rx,e,wf.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=dje),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=uje),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){VT(rx,wf.instance())},e.prototype._getGlobalPropagator=function(){return hv(rx)||Mje},e}(),Uy=Dje.getInstance(),ix="trace",Nje=function(){function e(){this._proxyTracerProvider=new pG,this.wrapSpanContext=Cje,this.isSpanContextValid=GT,this.deleteSpan=bje,this.getSpan=r8,this.getActiveSpan=yje,this.getSpanContext=kae,this.setSpan=i8,this.setSpanContext=_je}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=HT(ix,this._proxyTracerProvider,wf.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return hv(ix)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){VT(ix,wf.instance()),this._proxyTracerProvider=new pG},e}(),qa=Nje.getInstance();const sx={trace:qa},Pae=t8("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Uje(e){return e.setValue(Pae,!0)}function o8(e){return!0===e.getValue(Pae)}const jje="=",JL=";",QL=",",ox="baggage",Fje=180,$je=4096,Bje=8192;function Hje(e){return e.reduce((e,t)=>{const n=`${e}${""!==e?QL:""}${t}`;return n.length>Bje?e:n},"")}function Vje(e){return e.getAllEntries().map(([e,t])=>{let n=`${encodeURIComponent(e)}=${encodeURIComponent(t.value)}`;return void 0!==t.metadata&&(n+=JL+t.metadata.toString()),n})}function qje(e){const t=e.split(JL);if(t.length<=0)return;const n=t.shift();if(!n)return;const r=n.indexOf("=");if(r<=0)return;const i=decodeURIComponent(n.substring(0,r).trim()),o=decodeURIComponent(n.substring(r+1).trim());let s;return t.length>0&&(s=cje(t.join(JL))),{key:i,value:o,metadata:s}}class Gje{inject(e,t,n){const r=Uy.getBaggage(e);if(!r||o8(e))return;const i=Hje(Vje(r).filter(e=>e.length<=$je).slice(0,180));i.length>0&&n.set(t,ox,i)}extract(e,t,n){const r=n.get(t,ox),i=Array.isArray(r)?r.join(QL):r;if(!i)return e;const o={};return 0===i.length||(i.split(QL).forEach(e=>{const t=qje(e);if(t){const e={value:t.value};t.metadata&&(e.metadata=t.metadata),o[t.key]=e}}),0===Object.entries(o).length)?e:Uy.setBaggage(e,Uy.createBaggage(o))}fields(){return[ox]}}function Ew(e){const t={};if("object"!=typeof e||null==e)return t;for(const[n,r]of Object.entries(e))Kje(n)?Oae(r)?Array.isArray(r)?t[n]=r.slice():t[n]=r:vn.warn(`Invalid attribute value set for key: ${n}`):vn.warn(`Invalid attribute key: ${n}`);return t}function Kje(e){return"string"==typeof e&&e.length>0}function Oae(e){return null==e||(Array.isArray(e)?zje(e):Mae(e))}function zje(e){let t;for(const n of e)if(null!=n){if(!t){if(Mae(n)){t=typeof n;continue}return!1}if(typeof n!==t)return!1}return!0}function Mae(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}function Wje(){return e=>{vn.error(Yje(e))}}function Yje(e){return"string"==typeof e?e:JSON.stringify(Xje(e))}function Xje(e){const t={};let n=e;for(;null!==n;)Object.getOwnPropertyNames(n).forEach(e=>{if(t[e])return;const r=n[e];r&&(t[e]=String(r))}),n=Object.getPrototypeOf(n);return t}let Jje=Wje();function a8(e){try{Jje(e)}catch{}}const Lg=performance,Qje="2.0.1",ax="exception.message",Zje="exception.stacktrace",cx="exception.type",Dae="service.name",ZL="telemetry.sdk.language",eFe="webjs",e7="telemetry.sdk.name",t7="telemetry.sdk.version",tFe="process.runtime.name",lx={[e7]:"opentelemetry",[tFe]:"browser",[ZL]:eFe,[t7]:Qje},nFe=9,rFe=6,iFe=Math.pow(10,6),VC=Math.pow(10,9);function cg(e){const t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*iFe)]}function Nae(){let e=Lg.timeOrigin;if("number"!=typeof e){const t=Lg;e=t.timing&&t.timing.fetchStart}return e}function sFe(e){return jae(cg(Nae()),cg("number"==typeof e?e:Lg.now()))}function oFe(e,t){let n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=VC),[n,r]}function aFe(e){return e[0]*VC+e[1]}function mG(e){return 1e3*e[0]+e[1]/1e6}function ux(e){return 1e6*e[0]+e[1]/1e3}function Uae(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function gG(e){return Uae(e)||"number"==typeof e||e instanceof Date}function jae(e,t){const n=[e[0]+t[0],e[1]+t[1]];return n[1]>=VC&&(n[1]-=VC,n[0]+=1),n}var Fc;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(Fc||(Fc={}));class cFe{constructor(e={}){De(this,"_propagators"),De(this,"_fields"),this._propagators=e.propagators??[],this._fields=Array.from(new Set(this._propagators.map(e=>"function"==typeof e.fields?e.fields():[]).reduce((e,t)=>e.concat(t),[])))}inject(e,t,n){for(const r of this._propagators)try{r.inject(e,t,n)}catch(e){vn.warn(`Failed to inject with ${r.constructor.name}. Err: ${e.message}`)}}extract(e,t,n){return this._propagators.reduce((e,r)=>{try{return r.extract(e,t,n)}catch(e){vn.warn(`Failed to extract with ${r.constructor.name}. Err: ${e.message}`)}return e},e)}fields(){return this._fields.slice()}}const n7="[_0-9a-z-*/]",lFe=`[a-z]${n7}{0,255}`,uFe=`[a-z0-9]${n7}{0,240}@[a-z]${n7}{0,13}`,dFe=new RegExp(`^(?:${lFe}|${uFe})$`),fFe=/^[ -~]{0,255}[!-~]$/,hFe=/,|=/;function pFe(e){return dFe.test(e)}function mFe(e){return fFe.test(e)&&!hFe.test(e)}const vG=32,gFe=512,yG=",",bG="=";class c8{constructor(e){De(this,"_internalState",new Map),e&&this._parse(e)}set(e,t){const n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n}unset(e){const t=this._clone();return t._internalState.delete(e),t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,t)=>(e.push(t+bG+this.get(t)),e),[]).join(yG)}_parse(e){e.length>512||(this._internalState=e.split(yG).reverse().reduce((e,t)=>{const n=t.trim(),r=n.indexOf(bG);if(-1!==r){const i=n.slice(0,r),o=n.slice(r+1,t.length);pFe(i)&&mFe(o)&&e.set(i,o)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const e=new c8;return e._internalState=new Map(this._internalState),e}}const dx="traceparent",fx="tracestate",vFe="00",yFe="(?!ff)[\\da-f]{2}",bFe="(?![0]{32})[\\da-f]{32}",_Fe="(?![0]{16})[\\da-f]{16}",SFe="[\\da-f]{2}",EFe=new RegExp(`^\\s?(${yFe})-(${bFe})-(${_Fe})-(${SFe})(-.*)?\\s?$`);function wFe(e){const t=EFe.exec(e);return!t||"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}}class CFe{inject(e,t,n){const r=qa.getSpanContext(e);if(!r||o8(e)||!GT(r))return;const i=`${vFe}-${r.traceId}-${r.spanId}-0${Number(r.traceFlags||Nu.NONE).toString(16)}`;n.set(t,dx,i),r.traceState&&n.set(t,fx,r.traceState.serialize())}extract(e,t,n){const r=n.get(t,dx);if(!r)return e;const i=Array.isArray(r)?r[0]:r;if("string"!=typeof i)return e;const o=wFe(i);if(!o)return e;o.isRemote=!0;const s=n.get(t,fx);if(s){const e=Array.isArray(s)?s.join(","):s;o.traceState=new c8("string"==typeof e?e:void 0)}return qa.setSpanContext(e,o)}fields(){return[dx,fx]}}const TFe="[object Object]",RFe="[object Null]",IFe="[object Undefined]",kFe=Function.prototype,Fae=kFe.toString,xFe=Fae.call(Object),AFe=Object.getPrototypeOf,$ae=Object.prototype,Bae=$ae.hasOwnProperty,Ih=Symbol?Symbol.toStringTag:void 0,Hae=$ae.toString;function _G(e){if(!LFe(e)||PFe(e)!==TFe)return!1;const t=AFe(e);if(null===t)return!0;const n=Bae.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Fae.call(n)===xFe}function LFe(e){return null!=e&&"object"==typeof e}function PFe(e){return null==e?void 0===e?IFe:RFe:Ih&&Ih in Object(e)?OFe(e):MFe(e)}function OFe(e){const t=Bae.call(e,Ih),n=e[Ih];let r=!1;try{e[Ih]=void 0,r=!0}catch{}const i=Hae.call(e);return r&&(t?e[Ih]=n:delete e[Ih]),i}function MFe(e){return Hae.call(e)}const DFe=20;function NFe(...e){let t=e.shift();const n=new WeakMap;for(;e.length>0;)t=Vae(t,e.shift(),0,n);return t}function hx(e){return qC(e)?e.slice():e}function Vae(e,t,n=0,r){let i;if(!(n>20)){if(n++,ww(e)||ww(t)||qae(t))i=hx(t);else if(qC(e)){if(i=e.slice(),qC(t))for(let e=0,n=t.length;e<n;e++)i.push(hx(t[e]));else if(N0(t)){const e=Object.keys(t);for(let n=0,r=e.length;n<r;n++){const r=e[n];i[r]=hx(t[r])}}}else if(N0(e))if(N0(t)){if(!UFe(e,t))return t;i=Object.assign({},e);const o=Object.keys(t);for(let s=0,a=o.length;s<a;s++){const a=o[s],l=t[a];if(ww(l))typeof l>"u"?delete i[a]:i[a]=l;else{const o=i[a],s=l;if(SG(e,a,r)||SG(t,a,r))delete i[a];else{if(N0(o)&&N0(s)){const n=r.get(o)||[],i=r.get(s)||[];n.push({obj:e,key:a}),i.push({obj:t,key:a}),r.set(o,n),r.set(s,i)}i[a]=Vae(i[a],l,n,r)}}}}else i=t;return i}}function SG(e,t,n){const r=n.get(e[t])||[];for(let n=0,i=r.length;n<i;n++){const i=r[n];if(i.key===t&&i.obj===e)return!0}return!1}function qC(e){return Array.isArray(e)}function qae(e){return"function"==typeof e}function N0(e){return!ww(e)&&!qC(e)&&!qae(e)&&"object"==typeof e}function ww(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||typeof e>"u"||e instanceof Date||e instanceof RegExp||null===e}function UFe(e,t){return!(!_G(e)||!_G(t))}class jFe{constructor(){De(this,"_promise"),De(this,"_resolve"),De(this,"_reject"),this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}class FFe{constructor(e,t){De(this,"_callback"),De(this,"_that"),De(this,"_isCalled",!1),De(this,"_deferred",new jFe),this._callback=e,this._that=t}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...e){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...e)).then(e=>this._deferred.resolve(e),e=>this._deferred.reject(e))}catch(e){this._deferred.reject(e)}}return this._deferred.promise}}function $Fe(e,t){return new Promise(n=>{Kh.with(Uje(Kh.active()),()=>{e.export(t,e=>{n(e)})})})}const BFe={_export:$Fe};function HFe(){return"unknown_service"}const ly=e=>null!==e&&"object"==typeof e&&"function"==typeof e.then;class GC{constructor(e){De(this,"_rawAttributes"),De(this,"_asyncAttributesPending",!1),De(this,"_memoizedAttributes");const t=e.attributes??{};this._rawAttributes=Object.entries(t).map(([e,t])=>(ly(t)&&(this._asyncAttributesPending=!0),[e,t])),this._rawAttributes=EG(this._rawAttributes)}static FromAttributeList(e){const t=new GC({});return t._rawAttributes=EG(e),t._asyncAttributesPending=e.filter(([e,t])=>ly(t)).length>0,t}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let e=0;e<this._rawAttributes.length;e++){const[t,n]=this._rawAttributes[e];this._rawAttributes[e]=[t,ly(n)?await n:n]}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&vn.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;const e={};for(const[t,n]of this._rawAttributes)ly(n)?vn.debug(`Unsettled resource attribute ${t} skipped`):null!=n&&(e[t]??(e[t]=n));return this._asyncAttributesPending||(this._memoizedAttributes=e),e}getRawAttributes(){return this._rawAttributes}merge(e){return null==e?this:GC.FromAttributeList([...e.getRawAttributes(),...this.getRawAttributes()])}}function Gae(e){return GC.FromAttributeList(Object.entries(e))}function VFe(){return Gae({[Dae]:HFe(),[ZL]:lx[ZL],[e7]:lx[e7],[t7]:lx[t7]})}function EG(e){return e.map(([e,t])=>ly(t)?[e,t.catch(t=>{vn.debug("promise rejection for resource attribute: %s - %s",e,t)})]:[e,t])}const qFe="exception";class GFe{constructor(e){De(this,"_spanContext"),De(this,"kind"),De(this,"parentSpanContext"),De(this,"attributes",{}),De(this,"links",[]),De(this,"events",[]),De(this,"startTime"),De(this,"resource"),De(this,"instrumentationScope"),De(this,"_droppedAttributesCount",0),De(this,"_droppedEventsCount",0),De(this,"_droppedLinksCount",0),De(this,"name"),De(this,"status",{code:XL.UNSET}),De(this,"endTime",[0,0]),De(this,"_ended",!1),De(this,"_duration",[-1,-1]),De(this,"_spanProcessor"),De(this,"_spanLimits"),De(this,"_attributeValueLengthLimit"),De(this,"_performanceStartTime"),De(this,"_performanceOffset"),De(this,"_startTimeProvided");const t=Date.now();this._spanContext=e.spanContext,this._performanceStartTime=Lg.now(),this._performanceOffset=t-(this._performanceStartTime+Nae()),this._startTimeProvided=null!=e.startTime,this._spanLimits=e.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=e.spanProcessor,this.name=e.name,this.parentSpanContext=e.parentSpanContext,this.kind=e.kind,this.links=e.links||[],this.startTime=this._getTime(e.startTime??t),this.resource=e.resource,this.instrumentationScope=e.scope,null!=e.attributes&&this.setAttributes(e.attributes),this._spanProcessor.onStart(this,e.context)}spanContext(){return this._spanContext}setAttribute(e,t){if(null==t||this._isSpanEnded())return this;if(0===e.length)return vn.warn(`Invalid attribute key: ${e}`),this;if(!Oae(t))return vn.warn(`Invalid attribute value set for key: ${e}`),this;const{attributeCountLimit:n}=this._spanLimits;return void 0!==n&&Object.keys(this.attributes).length>=n&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this)}setAttributes(e){for(const[t,n]of Object.entries(e))this.setAttribute(t,n);return this}addEvent(e,t,n){if(this._isSpanEnded())return this;const{eventCountLimit:r}=this._spanLimits;if(0===r)return vn.warn("No events allowed."),this._droppedEventsCount++,this;void 0!==r&&this.events.length>=r&&(0===this._droppedEventsCount&&vn.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),gG(t)&&(gG(n)||(n=t),t=void 0);const i=Ew(t);return this.events.push({name:e,attributes:i,time:this._getTime(n),droppedAttributesCount:0}),this}addLink(e){return this.links.push(e),this}addLinks(e){return this.links.push(...e),this}setStatus(e){return this._isSpanEnded()||(this.status={...e},null!=this.status.message&&"string"!=typeof e.message&&(vn.warn(`Dropping invalid status.message of type '${typeof e.message}', expected 'string'`),delete this.status.message)),this}updateName(e){return this._isSpanEnded()||(this.name=e),this}end(e){this._isSpanEnded()?vn.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`):(this._ended=!0,this.endTime=this._getTime(e),this._duration=oFe(this.startTime,this.endTime),this._duration[0]<0&&(vn.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&vn.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this))}_getTime(e){if("number"==typeof e&&e<=Lg.now())return sFe(e+this._performanceOffset);if("number"==typeof e)return cg(e);if(e instanceof Date)return cg(e.getTime());if(Uae(e))return e;if(this._startTimeProvided)return cg(Date.now());const t=Lg.now()-this._performanceStartTime;return jae(this.startTime,cg(t))}isRecording(){return!1===this._ended}recordException(e,t){const n={};"string"==typeof e?n[ax]=e:e&&(e.code?n[cx]=e.code.toString():e.name&&(n[cx]=e.name),e.message&&(n[ax]=e.message),e.stack&&(n[Zje]=e.stack)),n[cx]||n[ax]?this.addEvent(qFe,n,t):vn.warn(`Failed to record an exception ${e}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){const e=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);vn.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,e)}return this._ended}_truncateToLimitUtil(e,t){return e.length<=t?e:e.substring(0,t)}_truncateToSize(e){const t=this._attributeValueLengthLimit;return t<=0?(vn.warn(`Attribute value limit must be positive, got ${t}`),e):"string"==typeof e?this._truncateToLimitUtil(e,t):Array.isArray(e)?e.map(e=>"string"==typeof e?this._truncateToLimitUtil(e,t):e):e}}var pv;!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(pv||(pv={}));class KC{shouldSample(){return{decision:pv.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class Pg{shouldSample(){return{decision:pv.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class J2{constructor(e){De(this,"_root"),De(this,"_remoteParentSampled"),De(this,"_remoteParentNotSampled"),De(this,"_localParentSampled"),De(this,"_localParentNotSampled"),this._root=e.root,this._root||(a8(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Pg),this._remoteParentSampled=e.remoteParentSampled??new Pg,this._remoteParentNotSampled=e.remoteParentNotSampled??new KC,this._localParentSampled=e.localParentSampled??new Pg,this._localParentNotSampled=e.localParentNotSampled??new KC}shouldSample(e,t,n,r,i,o){const s=qa.getSpanContext(e);return s&&GT(s)?s.isRemote?s.traceFlags&Nu.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,i,o):this._remoteParentNotSampled.shouldSample(e,t,n,r,i,o):s.traceFlags&Nu.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,i,o):this._localParentNotSampled.shouldSample(e,t,n,r,i,o):this._root.shouldSample(e,t,n,r,i,o)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class wG{constructor(e=0){De(this,"_ratio"),De(this,"_upperBound"),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}shouldSample(e,t){return{decision:xae(t)&&this._accumulate(t)<this._upperBound?pv.RECORD_AND_SAMPLED:pv.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e}_accumulate(e){let t=0;for(let n=0;n<e.length/8;n++){const r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t}}const CG=1;function Kae(){return{sampler:zae(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:1/0,attributeCountLimit:128},spanLimits:{attributeValueLengthLimit:1/0,attributeCountLimit:128,linkCountLimit:128,eventCountLimit:128,attributePerEventCountLimit:128,attributePerLinkCountLimit:128}}}function zae(){const e="parentbased_always_on";switch(e){case"always_on":return new Pg;case"always_off":return new KC;case"parentbased_always_on":return new J2({root:new Pg});case"parentbased_always_off":return new J2({root:new KC});case"traceidratio":return new wG(TG());case"parentbased_traceidratio":return new J2({root:new wG(TG())});default:return vn.error(`OTEL_TRACES_SAMPLER value "${e}" invalid, defaulting to "parentbased_always_on".`),new J2({root:new Pg})}}function TG(){return vn.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1}const KFe=128,zFe=1/0;function WFe(e){const t={sampler:zae()},n=Kae(),r=Object.assign({},n,t,e);return r.generalLimits=Object.assign({},n.generalLimits,e.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,e.spanLimits||{}),r}function YFe(e){var t,n,r,i;const o=Object.assign({},e.spanLimits);return o.attributeCountLimit=(null==(t=e.spanLimits)?void 0:t.attributeCountLimit)??(null==(n=e.generalLimits)?void 0:n.attributeCountLimit)??void 0??void 0??128,o.attributeValueLengthLimit=(null==(r=e.spanLimits)?void 0:r.attributeValueLengthLimit)??(null==(i=e.generalLimits)?void 0:i.attributeValueLengthLimit)??void 0??void 0??zFe,Object.assign({},e,{spanLimits:o})}const XFe=8,JFe=16;class QFe{constructor(){De(this,"generateTraceId",RG(16)),De(this,"generateSpanId",RG(8))}}const Q2=Array(32);function RG(e){return function(){for(let t=0;t<2*e;t++)Q2[t]=Math.floor(16*Math.random())+48,Q2[t]>=58&&(Q2[t]+=39);return String.fromCharCode.apply(null,Q2.slice(0,2*e))}}class ZFe{constructor(e,t,n,r){De(this,"_sampler"),De(this,"_generalLimits"),De(this,"_spanLimits"),De(this,"_idGenerator"),De(this,"instrumentationScope"),De(this,"_resource"),De(this,"_spanProcessor");const i=WFe(t);this._sampler=i.sampler,this._generalLimits=i.generalLimits,this._spanLimits=i.spanLimits,this._idGenerator=t.idGenerator||new QFe,this._resource=n,this._spanProcessor=r,this.instrumentationScope=e}startSpan(e,t={},n=Kh.active()){t.root&&(n=qa.deleteSpan(n));const r=qa.getSpan(n);if(o8(n))return vn.debug("Instrumentation suppressed, returning Noop Span"),qa.wrapSpanContext(Iae);const i=null==r?void 0:r.spanContext(),o=this._idGenerator.generateSpanId();let s,a,l;i&&qa.isSpanContextValid(i)?(a=i.traceId,l=i.traceState,s=i):a=this._idGenerator.generateTraceId();const c=t.kind??YL.INTERNAL,u=(t.links??[]).map(e=>({context:e.context,attributes:Ew(e.attributes)})),d=Ew(t.attributes),h=this._sampler.shouldSample(n,a,e,c,d,u);l=h.traceState??l;const p={traceId:a,spanId:o,traceFlags:h.decision===HC.RECORD_AND_SAMPLED?Nu.SAMPLED:Nu.NONE,traceState:l};if(h.decision===HC.NOT_RECORD)return vn.debug("Recording is off, propagating context in a non-recording span"),qa.wrapSpanContext(p);const f=Ew(Object.assign(d,h.attributes));return new GFe({resource:this._resource,scope:this.instrumentationScope,context:n,spanContext:p,name:e,kind:c,links:u,parentSpanContext:s,attributes:f,startTime:t.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(e,t,n,r){let i,o,s;if(arguments.length<2)return;2===arguments.length?s=t:3===arguments.length?(i=t,s=n):(i=t,o=n,s=r);const a=o??Kh.active(),l=this.startSpan(e,i,a),c=qa.setSpan(a,l);return Kh.with(c,s,void 0,l)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}}class e$e{constructor(e){De(this,"_spanProcessors"),this._spanProcessors=e}forceFlush(){const e=[];for(const t of this._spanProcessors)e.push(t.forceFlush());return new Promise(t=>{Promise.all(e).then(()=>{t()}).catch(e=>{a8(e||new Error("MultiSpanProcessor: forceFlush failed")),t()})})}onStart(e,t){for(const n of this._spanProcessors)n.onStart(e,t)}onEnd(e){for(const t of this._spanProcessors)t.onEnd(e)}shutdown(){const e=[];for(const t of this._spanProcessors)e.push(t.shutdown());return new Promise((t,n)=>{Promise.all(e).then(()=>{t()},n)})}}var kh;!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(kh||(kh={}));class t$e{constructor(e={}){var t;De(this,"_config"),De(this,"_tracers",new Map),De(this,"_resource"),De(this,"_activeSpanProcessor");const n=NFe({},Kae(),YFe(e));this._resource=n.resource??VFe(),this._config=Object.assign({},n,{resource:this._resource});const r=[];null!=(t=e.spanProcessors)&&t.length&&r.push(...e.spanProcessors),this._activeSpanProcessor=new e$e(r)}getTracer(e,t,n){const r=`${e}@${t||""}:${(null==n?void 0:n.schemaUrl)||""}`;return this._tracers.has(r)||this._tracers.set(r,new ZFe({name:e,version:t,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(r)}forceFlush(){const e=this._config.forceFlushTimeoutMillis,t=this._activeSpanProcessor._spanProcessors.map(t=>new Promise(n=>{let r;const i=setTimeout(()=>{n(new Error(`Span processor did not completed within timeout period of ${e} ms`)),r=kh.timeout},e);t.forceFlush().then(()=>{clearTimeout(i),r!==kh.timeout&&(r=kh.resolved,n(r))}).catch(e=>{clearTimeout(i),r=kh.error,n(e)})}));return new Promise((e,n)=>{Promise.all(t).then(t=>{const r=t.filter(e=>e!==kh.resolved);r.length>0?n(r):e()}).catch(e=>n([e]))})}shutdown(){return this._activeSpanProcessor.shutdown()}}class n$e{constructor(e){De(this,"_exporter"),De(this,"_shutdownOnce"),De(this,"_pendingExports"),this._exporter=e,this._shutdownOnce=new FFe(this._shutdown,this),this._pendingExports=new Set}async forceFlush(){await Promise.all(Array.from(this._pendingExports)),this._exporter.forceFlush&&await this._exporter.forceFlush()}onStart(e,t){}onEnd(e){if(this._shutdownOnce.isCalled||0===(e.spanContext().traceFlags&Nu.SAMPLED))return;const t=this._doExport(e).catch(e=>a8(e));this._pendingExports.add(t),t.finally(()=>this._pendingExports.delete(t))}async _doExport(e){var t,n;e.resource.asyncAttributesPending&&await(null==(n=(t=e.resource).waitForAsyncAttributes)?void 0:n.call(t));const r=await BFe._export(this._exporter,[e]);if(r.code!==Fc.SUCCESS)throw r.error??new Error(`SimpleSpanProcessor: span export failed (status ${r})`)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return this._exporter.shutdown()}}class r$e{constructor(e){De(this,"_delegate"),this._delegate=e}export(e,t){this._delegate.export(e,t)}forceFlush(){return this._delegate.forceFlush()}shutdown(){return this._delegate.shutdown()}}class IG extends Error{constructor(e,t,n){super(e),De(this,"code"),De(this,"name","OTLPExporterError"),De(this,"data"),this.data=n,this.code=t}}function i$e(e){if(Number.isFinite(e)&&e>0)return e;throw new Error(`Configuration: timeoutMillis is invalid, expected number greater than 0 (actual: '${e}')`)}function s$e(e){if(null!=e)return()=>e}function o$e(e,t,n){return{timeoutMillis:i$e(e.timeoutMillis??t.timeoutMillis??n.timeoutMillis),concurrencyLimit:e.concurrencyLimit??t.concurrencyLimit??n.concurrencyLimit,compression:e.compression??t.compression??n.compression}}function a$e(){return{timeoutMillis:1e4,concurrencyLimit:30,compression:"none"}}class c$e{constructor(e){De(this,"_concurrencyLimit"),De(this,"_sendingPromises",[]),this._concurrencyLimit=e}pushPromise(e){if(this.hasReachedLimit())throw new Error("Concurrency Limit reached");this._sendingPromises.push(e);const t=()=>{const t=this._sendingPromises.indexOf(e);this._sendingPromises.splice(t,1)};e.then(t,t)}hasReachedLimit(){return this._sendingPromises.length>=this._concurrencyLimit}async awaitAll(){await Promise.all(this._sendingPromises)}}function l$e(e){return new c$e(e.concurrencyLimit)}function u$e(e){return Object.prototype.hasOwnProperty.call(e,"partialSuccess")}function d$e(){return{handleResponse(e){null==e||!u$e(e)||null==e.partialSuccess||0===Object.keys(e.partialSuccess).length||vn.warn("Received Partial Success response:",JSON.stringify(e.partialSuccess))}}}class f$e{constructor(e,t,n,r,i){De(this,"_transport"),De(this,"_serializer"),De(this,"_responseHandler"),De(this,"_promiseQueue"),De(this,"_timeout"),De(this,"_diagLogger"),this._transport=e,this._serializer=t,this._responseHandler=n,this._promiseQueue=r,this._timeout=i,this._diagLogger=vn.createComponentLogger({namespace:"OTLPExportDelegate"})}export(e,t){if(this._diagLogger.debug("items to be sent",e),this._promiseQueue.hasReachedLimit())return void t({code:Fc.FAILED,error:new Error("Concurrent export limit reached")});const n=this._serializer.serializeRequest(e);null!=n?this._promiseQueue.pushPromise(this._transport.send(n,this._timeout).then(e=>{if("success"!==e.status)"failure"===e.status&&e.error?t({code:Fc.FAILED,error:e.error}):"retryable"===e.status?t({code:Fc.FAILED,error:new IG("Export failed with retryable status")}):t({code:Fc.FAILED,error:new IG("Export failed with unknown error")});else{if(null!=e.data)try{this._responseHandler.handleResponse(this._serializer.deserializeResponse(e.data))}catch(t){this._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",t,e.data)}t({code:Fc.SUCCESS})}},e=>t({code:Fc.FAILED,error:e}))):t({code:Fc.FAILED,error:new Error("Nothing to send")})}forceFlush(){return this._promiseQueue.awaitAll()}async shutdown(){this._diagLogger.debug("shutdown started"),await this.forceFlush(),this._transport.shutdown()}}function h$e(e,t){return new f$e(e.transport,e.serializer,d$e(),e.promiseHandler,t.timeout)}function Wae(e,t,n){return h$e({transport:n,serializer:t,promiseHandler:l$e(e)},{timeout:e.timeoutMillis})}function kG(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}function Yae(e){const t=new Uint8Array(e.length/2);let n=0;for(let r=0;r<e.length;r+=2){const i=kG(e.charCodeAt(r)),o=kG(e.charCodeAt(r+1));t[n++]=i<<4|o}return t}function Xae(e){const t=BigInt(1e9);return BigInt(e[0])*t+BigInt(e[1])}function p$e(e){return{low:Number(BigInt.asUintN(32,e)),high:Number(BigInt.asUintN(32,e>>BigInt(32)))}}function m$e(e){return p$e(Xae(e))}function g$e(e){return Xae(e).toString()}const v$e=typeof BigInt<"u"?g$e:aFe;function xG(e){return e}function y$e(e){if(void 0!==e)return Yae(e)}const b$e={encodeHrTime:m$e,encodeSpanContext:Yae,encodeOptionalSpanContext:y$e};function _$e(e){return void 0===e?b$e:{encodeHrTime:v$e,encodeSpanContext:xG,encodeOptionalSpanContext:xG}}function S$e(e){return{attributes:KT(e.attributes),droppedAttributesCount:0}}function E$e(e){return{name:e.name,version:e.version}}function KT(e){return Object.keys(e).map(t=>Jae(t,e[t]))}function Jae(e,t){return{key:e,value:Qae(t)}}function Qae(e){const t=typeof e;return"string"===t?{stringValue:e}:"number"===t?Number.isInteger(e)?{intValue:e}:{doubleValue:e}:"boolean"===t?{boolValue:e}:e instanceof Uint8Array?{bytesValue:e}:Array.isArray(e)?{arrayValue:{values:e.map(Qae)}}:"object"===t&&null!=e?{kvlistValue:{values:Object.entries(e).map(([e,t])=>Jae(e,t))}}:{}}function w$e(e,t){var n,r,i;const o=e.spanContext(),s=e.status,a=null!=(n=e.parentSpanContext)&&n.spanId?t.encodeSpanContext(null==(r=e.parentSpanContext)?void 0:r.spanId):void 0;return{traceId:t.encodeSpanContext(o.traceId),spanId:t.encodeSpanContext(o.spanId),parentSpanId:a,traceState:null==(i=o.traceState)?void 0:i.serialize(),name:e.name,kind:null==e.kind?0:e.kind+1,startTimeUnixNano:t.encodeHrTime(e.startTime),endTimeUnixNano:t.encodeHrTime(e.endTime),attributes:KT(e.attributes),droppedAttributesCount:e.droppedAttributesCount,events:e.events.map(e=>T$e(e,t)),droppedEventsCount:e.droppedEventsCount,status:{code:s.code,message:s.message},links:e.links.map(e=>C$e(e,t)),droppedLinksCount:e.droppedLinksCount}}function C$e(e,t){var n;return{attributes:e.attributes?KT(e.attributes):[],spanId:t.encodeSpanContext(e.context.spanId),traceId:t.encodeSpanContext(e.context.traceId),traceState:null==(n=e.context.traceState)?void 0:n.serialize(),droppedAttributesCount:e.droppedAttributesCount||0}}function T$e(e,t){return{attributes:e.attributes?KT(e.attributes):[],name:e.name,timeUnixNano:t.encodeHrTime(e.time),droppedAttributesCount:e.droppedAttributesCount||0}}function R$e(e,t){return{resourceSpans:k$e(e,_$e(t))}}function I$e(e){const t=new Map;for(const n of e){let e=t.get(n.resource);e||(e=new Map,t.set(n.resource,e));const r=`${n.instrumentationScope.name}@${n.instrumentationScope.version||""}:${n.instrumentationScope.schemaUrl||""}`;let i=e.get(r);i||(i=[],e.set(r,i)),i.push(n)}return t}function k$e(e,t){const n=[],r=I$e(e).entries();let i=r.next();for(;!i.done;){const[e,o]=i.value,s=[],a=o.values();let l=a.next();for(;!l.done;){const e=l.value;if(e.length>0){const n=e.map(e=>w$e(e,t));s.push({scope:E$e(e[0].instrumentationScope),spans:n,schemaUrl:e[0].instrumentationScope.schemaUrl})}l=a.next()}const c={resource:S$e(e),scopeSpans:s,schemaUrl:void 0};n.push(c),i=r.next()}return n}const x$e={serializeRequest:e=>{const t=R$e(e,{});return(new TextEncoder).encode(JSON.stringify(t))},deserializeResponse:e=>{if(0===e.length)return{};const t=new TextDecoder;return JSON.parse(t.decode(e))}},A$e=5,L$e=1e3,P$e=5e3,O$e=1.5,AG=.2;function M$e(){return.4*Math.random()-AG}class D$e{constructor(e){De(this,"_transport"),this._transport=e}retry(e,t,n){return new Promise((r,i)=>{setTimeout(()=>{this._transport.send(e,t).then(r,i)},n)})}async send(e,t){const n=Date.now()+t;let r=await this._transport.send(e,t),i=5,o=L$e;for(;"retryable"===r.status&&i>0;){i--;const t=Math.max(Math.min(o,P$e)+M$e(),0);o*=1.5;const s=r.retryInMillis??t,a=n-Date.now();if(s>a)return r;r=await this.retry(e,a,s)}return r}shutdown(){return this._transport.shutdown()}}function Zae(e){return new D$e(e.transport)}function N$e(e){return[429,502,503,504].includes(e)}function U$e(e){if(null==e)return;const t=Number.parseInt(e,10);if(Number.isInteger(t))return t>0?1e3*t:-1;const n=new Date(e).getTime()-Date.now();return n>=0?n:0}class j$e{constructor(e){De(this,"_parameters"),this._parameters=e}send(e,t){return new Promise(n=>{const r=new XMLHttpRequest;r.timeout=t,r.open("POST",this._parameters.url);const i=this._parameters.headers();Object.entries(i).forEach(([e,t])=>{r.setRequestHeader(e,t)}),r.ontimeout=e=>{n({status:"failure",error:new Error("XHR request timed out")})},r.onreadystatechange=()=>{r.status>=200&&r.status<=299?(vn.debug("XHR success"),n({status:"success"})):r.status&&N$e(r.status)?n({status:"retryable",retryInMillis:U$e(r.getResponseHeader("Retry-After"))}):0!==r.status&&n({status:"failure",error:new Error("XHR request failed with non-retryable status")})},r.onabort=()=>{n({status:"failure",error:new Error("XHR request aborted")})},r.onerror=()=>{n({status:"failure",error:new Error("XHR request errored")})},r.send(e)})}shutdown(){}}function F$e(e){return new j$e(e)}class $$e{constructor(e){De(this,"_params"),this._params=e}send(e){return new Promise(t=>{navigator.sendBeacon(this._params.url,new Blob([e],{type:this._params.blobType}))?(vn.debug("SendBeacon success"),t({status:"success"})):t({status:"failure",error:new Error("SendBeacon failed")})})}shutdown(){}}function B$e(e){return new $$e(e)}function H$e(e,t){return Wae(e,t,Zae({transport:F$e(e)}))}function V$e(e,t){return Wae(e,t,Zae({transport:B$e({url:e.url,blobType:e.headers()["Content-Type"]})}))}function q$e(e){return()=>{const t={};return Object.entries((null==e?void 0:e())??{}).forEach(([e,n])=>{typeof n<"u"?t[e]=String(n):vn.warn(`Header "${e}" has invalid value (${n}) and will be ignored`)}),t}}function G$e(e,t,n){const r={...n()},i={};return()=>(null!=t&&Object.assign(i,t()),null!=e&&Object.assign(i,e()),Object.assign(i,r))}function K$e(e){if(null!=e)try{return new URL(e),e}catch{throw new Error(`Configuration: Could not parse user-provided export URL: '${e}'`)}}function z$e(e,t,n){return{...o$e(e,t,n),headers:G$e(q$e(e.headers),t.headers,n.headers),url:K$e(e.url)??t.url??n.url,agentOptions:e.agentOptions??t.agentOptions??n.agentOptions}}function W$e(e,t){return{...a$e(),headers:()=>e,url:"http://localhost:4318/"+t,agentOptions:{keepAlive:!0}}}function Y$e(e,t,n){return z$e({url:e.url,timeoutMillis:e.timeoutMillis,headers:s$e(e.headers),concurrencyLimit:e.concurrencyLimit},{},W$e(n,t))}function X$e(e,t,n,r){const i=!!e.headers||"function"!=typeof navigator.sendBeacon,o=Y$e(e,n,r);return i?H$e(o,t):V$e(o,t)}class J$e extends r$e{constructor(e={}){super(X$e(e,x$e,"v1/traces",{"Content-Type":"application/json"}))}}class Q$e{constructor(){De(this,"_enabled",!1),De(this,"_currentContext",Qm)}_bindFunction(e=Qm,t){const n=this,r=function(...r){return n.with(e,()=>t.apply(this,r))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r}active(){return this._currentContext}bind(e,t){return void 0===e&&(e=this.active()),"function"==typeof t?this._bindFunction(e,t):t}disable(){return this._currentContext=Qm,this._enabled=!1,this}enable(){return this._enabled||(this._enabled=!0,this._currentContext=Qm),this}with(e,t,n,...r){const i=this._currentContext;this._currentContext=e||Qm;try{return t.call(n,...r)}finally{this._currentContext=i}}}function Z$e(e){if(null!==e){if(void 0===e){const e=new Q$e;return e.enable(),void Kh.setGlobalContextManager(e)}e.enable(),Kh.setGlobalContextManager(e)}}function eBe(e){if(null!==e){if(void 0===e)return void Uy.setGlobalPropagator(new cFe({propagators:[new CFe,new Gje]}));Uy.setGlobalPropagator(e)}}class tBe extends t$e{constructor(e={}){super(e)}register(e={}){qa.setGlobalTracerProvider(this),eBe(e.propagator),Z$e(e.contextManager)}}function LG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?LG(Object(n),!0).forEach(function(t){pe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ab(e){return(Ab="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PG(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jt(e,t,n){return t&&PG(e.prototype,t),n&&PG(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nBe(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function cs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}}(e,t)||l8(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _u(e){return function(e){if(Array.isArray(e))return r7(e)}(e)||function(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l8(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l8(e,t){if(e){if("string"==typeof e)return r7(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r7(e,t):void 0}}function r7(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function va(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l8(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}var ea={DEBUG:!1,LIB_VERSION:"1.160.3"},rBe=Array.isArray,ece=Object.prototype,tce=ece.hasOwnProperty,zT=ece.toString,ei=rBe||function(e){return"[object Array]"===zT.call(e)},ca=function(e){return"function"==typeof e},Di=function(e){return e===Object(e)&&!ei(e)},Cw=function(e){if(Di(e)){for(var t in e)if(tce.call(e,t))return!1;return!0}return!1},et=function(e){return void 0===e},es=function(e){return"[object String]"==zT.call(e)},OG=function(e){return es(e)&&0===e.trim().length},qu=function(e){return null===e},qs=function(e){return et(e)||qu(e)},ta=function(e){return"[object Number]"==zT.call(e)},Ph=function(e){return"[object Boolean]"===zT.call(e)},iBe=function(e){return e instanceof FormData},se=typeof window<"u"?window:void 0,js=typeof globalThis<"u"?globalThis:se,nce=Array.prototype,MG=nce.forEach,DG=nce.indexOf,Ja=null==js?void 0:js.navigator,He=null==js?void 0:js.document,xs=null==js?void 0:js.location,i7=null==js?void 0:js.fetch,s7=null!=js&&js.XMLHttpRequest&&"withCredentials"in new js.XMLHttpRequest?js.XMLHttpRequest:void 0,NG=null==js?void 0:js.AbortController,pi=null==Ja?void 0:Ja.userAgent,Yn=se??{},UG="[PostHog.js]",Se={_log:function(e){if(se&&(ea.DEBUG||Yn.POSTHOG_DEBUG)&&!et(se.console)&&se.console){for(var t=("__rrweb_original__"in se.console[e]?se.console[e].__rrweb_original__:se.console[e]),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.apply(void 0,[UG].concat(r))}},info:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Se._log.apply(Se,["log"].concat(t))},warn:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Se._log.apply(Se,["warn"].concat(t))},error:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Se._log.apply(Se,["error"].concat(t))},critical:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).error.apply(e,[UG].concat(n))},uninitializedWarning:function(e){Se.error("You must initialize PostHog before calling ".concat(e))}},zC={},WT=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Og(e,t,n){if(ei(e))if(MG&&e.forEach===MG)e.forEach(t,n);else if("length"in e&&e.length===+e.length)for(var r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r)===zC)return}function An(e,t,n){if(!qs(e)){if(ei(e))return Og(e,t,n);if(iBe(e)){var r,i=va(e.entries());try{for(i.s();!(r=i.n()).done;){var o=r.value;if(t.call(n,o[1],o[0])===zC)return}}catch(e){i.e(e)}finally{i.f()}}else for(var s in e)if(tce.call(e,s)&&t.call(n,e[s],s)===zC)return}}var ls=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Og(n,function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])}),e};function Ut(e,t){return-1!==e.indexOf(t)}function Tw(e){for(var t=Object.keys(e),n=t.length,r=new Array(n);n--;)r[n]=[t[n],e[t[n]]];return r}var rce=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},jG=function(e){try{return e()}catch{return}},sBe=function(e){return function(){try{for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(this,n)}catch(e){Se.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),Se.critical(e)}}},o7=function(e){var t={};return An(e,function(e,n){es(e)&&e.length>0&&(t[n]=e)}),t},a7=function(e){return e.replace(/^\$/,"")};function oBe(e,t){return n=e,r=function(e){return es(e)&&!qu(t)?e.slice(0,t):e},i=new Set,function e(t,n){return t!==Object(t)?r?r(t):t:i.has(t)?void 0:(i.add(t),ei(t)?(o=[],Og(t,function(t){o.push(e(t))})):(o={},An(t,function(t,n){i.has(t)||(o[n]=e(t,n))})),o);var o}(n);var n,r,i}var Ya,aBe=function(e){var t,n,r,i,o="";for(t=n=0,r=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,i=0;i<r;i++){var s=e.charCodeAt(i),a=null;s<128?n++:a=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),qu(a)||(n>t&&(o+=e.substring(t,n)),o+=a,t=n=i+1)}return n>t&&(o+=e.substring(t,e.length)),o},cu=function(){function e(t){return t&&(t.preventDefault=e.preventDefault,t.stopPropagation=e.stopPropagation),t}return e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0},function(t,n,r,i,o){if(t)if(t.addEventListener&&!i)t.addEventListener(n,r,!!o);else{var s="on"+n,a=t[s];t[s]=(l=t,c=r,u=a,function(t){if(t=t||e(null==se?void 0:se.event)){var n,r=!0;ca(u)&&(n=u(t));var i=c.call(l,t);return!1!==n&&!1!==i||(r=!1),r}})}else Se.error("No valid element provided to register_event");var l,c,u}}();function ice(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]}!function(e){e.GZipJS="gzip-js",e.Base64="base64"}(Ya||(Ya={}));var sce="$people_distinct_id",uy="__alias",dy="__timers",FG="$autocapture_disabled_server_side",c7="$heatmaps_enabled_server_side",$G="$exception_capture_enabled_server_side",BG="$exception_capture_endpoint_suffix",HG="$web_vitals_enabled_server_side",l7="$session_recording_enabled_server_side",VG="$console_log_recording_enabled_server_side",qG="$session_recording_network_payload_capture",GG="$session_recording_canvas_recording",KG="$replay_sample_rate",zG="$replay_minimum_duration",WC="$sesid",jy="$session_is_sampled",lg="$enabled_feature_flags",u7="$early_access_features",ug="$stored_person_properties",Nd="$stored_group_properties",d7="$surveys",Z2="$surveys_activated",YC="$flag_call_reported",Wl="$user_state",f7="$client_session_props",h7="$capture_rate_limit",p7="$initial_campaign_params",m7="$initial_referrer_info",WG="$initial_person_info",XC="$epp",g7="__POSTHOG_TOOLBAR__",cBe=[sce,uy,"__cmpns",dy,l7,c7,WC,lg,Wl,u7,Nd,ug,d7,YC,f7,h7,p7,m7,XC],px="$active_feature_flags",eE="$override_feature_flags",YG="$feature_flag_payloads",XG=function(e){var t,n={},r=va(Tw(e||{}));try{for(r.s();!(t=r.n()).done;){var i=cs(t.value,2),o=i[0],s=i[1];s&&(n[o]=s)}}catch(e){r.e(e)}finally{r.f()}return n},lBe=function(){function e(t){Xt(this,e),this.instance=t,this._override_warning=!1,this.featureFlagEventHandlers=[],this.reloadFeatureFlagsQueued=!1,this.reloadFeatureFlagsInAction=!1}return Jt(e,[{key:"getFlags",value:function(){return Object.keys(this.getFlagVariants())}},{key:"getFlagVariants",value:function(){var e=this.instance.get_property(lg),t=this.instance.get_property(eE);if(!t)return e||{};for(var n=ls({},e),r=Object.keys(t),i=0;i<r.length;i++)n[r[i]]=t[r[i]];return this._override_warning||(Se.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:t,finalFlags:n}),this._override_warning=!0),n}},{key:"getFlagPayloads",value:function(){return this.instance.get_property(YG)||{}}},{key:"reloadFeatureFlags",value:function(){this.reloadFeatureFlagsQueued||(this.reloadFeatureFlagsQueued=!0,this._startReloadTimer())}},{key:"setAnonymousDistinctId",value:function(e){this.$anon_distinct_id=e}},{key:"setReloadingPaused",value:function(e){this.reloadFeatureFlagsInAction=e}},{key:"resetRequestQueue",value:function(){this.reloadFeatureFlagsQueued=!1}},{key:"_startReloadTimer",value:function(){var e=this;this.reloadFeatureFlagsQueued&&!this.reloadFeatureFlagsInAction&&setTimeout(function(){!e.reloadFeatureFlagsInAction&&e.reloadFeatureFlagsQueued&&(e.reloadFeatureFlagsQueued=!1,e._reloadFeatureFlagsRequest())},5)}},{key:"_reloadFeatureFlagsRequest",value:function(){var e=this;if(!this.instance.config.advanced_disable_feature_flags){this.setReloadingPaused(!0);var t=this.instance.config.token,n=this.instance.get_property(ug),r=this.instance.get_property(Nd),i={token:t,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:n,group_properties:r,disable_flags:this.instance.config.advanced_disable_feature_flags||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:i,compression:this.instance.config.disable_compression?void 0:Ya.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(t){var n;e.setReloadingPaused(!1);var r=!0;200===t.statusCode&&(e.$anon_distinct_id=void 0,r=!1),e.receivedFeatureFlags(null!==(n=t.json)&&void 0!==n?n:{},r),e._startReloadTimer()}})}}},{key:"getFeatureFlag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0){var n,r=this.getFlagVariants()[e],i="".concat(r),o=this.instance.get_property(YC)||{};return(t.send_event||!("send_event"in t))&&(!(e in o)||!o[e].includes(i))&&(ei(o[e])?o[e].push(i):o[e]=[i],null===(n=this.instance.persistence)||void 0===n||n.register(pe({},YC,o)),this.instance.capture("$feature_flag_called",{$feature_flag:e,$feature_flag_response:r})),r}Se.warn('getFeatureFlag for key "'+e+"\" failed. Feature flags didn't load in time.")}},{key:"getFeatureFlagPayload",value:function(e){return this.getFlagPayloads()[e]}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,t);Se.warn('isFeatureEnabled for key "'+e+"\" failed. Feature flags didn't load in time.")}},{key:"addFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers.push(e)}},{key:"removeFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(function(t){return t!==e})}},{key:"receivedFeatureFlags",value:function(e,t){if(this.instance.persistence){this.instance.decideEndpointWasHit=!0;var n=this.getFlagVariants(),r=this.getFlagPayloads();(function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e.featureFlags,s=e.featureFlagPayloads;if(o)if(ei(o)){var a,l={};if(o)for(var c=0;c<o.length;c++)l[o[c]]=!0;t&&t.register((pe(a={},px,o),pe(a,lg,l),a))}else{var u=o,d=s;e.errorsWhileComputingFlags&&(u=Fe(Fe({},r),u),d=Fe(Fe({},i),d)),t&&t.register((pe(n={},px,Object.keys(XG(u))),pe(n,lg,u||{}),pe(n,YG,d||{}),n))}})(e,this.instance.persistence,n,r),this._fireFeatureFlagsCallbacks(t)}}},{key:"override",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.instance.__loaded||!this.instance.persistence)return Se.uninitializedWarning("posthog.feature_flags.override");if(this._override_warning=t,!1===e)this.instance.persistence.unregister(eE);else if(ei(e)){for(var n={},r=0;r<e.length;r++)n[e[r]]=!0;this.instance.persistence.register(pe({},eE,n))}else this.instance.persistence.register(pe({},eE,e))}},{key:"onFeatureFlags",value:function(e){var t=this;if(this.addFeatureFlagsHandler(e),this.instance.decideEndpointWasHit){var n=this._prepareFeatureFlagsForCallbacks(),r=n.flags,i=n.flagVariants;e(r,i)}return function(){return t.removeFeatureFlagsHandler(e)}}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,t){var n,r,i=pe({},"$feature_enrollment/".concat(e),t);this.instance.capture("$feature_enrollment_update",{$feature_flag:e,$feature_enrollment:t,$set:i}),this.setPersonPropertiesForFlags(i,!1);var o=Fe(Fe({},this.getFlagVariants()),{},pe({},e,t));null===(n=this.instance.persistence)||void 0===n||n.register((pe(r={},px,Object.keys(XG(o))),pe(r,lg,o),r)),this._fireFeatureFlagsCallbacks()}},{key:"getEarlyAccessFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.instance.get_property(u7);if(r&&!n)return e(r);this.instance._send_request({transport:"XHR",url:this.instance.requestRouter.endpointFor("api","/api/early_access_features/?token=".concat(this.instance.config.token)),method:"GET",callback:function(n){var r;if(n.json){var i=n.json.earlyAccessFeatures;return null===(r=t.instance.persistence)||void 0===r||r.register(pe({},u7,i)),e(i)}}})}},{key:"_prepareFeatureFlagsForCallbacks",value:function(){var e=this.getFlags(),t=this.getFlagVariants();return{flags:e.filter(function(e){return t[e]}),flagVariants:Object.keys(t).filter(function(e){return t[e]}).reduce(function(e,n){return e[n]=t[n],e},{})}}},{key:"_fireFeatureFlagsCallbacks",value:function(e){var t=this._prepareFeatureFlagsForCallbacks(),n=t.flags,r=t.flagVariants;this.featureFlagEventHandlers.forEach(function(t){return t(n,r,{errorsLoading:e})})}},{key:"setPersonPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.instance.get_property(ug)||{};this.instance.register(pe({},ug,Fe(Fe({},n),e))),t&&this.instance.reloadFeatureFlags()}},{key:"resetPersonPropertiesForFlags",value:function(){this.instance.unregister(ug)}},{key:"setGroupPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.instance.get_property(Nd)||{};0!==Object.keys(n).length&&Object.keys(n).forEach(function(t){n[t]=Fe(Fe({},n[t]),e[t]),delete e[t]}),this.instance.register(pe({},Nd,Fe(Fe({},n),e))),t&&this.instance.reloadFeatureFlags()}},{key:"resetGroupPropertiesForFlags",value:function(e){if(e){var t=this.instance.get_property(Nd)||{};this.instance.register(pe({},Nd,Fe(Fe({},t),{},pe({},e,{}))))}else this.instance.unregister(Nd)}}]),e}();Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Number.isInteger||(Number.isInteger=function(e){return ta(e)&&isFinite(e)&&Math.floor(e)===e});var JG="0123456789abcdef",uBe=function(){function e(t){if(Xt(this,e),this.bytes=t,16!==t.length)throw new TypeError("not 128-bit length")}return Jt(e,[{key:"toString",value:function(){for(var e="",t=0;t<this.bytes.length;t++)e=e+JG.charAt(this.bytes[t]>>>4)+JG.charAt(15&this.bytes[t]),3!==t&&5!==t&&7!==t&&9!==t||(e+="-");if(36!==e.length)throw new Error("Invalid UUIDv7 was generated");return e}},{key:"clone",value:function(){return new e(this.bytes.slice(0))}},{key:"equals",value:function(e){return 0===this.compareTo(e)}},{key:"compareTo",value:function(e){for(var t=0;t<16;t++){var n=this.bytes[t]-e.bytes[t];if(0!==n)return Math.sign(n)}return 0}}],[{key:"fromFieldsV7",value:function(t,n,r,i){if(!Number.isInteger(t)||!Number.isInteger(n)||!Number.isInteger(r)||!Number.isInteger(i)||t<0||n<0||r<0||i<0||t>0xffffffffffff||n>4095||r>1073741823||i>4294967295)throw new RangeError("invalid field value");var o=new Uint8Array(16);return o[0]=t/Math.pow(2,40),o[1]=t/Math.pow(2,32),o[2]=t/Math.pow(2,24),o[3]=t/Math.pow(2,16),o[4]=t/Math.pow(2,8),o[5]=t,o[6]=112|n>>>8,o[7]=n,o[8]=128|r>>>24,o[9]=r>>>16,o[10]=r>>>8,o[11]=r,o[12]=i>>>24,o[13]=i>>>16,o[14]=i>>>8,o[15]=i,new e(o)}}]),e}(),dBe=function(){function e(){Xt(this,e),pe(this,"timestamp",0),pe(this,"counter",0),pe(this,"random",new fBe)}return Jt(e,[{key:"generate",value:function(){var e=this.generateOrAbort();if(et(e)){this.timestamp=0;var t=this.generateOrAbort();if(et(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}},{key:"generateOrAbort",value:function(){var e=Date.now();if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+1e4>this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return uBe.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}}]),e}(),oce=function(e){if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var t=0;t<e.length;t++)e[t]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return e};se&&!et(se.crypto)&&crypto.getRandomValues&&(oce=function(e){return crypto.getRandomValues(e)});var QG,fBe=function(){function e(){Xt(this,e),pe(this,"buffer",new Uint32Array(8)),pe(this,"cursor",1/0)}return Jt(e,[{key:"nextUint32",value:function(){return this.cursor>=this.buffer.length&&(oce(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}]),e}(),Wd=function(){return hBe().toString()},hBe=function(){return(QG||(QG=new dBe)).generate()},pBe="Thu, 01 Jan 1970 00:00:00 GMT",U0="",mBe=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function gBe(e,t){if(t){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:He;if(U0)return U0;if(!t||["localhost","127.0.0.1"].includes(e))return"";for(var n=e.split("."),r=Math.min(n.length,8),i="dmn_chk_"+Wd(),o=new RegExp("(^|;)\\s*"+i+"=1");!U0&&r--;){var s=n.slice(r).join("."),a=i+"=1;domain=."+s;t.cookie=a,o.test(t.cookie)&&(t.cookie=a+";expires="+pBe,U0=s)}return U0}(e);if(!n){var r=(i=e.match(mBe))?i[0]:"";r!==n&&Se.info("Warning: cookie subdomain discovery mismatch",r,n),n=r}return n?"; domain=."+n:""}var i;return""}var Ai,Su={is_supported:function(){return!!He},error:function(e){Se.error("cookieStore error: "+e)},get:function(e){if(He){try{for(var t=e+"=",n=He.cookie.split(";").filter(function(e){return e.length}),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}}catch{}return null}},parse:function(e){var t;try{t=JSON.parse(Su.get(e))||{}}catch{}return t},set:function(e,t,n,r,i){if(He)try{var o="",s="",a=gBe(He.location.hostname,r);if(n){var l=new Date;l.setTime(l.getTime()+24*n*60*60*1e3),o="; expires="+l.toUTCString()}i&&(s="; secure");var c=e+"="+encodeURIComponent(JSON.stringify(t))+o+"; SameSite=Lax; path=/"+a+s;return c.length>3686.4&&Se.warn("cookieStore warning: large cookie, len="+c.length),He.cookie=c,c}catch{return}},remove:function(e,t){try{Su.set(e,"",-1,t)}catch{return}}},mx=null,Qr={is_supported:function(){if(!qu(mx))return mx;var e=!0;if(et(se))e=!1;else try{var t="__mplssupport__";Qr.set(t,"xyz"),'"xyz"'!==Qr.get(t)&&(e=!1),Qr.remove(t)}catch{e=!1}return e||Se.error("localStorage unsupported; falling back to cookie store"),mx=e,e},error:function(e){Se.error("localStorage error: "+e)},get:function(e){try{return null==se?void 0:se.localStorage.getItem(e)}catch(e){Qr.error(e)}return null},parse:function(e){try{return JSON.parse(Qr.get(e))||{}}catch{}return null},set:function(e,t){try{null==se||se.localStorage.setItem(e,JSON.stringify(t))}catch(e){Qr.error(e)}},remove:function(e){try{null==se||se.localStorage.removeItem(e)}catch(e){Qr.error(e)}}},vBe=["distinct_id",WC,jy,XC],tE=Fe(Fe({},Qr),{},{parse:function(e){try{var t={};try{t=Su.parse(e)||{}}catch{}var n=ls(t,JSON.parse(Qr.get(e)||"{}"));return Qr.set(e,n),n}catch{}return null},set:function(e,t,n,r,i,o){try{Qr.set(e,t,void 0,void 0,o);var s={};vBe.forEach(function(e){t[e]&&(s[e]=t[e])}),Object.keys(s).length&&Su.set(e,s,n,r,i,o)}catch(e){Qr.error(e)}},remove:function(e,t){try{null==se||se.localStorage.removeItem(e),Su.remove(e,t)}catch(e){Qr.error(e)}}}),nE={},yBe={is_supported:function(){return!0},error:function(e){Se.error("memoryStorage error: "+e)},get:function(e){return nE[e]||null},parse:function(e){return nE[e]||null},set:function(e,t){nE[e]=t},remove:function(e){delete nE[e]}},hh=null,Mi={is_supported:function(){if(!qu(hh))return hh;if(hh=!0,et(se))hh=!1;else try{var e="__support__";Mi.set(e,"xyz"),'"xyz"'!==Mi.get(e)&&(hh=!1),Mi.remove(e)}catch{hh=!1}return hh},error:function(e){Se.error("sessionStorage error: ",e)},get:function(e){try{return null==se?void 0:se.sessionStorage.getItem(e)}catch(e){Mi.error(e)}return null},parse:function(e){try{return JSON.parse(Mi.get(e))||null}catch{}return null},set:function(e,t){try{null==se||se.sessionStorage.setItem(e,JSON.stringify(t))}catch(e){Mi.error(e)}},remove:function(e){try{null==se||se.sessionStorage.removeItem(e)}catch(e){Mi.error(e)}}},bBe=["localhost","127.0.0.1"],Fy=function(e){var t=null==He?void 0:He.createElement("a");return et(t)?null:(t.href=e,t)},JC=function(e,t){return!!function(e){try{new RegExp(e)}catch{return!1}return!0}(t)&&new RegExp(t).test(e)},_Be=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",i=[];return An(e,function(e,r){et(e)||et(r)||"undefined"===r||(t=encodeURIComponent(e instanceof File?e.name:e.toString()),n=encodeURIComponent(r),i[i.length]=n+"="+t)}),i.join(r)},ZG=function(e,t){for(var n,r=((e.split("#")[0]||"").split("?")[1]||"").split("&"),i=0;i<r.length;i++){var o=r[i].split("=");if(o[0]===t){n=o;break}}if(!ei(n)||n.length<2)return"";var s=n[1];try{s=decodeURIComponent(s)}catch{Se.error("Skipping decoding for malformed query param: "+s)}return s.replace(/\+/g," ")},QC=function(e,t){var n=e.match(new RegExp(t+"=([^&]*)"));return n?n[1]:null},pa="Mobile",ZC="iOS",Yc="Android",Lb="Tablet",ace=Yc+" "+Lb,cce="iPad",lce="Apple",uce=lce+" Watch",Pb="Safari",mv="BlackBerry",dce="Samsung",fce=dce+"Browser",hce=dce+" Internet",sf="Chrome",SBe=sf+" OS",pce=sf+" "+ZC,u8="Internet Explorer",mce=u8+" "+pa,d8="Opera",EBe=d8+" Mini",f8="Edge",gce="Microsoft "+f8,Mg="Firefox",vce=Mg+" "+ZC,Ob="Nintendo",Mb="PlayStation",Dg="Xbox",yce=Yc+" "+pa,bce=pa+" "+Pb,fy="Windows",v7=fy+" Phone",eK="Nokia",y7="Ouya",_ce="Generic",wBe=_ce+" "+pa.toLowerCase(),Sce=_ce+" "+Lb.toLowerCase(),b7="Konqueror",rs="(\\d+(\\.\\d+)?)",gx=new RegExp("Version/"+rs),CBe=new RegExp(Dg,"i"),TBe=new RegExp(Mb+" \\w+","i"),RBe=new RegExp(Ob+" \\w+","i"),h8=new RegExp(mv+"|PlayBook|BB10","i"),IBe={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},kBe=function(e,t){return t&&Ut(t,lce)||Ut(n=e,Pb)&&!Ut(n,sf)&&!Ut(n,Yc);var n},tK=function(e,t){return t=t||"",Ut(e," OPR/")&&Ut(e,"Mini")?EBe:Ut(e," OPR/")?d8:h8.test(e)?mv:Ut(e,"IE"+pa)||Ut(e,"WPDesktop")?mce:Ut(e,fce)?hce:Ut(e,f8)||Ut(e,"Edg/")?gce:Ut(e,"FBIOS")?"Facebook "+pa:Ut(e,"UCWEB")||Ut(e,"UCBrowser")?"UC Browser":Ut(e,"CriOS")?pce:Ut(e,"CrMo")?sf:Ut(e,Yc)&&Ut(e,Pb)?yce:Ut(e,sf)?sf:Ut(e,"FxiOS")?vce:Ut(e.toLowerCase(),b7.toLowerCase())?b7:kBe(e,t)?Ut(e,pa)?bce:Pb:Ut(e,Mg)?Mg:Ut(e,"MSIE")||Ut(e,"Trident/")?u8:Ut(e,"Gecko")?Mg:""},xBe=(pe(Ai={},mce,[new RegExp("rv:"+rs)]),pe(Ai,gce,[new RegExp(f8+"?\\/"+rs)]),pe(Ai,sf,[new RegExp("("+sf+"|CrMo)\\/"+rs)]),pe(Ai,pce,[new RegExp("CriOS\\/"+rs)]),pe(Ai,"UC Browser",[new RegExp("(UCBrowser|UCWEB)\\/"+rs)]),pe(Ai,Pb,[gx]),pe(Ai,bce,[gx]),pe(Ai,d8,[new RegExp("(Opera|OPR)\\/"+rs)]),pe(Ai,Mg,[new RegExp(Mg+"\\/"+rs)]),pe(Ai,vce,[new RegExp("FxiOS\\/"+rs)]),pe(Ai,b7,[new RegExp("Konqueror[:/]?"+rs,"i")]),pe(Ai,mv,[new RegExp(mv+" "+rs),gx]),pe(Ai,yce,[new RegExp("android\\s"+rs,"i")]),pe(Ai,hce,[new RegExp(fce+"\\/"+rs)]),pe(Ai,u8,[new RegExp("(rv:|MSIE )"+rs)]),pe(Ai,"Mozilla",[new RegExp("rv:"+rs)]),Ai),nK=[[new RegExp(Dg+"; "+Dg+" (.*?)[);]","i"),function(e){return[Dg,e&&e[1]||""]}],[new RegExp(Ob,"i"),[Ob,""]],[new RegExp(Mb,"i"),[Mb,""]],[h8,[mv,""]],[new RegExp(fy,"i"),function(e,t){if(/Phone/.test(t)||/WPDesktop/.test(t))return[v7,""];if(new RegExp(pa).test(t)&&!/IEMobile\b/.test(t))return[fy+" "+pa,""];var n=/Windows NT ([0-9.]+)/i.exec(t);if(n&&n[1]){var r=n[1],i=IBe[r]||"";return/arm/i.test(t)&&(i="RT"),[fy,i]}return[fy,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,function(e){if(e&&e[3]){var t=[e[3],e[4],e[5]||"0"];return[ZC,t.join(".")]}return[ZC,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,function(e){var t="";return e&&e.length>=3&&(t=et(e[2])?e[3]:e[2]),["watchOS",t]}],[new RegExp("("+Yc+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+Yc+")","i"),function(e){if(e&&e[2]){var t=[e[2],e[3],e[4]||"0"];return[Yc,t.join(".")]}return[Yc,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,function(e){var t=["Mac OS X",""];if(e&&e[1]){var n=[e[1],e[2],e[3]||"0"];t[1]=n.join(".")}return t}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[SBe,""]],[/Linux|debian/i,["Linux",""]]],rK=function(e){return RBe.test(e)?Ob:TBe.test(e)?Mb:CBe.test(e)?Dg:new RegExp(y7,"i").test(e)?y7:new RegExp("("+v7+"|WPDesktop)","i").test(e)?v7:/iPad/.test(e)?cce:/iPod/.test(e)?"iPod Touch":/iPhone/.test(e)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(e)?uce:h8.test(e)?mv:/(kobo)\s(ereader|touch)/i.test(e)?"Kobo":new RegExp(eK,"i").test(e)?eK:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(e)||/(kf[a-z]+)( bui|\)).+silk\//i.test(e)?"Kindle Fire":/(Android|ZTE)/i.test(e)?!new RegExp(pa).test(e)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(e)?/pixel[\daxl ]{1,6}/i.test(e)&&!/pixel c/i.test(e)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(e)||/lmy47v/i.test(e)&&!/QTAQZ3/i.test(e)?Yc:ace:Yc:new RegExp("(pda|"+pa+")","i").test(e)?wBe:new RegExp(Lb,"i").test(e)&&!new RegExp(Lb+" pc","i").test(e)?Sce:""},rE="https?://(.*)",ABe=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","gad_source","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","mc_cid","igshid","ttclid","rdt_cid"],mi={campaignParams:function(e){return He?this._campaignParamsFromUrl(He.URL,e):{}},_campaignParamsFromUrl:function(e,t){var n=ABe.concat(t||[]),r={};return An(n,function(t){var n=ZG(e,t);n&&(r[t]=n)}),r},_searchEngine:function(e){return e?0===e.search(rE+"google.([^/?]*)")?"google":0===e.search(rE+"bing.com")?"bing":0===e.search(rE+"yahoo.com")?"yahoo":0===e.search(rE+"duckduckgo.com")?"duckduckgo":null:null},_searchInfoFromReferrer:function(e){var t=mi._searchEngine(e),n="yahoo"!=t?"q":"p",r={};if(!qu(t)){r.$search_engine=t;var i=He?ZG(He.referrer,n):"";i.length&&(r.ph_keyword=i)}return r},searchInfo:function(){var e=null==He?void 0:He.referrer;return e?this._searchInfoFromReferrer(e):{}},browser:tK,browserVersion:function(e,t){var n=tK(e,t),r=xBe[n];if(et(r))return null;for(var i=0;i<r.length;i++){var o=r[i],s=e.match(o);if(s)return parseFloat(s[s.length-2])}return null},browserLanguage:function(){return navigator.language||navigator.userLanguage},os:function(e){for(var t=0;t<nK.length;t++){var n=cs(nK[t],2),r=n[0],i=n[1],o=r.exec(e),s=o&&(ca(i)?i(o,e):i);if(s)return s}return["",""]},device:rK,deviceType:function(e){var t=rK(e);return t===cce||t===ace||"Kobo"===t||"Kindle Fire"===t||t===Sce?Lb:t===Ob||t===Dg||t===Mb||t===y7?"Console":t===uce?"Wearable":t?pa:"Desktop"},referrer:function(){return(null==He?void 0:He.referrer)||"$direct"},referringDomain:function(){var e;return null!=He&&He.referrer&&(null===(e=Fy(He.referrer))||void 0===e?void 0:e.host)||"$direct"},referrerInfo:function(){return{$referrer:this.referrer(),$referring_domain:this.referringDomain()}},initialPersonInfo:function(){return{r:this.referrer(),u:null==xs?void 0:xs.href}},initialPersonPropsFromInfo:function(e){var t,n=e.r,r=e.u,i={$initial_referrer:n,$initial_referring_domain:null==n?void 0:"$direct"==n?"$direct":null===(t=Fy(n))||void 0===t?void 0:t.host};if(r){i.$initial_current_url=r;var o=Fy(r);i.$initial_host=null==o?void 0:o.host,i.$initial_pathname=null==o?void 0:o.pathname,An(this._campaignParamsFromUrl(r),function(e,t){i["$initial_"+a7(t)]=e})}return n&&An(this._searchInfoFromReferrer(n),function(e,t){i["$initial_"+a7(t)]=e}),i},properties:function(){if(!pi)return{};var e=cs(mi.os(pi),2),t=e[0],n=e[1];return ls(o7({$os:t,$os_version:n,$browser:mi.browser(pi,navigator.vendor),$device:mi.device(pi),$device_type:mi.deviceType(pi)}),{$current_url:null==xs?void 0:xs.href,$host:null==xs?void 0:xs.host,$pathname:null==xs?void 0:xs.pathname,$raw_user_agent:pi.length>1e3?pi.substring(0,997)+"...":pi,$browser_version:mi.browserVersion(pi,navigator.vendor),$browser_language:mi.browserLanguage(),$screen_height:null==se?void 0:se.screen.height,$screen_width:null==se?void 0:se.screen.width,$viewport_height:null==se?void 0:se.innerHeight,$viewport_width:null==se?void 0:se.innerWidth,$lib:"web",$lib_version:ea.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:rce()/1e3})},people_properties:function(){if(!pi)return{};var e=cs(mi.os(pi),2),t=e[0],n=e[1];return ls(o7({$os:t,$os_version:n,$browser:mi.browser(pi,navigator.vendor)}),{$browser_version:mi.browserVersion(pi,navigator.vendor)})}},LBe=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"],vx=function(){function e(t){var n,r;Xt(this,e),this.config=t,this.props={},this.campaign_params_saved=!1,this.name=(r="",(n=t).token&&(r=n.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),n.persistence_name?"ph_"+n.persistence_name:"ph_"+r+"_posthog"),this.storage=this.buildStorage(t),this.load(),t.debug&&Se.info("Persistence loaded",t.persistence,Fe({},this.props)),this.update_config(t,t),this.save()}return Jt(e,[{key:"buildStorage",value:function(e){-1===LBe.indexOf(e.persistence.toLowerCase())&&(Se.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var t=e.persistence.toLowerCase();return"localstorage"===t&&Qr.is_supported()?Qr:"localstorage+cookie"===t&&tE.is_supported()?tE:"sessionstorage"===t&&Mi.is_supported()?Mi:"memory"===t?yBe:"cookie"===t?Su:tE.is_supported()?tE:Su}},{key:"properties",value:function(){var e={};return An(this.props,function(t,n){if(n===lg&&Di(t))for(var r=Object.keys(t),i=0;i<r.length;i++)e["$feature/".concat(r[i])]=t[r[i]];else s=n,a=!1,(qu(o=cBe)?a:DG&&o.indexOf===DG?-1!=o.indexOf(s):(An(o,function(e){if(a||(a=e===s))return zC}),a))||(e[n]=t);var o,s,a}),e}},{key:"load",value:function(){if(!this.disabled){var e=this.storage.parse(this.name);e&&(this.props=ls({},e))}}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,this.props,this.expire_days,this.cross_subdomain,this.secure,this.config.debug)}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"register_once",value:function(e,t,n){var r=this;if(Di(e)){et(t)&&(t="None"),this.expire_days=et(n)?this.default_expiry:n;var i=!1;if(An(e,function(e,n){r.props.hasOwnProperty(n)&&r.props[n]!==t||(r.props[n]=e,i=!0)}),i)return this.save(),!0}return!1}},{key:"register",value:function(e,t){var n=this;if(Di(e)){this.expire_days=et(t)?this.default_expiry:t;var r=!1;if(An(e,function(t,i){e.hasOwnProperty(i)&&n.props[i]!==t&&(n.props[i]=t,r=!0)}),r)return this.save(),!0}return!1}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"update_campaign_params",value:function(){this.campaign_params_saved||(this.register(mi.campaignParams(this.config.custom_campaign_params)),this.campaign_params_saved=!0)}},{key:"update_search_keyword",value:function(){this.register(mi.searchInfo())}},{key:"update_referrer_info",value:function(){this.register_once(mi.referrerInfo(),void 0)}},{key:"set_initial_person_info",value:function(){this.props[p7]||this.props[m7]||this.register_once(pe({},WG,mi.initialPersonInfo()),void 0)}},{key:"get_referrer_info",value:function(){return o7({$referrer:this.props.$referrer,$referring_domain:this.props.$referring_domain})}},{key:"get_initial_props",value:function(){var e=this,t={};An([m7,p7],function(n){var r=e.props[n];r&&An(r,function(e,n){t["$initial_"+a7(n)]=e})});var n=this.props[WG];if(n){var r=mi.initialPersonPropsFromInfo(n);ls(t,r)}return t}},{key:"safe_merge",value:function(e){return An(this.props,function(t,n){n in e||(e[n]=t)}),e}},{key:"update_config",value:function(e,t){if(this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==t.persistence){var n=this.buildStorage(e),r=this.props;this.clear(),this.storage=n,this.props=r,this.save()}}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled?this.remove():this.save()}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"get_cross_subdomain",value:function(){return!!this.cross_subdomain}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=e,this.remove(),this.save())}},{key:"set_event_timer",value:function(e,t){var n=this.props[dy]||{};n[e]=t,this.props[dy]=n,this.save()}},{key:"remove_event_timer",value:function(e){var t=(this.props[dy]||{})[e];return et(t)||(delete this.props[dy][e],this.save()),t}},{key:"get_property",value:function(e){return this.props[e]}},{key:"set_property",value:function(e,t){this.props[e]=t,this.save()}}]),e}();function _7(e){return JSON.stringify(e,(t=[],function(e,n){if(Di(n)){for(;t.length>0&&t.at(-1)!==this;)t.pop();return t.includes(n)?"[Circular]":(t.push(n),n)}return n})).length;var t}var PBe=2,OBe=4;function S7(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6606028.8;if(e.size>=t&&e.data.length>1){var n=Math.floor(e.data.length/2),r=e.data.slice(0,n),i=e.data.slice(n);return[S7({size:_7(r),data:r,sessionId:e.sessionId,windowId:e.windowId}),S7({size:_7(i),data:i,sessionId:e.sessionId,windowId:e.windowId})].flatMap(function(e){return e})}return[e]}var Rw=function(e){return e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e}(Rw||{}),Hl=function(e){return e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e[e.CustomElement=16]="CustomElement",e}(Hl||{});function p8(e){return e?WT(e).split(/\s+/):[]}function iK(e){var t=null==se?void 0:se.location.href;return!!(t&&e&&e.some(function(e){return t.match(e)}))}function e3(e){var t="";switch(Ab(e.className)){case"string":t=e.className;break;case"object":t=(e.className&&"baseVal"in e.className?e.className.baseVal:null)||e.getAttribute("class")||"";break;default:t=""}return p8(t)}function Ece(e){return qs(e)?null:WT(e).split(/(\s+)/).filter(function(e){return Ng(e)}).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function t3(e){var t="";return w7(e)&&!Rce(e)&&e.childNodes&&e.childNodes.length&&An(e.childNodes,function(e){var n;wce(e)&&e.textContent&&(t+=null!==(n=Ece(e.textContent))&&void 0!==n?n:"")}),WT(t)}function m8(e){return!!e&&1===e.nodeType}function of(e,t){return!!e&&!!e.tagName&&e.tagName.toLowerCase()===t.toLowerCase()}function wce(e){return!!e&&3===e.nodeType}function Cce(e){return!!e&&11===e.nodeType}var E7=["a","button","form","input","select","textarea","label"];function Tce(e){var t=e.parentNode;return!(!t||!m8(t))&&t}function MBe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!se||!e||of(e,"html")||!m8(e)||null!=n&&n.url_allowlist&&!iK(n.url_allowlist)||null!=n&&n.url_ignorelist&&iK(n.url_ignorelist))return!1;if(null!=n&&n.dom_event_allowlist){var o=n.dom_event_allowlist;if(o&&!o.some(function(e){return t.type===e}))return!1}for(var s=!1,a=[e],l=!0,c=e;c.parentNode&&!of(c,"body");)if(Cce(c.parentNode))a.push(c.parentNode.host),c=c.parentNode.host;else{if(!(l=Tce(c)))break;if(r||E7.indexOf(l.tagName.toLowerCase())>-1)s=!0;else{var u=se.getComputedStyle(l);u&&"pointer"===u.getPropertyValue("cursor")&&(s=!0)}a.push(l),c=l}if(!function(e,t){var n=null==t?void 0:t.element_allowlist;if(et(n))return!0;var r,i=va(e);try{var o=function(){var e=r.value;if(n.some(function(t){return e.tagName.toLowerCase()===t}))return{v:!0}};for(i.s();!(r=i.n()).done;){var s=o();if("object"===Ab(s))return s.v}}catch(e){i.e(e)}finally{i.f()}return!1}(a,n)||!function(e,t){var n=null==t?void 0:t.css_selector_allowlist;if(et(n))return!0;var r,i=va(e);try{var o=function(){var e=r.value;if(n.some(function(t){return e.matches(t)}))return{v:!0}};for(i.s();!(r=i.n()).done;){var s=o();if("object"===Ab(s))return s.v}}catch(e){i.e(e)}finally{i.f()}return!1}(a,n))return!1;var d=se.getComputedStyle(e);if(d&&"pointer"===d.getPropertyValue("cursor")&&"click"===t.type)return!0;var h=e.tagName.toLowerCase();switch(h){case"html":return!1;case"form":return(i||["submit"]).indexOf(t.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(t.type)>=0;default:return s?(i||["click"]).indexOf(t.type)>=0:(i||["click"]).indexOf(t.type)>=0&&(E7.indexOf(h)>-1||"true"===e.getAttribute("contenteditable"))}}function w7(e){for(var t=e;t.parentNode&&!of(t,"body");t=t.parentNode){var n=e3(t);if(Ut(n,"ph-sensitive")||Ut(n,"ph-no-capture"))return!1}if(Ut(e3(e),"ph-include"))return!0;var r=e.type||"";if(es(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var i=e.name||e.id||"";return!(es(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function Rce(e){return!!(of(e,"input")&&!["button","checkbox","submit","reset"].includes(e.type)||of(e,"select")||of(e,"textarea")||"true"===e.getAttribute("contenteditable"))}var Ice="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",DBe=new RegExp("^(?:".concat(Ice,")$")),NBe=new RegExp(Ice),kce="\\d{3}-?\\d{2}-?\\d{4}",UBe=new RegExp("^(".concat(kce,")$")),jBe=new RegExp("(".concat(kce,")"));function Ng(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!(qs(e)||es(e)&&(e=WT(e),(t?DBe:NBe).test((e||"").replace(/[- ]/g,""))||(t?UBe:jBe).test(e)))}function sK(e){var t=t3(e);return Ng(t="".concat(t," ").concat(xce(e)).trim())?t:""}function xce(e){var t="";return e&&e.childNodes&&e.childNodes.length&&An(e.childNodes,function(e){var n;if(e&&"span"===(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase()))try{var r=t3(e);t="".concat(t," ").concat(r).trim(),e.childNodes&&e.childNodes.length&&(t="".concat(t," ").concat(xce(e)).trim())}catch(e){Se.error(e)}}),t}function FBe(e){return function(e){return e.map(function(e){var t,n,r="";if(e.tag_name&&(r+=e.tag_name),e.attr_class){e.attr_class.sort();var i,o=va(e.attr_class);try{for(o.s();!(i=o.n()).done;){var s=i.value;r+=".".concat(s.replace(/"/g,""))}}catch(e){o.e(e)}finally{o.f()}}var a=Fe(Fe(Fe(Fe({},e.text?{text:e.text}:{}),{},{"nth-child":null!==(t=e.nth_child)&&void 0!==t?t:0,"nth-of-type":null!==(n=e.nth_of_type)&&void 0!==n?n:0},e.href?{href:e.href}:{}),e.attr_id?{attr_id:e.attr_id}:{}),e.attributes),l={};return Tw(a).sort(function(e,t){var n=cs(e,1)[0],r=cs(t,1)[0];return n.localeCompare(r)}).forEach(function(e){var t=cs(e,2),n=t[0],r=t[1];return l[oK(n.toString())]=oK(r.toString())}),(r+=":")+Tw(a).map(function(e){var t=cs(e,2),n=t[0],r=t[1];return"".concat(n,'="').concat(r,'"')}).join("")}).join(";")}(e.map(function(e){var t,n,r={text:null===(t=e.$el_text)||void 0===t?void 0:t.slice(0,400),tag_name:e.tag_name,href:null===(n=e.attr__href)||void 0===n?void 0:n.slice(0,2048),attr_class:$Be(e),attr_id:e.attr__id,nth_child:e.nth_child,nth_of_type:e.nth_of_type,attributes:{}};return Tw(e).filter(function(e){return 0===cs(e,1)[0].indexOf("attr__")}).forEach(function(e){var t=cs(e,2),n=t[0],i=t[1];return r.attributes[n]=i}),r}))}function oK(e){return e.replace(/"|\\"/g,'\\"')}function $Be(e){var t=e.attr__class;return t?ei(t)?t:p8(t):void 0}var C7="[SessionRecording]",T7="redacted",iE={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:function(e){return e},recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io"]},BBe=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],HBe=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],VBe=["/s/","/e/","/i/"];function aK(e,t,n,r){if(qs(e))return e;var i=(null==t?void 0:t["content-length"])||new Blob([e]).size;return es(i)&&(i=parseInt(i)),i>n?C7+" ".concat(r," body too large to record (").concat(i," bytes)"):e}function cK(e,t){if(qs(e))return e;var n=e;return Ng(n,!1)||(n=C7+" "+t+" body "+T7),An(HBe,function(e){var r,i;null!==(r=n)&&void 0!==r&&r.length&&-1!==(null===(i=n)||void 0===i?void 0:i.indexOf(e))&&(n=C7+" "+t+" body "+T7+" as might contain: "+e)}),n}var Yl,qBe=function(e,t){var n,r,i,o={payloadSizeLimitBytes:iE.payloadSizeLimitBytes,performanceEntryTypeToObserve:_u(iE.performanceEntryTypeToObserve),payloadHostDenyList:[].concat(_u(t.payloadHostDenyList||[]),_u(iE.payloadHostDenyList))},s=!1!==e.session_recording.recordHeaders&&t.recordHeaders,a=!1!==e.session_recording.recordBody&&t.recordBody,l=!1!==e.capture_performance&&t.recordPerformance,c=(n=o,i=Math.min(1e6,null!==(r=n.payloadSizeLimitBytes)&&void 0!==r?r:1e6),function(e){return null!=e&&e.requestBody&&(e.requestBody=aK(e.requestBody,e.requestHeaders,i,"Request")),null!=e&&e.responseBody&&(e.responseBody=aK(e.responseBody,e.responseHeaders,i,"Response")),e}),u=function(e){return c(function(e){var t=Fy(e.name);if(!(t&&t.pathname&&VBe.some(function(e){return 0===t.pathname.indexOf(e)})))return e}((n=(t=e).requestHeaders,qs(n)||An(Object.keys(n??{}),function(e){BBe.includes(e.toLowerCase())&&(n[e]=T7)}),t)));var t,n},d=ca(e.session_recording.maskNetworkRequestFn);return d&&ca(e.session_recording.maskCapturedNetworkRequestFn)&&Se.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),d&&(e.session_recording.maskCapturedNetworkRequestFn=function(t){var n=e.session_recording.maskNetworkRequestFn({url:t.name});return Fe(Fe({},t),{},{name:null==n?void 0:n.url})}),o.maskRequestFn=ca(e.session_recording.maskCapturedNetworkRequestFn)?function(t){var n,r,i,o=u(t);return o&&null!==(n=null===(r=(i=e.session_recording).maskCapturedNetworkRequestFn)||void 0===r?void 0:r.call(i,o))&&void 0!==n?n:void 0}:function(e){return function(e){if(!et(e))return e.requestBody=cK(e.requestBody,"Request"),e.responseBody=cK(e.responseBody,"Response"),e}(u(e))},Fe(Fe(Fe({},iE),o),{},{recordHeaders:s,recordBody:a,recordPerformance:l,recordInitialRequests:l})},GBe=Jt(function e(t){var n,r,i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Xt(this,e),pe(this,"bucketSize",100),pe(this,"refillRate",10),pe(this,"mutationBuckets",{}),pe(this,"loggedTracker",{}),pe(this,"refillBuckets",function(){Object.keys(i.mutationBuckets).forEach(function(e){i.mutationBuckets[e]=i.mutationBuckets[e]+i.refillRate,i.mutationBuckets[e]>=i.bucketSize&&delete i.mutationBuckets[e]})}),pe(this,"getNodeOrRelevantParent",function(e){var t=i.rrweb.mirror.getNode(e);if("svg"!==(null==t?void 0:t.nodeName)&&t instanceof Element){var n=t.closest("svg");if(n)return[i.rrweb.mirror.getId(n),n]}return[e,t]}),pe(this,"numberOfChanges",function(e){var t,n,r,i,o,s,a,l;return(null!==(t=null===(n=e.removes)||void 0===n?void 0:n.length)&&void 0!==t?t:0)+(null!==(r=null===(i=e.attributes)||void 0===i?void 0:i.length)&&void 0!==r?r:0)+(null!==(o=null===(s=e.texts)||void 0===s?void 0:s.length)&&void 0!==o?o:0)+(null!==(a=null===(l=e.adds)||void 0===l?void 0:l.length)&&void 0!==a?a:0)}),pe(this,"throttleMutations",function(e){if(3!==e.type||0!==e.data.source)return e;var t=e.data,n=i.numberOfChanges(t);t.attributes&&(t.attributes=t.attributes.filter(function(e){var t,n,r,o=cs(i.getNodeOrRelevantParent(e.id),2),s=o[0],a=o[1];return 0!==i.mutationBuckets[s]&&(i.mutationBuckets[s]=null!==(t=i.mutationBuckets[s])&&void 0!==t?t:i.bucketSize,i.mutationBuckets[s]=Math.max(i.mutationBuckets[s]-1,0),0===i.mutationBuckets[s]&&(i.loggedTracker[s]||(i.loggedTracker[s]=!0,null===(n=(r=i.options).onBlockedNode)||void 0===n||n.call(r,s,a))),e)}));var r=i.numberOfChanges(t);return 0!==r||n===r?e:void 0}),this.rrweb=t,this.options=o,this.refillRate=null!==(n=this.options.refillRate)&&void 0!==n?n:this.refillRate,this.bucketSize=null!==(r=this.options.bucketSize)&&void 0!==r?r:this.bucketSize,setInterval(function(){i.refillBuckets()},1e3)}),KBe=3e5,zBe=[Hl.MouseMove,Hl.MouseInteraction,Hl.Scroll,Hl.ViewportResize,Hl.Input,Hl.TouchMove,Hl.MediaInteraction,Hl.Drag],lK=function(e){return{rrwebMethod:e,enqueuedAt:Date.now(),attempt:1}},zo="[SessionRecording]",WBe=function(){function e(t){var n=this;if(Xt(this,e),pe(this,"queuedRRWebEvents",[]),pe(this,"isIdle",!1),pe(this,"_linkedFlagSeen",!1),pe(this,"_lastActivityTimestamp",Date.now()),pe(this,"_linkedFlag",null),pe(this,"_forceAllowLocalhostNetworkCapture",!1),pe(this,"_onBeforeUnload",function(){n._flushBuffer()}),pe(this,"_onOffline",function(){n._tryAddCustomEvent("browser offline",{})}),pe(this,"_onOnline",function(){n._tryAddCustomEvent("browser online",{})}),pe(this,"_onVisibilityChange",function(){if(null!=He&&He.visibilityState){var e="window "+He.visibilityState;n._tryAddCustomEvent(e,{})}}),pe(this,"_samplingSessionListener",null),this.instance=t,this._captureStarted=!1,this._endpoint="/s/",this.stopRrweb=void 0,this.receivedDecide=!1,!this.instance.sessionManager)throw Se.error(zo+" started without valid sessionManager"),new Error(zo+" started without valid sessionManager. This is a bug.");var r=this.sessionManager.checkAndGetSessionAndWindowId(),i=r.sessionId,o=r.windowId;this.sessionId=i,this.windowId=o,this.buffer=this.clearBuffer(),this._setupSampling()}return Jt(e,[{key:"rrwebRecord",get:function(){var e;return null==Yn||null===(e=Yn.rrweb)||void 0===e?void 0:e.record}},{key:"started",get:function(){return this._captureStarted}},{key:"sessionManager",get:function(){if(!this.instance.sessionManager)throw new Error(zo+" must be started with a valid sessionManager.");return this.instance.sessionManager}},{key:"fullSnapshotIntervalMillis",get:function(){var e;return(null===(e=this.instance.config.session_recording)||void 0===e?void 0:e.full_snapshot_interval_millis)||KBe}},{key:"isSampled",get:function(){var e=this.instance.get_property(jy);return Ph(e)?e:null}},{key:"sessionDuration",get:function(){var e,t,n=null===(e=this.buffer)||void 0===e?void 0:e.data[(null===(t=this.buffer)||void 0===t?void 0:t.data.length)-1],r=this.sessionManager.checkAndGetSessionAndWindowId(!0).sessionStartTimestamp;return n?n.timestamp-r:null}},{key:"isRecordingEnabled",get:function(){var e=!!this.instance.get_property(l7),t=!this.instance.config.disable_session_recording;return se&&e&&t}},{key:"isConsoleLogCaptureEnabled",get:function(){var e=!!this.instance.get_property(VG);return this.instance.config.enable_recording_console_log??e}},{key:"canvasRecording",get:function(){var e=this.instance.get_property(GG);return e&&e.fps&&e.quality?{enabled:e.enabled,fps:e.fps,quality:e.quality}:void 0}},{key:"networkPayloadCapture",get:function(){var e,t,n=this.instance.get_property(qG),r={recordHeaders:null===(e=this.instance.config.session_recording)||void 0===e?void 0:e.recordHeaders,recordBody:null===(t=this.instance.config.session_recording)||void 0===t?void 0:t.recordBody},i=(null==r?void 0:r.recordHeaders)||(null==n?void 0:n.recordHeaders),o=(null==r?void 0:r.recordBody)||(null==n?void 0:n.recordBody),s=Di(this.instance.config.capture_performance)?this.instance.config.capture_performance.network_timing:this.instance.config.capture_performance,a=!!(Ph(s)?s:null!=n&&n.capturePerformance);return i||o||a?{recordHeaders:i,recordBody:o,recordPerformance:a}:void 0}},{key:"sampleRate",get:function(){var e=this.instance.get_property(KG);return ta(e)?e:null}},{key:"minimumDuration",get:function(){var e=this.instance.get_property(zG);return ta(e)?e:null}},{key:"status",get:function(){return this.receivedDecide?this.isRecordingEnabled?qs(this._linkedFlag)||this._linkedFlagSeen?Ph(this.isSampled)?this.isSampled?"sampled":"disabled":"active":"buffering":"disabled":"buffering"}},{key:"startIfEnabledOrStop",value:function(){this.isRecordingEnabled?(this._startCapture(),null==se||se.addEventListener("beforeunload",this._onBeforeUnload),null==se||se.addEventListener("offline",this._onOffline),null==se||se.addEventListener("online",this._onOnline),null==se||se.addEventListener("visibilitychange",this._onVisibilityChange),Se.info(zo+" started")):(this.stopRecording(),this.clearBuffer(),clearInterval(this._fullSnapshotTimer))}},{key:"stopRecording",value:function(){this._captureStarted&&this.stopRrweb&&(this.stopRrweb(),this.stopRrweb=void 0,this._captureStarted=!1,null==se||se.removeEventListener("beforeunload",this._onBeforeUnload),null==se||se.removeEventListener("offline",this._onOffline),null==se||se.removeEventListener("online",this._onOnline),null==se||se.removeEventListener("visibilitychange",this._onVisibilityChange),Se.info(zo+" stopped"))}},{key:"makeSamplingDecision",value:function(e){var t,n=this.sessionId!==e,r=this.sampleRate;if(ta(r)){var i,o=this.isSampled,s=n||!Ph(o);!(i=s?Math.random()<r:o)&&s&&Se.warn(zo+" Sample rate (".concat(r,") has determined that this sessionId (").concat(e,") will not be sent to the server.")),this._tryAddCustomEvent("samplingDecisionMade",{sampleRate:r}),null===(t=this.instance.persistence)||void 0===t||t.register(pe({},jy,i))}else{var a;null===(a=this.instance.persistence)||void 0===a||a.register(pe({},jy,null))}}},{key:"afterDecideResponse",value:function(e){var t,n,r,i=this;if(this._persistDecideResponse(e),this._linkedFlag=(null===(t=e.sessionRecording)||void 0===t?void 0:t.linkedFlag)||null,null!==(n=e.sessionRecording)&&void 0!==n&&n.endpoint&&(this._endpoint=null===(r=e.sessionRecording)||void 0===r?void 0:r.endpoint),this._setupSampling(),!qs(this._linkedFlag)&&!this._linkedFlagSeen){var o=es(this._linkedFlag)?this._linkedFlag:this._linkedFlag.flag,s=es(this._linkedFlag)?null:this._linkedFlag.variant;this.instance.onFeatureFlags(function(e,t){var n=Di(t)&&o in t,r=s?t[o]===s:n;if(r){var a={linkedFlag:o,linkedVariant:s},l="linked flag matched";Se.info(zo+" "+l,a),i._tryAddCustomEvent(l,a)}i._linkedFlagSeen=r})}this.receivedDecide=!0,this.startIfEnabledOrStop()}},{key:"_setupSampling",value:function(){var e=this;ta(this.sampleRate)&&qu(this._samplingSessionListener)&&(this._samplingSessionListener=this.sessionManager.onSessionId(function(t){e.makeSamplingDecision(t)}))}},{key:"_persistDecideResponse",value:function(e){if(this.instance.persistence){var t=this.instance.persistence,n=function(){var n,r,i,o,s,a,l,c,u=null===(n=e.sessionRecording)||void 0===n?void 0:n.sampleRate,d=qs(u)?null:parseFloat(u),h=null===(r=e.sessionRecording)||void 0===r?void 0:r.minimumDurationMilliseconds;t.register((pe(c={},l7,!!e.sessionRecording),pe(c,VG,null===(i=e.sessionRecording)||void 0===i?void 0:i.consoleLogRecordingEnabled),pe(c,qG,Fe({capturePerformance:e.capturePerformance},null===(o=e.sessionRecording)||void 0===o?void 0:o.networkPayloadCapture)),pe(c,GG,{enabled:null===(s=e.sessionRecording)||void 0===s?void 0:s.recordCanvas,fps:null===(a=e.sessionRecording)||void 0===a?void 0:a.canvasFps,quality:null===(l=e.sessionRecording)||void 0===l?void 0:l.canvasQuality}),pe(c,KG,d),pe(c,zG,et(h)?null:h),c))};n(),this.sessionManager.onSessionId(n)}}},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log";null===(t=this.instance.sessionRecording)||void 0===t||t.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:n,trace:[],payload:[JSON.stringify(e)]}},timestamp:rce()})}},{key:"_startCapture",value:function(){var e=this;et(Object.assign)||this._captureStarted||this.instance.config.disable_session_recording||this.instance.consent.isOptedOut()||(this._captureStarted=!0,this.sessionManager.checkAndGetSessionAndWindowId(),this.rrwebRecord?this._onScriptLoaded():this.instance.requestRouter.loadScript("/static/recorder.js?v=".concat(ea.LIB_VERSION),function(t){if(t)return Se.error(zo+" could not load recorder.js",t);e._onScriptLoaded()}))}},{key:"isInteractiveEvent",value:function(e){var t;return 3===e.type&&-1!==zBe.indexOf(null===(t=e.data)||void 0===t?void 0:t.source)}},{key:"_updateWindowAndSessionIds",value:function(e){var t=this.isInteractiveEvent(e);t||this.isIdle||e.timestamp-this._lastActivityTimestamp>3e5&&(this.isIdle=!0,clearInterval(this._fullSnapshotTimer),this._flushBuffer());var n=!1;if(t&&(this._lastActivityTimestamp=e.timestamp,this.isIdle&&(this.isIdle=!1,this._tryAddCustomEvent("sessionNoLongerIdle",{reason:"user activity",type:e.type}),n=!0)),!this.isIdle){var r=this.sessionManager.checkAndGetSessionAndWindowId(!t,e.timestamp),i=r.windowId,o=r.sessionId,s=this.sessionId!==o,a=this.windowId!==i;this.windowId=i,this.sessionId=o,(n||-1===[PBe,OBe].indexOf(e.type)&&(a||s||et(this._fullSnapshotTimer)))&&this._tryTakeFullSnapshot()}}},{key:"_tryRRWebMethod",value:function(e){try{return e.rrwebMethod(),!0}catch(t){return this.queuedRRWebEvents.length<10?this.queuedRRWebEvents.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):Se.warn(zo+" could not emit queued rrweb event.",t,e),!1}}},{key:"_tryAddCustomEvent",value:function(e,t){var n=this;return this._tryRRWebMethod(lK(function(){return n.rrwebRecord.addCustomEvent(e,t)}))}},{key:"_tryTakeFullSnapshot",value:function(){var e=this;return this._tryRRWebMethod(lK(function(){return e.rrwebRecord.takeFullSnapshot()}))}},{key:"_onScriptLoaded",value:function(){for(var e,t=this,n={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},r=this.instance.config.session_recording,i=0,o=Object.entries(r||{});i<o.length;i++){var s=cs(o[i],2),a=s[0],l=s[1];a in n&&("maskInputOptions"===a?n.maskInputOptions=Fe({password:!0},l):n[a]=l)}if(this.canvasRecording&&this.canvasRecording.enabled&&(n.recordCanvas=!0,n.sampling={canvas:this.canvasRecording.fps},n.dataURLOptions={type:"image/webp",quality:this.canvasRecording.quality}),this.rrwebRecord){this.mutationRateLimiter=null!==(e=this.mutationRateLimiter)&&void 0!==e?e:new GBe(this.rrwebRecord,{onBlockedNode:function(e,n){var r="Too many mutations on node '".concat(e,"'. Rate limiting. This could be due to SVG animations or something similar");Se.info(r,{node:n}),t.log(zo+" "+r,"warn")}});var c=this._gatherRRWebPlugins();this.stopRrweb=this.rrwebRecord(Fe({emit:function(e){t.onRRwebEmit(e)},plugins:c},n)),this.instance._addCaptureHook(function(e){try{if("$pageview"===e){var n=se?t._maskUrl(se.location.href):"";if(!n)return;t._tryAddCustomEvent("$pageview",{href:n})}}catch(e){Se.error("Could not add $pageview to rrweb session",e)}}),this._lastActivityTimestamp=Date.now(),this.isIdle=!1,this._tryAddCustomEvent("$session_options",{sessionRecordingOptions:n,activePlugins:c.map(function(e){return null==e?void 0:e.name})}),this._tryAddCustomEvent("$posthog_config",{config:this.instance.config})}else Se.error(zo+"onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}},{key:"_scheduleFullSnapshot",value:function(){var e=this;if(this._fullSnapshotTimer&&clearInterval(this._fullSnapshotTimer),!this.isIdle){var t=this.fullSnapshotIntervalMillis;t&&(this._fullSnapshotTimer=setInterval(function(){e._tryTakeFullSnapshot()},t))}}},{key:"_gatherRRWebPlugins",value:function(){var e=[];return Yn.rrwebConsoleRecord&&this.isConsoleLogCaptureEnabled&&e.push(Yn.rrwebConsoleRecord.getRecordConsolePlugin()),this.networkPayloadCapture&&ca(Yn.getRecordNetworkPlugin)&&(!bBe.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?e.push(Yn.getRecordNetworkPlugin(qBe(this.instance.config,this.networkPayloadCapture))):Se.info(zo+" NetworkCapture not started because we are on localhost.")),e}},{key:"onRRwebEmit",value:function(e){if(this._processQueuedEvents(),e&&Di(e)){if(e.type===Rw.Meta){var t=this._maskUrl(e.data.href);if(this._lastHref=t,!t)return;e.data.href=t}else this._pageViewFallBack();e.type===Rw.FullSnapshot&&this._scheduleFullSnapshot();var n=this.mutationRateLimiter?this.mutationRateLimiter.throttleMutations(e):e;if(n){var r=function(e){var t=e;if(t&&Di(t)&&6===t.type&&Di(t.data)&&"rrweb/console@1"===t.data.plugin){t.data.payload.payload.length>10&&(t.data.payload.payload=t.data.payload.payload.slice(0,10),t.data.payload.payload.push("...[truncated]"));for(var n=[],r=0;r<t.data.payload.payload.length;r++)t.data.payload.payload[r]&&t.data.payload.payload[r].length>2e3?n.push(t.data.payload.payload[r].slice(0,2e3)+"...[truncated]"):n.push(t.data.payload.payload[r]);return t.data.payload.payload=n,e}return e}(n),i=_7(r);if(this._updateWindowAndSessionIds(r),!this.isIdle||r.type===Rw.Custom){var o={$snapshot_bytes:i,$snapshot_data:r,$session_id:this.sessionId,$window_id:this.windowId};"disabled"!==this.status?this._captureSnapshotBuffered(o):this.clearBuffer()}}}}},{key:"_pageViewFallBack",value:function(){if(!this.instance.config.capture_pageview&&se){var e=this._maskUrl(se.location.href);this._lastHref!==e&&(this._tryAddCustomEvent("$url_changed",{href:e}),this._lastHref=e)}}},{key:"_processQueuedEvents",value:function(){var e=this;if(this.queuedRRWebEvents.length){var t=_u(this.queuedRRWebEvents);this.queuedRRWebEvents=[],t.forEach(function(t){Date.now()-t.enqueuedAt<=2e3&&e._tryRRWebMethod(t)})}}},{key:"_maskUrl",value:function(e){var t=this.instance.config.session_recording;if(t.maskNetworkRequestFn){var n,r={url:e};return null===(n=r=t.maskNetworkRequestFn(r))||void 0===n?void 0:n.url}return e}},{key:"clearBuffer",value:function(){return this.buffer={size:0,data:[],sessionId:this.sessionId,windowId:this.windowId},this.buffer}},{key:"_flushBuffer",value:function(){var e=this;this.flushBufferTimer&&(clearTimeout(this.flushBufferTimer),this.flushBufferTimer=void 0);var t=this.minimumDuration,n=this.sessionDuration,r=ta(n)&&n>=0,i=ta(t)&&r&&n<t;return"buffering"===this.status||i?(this.flushBufferTimer=setTimeout(function(){e._flushBuffer()},2e3),this.buffer):(this.buffer.data.length>0&&S7(this.buffer).forEach(function(t){e._captureSnapshot({$snapshot_bytes:t.size,$snapshot_data:t.data,$session_id:t.sessionId,$window_id:t.windowId})}),this.clearBuffer())}},{key:"_captureSnapshotBuffered",value:function(e){var t,n=this,r=2+((null===(t=this.buffer)||void 0===t?void 0:t.data.length)||0);!this.isIdle&&(this.buffer.size+e.$snapshot_bytes+r>943718.4||this.buffer.sessionId!==this.sessionId)&&(this.buffer=this._flushBuffer()),this.buffer.size+=e.$snapshot_bytes,this.buffer.data.push(e.$snapshot_data),this.flushBufferTimer||this.isIdle||(this.flushBufferTimer=setTimeout(function(){n._flushBuffer()},2e3))}},{key:"_captureSnapshot",value:function(e){this.instance.capture("$snapshot",e,{_url:this.instance.requestRouter.endpointFor("api",this._endpoint),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}},{key:"overrideLinkedFlag",value:function(){this._linkedFlagSeen=!0}}]),e}(),YBe=function(){function e(t){Xt(this,e),this.instance=t,this.instance.decideEndpointWasHit=this.instance._hasBootstrappedFeatureFlags()}return Jt(e,[{key:"call",value:function(){var e=this,t={token:this.instance.config.token,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),person_properties:this.instance.get_property(ug),group_properties:this.instance.get_property(Nd),disable_flags:this.instance.config.advanced_disable_feature_flags||this.instance.config.advanced_disable_feature_flags_on_first_load||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:t,compression:this.instance.config.disable_compression?void 0:Ya.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(t){return e.parseDecideResponse(t.json)}})}},{key:"parseDecideResponse",value:function(e){var t=this;this.instance.featureFlags.setReloadingPaused(!1),this.instance.featureFlags._startReloadTimer();var n=!e;if(this.instance.config.advanced_disable_feature_flags_on_first_load||this.instance.config.advanced_disable_feature_flags||this.instance.featureFlags.receivedFeatureFlags(e??{},n),n)Se.error("Failed to fetch feature flags from PostHog.");else{if(!He||!He.body)return Se.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(function(){t.parseDecideResponse(e)},500);if(this.instance._afterDecideResponse(e),e.siteApps)if(this.instance.config.opt_in_site_apps){var r,i=va(e.siteApps);try{var o=function(){var e=r.value,n=e.id,i=e.url,o=t.instance.requestRouter.endpointFor("api",i);Yn["__$$ph_site_app_".concat(n)]=t.instance,t.instance.requestRouter.loadScript(o,function(e){if(e)return Se.error("Error while initializing PostHog app with config id ".concat(n),e)})};for(i.s();!(r=i.n()).done;)o()}catch(e){i.e(e)}finally{i.f()}}else e.siteApps.length>0&&Se.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}}]),e}(),XBe=null!=se&&se.location?QC(se.location.hash,"__posthog")||QC(location.hash,"state"):null,uK="_postHogToolbarParams";!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(Yl||(Yl={}));var JBe=function(){function e(t){Xt(this,e),this.instance=t}return Jt(e,[{key:"setToolbarState",value:function(e){Yn.ph_toolbar_state=e}},{key:"getToolbarState",value:function(){var e;return null!==(e=Yn.ph_toolbar_state)&&void 0!==e?e:Yl.UNINITIALIZED}},{key:"maybeLoadToolbar",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!se||!He)return!1;n=null!==(e=n)&&void 0!==e?e:se.location,i=null!==(t=i)&&void 0!==t?t:se.history;try{if(!r){try{se.localStorage.setItem("test","test"),se.localStorage.removeItem("test")}catch{return!1}r=null==se?void 0:se.localStorage}var o,s=XBe||QC(n.hash,"__posthog")||QC(n.hash,"state"),a=s?jG(function(){return JSON.parse(atob(decodeURIComponent(s)))})||jG(function(){return JSON.parse(decodeURIComponent(s))}):null;return a&&"ph_authorize"===a.action?((o=a).source="url",o&&Object.keys(o).length>0&&(a.desiredHash?n.hash=a.desiredHash:i?i.replaceState(i.state,"",n.pathname+n.search):n.hash="")):((o=JSON.parse(r.getItem(uK)||"{}")).source="localstorage",delete o.userIntent),!(!o.token||this.instance.config.token!==o.token||(this.loadToolbar(o),0))}catch{return!1}}},{key:"_callLoadToolbar",value:function(e){(Yn.ph_load_toolbar||Yn.ph_load_editor)(e,this.instance)}},{key:"loadToolbar",value:function(e){var t=this,n=!(null==He||!He.getElementById(g7));if(!se||n)return!1;var r="custom"===this.instance.requestRouter.region&&this.instance.config.advanced_disable_toolbar_metrics,i=Fe(Fe({token:this.instance.config.token},e),{},{apiURL:this.instance.requestRouter.endpointFor("ui")},r?{instrument:!1}:{});if(se.localStorage.setItem(uK,JSON.stringify(Fe(Fe({},i),{},{source:void 0}))),this.getToolbarState()===Yl.LOADED)this._callLoadToolbar(i);else if(this.getToolbarState()===Yl.UNINITIALIZED){this.setToolbarState(Yl.LOADING);var o=3e5,s=Math.floor(Date.now()/o)*o;this.instance.requestRouter.loadScript("/static/toolbar.js?t=".concat(s),function(e){if(e)return Se.error("Failed to load toolbar",e),void t.setToolbarState(Yl.UNINITIALIZED);t.setToolbarState(Yl.LOADED),t._callLoadToolbar(i)}),cu(se,"turbolinks:load",function(){t.setToolbarState(Yl.UNINITIALIZED),t.loadToolbar(i)})}return!0}},{key:"_loadEditor",value:function(e){return this.loadToolbar(e)}},{key:"maybeLoadEditor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return this.maybeLoadToolbar(e,t,n)}}]),e}(),QBe=function(){function e(t){Xt(this,e),pe(this,"isPaused",!0),pe(this,"queue",[]),pe(this,"flushTimeoutMs",3e3),this.sendRequest=t}return Jt(e,[{key:"enqueue",value:function(e){this.queue.push(e),this.flushTimeout||this.setFlushTimeout()}},{key:"unload",value:function(){var e=this;this.clearFlushTimeout();var t=this.queue.length>0?this.formatQueue():{},n=Object.values(t);[].concat(_u(n.filter(function(e){return 0===e.url.indexOf("/e")})),_u(n.filter(function(e){return 0!==e.url.indexOf("/e")}))).map(function(t){e.sendRequest(Fe(Fe({},t),{},{transport:"sendBeacon"}))})}},{key:"enable",value:function(){this.isPaused=!1,this.setFlushTimeout()}},{key:"setFlushTimeout",value:function(){var e=this;this.isPaused||(this.flushTimeout=setTimeout(function(){if(e.clearFlushTimeout(),e.queue.length>0){var t=e.formatQueue(),n=function(n){var r=t[n],i=(new Date).getTime();r.data&&ei(r.data)&&An(r.data,function(e){e.offset=Math.abs(e.timestamp-i),delete e.timestamp}),e.sendRequest(r)};for(var r in t)n(r)}},this.flushTimeoutMs))}},{key:"clearFlushTimeout",value:function(){clearTimeout(this.flushTimeout),this.flushTimeout=void 0}},{key:"formatQueue",value:function(){var e={};return An(this.queue,function(t){var n,r=t,i=(r?r.batchKey:null)||r.url;et(e[i])&&(e[i]=Fe(Fe({},r),{},{data:[]})),null===(n=e[i].data)||void 0===n||n.push(r.data)}),this.queue=[],e}}]),e}(),ma=Uint8Array,Fs=Uint16Array,gv=Uint32Array,g8=new ma([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),v8=new ma([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dK=new ma([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ace=function(e,t){for(var n=new Fs(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new gv(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return[n,i]},Lce=Ace(g8,2),ZBe=Lce[0],R7=Lce[1];ZBe[28]=258,R7[258]=28;for(var fK=Ace(v8,0)[1],Pce=new Fs(32768),Hn=0;Hn<32768;++Hn){var ph=(43690&Hn)>>>1|(21845&Hn)<<1;ph=(61680&(ph=(52428&ph)>>>2|(13107&ph)<<2))>>>4|(3855&ph)<<4,Pce[Hn]=((65280&ph)>>>8|(255&ph)<<8)>>>1}var $y=function(e,t,n){for(var r=e.length,i=0,o=new Fs(t);i<r;++i)++o[e[i]-1];var s,a=new Fs(t);for(i=0;i<t;++i)a[i]=a[i-1]+o[i-1]<<1;for(s=new Fs(r),i=0;i<r;++i)s[i]=Pce[a[e[i]-1]++]>>>15-e[i];return s},up=new ma(288);for(Hn=0;Hn<144;++Hn)up[Hn]=8;for(Hn=144;Hn<256;++Hn)up[Hn]=9;for(Hn=256;Hn<280;++Hn)up[Hn]=7;for(Hn=280;Hn<288;++Hn)up[Hn]=8;var n3=new ma(32);for(Hn=0;Hn<32;++Hn)n3[Hn]=5;var eHe=$y(up,9),tHe=$y(n3,5),Oce=function(e){return(e/8|0)+(7&e&&1)},Mce=function(e,t,n){(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Fs?Fs:e instanceof gv?gv:ma)(n-t);return r.set(e.subarray(t,n)),r},Ul=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},j0=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},yx=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,o=n.slice();if(!i)return[new ma(0),0];if(1==i){var s=new ma(n[0].s+1);return s[n[0].s]=1,[s,1]}n.sort(function(e,t){return e.f-t.f}),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,d=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=i-1;)a=n[n[c].f<n[d].f?c++:d++],l=n[c!=u&&n[c].f<n[d].f?c++:d++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var h=o[0].s;for(r=1;r<i;++r)o[r].s>h&&(h=o[r].s);var p=new Fs(h+1),f=nHe(n[u-1],p,0);if(f>t){r=0;var m=0,v=f-t,g=1<<v;for(o.sort(function(e,t){return p[t.s]-p[e.s]||e.f-t.f});r<i;++r){var y=o[r].s;if(!(p[y]>t))break;m+=g-(1<<f-p[y]),p[y]=t}for(m>>>=v;m>0;){var b=o[r].s;p[b]<t?m-=1<<t-p[b]++-1:++r}for(;r>=0&&m;--r){var w=o[r].s;p[w]==t&&(--p[w],++m)}f=t}return[new ma(p),f]},nHe=function e(t,n,r){return-1==t.s?Math.max(e(t.l,n,r+1),e(t.r,n,r+1)):n[t.s]=r},hK=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Fs(++t),r=0,i=e[0],o=1,s=function(e){n[r++]=e},a=1;a<=t;++a)if(e[a]==i&&a!=t)++o;else{if(!i&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(i),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(i);o=1,i=e[a]}return[n.subarray(0,r),t]},F0=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},I7=function(e,t,n){var r=n.length,i=Oce(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var o=0;o<r;++o)e[i+o+4]=n[o];return 8*(i+4+r)},pK=function(e,t,n,r,i,o,s,a,l,c,u){Ul(t,u++,n),++i[256];for(var d=yx(i,15),h=d[0],p=d[1],f=yx(o,15),m=f[0],v=f[1],g=hK(h),y=g[0],b=g[1],w=hK(m),_=w[0],S=w[1],E=new Fs(19),C=0;C<y.length;++C)E[31&y[C]]++;for(C=0;C<_.length;++C)E[31&_[C]]++;for(var k=yx(E,7),T=k[0],R=k[1],I=19;I>4&&!T[dK[I-1]];--I);var x,P,L,M,O=c+5<<3,A=F0(i,up)+F0(o,n3)+s,D=F0(i,h)+F0(o,m)+s+14+3*I+F0(E,T)+(2*E[16]+3*E[17]+7*E[18]);if(O<=A&&O<=D)return I7(t,u,e.subarray(l,l+c));if(Ul(t,u,1+(D<A)),u+=2,D<A){x=$y(h,p),P=h,L=$y(m,v),M=m;var N=$y(T,R);for(Ul(t,u,b-257),Ul(t,u+5,S-1),Ul(t,u+10,I-4),u+=14,C=0;C<I;++C)Ul(t,u+3*C,T[dK[C]]);u+=3*I;for(var j=[y,_],F=0;F<2;++F){var U=j[F];for(C=0;C<U.length;++C){var B=31&U[C];Ul(t,u,N[B]),u+=T[B],B>15&&(Ul(t,u,U[C]>>>5&127),u+=U[C]>>>12)}}}else x=eHe,P=up,L=tHe,M=n3;for(C=0;C<a;++C)if(r[C]>255){B=r[C]>>>18&31,j0(t,u,x[B+257]),u+=P[B+257],B>7&&(Ul(t,u,r[C]>>>23&31),u+=g8[B]);var H=31&r[C];j0(t,u,L[H]),u+=M[H],H>3&&(j0(t,u,r[C]>>>5&8191),u+=v8[H])}else j0(t,u,x[r[C]]),u+=P[r[C]];return j0(t,u,x[256]),u+P[256]},rHe=new gv([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),iHe=function(){for(var e=new gv(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),sHe=function(e,t,n,r,i){return function(e,t,n,r,i,o){var s=e.length,a=new ma(r+s+5*(1+Math.floor(s/7e3))+i),l=a.subarray(r,a.length-i),c=0;if(!t||s<8)for(var u=0;u<=s;u+=65535){var d=u+65535;d<s?c=I7(l,c,e.subarray(u,d)):(l[u]=o,c=I7(l,c,e.subarray(u,s)))}else{for(var h=rHe[t-1],p=h>>>13,f=8191&h,m=(1<<n)-1,v=new Fs(32768),g=new Fs(m+1),y=Math.ceil(n/3),b=2*y,w=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<b)&m},_=new gv(25e3),S=new Fs(288),E=new Fs(32),C=0,k=0,T=(u=0,0),R=0,I=0;u<s;++u){var x=w(u),P=32767&u,L=g[x];if(v[P]=L,g[x]=P,R<=u){var M=s-u;if((C>7e3||T>24576)&&M>423){c=pK(e,l,0,_,S,E,k,T,I,u-I,c),T=C=k=0,I=u;for(var O=0;O<286;++O)S[O]=0;for(O=0;O<30;++O)E[O]=0}var A=2,D=0,N=f,j=P-L&32767;if(M>2&&x==w(u-j))for(var F=Math.min(p,M)-1,U=Math.min(32767,u),B=Math.min(258,M);j<=U&&--N&&P!=L;){if(e[u+A]==e[u+A-j]){for(var H=0;H<B&&e[u+H]==e[u+H-j];++H);if(H>A){if(A=H,D=j,H>F)break;var $=Math.min(j,H-2),V=0;for(O=0;O<$;++O){var q=u-j+O+32768&32767,G=q-v[q]+32768&32767;G>V&&(V=G,L=q)}}}j+=(P=L)-(L=v[P])+32768&32767}if(D){_[T++]=268435456|R7[A]<<18|fK[D];var z=31&R7[A],K=31&fK[D];k+=g8[z]+v8[K],++S[257+z],++E[K],R=u+A,++C}else _[T++]=e[u],++S[e[u]]}}c=pK(e,l,o,_,S,E,k,T,I,u-I,c)}return Mce(a,0,r+Oce(c)+i)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!0)},bx=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8};function oHe(e,t){void 0===t&&(t={});var n,r=(n=4294967295,{p:function(e){for(var t=n,r=0;r<e.length;++r)t=iHe[255&t^e[r]]^t>>>8;n=t},d:function(){return 4294967295^n}}),i=e.length;r.p(e);var o,s=sHe(e,t,10+((o=t).filename&&o.filename.length+1||0),8),a=s.length;return function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&bx(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}}(s,t),bx(s,a-8,r.d()),bx(s,a-4,i),s}var aHe=!!s7||!!i7,mK="text/plain",r3=function(e,t){var n=cs(e.split("?"),2),r=n[0],i=n[1],o=Fe({},t);null==i||i.split("&").forEach(function(e){var t=cs(e.split("="),1)[0];delete o[t]});var s=_Be(o);return s=s?(i?i+"&":"")+s:i,"".concat(r,"?").concat(s)},cHe=function(e){return"data="+encodeURIComponent("string"==typeof e?e:JSON.stringify(e))},_x=function(e){var t=e.data,n=e.compression;if(t){if(n===Ya.GZipJS){var r=oHe(function(e){var t=e.length;if(typeof TextEncoder<"u")return(new TextEncoder).encode(e);for(var n=new ma(e.length+(e.length>>>1)),r=0,i=function(e){n[r++]=e},o=0;o<t;++o){if(r+5>n.length){var s=new ma(r+8+(t-o<<1));s.set(n),n=s}var a=e.charCodeAt(o);a<128?i(a):a<2048?(i(192|a>>>6),i(128|63&a)):a>55295&&a<57344?(i(240|(a=65536+(1047552&a)|1023&e.charCodeAt(++o))>>>18),i(128|a>>>12&63),i(128|a>>>6&63),i(128|63&a)):(i(224|a>>>12),i(128|a>>>6&63),i(128|63&a))}return Mce(n,0,r)}(JSON.stringify(t)),{mtime:0});return{contentType:mK,body:new Blob([r],{type:mK})}}if(n===Ya.Base64){var i=function(e){var t,n,r,i,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,l=0,c="",u=[];if(!e)return e;e=aBe(e);do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=o>>12&63,r=o>>6&63,i=63&o,u[l++]=s.charAt(t)+s.charAt(n)+s.charAt(r)+s.charAt(i)}while(a<e.length);switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}(JSON.stringify(t));return{contentType:"application/x-www-form-urlencoded",body:cHe(i)}}return{contentType:"application/json",body:JSON.stringify(t)}}},By=[];s7&&By.push({transport:"XHR",method:function(e){var t,n=new s7;n.open(e.method||"GET",e.url,!0);var r=null!==(t=_x(e))&&void 0!==t?t:{},i=r.contentType,o=r.body;An(e.headers,function(e,t){n.setRequestHeader(t,e)}),i&&n.setRequestHeader("Content-Type",i),e.timeout&&(n.timeout=e.timeout),n.withCredentials=!0,n.onreadystatechange=function(){if(4===n.readyState){var t,r={statusCode:n.status,text:n.responseText};if(200===n.status)try{r.json=JSON.parse(n.responseText)}catch{}null===(t=e.callback)||void 0===t||t.call(e,r)}},n.send(o)}}),i7&&By.push({transport:"fetch",method:function(e){var t,n,r=null!==(t=_x(e))&&void 0!==t?t:{},i=r.contentType,o=r.body,s=new Headers;An(e.headers,function(e,t){s.append(t,e)}),i&&s.append("Content-Type",i);var a=e.url,l=null;if(NG){var c=new NG;l={signal:c.signal,timeout:setTimeout(function(){return c.abort()},e.timeout)}}i7(a,{method:(null==e?void 0:e.method)||"GET",headers:s,keepalive:"POST"===e.method,body:o,signal:null===(n=l)||void 0===n?void 0:n.signal}).then(function(t){return t.text().then(function(n){var r,i={statusCode:t.status,text:n};if(200===t.status)try{i.json=JSON.parse(n)}catch(e){Se.error(e)}null===(r=e.callback)||void 0===r||r.call(e,i)})}).catch(function(t){var n;Se.error(t),null===(n=e.callback)||void 0===n||n.call(e,{statusCode:0,text:t})}).finally(function(){return l?clearTimeout(l.timeout):null})}}),null!=Ja&&Ja.sendBeacon&&By.push({transport:"sendBeacon",method:function(e){var t=r3(e.url,{beacon:"1"});try{var n,r=null!==(n=_x(e))&&void 0!==n?n:{},i=r.contentType,o=r.body,s="string"==typeof o?new Blob([o],{type:i}):o;Ja.sendBeacon(t,s)}catch{}}});var Oh,lHe=["retriesPerformedSoFar"],uHe=function(){function e(t){var n=this;Xt(this,e),pe(this,"isPolling",!1),pe(this,"pollIntervalMs",3e3),pe(this,"queue",[]),this.instance=t,this.queue=[],this.areWeOnline=!0,!et(se)&&"onLine"in se.navigator&&(this.areWeOnline=se.navigator.onLine,se.addEventListener("online",function(){n.areWeOnline=!0,n.flush()}),se.addEventListener("offline",function(){n.areWeOnline=!1}))}return Jt(e,[{key:"retriableRequest",value:function(e){var t=this,n=e.retriesPerformedSoFar,r=nBe(e,lHe);ta(n)&&n>0&&(r.url=r3(r.url,{retry_count:n})),this.instance._send_request(Fe(Fe({},r),{},{callback:function(e){var i;200!==e.statusCode&&(e.statusCode<400||e.statusCode>=500)&&(n??0)<10?t.enqueue(Fe({retriesPerformedSoFar:n},r)):null===(i=r.callback)||void 0===i||i.call(r,e)}}))}},{key:"enqueue",value:function(e){var t=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=t+1;var n,r,i,o,s,a=(n=t,r=3e3*Math.pow(2,n),i=r/2,o=Math.min(18e5,r),s=(Math.random()-.5)*(o-i),Math.ceil(o+s)),l=Date.now()+a;this.queue.push({retryAt:l,requestOptions:e});var c="Enqueued failed request for retry in ".concat(a);navigator.onLine||(c+=" (Browser is offline)"),Se.warn(c),this.isPolling||(this.isPolling=!0,this.poll())}},{key:"poll",value:function(){var e=this;this.poller&&clearTimeout(this.poller),this.poller=setTimeout(function(){e.areWeOnline&&e.queue.length>0&&e.flush(),e.poll()},this.pollIntervalMs)}},{key:"flush",value:function(){var e=Date.now(),t=[],n=this.queue.filter(function(n){return n.retryAt<e||(t.push(n),!1)});if(this.queue=t,n.length>0){var r,i=va(n);try{for(i.s();!(r=i.n()).done;){var o=r.value.requestOptions;this.retriableRequest(o)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"unload",value:function(){this.poller&&(clearTimeout(this.poller),this.poller=void 0);var e,t=va(this.queue);try{for(t.s();!(e=t.n()).done;){var n=e.value.requestOptions;try{this.instance._send_request(Fe(Fe({},n),{},{transport:"sendBeacon"}))}catch(e){Se.error(e)}}}catch(e){t.e(e)}finally{t.f()}this.queue=[]}}]),e}(),sE=1800,dHe=function(){function e(t,n,r,i){var o;Xt(this,e),pe(this,"_sessionIdChangedHandlers",[]),this.config=t,this.persistence=n,this._windowId=void 0,this._sessionId=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this._sessionIdGenerator=r||Wd,this._windowIdGenerator=i||Wd;var s=t.persistence_name||t.token,a=t.session_idle_timeout_seconds||sE;if(ta(a)?a>sE?Se.warn("session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead."):a<60&&Se.warn("session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead."):(Se.warn("session_idle_timeout_seconds must be a number. Defaulting to 30 minutes."),a=sE),this._sessionTimeoutMs=1e3*Math.min(Math.max(a,60),sE),this._window_id_storage_key="ph_"+s+"_window_id",this._primary_window_exists_storage_key="ph_"+s+"_primary_window_exists",this._canUseSessionStorage()){var l=Mi.parse(this._window_id_storage_key),c=Mi.parse(this._primary_window_exists_storage_key);l&&!c?this._windowId=l:Mi.remove(this._window_id_storage_key),Mi.set(this._primary_window_exists_storage_key,!0)}if(null!==(o=this.config.bootstrap)&&void 0!==o&&o.sessionID)try{var u=function(e){var t=e.replace(/-/g,"");if(32!==t.length)throw new Error("Not a valid UUID");if("7"!==t[12])throw new Error("Not a UUIDv7");return parseInt(t.substring(0,12),16)}(this.config.bootstrap.sessionID);this._setSessionId(this.config.bootstrap.sessionID,(new Date).getTime(),u)}catch(e){Se.error("Invalid sessionID in bootstrap",e)}this._listenToReloadWindow()}return Jt(e,[{key:"onSessionId",value:function(e){var t=this;return et(this._sessionIdChangedHandlers)&&(this._sessionIdChangedHandlers=[]),this._sessionIdChangedHandlers.push(e),this._sessionId&&e(this._sessionId,this._windowId),function(){t._sessionIdChangedHandlers=t._sessionIdChangedHandlers.filter(function(t){return t!==e})}}},{key:"_canUseSessionStorage",value:function(){return"memory"!==this.config.persistence&&!this.persistence.disabled&&Mi.is_supported()}},{key:"_setWindowId",value:function(e){e!==this._windowId&&(this._windowId=e,this._canUseSessionStorage()&&Mi.set(this._window_id_storage_key,e))}},{key:"_getWindowId",value:function(){return this._windowId?this._windowId:this._canUseSessionStorage()?Mi.parse(this._window_id_storage_key):null}},{key:"_setSessionId",value:function(e,t,n){e===this._sessionId&&t===this._sessionActivityTimestamp&&n===this._sessionStartTimestamp||(this._sessionStartTimestamp=n,this._sessionActivityTimestamp=t,this._sessionId=e,this.persistence.register(pe({},WC,[t,e,n])))}},{key:"_getSessionId",value:function(){if(this._sessionId&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this._sessionId,this._sessionStartTimestamp];var e=this.persistence.props[WC];return ei(e)&&2===e.length&&e.push(e[0]),e||[0,null,0]}},{key:"resetSessionId",value:function(){this._setSessionId(null,null,null)}},{key:"_listenToReloadWindow",value:function(){var e=this;null==se||se.addEventListener("beforeunload",function(){e._canUseSessionStorage()&&Mi.remove(e._primary_window_exists_storage_key)})}},{key:"checkAndGetSessionAndWindowId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(new Date).getTime(),n=cs(this._getSessionId(),3),r=n[0],i=n[1],o=n[2],s=this._getWindowId(),a=o&&o>0&&Math.abs(t-o)>864e5,l=!1,c=!i,u=!e&&Math.abs(t-r)>this._sessionTimeoutMs;c||u||a?(i=this._sessionIdGenerator(),s=this._windowIdGenerator(),Se.info("[SessionId] new session ID generated",{sessionId:i,windowId:s,changeReason:{noSessionId:c,activityTimeout:u,sessionPastMaximumLength:a}}),o=t,l=!0):s||(s=this._windowIdGenerator(),l=!0);var d=0===r||!e||a?t:r,h=0===o?(new Date).getTime():o;return this._setWindowId(s),this._setSessionId(i,d,h),l&&this._sessionIdChangedHandlers.forEach(function(e){return e(i,s)}),{sessionId:i,windowId:s,sessionStartTimestamp:h}}}]),e}();!function(e){e.US="us",e.EU="eu",e.CUSTOM="custom"}(Oh||(Oh={}));var gK="i.posthog.com",fHe=function(){function e(t){Xt(this,e),pe(this,"_regionCache",{}),this.instance=t}return Jt(e,[{key:"apiHost",get:function(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return"https://app.posthog.com"===e?"https://us.i.posthog.com":e}},{key:"uiHost",get:function(){var e,t=null===(e=this.instance.config.ui_host)||void 0===e?void 0:e.replace(/\/$/,"");return t||(t=this.apiHost.replace(".".concat(gK),".posthog.com")),"https://app.posthog.com"===t?"https://us.posthog.com":t}},{key:"region",get:function(){return this._regionCache[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=Oh.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=Oh.EU:this._regionCache[this.apiHost]=Oh.CUSTOM),this._regionCache[this.apiHost]}},{key:"endpointFor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t&&(t="/"===t[0]?t:"/".concat(t)),"ui"===e)return this.uiHost+t;if(this.region===Oh.CUSTOM)return this.apiHost+t;var n=gK+t;switch(e){case"assets":return"https://".concat(this.region,"-assets.").concat(n);case"api":return"https://".concat(this.region,".").concat(n)}}},{key:"loadScript",value:function(e,t){if(this.instance.config.disable_external_dependency_loading)return Se.warn("".concat(e," was requested but loading of external scripts is disabled.")),t("Loading of external scripts is disabled");var n="/"===e[0]?this.endpointFor("assets",e):e,r=function(){if(!He)return t("document not found");var e=He.createElement("script");e.type="text/javascript",e.src=n,e.onload=function(e){return t(void 0,e)},e.onerror=function(e){return t(e)};var r,i=He.querySelectorAll("body > script");i.length>0?null===(r=i[0].parentNode)||void 0===r||r.insertBefore(e,i[0]):He.body.appendChild(e)};null!=He&&He.body?r():null==He||He.addEventListener("DOMContentLoaded",r)}}]),e}(),Dce="posthog-js";function Nce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.organization,r=t.projectId,i=t.prefix,o=t.severityAllowList,s=void 0===o?["error"]:o;return function(t){var o,a,l,c,u;if("*"!==s&&!s.includes(t.level)||!e.__loaded)return t;t.tags||(t.tags={});var d=e.requestRouter.endpointFor("ui","/project/".concat(e.config.token,"/person/").concat(e.get_distinct_id()));t.tags["PostHog Person URL"]=d,e.sessionRecordingStarted()&&(t.tags["PostHog Recording URL"]=e.get_session_replay_url({withTimestamp:!0}));var h=(null===(o=t.exception)||void 0===o?void 0:o.values)||[],p={$exception_message:(null===(a=h[0])||void 0===a?void 0:a.value)||t.message,$exception_type:null===(l=h[0])||void 0===l?void 0:l.type,$exception_personURL:d,$exception_level:t.level,$sentry_event_id:t.event_id,$sentry_exception:t.exception,$sentry_exception_message:(null===(c=h[0])||void 0===c?void 0:c.value)||t.message,$sentry_exception_type:null===(u=h[0])||void 0===u?void 0:u.type,$sentry_tags:t.tags,$level:t.level};return n&&r&&(p.$sentry_url=(i||"https://sentry.io/organizations/")+n+"/issues/?project="+r+"&query="+t.event_id),e.exceptions.sendExceptionEvent(p),t}}var hHe=Jt(function e(t,n,r,i,o){Xt(this,e),this.name=Dce,this.setupOnce=function(e){e(Nce(t,{organization:n,projectId:r,prefix:i,severityAllowList:o}))}});function pHe(e,t){var n=e.config.segment;if(!n)return t();!function(e,t){var n=e.config.segment;if(!n)return t();var r=function(n){var r=function(){return n.anonymousId()||Wd()};e.config.get_device_id=r,n.id()&&(e.register({distinct_id:n.id(),$device_id:r()}),e.persistence.set_property(Wl,"identified")),t()},i=n.user();"then"in i&&ca(i.then)?i.then(function(e){return r(e)}):r(i)}(e,function(){n.register(function(e){Promise&&Promise.resolve||Se.warn("This browser does not have Promise support, and can not use the segment integration");var t=function(t,n){var r;if(!n)return t;t.event.userId||t.event.anonymousId===e.get_distinct_id()||(Se.info("Segment integration does not have a userId set, resetting PostHog"),e.reset()),t.event.userId&&t.event.userId!==e.get_distinct_id()&&(Se.info("Segment integration has a userId set, identifying with PostHog"),e.identify(t.event.userId));var i=e._calculate_event_properties(n,null!==(r=t.event.properties)&&void 0!==r?r:{},new Date);return t.event.properties=Object.assign({},i,t.event.properties),t};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:function(e){return t(e,e.event.event)},page:function(e){return t(e,"$pageview")},identify:function(e){return t(e,"$identify")},screen:function(e){return t(e,"$screen")}}}(e)).then(function(){t()})})}var vK,i3,Na,mHe=function(){function e(t){Xt(this,e),this._instance=t}return Jt(e,[{key:"doPageView",value:function(e){var t,n=this._previousPageViewProperties(e);return this._currentPath=null!==(t=null==se?void 0:se.location.pathname)&&void 0!==t?t:"",this._instance.scrollManager.resetContext(),this._prevPageviewTimestamp=e,n}},{key:"doPageLeave",value:function(e){return this._previousPageViewProperties(e)}},{key:"_previousPageViewProperties",value:function(e){var t=this._currentPath,n=this._prevPageviewTimestamp,r=this._instance.scrollManager.getContext();if(!n)return{};var i={};if(r){var o=r.maxScrollHeight,s=r.lastScrollY,a=r.maxScrollY,l=r.maxContentHeight,c=r.lastContentY,u=r.maxContentY;et(o)||et(s)||et(a)||et(l)||et(c)||et(u)||(o=Math.ceil(o),s=Math.ceil(s),a=Math.ceil(a),l=Math.ceil(l),c=Math.ceil(c),u=Math.ceil(u),i={$prev_pageview_last_scroll:s,$prev_pageview_last_scroll_percentage:o<=1?1:oE(s/o,0,1),$prev_pageview_max_scroll:a,$prev_pageview_max_scroll_percentage:o<=1?1:oE(a/o,0,1),$prev_pageview_last_content:c,$prev_pageview_last_content_percentage:l<=1?1:oE(c/l,0,1),$prev_pageview_max_content:u,$prev_pageview_max_content_percentage:l<=1?1:oE(u/l,0,1)})}return t&&(i.$prev_pageview_pathname=t),n&&(i.$prev_pageview_duration=(e.getTime()-n.getTime())/1e3),i}}]),e}();function oE(e,t,n){return Math.max(t,Math.min(e,n))}(function(e){e.Popover="popover",e.API="api",e.Widget="widget"})(vK||(vK={})),function(e){e.Open="open",e.MultipleChoice="multiple_choice",e.SingleChoice="single_choice",e.Rating="rating",e.Link="link"}(i3||(i3={})),function(e){e.NextQuestion="next_question",e.End="end",e.ResponseBased="response_based",e.SpecificQuestion="specific_question"}(Na||(Na={}));var Uce=function(){function e(){Xt(this,e),pe(this,"events",{}),this.events={}}return Jt(e,[{key:"on",value:function(e,t){var n=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){n.events[e]=n.events[e].filter(function(e){return e!==t})}}},{key:"emit",value:function(e,t){var n,r=va(this.events[e]||[]);try{for(r.s();!(n=r.n()).done;)(0,n.value)(t)}catch(e){r.e(e)}finally{r.f()}var i,o=va(this.events["*"]||[]);try{for(o.s();!(i=o.n()).done;)(0,i.value)(e,t)}catch(e){o.e(e)}finally{o.f()}}}]),e}(),gHe=function(){function e(t){var n=this;Xt(this,e),pe(this,"_debugEventEmitter",new Uce),pe(this,"checkStep",function(e,t){return n.checkStepEvent(e,t)&&n.checkStepUrl(e,t)&&n.checkStepElement(e,t)}),pe(this,"checkStepEvent",function(e,t){return null==t||!t.event||(null==e?void 0:e.event)===(null==t?void 0:t.event)}),this.instance=t,this.actionEvents=new Set,this.actionRegistry=new Set}return Jt(e,[{key:"init",value:function(){var e,t,n=this;et(null===(e=this.instance)||void 0===e?void 0:e._addCaptureHook)||(null===(t=this.instance)||void 0===t||t._addCaptureHook(function(e,t){n.on(e,t)}))}},{key:"register",value:function(e){var t,n,r=this;if(!et(null===(t=this.instance)||void 0===t?void 0:t._addCaptureHook)&&(e.forEach(function(e){var t,n;null===(t=r.actionRegistry)||void 0===t||t.add(e),null===(n=e.steps)||void 0===n||n.forEach(function(e){var t;null===(t=r.actionEvents)||void 0===t||t.add((null==e?void 0:e.event)||"")})}),null!==(n=this.instance)&&void 0!==n&&n.autocapture)){var i,o=new Set;e.forEach(function(e){var t;null===(t=e.steps)||void 0===t||t.forEach(function(e){null!=e&&e.selector&&o.add(null==e?void 0:e.selector)})}),null===(i=this.instance)||void 0===i||i.autocapture.setElementSelectors(o)}}},{key:"on",value:function(e,t){var n,r=this;null!=t&&0!=e.length&&(this.actionEvents.has(e)||this.actionEvents.has(null==t?void 0:t.event))&&this.actionRegistry&&(null===(n=this.actionRegistry)||void 0===n?void 0:n.size)>0&&this.actionRegistry.forEach(function(e){r.checkAction(t,e)&&r._debugEventEmitter.emit("actionCaptured",e.name)})}},{key:"_addActionHook",value:function(e){this.onAction("actionCaptured",function(t){return e(t)})}},{key:"checkAction",value:function(e,t){if(null==(null==t?void 0:t.steps))return!1;var n,r=va(t.steps);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(this.checkStep(e,i))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"onAction",value:function(e,t){return this._debugEventEmitter.on(e,t)}},{key:"checkStepUrl",value:function(t,n){if(null!=n&&n.url){var r,i=null==t||null===(r=t.properties)||void 0===r?void 0:r.$current_url;if(!i||"string"!=typeof i||!e.matchString(i,null==n?void 0:n.url,(null==n?void 0:n.url_matching)||"contains"))return!1}return!0}},{key:"checkStepElement",value:function(t,n){if((null!=n&&n.href||null!=n&&n.tag_name||null!=n&&n.text)&&!this.getElementsList(t).some(function(t){return!(null!=n&&n.href&&!e.matchString(t.href||"",null==n?void 0:n.href,(null==n?void 0:n.href_matching)||"exact")||null!=n&&n.tag_name&&t.tag_name!==(null==n?void 0:n.tag_name)||null!=n&&n.text&&!e.matchString(t.text||"",null==n?void 0:n.text,(null==n?void 0:n.text_matching)||"exact")&&!e.matchString(t.$el_text||"",null==n?void 0:n.text,(null==n?void 0:n.text_matching)||"exact"))}))return!1;if(null!=n&&n.selector){var r,i=null==t||null===(r=t.properties)||void 0===r?void 0:r.$element_selectors;if(!i||!i.includes(null==n?void 0:n.selector))return!1}return!0}},{key:"getElementsList",value:function(e){return null==(null==e?void 0:e.properties.$elements)?[]:null==e?void 0:e.properties.$elements}}],[{key:"matchString",value:function(t,n,r){switch(r){case"regex":return!!se&&JC(t,n);case"exact":return n===t;case"contains":var i=e.escapeStringRegexp(n).replace(/_/g,".").replace(/%/g,".*");return JC(t,i);default:return!1}}},{key:"escapeStringRegexp",value:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}]),e}(),k7=function(){function e(t){Xt(this,e),this.instance=t,this.eventToSurveys=new Map,this.actionToSurveys=new Map}return Jt(e,[{key:"register",value:function(e){var t;et(null===(t=this.instance)||void 0===t?void 0:t._addCaptureHook)||(this.setupEventBasedSurveys(e),this.setupActionBasedSurveys(e))}},{key:"setupActionBasedSurveys",value:function(e){var t=this,n=e.filter(function(e){var t,n,r,i;return(null===(t=e.conditions)||void 0===t?void 0:t.actions)&&(null===(n=e.conditions)||void 0===n||null===(r=n.actions)||void 0===r||null===(i=r.values)||void 0===i?void 0:i.length)>0});0!==n.length&&(null==this.actionMatcher&&(this.actionMatcher=new gHe(this.instance),this.actionMatcher.init(),this.actionMatcher._addActionHook(function(e){t.onAction(e)})),n.forEach(function(e){var n,r,i,o,s,a,l,c,u,d;e.conditions&&null!==(n=e.conditions)&&void 0!==n&&n.actions&&null!==(r=e.conditions)&&void 0!==r&&null!==(i=r.actions)&&void 0!==i&&i.values&&(null===(o=e.conditions)||void 0===o||null===(s=o.actions)||void 0===s||null===(a=s.values)||void 0===a?void 0:a.length)>0&&(null===(l=t.actionMatcher)||void 0===l||l.register(e.conditions.actions.values),null===(c=e.conditions)||void 0===c||null===(u=c.actions)||void 0===u||null===(d=u.values)||void 0===d||d.forEach(function(n){if(n&&n.name){var r=t.actionToSurveys.get(n.name);r&&r.push(e.id),t.actionToSurveys.set(n.name,r||[e.id])}}))}))}},{key:"setupEventBasedSurveys",value:function(e){var t,n=this;0!==e.filter(function(e){var t,n,r,i;return(null===(t=e.conditions)||void 0===t?void 0:t.events)&&(null===(n=e.conditions)||void 0===n||null===(r=n.events)||void 0===r||null===(i=r.values)||void 0===i?void 0:i.length)>0}).length&&(null===(t=this.instance)||void 0===t||t._addCaptureHook(function(e,t){n.onEvent(e,t)}),e.forEach(function(e){var t,r,i;null===(t=e.conditions)||void 0===t||null===(r=t.events)||void 0===r||null===(i=r.values)||void 0===i||i.forEach(function(t){if(t&&t.name){var r=n.eventToSurveys.get(t.name);r&&r.push(e.id),n.eventToSurveys.set(t.name,r||[e.id])}})}))}},{key:"onEvent",value:function(t,n){var r,i,o=(null===(r=this.instance)||void 0===r||null===(i=r.persistence)||void 0===i?void 0:i.props[Z2])||[];if(e.SURVEY_SHOWN_EVENT_NAME==t&&n&&o.length>0){var s,a=null==n||null===(s=n.properties)||void 0===s?void 0:s.$survey_id;if(a){var l=o.indexOf(a);l>=0&&(o.splice(l,1),this._updateActivatedSurveys(o))}}else this.eventToSurveys.has(t)&&this._updateActivatedSurveys(o.concat(this.eventToSurveys.get(t)||[]))}},{key:"onAction",value:function(e){var t,n,r=(null===(t=this.instance)||void 0===t||null===(n=t.persistence)||void 0===n?void 0:n.props[Z2])||[];this.actionToSurveys.has(e)&&this._updateActivatedSurveys(r.concat(this.actionToSurveys.get(e)||[]))}},{key:"_updateActivatedSurveys",value:function(e){var t,n;null===(t=this.instance)||void 0===t||null===(n=t.persistence)||void 0===n||n.register(pe({},Z2,_u(new Set(e))))}},{key:"getSurveys",value:function(){var e,t;return(null===(e=this.instance)||void 0===e||null===(t=e.persistence)||void 0===t?void 0:t.props[Z2])||[]}},{key:"getEventToSurveys",value:function(){return this.eventToSurveys}},{key:"_getActionMatcher",value:function(){return this.actionMatcher}}]),e}();pe(k7,"SURVEY_SHOWN_EVENT_NAME","survey shown");var $0="[Surveys]",vHe={icontains:function(e){return!!se&&se.location.href.toLowerCase().indexOf(e.toLowerCase())>-1},not_icontains:function(e){return!!se&&-1===se.location.href.toLowerCase().indexOf(e.toLowerCase())},regex:function(e){return!!se&&JC(se.location.href,e)},not_regex:function(e){return!!se&&!JC(se.location.href,e)},exact:function(e){return(null==se?void 0:se.location.href)===e},is_not:function(e){return(null==se?void 0:se.location.href)!==e}},yHe=function(){function e(t){Xt(this,e),this.instance=t,this._surveyEventReceiver=null}return Jt(e,[{key:"afterDecideResponse",value:function(e){this._decideServerResponse=!!e.surveys,this.loadIfEnabled()}},{key:"loadIfEnabled",value:function(){var e=this,t=null==Yn?void 0:Yn.extendPostHogWithSurveys;this.instance.config.disable_surveys||!this._decideServerResponse||t||(null==this._surveyEventReceiver&&(this._surveyEventReceiver=new k7(this.instance)),this.instance.requestRouter.loadScript("/static/surveys.js",function(t){if(t)return Se.error($0,"Could not load surveys script",t);e._surveyManager=Yn.extendPostHogWithSurveys(e.instance)}))}},{key:"getSurveys",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.instance.config.disable_surveys)return e([]);null==this._surveyEventReceiver&&(this._surveyEventReceiver=new k7(this.instance));var r=this.instance.get_property(d7);if(r&&!n)return e(r);this.instance._send_request({url:this.instance.requestRouter.endpointFor("api","/api/surveys/?token=".concat(this.instance.config.token)),method:"GET",transport:"XHR",callback:function(n){var r;if(200!==n.statusCode||!n.json)return e([]);var i,o=n.json.surveys||[],s=o.filter(function(e){var t,n,r,i,o,s,a,l,c,u,d,h;return(null===(t=e.conditions)||void 0===t?void 0:t.events)&&(null===(n=e.conditions)||void 0===n||null===(r=n.events)||void 0===r?void 0:r.values)&&(null===(i=e.conditions)||void 0===i||null===(o=i.events)||void 0===o||null===(s=o.values)||void 0===s?void 0:s.length)>0||(null===(a=e.conditions)||void 0===a?void 0:a.actions)&&(null===(l=e.conditions)||void 0===l||null===(c=l.actions)||void 0===c?void 0:c.values)&&(null===(u=e.conditions)||void 0===u||null===(d=u.actions)||void 0===d||null===(h=d.values)||void 0===h?void 0:h.length)>0});return s.length>0&&(null===(i=t._surveyEventReceiver)||void 0===i||i.register(s)),null===(r=t.instance.persistence)||void 0===r||r.register(pe({},d7,o)),e(o)}})}},{key:"getActiveMatchingSurveys",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getSurveys(function(n){var r,i=n.filter(function(e){return!(!e.start_date||e.end_date)}).filter(function(e){var t,n,r,i;if(!e.conditions)return!0;var o=null===(t=e.conditions)||void 0===t||!t.url||vHe[null!==(n=null===(r=e.conditions)||void 0===r?void 0:r.urlMatchType)&&void 0!==n?n:"icontains"](e.conditions.url),s=null===(i=e.conditions)||void 0===i||!i.selector||(null==He?void 0:He.querySelector(e.conditions.selector));return o&&s}),o=null===(r=t._surveyEventReceiver)||void 0===r?void 0:r.getSurveys(),s=i.filter(function(e){var n,r,i,s,a,l,c,u,d,h;if(!e.linked_flag_key&&!e.targeting_flag_key&&!e.internal_targeting_flag_key)return!0;var p=!e.linked_flag_key||t.instance.featureFlags.isFeatureEnabled(e.linked_flag_key),f=!e.targeting_flag_key||t.instance.featureFlags.isFeatureEnabled(e.targeting_flag_key),m=(null===(n=e.conditions)||void 0===n?void 0:n.events)&&(null===(r=e.conditions)||void 0===r||null===(i=r.events)||void 0===i?void 0:i.values)&&(null===(s=e.conditions)||void 0===s||null===(a=s.events)||void 0===a?void 0:a.values.length)>0,v=(null===(l=e.conditions)||void 0===l?void 0:l.actions)&&(null===(c=e.conditions)||void 0===c||null===(u=c.actions)||void 0===u?void 0:u.values)&&(null===(d=e.conditions)||void 0===d||null===(h=d.actions)||void 0===h?void 0:h.values.length)>0,g=!m&&!v||(null==o?void 0:o.includes(e.id)),y=t._canActivateRepeatedly(e),b=!(e.internal_targeting_flag_key&&!y)||t.instance.featureFlags.isFeatureEnabled(e.internal_targeting_flag_key);return p&&f&&b&&g});return e(s)},n)}},{key:"getNextSurveyStep",value:function(e,t,n){var r,i=e.questions[t],o=t+1;if(null===(r=i.branching)||void 0===r||!r.type)return t===e.questions.length-1?Na.End:o;if(i.branching.type===Na.End)return Na.End;if(i.branching.type===Na.SpecificQuestion){if(Number.isInteger(i.branching.index))return i.branching.index}else if(i.branching.type===Na.ResponseBased){if(i.type===i3.SingleChoice){var s,a,l=i.choices.indexOf("".concat(n));if(null!==(s=i.branching)&&void 0!==s&&null!==(a=s.responseValues)&&void 0!==a&&a.hasOwnProperty(l)){var c=i.branching.responseValues[l];return Number.isInteger(c)?c:c===Na.End?Na.End:o}}else if(i.type===i3.Rating){var u,d;if("number"!=typeof n||!Number.isInteger(n))throw new Error("The response type must be an integer");var h=function(e,t){if(3===t){if(e<1||e>3)throw new Error("The response must be in range 1-3");return 1===e?"negative":2===e?"neutral":"positive"}if(5===t){if(e<1||e>5)throw new Error("The response must be in range 1-5");return e<=2?"negative":3===e?"neutral":"positive"}if(10===t){if(e<0||e>10)throw new Error("The response must be in range 0-10");return e<=6?"detractors":e<=8?"passives":"promoters"}throw new Error("The scale must be one of: 3, 5, 10")}(n,i.scale);if(null!==(u=i.branching)&&void 0!==u&&null!==(d=u.responseValues)&&void 0!==d&&d.hasOwnProperty(h)){var p=i.branching.responseValues[h];return Number.isInteger(p)?p:p===Na.End?Na.End:o}}return o}return Se.warn($0,"Falling back to next question index due to unexpected branching type"),o}},{key:"_canActivateRepeatedly",value:function(e){return qs(Yn.__PosthogExtensions__.canActivateRepeatedly)&&Se.warn($0,"canActivateRepeatedly is not defined, must init before calling"),Yn.__PosthogExtensions__.canActivateRepeatedly(e)}},{key:"canRenderSurvey",value:function(e){var t=this;qs(this._surveyManager)?Se.warn($0,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(n){var r=n.filter(function(t){return t.id===e})[0];t._surveyManager.canRenderSurvey(r)})}},{key:"renderSurvey",value:function(e,t){var n=this;qs(this._surveyManager)?Se.warn($0,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(r){var i=r.filter(function(t){return t.id===e})[0];n._surveyManager.renderSurvey(i,null==He?void 0:He.querySelector(t))})}}]),e}(),bHe=function(){function e(t){var n,r,i=this;Xt(this,e),pe(this,"serverLimits",{}),pe(this,"lastEventRateLimited",!1),pe(this,"checkForLimiting",function(e){var t=e.text;if(t&&t.length)try{(JSON.parse(t).quota_limited||[]).forEach(function(e){Se.info("[RateLimiter] ".concat(e||"events"," is quota limited.")),i.serverLimits[e]=(new Date).getTime()+6e4})}catch(e){return void Se.warn('[RateLimiter] could not rate limit - continuing. Error: "'.concat(null==e?void 0:e.message,'"'),{text:t})}}),this.instance=t,this.captureEventsPerSecond=(null===(n=t.config.rate_limiting)||void 0===n?void 0:n.events_per_second)||10,this.captureEventsBurstLimit=Math.max((null===(r=t.config.rate_limiting)||void 0===r?void 0:r.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}return Jt(e,[{key:"clientRateLimitContext",value:function(){var e,t,n,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=(new Date).getTime(),o=null!==(e=null===(t=this.instance.persistence)||void 0===t?void 0:t.get_property(h7))&&void 0!==e?e:{tokens:this.captureEventsBurstLimit,last:i};o.tokens+=(i-o.last)/1e3*this.captureEventsPerSecond,o.last=i,o.tokens>this.captureEventsBurstLimit&&(o.tokens=this.captureEventsBurstLimit);var s=o.tokens<1;return s||r||(o.tokens=Math.max(0,o.tokens-1)),!s||this.lastEventRateLimited||r||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to ".concat(this.captureEventsPerSecond," events per second and ").concat(this.captureEventsBurstLimit," events burst limit.")},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=s,null===(n=this.instance.persistence)||void 0===n||n.set_property(h7,o),{isRateLimited:s,remainingTokens:o.tokens}}},{key:"isServerRateLimited",value:function(e){var t=this.serverLimits[e||"events"]||!1;return!1!==t&&(new Date).getTime()<t}}]),e}(),_He=function(){return Fe({initialPathName:(null==xs?void 0:xs.pathname)||"",referringDomain:mi.referringDomain()},mi.campaignParams())},SHe=function(){function e(t,n,r){var i=this;Xt(this,e),pe(this,"_onSessionIdCallback",function(e){var t=i._getStoredProps();if(!t||t.sessionId!==e){var n={sessionId:e,props:i._sessionSourceParamGenerator()};i._persistence.register(pe({},f7,n))}}),this._sessionIdManager=t,this._persistence=n,this._sessionSourceParamGenerator=r||_He,this._sessionIdManager.onSessionId(this._onSessionIdCallback)}return Jt(e,[{key:"_getStoredProps",value:function(){return this._persistence.props[f7]}},{key:"getSessionProps",value:function(){var e,t=null===(e=this._getStoredProps())||void 0===e?void 0:e.props;return t?{$client_session_initial_referring_host:t.referringDomain,$client_session_initial_pathname:t.initialPathName,$client_session_initial_utm_source:t.utm_source,$client_session_initial_utm_campaign:t.utm_campaign,$client_session_initial_utm_medium:t.utm_medium,$client_session_initial_utm_content:t.utm_content,$client_session_initial_utm_term:t.utm_term}:{}}}]),e}(),EHe=["ahrefsbot","ahrefssiteaudit","applebot","baiduspider","bingbot","bingpreview","bot.htm","bot.php","crawler","deepscan","duckduckbot","facebookexternal","facebookcatalog","gptbot","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","semrushbot","sitebulb","slurp","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","headlesschrome","cypress","Google-HotelAdsVerifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","Bytespider;"],yK=function(e,t){if(!e)return!1;var n=e.toLowerCase();return EHe.concat(t||[]).some(function(e){var t=e.toLowerCase();return-1!==n.indexOf(t)})},jce=function(){function e(){Xt(this,e),this.clicks=[]}return Jt(e,[{key:"isRageClick",value:function(e,t,n){var r=this.clicks[this.clicks.length-1];if(r&&Math.abs(e-r.x)+Math.abs(t-r.y)<30&&n-r.timestamp<1e3){if(this.clicks.push({x:e,y:t,timestamp:n}),3===this.clicks.length)return!0}else this.clicks=[{x:e,y:t,timestamp:n}];return!1}}]),e}();function bK(e){var t;return e.id===g7||!(null===(t=e.closest)||void 0===t||!t.call(e,"#"+g7))}var wHe=function(){function e(t){var n,r=this;Xt(this,e),pe(this,"rageclicks",new jce),pe(this,"_enabledServerSide",!1),pe(this,"_initialized",!1),pe(this,"_flushInterval",null),this.instance=t,this._enabledServerSide=!(null===(n=this.instance.persistence)||void 0===n||!n.props[c7]),null==se||se.addEventListener("beforeunload",function(){r.flush()})}return Jt(e,[{key:"flushIntervalMilliseconds",get:function(){var e=5e3;return Di(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}},{key:"isEnabled",get:function(){return et(this.instance.config.capture_heatmaps)?et(this.instance.config.enable_heatmaps)?this._enabledServerSide:this.instance.config.enable_heatmaps:!1!==this.instance.config.capture_heatmaps}},{key:"startIfEnabled",value:function(){if(this.isEnabled){if(this._initialized)return;Se.info("[heatmaps] starting..."),this._setupListeners(),this._flushInterval=setInterval(this.flush.bind(this),this.flushIntervalMilliseconds)}else{var e;clearInterval(null!==(e=this._flushInterval)&&void 0!==e?e:void 0),this.getAndClearBuffer()}}},{key:"afterDecideResponse",value:function(e){var t=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register(pe({},c7,t)),this._enabledServerSide=t,this.startIfEnabled()}},{key:"getAndClearBuffer",value:function(){var e=this.buffer;return this.buffer=void 0,e}},{key:"_setupListeners",value:function(){var e=this;se&&He&&(cu(He,"click",function(t){return e._onClick(t||(null==se?void 0:se.event))},!1,!0),cu(He,"mousemove",function(t){return e._onMouseMove(t||(null==se?void 0:se.event))},!1,!0),this._initialized=!0)}},{key:"_getProperties",value:function(e,t){var n=this.instance.scrollManager.scrollY(),r=this.instance.scrollManager.scrollX(),i=this.instance.scrollManager.scrollElement(),o=function(e,t,n){for(var r=e;r&&!of(r,"body");){if(r===n)return!1;if(Ut(t,null==se?void 0:se.getComputedStyle(r).position))return!0;r=Tce(r)}return!1}(e.target,["fixed","sticky"],i);return{x:e.clientX+(o?0:r),y:e.clientY+(o?0:n),target_fixed:o,type:t}}},{key:"_onClick",value:function(e){var t;if(!bK(e.target)){var n=this._getProperties(e,"click");null!==(t=this.rageclicks)&&void 0!==t&&t.isRageClick(e.clientX,e.clientY,(new Date).getTime())&&this._capture(Fe(Fe({},n),{},{type:"rageclick"})),this._capture(n)}}},{key:"_onMouseMove",value:function(e){var t=this;bK(e.target)||(clearTimeout(this._mouseMoveTimeout),this._mouseMoveTimeout=setTimeout(function(){t._capture(t._getProperties(e,"mousemove"))},500))}},{key:"_capture",value:function(e){if(se){var t=se.location.href;this.buffer=this.buffer||{},this.buffer[t]||(this.buffer[t]=[]),this.buffer[t].push(e)}}},{key:"flush",value:function(){this.buffer&&!Cw(this.buffer)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}]),e}(),CHe=function(){function e(t){var n=this;Xt(this,e),pe(this,"_updateScrollData",function(){var e,t,r,i;n.context||(n.context={});var o=n.scrollElement(),s=n.scrollY(),a=o?Math.max(0,o.scrollHeight-o.clientHeight):0,l=s+((null==o?void 0:o.clientHeight)||0),c=(null==o?void 0:o.scrollHeight)||0;n.context.lastScrollY=Math.ceil(s),n.context.maxScrollY=Math.max(s,null!==(e=n.context.maxScrollY)&&void 0!==e?e:0),n.context.maxScrollHeight=Math.max(a,null!==(t=n.context.maxScrollHeight)&&void 0!==t?t:0),n.context.lastContentY=l,n.context.maxContentY=Math.max(l,null!==(r=n.context.maxContentY)&&void 0!==r?r:0),n.context.maxContentHeight=Math.max(c,null!==(i=n.context.maxContentHeight)&&void 0!==i?i:0)}),this.instance=t}return Jt(e,[{key:"getContext",value:function(){return this.context}},{key:"resetContext",value:function(){var e=this.context;return setTimeout(this._updateScrollData,0),e}},{key:"startMeasuringScrollPosition",value:function(){null==se||se.addEventListener("scroll",this._updateScrollData,!0),null==se||se.addEventListener("scrollend",this._updateScrollData,!0),null==se||se.addEventListener("resize",this._updateScrollData)}},{key:"scrollElement",value:function(){if(!this.instance.config.scroll_root_selector)return null==se?void 0:se.document.documentElement;var e,t=va(ei(this.instance.config.scroll_root_selector)?this.instance.config.scroll_root_selector:[this.instance.config.scroll_root_selector]);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=null==se?void 0:se.document.querySelector(n);if(r)return r}}catch(e){t.e(e)}finally{t.f()}}},{key:"scrollY",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return se&&(se.scrollY||se.pageYOffset||se.document.documentElement.scrollTop)||0}},{key:"scrollX",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return se&&(se.scrollX||se.pageXOffset||se.document.documentElement.scrollLeft)||0}}]),e}(),Sx="$copy_autocapture";function Ex(e,t){return t.length>e?t.slice(0,e)+"...":t}var Ud,THe=function(){function e(t){Xt(this,e),pe(this,"_initialized",!1),pe(this,"_isDisabledServerSide",null),pe(this,"rageclicks",new jce),pe(this,"_elementsChainAsString",!1),this.instance=t,this._elementSelectors=null}return Jt(e,[{key:"config",get:function(){var e,t,n=Di(this.instance.config.autocapture)?this.instance.config.autocapture:{};return n.url_allowlist=null===(e=n.url_allowlist)||void 0===e?void 0:e.map(function(e){return new RegExp(e)}),n.url_ignorelist=null===(t=n.url_ignorelist)||void 0===t?void 0:t.map(function(e){return new RegExp(e)}),n}},{key:"_addDomEventHandlers",value:function(){var e=this;if(this.isBrowserSupported()){if(se&&He){var t=function(t){t=t||(null==se?void 0:se.event);try{e._captureEvent(t)}catch(e){Se.error("Failed to capture event",e)}},n=function(t){t=t||(null==se?void 0:se.event),e._captureEvent(t,Sx)};cu(He,"submit",t,!1,!0),cu(He,"change",t,!1,!0),cu(He,"click",t,!1,!0),this.config.capture_copied_text&&(cu(He,"copy",n,!1,!0),cu(He,"cut",n,!1,!0))}}else Se.info("Disabling Automatic Event Collection because this browser is not supported")}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(this._addDomEventHandlers(),this._initialized=!0)}},{key:"afterDecideResponse",value:function(e){e.elementsChainAsString&&(this._elementsChainAsString=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register(pe({},FG,!!e.autocapture_opt_out)),this._isDisabledServerSide=!!e.autocapture_opt_out,this.startIfEnabled()}},{key:"setElementSelectors",value:function(e){this._elementSelectors=e}},{key:"getElementSelectors",value:function(e){var t,n=[];return null===(t=this._elementSelectors)||void 0===t||t.forEach(function(t){var r=null==He?void 0:He.querySelectorAll(t);null==r||r.forEach(function(r){e===r&&n.push(t)})}),n}},{key:"isEnabled",get:function(){var e,t,n=null===(e=this.instance.persistence)||void 0===e?void 0:e.props[FG],r=this._isDisabledServerSide;if(qu(r)&&!Ph(n)&&!this.instance.config.advanced_disable_decide)return!1;var i=null!==(t=this._isDisabledServerSide)&&void 0!==t?t:!!n;return!!this.instance.config.autocapture&&!i}},{key:"_previousElementSibling",value:function(e){if(e.previousElementSibling)return e.previousElementSibling;var t=e;do{t=t.previousSibling}while(t&&!m8(t));return t}},{key:"_getAugmentPropertiesFromElement",value:function(e){if(!w7(e))return{};var t={};return An(e.attributes,function(e){if(e.name&&0===e.name.indexOf("data-ph-capture-attribute")){var n=e.name.replace("data-ph-capture-attribute-",""),r=e.value;n&&r&&Ng(r)&&(t[n]=r)}}),t}},{key:"_getPropertiesFromElement",value:function(e,t,n){var r,i=e.tagName.toLowerCase(),o={tag_name:i};E7.indexOf(i)>-1&&!n&&("a"===i.toLowerCase()||"button"===i.toLowerCase()?o.$el_text=Ex(1024,sK(e)):o.$el_text=Ex(1024,t3(e)));var s=e3(e);s.length>0&&(o.classes=s.filter(function(e){return""!==e}));var a=null===(r=this.config)||void 0===r?void 0:r.element_attribute_ignorelist;An(e.attributes,function(n){var r;if((!Rce(e)||-1!==["name","id","class","aria-label"].indexOf(n.name))&&(null==a||!a.includes(n.name))&&!t&&Ng(n.value)&&(r=n.name,!es(r)||"_ngcontent"!==r.substring(0,10)&&"_nghost"!==r.substring(0,7))){var i=n.value;"class"===n.name&&(i=p8(i).join(" ")),o["attr__"+n.name]=Ex(1024,i)}});for(var l=1,c=1,u=e;u=this._previousElementSibling(u);)l++,u.tagName===e.tagName&&c++;return o.nth_child=l,o.nth_of_type=c,o}},{key:"_getDefaultProperties",value:function(e){return{$event_type:e,$ce_version:1}}},{key:"_getEventTarget",value:function(e){return et(e.target)?e.srcElement||null:null!==(t=e.target)&&void 0!==t&&t.shadowRoot?e.composedPath()[0]||null:e.target||null;var t}},{key:"_captureEvent",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$autocapture";if(this.isEnabled){var r,i=this._getEventTarget(e);wce(i)&&(i=i.parentNode||null),"$autocapture"===n&&"click"===e.type&&e instanceof MouseEvent&&this.instance.config.rageclick&&null!==(r=this.rageclicks)&&void 0!==r&&r.isRageClick(e.clientX,e.clientY,(new Date).getTime())&&this._captureEvent(e,"$rageclick");var o=n===Sx;if(i&&MBe(i,e,this.config,o,o?["copy","cut"]:void 0)){for(var s,a,l=[i],c=i;c.parentNode&&!of(c,"body");)Cce(c.parentNode)?(l.push(c.parentNode.host),c=c.parentNode.host):(l.push(c.parentNode),c=c.parentNode);var u,d,h=[],p={},f=!1;if(An(l,function(e){var n=w7(e);"a"===e.tagName.toLowerCase()&&(u=e.getAttribute("href"),u=n&&Ng(u)&&u),Ut(e3(e),"ph-no-capture")&&(f=!0),h.push(t._getPropertiesFromElement(e,t.instance.config.mask_all_element_attributes,t.instance.config.mask_all_text));var r=t._getAugmentPropertiesFromElement(e);ls(p,r)}),this.instance.config.mask_all_text||("a"===i.tagName.toLowerCase()||"button"===i.tagName.toLowerCase()?h[0].$el_text=sK(i):h[0].$el_text=t3(i)),u){var m,v;h[0].attr__href=u;var g=null===(m=Fy(u))||void 0===m?void 0:m.host,y=null==se||null===(v=se.location)||void 0===v?void 0:v.host;g&&y&&g!==y&&(d=u)}if(f)return!1;var b=ls(this._getDefaultProperties(e.type),this._elementsChainAsString?{$elements_chain:FBe(h)}:{$elements:h},null!==(s=h[0])&&void 0!==s&&s.$el_text?{$el_text:null===(a=h[0])||void 0===a?void 0:a.$el_text}:{},d&&"click"===e.type?{$external_click_url:d}:{},p),w=this.getElementSelectors(i);if(w&&w.length>0&&(b.$element_selectors=w),n===Sx){var _,S=Ece(null==se||null===(_=se.getSelection())||void 0===_?void 0:_.toString()),E=e.type||"clipboard";if(!S)return!1;b.$selected_content=S,b.$copy_type=E}return this.instance.capture(n,b),!0}}}},{key:"isBrowserSupported",value:function(){return ca(null==He?void 0:He.querySelectorAll)}}]),e}(),RHe=function(){function e(t){var n=this;Xt(this,e),pe(this,"_restoreXHRPatch",void 0),pe(this,"_restoreFetchPatch",void 0),pe(this,"_startCapturing",function(){et(n._restoreXHRPatch)&&Yn.postHogTracingHeadersPatchFns._patchXHR(n.instance.sessionManager),et(n._restoreFetchPatch)&&Yn.postHogTracingHeadersPatchFns._patchFetch(n.instance.sessionManager)}),this.instance=t}return Jt(e,[{key:"_loadScript",value:function(e){Yn.postHogTracingHeadersPatchFns&&e(),this.instance.requestRouter.loadScript("/static/tracing-headers.js?v=".concat(ea.LIB_VERSION),function(t){if(t)return Se.error("[TRACING-HEADERS] failed to load script",t);e()})}},{key:"startIfEnabledOrStop",value:function(){var e,t;this.instance.config.__add_tracing_headers?this._loadScript(this._startCapturing):(null===(e=this._restoreXHRPatch)||void 0===e||e.call(this),null===(t=this._restoreFetchPatch)||void 0===t||t.call(this),this._restoreXHRPatch=void 0,this._restoreFetchPatch=void 0)}}]),e}();!function(e){e[e.PENDING=-1]="PENDING",e[e.DENIED=0]="DENIED",e[e.GRANTED=1]="GRANTED"}(Ud||(Ud={}));var IHe=function(){function e(t){Xt(this,e),this.instance=t}return Jt(e,[{key:"config",get:function(){return this.instance.config}},{key:"consent",get:function(){return this.getDnt()?Ud.DENIED:this.storedConsent}},{key:"isOptedOut",value:function(){return this.consent===Ud.DENIED||this.consent===Ud.PENDING&&this.config.opt_out_capturing_by_default}},{key:"isOptedIn",value:function(){return!this.isOptedOut()}},{key:"optInOut",value:function(e){this.storage.set(this.storageKey,e?1:0,this.config.cookie_expiration,this.config.cross_subdomain_cookie,this.config.secure_cookie)}},{key:"reset",value:function(){this.storage.remove(this.storageKey,this.config.cross_subdomain_cookie)}},{key:"storageKey",get:function(){var e=this.instance.config,t=e.token;return(e.opt_out_capturing_cookie_prefix||"__ph_opt_in_out_")+t}},{key:"storedConsent",get:function(){var e=this.storage.get(this.storageKey);return"1"===e?Ud.GRANTED:"0"===e?Ud.DENIED:Ud.PENDING}},{key:"storage",get:function(){if(!this._storage){var e=this.config.opt_out_capturing_persistence_type;this._storage="localStorage"===e?Qr:Su;var t="localStorage"===e?Su:Qr;t.get(this.storageKey)&&(this._storage.get(this.storageKey)||this.optInOut("1"===t.get(this.storageKey)),t.remove(this.storageKey,this.config.cross_subdomain_cookie))}return this._storage}},{key:"getDnt",value:function(){return!!this.config.respect_dnt&&!!ice([null==Ja?void 0:Ja.doNotTrack,null==Ja?void 0:Ja.msDoNotTrack,Yn.doNotTrack],function(e){return Ut([!0,1,"1","yes"],e)})}}]),e}(),aE="[Exception Autocapture]",kHe=function(){function e(t){var n,r=this;Xt(this,e),pe(this,"originalOnUnhandledRejectionHandler",void 0),pe(this,"startCapturing",function(){if(se&&r.isEnabled&&!r.hasHandlers&&!r.isCapturing){var e=se.posthogErrorWrappingFunctions.wrapOnError,t=se.posthogErrorWrappingFunctions.wrapUnhandledRejection;if(e&&t)try{r.unwrapOnError=e(r.captureException.bind(r)),r.unwrapUnhandledRejection=t(r.captureException.bind(r))}catch(e){Se.error(aE+" failed to start",e),r.stopCapturing()}else Se.error(aE+" failed to load error wrapping functions - cannot start")}}),this.instance=t,this.remoteEnabled=!(null===(n=this.instance.persistence)||void 0===n||!n.props[$G]),this.startIfEnabled()}return Jt(e,[{key:"isEnabled",get:function(){var e;return null!==(e=this.remoteEnabled)&&void 0!==e&&e}},{key:"isCapturing",get:function(){var e;return!(null==se||null===(e=se.onerror)||void 0===e||!e.__POSTHOG_INSTRUMENTED__)}},{key:"hasHandlers",get:function(){return this.originalOnUnhandledRejectionHandler||this.unwrapOnError}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this.isCapturing&&(Se.info(aE+" enabled, starting..."),this.loadScript(this.startCapturing))}},{key:"loadScript",value:function(e){this.hasHandlers&&e(),this.instance.requestRouter.loadScript("/static/exception-autocapture.js?v=".concat(ea.LIB_VERSION),function(t){if(t)return Se.error(aE+" failed to load script",t);e()})}},{key:"stopCapturing",value:function(){var e,t;null===(e=this.unwrapOnError)||void 0===e||e.call(this),null===(t=this.unwrapUnhandledRejection)||void 0===t||t.call(this)}},{key:"afterDecideResponse",value:function(e){var t=e.autocaptureExceptions;this.remoteEnabled=!!t||!1,this.instance.persistence&&this.instance.persistence.register(pe({},$G,this.remoteEnabled)),this.startIfEnabled()}},{key:"captureException",value:function(e){var t=this.instance.requestRouter.endpointFor("ui");e.$exception_personURL="".concat(t,"/project/").concat(this.instance.config.token,"/person/").concat(this.instance.get_distinct_id()),this.instance.exceptions.sendExceptionEvent(e)}}]),e}(),_K=9e5,mh="[Web Vitals]",xHe=function(){function e(t){var n,r=this;Xt(this,e),pe(this,"_enabledServerSide",!1),pe(this,"_initialized",!1),pe(this,"buffer",{url:void 0,metrics:[],firstMetricTimestamp:void 0}),pe(this,"_flushToCapture",function(){clearTimeout(r._delayedFlushTimer),0!==r.buffer.metrics.length&&(r.instance.capture("$web_vitals",r.buffer.metrics.reduce(function(e,t){var n;return Fe(Fe({},e),{},(pe(n={},"$web_vitals_".concat(t.name,"_event"),Fe({},t)),pe(n,"$web_vitals_".concat(t.name,"_value"),t.value),n))},{})),r.buffer={url:void 0,metrics:[],firstMetricTimestamp:void 0})}),pe(this,"_addToBuffer",function(e){var t,n=null===(t=r.instance.sessionManager)||void 0===t?void 0:t.checkAndGetSessionAndWindowId(!0);if(et(n))Se.error(mh+"Could not read session ID. Dropping metrics!");else{r.buffer=r.buffer||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var i=r._currentURL();et(i)||(qs(null==e?void 0:e.name)||qs(null==e?void 0:e.value)?Se.error(mh+"Invalid metric received",e):r._maxAllowedValue&&e.value>=r._maxAllowedValue?Se.error(mh+"Ignoring metric with value >= "+r._maxAllowedValue,e):(r.buffer.url!==i&&(r._flushToCapture(),r._delayedFlushTimer=setTimeout(r._flushToCapture,8e3)),et(r.buffer.url)&&(r.buffer.url=i),r.buffer.firstMetricTimestamp=et(r.buffer.firstMetricTimestamp)?Date.now():r.buffer.firstMetricTimestamp,r.buffer.metrics.push(Fe(Fe({},e),{},{$current_url:i,$session_id:n.sessionId,$window_id:n.windowId,timestamp:Date.now()})),4===r.buffer.metrics.length&&r._flushToCapture()))}}),pe(this,"_startCapturing",function(){var e=Yn.postHogWebVitalsCallbacks,t=e.onLCP,n=e.onCLS,i=e.onFCP,o=e.onINP;t&&n&&i&&o?(t(r._addToBuffer),n(r._addToBuffer),i(r._addToBuffer),o(r._addToBuffer),r._initialized=!0):Se.error(mh+"web vitals callbacks not loaded - not starting")}),this.instance=t,this._enabledServerSide=!(null===(n=this.instance.persistence)||void 0===n||!n.props[HG]),this.startIfEnabled()}return Jt(e,[{key:"_maxAllowedValue",get:function(){var e=Di(this.instance.config.capture_performance)&&ta(this.instance.config.capture_performance.__web_vitals_max_value)?this.instance.config.capture_performance.__web_vitals_max_value:_K;return 0<e&&e<=6e4?_K:e}},{key:"isEnabled",get:function(){var e=Di(this.instance.config.capture_performance)?this.instance.config.capture_performance.web_vitals:void 0;return Ph(e)?e:this._enabledServerSide}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(Se.info(mh+" enabled, starting..."),this.loadScript(this._startCapturing))}},{key:"afterDecideResponse",value:function(e){var t=Di(e.capturePerformance)&&!!e.capturePerformance.web_vitals;this.instance.persistence&&this.instance.persistence.register(pe({},HG,t)),this._enabledServerSide=t,this.startIfEnabled()}},{key:"loadScript",value:function(e){se.postHogWebVitalsCallbacks&&e(),this.instance.requestRouter.loadScript("/static/web-vitals.js?v=".concat(ea.LIB_VERSION),function(t){t?Se.error(mh+" failed to load script",t):e()})}},{key:"_currentURL",value:function(){var e=se?se.location.href:void 0;return e||Se.error(mh+"Could not determine current URL"),e}}]),e}(),SK="/e/",AHe=function(){function e(t){var n;Xt(this,e),this.instance=t,this._endpointSuffix=(null===(n=this.instance.persistence)||void 0===n?void 0:n.props[BG])||SK}return Jt(e,[{key:"endpoint",get:function(){return this.instance.requestRouter.endpointFor("api",this._endpointSuffix)}},{key:"afterDecideResponse",value:function(e){var t=e.autocaptureExceptions;this._endpointSuffix=Di(t)&&t.endpoint||SK,this.instance.persistence&&this.instance.persistence.register(pe({},BG,this._endpointSuffix))}},{key:"sendExceptionEvent",value:function(e){this.instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent",_url:this.endpoint})}}]),e}(),Hy={},EK=function(){},Zm="posthog",Fce=!aHe&&-1===(null==pi?void 0:pi.indexOf("MSIE"))&&-1===(null==pi?void 0:pi.indexOf("Mozilla")),wK=function(){var e,t,n;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:(t=null==He?void 0:He.location,n=null==t?void 0:t.hostname,!!es(n)&&"herokuapp.com"!==n.split(".").slice(-2).join(".")),persistence:"localStorage+cookie",persistence_name:"",loaded:EK,store_google:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:xs&&es(null==xs?void 0:xs.search)&&-1!==xs.search.indexOf("__posthog_debug=true")||!1,verbose:!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_surveys:!1,enable_recording_console_log:void 0,secure_cookie:"https:"===(null==se||null===(e=se.location)||void 0===e?void 0:e.protocol),ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},inapp_protocol:"//",inapp_link_new_window:!1,request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,on_request_error:function(e){var t="Bad HTTP status: "+e.statusCode+" "+e.text;Se.error(t)},get_device_id:function(e){return e},_onCapture:EK,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"always",__add_tracing_headers:!1}},CK=function(e){var t={};et(e.process_person)||(t.person_profiles=e.process_person),et(e.xhr_headers)||(t.request_headers=e.xhr_headers),et(e.cookie_name)||(t.persistence_name=e.cookie_name),et(e.disable_cookie)||(t.disable_persistence=e.disable_cookie);var n=ls({},t,e);return ei(e.property_blacklist)&&(et(e.property_denylist)?n.property_denylist=e.property_blacklist:ei(e.property_denylist)?n.property_denylist=[].concat(_u(e.property_blacklist),_u(e.property_denylist)):Se.error("Invalid value for property_denylist config: "+e.property_denylist)),n},LHe=function(){function e(){Xt(this,e),pe(this,"__forceAllowLocalhost",!1)}return Jt(e,[{key:"_forceAllowLocalhost",get:function(){return this.__forceAllowLocalhost},set:function(e){Se.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}]),e}(),$ce=function(){function e(){var t=this;Xt(this,e),pe(this,"webPerformance",new LHe),pe(this,"version",ea.LIB_VERSION),pe(this,"_internalEventEmitter",new Uce),this.config=wK(),this.decideEndpointWasHit=!1,this.SentryIntegration=hHe,this.sentryIntegration=function(e){return n=Nce(t,e),{name:Dce,processEvent:function(e){return n(e)}};var n},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this._initialPageviewCaptured=!1,this.featureFlags=new lBe(this),this.toolbar=new JBe(this),this.scrollManager=new CHe(this),this.pageViewManager=new mHe(this),this.surveys=new yHe(this),this.exceptions=new AHe(this),this.rateLimiter=new bHe(this),this.requestRouter=new fHe(this),this.consent=new IHe(this),this.people={set:function(e,n,r){var i=es(e)?pe({},e,n):e;t.setPersonProperties(i),null==r||r({})},set_once:function(e,n,r){var i=es(e)?pe({},e,n):e;t.setPersonProperties(void 0,i),null==r||r({})}},this.on("eventCaptured",function(e){return Se.info("send",e)})}return Jt(e,[{key:"init",value:function(t,n,r){if(r&&r!==Zm){var i,o=null!==(i=Hy[r])&&void 0!==i?i:new e;return o._init(t,n,r),Hy[r]=o,Hy[Zm][r]=o,o}return this._init(t,n,r)}},{key:"_init",value:function(e){var t,n,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(et(e)||OG(e))return Se.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return Se.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this._triggered_notifs=[],this.set_config(ls({},wK(),CK(i),{name:o,token:e})),this.config.on_xhr_error&&Se.error("[posthog] on_xhr_error is deprecated. Use on_request_error instead"),this.compression=i.disable_compression?void 0:Ya.GZipJS,this.persistence=new vx(this.config),this.sessionPersistence="sessionStorage"===this.config.persistence?this.persistence:new vx(Fe(Fe({},this.config),{},{persistence:"sessionStorage"}));var s=Fe({},this.persistence.props),a=Fe({},this.sessionPersistence.props);if(this._requestQueue=new QBe(function(e){return r._send_retriable_request(e)}),this._retryQueue=new uHe(this),this.__request_queue=[],this.sessionManager=new dHe(this.config,this.persistence),this.sessionPropsManager=new SHe(this.sessionManager,this.persistence),new RHe(this).startIfEnabledOrStop(),this.sessionRecording=new WBe(this),this.sessionRecording.startIfEnabledOrStop(),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new THe(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new wHe(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new xHe(this),this.exceptionObserver=new kHe(this),this.exceptionObserver.startIfEnabled(),ea.DEBUG=ea.DEBUG||this.config.debug,ea.DEBUG&&Se.info("Starting in debug mode",{this:this,config:i,thisC:Fe({},this.config),p:s,s:a}),this._sync_opt_out_with_persistence(),void 0!==(null===(t=i.bootstrap)||void 0===t?void 0:t.distinctID)){var l,c,u=this.config.get_device_id(Wd()),d=null!==(l=i.bootstrap)&&void 0!==l&&l.isIdentifiedID?u:i.bootstrap.distinctID;this.persistence.set_property(Wl,null!==(c=i.bootstrap)&&void 0!==c&&c.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:i.bootstrap.distinctID,$device_id:d})}if(this._hasBootstrappedFeatureFlags()){var h,p,f=Object.keys((null===(h=i.bootstrap)||void 0===h?void 0:h.featureFlags)||{}).filter(function(e){var t,n;return!(null===(t=i.bootstrap)||void 0===t||null===(n=t.featureFlags)||void 0===n||!n[e])}).reduce(function(e,t){var n,r;return e[t]=(null===(n=i.bootstrap)||void 0===n||null===(r=n.featureFlags)||void 0===r?void 0:r[t])||!1,e},{}),m=Object.keys((null===(p=i.bootstrap)||void 0===p?void 0:p.featureFlagPayloads)||{}).filter(function(e){return f[e]}).reduce(function(e,t){var n,r,o,s;return null!==(n=i.bootstrap)&&void 0!==n&&null!==(r=n.featureFlagPayloads)&&void 0!==r&&r[t]&&(e[t]=null===(o=i.bootstrap)||void 0===o||null===(s=o.featureFlagPayloads)||void 0===s?void 0:s[t]),e},{});this.featureFlags.receivedFeatureFlags({featureFlags:f,featureFlagPayloads:m})}if(!this.get_distinct_id()){var v=this.config.get_device_id(Wd());this.register_once({distinct_id:v,$device_id:v},""),this.persistence.set_property(Wl,"anonymous")}return null==se||null===(n=se.addEventListener)||void 0===n||n.call(se,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this)),this.toolbar.maybeLoadToolbar(),i.segment?pHe(this,function(){return r._loaded()}):this._loaded(),ca(this.config._onCapture)&&this.on("eventCaptured",function(e){return r.config._onCapture(e.event,e)}),this}},{key:"_afterDecideResponse",value:function(e){var t,n,r,i,o,s,a,l;this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=Ut(e.supportedCompression,Ya.GZipJS)?Ya.GZipJS:Ut(e.supportedCompression,Ya.Base64)?Ya.Base64:void 0),null!==(t=e.analytics)&&void 0!==t&&t.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),null===(n=this.sessionRecording)||void 0===n||n.afterDecideResponse(e),null===(r=this.autocapture)||void 0===r||r.afterDecideResponse(e),null===(i=this.heatmaps)||void 0===i||i.afterDecideResponse(e),null===(o=this.surveys)||void 0===o||o.afterDecideResponse(e),null===(s=this.webVitalsAutocapture)||void 0===s||s.afterDecideResponse(e),null===(a=this.exceptions)||void 0===a||a.afterDecideResponse(e),null===(l=this.exceptionObserver)||void 0===l||l.afterDecideResponse(e)}},{key:"_loaded",value:function(){var e=this,t=this.config.advanced_disable_decide;t||this.featureFlags.setReloadingPaused(!0);try{this.config.loaded(this)}catch(e){Se.critical("`loaded` function failed",e)}this._start_queue_if_opted_in(),this.config.capture_pageview&&setTimeout(function(){e.consent.isOptedIn()&&e._captureInitialPageview()},1),t||(new YBe(this).call(),this.featureFlags.resetRequestQueue())}},{key:"_start_queue_if_opted_in",value:function(){var e;this.has_opted_out_capturing()||this.config.request_batching&&(null===(e=this._requestQueue)||void 0===e||e.enable())}},{key:"_dom_loaded",value:function(){var e=this;this.has_opted_out_capturing()||Og(this.__request_queue,function(t){return e._send_retriable_request(t)}),this.__request_queue=[],this._start_queue_if_opted_in()}},{key:"_handle_unload",value:function(){var e,t;this.config.request_batching?(this._shouldCapturePageleave()&&this.capture("$pageleave"),null===(e=this._requestQueue)||void 0===e||e.unload(),null===(t=this._retryQueue)||void 0===t||t.unload()):this._shouldCapturePageleave()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}},{key:"_send_request",value:function(e){var t=this;this.__loaded&&(Fce?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=r3(e.url,{ip:this.config.ip?1:0}),e.headers=Fe({},this.config.request_headers),e.compression="best-available"===e.compression?this.compression:e.compression,function(e){var t,n,r,i=Fe({},e);i.timeout=i.timeout||6e4,i.url=r3(i.url,{_:(new Date).getTime().toString(),ver:ea.LIB_VERSION,compression:i.compression});var o=null!==(t=i.transport)&&void 0!==t?t:"XHR",s=null!==(n=null===(r=ice(By,function(e){return e.transport===o}))||void 0===r?void 0:r.method)&&void 0!==n?n:By[0].method;if(!s)throw new Error("No available transport method");s(i)}(Fe(Fe({},e),{},{callback:function(n){var r,i,o;t.rateLimiter.checkForLimiting(n),n.statusCode>=400&&(null===(i=(o=t.config).on_request_error)||void 0===i||i.call(o,n)),null===(r=e.callback)||void 0===r||r.call(e,n)}}))))}},{key:"_send_retriable_request",value:function(e){this._retryQueue?this._retryQueue.retriableRequest(e):this._send_request(e)}},{key:"_execute_array",value:function(e){var t,n=this,r=[],i=[],o=[];Og(e,function(e){e&&(t=e[0],ei(t)?o.push(e):ca(e)?e.call(n):ei(e)&&"alias"===t?r.push(e):ei(e)&&-1!==t.indexOf("capture")&&ca(n[t])?o.push(e):i.push(e))});var s=function(e,t){Og(e,function(e){if(ei(e[0])){var n=t;An(e,function(e){n=n[e[0]].apply(n,e.slice(1))})}else this[e[0]].apply(this,e.slice(1))},t)};s(r,this),s(i,this),s(o,this)}},{key:"_hasBootstrappedFeatureFlags",value:function(){var e,t;return(null===(e=this.config.bootstrap)||void 0===e?void 0:e.featureFlags)&&Object.keys(null===(t=this.config.bootstrap)||void 0===t?void 0:t.featureFlags).length>0||!1}},{key:"push",value:function(e){this._execute_array([e])}},{key:"capture",value:function(e,t,n){var r;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this._requestQueue){if(!this.consent.isOptedOut())if(!et(e)&&es(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var i=null!=n&&n.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(null==i||!i.isRateLimited){this.sessionPersistence.update_search_keyword(),this.config.store_google&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.store_google||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,s=(null==n?void 0:n.timestamp)||o,a={uuid:Wd(),event:e,properties:this._calculate_event_properties(e,t||{},s)};i&&(a.properties.$lib_rate_limit_remaining_tokens=i.remainingTokens),null!=n&&n.$set&&(a.$set=null==n?void 0:n.$set);var l=this._calculate_set_once_properties(null==n?void 0:n.$set_once);l&&(a.$set_once=l),(a=oBe(a,null!=n&&n._noTruncate?null:this.config.properties_string_max_length)).timestamp=s,et(null==n?void 0:n.timestamp)||(a.properties.$event_time_override_provided=!0,a.properties.$event_time_override_system_time=o);var c=Fe(Fe({},a.properties.$set),a.$set);Cw(c)||this.setPersonPropertiesForFlags(c),this._internalEventEmitter.emit("eventCaptured",a);var u={method:"POST",url:null!==(r=null==n?void 0:n._url)&&void 0!==r?r:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:a,compression:"best-available",batchKey:null==n?void 0:n._batchKey};return!this.config.request_batching||n&&(null==n||!n._batchKey)||null!=n&&n.send_instantly?this._send_retriable_request(u):this._requestQueue.enqueue(u),a}Se.critical("This capture call is ignored due to client rate limiting.")}}else Se.error("No event name provided to posthog.capture")}else Se.uninitializedWarning("posthog.capture")}},{key:"_addCaptureHook",value:function(e){this.on("eventCaptured",function(t){return e(t.event,t)})}},{key:"_calculate_event_properties",value:function(e,t,n){if(n=n||new Date,!this.persistence||!this.sessionPersistence)return t;var r=this.persistence.remove_event_timer(e),i=Fe({},t);if(i.token=this.config.token,"$snapshot"===e){var o=Fe(Fe({},this.persistence.properties()),this.sessionPersistence.properties());return i.distinct_id=o.distinct_id,(!es(i.distinct_id)&&!ta(i.distinct_id)||OG(i.distinct_id))&&Se.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),i}var s=mi.properties();if(this.sessionManager){var a=this.sessionManager.checkAndGetSessionAndWindowId(),l=a.sessionId,c=a.windowId;i.$session_id=l,i.$window_id=c}if(this.requestRouter.region===Oh.CUSTOM&&(i.$lib_custom_api_host=this.config.api_host),this.sessionPropsManager&&this.config.__preview_send_client_session_params&&("$pageview"===e||"$pageleave"===e||"$autocapture"===e)){var u=this.sessionPropsManager.getSessionProps();i=ls(i,u)}if(!this.config.disable_scroll_properties){var d={};"$pageview"===e?d=this.pageViewManager.doPageView(n):"$pageleave"===e&&(d=this.pageViewManager.doPageLeave(n)),i=ls(i,d)}if("$pageview"===e&&He&&(i.title=He.title),!et(r)){var h=n.getTime()-r;i.$duration=parseFloat((h/1e3).toFixed(3))}pi&&this.config.opt_out_useragent_filter&&(i.$browser_type=this._is_bot()?"bot":"browser"),(i=ls({},s,this.persistence.properties(),this.sessionPersistence.properties(),i)).$is_identified=this._isIdentified(),ei(this.config.property_denylist)?An(this.config.property_denylist,function(e){delete i[e]}):Se.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var p=this.config.sanitize_properties;return p&&(i=p(i,e)),i.$process_person_profile=this._hasPersonProcessing(),i}},{key:"_calculate_set_once_properties",value:function(e){if(!this.persistence||!this._hasPersonProcessing())return e;var t=ls({},this.persistence.get_initial_props(),e||{});return Cw(t)?void 0:t}},{key:"register",value:function(e,t){var n;null===(n=this.persistence)||void 0===n||n.register(e,t)}},{key:"register_once",value:function(e,t,n){var r;null===(r=this.persistence)||void 0===r||r.register_once(e,t,n)}},{key:"register_for_session",value:function(e){var t;null===(t=this.sessionPersistence)||void 0===t||t.register(e)}},{key:"unregister",value:function(e){var t;null===(t=this.persistence)||void 0===t||t.unregister(e)}},{key:"unregister_for_session",value:function(e){var t;null===(t=this.sessionPersistence)||void 0===t||t.unregister(e)}},{key:"_register_single",value:function(e,t){this.register(pe({},e,t))}},{key:"getFeatureFlag",value:function(e,t){return this.featureFlags.getFeatureFlag(e,t)}},{key:"getFeatureFlagPayload",value:function(e){var t=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(t)}catch{return t}}},{key:"isFeatureEnabled",value:function(e,t){return this.featureFlags.isFeatureEnabled(e,t)}},{key:"reloadFeatureFlags",value:function(){this.featureFlags.reloadFeatureFlags()}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,t){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,t)}},{key:"getEarlyAccessFeatures",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.featureFlags.getEarlyAccessFeatures(e,t)}},{key:"on",value:function(e,t){return this._internalEventEmitter.on(e,t)}},{key:"onFeatureFlags",value:function(e){return this.featureFlags.onFeatureFlags(e)}},{key:"onSessionId",value:function(e){var t,n;return null!==(t=null===(n=this.sessionManager)||void 0===n?void 0:n.onSessionId(e))&&void 0!==t?t:function(){}}},{key:"getSurveys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.surveys.getSurveys(e,t)}},{key:"getActiveMatchingSurveys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.surveys.getActiveMatchingSurveys(e,t)}},{key:"renderSurvey",value:function(e,t){this.surveys.renderSurvey(e,t)}},{key:"canRenderSurvey",value:function(e){this.surveys.canRenderSurvey(e)}},{key:"getNextSurveyStep",value:function(e,t,n){return this.surveys.getNextSurveyStep(e,t,n)}},{key:"identify",value:function(e,t,n){if(!this.__loaded||!this.persistence)return Se.uninitializedWarning("posthog.identify");if(ta(e)&&(e=e.toString(),Se.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))Se.critical('The string "'.concat(e,'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.'));else if(this._requirePersonProcessing("posthog.identify")){var r=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var i=r;this.register_once({$had_persisted_distinct_id:!0,$device_id:i},"")}e!==r&&e!==this.get_property(uy)&&(this.unregister(uy),this.register({distinct_id:e}));var o="anonymous"===(this.persistence.get_property(Wl)||"anonymous");e!==r&&o?(this.persistence.set_property(Wl,"identified"),this.setPersonPropertiesForFlags(t||{},!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:r},{$set:t||{},$set_once:n||{}}),this.featureFlags.setAnonymousDistinctId(r)):(t||n)&&this.setPersonProperties(t,n),e!==r&&(this.reloadFeatureFlags(),this.unregister(YC))}}else Se.error("Unique user id has not been set in posthog.identify")}},{key:"setPersonProperties",value:function(e,t){(e||t)&&this._requirePersonProcessing("posthog.setPersonProperties")&&(this.setPersonPropertiesForFlags(e||{}),this.capture("$set",{$set:e||{},$set_once:t||{}}))}},{key:"group",value:function(e,t,n){if(e&&t){if(this._requirePersonProcessing("posthog.group")){var r=this.getGroups();r[e]!==t&&this.resetGroupPropertiesForFlags(e),this.register({$groups:Fe(Fe({},r),{},pe({},e,t))}),n&&(this.capture("$groupidentify",{$group_type:e,$group_key:t,$group_set:n}),this.setGroupPropertiesForFlags(pe({},e,n))),r[e]===t||n||this.reloadFeatureFlags()}}else Se.error("posthog.group requires a group type and group key")}},{key:"resetGroups",value:function(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}},{key:"setPersonPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._requirePersonProcessing("posthog.setPersonPropertiesForFlags")&&this.featureFlags.setPersonPropertiesForFlags(e,t)}},{key:"resetPersonPropertiesForFlags",value:function(){this.featureFlags.resetPersonPropertiesForFlags()}},{key:"setGroupPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._requirePersonProcessing("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,t)}},{key:"resetGroupPropertiesForFlags",value:function(e){this.featureFlags.resetGroupPropertiesForFlags(e)}},{key:"reset",value:function(e){var t,n,r,i;if(Se.info("reset"),!this.__loaded)return Se.uninitializedWarning("posthog.reset");var o=this.get_property("$device_id");this.consent.reset(),null===(t=this.persistence)||void 0===t||t.clear(),null===(n=this.sessionPersistence)||void 0===n||n.clear(),null===(r=this.persistence)||void 0===r||r.set_property(Wl,"anonymous"),null===(i=this.sessionManager)||void 0===i||i.resetSessionId();var s=this.config.get_device_id(Wd());this.register_once({distinct_id:s,$device_id:e?s:o},"")}},{key:"get_distinct_id",value:function(){return this.get_property("distinct_id")}},{key:"getGroups",value:function(){return this.get_property("$groups")||{}}},{key:"get_session_id",value:function(){var e,t;return null!==(e=null===(t=this.sessionManager)||void 0===t?void 0:t.checkAndGetSessionAndWindowId(!0).sessionId)&&void 0!==e?e:""}},{key:"get_session_replay_url",value:function(e){if(!this.sessionManager)return"";var t=this.sessionManager.checkAndGetSessionAndWindowId(!0),n=t.sessionId,r=t.sessionStartTimestamp,i=this.requestRouter.endpointFor("ui","/project/".concat(this.config.token,"/replay/").concat(n));if(null!=e&&e.withTimestamp&&r){var o,s=null!==(o=e.timestampLookBack)&&void 0!==o?o:10;if(!r)return i;var a=Math.max(Math.floor(((new Date).getTime()-r)/1e3)-s,0);i+="?t=".concat(a)}return i}},{key:"alias",value:function(e,t){return e===this.get_property(sce)?(Se.critical("Attempting to create alias for existing People user - aborting."),-2):this._requirePersonProcessing("posthog.alias")?(et(t)&&(t=this.get_distinct_id()),e!==t?(this._register_single(uy,e),this.capture("$create_alias",{alias:e,distinct_id:t})):(Se.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}},{key:"set_config",value:function(e){var t,n,r,i,o=Fe({},this.config);Di(e)&&(ls(this.config,CK(e)),null===(t=this.persistence)||void 0===t||t.update_config(this.config,o),this.sessionPersistence="sessionStorage"===this.config.persistence?this.persistence:new vx(Fe(Fe({},this.config),{},{persistence:"sessionStorage"})),Qr.is_supported()&&"true"===Qr.get("ph_debug")&&(this.config.debug=!0),this.config.debug&&(ea.DEBUG=!0,Se.info("set_config",{config:e,oldConfig:o,newConfig:Fe({},this.config)})),null===(n=this.sessionRecording)||void 0===n||n.startIfEnabledOrStop(),null===(r=this.autocapture)||void 0===r||r.startIfEnabled(),null===(i=this.heatmaps)||void 0===i||i.startIfEnabled(),this.surveys.loadIfEnabled(),this._sync_opt_out_with_persistence())}},{key:"startSessionRecording",value:function(e){var t,n=Ph(e)&&e;if(n||null!=e&&e.sampling){var r,i,o=null===(r=this.sessionManager)||void 0===r?void 0:r.checkAndGetSessionAndWindowId();null===(i=this.persistence)||void 0===i||i.register(pe({},jy,!0)),Se.info("Session recording started with sampling override for session: ",null==o?void 0:o.sessionId)}(n||null!=e&&e.linked_flag)&&(null===(t=this.sessionRecording)||void 0===t||t.overrideLinkedFlag(),Se.info("Session recording started with linked_flags override")),this.set_config({disable_session_recording:!1})}},{key:"stopSessionRecording",value:function(){this.set_config({disable_session_recording:!0})}},{key:"sessionRecordingStarted",value:function(){var e;return!(null===(e=this.sessionRecording)||void 0===e||!e.started)}},{key:"captureException",value:function(e,t){var n=ca(Yn.parseErrorAsProperties)?Yn.parseErrorAsProperties([e.message,void 0,void 0,void 0,e]):Fe({$exception_type:e.name,$exception_message:e.message,$exception_level:"error"},t);this.exceptions.sendExceptionEvent(n)}},{key:"loadToolbar",value:function(e){return this.toolbar.loadToolbar(e)}},{key:"get_property",value:function(e){var t;return null===(t=this.persistence)||void 0===t?void 0:t.props[e]}},{key:"getSessionProperty",value:function(e){var t;return null===(t=this.sessionPersistence)||void 0===t?void 0:t.props[e]}},{key:"toString",value:function(){var e,t=null!==(e=this.config.name)&&void 0!==e?e:Zm;return t!==Zm&&(t=Zm+"."+t),t}},{key:"_isIdentified",value:function(){var e,t;return"identified"===(null===(e=this.persistence)||void 0===e?void 0:e.get_property(Wl))||"identified"===(null===(t=this.sessionPersistence)||void 0===t?void 0:t.get_property(Wl))}},{key:"_hasPersonProcessing",value:function(){var e,t,n,r;return!("never"===this.config.person_profiles||"identified_only"===this.config.person_profiles&&!this._isIdentified()&&Cw(this.getGroups())&&(null===(e=this.persistence)||void 0===e||null===(t=e.props)||void 0===t||!t[uy])&&(null===(n=this.persistence)||void 0===n||null===(r=n.props)||void 0===r||!r[XC]))}},{key:"_shouldCapturePageleave",value:function(){return!0===this.config.capture_pageleave||"if_capture_pageview"===this.config.capture_pageleave&&this.config.capture_pageview}},{key:"createPersonProfile",value:function(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.setPersonProperties({},{})}},{key:"_requirePersonProcessing",value:function(e){return"never"===this.config.person_profiles?(Se.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._register_single(XC,!0),!0)}},{key:"_sync_opt_out_with_persistence",value:function(){var e,t,n,r,i=this.consent.isOptedOut(),o=this.config.opt_out_persistence_by_default,s=this.config.disable_persistence||i&&!!o;(null===(e=this.persistence)||void 0===e?void 0:e.disabled)!==s&&(null===(n=this.persistence)||void 0===n||n.set_disabled(s)),(null===(t=this.sessionPersistence)||void 0===t?void 0:t.disabled)!==s&&(null===(r=this.sessionPersistence)||void 0===r||r.set_disabled(s))}},{key:"opt_in_capturing",value:function(e){var t;this.consent.optInOut(!0),this._sync_opt_out_with_persistence(),(et(null==e?void 0:e.captureEventName)||null!=e&&e.captureEventName)&&this.capture(null!==(t=null==e?void 0:e.captureEventName)&&void 0!==t?t:"$opt_in",null==e?void 0:e.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this._captureInitialPageview()}},{key:"opt_out_capturing",value:function(){this.consent.optInOut(!1),this._sync_opt_out_with_persistence()}},{key:"has_opted_in_capturing",value:function(){return this.consent.isOptedIn()}},{key:"has_opted_out_capturing",value:function(){return this.consent.isOptedOut()}},{key:"clear_opt_in_out_capturing",value:function(){this.consent.reset(),this._sync_opt_out_with_persistence()}},{key:"_is_bot",value:function(){return Ja?function(e,t){if(!e)return!1;var n=e.userAgent;if(n&&yK(n,t))return!0;try{var r=null==e?void 0:e.userAgentData;if(null!=r&&r.brands&&r.brands.some(function(e){return yK(null==e?void 0:e.brand,t)}))return!0}catch{}return!!e.webdriver}(Ja,this.config.custom_blocked_useragents):void 0}},{key:"_captureInitialPageview",value:function(){He&&!this._initialPageviewCaptured&&(this._initialPageviewCaptured=!0,this.capture("$pageview",{title:He.title},{send_instantly:!0}))}},{key:"debug",value:function(e){!1===e?(null==se||se.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(null==se||se.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}}]),e}();!function(e,t){for(var n=0;n<t.length;n++)e.prototype[t[n]]=sBe(e.prototype[t[n]])}($ce,["identify"]);var TK,PHe=(TK=Hy[Zm]=new $ce,function(){function e(){e.done||(e.done=!0,Fce=!1,An(Hy,function(e){e._dom_loaded()}))}null!=He&&He.addEventListener&&("complete"===He.readyState?e():He.addEventListener("DOMContentLoaded",e,!1)),se&&cu(se,"load",e,!0)}(),TK);class OHe extends LX{constructor(){super(...arguments),this.eventBacklogs=new Map}emit(e,...t){const n=super.emit(e,...t);if(!n){const n=this.eventBacklogs.get(e);n?n.push(t):this.eventBacklogs.set(e,[t])}return n}on(e,t){super.on(e,t);const n=this.eventBacklogs.get(e);if(n){for(const t of n)super.emit(e,...t);this.eventBacklogs.delete(e)}return this}addListener(e,t){return this.on(e,t)}once(e,t){super.once(e,t);const n=this.eventBacklogs.get(e);return n&&(super.emit(e,...n[0]),1===n.length?this.eventBacklogs.delete(e):n.shift()),this}}const MHe=""+new URL("cat-4r_NkDcK.ogg",import.meta.url).href,DHe=""+new URL("cat-Dd8bv_2W.mp3",import.meta.url).href,NHe=""+new URL("clap-AxCMZLTd.ogg",import.meta.url).href,UHe=""+new URL("clap-Dxm5qGyl.mp3",import.meta.url).href,jHe=""+new URL("crickets-DUJdcuUa.ogg",import.meta.url).href,FHe=""+new URL("crickets-CcwrRdbq.mp3",import.meta.url).href,$He=""+new URL("dog-CxIWtkNX.ogg",import.meta.url).href,BHe=""+new URL("dog-BoQdnF-w.mp3",import.meta.url).href,HHe=""+new URL("generic-BBbS3Wph.ogg",import.meta.url).href,VHe=""+new URL("generic-BFeSb6fL.mp3",import.meta.url).href,qHe=""+new URL("lightbulb-BIeJtAR_.ogg",import.meta.url).href,GHe=""+new URL("lightbulb-BrnY00qi.mp3",import.meta.url).href,KHe=""+new URL("party-D7rIOhAQ.ogg",import.meta.url).href,zHe=""+new URL("party-BZPeTgC3.mp3",import.meta.url).href,WHe=""+new URL("deer-DPSlVch4.ogg",import.meta.url).href,YHe=""+new URL("deer-91r1Gyrx.mp3",import.meta.url).href,XHe=""+new URL("rock-BVCJXNC-.ogg",import.meta.url).href,JHe=""+new URL("rock-CHdnB31m.mp3",import.meta.url).href,QHe=""+new URL("wave-FiiOzicp.ogg",import.meta.url).href,ZHe=""+new URL("wave-Bzf1LSMH.mp3",import.meta.url).href,y8="io.element.call.reaction",x7={name:"generic",emoji:"",sound:{mp3:VHe,ogg:HHe}},A7=5,Db=[{emoji:"👍",name:"thumbsup",alias:["+1","yes","thumbs up"]},{emoji:"🎉",name:"party",alias:["hurray","success"],sound:{ogg:KHe,mp3:zHe}},{emoji:"👏",name:"clapping",alias:["celebrate","success"],sound:{ogg:NHe,mp3:UHe}},{emoji:"🐶",name:"dog",alias:["doggo","pupper","woofer","bark"],sound:{ogg:$He,mp3:BHe}},{emoji:"🐱",name:"cat",alias:["meow","kitty"],sound:{ogg:MHe,mp3:DHe}},{emoji:"💡",name:"lightbulb",alias:["bulb","light","idea","ping"],sound:{ogg:qHe,mp3:GHe}},{emoji:"🦗",name:"crickets",alias:["awkward","silence"],sound:{ogg:jHe,mp3:FHe}},{emoji:"👎",name:"thumbsdown",alias:["-1","no","thumbs no"]},{emoji:"😵‍💫",name:"dizzy",alias:["dazed","confused"]},{emoji:"👌",name:"ok",alias:["okay","cool"]},{emoji:"🥰",name:"heart",alias:["heart","love","smiling"]},{emoji:"😄",name:"laugh",alias:["giggle","joy","smiling"]},{emoji:"🦌",name:"deer",alias:["stag","doe","bleat"],sound:{ogg:WHe,mp3:YHe}},{emoji:"🤘",name:"rock",alias:["cool","horns","guitar"],sound:{ogg:XHe,mp3:JHe}},{emoji:"👋",name:"wave",alias:["hand","waving"],sound:{ogg:QHe,mp3:ZHe}}];var Si=(e=>(e.JoinCall="io.element.join",e.HangupCall="im.vector.hangup",e.Close="io.element.close",e.TileLayout="io.element.tile_layout",e.SpotlightLayout="io.element.spotlight_layout",e.DeviceMute="io.element.device_mute",e))(Si||{});const Qe=(()=>{try{const{widgetId:e,parentUrl:t}=Fr();if(e&&t){const n=new URL(t).origin;M.info("Widget API is available");const r=new Oye(e,n);r.requestCapability(wy.AlwaysOnScreen);const i=new OHe;[hr.ThemeChange,"io.element.join","im.vector.hangup","io.element.tile_layout","io.element.spotlight_layout","io.element.device_mute"].forEach(e=>{r.on(`action:${e}`,t=>{t.preventDefault(),i.emit(e,t)})});const{roomId:o,userId:s,deviceId:a,baseUrl:l,e2eEnabled:c,allowIceFallback:u}=Fr();if(!o)throw new Error("Room ID must be supplied");if(!s)throw new Error("User ID must be supplied");if(!a)throw new Error("Device ID must be supplied");if(!l)throw new Error("Base URL must be supplied");const d=[ee.CallNotify,ee.RTCNotification],h=["org.matrix.rageshake_request",ee.CallEncryptionKeysPrefix,ee.Reaction,ee.RoomRedaction,y8],p=[s,`_${s}_${a}_m.call`,`${s}_${a}_m.call`].map(e=>({eventType:ee.GroupCallMemberPrefix,stateKey:e})),f=[{eventType:ee.RoomCreate},{eventType:ee.RoomName},{eventType:ee.RoomMember},{eventType:ee.RoomEncryption},{eventType:ee.GroupCallMemberPrefix}],m=[ee.CallInvite,ee.CallCandidates,ee.CallAnswer,ee.CallHangup,ee.CallReject,ee.CallSelectAnswer,ee.CallNegotiate,ee.CallSDPStreamMetadataChanged,ee.CallSDPStreamMetadataChangedPrefix,ee.CallReplaces,ee.CallEncryptionKeysPrefix],v=SQ(r,{sendEvent:[...d,...h],receiveEvent:h,sendState:p,receiveState:f,sendToDevice:m,receiveToDevice:m,turnServers:!1,sendDelayedEvents:!0,updateDelayedEvents:!0},o,{baseUrl:l,userId:s,deviceId:a,timelineSupport:!0,useE2eForGroupCall:c,fallbackICEServerAllowed:u},!1);return{api:r,lazyActions:i,client:(async()=>(await Zt.init(),await v.startClient({clientWellKnownPollPeriod:600}),v))()}}return M.info("No widget API available"),null}catch(e){return M.warn("Continuing without the widget API",e),null}})();class eVe{constructor(){this.cache={startTime:new Date(0),maxParticipantsCount:0}}cacheStartCall(e){this.cache.startTime=e}cacheParticipantCountChanged(e){this.cache.maxParticipantsCount=Math.max(e,this.cache.maxParticipantsCount)}track(e,t,n,r){Dt.instance.trackEvent({eventName:"CallEnded",callId:e,callParticipantsMax:this.cache.maxParticipantsCount,callParticipantsOnLeave:t,callDuration:(Date.now()-this.cache.startTime.getTime())/1e3,roomEventEncryptionKeysSent:r.statistics.counters.roomEventEncryptionKeysSent,roomEventEncryptionKeysReceived:r.statistics.counters.roomEventEncryptionKeysReceived,roomEventEncryptionKeysReceivedAverageAge:r.statistics.counters.roomEventEncryptionKeysReceived>0?r.statistics.totals.roomEventEncryptionKeysReceivedTotalAge/r.statistics.counters.roomEventEncryptionKeysReceived:0},{send_instantly:n})}}class tVe{track(e){Dt.instance.trackEvent({eventName:"CallStarted",callId:e})}}class nVe{constructor(){this.cache={signupStart:new Date(0),signupEnd:new Date(0)}}cacheSignupStart(e){this.cache.signupStart=e}getSignupEndTime(){return this.cache.signupEnd}cacheSignupEnd(e){this.cache.signupEnd=e}track(){Dt.instance.trackEvent({eventName:"Signup",signupDuration:Date.now()-this.cache.signupStart.getTime()}),Dt.instance.setRegistrationType(JT.Registered)}}class rVe{track(){Dt.instance.trackEvent({eventName:"Login"}),Dt.instance.setRegistrationType(JT.Registered)}}class iVe{track(e,t){Dt.instance.trackEvent({eventName:"MuteMicrophone",targetMuteState:e?"mute":"unmute",callId:t})}}class sVe{track(e,t){Dt.instance.trackEvent({eventName:"MuteCamera",targetMuteState:e?"mute":"unmute",callId:t})}}class oVe{track(e){Dt.instance.trackEvent({eventName:"UndecryptableToDeviceEvent",callId:e})}}class aVe{track(e,t,n){Dt.instance.trackEvent({eventName:"QualitySurvey",callId:e,feedbackText:t,stars:n})}}class cVe{track(e){Dt.instance.trackEvent({eventName:"CallDisconnected",reason:e})}}class lVe{constructor(){this.connectStart=0,this.websocketConnected=0}cacheConnectStart(){this.connectStart=Date.now()}cacheWsConnect(){this.websocketConnected=Date.now()}track(e={log:!1}){const t=Date.now(),n=t-this.connectStart,r=this.websocketConnected-this.connectStart,i=t-this.websocketConnected;Dt.instance.trackEvent({eventName:"CallConnectDuration",totalDuration:n,websocketDuration:r,peerConnectionDuration:i}),e.log&&M.log(`Time to connect:\ntotal: ${n}ms\npeerConnection: ${r}ms\nwebsocket: ${i}ms`)}}function En(e){return"function"==typeof e}function Bce(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var wx=Bce(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function s3(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var L_=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=_f(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(En(l))try{l()}catch(e){i=e instanceof wx?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=_f(c),d=u.next();!d.done;d=u.next()){var h=d.value;try{RK(h)}catch(e){i=i??[],e instanceof wx?i=ic(ic([],rc(i)),rc(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new wx(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)RK(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&s3(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&s3(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),Hce=L_.EMPTY;function Vce(e){return e instanceof L_||e&&"closed"in e&&En(e.remove)&&En(e.add)&&En(e.unsubscribe)}function RK(e){En(e)?e():e.unsubscribe()}var uVe={Promise:void 0},dVe={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,ic([e,t],rc(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function qce(e){dVe.setTimeout(function(){throw e})}function Nb(){}function Iw(e){e()}var b8=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Vce(t)&&t.add(n)):n.destination=pVe,n}return cc(t,e),t.create=function(e,t,n){return new L7(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(L_),fVe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){cE(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){cE(e)}else cE(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){cE(e)}},e}(),L7=function(e){function t(t,n,r){var i,o=e.call(this)||this;return i=En(t)||!t?{next:t??void 0,error:n??void 0,complete:r??void 0}:t,o.destination=new fVe(i),o}return cc(t,e),t}(b8);function cE(e){qce(e)}function hVe(e){throw e}var pVe={closed:!0,next:Nb,error:hVe,complete:Nb},_8="function"==typeof Symbol&&Symbol.observable||"@@observable";function Uf(e){return e}function mVe(e){return 0===e.length?Uf:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}var qn=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=vVe(e)?e:new L7(e,t,n);return Iw(function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))}),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=IK(t))(function(t,r){var i=new L7({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[_8]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return mVe(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=IK(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function IK(e){var t;return null!==(t=e??uVe.Promise)&&void 0!==t?t:Promise}function gVe(e){return e&&En(e.next)&&En(e.error)&&En(e.complete)}function vVe(e){return e&&e instanceof b8||gVe(e)&&Vce(e)}function yVe(e){return En(null==e?void 0:e.lift)}function ni(e){return function(t){if(yVe(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw new TypeError("Unable to lift unknown Observable type")}}function or(e,t,n,r,i){return new bVe(e,t,n,r,i)}var bVe=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return cc(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(b8),_Ve=Bce(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Zr=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return cc(t,e),t.prototype.lift=function(e){var t=new kK(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new _Ve},t.prototype.next=function(e){var t=this;Iw(function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=_f(t.currentObservers),o=i.next();!o.done;o=i.next()){o.value.next(e)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;Iw(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;Iw(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?Hce:(this.currentObservers=null,o.push(e),new L_(function(){t.currentObservers=null,s3(o,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new qn;return e.source=this,e},t.create=function(e,t){return new kK(e,t)},t}(qn),kK=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return cc(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Hce},t}(Zr),ms=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return cc(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Zr),SVe={now:function(){return Date.now()}},EVe=function(e){function t(t,n){return e.call(this)||this}return cc(t,e),t.prototype.schedule=function(e,t){return this},t}(L_),xK={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,ic([e,t],rc(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},wVe=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return cc(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),xK.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&xK.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,s3(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(EVe),AK=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=SVe.now,e}(),CVe=function(e){function t(t,n){void 0===n&&(n=AK.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return cc(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(AK),YT=new CVe(wVe),TVe=YT,o3=new qn(function(e){return e.complete()});function Gce(e){return e&&En(e.schedule)}function S8(e){return e[e.length-1]}function E8(e){return En(S8(e))?e.pop():void 0}function P_(e){return Gce(S8(e))?e.pop():void 0}function RVe(e,t){return"number"==typeof S8(e)?e.pop():t}var w8=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Kce(e){return En(null==e?void 0:e.then)}function zce(e){return En(e[_8])}function Wce(e){return Symbol.asyncIterator&&En(null==e?void 0:e[Symbol.asyncIterator])}function Yce(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function IVe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var Xce=IVe();function Jce(e){return En(null==e?void 0:e[Xce])}function Qce(e){return rM(this,arguments,function(){var t,n,r;return RT(this,function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,bu(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,bu(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,bu(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Zce(e){return En(null==e?void 0:e.getReader)}function Hi(e){if(e instanceof qn)return e;if(null!=e){if(zce(e))return kVe(e);if(w8(e))return xVe(e);if(Kce(e))return AVe(e);if(Wce(e))return ele(e);if(Jce(e))return LVe(e);if(Zce(e))return PVe(e)}throw Yce(e)}function kVe(e){return new qn(function(t){var n=e[_8]();if(En(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function xVe(e){return new qn(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function AVe(e){return new qn(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,qce)})}function LVe(e){return new qn(function(t){var n,r;try{for(var i=_f(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()})}function ele(e){return new qn(function(t){OVe(e,t).catch(function(e){return t.error(e)})})}function PVe(e){return ele(Qce(e))}function OVe(e,t){var n,r,i,o;return nM(this,void 0,void 0,function(){var s,a;return RT(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=iM(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function af(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function tle(e,t){return void 0===t&&(t=0),ni(function(n,r){n.subscribe(or(r,function(n){return af(r,e,function(){return r.next(n)},t)},function(){return af(r,e,function(){return r.complete()},t)},function(n){return af(r,e,function(){return r.error(n)},t)}))})}function nle(e,t){return void 0===t&&(t=0),ni(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function MVe(e,t){return Hi(e).pipe(nle(t),tle(t))}function DVe(e,t){return Hi(e).pipe(nle(t),tle(t))}function NVe(e,t){return new qn(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function UVe(e,t){return new qn(function(n){var r;return af(n,t,function(){r=e[Xce](),af(n,t,function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)},0,!0)}),function(){return En(null==r?void 0:r.return)&&r.return()}})}function rle(e,t){if(!e)throw new Error("Iterable cannot be null");return new qn(function(n){af(n,t,function(){var r=e[Symbol.asyncIterator]();af(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function jVe(e,t){return rle(Qce(e),t)}function FVe(e,t){if(null!=e){if(zce(e))return MVe(e,t);if(w8(e))return NVe(e,t);if(Kce(e))return DVe(e,t);if(Wce(e))return rle(e,t);if(Jce(e))return UVe(e,t);if(Zce(e))return jVe(e,t)}throw Yce(e)}function O_(e,t){return t?FVe(e,t):Hi(e)}function Ot(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return O_(e,P_(e))}function $Ve(e){return e instanceof Date&&!isNaN(e)}function ke(e,t){return ni(function(n,r){var i=0;n.subscribe(or(r,function(n){r.next(e.call(t,n,i++))}))})}var BVe=Array.isArray;function HVe(e,t){return BVe(t)?e.apply(void 0,ic([],rc(t))):e(t)}function C8(e){return ke(function(t){return HVe(e,t)})}var VVe=Array.isArray,qVe=Object.getPrototypeOf,GVe=Object.prototype,KVe=Object.keys;function ile(e){if(1===e.length){var t=e[0];if(VVe(t))return{args:t,keys:null};if(zVe(t)){var n=KVe(t);return{args:n.map(function(e){return t[e]}),keys:n}}}return{args:e,keys:null}}function zVe(e){return e&&"object"==typeof e&&qVe(e)===GVe}function sle(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})}function ln(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=P_(e),r=E8(e),i=ile(e),o=i.args,s=i.keys;if(0===o.length)return O_([],n);var a=new qn(WVe(o,n,s?function(e){return sle(s,e)}:Uf));return r?a.pipe(C8(r)):a}function WVe(e,t,n){return void 0===n&&(n=Uf),function(r){LK(t,function(){for(var i=e.length,o=new Array(i),s=i,a=i,l=function(i){LK(t,function(){var l=O_(e[i],t),c=!1;l.subscribe(or(r,function(e){o[i]=e,c||(c=!0,a--),a||r.next(n(o.slice()))},function(){--s||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function LK(e,t,n){e?af(n,e,t):t()}function YVe(e,t,n,r,i,o,s,a){var l=[],c=0,u=0,d=!1,h=function(){d&&!l.length&&!c&&t.complete()},p=function(e){c++;var i=!1;Hi(n(e,u++)).subscribe(or(t,function(e){t.next(e)},function(){i=!0},void 0,function(){if(i)try{c--;for(var e=function(){var e=l.shift();s||p(e)};l.length&&c<r;)e();h()}catch(e){t.error(e)}}))};return e.subscribe(or(t,function(e){return c<r?p(e):l.push(e)},function(){d=!0,h()})),function(){}}function M_(e,t,n){return void 0===n&&(n=1/0),En(t)?M_(function(n,r){return ke(function(e,i){return t(n,e,r,i)})(Hi(e(n,r)))},n):("number"==typeof t&&(n=t),ni(function(t,r){return YVe(t,r,e,n)}))}function ole(e){return void 0===e&&(e=1/0),M_(Uf,e)}function XVe(){return ole(1)}function Ub(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return XVe()(O_(e,P_(e)))}function JVe(e){return new qn(function(t){Hi(e()).subscribe(t)})}function QVe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=E8(e),r=ile(e),i=r.args,o=r.keys,s=new qn(function(e){var t=i.length;if(t)for(var n=new Array(t),r=t,s=t,a=function(t){var a=!1;Hi(i[t]).subscribe(or(e,function(e){a||(a=!0,s--),n[t]=e},function(){return r--},void 0,function(){(!r||!a)&&(s||e.next(o?sle(o,n):n),e.complete())}))},l=0;l<t;l++)a(l);else e.complete()});return n?s.pipe(C8(n)):s}var ZVe=["addListener","removeListener"],eqe=["addEventListener","removeEventListener"],tqe=["on","off"];function Ba(e,t,n,r){if(En(n)&&(r=n,n=void 0),r)return Ba(e,t,n).pipe(C8(r));var i=rc(iqe(e)?eqe.map(function(r){return function(i){return e[r](t,i,n)}}):nqe(e)?ZVe.map(PK(e,t)):rqe(e)?tqe.map(PK(e,t)):[],2),o=i[0],s=i[1];if(!o&&w8(e))return M_(function(e){return Ba(e,t,n)})(Hi(e));if(!o)throw new TypeError("Invalid event target");return new qn(function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return o(t),function(){return s(t)}})}function PK(e,t){return function(n){return function(r){return e[n](t,r)}}}function nqe(e){return En(e.addListener)&&En(e.removeListener)}function rqe(e){return En(e.on)&&En(e.off)}function iqe(e){return En(e.addEventListener)&&En(e.removeEventListener)}function Yd(e,t,n){void 0===e&&(e=0),void 0===n&&(n=TVe);var r=-1;return null!=t&&(Gce(t)?n=t:r=t),new qn(function(t){var i=$Ve(e)?+e-n.now():e;i<0&&(i=0);var o=0;return n.schedule(function(){t.closed||(t.next(o++),0<=r?this.schedule(void 0,r):t.complete())},i)})}function P7(e,t){return void 0===e&&(e=0),void 0===t&&(t=YT),e<0&&(e=0),Yd(e,e,t)}function vv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=P_(e),r=RVe(e,1/0),i=e;return i.length?1===i.length?Hi(i[0]):ole(r)(O_(i,n)):o3}var sqe=new qn(Nb),oqe=Array.isArray;function aqe(e){return 1===e.length&&oqe(e[0])?e[0]:e}function $s(e,t){return ni(function(n,r){var i=0;n.subscribe(or(r,function(n){return e.call(t,n,i++)&&r.next(n)}))})}function cqe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=aqe(e)).length?Hi(e[0]):new qn(lqe(e))}function lqe(e){return function(t){for(var n=[],r=function(r){n.push(Hi(e[r]).subscribe(or(t,function(e){if(n){for(var i=0;i<n.length;i++)i!==r&&n[i].unsubscribe();n=null}t.next(e)})))},i=0;n&&!t.closed&&i<e.length;i++)r(i)}}function ale(e){return ni(function(t,n){var r=!1,i=null,o=null,s=!1,a=function(){if(null==o||o.unsubscribe(),o=null,r){r=!1;var e=i;i=null,n.next(e)}s&&n.complete()},l=function(){o=null,s&&n.complete()};t.subscribe(or(n,function(t){r=!0,i=t,o||Hi(e(t)).subscribe(o=or(n,a,l))},function(){s=!0,(!r||!o||o.closed)&&n.complete()}))})}function uqe(e,t,n,r,i){return function(r,o){var s=n,a=t,l=0;r.subscribe(or(o,function(t){var n=l++;a=s?e(a,t,n):(s=!0,t),o.next(a)},i))}}function O7(e){return e<=0?function(){return o3}:ni(function(t,n){var r=0;t.subscribe(or(n,function(t){++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function dqe(e){return ke(function(){return e})}function fqe(e,t){return M_(function(t,n){return Hi(e(t,n)).pipe(O7(1),dqe(t))})}function hqe(e,t){void 0===t&&(t=YT);var n=Yd(e,t);return fqe(function(){return n})}function Qo(e,t){return void 0===t&&(t=Uf),e=e??pqe,ni(function(n,r){var i,o=!0;n.subscribe(or(r,function(n){var s=t(n);(o||!e(i,s))&&(o=!1,i=s,r.next(n))}))})}function pqe(e,t){return e===t}function mqe(e,t){return Qo(function(t,n){return t[e]===n[e]})}function gqe(e){return ni(function(t,n){try{t.subscribe(n)}finally{n.add(e)}})}function vqe(){return ni(function(e,t){var n,r=!1;e.subscribe(or(t,function(e){var i=n;n=e,r&&t.next([i,e]),r=!0}))})}function Oa(e,t){return ni(uqe(e,t,arguments.length>=2,!0))}function yqe(e){return $s(function(t,n){return e<=n})}function un(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=P_(e);return ni(function(t,r){(n?Ub(e,t,n):Ub(e,t)).subscribe(r)})}function Mt(e,t){return ni(function(n,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};n.subscribe(or(r,function(n){null==i||i.unsubscribe();var s=0,l=o++;Hi(e(n,l)).subscribe(i=or(r,function(e){return r.next(t?t(n,e,l,s++):e)},function(){i=null,a()}))},function(){s=!0,a()}))})}function bqe(){return Mt(Uf)}function _qe(e,t){return ni(function(n,r){var i=t;return Mt(function(t,n){return e(i,t,n)},function(e,t){return i=t,t})(n).subscribe(r),function(){i=null}})}function Sqe(e){return ni(function(t,n){Hi(e).subscribe(or(n,function(){return n.complete()},Nb)),!n.closed&&t.subscribe(n)})}function Eqe(e,t){return void 0===t&&(t=!1),ni(function(n,r){var i=0;n.subscribe(or(r,function(n){var o=e(n,i++);(o||t)&&r.next(n),!o&&r.complete()}))})}function wqe(e,t,n){var r=En(e)||t||n?{next:e,error:t,complete:n}:e;return r?ni(function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(or(t,function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)},function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()},function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)},function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)}))}):Uf}function M7(e,t){return ni(function(n,r){var i=t??{},o=i.leading,s=void 0===o||o,a=i.trailing,l=void 0!==a&&a,c=!1,u=null,d=null,h=!1,p=function(){null==d||d.unsubscribe(),d=null,l&&(v(),h&&r.complete())},f=function(){d=null,h&&r.complete()},m=function(t){return d=Hi(e(t)).subscribe(or(r,p,f))},v=function(){if(c){c=!1;var e=u;u=null,r.next(e),!h&&m(e)}};n.subscribe(or(r,function(e){c=!0,u=e,(!d||d.closed)&&(s?v():m(e))},function(){h=!0,(!(l&&c&&d)||d.closed)&&r.complete()}))})}function Cqe(e,t,n){void 0===t&&(t=YT);var r=Yd(e,t);return M7(function(){return r},n)}function cle(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=E8(e);return ni(function(t,r){for(var i=e.length,o=new Array(i),s=e.map(function(){return!1}),a=!1,l=function(t){Hi(e[t]).subscribe(or(r,function(e){o[t]=e,!a&&!s[t]&&(s[t]=!0,(a=s.every(Uf))&&(s=null))},Nb))},c=0;c<i;c++)l(c);t.subscribe(or(r,function(e){if(a){var t=ic([e],rc(o));r.next(n?n.apply(void 0,ic([],rc(t))):t)}}))})}function ct(e){const t=_.useCallback(t=>{const n=e.subscribe(t);return()=>n.unsubscribe()},[e]),n=_.useCallback(()=>e.value,[e]);return _.useSyncExternalStore(t,n)}class ri{constructor(e,t){this.defaultValue=t,this.setValue=e=>{this._value$.next(e),localStorage.setItem(this.key,JSON.stringify(e))},this.getValue=()=>this._value$.getValue(),this.key=`matrix-setting-${e}`;const n=localStorage.getItem(this.key);let r=t;if(null!==n)try{r=JSON.parse(n)}catch(t){M.warn(`Invalid value stored for setting ${e}: ${n}.`,t)}this._value$=new ms(r),this.value$=this._value$}}function Bn(e){return[ct(e.value$),e.setValue]}const lle=new ri("opt-in-analytics",null),XT=()=>{const e=Bn(lle);return Dt.instance.isEnabled()?e:[!1,null]},T8=new ri("developer-settings-tab",!1),ule=new ri("duplicate-tiles",0),dle=new ri("show-non-member-tiles",!1),R8=new ri("debug-tile-layout",!1),jb=new ri("show-connection-stats",!1),OK=new ri("audio-input",void 0),MK=new ri("audio-output",void 0),DK=new ri("video-input",void 0),fle=new ri("background-blur",!1),hle=new ri("hand-raised-show-timer",!1),ple=new ri("reactions-show",!0),I8=new ri("reactions-play-sound",!0),mle=new ri("sound-effect-volume",.5),gle=new ri("new-membership-manager",!0),k8=new ri("experimental-to-device-transport",!0),vle=new ri("mute-all-audio",!1),NK=new ri("always-show-self",!0),yle=new ri("always-show-iphone-earpiece",!1);var JT=(e=>(e[e.Guest=0]="Guest",e[e.Registered=1]="Registered",e))(JT||{});const Uc=class e{constructor(e){let t,n;this.posthog=e,this.enabled=!1,this.anonymity=0,this.platformSuperProperties={},this.registrationType=0,this.optInListener=null,this.sanitizeProperties=(e,t)=>(1==this.anonymity&&(e.$referrer=null,e.$referring_domain=null,e.$initial_referrer=null,e.$initial_referring_domain=null,e.$device_id=null),e.$current_url=e.$current_url.split("/").slice(0,3).join(""),e),this.eventCallEnded=new eVe,this.eventSignup=new nVe,this.eventCallStarted=new tVe,this.eventLogin=new rVe,this.eventMuteMicrophone=new iVe,this.eventMuteCamera=new sVe,this.eventUndecryptableToDevice=new oVe,this.eventQualitySurvey=new aVe,this.eventCallDisconnected=new cVe,this.eventCallConnectDuration=new lVe,t=Fr().posthogApiKey??void 0,n=Fr().posthogApiHost??void 0,t&&n?(this.posthog.init(t,{api_host:n,autocapture:!1,mask_all_text:!0,mask_all_element_attributes:!0,capture_pageview:!1,sanitize_properties:this.sanitizeProperties,respect_dnt:!0,advanced_disable_decide:!0}),this.enabled=!0):(M.info("Posthog is not enabled because there is no api key or no host given in the config"),this.enabled=!1)}static hasInstance(){return!!this.internalInstance}static get instance(){return this.internalInstance||(this.internalInstance=new e(PHe)),this.internalInstance}static resetInstance(){this.internalInstance=null}registerSuperProperties(e){this.enabled&&this.posthog.register(e)}static getPlatformProperties(){var e,t;return{appVersion:"embedded-v0.15.0",matrixBackend:Qe?"embedded":"jssdk",callBackend:"livekit",cryptoVersion:Qe||null==(t=null==(e=window.matrixclient)?void 0:e.getCrypto())?void 0:t.getVersion()}}capture(e,t,n){this.enabled&&this.posthog.capture(e,{...t},n)}isEnabled(){return this.enabled}setAnonymity(e){this.enabled&&(0==e||1==e)&&(this.posthog.reset(),this.updateSuperProperties()),this.anonymity=e}static getRandomAnalyticsId(){return[...crypto.getRandomValues(new Uint8Array(16))].map(e=>e.toString(16)).join("")}async identifyUser(e){if(2==this.anonymity&&this.enabled){let t=await this.getAnalyticsId();try{if(!t&&!Qe){const n=e();await this.setAccountAnalyticsId(n),t=await this.hashedEcAnalyticsId(n)}}catch(e){M.log("Unable to identify user for tracking"+(null==e?void 0:e.toString()))}t?this.posthog.identify(t):M.info("No analyticsID is available. Should not try to setup posthog")}}async getAnalyticsId(){const t=window.matrixclient;let n;if(Qe)n=Fr().posthogUserId;else{const r=await t.getAccountDataFromServer(e.ANALYTICS_EVENT_TYPE);n=(null==r?void 0:r.id)??null}return n?await this.hashedEcAnalyticsId(n):null}async hashedEcAnalyticsId(e){const t="ec"+e+window.matrixclient.getUserId(),n=await crypto.subtle.digest("sha-256",(new TextEncoder).encode(t)),r=new Int32Array(n);return Array.from(r).map(e=>Math.abs(e).toString(16).padStart(2,"0")).join("")}async setAccountAnalyticsId(t){if(!Qe){const n=window.matrixclient,r=await n.getAccountDataFromServer(e.ANALYTICS_EVENT_TYPE);await n.setAccountData(e.ANALYTICS_EVENT_TYPE,Object.assign({id:t},r))}}getAnonymity(){return this.anonymity}logout(){var e;this.enabled&&this.posthog.reset(),null==(e=this.optInListener)||e.unsubscribe(),this.optInListener=null,this.setAnonymity(0)}onLoginStatusChanged(){this.maybeIdentifyUser().catch(()=>M.log("Could not identify user on login status change"))}updateSuperProperties(){this.platformSuperProperties=e.getPlatformProperties(),this.registerSuperProperties({...this.platformSuperProperties,registrationType:0==this.registrationType?"Guest":"Registered"})}userRegisteredInThisSession(){return this.eventSignup.getSignupEndTime()>new Date(0)}async maybeIdentifyUser(){window.matrixclient&&(2===this.anonymity&&(this.setRegistrationType(window.matrixclient.isGuest()||window.passwordlessUser?0:1),this.identificationPromise=this.identifyUser(e.getRandomAnalyticsId),await this.identificationPromise,this.userRegisteredInThisSession()&&this.eventSignup.track()),0!==this.anonymity&&this.updateSuperProperties())}trackEvent({eventName:e,...t},n){const r=()=>{0==this.anonymity||1==this.anonymity||this.capture(e,t,n)};this.identificationPromise?this.identificationPromise.then(r,e=>{M.error("Failed to identify user for tracking",e)}):r()}startListeningToSettingsChanges(){this.optInListener??(this.optInListener=lle.value$.subscribe(e=>{this.setAnonymity(e?2:0),this.maybeIdentifyUser().catch(()=>M.log("Could not identify user"))}))}setRegistrationType(e){this.registrationType=e,0!=this.anonymity&&1!=this.anonymity&&this.updateSuperProperties()}};Uc.ANALYTICS_EVENT_TYPE="im.vector.analytics",Uc.internalInstance=null;let Dt=Uc;const Tqe=12e4;class Rqe{async forceFlush(){}onStart(e){try{switch(e.name){case"matrix.groupCallMembership":return void this.onGroupCallMembershipStart(e);case"matrix.groupCallMembership.summaryReport":return void this.onSummaryReportStart(e)}}catch(e){M.debug(e)}}onEnd(e){"matrix.groupCallMembership"!==e.name||this.onGroupCallMembershipEnd(e)}get prevCall(){const e=localStorage.getItem("matrix-prev-call");if(null===e)return null;try{return JSON.parse(e)}catch(t){return M.warn("Invalid prev call data",e,"error:",t),null}}set prevCall(e){localStorage.setItem("matrix-prev-call",JSON.stringify(e))}onGroupCallMembershipStart(e){const t=this.prevCall,n=e.attributes["matrix.confId"];if(null!==t&&n===t.callId){const n=mG(e.startTime)-t.hangupTs;n<=Tqe&&Dt.instance.trackEvent({eventName:"Rejoin",callId:t.callId,rejoinDuration:n})}}onGroupCallMembershipEnd(e){this.prevCall={callId:e.attributes["matrix.confId"],hangupTs:mG(e.endTime)}}onSummaryReportStart(e){const t=e.events.find(e=>"matrix.stats.summary"===e.name);if(void 0!==t){const n=t.attributes;if(n){const t=`${n["matrix.stats.summary.percentageReceivedMedia"]}`,r=`${n["matrix.stats.summary.percentageReceivedVideoMedia"]}`,i=`${n["matrix.stats.summary.percentageReceivedAudioMedia"]}`,o=`${n["matrix.stats.summary.maxJitter"]}`,s=`${n["matrix.stats.summary.maxPacketLoss"]}`,a=`${n["matrix.stats.summary.peerConnections"]}`,l=`${n["matrix.stats.summary.percentageConcealedAudio"]}`,c=`${n["matrix.stats.summary.opponentUsersInCall"]}`,u=`${n["matrix.stats.summary.opponentDevicesInCall"]}`,d=`${n["matrix.stats.summary.diffDevicesToPeerConnections"]}`,h=`${n["matrix.stats.summary.ratioPeerConnectionToDevices"]}`;Dt.instance.trackEvent({eventName:"MediaReceived",callId:e.attributes["matrix.confId"],mediaReceived:t,audioReceived:i,videoReceived:r,maxJitter:o,maxPacketLoss:s,peerConnections:a,percentageConcealedAudio:l,opponentUsersInCall:c,opponentDevicesInCall:u,diffDevicesToPeerConnections:d,ratioPeerConnectionToDevices:h},{send_instantly:!0})}}}async shutdown(){return Promise.resolve()}}const UK=e=>Object.entries(e).map(([e,t])=>({key:e,type:typeof t,value:t}));class Iqe{constructor(){this.spans=[]}async forceFlush(){}onStart(e){this.spans.push(e)}onEnd(){}dump(){const e=1e3*Date.now(),t=new Map;for(const e of this.spans){const n=e.spanContext().traceId;let r=t.get(n);void 0===r&&(r=[],t.set(n,r)),r.push(e)}const n="p1",r={[n]:{serviceName:"element-call",tags:[]},warnings:null};return JSON.stringify({total:0,limit:0,offset:0,errors:null,data:[...t.entries()].map(([t,n])=>({traceID:t,warnings:null,processes:r,spans:n.map(n=>{var r,i;const o=n.spanContext(),s=ux(n.startTime),a=-1===n.duration[0]?e-s:ux(n.duration);return{traceID:t,spanID:o.spanId,operationName:n.name,processID:"p1",warnings:null,startTime:s,duration:a,references:void 0===(null==(r=n.parentSpanContext)?void 0:r.spanId)?[]:[{refType:"CHILD_OF",traceID:t,spanID:null==(i=n.parentSpanContext)?void 0:i.spanId}],tags:UK(n.attributes),logs:n.events.map(e=>({timestamp:ux(e.time),fields:[...UK(e.attributes??{}),{key:"event",type:"string",value:e.name}]}))}})}))})}async shutdown(){}}const kqe="element-call";let gh;class QT{static globalInit(){(!gh||!1!==gh.isOtlpEnabled)&&(M.info("(Re)starting OpenTelemetry debug reporting"),null==gh||gh.dispose(),gh=new QT(void 0,ble()))}static get instance(){return gh}constructor(e,t){const n=[];e?(M.info("Enabling OTLP collector with URL "+e),this.otlpExporter=new J$e({url:e}),n.push(new n$e(this.otlpExporter))):M.info("OTLP collector disabled"),t&&(this.rageshakeProcessor=new Iqe,n.push(this.rageshakeProcessor)),n.push(new Rqe),this._provider=new tBe({resource:Gae({[Dae]:kqe}),spanProcessors:n}),sx.trace.setGlobalTracerProvider(this._provider),this._tracer=sx.trace.getTracer("my-element-call-otl-tracer")}dispose(){var e;sx.trace.disable(),null==(e=this._provider)||e.shutdown().catch(e=>{M.error("Failed to shutdown OpenTelemetry",e)})}get isOtlpEnabled(){return!!this.otlpExporter}get tracer(){return this._tracer}get provider(){return this._provider}}const jK=async e=>{const{gzip:t}=await nb(async()=>{const{gzip:e}=await import("./pako.esm-Bt8vjcgE.js");return{gzip:e}},[],import.meta.url),n=(new TextEncoder).encode(e);return new Blob([t(n)])};async function xqe(e,t){t.append("crypto_version",e.getVersion());const n=await e.getOwnDeviceKeys(),r=[`curve25519:${n.curve25519}`,`ed25519:${n.ed25519}`];t.append("device_keys",r.join(", "));const i=await e.getCrossSigningStatus();t.append("cross_signing_ready",String(await e.isCrossSigningReady())),t.append("cross_signing_key",await e.getCrossSigningKeyId()??"n/a"),t.append("cross_signing_privkey_in_secret_storage",String(i.privateKeysInSecretStorage)),t.append("cross_signing_master_privkey_cached",String(i.privateKeysCachedLocally.masterKey)),t.append("cross_signing_self_signing_privkey_cached",String(i.privateKeysCachedLocally.selfSigningKey)),t.append("cross_signing_user_signing_privkey_cached",String(i.privateKeysCachedLocally.userSigningKey))}async function Aqe(e,t,n){const r=e.secretStorage;n.append("secret_storage_ready",String(await t.isSecretStorageReady())),n.append("secret_storage_key_in_account",String(await r.hasKey())),n.append("session_backup_key_in_secret_storage",String(!!await e.isKeyBackupKeyStored()));const i=await t.getSessionBackupPrivateKey();n.append("session_backup_key_cached",String(!!i)),n.append("session_backup_key_well_formed",String(i instanceof Uint8Array))}function ble(){return Fr().rageshakeSubmitUrl??void 0}function ZT(e=ble){const{client:t}=Pp(),[{sending:n,sent:r,error:i},o]=_.useState({sending:!1,sent:!1,error:void 0});return{submitRageshake:_.useCallback(async r=>{const i=e();if(!i)throw new Error("No rageshake URL is configured");if(!n)try{o({sending:!0,sent:!1,error:void 0});let e="UNKNOWN";window.navigator&&window.navigator.userAgent&&(e=window.navigator.userAgent);let n="UNKNOWN";try{n=String(window.matchMedia("(pointer: coarse)").matches)}catch(e){M.warn("Could not get coarse pointer for rageshake submit.",e)}let s=r.rageshakeRequestId?`Rageshake ${r.rageshakeRequestId}`:"";r.description&&(s+=`: ${r.description}`);const a=new FormData;if(a.append("text",s??"User did not supply any additional text."),a.append("app","matrix-video-chat"),a.append("version","embedded-v0.15.0"),a.append("user_agent",e),a.append("installed_pwa","false"),a.append("touch_input",n),a.append("call_backend","livekit"),a.append("hostname",window.location.hostname),t){const e=t.getUserId(),n=t.getUser(e);a.append("display_name",(null==n?void 0:n.displayName)??""),a.append("user_id",t.credentials.userId??""),a.append("device_id",t.deviceId??""),r.roomId&&a.append("room_id",r.roomId);const i=t.getCrypto();i&&(await xqe(i,a),await Aqe(t,i,a))}if(r.label&&a.append("label",r.label),navigator.storage&&navigator.storage.persisted)try{a.append("storageManager_persisted",String(await navigator.storage.persisted()))}catch(e){M.warn("coulr not get navigator peristed storage",e)}else if(document.hasStorageAccess)try{a.append("storageManager_persisted",String(await document.hasStorageAccess()))}catch(e){M.warn("could not get storage access",e)}if(navigator.storage&&navigator.storage.estimate)try{const e=await navigator.storage.estimate();a.append("storageManager_quota",String(e.quota)),a.append("storageManager_usage",String(e.usage)),e.usageDetails&&Object.keys(e.usageDetails).forEach(t=>{a.append(`storageManager_usage_${t}`,String(e.usageDetails[t]))})}catch(e){M.warn("could not obatain storage estimate",e)}if(r.sendLogs){const e=await HUe();for(const t of e)a.append("compressed-log",await jK(t.lines),t.id);a.append("file",await jK(QT.instance.rageshakeProcessor.dump()),"traces.json.gz")}r.rageshakeRequestId&&a.append("group_call_rageshake_request_id",r.rageshakeRequestId);const l=await fetch(i,{method:"POST",body:a});if(200!==l.status)throw new Error(`Failed to submit feedback: receive HTTP ${l.status} ${l.statusText}`);o({sending:!1,sent:!0,error:void 0})}catch(e){o({sending:!1,sent:!1,error:e}),M.error(e)}},[t,n,e]),sending:n,sent:r,error:i,available:!!e()}}function Lqe(){const{client:e}=Pp();return _.useCallback((t,n)=>{e.sendEvent(t,"org.matrix.rageshake_request",{request_id:n}).catch(e=>{M.error("Failed to send org.matrix.rageshake_request event",e)})},[e])}function Pqe(e){const[t,n]=_.useState(!1),r=_.useCallback(()=>n(!1),[n]),{client:i}=Pp(),[o,s]=_.useState();return _.useEffect(()=>{if(!i)return;const t=t=>{"org.matrix.rageshake_request"===t.getType()&&e===t.getRoomId()&&i.getUserId()!==t.getSender()&&(s(t.getContent().request_id),n(!0))};return i.on(Le.Event,t),()=>{i.removeListener(Le.Event,t)}},[n,e,i]),{rageshakeRequestId:o??"",roomId:e,open:t,onDismiss:r}}const Oqe=({description:e})=>{var t;const{submitRageshake:n,sending:r,sent:i,error:o}=ZT(),{t:s}=Je(),a=_.useCallback(()=>{n({description:e,sendLogs:!0}).catch(e=>{M.error("Failed to send rageshake",e)})},[n,e]);if(null==(t=Zt.get().rageshake)||!t.submit_url)return null;let l=null;if(r)l=w.jsx("span",{children:s("rageshake_sending")});else if(i)l=w.jsx("div",{children:s("rageshake_sent")});else{let e=s("rageshake_send_logs");o&&(e=s("rageshake_button_error_caption")),l=w.jsx(Ft,{onClick:a,className:dG.wideButton,disabled:r,children:e})}return w.jsx("div",{className:dG.rageshakeControl,children:l})},Mqe="_error_17zfc_1",Dqe="_icon_17zfc_9",lE={error:Mqe,icon:Dqe},Nqe="_endCall_bwclo_8",Uqe={endCall:Nqe},_le=({muted:e,...t})=>{const{t:n}=Je(),r=e?Roe:$M,i=n(e?"unmute_microphone_button_label":"mute_microphone_button_label");return w.jsx(Fi,{label:i,children:w.jsx(Ft,{iconOnly:!0,Icon:r,kind:e?"primary":"secondary",...t})})},Sle=({muted:e,...t})=>{const{t:n}=Je(),r=e?GMe:zoe,i=n(e?"start_video_button_label":"stop_video_button_label");return w.jsx(Fi,{label:i,children:w.jsx(Ft,{iconOnly:!0,Icon:r,kind:e?"primary":"secondary",...t})})},jqe=({enabled:e,...t})=>{const{t:n}=Je(),r=n(e?"stop_screenshare_button_label":"screenshare_button_label");return w.jsx(Fi,{label:r,children:w.jsx(Ft,{iconOnly:!0,Icon:FMe,kind:e?"primary":"secondary",...t})})},Ele=({className:e,...t})=>{const{t:n}=Je();return w.jsx(Fi,{label:n("hangup_button_label"),children:w.jsx(Ft,{className:Ne(e,Uqe.endCall),iconOnly:!0,Icon:voe,destructive:!0,...t})})},wle=e=>{const{t}=Je();return w.jsx(Fi,{label:t("common.settings"),children:w.jsx(Ft,{iconOnly:!0,Icon:jMe,kind:"secondary",...e})})},Fqe="_external_jhjdf_8",$qe={external:Fqe};function Cle(e,t){return[See(e),Pee(e,{state:t})]}const il=({ref:e,to:t,state:n,...r})=>{const[i,o]=Cle(t,n);return w.jsx(yPe,{ref:e,...r,href:i,onClick:o})},zh=({ref:e,className:t,children:n,...r})=>w.jsx("a",{ref:e,className:Ne(t,$qe.external),target:"_blank",rel:"noreferrer noopener",...r,children:n}),x8=({ref:e,to:t,state:n,...r})=>{const[i,o]=Cle(t,n);return w.jsx(Ft,{as:"a",ref:e,...r,href:i,onClick:o})};function kw(e,t,n,r){_.useEffect(()=>{if(e)return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)},[e,t,n,r])}function Tle(e,t,n){_.useEffect(()=>(e.on(t,n),()=>{e.off(t,n)}),[e,t,n])}function dp(e,t,n){const r=_.useCallback(n=>(e.on(t,n),()=>{e.off(t,n)}),[e,t]);return _.useSyncExternalStore(r,n)}function A8(e){return dp(e,yi.MembershipsChanged,_.useCallback(()=>e.memberships,[e]))}const Rle=_.createContext(void 0),L8=()=>{const e=_.use(Rle);if(!e)throw new Error("useReactions must be used within a ReactionsProvider");return e},Bqe=({children:e,rtcSession:t,vm:n})=>{const r=A8(t),i=Zv(),o="valid"===(null==i?void 0:i.state)&&i.supportedFeatures.reactions,s=t.room,a=s.client.getUserId(),l=s.client.getDeviceId(),c=`${a}:${l}`,u=_.useMemo(()=>{var e;return null==(e=r.find(e=>e.sender===a&&e.deviceId===l))?void 0:e.eventId},[r,a,l]),d=ct(n.reactions$),h=_.useMemo(()=>void 0!==c?d[c]:void 0,[c,d]),p=ct(n.handsRaised$),f=_.useMemo(()=>void 0!==c?p[c]:void 0,[c,p]),m=_.useCallback(async()=>{if(!c)return;const e=null==f?void 0:f.reactionEventId;if(e)try{await s.client.redactEvent(t.room.roomId,e),M.debug("Redacted raise hand event")}catch(t){throw M.error("Failed to redact reaction event",e,t),t}else try{if(!u)throw new Error("Cannot find own membership event");const e=await s.client.sendEvent(t.room.roomId,ee.Reaction,{"m.relates_to":{rel_type:kn.Annotation,event_id:u,key:"🖐️"}});M.debug("Sent raise hand event",e.event_id)}catch(e){M.error("Failed to send raised hand",e)}},[u,c,f,t,s]),v=_.useCallback(async e=>{if(c&&!h){if(!u)throw new Error("Cannot find own membership event");await s.client.sendEvent(t.room.roomId,y8,{"m.relates_to":{rel_type:kn.Reference,event_id:u},emoji:e.emoji,name:e.name})}},[u,h,s,c,t]);return w.jsx(Rle,{value:{supportsReactions:o,toggleRaisedHand:m,sendReaction:v},children:e})},Hqe="_raisedButton_unw54_1",Vqe="_reactionPopupMenu_unw54_5",qqe="_reactionPopupMenuRoot_unw54_21",Gqe="_reactionPopupMenuModal_unw54_21",Kqe="_reactionsMenuSection_unw54_47",zqe="_reactionsMenu_unw54_47",Wqe="_reactionButton_unw54_81",Yqe="_verticalSeperator_unw54_91",Xqe="_alert_unw54_99",ja={raisedButton:Hqe,reactionPopupMenu:Vqe,reactionPopupMenuRoot:qqe,reactionPopupMenuModal:Gqe,reactionsMenuSection:Kqe,reactionsMenu:zqe,reactionButton:Wqe,verticalSeperator:Yqe,alert:Xqe};function FK(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function Jqe(...e){return t=>{let n=!1;const r=e.map(e=>{const r=FK(e,t);return!n&&"function"==typeof r&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():FK(e[t],null)}}}}function Qqe(e){const t=Zqe(e),n=_.forwardRef((e,n)=>{const{children:r,...i}=e,o=_.Children.toArray(r),s=o.find(tGe);if(s){const e=s.props.children,r=o.map(t=>t===s?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t);return w.jsx(t,{...i,ref:n,children:_.isValidElement(e)?_.cloneElement(e,void 0,r):null})}return w.jsx(t,{...i,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function Zqe(e){const t=_.forwardRef((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=rGe(n),i=nGe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Jqe(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var eGe=Symbol("radix.slottable");function tGe(e){return _.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===eGe}function nGe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{const t=o(...e);return i(...e),t}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function rGe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var iGe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],sGe=iGe.reduce((e,t)=>{const n=Qqe(`Primitive.${t}`),r=_.forwardRef((e,r)=>{const{asChild:i,...o}=e,s=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(s,{...o,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),oGe=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),aGe="VisuallyHidden",D7=_.forwardRef((e,t)=>w.jsx(sGe.span,{...e,ref:t,style:{...oGe,...e.style}}));D7.displayName=aGe;const cGe="_modal_lmgdq_8",lGe="_dialog_lmgdq_14",uGe="_content_lmgdq_21",dGe="_drawer_lmgdq_32",fGe="_close_lmgdq_59",hGe="_header_lmgdq_84",pGe="_body_lmgdq_114",mGe="_tabbed_lmgdq_129",gGe="_handle_lmgdq_133",Is={modal:cGe,dialog:lGe,content:uGe,drawer:dGe,close:fGe,header:hGe,body:pGe,tabbed:mGe,handle:gGe},vGe="_bg_197ap_8",yGe="_animate_197ap_23",bGe="_overlay_197ap_40",Hc={bg:vGe,animate:yGe,overlay:bGe},Lp=({title:e,hideHeader:t,children:n,className:r,classNameDrawer:i,classNameModal:o,open:s,onDismiss:a,tabbed:l,...c})=>{const{t:u}=Je(),d=DT("(hover: none) or (pointer: coarse)"),h=_.useCallback(e=>{e||null==a||a()},[a]);if(d)return w.jsx(Ds.Root,{open:s,onOpenChange:h,dismissible:void 0!==a,children:w.jsxs(Ds.Portal,{children:[w.jsx(Ds.Overlay,{className:Ne(Hc.bg)}),w.jsx(Ds.Content,{className:Ne(r,i,Hc.overlay,Is.modal,Is.drawer,{[Is.tabbed]:l}),role:"dialog","aria-describedby":void 0,...c,children:w.jsxs("div",{className:Is.content,children:[w.jsxs("div",{className:Is.header,children:[w.jsx("div",{className:Is.handle}),w.jsx(D7,{asChild:!0,children:w.jsx(Ds.Title,{children:e})})]}),w.jsx("div",{className:Is.body,children:n})]})})]})});{const i=w.jsx(wM,{asChild:!0,children:w.jsx(ml,{as:"h2",weight:"semibold",size:"md",children:e})}),d=w.jsxs("div",{className:Is.header,children:[i,void 0!==a&&w.jsx(mse,{className:Is.close,"data-testid":"modal_close","aria-label":u("action.close"),children:w.jsx(yT,{width:20,height:20})})]});return w.jsx(bM,{open:s,onOpenChange:h,children:w.jsxs(_M,{children:[w.jsx(SM,{className:Ne(Hc.bg,Hc.animate)}),w.jsx(EM,{asChild:!0,"aria-describedby":void 0,role:"dialog",...c,children:w.jsx(Ise,{className:Ne(r,o,Hc.overlay,Hc.animate,Is.modal,Is.dialog,{[Is.tabbed]:l}),children:w.jsxs("div",{className:Is.content,children:[t?null:d,t?w.jsx(D7,{asChild:!0,children:i}):null,w.jsx("div",{className:Is.body,children:n})]})})})]})})}},_Ge=({raised:e,open:t,...n})=>{const{t:r}=Je();return w.jsx(Fi,{label:r("common.reactions"),children:w.jsx(Ft,{className:Ne(e&&ja.raisedButton),"aria-expanded":t,"aria-haspopup":!0,kind:e||t?"primary":"secondary",iconOnly:!0,Icon:e?Moe:UMe,...n})})};function SGe({sendReaction:e,toggleRaisedHand:t,isHandRaised:n,canReact:r,errorText:i}){const{t:o}=Je(),[s,a]=_.useState(!1),l=_.useMemo(()=>s?Db:Db.slice(0,5),[s]),c=o(n?"action.lower_hand":"action.raise_hand");return w.jsxs(w.Fragment,{children:[i&&w.jsx(cxe,{className:ja.alert,type:"critical",title:o("error.generic"),children:i}),w.jsxs("div",{className:ja.reactionPopupMenu,children:[w.jsx("section",{className:ja.handRaiseSection,children:w.jsx(Fi,{label:c,caption:"H",children:w.jsx(Ft,{kind:n?"primary":"secondary","aria-keyshortcuts":"H","aria-pressed":n,"aria-label":c,onClick:()=>t(),iconOnly:!0,Icon:Moe})})}),w.jsx("div",{className:ja.verticalSeperator}),w.jsx("section",{className:ja.reactionsMenuSection,children:w.jsx("menu",{className:Ne(s&&ja.reactionsMenuExpanded,ja.reactionsMenu),children:l.map((t,n)=>w.jsx("li",{children:w.jsx(Fi,{label:t.name,caption:n<5?(n+1).toString():void 0,children:w.jsx(Ft,{kind:"secondary",className:ja.reactionButton,disabled:!r,onClick:()=>e(t),"aria-keyshortcuts":n<5?(n+1).toString():void 0,children:t.emoji})})},t.name))})}),w.jsx("section",{style:{marginLeft:"var(--cpd-separator-spacing)"},children:w.jsx(Fi,{label:o(s?"action.show_less":"action.show_more"),children:w.jsx(Ft,{iconOnly:!0,"aria-label":o(s?"action.show_less":"action.show_more"),Icon:s?IMe:JOe,kind:"tertiary",onClick:()=>a(!s)})})})]})]})}function EGe({identifier:e,vm:t,...n}){const{t:r}=Je(),{toggleRaisedHand:i,sendReaction:o}=L8(),[s,a]=_.useState(!1),[l,c]=_.useState(!1),[u,d]=_.useState(),h=!!ct(t.handsRaised$)[e],p=!ct(t.reactions$)[e];_.useEffect(()=>{d(void 0)},[l]);const f=_.useCallback(async e=>{try{a(!0),await o(e),d(void 0),c(!1)}catch(e){d(e instanceof Error?e.message:"Unknown error"),M.error("Failed to send reaction",e)}finally{a(!1)}},[o]),m=_.useCallback(()=>{(async()=>{try{a(!0),await i(),c(!1)}catch(e){d(e instanceof Error?e.message:"Unknown error"),M.error("Failed to raise/lower hand",e)}finally{a(!1)}})()},[i]);return w.jsxs(w.Fragment,{children:[w.jsx(_Ge,{disabled:s,onClick:()=>c(e=>!e),raised:!!h,open:l,...n}),w.jsx(Lp,{open:l,title:r("action.pick_reaction"),hideHeader:!0,classNameModal:ja.reactionPopupMenuModal,className:ja.reactionPopupMenuRoot,onDismiss:()=>c(!1),children:w.jsx(SGe,{errorText:u,isHandRaised:!!h,canReact:!s&&!!p,sendReaction:e=>{f(e)},toggleRaisedHand:m})})]})}const Fb=({Icon:e,title:t,rageshake:n,fatal:r,children:i,widget:o})=>{const{t:s}=Je(),{confineToRoom:a}=Xs(),l=_.useCallback(()=>{window.location.href="/"},[]);return w.jsxs("div",{className:lE.error,children:[w.jsx(Zse,{className:lE.icon,children:w.jsx(e,{"aria-hidden":!0})}),w.jsx(ml,{as:"h1",weight:"semibold",size:"md",children:t}),i,n&&w.jsx(Oqe,{description:`***Error View***: ${t}`}),o?w.jsx(({widget:e})=>w.jsx(Ft,{kind:"primary",onClick:()=>{e.api.transport.send(Si.Close,{}).catch(e=>{M.error("Failed to send close action",e)}).finally(()=>{e.api.transport.stop()})},children:s("action.close")}),{widget:o}):!a&&w.jsx(()=>r||"/"===location.pathname?w.jsx(Ft,{kind:"tertiary",className:lE.homeLink,onClick:l,children:s("return_home_button")}):w.jsx(x8,{kind:"tertiary",className:lE.homeLink,to:"/",children:s("return_home_button")}),{})]})};class Ile extends Error{constructor(e,t){super(e),this.richMessage=t}}const wGe=()=>{const{t:e}=Je();return w.jsx(Fb,{widget:Qe,Icon:Poe,title:e("error.open_elsewhere"),children:w.jsx("p",{children:e("error.open_elsewhere_description",{brand:"Element Call"})})})};class CGe extends Ile{constructor(){super("App opened in another tab",w.jsx(wGe,{}))}}const Ug=({className:e,children:t})=>{const{header:n}=Xs();return w.jsxs("div",{className:Ne(X6.page,e),children:["standard"===n&&w.jsxs(Bu,{children:[w.jsx(Df,{children:w.jsx(cp,{})}),w.jsx(Nf,{})]}),w.jsx("div",{className:X6.container,children:w.jsx("div",{className:X6.content,children:t})})]})},$b=({error:e,widget:t})=>{const{t:n}=Je();return _.useEffect(()=>{M.error(e),hT(e)},[e]),w.jsx(Ug,{children:e instanceof Ile?e.richMessage:w.jsx(Fb,{widget:t,Icon:vT,title:n("error.generic"),rageshake:!0,fatal:!0,children:w.jsx("p",{children:n("error.generic_description")})})})},eR=()=>{const{t:e}=Je();return w.jsx(Ug,{children:w.jsx("h1",{children:e("common.loading")})})},P8=_.createContext(void 0);P8.Provider;const Zv=()=>_.use(P8);function Pp(){var e;let t,n;const r=Zv();return"valid"===(null==r?void 0:r.state)&&(t=null==(e=r.authenticated)?void 0:e.client,n=r.setClient),{client:t,setClient:n}}function O8(){var e,t,n;const r=Zv();let i,o,s,a,l=!1,c=!0,u=!1;return"valid"===(null==r?void 0:r.state)?(i=null==(e=r.authenticated)?void 0:e.client,o=r.setClient,l=(null==(t=r.authenticated)?void 0:t.isPasswordlessUser)??!1,c=!1,u=void 0!==i,a=null==(n=r.authenticated)?void 0:n.logout):"error"===(null==r?void 0:r.state)&&(s=r.error,c=!1),{client:i,setClient:o,passwordlessUser:l,loading:c,authenticated:u,logout:a,error:s}}const uE="BroadcastChannel"in window?new BroadcastChannel("load"):null,TGe=({children:e})=>{const t=fl(),[n,r]=_.useState(void 0),i=_.useRef(!1);_.useEffect(()=>{i.current||(i.current=!0,RGe().then(e=>{r(e),Dt.instance.isEnabled()&&Dt.instance.startListeningToSettingsChanges()}).catch(e=>M.error(e)).finally(()=>i.current=!1))},[]);const o=_.useCallback(async e=>{const t=xle();null==n||!n.client||!t||(await n.client.setPassword({type:"m.login.password",identifier:{type:"m.id.user",user:t.user_id},user:t.user_id,password:t.tempPassword},e),$K({...t,passwordlessUser:!1}),r({...n,passwordlessUser:!1}))},[n]),s=_.useCallback((e,t)=>{const i=null==n?void 0:n.client;i&&i!==e&&i.stopClient(),$K(t),r({widgetApi:null,client:e,passwordlessUser:t.passwordlessUser}),Dt.instance.isEnabled()&&Dt.instance.startListeningToSettingsChanges()},[null==n?void 0:n.client]),a=_.useCallback(async()=>{const e=null==n?void 0:n.client;e&&(await e.logout(!0),await e.clearStores(),kle(),r(null),await t("/"),Dt.instance.logout(),Dt.instance.setRegistrationType(JT.Guest))},[t,null==n?void 0:n.client]);_.useEffect(()=>{Qe||null==uE||uE.postMessage({})},[]);const[l,c]=_.useState(void 0);kw(uE,"message",_.useCallback(()=>{null==n||n.client.stopClient(),c(new CGe)},[null==n?void 0:n.client,c]));const[u,d]=_.useState(!1),[h,p]=_.useState(!1),[f,m]=_.useState(!1),v=_.useMemo(()=>l?{state:"error",error:l}:void 0===n?void 0:{state:"valid",authenticated:null===n?void 0:{client:n.client,isPasswordlessUser:n.passwordlessUser,changePassword:o,logout:a},setClient:s,disconnected:u,supportedFeatures:{reactions:h,thumbnails:f}},[l,o,n,a,s,u,h,f]),g=_.useCallback((e,t,n)=>{d(IGe(e,n))},[]);return _.useEffect(()=>{if(n){if(window.matrixclient=n.client,window.passwordlessUser=n.passwordlessUser,Dt.hasInstance()&&Dt.instance.onLoginStatusChanged(),n.client&&n.client.on(Le.Sync,g),n.widgetApi){m(!1);const e=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.reaction"),t=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.room.redaction"),r=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.reaction"),i=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.room.redaction");e&&r&&t&&i?p(!0):(M.warn("Widget does not support reactions"),p(!1))}else p(!0),m(!0);return()=>{n.client&&n.client.removeListener(Le.Sync,g)}}},[n,g]),l?w.jsx($b,{widget:Qe,error:l}):w.jsx(P8,{value:v,children:e})};async function RGe(){if(Qe){M.log("Using a matryoshka client");const e=await Qe.client;return{widgetApi:Qe.api,client:e,passwordlessUser:!1}}{const{initSPA:e}=await nb(async()=>{const{initSPA:e}=await import("./spa-KBbSveuh.js");return{initSPA:e}},[],import.meta.url);return e(xle,kle)}}const kle=()=>localStorage.removeItem("matrix-auth-store"),$K=e=>localStorage.setItem("matrix-auth-store",JSON.stringify(e)),xle=()=>{const e=localStorage.getItem("matrix-auth-store");if(e)return JSON.parse(e)},IGe=(e,t)=>{var n;return"ERROR"===e&&"ConnectionError"===(null==(n=null==t?void 0:t.error)?void 0:n.name)};function D_(e){const[{success:t,loading:n,displayName:r,avatarUrl:i,error:o},s]=_.useState(()=>{let t;return e&&(t=e.getUser(e.getUserId())??void 0),{success:!1,loading:!1,displayName:null==t?void 0:t.rawDisplayName,avatarUrl:null==t?void 0:t.avatarUrl,error:void 0}});_.useEffect(()=>{const t=(e,{displayName:t,avatarUrl:n})=>{s({success:!1,loading:!1,displayName:t,avatarUrl:n,error:void 0})};let n;if(e){const r=e.getUserId();n=e.getUser(r),null==n||n.on(Oi.DisplayName,t),null==n||n.on(Oi.AvatarUrl,t)}return()=>{n&&(n.removeListener(Oi.DisplayName,t),n.removeListener(Oi.AvatarUrl,t))}},[e]);return{loading:n,error:o,displayName:r,avatarUrl:i,saveProfile:_.useCallback(async({displayName:t,avatar:n,removeAvatar:r})=>{if(e){s(e=>({...e,loading:!0,error:void 0,success:!1}));try{let i;await e.setDisplayName(t),r?await e.setAvatarUrl(""):n&&(({content_uri:i}=await e.uploadContent(n)),await e.setAvatarUrl(i)),s(e=>({...e,displayName:t,avatarUrl:r?void 0:i??e.avatarUrl,loading:!1,success:!0}))}catch(e){s(t=>({...t,loading:!1,error:e instanceof Error?e:Error(e),success:!1}))}}else M.error("Client not initialized before calling saveProfile")},[e]),success:t}}const kGe="_settingsModal_1dkeq_8",xGe="_volumeSlider_1dkeq_20",BK={settingsModal:kGe,volumeSlider:xGe},AGe="_tabContainer_1nnp9_8",LGe="_tabList_1nnp9_14",HK={tabContainer:AGe,tabList:LGe};function PGe({label:e,tab:t,onTabChange:n,tabs:r}){const i=_.useId();return w.jsxs("div",{className:HK.tabContainer,children:[w.jsx(KOe,{role:"tablist","aria-label":e,className:HK.tabList,children:r.map(({key:e,name:r})=>w.jsx(XOe,{"aria-controls":`${i}[${e}]`,onClick:()=>n(e),active:e===t,children:r},e))}),r.map(({key:e,content:n})=>w.jsx("div",{id:`${i}[${e}]`,style:{display:e===t?void 0:"none"},children:n},e))]})}const OGe="_fieldRow_iwncy_8",MGe="_field_iwncy_8",DGe="_rightAlign_iwncy_21",NGe="_inputField_iwncy_33",UGe="_disabled_iwncy_52",jGe="_prefix_iwncy_110",FGe="_checkboxField_iwncy_131",$Ge="_checkbox_iwncy_131",BGe="_description_iwncy_168",HGe="_errorMessage_iwncy_197",VGe="_noLabel_iwncy_210",Jo={fieldRow:OGe,field:MGe,rightAlign:DGe,inputField:NGe,disabled:UGe,prefix:jGe,checkboxField:FGe,checkbox:$Ge,description:BGe,errorMessage:HGe,noLabel:VGe},qGe=(e,t)=>_.createElement("svg",{fill:"none",height:24,stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:24,xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{d:"m20 6-11 11-5-5"})),GGe=_.forwardRef(qGe);class Ale extends Error{constructor(e,t){super(t(e,{lng:"en"})),this.translatedMessage=t(e)}}class KGe extends Ale{}const VK=(e,t)=>new KGe(e,t);function St({children:e,rightAlign:t,className:n}){return w.jsx("div",{className:Ne(Jo.fieldRow,{[Jo.rightAlign]:t},n),children:e})}function zGe({children:e,className:t}){return w.jsx("div",{className:Ne(Jo.field,t),children:e})}const Sn=({ref:e,id:t,label:n,className:r,type:i,checked:o,prefix:s,suffix:a,description:l,disabled:c,min:u,...d})=>{const h=_.useId();return w.jsxs(zGe,{className:Ne("checkbox"===i?Jo.checkboxField:Jo.inputField,{[Jo.prefix]:!!s,[Jo.disabled]:c},r),children:[s&&w.jsx("span",{children:s}),"textarea"===i?w.jsx("textarea",{id:t,ref:e,disabled:c,"aria-describedby":h,...d}):w.jsx("input",{id:t,ref:e,type:i,checked:o,disabled:c,"aria-describedby":h,min:u,...d}),w.jsxs("label",{htmlFor:t,children:["checkbox"===i&&w.jsx("div",{className:Jo.checkbox,children:w.jsx(GGe,{})}),n]}),a&&w.jsx("span",{children:a}),l&&w.jsx("p",{id:h,className:n?Jo.description:Ne(Jo.description,Jo.noLabel),children:l})]})};Sn.displayName="InputField";const jf=({error:e})=>w.jsx("p",{className:Jo.errorMessage,children:e instanceof Ale?e.translatedMessage:e.message}),WGe="_avatarInputField_1ep5q_8",YGe="_avatar_1ep5q_8",XGe="_fileInput_1ep5q_17",JGe="_edit_1ep5q_21",dE={avatarInputField:WGe,avatar:YGe,fileInput:XGe,edit:JGe},Lle=({id:e,label:t,className:n,avatarUrl:r,userId:i,displayName:o,onRemoveAvatar:s,...a})=>{const{t:l}=Je(),[c,u]=_.useState(!1),[d,h]=_.useState(void 0),[p,f]=_.useState(!1),m=_.useRef(null);_.useEffect(()=>{const e=m.current,t=e=>{const t=e;t.target.files&&t.target.files.length>0?(h(URL.createObjectURL(t.target.files[0])),u(!1)):h(void 0)};return e.addEventListener("change",t),()=>{null==e||e.removeEventListener("change",t)}});const v=_.useCallback(()=>{m.current.click()},[m]),g=_.useCallback(()=>{u(!0),s()},[s]);return w.jsxs("div",{className:Ne(dE.avatarInputField,n),children:[w.jsx(Qv,{id:i,className:dE.avatar,name:o,size:Jv.XL,src:c?void 0:d||r}),w.jsx("input",{id:e,accept:"image/*",ref:m,type:"file",className:dE.fileInput,role:"button","aria-label":t,...a}),w.jsx("div",{className:dE.edit,children:!r&&!d||c?w.jsx(Ft,{type:"button",iconOnly:!0,Icon:jq,kind:"tertiary",size:"sm","aria-label":l("action.edit"),onClick:v}):w.jsxs(xM,{title:l("action.edit"),showTitle:!1,open:p,onOpenChange:f,trigger:w.jsx(Ft,{iconOnly:!0,Icon:jq,kind:"tertiary",size:"sm","aria-label":l("action.edit")}),children:[w.jsx(fv,{Icon:$Me,label:l("action.upload_file"),onSelect:v}),w.jsx(fv,{Icon:kMe,label:l("action.remove"),kind:"critical",onSelect:g})]})})]})};Lle.displayName="AvatarInputField";const QGe="_content_gj715_8",ZGe="_avatarFieldRow_gj715_15",qK={content:QGe,avatarFieldRow:ZGe},eKe=({client:e})=>{const{t}=Je(),{error:n,displayName:r,avatarUrl:i,saveProfile:o}=D_(e),s=_.useMemo(()=>e.getUserId(),[e]),a=_.useRef(null),l=_.useRef(!1),c=_.useCallback(()=>{l.current=!0},[]),u=_.useRef(!1),d=_.useCallback(()=>{u.current=!0,l.current=!0},[]);return _.useEffect(()=>{const e=a.current;return()=>{if(l.current){const t=new FormData(e),n=t.get("displayName"),r=t.get("avatar"),i="string"==typeof r?r.length:(null==r?void 0:r.size)??0,s="string"==typeof n?n:(null==n?void 0:n.name)??null;if(!s)return;o({displayName:s,avatar:r&&i>0?r:void 0,removeAvatar:u.current&&(!r||0===i)}).catch(e=>{M.error("Failed to save profile",e)})}}},[o]),w.jsxs("form",{onChange:c,ref:a,className:qK.content,children:[w.jsx(St,{className:qK.avatarFieldRow,children:s&&r&&w.jsx(Lle,{id:"avatar",name:"avatar",label:t("common.avatar"),avatarUrl:i,userId:s,displayName:r,onRemoveAvatar:d})}),w.jsx(St,{children:w.jsx(Sn,{id:"userId",name:"userId",label:t("common.username"),type:"text",disabled:!0,value:e.getUserId()})}),w.jsx(St,{children:w.jsx(Sn,{id:"displayName",name:"displayName",label:t("common.display_name"),type:"text",required:!0,autoComplete:"off",placeholder:t("common.display_name"),defaultValue:r,"data-testid":"profile_displayname"})}),n&&w.jsx(St,{children:w.jsx(jf,{error:n})})]})},tKe="_feedback_19yh9_8",Ple={feedback:tKe},Ole=()=>w.jsxs(Vs,{i18nKey:"analytics_notice",children:["By participating in this beta, you consent to the collection of anonymous data, which we use to improve the product. You can find more information about which data we track in our"," ",w.jsx(zh,{href:"https://element.io/privacy",children:"Privacy Policy"})," ","and our"," ",w.jsx(zh,{href:"https://element.io/cookie-policy",children:"Cookie Policy"}),"."]}),nKe=({roomId:e})=>{const{t}=Je(),{submitRageshake:n,sending:r,sent:i,error:o,available:s}=ZT(),a=Lqe(),l=_.useCallback(t=>{t.preventDefault();const r=new FormData(t.target),i=r.get("description"),o="string"==typeof i?i:"",s=!!r.get("sendLogs"),l=Eo(16);n({description:o,sendLogs:s,rageshakeRequestId:l,roomId:e}).catch(e=>{M.error("Failed to send feedback rageshake",e)}),e&&s&&a(e,l)},[n,e,a]);XT();const c=s?w.jsxs(w.Fragment,{children:[w.jsx("h4",{children:t("settings.feedback_tab_h4")}),w.jsx(on,{children:t("settings.feedback_tab_body")}),w.jsxs("form",{onSubmit:l,children:[w.jsx(St,{children:w.jsx(Sn,{className:Ple.feedback,id:"description",name:"description",label:t("settings.feedback_tab_description_label"),placeholder:t("settings.feedback_tab_description_label"),type:"textarea",disabled:r||i})}),!i&&w.jsxs(St,{children:[w.jsx(Sn,{id:"sendLogs",name:"sendLogs",label:t("settings.feedback_tab_send_logs_label"),type:"checkbox",defaultChecked:!0}),w.jsx(Ft,{type:"submit",disabled:r,children:t(r?"submitting":"action.submit")})]}),w.jsxs(St,{children:[o&&w.jsx(jf,{error:o}),i&&w.jsx(on,{children:t("settings.feedback_tab_thank_you")})]})]})]}):null;return w.jsxs("div",{children:[null,c]})};var GK,xw={exports:{}},rKe=xw.exports;function iKe(){return GK||(GK=1,t=rKe,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return c??a??s},d.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=f(o.getLevel())),l.call(d),o===d)for(var e in i)i[e].rebuild()},s=f(o?o.getLevel():"WARN");var m=p();null!=m&&(c=f(m)),l.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},(e=xw).exports?e.exports=n():t.log=n()),xw.exports;var e,t,n}var sKe=iKe();const oKe=ac(sKe);var aKe=(e,t,n)=>new Promise((r,i)=>{var o=e=>{try{a(n.next(e))}catch(e){i(e)}},s=e=>{try{a(n.throw(e))}catch(e){i(e)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())});function cKe(e){return!(typeof e>"u")&&(lKe(e)||uKe(e))}function lKe(e){var t;return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&typeof(null==(t=e.publication)?void 0:t.track)<"u")}function uKe(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&typeof e.publication<"u")}function dKe(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&typeof e.publication>"u")}function fKe(e){if("string"==typeof e||"number"==typeof e)return`${e}`;if(dKe(e))return`${e.participant.identity}_${e.source}_placeholder`;if(cKe(e))return`${e.participant.identity}_${e.publication.source}_${e.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${e}`)}var hKe=[ue.ConnectionStateChanged,ue.RoomMetadataChanged,ue.ActiveSpeakersChanged,ue.ConnectionQualityChanged,ue.ParticipantConnected,ue.ParticipantDisconnected,ue.ParticipantPermissionsChanged,ue.ParticipantMetadataChanged,ue.ParticipantNameChanged,ue.ParticipantAttributesChanged,ue.TrackMuted,ue.TrackUnmuted,ue.TrackPublished,ue.TrackUnpublished,ue.TrackStreamStateChanged,ue.TrackSubscriptionFailed,ue.TrackSubscriptionPermissionChanged,ue.TrackSubscriptionStatusChanged],pKe=[...hKe,ue.LocalTrackPublished,ue.LocalTrackUnpublished];ae.TrackPublished,ae.TrackUnpublished,ae.TrackMuted,ae.TrackUnmuted,ae.TrackStreamStateChanged,ae.TrackSubscribed,ae.TrackUnsubscribed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionFailed,ae.LocalTrackPublished,ae.LocalTrackUnpublished;var mKe=[ae.ConnectionQualityChanged,ae.IsSpeakingChanged,ae.ParticipantMetadataChanged,ae.ParticipantPermissionsChanged,ae.TrackMuted,ae.TrackUnmuted,ae.TrackPublished,ae.TrackUnpublished,ae.TrackStreamStateChanged,ae.TrackSubscriptionFailed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionStatusChanged];ae.LocalTrackPublished,ae.LocalTrackUnpublished;var gKe=oKe.getLogger("lk-components-js");function vKe(e,...t){return new qn(n=>{const r=()=>{n.next(e)};return t.forEach(t=>{e.on(t,r)}),()=>{t.forEach(t=>{e.off(t,r)})}}).pipe(un(e))}function yKe(e,t){return new qn(n=>{const r=(...e)=>{n.next(e)};return e.on(t,r),()=>{e.off(t,r)}})}function KK(e,t,n=!0){return Ub(new qn(r=>{Ru.getLocalDevices(e,n).then(e=>{r.next(e),r.complete()}).catch(e=>{null==t||t(e),r.next([]),r.complete()})}),new qn(r=>{var i;const o=()=>aKe(this,null,function*(){try{const t=yield Ru.getLocalDevices(e,n);r.next(t)}catch(e){null==t||t(e)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");null==(i=null==navigator?void 0:navigator.mediaDevices)||i.addEventListener("devicechange",o)}return()=>{var e;null==(e=null==navigator?void 0:navigator.mediaDevices)||e.removeEventListener("devicechange",o)}}))}function M8(e,...t){return new qn(n=>{const r=()=>{n.next(e)};return t.forEach(t=>{e.on(t,r)}),()=>{t.forEach(t=>{e.off(t,r)})}}).pipe(un(e))}function D8(e){return M8(e,ae.TrackMuted,ae.TrackUnmuted,ae.ParticipantPermissionsChanged,ae.TrackPublished,ae.TrackUnpublished,ae.LocalTrackPublished,ae.LocalTrackUnpublished,ae.MediaDevicesError,ae.TrackSubscriptionStatusChanged).pipe(ke(e=>{const{isMicrophoneEnabled:t,isCameraEnabled:n,isScreenShareEnabled:r}=e,i=e.getTrackPublication(he.Source.Microphone);return{isCameraEnabled:n,isMicrophoneEnabled:t,isScreenShareEnabled:r,cameraTrack:e.getTrackPublication(he.Source.Camera),microphoneTrack:i,participant:e}}))}function bKe(e,t={}){var n;let r;const i=new qn(e=>(r=e,()=>s.unsubscribe())).pipe(un(Array.from(e.remoteParticipants.values()))),o=null!=(n=t.additionalRoomEvents)?n:pKe,s=vKe(e,...Array.from(new Set([ue.ParticipantConnected,ue.ParticipantDisconnected,ue.ConnectionStateChanged,...o]))).subscribe(e=>null==r?void 0:r.next(Array.from(e.remoteParticipants.values())));return e.remoteParticipants.size>0&&(null==r||r.next(Array.from(e.remoteParticipants.values()))),i}gKe.setDefaultLevel("WARN");const eg=new Zr,Mle=new Zr,Dle=new Zr,N7=new Zr;let zK=!1;const Nle=()=>{var e,t;zK||(zK=!0,null==(t=(e=window.controls).onAudioPlaybackStarted)||t.call(e))};window.controls={canEnterPip:()=>eg.observed,enablePip(){if(!eg.observed)throw new Error("No call is running");eg.next(!0)},disablePip(){if(!eg.observed)throw new Error("No call is running");eg.next(!1)},setAvailableAudioDevices(e){M.info("setAvailableAudioDevices called from native:",e),Mle.next(e)},setAudioDevice(e){M.info("setAudioDevice called from native",e),Dle.next(e)},setAudioEnabled(e){if(M.info("setAudioEnabled called from native:",e),!N7.observed)throw new Error("Output controls are disabled. No setAudioEnabled$ observer");N7.next(e)},setOutputEnabled(e){this.setAudioEnabled(e)},setAvailableOutputDevices(e){this.setAvailableAudioDevices(e)},setOutputDevice(e){this.setAudioDevice(e)}};const a3=Symbol("nothing");function _Ke(e){return t=>JVe(()=>{let n=a3;return t.pipe(wqe(e=>n=e),gqe(()=>{n!==a3&&e(n)}))})}function U7(e,t){return n=>n.pipe(Oa(t,e),un(e))}const WK=Symbol("switch");function SKe(e,t){return n=>Ub(n.pipe(ke((t,n)=>e(t,n)?WK:t),Eqe(e=>e!==WK)),t)}function Aw(e){let t=a3;if(e.subscribe(e=>t=e).unsubscribe(),t===a3)throw new Error("Not a state Observable");return t}function YK(...e){return ln(e,(...e)=>e.every(e=>e))}function B0(e){return t=>t.pipe(cle(e),ale(([,t])=>t?e.pipe($s(e=>!e)):Ot(null)),ke(([e])=>e))}function EKe(e){return new ms(e)}const XK="earpiece-id",Ule="ios"===tc?EKe(!0):yle.value$;function tR(e,t,n,r){const i=e=>r.error("Error creating MediaDeviceObserver",e),o=KK(e,i,!1),s=KK(e,i,!0);return n.behavior(t.pipe(Mt(e=>e?o.pipe(SKe((e,t)=>0===t&&e.every(e=>!e.label),s)):o)),[])}function N8(e){return new Map(e.map((e,t)=>[e.deviceId,e.label?{type:"name",name:e.label}:{type:"number",number:t+1}]))}function U8(e,t){return ln([e,t],(e,t)=>{if(e.size)return void 0!==t&&e.has(t)||1===e.size&&e.has("")?t:e.keys().next().value})}class wKe{constructor(e,t){this.usingNames$=e,this.scope=t,this.logger=M.getChild("[MediaDevices AudioInput]"),this.availableRaw$=tR("audioinput",this.usingNames$,this.scope,this.logger),this.available$=this.scope.behavior(this.availableRaw$.pipe(ke(N8))),this.selected$=this.scope.behavior(U8(this.available$,OK.value$).pipe(ke(e=>void 0===e?void 0:{id:e,hardwareDeviceChange$:this.availableRaw$.pipe(ke(t=>{var n;return null==(n=t.find(t=>t.deviceId===e))?void 0:n.groupId}),vqe(),$s(([e,t])=>e!==t),ke(()=>{}))}))),this.available$.subscribe(e=>{this.logger.info("[audio-input] available devices:",e)})}select(e){OK.setValue(e)}}class CKe{constructor(e,t){this.usingNames$=e,this.scope=t,this.logger=M.getChild("[MediaDevices AudioOutput]"),this.available$=this.scope.behavior(tR("audiooutput",this.usingNames$,this.scope,this.logger).pipe(ke(e=>{var t;let n=N8(e);return n.size&&!n.has("")&&!n.has("default")&&n.set("",{type:"default",name:(null==(t=e[0])?void 0:t.label)||null}),!!window.GestureEvent&&(n=new Map),n}))),this.selected$=this.scope.behavior(U8(this.available$,MK.value$).pipe(ke(e=>void 0===e?void 0:{id:e,virtualEarpiece:!1}))),this.available$.subscribe(e=>{this.logger.info("[audio-output] available devices:",e)})}select(e){MK.setValue(e)}}class TKe{constructor(e,t){this.usingNames$=e,this.scope=t,this.logger=M.getChild("[MediaDevices ControlledAudioOutput]"),this.availableRaw$=tR("audiooutput",this.usingNames$,this.scope,this.logger),this.available$=this.scope.behavior(ln([Mle.pipe(un([])),Ule],(e,t)=>{const n=new Map(e.map(({id:e,name:t,isEarpiece:n,isSpeaker:r})=>{let i;return i=n?{type:"earpiece"}:r?{type:"speaker"}:{type:"name",name:t},[e,i]}));return t&&e.some(e=>e.forEarpiece)&&n.set(XK,{type:"earpiece"}),n})),this.deviceSelection$=new Zr,this.selected$=this.scope.behavior(ln([this.available$,vv(Dle.pipe(un(void 0)),this.deviceSelection$)],(e,t)=>{const n=t??e.keys().next().value;return void 0===n?void 0:{id:n,virtualEarpiece:n===XK}})),this.selected$.subscribe(e=>{var t,n,r,i;void 0!==e&&(this.logger.info("[controlled-output] onAudioDeviceSelect called:",e),null==(n=(t=window.controls).onAudioDeviceSelect)||n.call(t,e.id),null==(i=(r=window.controls).onOutputDeviceSelect)||i.call(r,e.id))}),this.available$.subscribe(e=>{this.logger.info("[controlled-output] available devices:",e)}),this.availableRaw$.subscribe(e=>{this.logger.info("[controlled-output] available raw devices:",e)})}select(e){this.deviceSelection$.next(e)}}class RKe{constructor(e,t){this.usingNames$=e,this.scope=t,this.logger=M.getChild("[MediaDevices VideoInput]"),this.available$=this.scope.behavior(tR("videoinput",this.usingNames$,this.scope,this.logger).pipe(ke(N8))),this.selected$=this.scope.behavior(U8(this.available$,DK.value$).pipe(ke(e=>void 0===e?void 0:{id:e}))),this.available$.subscribe(e=>{this.logger.info("[video-input] available devices:",e)})}select(e){DK.setValue(e)}}class IKe{constructor(e){this.scope=e,this.deviceNamesRequest$=new Zr,this.usingNames$=this.scope.behavior(this.deviceNamesRequest$.pipe(ke(()=>!0)),!1),this.audioInput=new wKe(this.usingNames$,this.scope),this.audioOutput=Fr().controlledAudioDevices?new TKe(this.usingNames$,this.scope):new CKe(this.usingNames$,this.scope),this.videoInput=new RKe(this.usingNames$,this.scope)}requestDeviceNames(){this.deviceNamesRequest$.next()}}function kKe(e,t,n){if(!n)return _.useState(t)[0];const[r]=_.useState(()=>new ms(n)),[i]=_.useState(()=>t(r)),o=_.useRef(!0);return e(()=>{o.current?o.current=!1:r.next(n)},n),i}function j8(e,t){return kKe(_.useEffect,e,t)}var xKe=e=>e+1|0,AKe=()=>{const e=_.useState(0)[1];return _.useRef(()=>e(xKe)).current},jle=typeof window>"u"?_.useEffect:_.useLayoutEffect,JK=e=>{var t;return null!=(t=e[1])&&t.next?e[1]:{next:e[1],error:e[2],complete:e[3]}};function LKe(e,t){const n=_.useRef(t),r=_.useRef(),i=_.useRef();return jle(()=>{n.current=t,r.current=JK(t)}),e(()=>{const e=n.current[0];r.current||(r.current=JK(n.current));const t=e.subscribe({next:t=>{var i,o;e===n.current[0]&&(null==(o=(i=r.current).next)||o.call(i,t))},error:t=>{e===n.current[0]&&(r.current.error?r.current.error(t):console.error(t))},complete:()=>{var t,i;e===n.current[0]&&(null==(i=(t=r.current).complete)||i.call(t))}});return i.current=t,()=>{t.unsubscribe()}},[t[0]]),i}function PKe(e,t,n,r){return LKe(_.useEffect,[e,t,n,r])}function Ci(e){const t=AKe(),n=_.useRef(e),r=_.useRef(),i=_.useRef(!1),o=_.useRef(!1),[s,a]=_.useState(()=>{let t;return e.subscribe({next:e=>{o.current=!0,t=e},error:e=>{r.current=e}}).unsubscribe(),t});if(jle(()=>{n.current=e}),_.useEffect(()=>{r.current=null;const e=n.current;let o=s;const l=e.subscribe({next:t=>{e===n.current&&(i.current?a(()=>t):o=t)},error:i=>{e===n.current&&(r.current=i,t())}});return i.current||o!==s&&a(()=>o),i.current=!0,()=>{l.unsubscribe()}},[e]),r.current)throw r.current;if(o.current)return _.useDebugValue(s),s;throw new Error("Observable did not synchronously emit a value.")}function OKe(e){const[t]=_.useState(()=>new ms(e)),[n]=_.useState(()=>({get current(){return t.value},set current(e){t.next(e)}}));return[n,t]}const Fle=_.createContext(void 0);function Gu(){const e=_.use(Fle);if(void 0===e)throw new Error("useMediaDevices must be used within a MediaDevices context provider");return e}const MKe=()=>{var e;const t=Gu(),n=Ci(t.audioOutput.selected$),r=Ci(t.audioOutput.available$);return!(null==n||!n.id)&&"earpiece"===(null==(e=r.get(n.id))?void 0:e.type)},$le=()=>{const e=Ci(Gu().audioOutput.selected$),t=(null==e?void 0:e.virtualEarpiece)??!1;return{pan:_.useMemo(()=>t?1:0,[t]),volume:_.useMemo(()=>t?.1:1,[t])}},DKe=()=>{const{t:e}=Je(),[t,n]=Bn(hle),[r,i]=Bn(ple),[o,s]=Bn(I8),a=(e,t)=>{t(e.target.checked)},[l,c]=Bn(T8);return w.jsxs("div",{children:[w.jsx(on,{children:e("settings.preferences_tab.introduction")}),w.jsx(St,{children:w.jsx(Sn,{id:"showHandRaisedTimer",label:e("settings.preferences_tab.show_hand_raised_timer_label"),description:e("settings.preferences_tab.show_hand_raised_timer_description"),type:"checkbox",checked:t,onChange:e=>a(e,n)})}),w.jsx(St,{children:w.jsx(Sn,{id:"showReactions",label:e("settings.preferences_tab.reactions_show_label"),description:e("settings.preferences_tab.reactions_show_description"),type:"checkbox",checked:r,onChange:e=>a(e,i)})}),w.jsx(St,{children:w.jsx(Sn,{id:"playReactionSound",label:e("settings.preferences_tab.reactions_play_sound_label"),description:e("settings.preferences_tab.reactions_play_sound_description"),type:"checkbox",checked:o,onChange:e=>a(e,s)})}),w.jsx(St,{children:w.jsx(Sn,{id:"developerSettingsTab",type:"checkbox",checked:l,label:e("settings.preferences_tab.developer_mode_label"),description:e("settings.preferences_tab.developer_mode_label_description"),onChange:e=>c(e.target.checked)})})]})};function Ble(e,[t,n]){return Math.min(n,Math.max(t,e))}function dg(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}function QK(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function Hle(...e){return t=>{let n=!1;const r=e.map(e=>{const r=QK(e,t);return!n&&"function"==typeof r&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():QK(e[t],null)}}}}function Cf(...e){return _.useCallback(Hle(...e),e)}function Vle(e,t=[]){let n=[];const r=()=>{const t=n.map(e=>_.createContext(e));return function(n){const r=(null==n?void 0:n[e])||t;return _.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){const i=_.createContext(r),o=n.length;n=[...n,r];const s=t=>{var n;const{scope:r,children:s,...a}=t,l=(null==(n=null==r?void 0:r[e])?void 0:n[o])||i,c=_.useMemo(()=>a,Object.values(a));return w.jsx(l.Provider,{value:c,children:s})};return s.displayName=t+"Provider",[s,function(n,s){var a;const l=(null==(a=null==s?void 0:s[e])?void 0:a[o])||i,c=_.useContext(l);if(c)return c;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},NKe(r,...t)]}function NKe(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return _.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var UKe=c_[" useInsertionEffect ".trim().toString()]||op;function jKe({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){const[i,o,s]=FKe({defaultProp:t,onChange:n}),a=void 0!==e,l=a?e:i;{const t=_.useRef(void 0!==e);_.useEffect(()=>{const e=t.current;e!==a&&console.warn(`${r} is changing from ${e?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),t.current=a},[a,r])}return[l,_.useCallback(t=>{var n;if(a){const r=$Ke(t)?t(e):t;r!==e&&(null==(n=s.current)||n.call(s,r))}else o(t)},[a,e,o,s])]}function FKe({defaultProp:e,onChange:t}){const[n,r]=_.useState(e),i=_.useRef(n),o=_.useRef(t);return UKe(()=>{o.current=t},[t]),_.useEffect(()=>{var e;i.current!==n&&(null==(e=o.current)||e.call(o,n),i.current=n)},[n,i]),[n,r,o]}function $Ke(e){return"function"==typeof e}var BKe=_.createContext(void 0);function HKe(e){const t=_.useContext(BKe);return e||t||"ltr"}function VKe(e){const t=_.useRef({value:e,previous:e});return _.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}function qKe(e){const[t,n]=_.useState(void 0);return op(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver(t=>{if(!Array.isArray(t)||!t.length)return;const r=t[0];let i,o;if("borderBoxSize"in r){const e=r.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,o=t.blockSize}else i=e.offsetWidth,o=e.offsetHeight;n({width:i,height:o})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}function j7(e){const t=GKe(e),n=_.forwardRef((e,n)=>{const{children:r,...i}=e,o=_.Children.toArray(r),s=o.find(zKe);if(s){const e=s.props.children,r=o.map(t=>t===s?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t);return w.jsx(t,{...i,ref:n,children:_.isValidElement(e)?_.cloneElement(e,void 0,r):null})}return w.jsx(t,{...i,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function GKe(e){const t=_.forwardRef((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=YKe(n),i=WKe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Hle(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var KKe=Symbol("radix.slottable");function zKe(e){return _.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===KKe}function WKe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{const t=o(...e);return i(...e),t}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function YKe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var XKe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],N_=XKe.reduce((e,t)=>{const n=j7(`Primitive.${t}`),r=_.forwardRef((e,r)=>{const{asChild:i,...o}=e,s=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(s,{...o,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function JKe(e){const t=e+"CollectionProvider",[n,r]=Vle(t),[i,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e=>{const{scope:t,children:n}=e,r=Te.useRef(null),o=Te.useRef(new Map).current;return w.jsx(i,{scope:t,itemMap:o,collectionRef:r,children:n})};s.displayName=t;const a=e+"CollectionSlot",l=j7(a),c=Te.forwardRef((e,t)=>{const{scope:n,children:r}=e,i=Cf(t,o(a,n).collectionRef);return w.jsx(l,{ref:i,children:r})});c.displayName=a;const u=e+"CollectionItemSlot",d="data-radix-collection-item",h=j7(u),p=Te.forwardRef((e,t)=>{const{scope:n,children:r,...i}=e,s=Te.useRef(null),a=Cf(t,s),l=o(u,n);return Te.useEffect(()=>(l.itemMap.set(s,{ref:s,...i}),()=>{l.itemMap.delete(s)})),w.jsx(h,{[d]:"",ref:a,children:r})});return p.displayName=u,[{Provider:s,Slot:c,ItemSlot:p},function(t){const n=o(e+"CollectionConsumer",t);return Te.useCallback(()=>{const e=n.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${d}]`));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])},r]}var qle=["PageUp","PageDown"],Gle=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Kle={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},e1="Slider",[F7,QKe,ZKe]=JKe(e1),[zle,Got]=Vle(e1,[ZKe]),[eze,nR]=zle(e1),Wle=_.forwardRef((e,t)=>{const{name:n,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:p=!1,form:f,...m}=e,v=_.useRef(new Set),g=_.useRef(0),y="horizontal"===s?tze:nze,[b=[],S]=jKe({prop:u,defaultProp:c,onChange:e=>{var t;null==(t=[...v.current][g.current])||t.focus(),d(e)}}),E=_.useRef(b);function C(e,t,{commit:n}={commit:!1}){const s=dze(o),a=Ble(fze(Math.round((e-r)/o)*o+r,s),[r,i]);S((e=[])=>{const r=sze(e,a,t);if(uze(r,l*o)){g.current=r.indexOf(a);const t=String(r)!==String(e);return t&&n&&h(r),t?r:e}return e})}return w.jsx(eze,{scope:e.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:g,thumbs:v.current,values:b,orientation:s,form:f,children:w.jsx(F7.Provider,{scope:e.__scopeSlider,children:w.jsx(F7.Slot,{scope:e.__scopeSlider,children:w.jsx(y,{"aria-disabled":a,"data-disabled":a?"":void 0,...m,ref:t,onPointerDown:dg(m.onPointerDown,()=>{a||(E.current=b)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:function(e){C(e,aze(b,e))},onSlideMove:a?void 0:function(e){C(e,g.current)},onSlideEnd:a?void 0:function(){const e=E.current[g.current];b[g.current]!==e&&h(b)},onHomeKeyDown:()=>!a&&C(r,0,{commit:!0}),onEndKeyDown:()=>!a&&C(i,b.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!a){const n=qle.includes(e.key)||e.shiftKey&&Gle.includes(e.key)?10:1,r=g.current;C(b[r]+o*n*t,r,{commit:!0})}}})})})})});Wle.displayName=e1;var[Yle,Xle]=zle(e1,{startEdge:"left",endEdge:"right",size:"width",direction:1}),tze=_.forwardRef((e,t)=>{const{min:n,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=e,[d,h]=_.useState(null),p=Cf(t,e=>h(e)),f=_.useRef(void 0),m=HKe(i),v="ltr"===m,g=v&&!o||!v&&o;function y(e){const t=f.current||d.getBoundingClientRect(),i=F8([0,t.width],g?[n,r]:[r,n]);return f.current=t,i(e-t.left)}return w.jsx(Yle,{scope:e.__scopeSlider,startEdge:g?"left":"right",endEdge:g?"right":"left",direction:g?1:-1,size:"width",children:w.jsx(Jle,{dir:m,"data-orientation":"horizontal",...u,ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{const t=y(e.clientX);null==s||s(t)},onSlideMove:e=>{const t=y(e.clientX);null==a||a(t)},onSlideEnd:()=>{f.current=void 0,null==l||l()},onStepKeyDown:e=>{const t=Kle[g?"from-left":"from-right"].includes(e.key);null==c||c({event:e,direction:t?-1:1})}})})}),nze=_.forwardRef((e,t)=>{const{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=e,u=_.useRef(null),d=Cf(t,u),h=_.useRef(void 0),p=!i;function f(e){const t=h.current||u.current.getBoundingClientRect(),i=F8([0,t.height],p?[r,n]:[n,r]);return h.current=t,i(e-t.top)}return w.jsx(Yle,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:w.jsx(Jle,{"data-orientation":"vertical",...c,ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{const t=f(e.clientY);null==o||o(t)},onSlideMove:e=>{const t=f(e.clientY);null==s||s(t)},onSlideEnd:()=>{h.current=void 0,null==a||a()},onStepKeyDown:e=>{const t=Kle[p?"from-bottom":"from-top"].includes(e.key);null==l||l({event:e,direction:t?-1:1})}})})}),Jle=_.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=e,u=nR(e1,n);return w.jsx(N_.span,{...c,ref:t,onKeyDown:dg(e.onKeyDown,e=>{"Home"===e.key?(s(e),e.preventDefault()):"End"===e.key?(a(e),e.preventDefault()):qle.concat(Gle).includes(e.key)&&(l(e),e.preventDefault())}),onPointerDown:dg(e.onPointerDown,e=>{const t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():r(e)}),onPointerMove:dg(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:dg(e.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),o(e))})})}),Qle="SliderTrack",Zle=_.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,i=nR(Qle,n);return w.jsx(N_.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:t})});Zle.displayName=Qle;var $7="SliderRange",eue=_.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,i=nR($7,n),o=Xle($7,n),s=Cf(t,_.useRef(null)),a=i.values.length,l=i.values.map(e=>rue(e,i.min,i.max)),c=a>1?Math.min(...l):0,u=100-Math.max(...l);return w.jsx(N_.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:s,style:{...e.style,[o.startEdge]:c+"%",[o.endEdge]:u+"%"}})});eue.displayName=$7;var B7="SliderThumb",tue=_.forwardRef((e,t)=>{const n=QKe(e.__scopeSlider),[r,i]=_.useState(null),o=Cf(t,e=>i(e)),s=_.useMemo(()=>r?n().findIndex(e=>e.ref.current===r):-1,[n,r]);return w.jsx(rze,{...e,ref:o,index:s})}),rze=_.forwardRef((e,t)=>{const{__scopeSlider:n,index:r,name:i,...o}=e,s=nR(B7,n),a=Xle(B7,n),[l,c]=_.useState(null),u=Cf(t,e=>c(e)),d=!l||(s.form||!!l.closest("form")),h=qKe(l),p=s.values[r],f=void 0===p?0:rue(p,s.min,s.max),m=oze(r,s.values.length),v=null==h?void 0:h[a.size],g=v?cze(v,f,a.direction):0;return _.useEffect(()=>{if(l)return s.thumbs.add(l),()=>{s.thumbs.delete(l)}},[l,s.thumbs]),w.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${f}% + ${g}px)`},children:[w.jsx(F7.ItemSlot,{scope:e.__scopeSlider,children:w.jsx(N_.span,{role:"slider","aria-label":e["aria-label"]||m,"aria-valuemin":s.min,"aria-valuenow":p,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...o,ref:u,style:void 0===p?{display:"none"}:e.style,onFocus:dg(e.onFocus,()=>{s.valueIndexToChangeRef.current=r})})}),d&&w.jsx(nue,{name:i??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:p},r)]})});tue.displayName=B7;var ize="RadioBubbleInput",nue=_.forwardRef(({__scopeSlider:e,value:t,...n},r)=>{const i=_.useRef(null),o=Cf(i,r),s=VKe(t);return _.useEffect(()=>{const e=i.current;if(!e)return;const n=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(n,"value").set;if(s!==t&&r){const n=new Event("input",{bubbles:!0});r.call(e,t),e.dispatchEvent(n)}},[s,t]),w.jsx(N_.input,{style:{display:"none"},...n,ref:o,defaultValue:t})});function sze(e=[],t,n){const r=[...e];return r[n]=t,r.sort((e,t)=>e-t)}function rue(e,t,n){return Ble(100/(n-t)*(e-t),[0,100])}function oze(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}function aze(e,t){if(1===e.length)return 0;const n=e.map(e=>Math.abs(e-t)),r=Math.min(...n);return n.indexOf(r)}function cze(e,t,n){const r=e/2;return(r-F8([0,50],[0,r])(t)*n)*n}function lze(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function uze(e,t){if(t>0){const n=lze(e);return Math.min(...n)>=t}return!0}function F8(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function dze(e){return(String(e).split(".")[1]||"").length}function fze(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}nue.displayName=ize;var hze=Wle,pze=Zle,mze=eue,gze=tue;const vze="_slider_15go1_8",yze="_track_15go1_14",bze="_highlight_15go1_31",_ze="_handle_15go1_43",fE={slider:vze,track:yze,highlight:bze,handle:_ze},iue=({className:e,label:t,value:n,onValueChange:r,onValueCommit:i,min:o,max:s,step:a,disabled:l})=>{const c=_.useCallback(([e])=>r(e),[r]),u=_.useCallback(([e])=>null==i?void 0:i(e),[i]);return w.jsxs(hze,{className:Ne(e,fE.slider),value:[n],onValueChange:c,onValueCommit:u,min:o,max:s,step:a,disabled:l,children:[w.jsx(pze,{className:fE.track,children:w.jsx(mze,{className:fE.highlight})}),w.jsx(Fi,{placement:"top",label:Math.round(100*n).toString()+"%",children:w.jsx(gze,{className:fE.handle,"aria-label":t})})]})},Sze="_selection_1akwb_1",Eze="_title_1akwb_5",wze="_separator_1akwb_10",Cze="_options_1akwb_14",Tze="_secondary_1akwb_20",H0={selection:Sze,title:Eze,separator:wze,options:Cze,secondary:Tze},Cx=({device:e,title:t,numberedLabel:n})=>{var r;const{t:i}=Je(),o=_.useId(),s=Ci(e.available$),a=null==(r=Ci(e.selected$))?void 0:r.id,l=_.useCallback(t=>{e.select(t.target.value)},[e]);return s.size<=1?null:w.jsxs("div",{className:H0.selection,children:[w.jsx(ml,{type:"body",weight:"semibold",size:"sm",as:"h4",className:H0.title,children:t}),w.jsx(UM,{className:H0.separator}),w.jsx("div",{className:H0.options,children:[...s].map(([e,t])=>{let r;switch(t.type){case"name":r=t.name;break;case"number":r=n(t.number);break;case"default":r=null===t.name?i("settings.devices.default"):w.jsxs(Vs,{i18nKey:"settings.devices.default_named",name:t.name,children:["Default"," ",w.jsxs("span",{className:H0.secondary,children:["(",{name:t.name},")"]})]});break;case"speaker":r=i("settings.devices.loudspeaker");break;case"earpiece":r=i("settings.devices.handset")}return w.jsx(DOe,{name:o,control:w.jsx(EOe,{checked:e===a,onChange:l,value:e}),children:w.jsx(TOe,{children:r})},e)})})]})};var fp=typeof self<"u"?self:{};function vh(){throw Error("Invalid UTF8")}function ZK(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}let hE,Tx;const Rze=typeof TextDecoder<"u";let Ize;const kze=typeof TextEncoder<"u";function sue(e){if(kze)e=(Ize||(Ize=new TextEncoder)).encode(e);else{let n=0;const r=new Uint8Array(3*e.length);for(let i=0;i<e.length;i++){var t=e.charCodeAt(i);if(t<128)r[n++]=t;else{if(t<2048)r[n++]=t>>6|192;else{if(t>=55296&&t<=57343){if(t<=56319&&i<e.length){const o=e.charCodeAt(++i);if(o>=56320&&o<=57343){t=1024*(t-55296)+o-56320+65536,r[n++]=t>>18|240,r[n++]=t>>12&63|128,r[n++]=t>>6&63|128,r[n++]=63&t|128;continue}i--}t=65533}r[n++]=t>>12|224,r[n++]=t>>6&63|128}r[n++]=63&t|128}}e=n===r.length?r:r.subarray(0,n)}return e}var $8,c3;e:{for(var ez=["CLOSURE_FLAGS"],Rx=fp,Ix=0;Ix<ez.length;Ix++)if(null==(Rx=Rx[ez[Ix]])){c3=null;break e}c3=Rx}var Bb,tz=c3&&c3[610401301];$8=null!=tz&&tz;const nz=fp.navigator;function H7(e){return!!$8&&!!Bb&&Bb.brands.some(({brand:t})=>t&&-1!=t.indexOf(e))}function na(e){var t;return(t=fp.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}function $d(){return!!$8&&!!Bb&&Bb.brands.length>0}function kx(){return $d()?H7("Chromium"):(na("Chrome")||na("CriOS"))&&!(!$d()&&na("Edge"))||na("Silk")}function B8(e){return B8[" "](e),e}Bb=nz&&nz.userAgentData||null,B8[" "]=function(){};var xze=!$d()&&(na("Trident")||na("MSIE"));!na("Android")||kx(),kx(),na("Safari")&&(kx()||!$d()&&na("Coast")||!$d()&&na("Opera")||!$d()&&na("Edge")||($d()?H7("Microsoft Edge"):na("Edg/"))||$d()&&H7("Opera"));var oue={},hy=null;function Aze(e){const t=e.length;let n=3*t/4;n%3?n=Math.floor(n):-1!="=.".indexOf(e[t-1])&&(n=-1!="=.".indexOf(e[t-2])?n-2:n-1);const r=new Uint8Array(n);let i=0;return function(e,t){function n(t){for(;r<e.length;){const t=e.charAt(r++),n=hy[t];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(t))throw Error("Unknown base64 encoding at char: "+t)}return t}aue();let r=0;for(;;){const e=n(-1),r=n(0),i=n(64),o=n(64);if(64===o&&-1===e)break;t(e<<2|r>>4),64!=i&&(t(r<<4&240|i>>2),64!=o&&t(i<<6&192|o))}}(e,function(e){r[i++]=e}),i!==n?r.subarray(0,i):r}function aue(){if(!hy){hy={};var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"];for(let n=0;n<5;n++){const r=e.concat(t[n].split(""));oue[n]=r;for(let e=0;e<r.length;e++){const t=r[e];void 0===hy[t]&&(hy[t]=e)}}}}var cue=typeof Uint8Array<"u",lue=!xze&&"function"==typeof btoa;function rz(e){if(!lue){var t;void 0===t&&(t=0),aue(),t=oue[t];var n=Array(Math.floor(e.length/3)),r=t[64]||"";let l=0,c=0;for(;l<e.length-2;l+=3){var i=e[l],o=e[l+1],s=e[l+2],a=t[i>>2];i=t[(3&i)<<4|o>>4],o=t[(15&o)<<2|s>>6],s=t[63&s],n[c++]=a+i+o+s}switch(a=0,s=r,e.length-l){case 2:s=t[(15&(a=e[l+1]))<<2]||r;case 1:e=e[l],n[c]=t[e>>2]+t[(3&e)<<4|a>>4]+s+r}return n.join("")}for(t="",n=0,r=e.length-10240;n<r;)t+=String.fromCharCode.apply(null,e.subarray(n,n+=10240));return t+=String.fromCharCode.apply(null,n?e.subarray(n):e),btoa(t)}const iz=/[-_.]/g,Lze={"-":"+",_:"/",".":"="};function Pze(e){return Lze[e]||""}function uue(e){if(!lue)return Aze(e);iz.test(e)&&(e=e.replace(iz,Pze)),e=atob(e);const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function U_(e){return cue&&null!=e&&e instanceof Uint8Array}var yv={};function hp(){return Oze||(Oze=new Eu(null,yv))}function H8(e){due(yv);var t=e.g;return null==(t=null==t||U_(t)?t:"string"==typeof t?uue(t):null)?t:e.g=t}var Eu=class{h(){return new Uint8Array(H8(this)||0)}constructor(e,t){if(due(t),this.g=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}};let Oze,Mze;function due(e){if(e!==yv)throw Error("illegal external caller")}function fue(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}function V7(e){return fue(e=Error(e),"warning"),e}var rR="function"==typeof Symbol&&"symbol"==typeof Symbol(),Dze=new Set;function j_(e,t,n=!1,r=!1){return e="function"==typeof Symbol&&"symbol"==typeof Symbol()?r&&Symbol.for&&e?Symbol.for(e):null!=e?Symbol(e):Symbol():t,n&&Dze.add(e),e}var Nze=j_("jas",void 0,!0,!0),sz=j_(void 0,"0di"),xx=j_(void 0,"2ex"),V0=j_(void 0,"1oa",!0),bv=j_(void 0,Symbol(),!0);const Xe=rR?Nze:"Ga",hue={Ga:{value:0,configurable:!0,writable:!0,enumerable:!1}},pue=Object.defineProperties;function iR(e,t){rR||Xe in e||pue(e,hue),e[Xe]|=t}function jr(e,t){rR||Xe in e||pue(e,hue),e[Xe]=t}function t1(e){return iR(e,34),e}function Uze(e,t){jr(t,-30975&e)}function q7(e,t){jr(t,-30941&e|34)}function V8(){return"function"==typeof BigInt}function Gs(e){return Array.prototype.slice.call(e)}var q8,F_={},mue={};function oz(e){return!(!e||"object"!=typeof e||e.Ia!==mue)}function G8(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}function K8(e,t){if(null!=e)if("string"==typeof e)e=e?new Eu(e,yv):hp();else if(e.constructor!==Eu)if(U_(e))e=e.length?new Eu(new Uint8Array(e),yv):hp();else{if(!t)throw Error();e=void 0}return e}function l3(e){return!(!Array.isArray(e)||e.length||!(1&e[Xe]))}const az=[];function Ff(e){if(2&e)throw Error()}jr(az,55),q8=Object.freeze(az);let cz=class e{constructor(e,t,n){this.l=0,this.g=e,this.h=t,this.m=n}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new e(this.g,this.h,this.m)}};function z8(e){return bv?e[bv]:void 0}var jze=Object.freeze({});function sR(e){return e.Qa=!0,e}var Fze=sR(e=>"number"==typeof e),lz=sR(e=>"string"==typeof e),$ze=sR(e=>"boolean"==typeof e),oR="function"==typeof fp.BigInt&&"bigint"==typeof fp.BigInt(0),G7=sR(e=>oR?e>=Hze&&e<=qze:"-"===e[0]?uz(e,Bze):uz(e,Vze));const Bze=Number.MIN_SAFE_INTEGER.toString(),Hze=oR?BigInt(Number.MIN_SAFE_INTEGER):void 0,Vze=Number.MAX_SAFE_INTEGER.toString(),qze=oR?BigInt(Number.MAX_SAFE_INTEGER):void 0;function uz(e,t){if(e.length>t.length)return!1;if(e.length<t.length||e===t)return!0;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(r>i)return!1;if(r<i)return!0}}const Gze="function"==typeof Uint8Array.prototype.slice;let vue,xn=0,mr=0;function dz(e){const t=e>>>0;xn=t,mr=(e-t)/4294967296>>>0}function _v(e){if(e<0){dz(-e);const[t,n]=J8(xn,mr);xn=t>>>0,mr=n>>>0}else dz(e)}function W8(e){const t=vue||(vue=new DataView(new ArrayBuffer(8)));t.setFloat32(0,+e,!0),mr=0,xn=t.getUint32(0,!0)}function Y8(e,t){const n=4294967296*t+(e>>>0);return Number.isSafeInteger(n)?n:Hb(e,t)}function X8(e,t){const n=2147483648&t;return n&&(t=~t>>>0,0==(e=1+~e>>>0)&&(t=t+1>>>0)),"number"==typeof(e=Y8(e,t))?n?-e:e:n?"-"+e:e}function Hb(e,t){if(e>>>=0,(t>>>=0)<=2097151)var n=""+(4294967296*t+e);else V8()?n=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(n=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),n+=8147497*t,t*=2,e>=1e7&&(n+=e/1e7>>>0,e%=1e7),n>=1e7&&(t+=n/1e7>>>0,n%=1e7),n=t+fz(n)+fz(e));return n}function fz(e){return e=String(e),"0000000".slice(e.length)+e}function aR(e){if(e.length<16)_v(Number(e));else if(V8())e=BigInt(e),xn=Number(e&BigInt(4294967295))>>>0,mr=Number(e>>BigInt(32)&BigInt(4294967295));else{const t=+("-"===e[0]);mr=xn=0;const n=e.length;for(let r=t,i=(n-t)%6+t;i<=n;r=i,i+=6){const t=Number(e.slice(r,i));mr*=1e6,xn=1e6*xn+t,xn>=4294967296&&(mr+=Math.trunc(xn/4294967296),mr>>>=0,xn>>>=0)}if(t){const[e,t]=J8(xn,mr);xn=e,mr=t}}}function J8(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}const Q8="function"==typeof BigInt?BigInt.asIntN:void 0,Kze="function"==typeof BigInt?BigInt.asUintN:void 0,jg=Number.isSafeInteger,cR=Number.isFinite,u3=Math.trunc;function $f(e){return null==e||"number"==typeof e?e:"NaN"===e||"Infinity"===e||"-Infinity"===e?Number(e):void 0}function yue(e){return null==e||"boolean"==typeof e?e:"number"==typeof e?!!e:void 0}const zze=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function lR(e){switch(typeof e){case"bigint":return!0;case"number":return cR(e);case"string":return zze.test(e);default:return!1}}function n1(e){if(null==e)return e;if("string"==typeof e&&e)e=+e;else if("number"!=typeof e)return;return cR(e)?0|e:void 0}function bue(e){if(null==e)return e;if("string"==typeof e&&e)e=+e;else if("number"!=typeof e)return;return cR(e)?e>>>0:void 0}function hz(e){if("-"===e[0])return!1;const t=e.length;return t<20||20===t&&Number(e.substring(0,6))<184467}function Z8(e){return e=u3(e),jg(e)||(_v(e),e=X8(xn,mr)),e}function e9(e){var t=u3(Number(e));if(jg(t))return String(t);if(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),t=e.length,!("-"===e[0]?t<20||20===t&&Number(e.substring(0,7))>-922337:t<19||19===t&&Number(e.substring(0,6))<922337))if(aR(e),e=xn,2147483648&(t=mr))if(V8())e=""+(BigInt(0|t)<<BigInt(32)|BigInt(e>>>0));else{const[n,r]=J8(e,t);e="-"+Hb(n,r)}else e=Hb(e,t);return e}function d3(e){return null==e?e:"bigint"==typeof e?(G7(e)?e=Number(e):(e=Q8(64,e),e=G7(e)?Number(e):String(e)),e):lR(e)?"number"==typeof e?Z8(e):e9(e):void 0}function Wze(e){if(null==e)return e;var t=typeof e;if("bigint"===t)return String(Kze(64,e));if(lR(e)){if("string"===t)return t=u3(Number(e)),jg(t)&&t>=0?e=String(t):(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),hz(e)||(aR(e),e=Hb(xn,mr))),e;if("number"===t)return(e=u3(e))>=0&&jg(e)?e:function(e){if(e<0){_v(e);var t=Hb(xn,mr);return e=Number(t),jg(e)?e:t}return hz(t=String(e))?t:(_v(e),Y8(xn,mr))}(e)}}function _ue(e){if("string"!=typeof e)throw Error();return e}function r1(e){if(null!=e&&"string"!=typeof e)throw Error();return e}function Sv(e){return null==e||"string"==typeof e?e:void 0}function t9(e,t,n,r){if(null!=e&&"object"==typeof e&&e.W===F_)return e;if(!Array.isArray(e))return n?2&r?((e=t[sz])||(t1((e=new t).u),e=t[sz]=e),t=e):t=new t:t=void 0,t;let i=n=0|e[Xe];return 0===i&&(i|=32&r),i|=2&r,i!==n&&jr(e,i),new t(e)}function Yze(e,t,n){if(t)e:{if(!lR(t=e))throw V7("int64");switch(typeof t){case"string":t=e9(t);break e;case"bigint":if(e=t=Q8(64,t),lz(e)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(e))throw Error(String(e))}else if(Fze(e)&&!Number.isSafeInteger(e))throw Error(String(e));t=oR?BigInt(t):$ze(t)?t?"1":"0":lz(t)?t.trim()||"0":String(t);break e;default:t=Z8(t)}}else t=d3(e);return"string"==typeof(n=null==(e=t)?n?0:void 0:e)&&jg(t=+n)?t:n}const Xze={};let Jze=function(){try{return B8(new class extends Map{constructor(){super()}}),!1}catch{return!0}}(),Ax=class{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,t){return this.g.set(e,t),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}[Symbol.iterator](){return this.entries()}};const Qze=Jze?(Object.setPrototypeOf(Ax.prototype,Map.prototype),Object.defineProperties(Ax.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),Ax):class extends Map{constructor(){super()}};function pz(e){return e}function Lx(e){if(2&e.L)throw Error("Cannot mutate an immutable Map")}var ya=class extends Qze{constructor(e,t,n=pz,r=pz){super();let i=0|e[Xe];i|=64,jr(e,i),this.L=i,this.S=t,this.R=n,this.Y=this.S?Zze:r;for(let o=0;o<e.length;o++){const s=e[o],a=n(s[0],!1,!0);let l=s[1];t?void 0===l&&(l=null):l=r(s[1],!1,!0,void 0,void 0,i),super.set(a,l)}}na(e=mz){if(0!==this.size)return this.X(e)}X(e=mz){const t=[],n=super.entries();for(var r;!(r=n.next()).done;)(r=r.value)[0]=e(r[0]),r[1]=e(r[1]),t.push(r);return t}clear(){Lx(this),super.clear()}delete(e){return Lx(this),super.delete(this.R(e,!0,!1))}entries(){var e=this.ma();return new cz(e,eWe,this)}keys(){return this.Ha()}values(){var e=this.ma();return new cz(e,ya.prototype.get,this)}forEach(e,t){super.forEach((n,r)=>{e.call(t,this.get(r),r,this)})}set(e,t){return Lx(this),null==(e=this.R(e,!0,!1))?this:null==t?(super.delete(e),this):super.set(e,this.Y(t,!0,!0,this.S,!1,this.L))}Na(e){const t=this.R(e[0],!1,!0);e=e[1],e=this.S?void 0===e?null:e:this.Y(e,!1,!0,void 0,!1,this.L),super.set(t,e)}has(e){return super.has(this.R(e,!1,!1))}get(e){e=this.R(e,!1,!1);const t=super.get(e);if(void 0!==t){var n=this.S;return n?((n=this.Y(t,!1,!0,n,this.ra,this.L))!==t&&super.set(e,n),n):t}}ma(){return Array.from(super.keys())}Ha(){return super.keys()}[Symbol.iterator](){return this.entries()}};function Zze(e,t,n,r,i,o){return e=t9(e,r,n,o),i&&(e=dR(e)),e}function mz(e){return e}function eWe(e){return[e,this.get(e)]}let tWe,Sue,nWe;function gz(){return tWe||(tWe=new ya(t1([]),void 0,void 0,void 0,Xze))}function n9(e,t,n,r,i){if(null!=e){if(Array.isArray(e))e=l3(e)?void 0:i&&2&e[Xe]?e:r9(e,t,n,void 0!==r,i);else if(G8(e)){const o={};for(let s in e)o[s]=n9(e[s],t,n,r,i);e=o}else e=t(e,r);return e}}function r9(e,t,n,r,i){const o=r||n?0|e[Xe]:0,s=r?!!(32&o):void 0;r=Gs(e);for(let e=0;e<r.length;e++)r[e]=n9(r[e],t,n,s,i);return n&&((e=z8(e))&&(r[bv]=Gs(e)),n(o,r)),r}function rWe(e){return n9(e,Eue,void 0,void 0,!1)}function Eue(e){return e.W===F_?e.toJSON():e instanceof ya?e.na(rWe):function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return G7(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(l3(e))return}else{if(U_(e))return rz(e);if(e instanceof Eu){const t=e.g;return null==t?"":"string"==typeof t?t:e.g=rz(t)}if(e instanceof ya)return e.na()}}return e}(e)}function wue(e){return r9(e,Eue,void 0,void 0,!1)}function cf(e,t,n){return e=Cue(e,t[0],t[1],n?1:2),t!==Sue&&n&&iR(e,16384),e}function Cue(e,t,n,r){if(null==e){var i=96;n?(e=[n],i|=512):e=[],t&&(i=-33521665&i|(1023&t)<<15)}else{if(!Array.isArray(e))throw Error("narr");if(2048&(i=0|e[Xe]))throw Error("farr");if(64&i)return e;if(1===r||2===r||(i|=64),n&&(i|=512,n!==e[0]))throw Error("mid");e:{if(r=(n=e).length){const e=r-1;if(G8(n[e])){if((t=e-(512&(i|=256)?0:-1))>=1024)throw Error("pvtlmt");i=-33521665&i|(1023&t)<<15;break e}}if(t){if((t=Math.max(t,r-(512&i?0:-1)))>1024)throw Error("spvt");i=-33521665&i|(1023&t)<<15}}}return jr(e,i),e}function K7(e,t,n=q7){if(null!=e){if(cue&&e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var r=0|e[Xe];return 2&r?e:(t&&(t=0===r||!!(32&r)&&!(64&r||!(16&r))),t?(jr(e,-12293&r|34),e):r9(e,K7,4&r?q7:n,!0,!0))}return e.W===F_?e=2&(r=0|(n=e.u)[Xe])?e:new e.constructor(uR(n,r,!0)):e instanceof ya&&!(2&e.L)&&(n=t1(e.X(K7)),e=new ya(n,e.S,e.R,e.Y)),e}}function uR(e,t,n){const r=n||2&t?q7:Uze,i=!!(32&t);return iR(e=function(e,t,n){const r=Gs(e);var i=r.length;const o=256&t?r[i-1]:void 0;for(i+=o?-1:0,t=512&t?1:0;t<i;t++)r[t]=n(r[t]);if(o){t=r[t]={};for(const e in o)t[e]=n(o[e])}return(e=z8(e))&&(r[bv]=Gs(e)),r}(e,t,e=>K7(e,i,r)),32|(n?2:0)),e}function dR(e){const t=e.u,n=0|t[Xe];return 2&n?new e.constructor(uR(t,n,!1)):e}function Ev(e,t){return Ku(e=e.u,0|e[Xe],t)}function Ku(e,t,n,r){if(-1===n)return null;var i=n+(512&t?0:-1);const o=e.length-1;return i>=o&&256&t?e[o][n]:r&&256&t&&null!=(t=e[o][n])?(null!=e[i]&&null!=xx&&((i=(e=Mze??(Mze={}))[xx]||0)>=4||(e[xx]=i+1,fue(e=Error(),"incident"),s=e,fp.setTimeout(()=>{throw s},0))),t):i<=o?e[i]:void 0;var s}function Nn(e,t,n){const r=e.u;let i=0|r[Xe];return Ff(i),sr(r,i,t,n),e}function sr(e,t,n,r){const i=512&t?0:-1,o=n+i;var s=e.length-1;return o>=s&&256&t?(e[s][n]=r,t):o<=s?(e[o]=r,256&t&&n in(e=e[s])&&delete e[n],t):(void 0!==r&&(n>=(s=t>>15&1023||536870912)?null!=r&&(e[s+i]={[n]:r},jr(e,t|=256)):e[o]=r),t)}function Lw(e,t){let n=0|(e=e.u)[Xe];const r=Ku(e,n,t),i=$f(r);return null!=i&&i!==r&&sr(e,n,t,i),i}function Tue(e){let t=0|(e=e.u)[Xe];const n=Ku(e,t,1),r=K8(n,!0);return null!=r&&r!==n&&sr(e,t,1,r),r}function Mh(){return void 0===jze?2:4}function Dh(e,t,n,r,i){const o=e.u,s=2&(e=0|o[Xe])?1:r;i=!!i;let a=0|(r=i9(o,e,t))[Xe];if(!(4&a)){4&a&&(r=Gs(r),a=wu(a,e),e=sr(o,e,t,r));let i=0,s=0;for(;i<r.length;i++){const e=n(r[i]);null!=e&&(r[s++]=e)}s<i&&(r.length=s),a=s9(a,e),n=-4097&a|20,a=n&=-8193,jr(r,a),2&a&&Object.freeze(r)}return 1===s||4===s&&32&a?hu(a)||(i=a,a|=2,a!==i&&jr(r,a),Object.freeze(r)):(2===s&&hu(a)&&(r=Gs(r),a=wu(a,e),a=lf(a,e,i),jr(r,a),e=sr(o,e,t,r)),hu(a)||(t=a,a=lf(a,e,i),a!==t&&jr(r,a))),r}function i9(e,t,n,r){return e=Ku(e,t,n,r),Array.isArray(e)?e:q8}function s9(e,t){return 0===e&&(e=wu(e,t)),1|e}function hu(e){return!!(2&e)&&!!(4&e)||!!(2048&e)}function Rue(e){e=Gs(e);for(let t=0;t<e.length;t++){const n=e[t]=Gs(e[t]);Array.isArray(n[1])&&(n[1]=t1(n[1]))}return e}function z7(e,t,n,r){let i=0|(e=e.u)[Xe];Ff(i),sr(e,i,t,("0"===r?0===Number(n):n===r)?void 0:n)}function i1(e,t,n,r,i){Ff(t);var o=!(!(64&t)&&16384&t);const s=(i=i9(e,t,n,i))!==q8;if(o||!s){let a=o=s?0|i[Xe]:0;(!s||2&a||hu(a)||4&a&&!(32&a))&&(i=Gs(i),a=wu(a,t),t=sr(e,t,n,i)),a=-13&s9(a,t),a=lf(r?-17&a:16|a,t,!0),a!==o&&jr(i,a)}return i}function Px(e,t){var n=mde;return a9(o9(e=e.u),e,0|e[Xe],n)===t?t:-1}function o9(e){if(rR)return e[V0]??(e[V0]=new Map);if(V0 in e)return e[V0];const t=new Map;return Object.defineProperty(e,V0,{value:t}),t}function Iue(e,t,n,r){const i=o9(e),o=a9(i,e,t,n);return o!==r&&(o&&(t=sr(e,t,o)),i.set(n,r)),t}function a9(e,t,n,r){let i=e.get(r);if(null!=i)return i;i=0;for(let e=0;e<r.length;e++){const o=r[e];null!=Ku(t,n,o)&&(0!==i&&(n=sr(t,n,i)),i=o)}return e.set(r,i),i}function c9(e,t,n,r){let i,o=0|e[Xe];if(null!=(r=Ku(e,o,n,r))&&r.W===F_)return(t=dR(r))!==r&&sr(e,o,n,t),t.u;if(Array.isArray(r)){const e=0|r[Xe];i=2&e?cf(uR(r,e,!1),t,!0):64&e?r:cf(i,t,!0)}else i=cf(void 0,t,!0);return i!==r&&sr(e,o,n,i),i}function kue(e,t,n,r){let i=0|(e=e.u)[Xe];return(t=t9(r=Ku(e,i,n,r),t,!1,i))!==r&&null!=t&&sr(e,i,n,t),t}function Gt(e,t,n,r=!1){if(null==(t=kue(e,t,n,r)))return t;if(!(2&(r=0|(e=e.u)[Xe]))){const i=dR(t);i!==t&&sr(e,r,n,t=i)}return t}function xue(e,t,n,r,i,o,s){var a=!!(2&t);const l=a?1:i;o=!!o,s&&(s=!a);var c=0|(i=i9(e=e.u,t,r))[Xe];if(!(a=!!(4&c))){var u=i,d=t;const e=!!(2&(c=s9(c,t)));e&&(d|=2);let r=!e,o=!0,s=0,a=0;for(;s<u.length;s++){const t=t9(u[s],n,!1,d);if(t instanceof n){if(!e){const e=!!(2&t.u[Xe]);r&&(r=!e),o&&(o=e)}u[a++]=t}}a<s&&(u.length=a),c|=4,c=o?16|c:-17&c,jr(u,c=r?8|c:-9&c),e&&Object.freeze(u)}if(s&&!(8&c||!i.length&&(1===l||4===l&&32&c))){for(hu(c)&&(i=Gs(i),c=wu(c,t),t=sr(e,t,r,i)),n=i,s=c,u=0;u<n.length;u++)(c=n[u])!==(d=dR(c))&&(n[u]=d);s|=8,jr(n,s=n.length?-17&s:16|s),c=s}return 1===l||4===l&&32&c?hu(c)||(t=c,(c|=!i.length||16&c&&(!a||32&c)?2:2048)!==t&&jr(i,c),Object.freeze(i)):(2===l&&hu(c)&&(jr(i=Gs(i),c=lf(c=wu(c,t),t,o)),t=sr(e,t,r,i)),hu(c)||(r=c,(c=lf(c,t,o))!==r&&jr(i,c))),i}function Uu(e,t,n){const r=0|e.u[Xe];return xue(e,r,t,n,Mh(),!1,!(2&r))}function Ze(e,t,n,r){return null==r&&(r=void 0),Nn(e,n,r)}function Vy(e,t,n,r){null==r&&(r=void 0);e:{let i=0|(e=e.u)[Xe];if(Ff(i),null==r){const r=o9(e);if(a9(r,e,i,n)!==t)break e;r.set(n,0)}else i=Iue(e,i,n,t);sr(e,i,t,r)}}function wu(e,t){return-2049&(2&t?2|e:-3&e)|32}function lf(e,t,n){return 32&t&&n||(e&=-33),e}function f3(e,t,n,r){const i=0|e.u[Xe];Ff(i),e=xue(e,i,n,t,2,!0),r=r??new n,e.push(r),e[Xe]=2&r.u[Xe]?-9&e[Xe]:-17&e[Xe]}function la(e,t){return n1(Ev(e,t))}function ba(e,t){return Sv(Ev(e,t))}function Cr(e,t){return Lw(e,t)??0}function Vb(e,t,n){if(null!=n&&"boolean"!=typeof n)throw e=typeof n,Error(`Expected boolean but got ${"object"!=e?e:n?Array.isArray(n)?"array":e:"null"}: ${n}`);Nn(e,t,n)}function sl(e,t,n){if(null!=n){if("number"!=typeof n||!cR(n))throw V7("int32");n|=0}Nn(e,t,n)}function Ge(e,t,n){if(null!=n&&"number"!=typeof n)throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);Nn(e,t,n)}function h3(e,t,n){{const s=e.u;let a=0|s[Xe];if(Ff(a),null==n)sr(s,a,t);else{var r=e=0|n[Xe],i=hu(e),o=i||Object.isFrozen(n);for(i||(e=0),o||(n=Gs(n),r=0,e=lf(e=wu(e,a),a,!0),o=!1),e|=21,i=0;i<n.length;i++){const t=n[i],s=_ue(t);Object.is(t,s)||(o&&(n=Gs(n),r=0,e=lf(e=wu(e,a),a,!0),o=!1),n[i]=s)}e!==r&&(o&&(n=Gs(n),e=lf(e=wu(e,a),a,!0)),jr(n,e)),sr(s,a,t,n)}}}function fR(e,t,n){Ff(0|e.u[Xe]),Dh(e,t,Sv,2,!0).push(_ue(n))}function Aue(e,t){return Error(`Invalid wire type: ${e} (at position ${t})`)}function l9(){return Error("Failed to read varint, encoding is invalid.")}function Lue(e,t){return Error(`Tried to read past the end of the data ${t} > ${e}`)}function u9(e){if("string"==typeof e)return{buffer:uue(e),N:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),N:!1};if(e.constructor===Uint8Array)return{buffer:e,N:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),N:!1};if(e.constructor===Eu)return{buffer:H8(e)||new Uint8Array(0),N:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),N:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function d9(e,t){let n,r=0,i=0,o=0;const s=e.h;let a=e.g;do{n=s[a++],r|=(127&n)<<o,o+=7}while(o<32&&128&n);for(o>32&&(i|=(127&n)>>4),o=3;o<32&&128&n;o+=7)n=s[a++],i|=(127&n)<<o;if(Wh(e,a),n<128)return t(r>>>0,i>>>0);throw l9()}function f9(e){let t=0,n=e.g;const r=n+10,i=e.h;for(;n<r;){const r=i[n++];if(t|=r,!(128&r))return Wh(e,n),!!(127&t)}throw l9()}function Tf(e){const t=e.h;let n=e.g,r=t[n++],i=127&r;if(128&r&&(r=t[n++],i|=(127&r)<<7,128&r&&(r=t[n++],i|=(127&r)<<14,128&r&&(r=t[n++],i|=(127&r)<<21,128&r&&(r=t[n++],i|=r<<28,128&r&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++])))))throw l9();return Wh(e,n),i}function ju(e){return Tf(e)>>>0}function W7(e){var t=e.h;const n=e.g,r=t[n],i=t[n+1],o=t[n+2];return t=t[n+3],Wh(e,e.g+4),(r|i<<8|o<<16|t<<24)>>>0}function Y7(e){var t=W7(e);e=2*(t>>31)+1;const n=t>>>23&255;return t&=8388607,255==n?t?NaN:e*(1/0):0==n?1401298464324817e-60*e*t:e*Math.pow(2,n-150)*(t+8388608)}function iWe(e){return Tf(e)}function Ox(e,t,{ba:n=!1}={}){e.ba=n,t&&(t=u9(t),e.h=t.buffer,e.m=t.N,e.j=0,e.l=e.h.length,e.g=e.j)}function Wh(e,t){if(e.g=t,t>e.l)throw Lue(e.l,t)}function Pue(e,t){if(t<0)throw Error(`Tried to read a negative byte length: ${t}`);const n=e.g,r=n+t;if(r>e.l)throw Lue(t,e.l-n);return e.g=r,n}function Oue(e,t){if(0==t)return hp();var n=Pue(e,t);return e.ba&&e.m?n=e.h.subarray(n,n+t):(e=e.h,n=n===(t=n+t)?new Uint8Array(0):Gze?e.slice(n,t):new Uint8Array(e.subarray(n,t))),0==n.length?hp():new Eu(n,yv)}ya.prototype.toJSON=void 0,ya.prototype.Ia=mue;var vz=[];function Mue(e){var t=e.g;if(t.g==t.l)return!1;e.l=e.g.g;var n=ju(e.g);if(t=n>>>3,!((n&=7)>=0&&n<=5))throw Aue(n,e.l);if(t<1)throw Error(`Invalid field number: ${t} (at position ${e.l})`);return e.m=t,e.h=n,!0}function Pw(e){switch(e.h){case 0:0!=e.h?Pw(e):f9(e.g);break;case 1:Wh(e=e.g,e.g+8);break;case 2:if(2!=e.h)Pw(e);else{var t=ju(e.g);Wh(e=e.g,e.g+t)}break;case 5:Wh(e=e.g,e.g+4);break;case 3:for(t=e.m;;){if(!Mue(e))throw Error("Unmatched start-group tag: stream EOF");if(4==e.h){if(e.m!=t)throw Error("Unmatched end-group tag");break}Pw(e)}break;default:throw Aue(e.h,e.l)}}function $_(e,t,n){const r=e.g.l,i=ju(e.g),o=e.g.g+i;let s=o-r;if(s<=0&&(e.g.l=o,n(t,e,void 0,void 0,void 0),s=o-e.g.g),s)throw Error(`Message parsing ended unexpectedly. Expected to read ${i} bytes, instead read ${i-s} bytes, either the data ended unexpectedly or the message misreported its own length`);return e.g.g=o,e.g.l=r,t}function h9(e){var t=ju(e.g),n=Pue(e=e.g,t);if(e=e.h,Rze){var r,i=e;(r=Tx)||(r=Tx=new TextDecoder("utf-8",{fatal:!0})),t=n+t,i=0===n&&t===i.length?i:i.subarray(n,t);try{var o=r.decode(i)}catch(e){if(void 0===hE){try{r.decode(new Uint8Array([128]))}catch{}try{r.decode(new Uint8Array([97])),hE=!0}catch{hE=!1}}throw!hE&&(Tx=void 0),e}}else{t=(o=n)+t,n=[];let a,l=null;for(;o<t;){var s=e[o++];s<128?n.push(s):s<224?o>=t?vh():(a=e[o++],s<194||128!=(192&a)?(o--,vh()):n.push((31&s)<<6|63&a)):s<240?o>=t-1?vh():(a=e[o++],128!=(192&a)||224===s&&a<160||237===s&&a>=160||128!=(192&(r=e[o++]))?(o--,vh()):n.push((15&s)<<12|(63&a)<<6|63&r)):s<=244?o>=t-2?vh():(a=e[o++],128!=(192&a)||a-144+(s<<28)>>30||128!=(192&(r=e[o++]))||128!=(192&(i=e[o++]))?(o--,vh()):(s=(7&s)<<18|(63&a)<<12|(63&r)<<6|63&i,s-=65536,n.push(55296+(s>>10&1023),56320+(1023&s)))):vh(),n.length>=8192&&(l=ZK(l,n),n.length=0)}o=ZK(l,n)}return o}function Due(e){const t=ju(e.g);return Oue(e.g,t)}function hR(e,t,n){var r=ju(e.g);for(r=e.g.g+r;e.g.g<r;)n.push(t(e.g))}var pE=[];function sWe(e){return e}let Fg;function dc(e,t,n){t.g?t.m(e,t.g,t.h,n):t.m(e,t.h,n)}var qe=class{constructor(e,t){this.u=Cue(e,t)}toJSON(){const e=!Fg;try{return e&&(Fg=wue),Nue(this)}finally{e&&(Fg=void 0)}}l(){var e=BWe;return e.g?e.l(this,e.g,e.h,!0):e.l(this,e.h,e.defaultValue,!0)}clone(){const e=this.u;return new this.constructor(uR(e,0|e[Xe],!1))}N(){return!!(2&this.u[Xe])}};function Nue(e){var t=e.u;{t=(e=Fg(t))!==t;let c=e.length;if(c){var n=e[c-1],r=G8(n);r?c--:n=void 0;var i=e;if(r){e:{var o,s=n,a=!1;if(s)for(let e in s)isNaN(+e)?(o??(o={}))[e]=s[e]:(r=s[e],Array.isArray(r)&&(l3(r)||oz(r)&&0===r.size)&&(r=null),null==r&&(a=!0),null!=r&&((o??(o={}))[e]=r));if(a||(o=s),o)for(let e in o){a=o;break e}a=null}s=null==a?null!=n:a!==n}for(;c>0&&(null==(o=i[c-1])||l3(o)||oz(o)&&0===o.size);c--)var l=!0;(i!==e||s||l)&&(t?(l||s||a)&&(i.length=c):i=Array.prototype.slice.call(i,0,c),a&&i.push(a)),l=i}else l=e}return l}function yz(e){return e?/^\d+$/.test(e)?(aR(e),new X7(xn,mr)):null:oWe||(oWe=new X7(0,0))}qe.prototype.W=F_,qe.prototype.toString=function(){try{return Fg=sWe,Nue(this).toString()}finally{Fg=void 0}};var X7=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let oWe;function bz(e){return e?/^-?\d+$/.test(e)?(aR(e),new J7(xn,mr)):null:aWe||(aWe=new J7(0,0))}var J7=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let aWe;function $g(e,t,n){for(;n>0||t>127;)e.g.push(127&t|128),t=(t>>>7|n<<25)>>>0,n>>>=7;e.g.push(t)}function s1(e,t){for(;t>127;)e.g.push(127&t|128),t>>>=7;e.g.push(t)}function pR(e,t){if(t>=0)s1(e,t);else{for(let n=0;n<9;n++)e.g.push(127&t|128),t>>=7;e.g.push(1)}}function qb(e,t){e.g.push(t>>>0&255),e.g.push(t>>>8&255),e.g.push(t>>>16&255),e.g.push(t>>>24&255)}function wv(e,t){0!==t.length&&(e.l.push(t),e.h+=t.length)}function Ao(e,t,n){s1(e.g,8*t+n)}function p9(e,t){return Ao(e,t,2),t=e.g.end(),wv(e,t),t.push(e.h),t}function m9(e,t){var n=t.pop();for(n=e.h+e.g.length()-n;n>127;)t.push(127&n|128),n>>>=7,e.h++;t.push(n),e.h++}function mR(e,t,n){Ao(e,t,2),s1(e.g,n.length),wv(e,e.g.end()),wv(e,n)}function p3(e,t,n,r){null!=n&&(t=p9(e,t),r(n,e),m9(e,t))}function fc(){const e=class{constructor(){throw Error()}};return Object.setPrototypeOf(e,e.prototype),e}var g9=fc(),Uue=fc(),v9=fc(),y9=fc(),jue=fc(),Fue=fc(),b9=fc(),$ue=fc(),Bue=fc(),o1=class{constructor(e,t,n){this.g=e,this.h=t,e=g9,this.l=!!e&&n===e||!1}};function gR(e,t){return new o1(e,t,g9)}function Hue(e,t,n,r,i){p3(e,n,Kue(t,r),i)}const cWe=gR(function(e,t,n,r,i){return 2===e.h&&($_(e,c9(t,r,n),i),!0)},Hue),lWe=gR(function(e,t,n,r,i){return 2===e.h&&($_(e,c9(t,r,n,!0),i),!0)},Hue);var vR=Symbol(),_9=Symbol(),_z=Symbol(),Sz=Symbol();let Vue,que;function Op(e,t,n,r){var i=r[e];if(i)return i;(i={}).Pa=r,i.V=function(e){switch(typeof e){case"boolean":return Sue||(Sue=[0,void 0,!0]);case"number":return e>0?void 0:0===e?nWe||(nWe=[0,void 0]):[-e,void 0];case"string":return[0,e];case"object":return e}}(r[0]);var o=r[1];let s=1;o&&o.constructor===Object&&(i.ga=o,"function"==typeof(o=r[++s])&&(i.la=!0,Vue??(Vue=o),que??(que=r[s+1]),o=r[s+=2]));const a={};for(;o&&Array.isArray(o)&&o.length&&"number"==typeof o[0]&&o[0]>0;){for(var l=0;l<o.length;l++)a[o[l]]=o;o=r[++s]}for(l=1;void 0!==o;){let e;"number"==typeof o&&(l+=o,o=r[++s]);var c=void 0;if(o instanceof o1?e=o:(e=cWe,s--),null==e?void 0:e.l){o=r[++s],c=r;var u=s;"function"==typeof o&&(o=o(),c[u]=o),c=o}for(u=l+1,"number"==typeof(o=r[++s])&&o<0&&(u-=o,o=r[++s]);l<u;l++){const r=a[l];c?n(i,l,e,c,r):t(i,l,e,r)}}return r[e]=i}function Gue(e){return Array.isArray(e)?e[0]instanceof o1?e:[lWe,e]:[e,void 0]}function Kue(e,t){return e instanceof qe?e.u:Array.isArray(e)?cf(e,t,!1):void 0}function S9(e,t,n,r){const i=n.g;e[t]=r?(e,t,n)=>i(e,t,n,r):i}function E9(e,t,n,r,i){const o=n.g;let s,a;e[t]=(e,t,n)=>o(e,t,n,a||(a=Op(_9,S9,E9,r).V),s||(s=w9(r)),i)}function w9(e){let t=e[_z];if(null!=t)return t;const n=Op(_9,S9,E9,e);return t=n.la?(e,t)=>Vue(e,t,n):(e,t)=>{const r=0|e[Xe];for(;Mue(t)&&4!=t.h;){var i=t.m,o=n[i];if(null==o){var s=n.ga;s&&(s=s[i])&&null!=(s=uWe(s))&&(o=n[i]=s)}null!=o&&o(t,e,i)||(i=(o=t).l,Pw(o),o.fa?o=void 0:(s=o.g.g-i,o.g.g=i,o=Oue(o.g,s)),i=e,o&&((s=i[bv])?s.push(o):i[bv]=[o]))}return 16384&r&&t1(e),!0},e[_z]=t}function uWe(e){const t=(e=Gue(e))[0].g;if(e=e[1]){const n=w9(e),r=Op(_9,S9,E9,e).V;return(e,i,o)=>t(e,i,o,r,n)}return t}function yR(e,t,n){e[t]=n.h}function bR(e,t,n,r){let i,o;const s=n.h;e[t]=(e,t,n)=>s(e,t,n,o||(o=Op(vR,yR,bR,r).V),i||(i=zue(r)))}function zue(e){let t=e[Sz];if(!t){const n=Op(vR,yR,bR,e);t=(e,t)=>Wue(e,t,n),e[Sz]=t}return t}function Wue(e,t,n){for(var r=0|e[Xe],i=512&r?0:-1,o=e.length,s=512&r?1:0,a=o+(256&r?-1:0);s<a;s++){const r=e[s];if(null==r)continue;const o=s-i,a=Ez(n,o);a&&a(t,r,o)}if(256&r){r=e[o-1];for(const e in r)i=+e,Number.isNaN(i)||null!=(o=r[i])&&(a=Ez(n,i))&&a(t,o,i)}if(e=z8(e))for(wv(t,t.g.end()),n=0;n<e.length;n++)wv(t,H8(e[n])||new Uint8Array(0))}function Ez(e,t){var n=e[t];if(n)return n;if((n=e.ga)&&(n=n[t])){var r=(n=Gue(n))[0].h;if(n=n[1]){const t=zue(n),i=Op(vR,yR,bR,n).V;n=e.la?que(i,t):(e,n,o)=>r(e,n,o,i,t)}else n=r;return e[t]=n}}function a1(e,t){if(Array.isArray(t)){var n=0|t[Xe];if(4&n)return t;for(var r=0,i=0;r<t.length;r++){const n=e(t[r]);null!=n&&(t[i++]=n)}return i<r&&(t.length=i),jr(t,-12289&n|5),2&n&&Object.freeze(t),t}}function bs(e,t,n){return new o1(e,t,n)}function c1(e,t,n){return new o1(e,t,n)}function _s(e,t,n){sr(e,0|e[Xe],t,n)}var dWe=gR(function(e,t,n,r,i){return 2===e.h&&(e=$_(e,cf([void 0,void 0],r,!0),i),Ff(r=0|t[Xe]),(i=Ku(t,r,n))instanceof ya?2&i.L?((i=i.X()).push(e),sr(t,r,n,i)):i.Na(e):Array.isArray(i)?(2&i[Xe]&&sr(t,r,n,i=Rue(i)),i.push(e)):sr(t,r,n,[e]),!0)},function(e,t,n,r,i){if(t instanceof ya)t.forEach((t,o)=>{p3(e,n,cf([o,t],r,!1),i)});else if(Array.isArray(t))for(let o=0;o<t.length;o++){const s=t[o];Array.isArray(s)&&p3(e,n,cf(s,r,!1),i)}});function Yue(e,t,n){if(null!=(t=function(e){if(null==e)return e;const t=typeof e;if("bigint"===t)return String(Q8(64,e));if(lR(e)){if("string"===t)return e9(e);if("number"===t)return Z8(e)}}(t))&&("string"==typeof t&&bz(t),null!=t))switch(Ao(e,n,0),typeof t){case"number":e=e.g,_v(t),$g(e,xn,mr);break;case"bigint":n=BigInt.asUintN(64,t),n=new J7(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),$g(e.g,n.h,n.g);break;default:n=bz(t),$g(e.g,n.h,n.g)}}function Xue(e,t,n){null!=(t=n1(t))&&null!=t&&(Ao(e,n,0),pR(e.g,t))}function Jue(e,t,n){null!=(t=yue(t))&&(Ao(e,n,0),e.g.g.push(t?1:0))}function Que(e,t,n){null!=(t=Sv(t))&&mR(e,n,sue(t))}function Zue(e,t,n,r,i){p3(e,n,Kue(t,r),i)}function ede(e,t,n){null!=(t=null==t||"string"==typeof t||U_(t)||t instanceof Eu?t:void 0)&&mR(e,n,u9(t).buffer)}function tde(e,t,n){return(5===e.h||2===e.h)&&(t=i1(t,0|t[Xe],n,!1,!1),2==e.h?hR(e,Y7,t):t.push(Y7(e.g)),!0)}var Zl=bs(function(e,t,n){if(1!==e.h)return!1;var r=e.g;e=W7(r);const i=W7(r);r=2*(i>>31)+1;const o=i>>>20&2047;return e=4294967296*(1048575&i)+e,_s(t,n,2047==o?e?NaN:r*(1/0):0==o?5e-324*r*e:r*Math.pow(2,o-1075)*(e+4503599627370496)),!0},function(e,t,n){null!=(t=$f(t))&&(Ao(e,n,1),e=e.g,(n=vue||(vue=new DataView(new ArrayBuffer(8)))).setFloat64(0,+t,!0),xn=n.getUint32(0,!0),mr=n.getUint32(4,!0),qb(e,xn),qb(e,mr))},fc()),$r=bs(function(e,t,n){return 5===e.h&&(_s(t,n,Y7(e.g)),!0)},function(e,t,n){null!=(t=$f(t))&&(Ao(e,n,5),e=e.g,W8(t),qb(e,xn))},b9),fWe=c1(tde,function(e,t,n){if(null!=(t=a1($f,t)))for(let s=0;s<t.length;s++){var r=e,i=n,o=t[s];null!=o&&(Ao(r,i,5),r=r.g,W8(o),qb(r,xn))}},b9),C9=c1(tde,function(e,t,n){if(null!=(t=a1($f,t))&&t.length){Ao(e,n,2),s1(e.g,4*t.length);for(let r=0;r<t.length;r++)n=e.g,W8(t[r]),qb(n,xn)}},b9),Rf=bs(function(e,t,n){return 0===e.h&&(_s(t,n,d9(e.g,X8)),!0)},Yue,Fue),Mx=bs(function(e,t,n){return 0===e.h&&(_s(t,n,0===(e=d9(e.g,X8))?void 0:e),!0)},Yue,Fue),hWe=bs(function(e,t,n){return 0===e.h&&(_s(t,n,d9(e.g,Y8)),!0)},function(e,t,n){if(null!=(t=Wze(t))&&("string"==typeof t&&yz(t),null!=t))switch(Ao(e,n,0),typeof t){case"number":e=e.g,_v(t),$g(e,xn,mr);break;case"bigint":n=BigInt.asUintN(64,t),n=new X7(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),$g(e.g,n.h,n.g);break;default:n=yz(t),$g(e.g,n.h,n.g)}},fc()),yr=bs(function(e,t,n){return 0===e.h&&(_s(t,n,Tf(e.g)),!0)},Xue,y9),_R=c1(function(e,t,n){return(0===e.h||2===e.h)&&(t=i1(t,0|t[Xe],n,!1,!1),2==e.h?hR(e,Tf,t):t.push(Tf(e.g)),!0)},function(e,t,n){if(null!=(t=a1(n1,t))&&t.length){n=p9(e,n);for(let n=0;n<t.length;n++)pR(e.g,t[n]);m9(e,n)}},y9),fg=bs(function(e,t,n){return 0===e.h&&(_s(t,n,0===(e=Tf(e.g))?void 0:e),!0)},Xue,y9),Xn=bs(function(e,t,n){return 0===e.h&&(_s(t,n,f9(e.g)),!0)},Jue,Uue),Bg=bs(function(e,t,n){return 0===e.h&&(_s(t,n,!1===(e=f9(e.g))?void 0:e),!0)},Jue,Uue),Xi=c1(function(e,t,n){return 2===e.h&&(e=h9(e),i1(t,0|t[Xe],n,!1).push(e),!0)},function(e,t,n){if(null!=(t=a1(Sv,t)))for(let s=0;s<t.length;s++){var r=e,i=n,o=t[s];null!=o&&mR(r,i,sue(o))}},v9),Bd=bs(function(e,t,n){return 2===e.h&&(_s(t,n,""===(e=h9(e))?void 0:e),!0)},Que,v9),rn=bs(function(e,t,n){return 2===e.h&&(_s(t,n,h9(e)),!0)},Que,v9),Jr=function(e,t,n=g9){return new o1(e,t,n)}(function(e,t,n,r,i){return 2===e.h&&(r=cf(void 0,r,!0),i1(t,0|t[Xe],n,!0).push(r),$_(e,r,i),!0)},function(e,t,n,r,i){if(Array.isArray(t))for(let o=0;o<t.length;o++)Zue(e,t[o],n,r,i)}),dn=gR(function(e,t,n,r,i,o){return 2===e.h&&(Iue(t,0|t[Xe],o,n),$_(e,t=c9(t,r,n),i),!0)},Zue),nde=bs(function(e,t,n){return 2===e.h&&(_s(t,n,Due(e)),!0)},ede,$ue),pWe=c1(function(e,t,n){return(0===e.h||2===e.h)&&(t=i1(t,0|t[Xe],n,!1,!1),2==e.h?hR(e,ju,t):t.push(ju(e.g)),!0)},function(e,t,n){if(null!=(t=a1(bue,t)))for(let s=0;s<t.length;s++){var r=e,i=n,o=t[s];null!=o&&(Ao(r,i,0),s1(r.g,o))}},jue),mWe=bs(function(e,t,n){return 0===e.h&&(_s(t,n,0===(e=ju(e.g))?void 0:e),!0)},function(e,t,n){null!=(t=bue(t))&&null!=t&&(Ao(e,n,0),s1(e.g,t))},jue),_a=bs(function(e,t,n){return 0===e.h&&(_s(t,n,Tf(e.g)),!0)},function(e,t,n){null!=(t=n1(t))&&(t=parseInt(t,10),Ao(e,n,0),pR(e.g,t))},Bue);class gWe{constructor(e,t){this.h=e,this.g=t,this.l=Gt,this.m=Ze,this.defaultValue=void 0}}function hc(e,t){return new gWe(e,t)}function Bf(e,t){return(n,r)=>{if(pE.length){const e=pE.pop();e.o(r),Ox(e.g,n,r),n=e}else n=new class{constructor(e,t){if(vz.length){const n=vz.pop();Ox(n,e,t),e=n}else e=new class{constructor(e,t){this.h=null,this.m=!1,this.g=this.l=this.j=0,Ox(this,e,t)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ba=!1}}(e,t);this.g=e,this.l=this.g.g,this.h=this.m=-1,this.o(t)}o({fa:e=!1}={}){this.fa=e}}(n,r);try{const r=new e,o=r.u;w9(t)(o,n);var i=r}finally{n.g.clear(),n.m=-1,n.h=-1,pE.length<100&&pE.push(n)}return i}}function SR(e){return function(){const t=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const e=this.g;return this.g=[],e}}}};Wue(this.u,t,Op(vR,yR,bR,e)),wv(t,t.g.end());const n=new Uint8Array(t.h),r=t.l,i=r.length;let o=0;for(let e=0;e<i;e++){const t=r[e];n.set(t,o),o+=t.length}return t.l=[n],n}}var wz=class extends qe{constructor(e){super(e)}},Cz=[0,Bd,bs(function(e,t,n){return 2===e.h&&(_s(t,n,(e=Due(e))===hp()?void 0:e),!0)},function(e,t,n){if(null!=t){if(t instanceof qe){const r=t.Ra;return void(r&&(t=r(t),null!=t&&mR(e,n,u9(t).buffer)))}if(Array.isArray(t))return}ede(e,t,n)},$ue)];let Dx,Tz=globalThis.trustedTypes;function Rz(e){void 0===Dx&&(Dx=function(){let e=null;if(!Tz)return e;try{const t=e=>e;e=Tz.createPolicy("goog#html",{createHTML:t,createScript:t,createScriptURL:t})}catch{}return e}());var t=Dx;return new class{constructor(e){this.g=e}toString(){return this.g+""}}(t?t.createScriptURL(e):e)}function vWe(e,...t){if(0===t.length)return Rz(e[0]);let n=e[0];for(let r=0;r<t.length;r++)n+=encodeURIComponent(t[r])+e[r+1];return Rz(n)}var rde=[0,yr,_a,Xn,-1,_R,_a,-1],yWe=class extends qe{constructor(e){super(e)}},ide=[0,Xn,rn,Xn,_a,-1,c1(function(e,t,n){return(0===e.h||2===e.h)&&(t=i1(t,0|t[Xe],n,!1,!1),2==e.h?hR(e,iWe,t):t.push(Tf(e.g)),!0)},function(e,t,n){if(null!=(t=a1(n1,t))&&t.length){n=p9(e,n);for(let n=0;n<t.length;n++)pR(e.g,t[n]);m9(e,n)}},Bue),rn,-1,[0,Xn,-1],_a,Xn,-1],sde=[0,rn,-2],Iz=class extends qe{constructor(e){super(e)}},ode=[0],ade=[0,yr,Xn,1,Xn,-3],Io=class extends qe{constructor(e){super(e,2)}},Br={};Br[336783863]=[0,rn,Xn,-1,yr,[0,[1,2,3,4,5,6,7,8],dn,ode,dn,ide,dn,sde,dn,ade,dn,rde,dn,[0,rn,-2],dn,[0,rn,_a],dn,[0,_a,rn]],[0,rn],Xn,[0,[1,3],[2,4],dn,[0,_R],-1,dn,[0,Xi],-1,Jr,[0,rn,-1]],rn];var kz=[0,Mx,-1,Bg,-3,Mx,_R,Bd,fg,Mx,-1,Bg,fg,Bg,-2,Bd];function Lo(e,t){z7(e,2,r1(t),"")}function Un(e,t){fR(e,3,t)}function jt(e,t){fR(e,4,t)}var gs=class extends qe{constructor(e){super(e,500)}o(e){return Ze(this,0,7,e)}},qy=[-1,{}],xz=[0,rn,1,qy],Az=[0,rn,Xi,qy];function Po(e,t){f3(e,1,gs,t)}function Vn(e,t){fR(e,10,t)}function Wt(e,t){fR(e,15,t)}var Js=class extends qe{constructor(e){super(e,500)}o(e){return Ze(this,0,1001,e)}},cde=[-500,Jr,[-500,Bd,-1,Xi,-3,[-2,Br,Xn],Jr,Cz,fg,-1,xz,Az,Jr,[0,Bd,Bg],Bd,kz,fg,Xi,987,Xi],4,Jr,[-500,rn,-1,[-1,{}],998,rn],Jr,[-500,rn,Xi,-1,[-2,{},Xn],997,Xi,-1],fg,Jr,[-500,rn,Xi,qy,998,Xi],Xi,fg,xz,Az,Jr,[0,Bd,-1,qy],Xi,-2,kz,Bd,-1,Bg,[0,Bg,mWe],978,qy,Jr,Cz];Js.prototype.g=SR(cde);var bWe=Bf(Js,cde),_We=class extends qe{constructor(e){super(e)}},lde=class extends qe{constructor(e){super(e)}g(){return Uu(this,_We,1)}},ude=[0,Jr,[0,yr,$r,rn,-1]],ER=Bf(lde,ude),SWe=class extends qe{constructor(e){super(e)}},EWe=class extends qe{constructor(e){super(e)}},Nx=class extends qe{constructor(e){super(e)}h(){return Gt(this,SWe,2)}g(){return Uu(this,EWe,5)}},dde=Bf(class extends qe{constructor(e){super(e)}},[0,Xi,_R,C9,[0,_a,[0,yr,-3],[0,$r,-3],[0,yr,-1,[0,Jr,[0,yr,-2]]],Jr,[0,$r,-1,rn,$r]],rn,-1,Rf,Jr,[0,yr,$r],Xi,Rf]),fde=class extends qe{constructor(e){super(e)}},Hg=Bf(class extends qe{constructor(e){super(e)}},[0,Jr,[0,$r,-4]]),hde=class extends qe{constructor(e){super(e)}},B_=Bf(class extends qe{constructor(e){super(e)}},[0,Jr,[0,$r,-4]]),wWe=class extends qe{constructor(e){super(e)}},CWe=[0,yr,-1,C9,_a],pde=class extends qe{constructor(e){super(e)}};pde.prototype.g=SR([0,$r,-4,Rf]);var TWe=class extends qe{constructor(e){super(e)}},RWe=Bf(class extends qe{constructor(e){super(e)}},[0,Jr,[0,1,yr,rn,ude],Rf]),Lz=class extends qe{constructor(e){super(e)}},IWe=class extends qe{constructor(e){super(e)}oa(){return Tue(this)??hp()}},kWe=class extends qe{constructor(e){super(e)}},mde=[1,2],xWe=Bf(class extends qe{constructor(e){super(e)}},[0,Jr,[0,mde,dn,[0,C9],dn,[0,nde],yr,rn],Rf]),T9=class extends qe{constructor(e){super(e)}},gde=[0,rn,yr,$r,Xi,-1],Pz=class extends qe{constructor(e){super(e)}},AWe=[0,Xn,-1],Oz=class extends qe{constructor(e){super(e)}},Ow=[1,2,3,4,5],m3=class extends qe{constructor(e){super(e)}g(){return null!=Tue(this)}h(){return null!=ba(this,2)}},Qn=class extends qe{constructor(e){super(e)}g(){return yue(Ev(this,2))??!1}},vde=[0,nde,rn,[0,yr,Rf,-1],[0,hWe,Rf]],kr=[0,vde,Xn,[0,Ow,dn,ade,dn,ide,dn,rde,dn,ode,dn,sde],_a],wR=class extends qe{constructor(e){super(e)}},R9=[0,kr,$r,-1,yr],LWe=hc(502141897,wR);Br[502141897]=R9;var PWe=Bf(class extends qe{constructor(e){super(e)}},[0,[0,_a,-1,fWe,pWe],CWe]),yde=class extends qe{constructor(e){super(e)}},bde=class extends qe{constructor(e){super(e)}},I9=[0,kr,$r,[0,kr],Xn],_de=[0,kr,R9,I9,$r,[0,[0,vde]]],OWe=hc(508968150,bde);Br[508968150]=_de,Br[508968149]=I9;var Sde=class extends qe{constructor(e){super(e)}},MWe=hc(513916220,Sde);Br[513916220]=[0,kr,_de,yr];var jm=class extends qe{constructor(e){super(e)}h(){return Gt(this,T9,2)}g(){Nn(this,2)}},Ede=[0,kr,gde];Br[478825465]=Ede;var DWe=class extends qe{constructor(e){super(e)}},wde=class extends qe{constructor(e){super(e)}},k9=class extends qe{constructor(e){super(e)}},x9=class extends qe{constructor(e){super(e)}},Cde=class extends qe{constructor(e){super(e)}},Mz=[0,kr,[0,kr],Ede,-1],Tde=[0,kr,$r,yr],A9=[0,kr,$r],Rde=[0,kr,Tde,A9,$r],NWe=hc(479097054,Cde);Br[479097054]=[0,kr,Rde,Mz],Br[463370452]=Mz,Br[464864288]=Tde;var UWe=hc(462713202,x9);Br[462713202]=Rde,Br[474472470]=A9;var jWe=class extends qe{constructor(e){super(e)}},Ide=class extends qe{constructor(e){super(e)}},kde=class extends qe{constructor(e){super(e)}},xde=class extends qe{constructor(e){super(e)}},L9=[0,kr,$r,-1,yr],Q7=[0,kr,$r,Xn];xde.prototype.g=SR([0,kr,A9,[0,kr],R9,I9,L9,Q7]);var Ade=class extends qe{constructor(e){super(e)}},FWe=hc(456383383,Ade);Br[456383383]=[0,kr,gde];var Lde=class extends qe{constructor(e){super(e)}},$We=hc(476348187,Lde);Br[476348187]=[0,kr,AWe];var Pde=class extends qe{constructor(e){super(e)}},Dz=class extends qe{constructor(e){super(e)}},Ode=[0,_a,-1],BWe=hc(458105876,class extends qe{constructor(e){super(e)}g(){var e=this.u;const t=0|e[Xe],n=2&t;return e=function(e,t,n){var r=Dz;const i=2&t;let o=!1;if(null==n){if(i)return gz();n=[]}else if(n.constructor===ya){if(!(2&n.L)||i)return n;n=n.X()}else Array.isArray(n)?o=!!(2&n[Xe]):n=[];if(i){if(!n.length)return gz();o||(o=!0,t1(n))}else o&&(o=!1,n=Rue(n));return o||(64&n[Xe]?n[Xe]&=-33:32&t&&iR(n,32)),sr(e,t,2,r=new ya(n,r,Yze,void 0)),r}(e,t,Ku(e,t,2)),!n&&Dz&&(e.ra=!0),e}});Br[458105876]=[0,Ode,dWe,[!0,Rf,[0,rn,-1,Xi]]];var P9=class extends qe{constructor(e){super(e)}},Mde=hc(458105758,P9);Br[458105758]=[0,kr,rn,Ode];var Dde=class extends qe{constructor(e){super(e)}},HWe=hc(443442058,Dde);Br[443442058]=[0,kr,rn,yr,$r,Xi,-1,Xn,$r],Br[514774813]=L9;var Nde=class extends qe{constructor(e){super(e)}},VWe=hc(516587230,Nde);function Z7(e,t){return t=t?t.clone():new T9,void 0!==e.displayNamesLocale?Nn(t,1,r1(e.displayNamesLocale)):void 0===e.displayNamesLocale&&Nn(t,1),void 0!==e.maxResults?sl(t,2,e.maxResults):"maxResults"in e&&Nn(t,2),void 0!==e.scoreThreshold?Ge(t,3,e.scoreThreshold):"scoreThreshold"in e&&Nn(t,3),void 0!==e.categoryAllowlist?h3(t,4,e.categoryAllowlist):"categoryAllowlist"in e&&Nn(t,4),void 0!==e.categoryDenylist?h3(t,5,e.categoryDenylist):"categoryDenylist"in e&&Nn(t,5),t}function O9(e,t=-1,n=""){return{categories:e.map(e=>({index:la(e,1)??0??-1,score:Cr(e,2)??0,categoryName:ba(e,3)??""??"",displayName:ba(e,4)??""??""})),headIndex:t,headName:n}}function Ude(e){var t,n,r=Dh(e,3,$f,Mh()),i=Dh(e,2,n1,Mh()),o=Dh(e,1,Sv,Mh()),s=Dh(e,9,Sv,Mh());const a={categories:[],keypoints:[]};for(let e=0;e<r.length;e++)a.categories.push({score:r[e],index:i[e]??-1,categoryName:o[e]??"",displayName:s[e]??""});if((r=null==(t=Gt(e,Nx,4))?void 0:t.h())&&(a.boundingBox={originX:la(r,1)??0,originY:la(r,2)??0,width:la(r,3)??0,height:la(r,4)??0,angle:0}),null==(n=Gt(e,Nx,4))?void 0:n.g().length)for(const t of Gt(e,Nx,4).g())a.keypoints.push({x:Lw(t,1)??0,y:Lw(t,2)??0,score:Lw(t,4)??0,label:ba(t,3)??""});return a}function CR(e){const t=[];for(const n of Uu(e,hde,1))t.push({x:Cr(n,1)??0,y:Cr(n,2)??0,z:Cr(n,3)??0,visibility:Cr(n,4)??0});return t}function Gy(e){const t=[];for(const n of Uu(e,fde,1))t.push({x:Cr(n,1)??0,y:Cr(n,2)??0,z:Cr(n,3)??0,visibility:Cr(n,4)??0});return t}function Nz(e){return Array.from(e,e=>e>127?e-256:e)}function Uz(e,t){if(e.length!==t.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${e.length} vs. ${t.length}).`);let n=0,r=0,i=0;for(let o=0;o<e.length;o++)n+=e[o]*t[o],r+=e[o]*e[o],i+=t[o]*t[o];if(r<=0||i<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(r*i)}let mE;Br[516587230]=[0,kr,L9,Q7,$r],Br[518928384]=Q7;const qWe=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function jde(){if(void 0===mE)try{await WebAssembly.instantiate(qWe),mE=!0}catch{mE=!1}return mE}async function q0(e,t=vWe``){const n=await jde()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${t}/${e}_${n}.js`,wasmBinaryPath:`${t}/${e}_${n}.wasm`}}var Rh=class{};function Fde(){var e=navigator;return typeof OffscreenCanvas<"u"&&(!function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")}(e)||!!((e=e.userAgent.match(/Version\/([\d]+).*Safari/))&&e.length>=1&&Number(e[1])>=17))}async function jz(e){if("function"!=typeof importScripts){const t=document.createElement("script");return t.src=e.toString(),t.crossOrigin="anonymous",new Promise((e,n)=>{t.addEventListener("load",()=>{e()},!1),t.addEventListener("error",e=>{n(e)},!1),document.body.appendChild(t)})}importScripts(e.toString())}function $de(e){return void 0!==e.videoWidth?[e.videoWidth,e.videoHeight]:void 0!==e.naturalWidth?[e.naturalWidth,e.naturalHeight]:void 0!==e.displayWidth?[e.displayWidth,e.displayHeight]:[e.width,e.height]}function Ye(e,t,n){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(t=e.i.stringToNewUTF8(t)),e.i._free(t)}function Fz(e,t,n){if(!e.i.canvas)throw Error("No OpenGL canvas configured.");if(n?e.i._bindTextureToStream(n):e.i._bindTextureToCanvas(),!(n=e.i.canvas.getContext("webgl2")||e.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");e.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),e.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[r,i]=$de(t);return!e.l||r===e.i.canvas.width&&i===e.i.canvas.height||(e.i.canvas.width=r,e.i.canvas.height=i),[r,i]}function $z(e,t,n){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const r=new Uint32Array(t.length);for(let n=0;n<t.length;n++)r[n]=e.i.stringToNewUTF8(t[n]);t=e.i._malloc(4*r.length),e.i.HEAPU32.set(r,t>>2),n(t);for(const t of r)e.i._free(t);e.i._free(t)}function Tc(e,t,n){e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=n}function Ed(e,t,n){let r=[];e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=(e,t,i)=>{t?(n(r,i),r=[]):r.push(e)}}async function GWe(e,t,n,r){return e=await(async(e,t,n,r,i)=>{if(t&&await jz(t),!self.ModuleFactory||n&&(await jz(n),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&i&&((t=self.Module).locateFile=i.locateFile,i.mainScriptUrlOrBlob&&(t.mainScriptUrlOrBlob=i.mainScriptUrlOrBlob)),i=await self.ModuleFactory(self.Module||i),self.ModuleFactory=self.Module=void 0,new e(i,r)})(e,n.wasmLoaderPath,n.assetLoaderPath,t,{locateFile:e=>e.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&e.endsWith(".data")?n.assetBinaryPath.toString():e}),await e.o(r),e}function Ux(e,t){const n=Gt(e.baseOptions,m3,1)||new m3;"string"==typeof t?(Nn(n,2,r1(t)),Nn(n,1)):t instanceof Uint8Array&&(Nn(n,1,K8(t,!1)),Nn(n,2)),Ze(e.baseOptions,0,1,n)}function Bz(e){try{const t=e.G.length;if(1===t)throw Error(e.G[0].message);if(t>1)throw Error("Encountered multiple errors: "+e.G.map(e=>e.message).join(", "))}finally{e.G=[]}}function $e(e,t){e.B=Math.max(e.B,t)}function TR(e,t){e.A=new gs,Lo(e.A,"PassThroughCalculator"),Un(e.A,"free_memory"),jt(e.A,"free_memory_unused_out"),Vn(t,"free_memory"),Po(t,e.A)}function Cv(e,t){Un(e.A,t),jt(e.A,t+"_unused_out")}function RR(e){e.g.addBoolToStream(!0,"free_memory",e.B)}Rh.forVisionTasks=function(e){return q0("vision",e)},Rh.forTextTasks=function(e){return q0("text",e)},Rh.forGenAiExperimentalTasks=function(e){return q0("genai_experimental",e)},Rh.forGenAiTasks=function(e){return q0("genai",e)},Rh.forAudioTasks=function(e){return q0("audio",e)},Rh.isSimdSupported=function(){return jde()};var Mw=class{constructor(e){this.g=e,this.G=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(e,t=!0){var n,r,i,o,s,a;if(t){const t=e.baseOptions||{};if(null!=(n=e.baseOptions)&&n.modelAssetBuffer&&null!=(r=e.baseOptions)&&r.modelAssetPath)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!(null!=(i=Gt(this.baseOptions,m3,1))&&i.g()||null!=(o=Gt(this.baseOptions,m3,1))&&o.h()||null!=(s=e.baseOptions)&&s.modelAssetBuffer||null!=(a=e.baseOptions)&&a.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(e,t){let n=Gt(e.baseOptions,Oz,3);if(!n){var r=n=new Oz,i=new Iz;Vy(r,4,Ow,i)}"delegate"in t&&("GPU"===t.delegate?(t=n,r=new yWe,Vy(t,2,Ow,r)):(t=n,r=new Iz,Vy(t,4,Ow,r))),Ze(e.baseOptions,0,3,n)}(this,t),t.modelAssetPath)return fetch(t.modelAssetPath.toString()).then(e=>{if(e.ok)return e.arrayBuffer();throw Error(`Failed to fetch model: ${t.modelAssetPath} (${e.status})`)}).then(e=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(e),!0,!1,!1),Ux(this,"/model.dat"),this.m(),this.I()});if(t.modelAssetBuffer instanceof Uint8Array)Ux(this,t.modelAssetBuffer);else if(t.modelAssetBuffer)return async function(e){const t=[];for(var n=0;;){const{done:r,value:i}=await e.read();if(r)break;t.push(i),n+=i.length}if(0===t.length)return new Uint8Array(0);if(1===t.length)return t[0];e=new Uint8Array(n),n=0;for(const r of t)e.set(r,n),n+=r.length;return e}(t.modelAssetBuffer).then(e=>{Ux(this,e),this.m(),this.I()})}return this.m(),this.I(),Promise.resolve()}I(){}da(){let e;if(this.g.da(t=>{e=bWe(t)}),!e)throw Error("Failed to retrieve CalculatorGraphConfig");return e}setGraph(e,t){this.g.attachErrorListener((e,t)=>{this.G.push(Error(t))}),this.g.La(),this.g.setGraph(e,t),this.A=void 0,Bz(this)}finishProcessing(){this.g.finishProcessing(),Bz(this)}close(){this.A=void 0,this.g.closeGraph()}};function Cu(e,t){if(!e)throw Error(`Unable to obtain required WebGL resource: ${t}`);return e}Mw.prototype.close=Mw.prototype.close,function(e,t){e=e.split(".");var n,r=fp;for((e[0]in r||void 0===r.execScript||r.execScript("var "+e[0]));e.length&&(n=e.shift());)e.length||void 0===t?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=t}("TaskRunner",Mw);class KWe{constructor(e,t,n,r){this.g=e,this.h=t,this.m=n,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function Hz(e,t,n){const r=e.g;if(n=Cu(r.createShader(n),"Failed to create WebGL shader"),r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${r.getShaderInfoLog(n)}`);return r.attachShader(e.h,n),n}function Vz(e,t){const n=e.g,r=Cu(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(r);const i=Cu(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,i),n.enableVertexAttribArray(e.O),n.vertexAttribPointer(e.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const o=Cu(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,o),n.enableVertexAttribArray(e.I),n.vertexAttribPointer(e.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new KWe(n,r,i,o)}function M9(e,t){if(e.g){if(t!==e.g)throw Error("Cannot change GL context once initialized")}else e.g=t}function D9(e,t,n,r){return M9(e,t),e.h||(e.m(),e.C()),n?(e.s||(e.s=Vz(e,!0)),n=e.s):(e.v||(e.v=Vz(e,!1)),n=e.v),t.useProgram(e.h),n.bind(),e.l(),e=r(),n.g.bindVertexArray(null),e}function IR(e,t,n){return M9(e,t),e=Cu(t.createTexture(),"Failed to create texture"),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n??t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n??t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),e}function kR(e,t,n){M9(e,t),e.A||(e.A=Cu(t.createFramebuffer(),"Failed to create framebuffe.")),t.bindFramebuffer(t.FRAMEBUFFER,e.A),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}function N9(e){var t;null==(t=e.g)||t.bindFramebuffer(e.g.FRAMEBUFFER,null)}var U9=class{G(){return"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D inputTexture;\n  void main() {\n    gl_FragColor = texture2D(inputTexture, vTex);\n  }\n "}m(){const e=this.g;if(this.h=Cu(e.createProgram(),"Failed to create WebGL program"),this.aa=Hz(this,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",e.VERTEX_SHADER),this.Z=Hz(this,this.G(),e.FRAGMENT_SHADER),e.linkProgram(this.h),!e.getProgramParameter(this.h,e.LINK_STATUS))throw Error(`Error during program linking: ${e.getProgramInfoLog(this.h)}`);this.O=e.getAttribLocation(this.h,"aVertex"),this.I=e.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const e=this.g;e.deleteProgram(this.h),e.deleteShader(this.aa),e.deleteShader(this.Z)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function lu(e,t){switch(t){case 0:return e.g.find(e=>e instanceof Uint8Array);case 1:return e.g.find(e=>e instanceof Float32Array);case 2:return e.g.find(e=>typeof WebGLTexture<"u"&&e instanceof WebGLTexture);default:throw Error(`Type is not supported: ${t}`)}}function eP(e){var t=lu(e,1);if(!t){if(t=lu(e,0))t=new Float32Array(t).map(e=>e/255);else{t=new Float32Array(e.width*e.height);const r=Tv(e);var n=j9(e);if(kR(n,r,Bde(e)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){n=new Float32Array(e.width*e.height*4),r.readPixels(0,0,e.width,e.height,r.RGBA,r.FLOAT,n);for(let e=0,r=0;e<t.length;++e,r+=4)t[e]=n[r]}else r.readPixels(0,0,e.width,e.height,r.RED,r.FLOAT,t)}e.g.push(t)}return t}function Bde(e){let t=lu(e,2);if(!t){const n=Tv(e);t=Vde(e);const r=eP(e),i=Hde(e);n.texImage2D(n.TEXTURE_2D,0,i,e.width,e.height,0,n.RED,n.FLOAT,r),tP(e)}return t}function Tv(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=Cu(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function Hde(e){if(e=Tv(e),!gE)if(e.getExtension("EXT_color_buffer_float")&&e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_float_blend"))gE=e.R32F;else{if(!e.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");gE=e.R16F}return gE}function j9(e){return e.l||(e.l=new U9),e.l}function Vde(e){const t=Tv(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let n=lu(e,2);return n||(n=IR(j9(e),t,e.m?t.LINEAR:t.NEAREST),e.g.push(n),e.j=!0),t.bindTexture(t.TEXTURE_2D,n),n}function tP(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}var gE,di=class{constructor(e,t,n,r,i,o,s){this.g=e,this.m=t,this.j=n,this.canvas=r,this.l=i,this.width=o,this.height=s,this.j&&0===--qz&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Fa(){return!!lu(this,0)}ja(){return!!lu(this,1)}P(){return!!lu(this,2)}ia(){return(e=lu(this,0))||(e=eP(this),e=new Uint8Array(e.map(e=>255*e)),this.g.push(e)),e;var e}ha(){return eP(this)}M(){return Bde(this)}clone(){const e=[];for(const t of this.g){let n;if(t instanceof Uint8Array)n=new Uint8Array(t);else if(t instanceof Float32Array)n=new Float32Array(t);else{if(!(t instanceof WebGLTexture))throw Error(`Type is not supported: ${t}`);{const e=Tv(this),t=j9(this);e.activeTexture(e.TEXTURE1),n=IR(t,e,this.m?e.LINEAR:e.NEAREST),e.bindTexture(e.TEXTURE_2D,n);const r=Hde(this);e.texImage2D(e.TEXTURE_2D,0,r,this.width,this.height,0,e.RED,e.FLOAT,null),e.bindTexture(e.TEXTURE_2D,null),kR(t,e,n),D9(t,e,!1,()=>{Vde(this),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),tP(this)}),N9(t),tP(this)}}e.push(n)}return new di(e,this.m,this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Tv(this).deleteTexture(lu(this,2)),qz=-1}};di.prototype.close=di.prototype.close,di.prototype.clone=di.prototype.clone,di.prototype.getAsWebGLTexture=di.prototype.M,di.prototype.getAsFloat32Array=di.prototype.ha,di.prototype.getAsUint8Array=di.prototype.ia,di.prototype.hasWebGLTexture=di.prototype.P,di.prototype.hasFloat32Array=di.prototype.ja,di.prototype.hasUint8Array=di.prototype.Fa;var qz=250;function Vc(e,t){switch(t){case 0:return e.g.find(e=>e instanceof ImageData);case 1:return e.g.find(e=>typeof ImageBitmap<"u"&&e instanceof ImageBitmap);case 2:return e.g.find(e=>typeof WebGLTexture<"u"&&e instanceof WebGLTexture);default:throw Error(`Type is not supported: ${t}`)}}function qde(e){var t=Vc(e,0);if(!t){t=Rv(e);const n=xR(e),r=new Uint8Array(e.width*e.height*4);kR(n,t,Dw(e)),t.readPixels(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,r),N9(n),t=new ImageData(new Uint8ClampedArray(r.buffer),e.width,e.height),e.g.push(t)}return t}function Dw(e){let t=Vc(e,2);if(!t){const n=Rv(e);t=Nw(e);const r=Vc(e,1)||qde(e);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),py(e)}return t}function Rv(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=Cu(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function xR(e){return e.l||(e.l=new U9),e.l}function Nw(e){const t=Rv(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let n=Vc(e,2);return n||(n=IR(xR(e),t),e.g.push(n),e.m=!0),t.bindTexture(t.TEXTURE_2D,n),n}function py(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}function Gz(e){const t=Rv(e);return D9(xR(e),t,!0,()=>function(e,t){const n=e.canvas;if(n.width===e.width&&n.height===e.height)return t();const r=n.width,i=n.height;return n.width=e.width,n.height=e.height,e=t(),n.width=r,n.height=i,e}(e,()=>{if(t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),!(e.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return e.canvas.transferToImageBitmap()}))}var fi=class{constructor(e,t,n,r,i,o,s){this.g=e,this.j=t,this.m=n,this.canvas=r,this.l=i,this.width=o,this.height=s,(this.j||this.m)&&0===--Kz&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ea(){return!!Vc(this,0)}ka(){return!!Vc(this,1)}P(){return!!Vc(this,2)}Ca(){return qde(this)}Ba(){var e=Vc(this,1);return e||(Dw(this),Nw(this),e=Gz(this),py(this),this.g.push(e),this.j=!0),e}M(){return Dw(this)}clone(){const e=[];for(const t of this.g){let n;if(t instanceof ImageData)n=new ImageData(t.data,this.width,this.height);else if(t instanceof WebGLTexture){const e=Rv(this),t=xR(this);e.activeTexture(e.TEXTURE1),n=IR(t,e),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null),kR(t,e,n),D9(t,e,!1,()=>{Nw(this),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),py(this)}),N9(t),py(this)}else{if(!(t instanceof ImageBitmap))throw Error(`Type is not supported: ${t}`);Dw(this),Nw(this),n=Gz(this),py(this)}e.push(n)}return new fi(e,this.ka(),this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Vc(this,1).close(),this.m&&Rv(this).deleteTexture(Vc(this,2)),Kz=-1}};fi.prototype.close=fi.prototype.close,fi.prototype.clone=fi.prototype.clone,fi.prototype.getAsWebGLTexture=fi.prototype.M,fi.prototype.getAsImageBitmap=fi.prototype.Ba,fi.prototype.getAsImageData=fi.prototype.Ca,fi.prototype.hasWebGLTexture=fi.prototype.P,fi.prototype.hasImageBitmap=fi.prototype.ka,fi.prototype.hasImageData=fi.prototype.Ea;var Kz=250;function pc(...e){return e.map(([e,t])=>({start:e,end:t}))}const zWe=function(e){return class extends e{La(){this.i._registerModelResourcesGraphService()}}}((zz=class{constructor(e,t){this.l=!0,this.i=e,this.g=null,this.h=0,this.m="function"==typeof this.i._addIntToInputStream,void 0!==t?this.i.canvas=t:Fde()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(e){const t=await(await fetch(e)).arrayBuffer();e=!(e.endsWith(".pbtxt")||e.endsWith(".textproto")),this.setGraph(new Uint8Array(t),e)}setGraphFromString(e){this.setGraph((new TextEncoder).encode(e),!1)}setGraph(e,t){const n=e.length,r=this.i._malloc(n);this.i.HEAPU8.set(e,r),t?this.i._changeBinaryGraph(n,r):this.i._changeTextGraph(n,r),this.i._free(r)}configureAudio(e,t,n,r,i){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),Ye(this,r||"input_audio",r=>{Ye(this,i=i||"audio_header",i=>{this.i._configureAudio(r,i,e,t??0,n)})})}setAutoResizeCanvas(e){this.l=e}setAutoRenderToScreen(e){this.i._setAutoRenderToScreen(e)}setGpuBufferVerticalFlip(e){this.i.gpuOriginForWebTexturesIsBottomLeft=e}da(e){Tc(this,"__graph_config__",t=>{e(t)}),Ye(this,"__graph_config__",e=>{this.i._getGraphConfig(e,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(e){this.i.errorListener=e}attachEmptyPacketListener(e,t){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[e]=t}addAudioToStream(e,t,n){this.addAudioToStreamWithShape(e,0,0,t,n)}addAudioToStreamWithShape(e,t,n,r,i){const o=4*e.length;this.h!==o&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(o),this.h=o),this.i.HEAPF32.set(e,this.g/4),Ye(this,r,e=>{this.i._addAudioToInputStream(this.g,t,n,e,i)})}addGpuBufferToStream(e,t,n){Ye(this,t,t=>{const[r,i]=Fz(this,e,t);this.i._addBoundTextureToStream(t,r,i,n)})}addBoolToStream(e,t,n){Ye(this,t,t=>{this.i._addBoolToInputStream(e,t,n)})}addDoubleToStream(e,t,n){Ye(this,t,t=>{this.i._addDoubleToInputStream(e,t,n)})}addFloatToStream(e,t,n){Ye(this,t,t=>{this.i._addFloatToInputStream(e,t,n)})}addIntToStream(e,t,n){Ye(this,t,t=>{this.i._addIntToInputStream(e,t,n)})}addUintToStream(e,t,n){Ye(this,t,t=>{this.i._addUintToInputStream(e,t,n)})}addStringToStream(e,t,n){Ye(this,t,t=>{Ye(this,e,e=>{this.i._addStringToInputStream(e,t,n)})})}addStringRecordToStream(e,t,n){Ye(this,t,t=>{$z(this,Object.keys(e),r=>{$z(this,Object.values(e),i=>{this.i._addFlatHashMapToInputStream(r,i,Object.keys(e).length,t,n)})})})}addProtoToStream(e,t,n,r){Ye(this,n,n=>{Ye(this,t,t=>{const i=this.i._malloc(e.length);this.i.HEAPU8.set(e,i),this.i._addProtoToInputStream(i,e.length,t,n,r),this.i._free(i)})})}addEmptyPacketToStream(e,t){Ye(this,e,e=>{this.i._addEmptyPacketToInputStream(e,t)})}addBoolVectorToStream(e,t,n){Ye(this,t,t=>{const r=this.i._allocateBoolVector(e.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const t of e)this.i._addBoolVectorEntry(r,t);this.i._addBoolVectorToInputStream(r,t,n)})}addDoubleVectorToStream(e,t,n){Ye(this,t,t=>{const r=this.i._allocateDoubleVector(e.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const t of e)this.i._addDoubleVectorEntry(r,t);this.i._addDoubleVectorToInputStream(r,t,n)})}addFloatVectorToStream(e,t,n){Ye(this,t,t=>{const r=this.i._allocateFloatVector(e.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const t of e)this.i._addFloatVectorEntry(r,t);this.i._addFloatVectorToInputStream(r,t,n)})}addIntVectorToStream(e,t,n){Ye(this,t,t=>{const r=this.i._allocateIntVector(e.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const t of e)this.i._addIntVectorEntry(r,t);this.i._addIntVectorToInputStream(r,t,n)})}addUintVectorToStream(e,t,n){Ye(this,t,t=>{const r=this.i._allocateUintVector(e.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const t of e)this.i._addUintVectorEntry(r,t);this.i._addUintVectorToInputStream(r,t,n)})}addStringVectorToStream(e,t,n){Ye(this,t,t=>{const r=this.i._allocateStringVector(e.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const t of e)Ye(this,t,e=>{this.i._addStringVectorEntry(r,e)});this.i._addStringVectorToInputStream(r,t,n)})}addBoolToInputSidePacket(e,t){Ye(this,t,t=>{this.i._addBoolToInputSidePacket(e,t)})}addDoubleToInputSidePacket(e,t){Ye(this,t,t=>{this.i._addDoubleToInputSidePacket(e,t)})}addFloatToInputSidePacket(e,t){Ye(this,t,t=>{this.i._addFloatToInputSidePacket(e,t)})}addIntToInputSidePacket(e,t){Ye(this,t,t=>{this.i._addIntToInputSidePacket(e,t)})}addUintToInputSidePacket(e,t){Ye(this,t,t=>{this.i._addUintToInputSidePacket(e,t)})}addStringToInputSidePacket(e,t){Ye(this,t,t=>{Ye(this,e,e=>{this.i._addStringToInputSidePacket(e,t)})})}addProtoToInputSidePacket(e,t,n){Ye(this,n,n=>{Ye(this,t,t=>{const r=this.i._malloc(e.length);this.i.HEAPU8.set(e,r),this.i._addProtoToInputSidePacket(r,e.length,t,n),this.i._free(r)})})}addBoolVectorToInputSidePacket(e,t){Ye(this,t,t=>{const n=this.i._allocateBoolVector(e.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const t of e)this.i._addBoolVectorEntry(n,t);this.i._addBoolVectorToInputSidePacket(n,t)})}addDoubleVectorToInputSidePacket(e,t){Ye(this,t,t=>{const n=this.i._allocateDoubleVector(e.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const t of e)this.i._addDoubleVectorEntry(n,t);this.i._addDoubleVectorToInputSidePacket(n,t)})}addFloatVectorToInputSidePacket(e,t){Ye(this,t,t=>{const n=this.i._allocateFloatVector(e.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const t of e)this.i._addFloatVectorEntry(n,t);this.i._addFloatVectorToInputSidePacket(n,t)})}addIntVectorToInputSidePacket(e,t){Ye(this,t,t=>{const n=this.i._allocateIntVector(e.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const t of e)this.i._addIntVectorEntry(n,t);this.i._addIntVectorToInputSidePacket(n,t)})}addUintVectorToInputSidePacket(e,t){Ye(this,t,t=>{const n=this.i._allocateUintVector(e.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const t of e)this.i._addUintVectorEntry(n,t);this.i._addUintVectorToInputSidePacket(n,t)})}addStringVectorToInputSidePacket(e,t){Ye(this,t,t=>{const n=this.i._allocateStringVector(e.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const t of e)Ye(this,t,e=>{this.i._addStringVectorEntry(n,e)});this.i._addStringVectorToInputSidePacket(n,t)})}attachBoolListener(e,t){Tc(this,e,t),Ye(this,e,e=>{this.i._attachBoolListener(e)})}attachBoolVectorListener(e,t){Ed(this,e,t),Ye(this,e,e=>{this.i._attachBoolVectorListener(e)})}attachIntListener(e,t){Tc(this,e,t),Ye(this,e,e=>{this.i._attachIntListener(e)})}attachIntVectorListener(e,t){Ed(this,e,t),Ye(this,e,e=>{this.i._attachIntVectorListener(e)})}attachUintListener(e,t){Tc(this,e,t),Ye(this,e,e=>{this.i._attachUintListener(e)})}attachUintVectorListener(e,t){Ed(this,e,t),Ye(this,e,e=>{this.i._attachUintVectorListener(e)})}attachDoubleListener(e,t){Tc(this,e,t),Ye(this,e,e=>{this.i._attachDoubleListener(e)})}attachDoubleVectorListener(e,t){Ed(this,e,t),Ye(this,e,e=>{this.i._attachDoubleVectorListener(e)})}attachFloatListener(e,t){Tc(this,e,t),Ye(this,e,e=>{this.i._attachFloatListener(e)})}attachFloatVectorListener(e,t){Ed(this,e,t),Ye(this,e,e=>{this.i._attachFloatVectorListener(e)})}attachStringListener(e,t){Tc(this,e,t),Ye(this,e,e=>{this.i._attachStringListener(e)})}attachStringVectorListener(e,t){Ed(this,e,t),Ye(this,e,e=>{this.i._attachStringVectorListener(e)})}attachProtoListener(e,t,n){Tc(this,e,t),Ye(this,e,e=>{this.i._attachProtoListener(e,n||!1)})}attachProtoVectorListener(e,t,n){Ed(this,e,t),Ye(this,e,e=>{this.i._attachProtoVectorListener(e,n||!1)})}attachAudioListener(e,t,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),Tc(this,e,(e,n)=>{e=new Float32Array(e.buffer,e.byteOffset,e.length/4),t(e,n)}),Ye(this,e,e=>{this.i._attachAudioListener(e,n||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends zz{get ea(){return this.i}qa(e,t,n){Ye(this,t,t=>{const[r,i]=Fz(this,e,t);this.ea._addBoundTextureAsImageToStream(t,r,i,n)})}U(e,t){Tc(this,e,t),Ye(this,e,e=>{this.ea._attachImageListener(e)})}ca(e,t){Ed(this,e,t),Ye(this,e,e=>{this.ea._attachImageVectorListener(e)})}}));var zz,Ea=class extends zWe{};async function Nt(e,t,n){return async function(e,t,n,r){return GWe(e,t,n,r)}(e,n.canvas??(Fde()?void 0:document.createElement("canvas")),t,n)}function Gde(e,t,n,r){if(e.T){const o=new pde;if(null!=n&&n.regionOfInterest){if(!e.pa)throw Error("This task doesn't support region-of-interest.");var i=n.regionOfInterest;if(i.left>=i.right||i.top>=i.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(i.left<0||i.top<0||i.right>1||i.bottom>1)throw Error("Expected RectF values to be in [0,1].");Ge(o,1,(i.left+i.right)/2),Ge(o,2,(i.top+i.bottom)/2),Ge(o,4,i.right-i.left),Ge(o,3,i.bottom-i.top)}else Ge(o,1,.5),Ge(o,2,.5),Ge(o,4,1),Ge(o,3,1);if(null!=n&&n.rotationDegrees){if((null==n?void 0:n.rotationDegrees)%90!=0)throw Error("Expected rotation to be a multiple of 90°.");if(Ge(o,5,-Math.PI*n.rotationDegrees/180),(null==n?void 0:n.rotationDegrees)%180!=0){const[e,r]=$de(t);n=Cr(o,3)*r/e,i=Cr(o,4)*e/r,Ge(o,4,n),Ge(o,3,i)}}e.g.addProtoToStream(o.g(),"mediapipe.NormalizedRect",e.T,r)}e.g.qa(t,e.aa,r??performance.now()),e.finishProcessing()}function wa(e,t,n){var r;if(null!=(r=e.baseOptions)&&r.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");Gde(e,t,n,e.B+1)}function gl(e,t,n,r){var i;if(null==(i=e.baseOptions)||!i.g())throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");Gde(e,t,n,r)}function Iv(e,t,n,r){var i=t.data;const o=t.width,s=o*(t=t.height);if((i instanceof Uint8Array||i instanceof Float32Array)&&i.length!==s)throw Error("Unsupported channel count: "+i.length/s);return e=new di([i],n,!1,e.g.i.canvas,e.O,o,t),r?e.clone():e}var Ws=class extends Mw{constructor(e,t,n,r){super(e),this.g=e,this.aa=t,this.T=n,this.pa=r,this.O=new U9}l(e,t=!0){if("runningMode"in e&&Vb(this.baseOptions,2,!!e.runningMode&&"IMAGE"!==e.runningMode),void 0!==e.canvas&&this.g.i.canvas!==e.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(e,t)}close(){this.O.close(),super.close()}};Ws.prototype.close=Ws.prototype.close;var Wo=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect_in",!1),this.j={detections:[]},Ze(e=this.h=new wR,0,1,t=new Qn),Ge(this.h,2,.5),Ge(this.h,3,.3)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){return"minDetectionConfidence"in e&&Ge(this.h,2,e.minDetectionConfidence??.5),"minSuppressionThreshold"in e&&Ge(this.h,3,e.minSuppressionThreshold??.3),this.l(e)}D(e,t){return this.j={detections:[]},wa(this,e,t),this.j}F(e,t,n){return this.j={detections:[]},gl(this,e,n,t),this.j}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"norm_rect_in"),Wt(e,"detections");const t=new Io;dc(t,LWe,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),Un(n,"IMAGE:image_in"),Un(n,"NORM_RECT:norm_rect_in"),jt(n,"DETECTIONS:detections"),n.o(t),Po(e,n),this.g.attachProtoVectorListener("detections",(e,t)=>{for(const t of e)e=dde(t),this.j.detections.push(Ude(e));$e(this,t)}),this.g.attachEmptyPacketListener("detections",e=>{$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Wo.prototype.detectForVideo=Wo.prototype.F,Wo.prototype.detect=Wo.prototype.D,Wo.prototype.setOptions=Wo.prototype.o,Wo.createFromModelPath=async function(e,t){return Nt(Wo,e,{baseOptions:{modelAssetPath:t}})},Wo.createFromModelBuffer=function(e,t){return Nt(Wo,e,{baseOptions:{modelAssetBuffer:t}})},Wo.createFromOptions=function(e,t){return Nt(Wo,e,t)};var F9=pc([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),$9=pc([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),B9=pc([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),Kde=pc([474,475],[475,476],[476,477],[477,474]),H9=pc([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),V9=pc([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),zde=pc([469,470],[470,471],[471,472],[472,469]),q9=pc([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),Wde=[...F9,...$9,...B9,...H9,...V9,...q9],Yde=pc([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function Wz(e){e.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var dr=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,Ze(e=this.h=new bde,0,1,t=new Qn),this.v=new yde,Ze(this.h,0,3,this.v),this.s=new wR,Ze(this.h,0,2,this.s),sl(this.s,4,1),Ge(this.s,2,.5),Ge(this.v,2,.5),Ge(this.h,4,.5)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){return"numFaces"in e&&sl(this.s,4,e.numFaces??1),"minFaceDetectionConfidence"in e&&Ge(this.s,2,e.minFaceDetectionConfidence??.5),"minTrackingConfidence"in e&&Ge(this.h,4,e.minTrackingConfidence??.5),"minFacePresenceConfidence"in e&&Ge(this.v,2,e.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in e&&(this.outputFacialTransformationMatrixes=!!e.outputFacialTransformationMatrixes),this.l(e)}D(e,t){return Wz(this),wa(this,e,t),this.j}F(e,t,n){return Wz(this),gl(this,e,n,t),this.j}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"norm_rect"),Wt(e,"face_landmarks");const t=new Io;dc(t,OWe,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),Un(n,"IMAGE:image_in"),Un(n,"NORM_RECT:norm_rect"),jt(n,"NORM_LANDMARKS:face_landmarks"),n.o(t),Po(e,n),this.g.attachProtoVectorListener("face_landmarks",(e,t)=>{for(const t of e)e=B_(t),this.j.faceLandmarks.push(CR(e));$e(this,t)}),this.g.attachEmptyPacketListener("face_landmarks",e=>{$e(this,e)}),this.outputFaceBlendshapes&&(Wt(e,"blendshapes"),jt(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(e,t)=>{if(this.outputFaceBlendshapes)for(const t of e)e=ER(t),this.j.faceBlendshapes.push(O9(e.g()??[]));$e(this,t)}),this.g.attachEmptyPacketListener("blendshapes",e=>{$e(this,e)})),this.outputFacialTransformationMatrixes&&(Wt(e,"face_geometry"),jt(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(e,t)=>{if(this.outputFacialTransformationMatrixes)for(const t of e)(e=Gt(PWe(t),wWe,2))&&this.j.facialTransformationMatrixes.push({rows:la(e,1)??0??0,columns:la(e,2)??0??0,data:Dh(e,3,$f,Mh()).slice()??[]});$e(this,t)}),this.g.attachEmptyPacketListener("face_geometry",e=>{$e(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};dr.prototype.detectForVideo=dr.prototype.F,dr.prototype.detect=dr.prototype.D,dr.prototype.setOptions=dr.prototype.o,dr.createFromModelPath=function(e,t){return Nt(dr,e,{baseOptions:{modelAssetPath:t}})},dr.createFromModelBuffer=function(e,t){return Nt(dr,e,{baseOptions:{modelAssetBuffer:t}})},dr.createFromOptions=function(e,t){return Nt(dr,e,t)},dr.FACE_LANDMARKS_LIPS=F9,dr.FACE_LANDMARKS_LEFT_EYE=$9,dr.FACE_LANDMARKS_LEFT_EYEBROW=B9,dr.FACE_LANDMARKS_LEFT_IRIS=Kde,dr.FACE_LANDMARKS_RIGHT_EYE=H9,dr.FACE_LANDMARKS_RIGHT_EYEBROW=V9,dr.FACE_LANDMARKS_RIGHT_IRIS=zde,dr.FACE_LANDMARKS_FACE_OVAL=q9,dr.FACE_LANDMARKS_CONTOURS=Wde,dr.FACE_LANDMARKS_TESSELATION=Yde;var Rc=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect",!0),Ze(e=this.j=new Sde,0,1,t=new Qn)}get baseOptions(){return Gt(this.j,Qn,1)}set baseOptions(e){Ze(this.j,0,1,e)}o(e){return super.l(e)}Oa(e,t,n){const r="function"!=typeof t?t:{};if(this.h="function"==typeof t?t:n,wa(this,e,r??{}),!this.h)return this.s}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"norm_rect"),Wt(e,"stylized_image");const t=new Io;dc(t,MWe,this.j);const n=new gs;Lo(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),Un(n,"IMAGE:image_in"),Un(n,"NORM_RECT:norm_rect"),jt(n,"STYLIZED_IMAGE:stylized_image"),n.o(t),Po(e,n),this.g.U("stylized_image",(e,t)=>{var n=!this.h,r=e.data,i=e.width;const o=i*(e=e.height);if(r instanceof Uint8Array)if(r.length===3*o){const t=new Uint8ClampedArray(4*o);for(let e=0;e<o;++e)t[4*e]=r[3*e],t[4*e+1]=r[3*e+1],t[4*e+2]=r[3*e+2],t[4*e+3]=255;r=new ImageData(t,i,e)}else{if(r.length!==4*o)throw Error("Unsupported channel count: "+r.length/o);r=new ImageData(new Uint8ClampedArray(r.buffer,r.byteOffset,r.length),i,e)}else if(!(r instanceof WebGLTexture))throw Error(`Unsupported format: ${r.constructor.name}`);i=new fi([r],!1,!1,this.g.i.canvas,this.O,i,e),this.s=n=n?i.clone():i,this.h&&this.h(n),$e(this,t)}),this.g.attachEmptyPacketListener("stylized_image",e=>{this.s=null,this.h&&this.h(null),$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Rc.prototype.stylize=Rc.prototype.Oa,Rc.prototype.setOptions=Rc.prototype.o,Rc.createFromModelPath=function(e,t){return Nt(Rc,e,{baseOptions:{modelAssetPath:t}})},Rc.createFromModelBuffer=function(e,t){return Nt(Rc,e,{baseOptions:{modelAssetBuffer:t}})},Rc.createFromOptions=function(e,t){return Nt(Rc,e,t)};var G9=pc([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function Yz(e){e.gestures=[],e.landmarks=[],e.worldLandmarks=[],e.handedness=[]}function Xz(e){return 0===e.gestures.length?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:e.gestures,landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handedness:e.handedness,handednesses:e.handedness}}function Jz(e,t=!0){const n=[];for(const i of e){var r=ER(i);e=[];for(const n of r.g())r=t&&null!=la(n,1)?la(n,1)??0:-1,e.push({score:Cr(n,2)??0,index:r,categoryName:ba(n,3)??""??"",displayName:ba(n,4)??""??""});n.push(e)}return n}var co=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Ze(e=this.j=new Cde,0,1,t=new Qn),this.s=new x9,Ze(this.j,0,2,this.s),this.C=new k9,Ze(this.s,0,3,this.C),this.v=new wde,Ze(this.s,0,2,this.v),this.h=new DWe,Ze(this.j,0,3,this.h),Ge(this.v,2,.5),Ge(this.s,4,.5),Ge(this.C,2,.5)}get baseOptions(){return Gt(this.j,Qn,1)}set baseOptions(e){Ze(this.j,0,1,e)}o(e){var t,n,r,i;if(sl(this.v,3,e.numHands??1),"minHandDetectionConfidence"in e&&Ge(this.v,2,e.minHandDetectionConfidence??.5),"minTrackingConfidence"in e&&Ge(this.s,4,e.minTrackingConfidence??.5),"minHandPresenceConfidence"in e&&Ge(this.C,2,e.minHandPresenceConfidence??.5),e.cannedGesturesClassifierOptions){var o=new jm,s=o,a=Z7(e.cannedGesturesClassifierOptions,null==(t=Gt(this.h,jm,3))?void 0:t.h());Ze(s,0,2,a),Ze(this.h,0,3,o)}else void 0===e.cannedGesturesClassifierOptions&&(null==(n=Gt(this.h,jm,3))||n.g());return e.customGesturesClassifierOptions?(Ze(s=o=new jm,0,2,a=Z7(e.customGesturesClassifierOptions,null==(r=Gt(this.h,jm,4))?void 0:r.h())),Ze(this.h,0,4,o)):void 0===e.customGesturesClassifierOptions&&(null==(i=Gt(this.h,jm,4))||i.g()),this.l(e)}Ja(e,t){return Yz(this),wa(this,e,t),Xz(this)}Ka(e,t,n){return Yz(this),gl(this,e,n,t),Xz(this)}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"norm_rect"),Wt(e,"hand_gestures"),Wt(e,"hand_landmarks"),Wt(e,"world_hand_landmarks"),Wt(e,"handedness");const t=new Io;dc(t,NWe,this.j);const n=new gs;Lo(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),Un(n,"IMAGE:image_in"),Un(n,"NORM_RECT:norm_rect"),jt(n,"HAND_GESTURES:hand_gestures"),jt(n,"LANDMARKS:hand_landmarks"),jt(n,"WORLD_LANDMARKS:world_hand_landmarks"),jt(n,"HANDEDNESS:handedness"),n.o(t),Po(e,n),this.g.attachProtoVectorListener("hand_landmarks",(e,t)=>{for(const t of e){e=B_(t);const n=[];for(const t of Uu(e,hde,1))n.push({x:Cr(t,1)??0,y:Cr(t,2)??0,z:Cr(t,3)??0,visibility:Cr(t,4)??0});this.landmarks.push(n)}$e(this,t)}),this.g.attachEmptyPacketListener("hand_landmarks",e=>{$e(this,e)}),this.g.attachProtoVectorListener("world_hand_landmarks",(e,t)=>{for(const t of e){e=Hg(t);const n=[];for(const t of Uu(e,fde,1))n.push({x:Cr(t,1)??0,y:Cr(t,2)??0,z:Cr(t,3)??0,visibility:Cr(t,4)??0});this.worldLandmarks.push(n)}$e(this,t)}),this.g.attachEmptyPacketListener("world_hand_landmarks",e=>{$e(this,e)}),this.g.attachProtoVectorListener("hand_gestures",(e,t)=>{this.gestures.push(...Jz(e,!1)),$e(this,t)}),this.g.attachEmptyPacketListener("hand_gestures",e=>{$e(this,e)}),this.g.attachProtoVectorListener("handedness",(e,t)=>{this.handedness.push(...Jz(e)),$e(this,t)}),this.g.attachEmptyPacketListener("handedness",e=>{$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};function Qz(e){return{landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handednesses:e.handedness,handedness:e.handedness}}co.prototype.recognizeForVideo=co.prototype.Ka,co.prototype.recognize=co.prototype.Ja,co.prototype.setOptions=co.prototype.o,co.createFromModelPath=function(e,t){return Nt(co,e,{baseOptions:{modelAssetPath:t}})},co.createFromModelBuffer=function(e,t){return Nt(co,e,{baseOptions:{modelAssetBuffer:t}})},co.createFromOptions=function(e,t){return Nt(co,e,t)},co.HAND_CONNECTIONS=G9;var lo=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Ze(e=this.h=new x9,0,1,t=new Qn),this.s=new k9,Ze(this.h,0,3,this.s),this.j=new wde,Ze(this.h,0,2,this.j),sl(this.j,3,1),Ge(this.j,2,.5),Ge(this.s,2,.5),Ge(this.h,4,.5)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){return"numHands"in e&&sl(this.j,3,e.numHands??1),"minHandDetectionConfidence"in e&&Ge(this.j,2,e.minHandDetectionConfidence??.5),"minTrackingConfidence"in e&&Ge(this.h,4,e.minTrackingConfidence??.5),"minHandPresenceConfidence"in e&&Ge(this.s,2,e.minHandPresenceConfidence??.5),this.l(e)}D(e,t){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],wa(this,e,t),Qz(this)}F(e,t,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],gl(this,e,n,t),Qz(this)}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"norm_rect"),Wt(e,"hand_landmarks"),Wt(e,"world_hand_landmarks"),Wt(e,"handedness");const t=new Io;dc(t,UWe,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),Un(n,"IMAGE:image_in"),Un(n,"NORM_RECT:norm_rect"),jt(n,"LANDMARKS:hand_landmarks"),jt(n,"WORLD_LANDMARKS:world_hand_landmarks"),jt(n,"HANDEDNESS:handedness"),n.o(t),Po(e,n),this.g.attachProtoVectorListener("hand_landmarks",(e,t)=>{for(const t of e)e=B_(t),this.landmarks.push(CR(e));$e(this,t)}),this.g.attachEmptyPacketListener("hand_landmarks",e=>{$e(this,e)}),this.g.attachProtoVectorListener("world_hand_landmarks",(e,t)=>{for(const t of e)e=Hg(t),this.worldLandmarks.push(Gy(e));$e(this,t)}),this.g.attachEmptyPacketListener("world_hand_landmarks",e=>{$e(this,e)}),this.g.attachProtoVectorListener("handedness",(e,t)=>{var n=this.handedness,r=n.push;const i=[];for(const t of e){e=ER(t);const n=[];for(const t of e.g())n.push({score:Cr(t,2)??0,index:la(t,1)??0??-1,categoryName:ba(t,3)??""??"",displayName:ba(t,4)??""??""});i.push(n)}r.call(n,...i),$e(this,t)}),this.g.attachEmptyPacketListener("handedness",e=>{$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};lo.prototype.detectForVideo=lo.prototype.F,lo.prototype.detect=lo.prototype.D,lo.prototype.setOptions=lo.prototype.o,lo.createFromModelPath=function(e,t){return Nt(lo,e,{baseOptions:{modelAssetPath:t}})},lo.createFromModelBuffer=function(e,t){return Nt(lo,e,{baseOptions:{modelAssetBuffer:t}})},lo.createFromOptions=function(e,t){return Nt(lo,e,t)},lo.HAND_CONNECTIONS=G9;var Xde=pc([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function Zz(e){e.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function eW(e){try{if(!e.C)return e.h;e.C(e.h)}finally{RR(e)}}function vE(e,t){e=B_(e),t.push(CR(e))}var zn=class extends Ws{constructor(e,t){super(new Ea(e,t),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,Ze(e=this.j=new xde,0,1,t=new Qn),this.J=new k9,Ze(this.j,0,2,this.J),this.Z=new jWe,Ze(this.j,0,3,this.Z),this.s=new wR,Ze(this.j,0,4,this.s),this.H=new yde,Ze(this.j,0,5,this.H),this.v=new Ide,Ze(this.j,0,6,this.v),this.K=new kde,Ze(this.j,0,7,this.K),Ge(this.s,2,.5),Ge(this.s,3,.3),Ge(this.H,2,.5),Ge(this.v,2,.5),Ge(this.v,3,.3),Ge(this.K,2,.5),Ge(this.J,2,.5)}get baseOptions(){return Gt(this.j,Qn,1)}set baseOptions(e){Ze(this.j,0,1,e)}o(e){return"minFaceDetectionConfidence"in e&&Ge(this.s,2,e.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in e&&Ge(this.s,3,e.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in e&&Ge(this.H,2,e.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"minPoseDetectionConfidence"in e&&Ge(this.v,2,e.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in e&&Ge(this.v,3,e.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in e&&Ge(this.K,2,e.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in e&&(this.outputPoseSegmentationMasks=!!e.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in e&&Ge(this.J,2,e.minHandLandmarksConfidence??.5),this.l(e)}D(e,t,n){const r="function"!=typeof t?t:{};return this.C="function"==typeof t?t:n,Zz(this),wa(this,e,r),eW(this)}F(e,t,n,r){const i="function"!=typeof n?n:{};return this.C="function"==typeof n?n:r,Zz(this),gl(this,e,i,t),eW(this)}m(){var e=new Js;Vn(e,"input_frames_image"),Wt(e,"pose_landmarks"),Wt(e,"pose_world_landmarks"),Wt(e,"face_landmarks"),Wt(e,"left_hand_landmarks"),Wt(e,"left_hand_world_landmarks"),Wt(e,"right_hand_landmarks"),Wt(e,"right_hand_world_landmarks");const t=new Io,n=new wz;z7(n,1,r1("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(e,t){if(null!=t)if(Array.isArray(t))Nn(e,2,wue(t));else{if(!("string"==typeof t||t instanceof Eu||U_(t)))throw Error("invalid value in Any.value field: "+t+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");z7(e,2,K8(t,!1),hp())}}(n,this.j.g());const r=new gs;Lo(r,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),f3(r,8,wz,n),Un(r,"IMAGE:input_frames_image"),jt(r,"POSE_LANDMARKS:pose_landmarks"),jt(r,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),jt(r,"FACE_LANDMARKS:face_landmarks"),jt(r,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),jt(r,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),jt(r,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),jt(r,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),r.o(t),Po(e,r),TR(this,e),this.g.attachProtoListener("pose_landmarks",(e,t)=>{vE(e,this.h.poseLandmarks),$e(this,t)}),this.g.attachEmptyPacketListener("pose_landmarks",e=>{$e(this,e)}),this.g.attachProtoListener("pose_world_landmarks",(e,t)=>{var n=this.h.poseWorldLandmarks;e=Hg(e),n.push(Gy(e)),$e(this,t)}),this.g.attachEmptyPacketListener("pose_world_landmarks",e=>{$e(this,e)}),this.outputPoseSegmentationMasks&&(jt(r,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),Cv(this,"pose_segmentation_mask"),this.g.U("pose_segmentation_mask",(e,t)=>{this.h.poseSegmentationMasks=[Iv(this,e,!0,!this.C)],$e(this,t)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",e=>{this.h.poseSegmentationMasks=[],$e(this,e)})),this.g.attachProtoListener("face_landmarks",(e,t)=>{vE(e,this.h.faceLandmarks),$e(this,t)}),this.g.attachEmptyPacketListener("face_landmarks",e=>{$e(this,e)}),this.outputFaceBlendshapes&&(Wt(e,"extra_blendshapes"),jt(r,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(e,t)=>{var n=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(e=ER(e),n.push(O9(e.g()??[]))),$e(this,t)}),this.g.attachEmptyPacketListener("extra_blendshapes",e=>{$e(this,e)})),this.g.attachProtoListener("left_hand_landmarks",(e,t)=>{vE(e,this.h.leftHandLandmarks),$e(this,t)}),this.g.attachEmptyPacketListener("left_hand_landmarks",e=>{$e(this,e)}),this.g.attachProtoListener("left_hand_world_landmarks",(e,t)=>{var n=this.h.leftHandWorldLandmarks;e=Hg(e),n.push(Gy(e)),$e(this,t)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",e=>{$e(this,e)}),this.g.attachProtoListener("right_hand_landmarks",(e,t)=>{vE(e,this.h.rightHandLandmarks),$e(this,t)}),this.g.attachEmptyPacketListener("right_hand_landmarks",e=>{$e(this,e)}),this.g.attachProtoListener("right_hand_world_landmarks",(e,t)=>{var n=this.h.rightHandWorldLandmarks;e=Hg(e),n.push(Gy(e)),$e(this,t)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",e=>{$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};zn.prototype.detectForVideo=zn.prototype.F,zn.prototype.detect=zn.prototype.D,zn.prototype.setOptions=zn.prototype.o,zn.createFromModelPath=function(e,t){return Nt(zn,e,{baseOptions:{modelAssetPath:t}})},zn.createFromModelBuffer=function(e,t){return Nt(zn,e,{baseOptions:{modelAssetBuffer:t}})},zn.createFromOptions=function(e,t){return Nt(zn,e,t)},zn.HAND_CONNECTIONS=G9,zn.POSE_CONNECTIONS=Xde,zn.FACE_LANDMARKS_LIPS=F9,zn.FACE_LANDMARKS_LEFT_EYE=$9,zn.FACE_LANDMARKS_LEFT_EYEBROW=B9,zn.FACE_LANDMARKS_LEFT_IRIS=Kde,zn.FACE_LANDMARKS_RIGHT_EYE=H9,zn.FACE_LANDMARKS_RIGHT_EYEBROW=V9,zn.FACE_LANDMARKS_RIGHT_IRIS=zde,zn.FACE_LANDMARKS_FACE_OVAL=q9,zn.FACE_LANDMARKS_CONTOURS=Wde,zn.FACE_LANDMARKS_TESSELATION=Yde;var Yo=class extends Ws{constructor(e,t){super(new Ea(e,t),"input_image","norm_rect",!0),this.j={classifications:[]},Ze(e=this.h=new Ade,0,1,t=new Qn)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){return Ze(this.h,0,2,Z7(e,Gt(this.h,T9,2))),this.l(e)}sa(e,t){return this.j={classifications:[]},wa(this,e,t),this.j}ta(e,t,n){return this.j={classifications:[]},gl(this,e,n,t),this.j}m(){var e=new Js;Vn(e,"input_image"),Vn(e,"norm_rect"),Wt(e,"classifications");const t=new Io;dc(t,FWe,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),Un(n,"IMAGE:input_image"),Un(n,"NORM_RECT:norm_rect"),jt(n,"CLASSIFICATIONS:classifications"),n.o(t),Po(e,n),this.g.attachProtoListener("classifications",(e,t)=>{this.j=function(e){const t={classifications:Uu(e,TWe,1).map(e=>{var t;return O9((null==(t=Gt(e,lde,4))?void 0:t.g())??[],la(e,2)??0,ba(e,3)??"")})};return null!=d3(Ev(e,2))&&(t.timestampMs=d3(Ev(e,2))??0),t}(RWe(e)),$e(this,t)}),this.g.attachEmptyPacketListener("classifications",e=>{$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Yo.prototype.classifyForVideo=Yo.prototype.ta,Yo.prototype.classify=Yo.prototype.sa,Yo.prototype.setOptions=Yo.prototype.o,Yo.createFromModelPath=function(e,t){return Nt(Yo,e,{baseOptions:{modelAssetPath:t}})},Yo.createFromModelBuffer=function(e,t){return Nt(Yo,e,{baseOptions:{modelAssetBuffer:t}})},Yo.createFromOptions=function(e,t){return Nt(Yo,e,t)};var uo=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect",!0),this.h=new Lde,this.embeddings={embeddings:[]},Ze(e=this.h,0,1,t=new Qn)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){var t=this.h,n=Gt(this.h,Pz,2);return n=n?n.clone():new Pz,void 0!==e.l2Normalize?Vb(n,1,e.l2Normalize):"l2Normalize"in e&&Nn(n,1),void 0!==e.quantize?Vb(n,2,e.quantize):"quantize"in e&&Nn(n,2),Ze(t,0,2,n),this.l(e)}za(e,t){return wa(this,e,t),this.embeddings}Aa(e,t,n){return gl(this,e,n,t),this.embeddings}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"norm_rect"),Wt(e,"embeddings_out");const t=new Io;dc(t,$We,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),Un(n,"IMAGE:image_in"),Un(n,"NORM_RECT:norm_rect"),jt(n,"EMBEDDINGS:embeddings_out"),n.o(t),Po(e,n),this.g.attachProtoListener("embeddings_out",(e,t)=>{var n;e=xWe(e),this.embeddings={embeddings:Uu(n=e,kWe,1).map(e=>{var t,n;const r={headIndex:la(e,3)??0??-1,headName:ba(e,4)??""??""};if(void 0!==kue(e,Lz,Px(e,1)))e=Dh(e=Gt(e,Lz,Px(e,1)),1,$f,Mh()),r.floatEmbedding=e.slice();else{const i=new Uint8Array(0);r.quantizedEmbedding=(null==(n=null==(t=Gt(e,IWe,Px(e,2)))?void 0:t.oa())?void 0:n.h())??i}return r}),timestampMs:d3(Ev(n,2))??0},$e(this,t)}),this.g.attachEmptyPacketListener("embeddings_out",e=>{$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};uo.cosineSimilarity=function(e,t){if(e.floatEmbedding&&t.floatEmbedding)e=Uz(e.floatEmbedding,t.floatEmbedding);else{if(!e.quantizedEmbedding||!t.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");e=Uz(Nz(e.quantizedEmbedding),Nz(t.quantizedEmbedding))}return e},uo.prototype.embedForVideo=uo.prototype.Aa,uo.prototype.embed=uo.prototype.za,uo.prototype.setOptions=uo.prototype.o,uo.createFromModelPath=function(e,t){return Nt(uo,e,{baseOptions:{modelAssetPath:t}})},uo.createFromModelBuffer=function(e,t){return Nt(uo,e,{baseOptions:{modelAssetBuffer:t}})},uo.createFromOptions=function(e,t){return Nt(uo,e,t)};var nP=class{constructor(e,t,n){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=n}close(){var e,t;null==(e=this.confidenceMasks)||e.forEach(e=>{e.close()}),null==(t=this.categoryMask)||t.close()}};function tW(e){e.categoryMask=void 0,e.confidenceMasks=void 0,e.qualityScores=void 0}function nW(e){try{const t=new nP(e.confidenceMasks,e.categoryMask,e.qualityScores);if(!e.j)return t;e.j(t)}finally{RR(e)}}nP.prototype.close=nP.prototype.close;var Wi=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new P9,this.v=new Pde,Ze(this.h,0,3,this.v),Ze(e=this.h,0,1,t=new Qn)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){return void 0!==e.displayNamesLocale?Nn(this.h,2,r1(e.displayNamesLocale)):"displayNamesLocale"in e&&Nn(this.h,2),"outputCategoryMask"in e&&(this.outputCategoryMask=e.outputCategoryMask??!1),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=e.outputConfidenceMasks??!0),super.l(e)}I(){!function(e){var t,n;const r=Uu(e.da(),gs,1).filter(e=>(ba(e,1)??"").includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(e.s=[],r.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");1===r.length&&((null==(n=null==(t=Gt(r[0],Io,7))?void 0:t.l())?void 0:n.g())??new Map).forEach((t,n)=>{e.s[Number(n)]=ba(t,1)??""})}(this)}segment(e,t,n){const r="function"!=typeof t?t:{};return this.j="function"==typeof t?t:n,tW(this),wa(this,e,r),nW(this)}Ma(e,t,n,r){const i="function"!=typeof n?n:{};return this.j="function"==typeof n?n:r,tW(this),gl(this,e,i,t),nW(this)}Da(){return this.s}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"norm_rect");const t=new Io;dc(t,Mde,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),Un(n,"IMAGE:image_in"),Un(n,"NORM_RECT:norm_rect"),n.o(t),Po(e,n),TR(this,e),this.outputConfidenceMasks&&(Wt(e,"confidence_masks"),jt(n,"CONFIDENCE_MASKS:confidence_masks"),Cv(this,"confidence_masks"),this.g.ca("confidence_masks",(e,t)=>{this.confidenceMasks=e.map(e=>Iv(this,e,!0,!this.j)),$e(this,t)}),this.g.attachEmptyPacketListener("confidence_masks",e=>{this.confidenceMasks=[],$e(this,e)})),this.outputCategoryMask&&(Wt(e,"category_mask"),jt(n,"CATEGORY_MASK:category_mask"),Cv(this,"category_mask"),this.g.U("category_mask",(e,t)=>{this.categoryMask=Iv(this,e,!1,!this.j),$e(this,t)}),this.g.attachEmptyPacketListener("category_mask",e=>{this.categoryMask=void 0,$e(this,e)})),Wt(e,"quality_scores"),jt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(e,t)=>{this.qualityScores=e,$e(this,t)}),this.g.attachEmptyPacketListener("quality_scores",e=>{this.categoryMask=void 0,$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Wi.prototype.getLabels=Wi.prototype.Da,Wi.prototype.segmentForVideo=Wi.prototype.Ma,Wi.prototype.segment=Wi.prototype.segment,Wi.prototype.setOptions=Wi.prototype.o,Wi.createFromModelPath=function(e,t){return Nt(Wi,e,{baseOptions:{modelAssetPath:t}})},Wi.createFromModelBuffer=function(e,t){return Nt(Wi,e,{baseOptions:{modelAssetBuffer:t}})},Wi.createFromOptions=function(e,t){return Nt(Wi,e,t)};var rP=class{constructor(e,t,n){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=n}close(){var e,t;null==(e=this.confidenceMasks)||e.forEach(e=>{e.close()}),null==(t=this.categoryMask)||t.close()}};rP.prototype.close=rP.prototype.close;var WWe=class extends qe{constructor(e){super(e)}},Fm=[0,yr,-2],g3=[0,Zl,-3,Xn,Zl,-1],rW=[0,g3],iW=[0,g3,yr,-1],jx=class extends qe{constructor(e){super(e)}},sW=[0,Zl,-1,Xn],YWe=class extends qe{constructor(e){super(e)}},oW=class extends qe{constructor(e){super(e)}},iP=[1,2,3,4,5,6,7,8,9,10,14,15],Jde=class extends qe{constructor(e){super(e)}};Jde.prototype.g=SR([0,Jr,[0,iP,dn,g3,dn,[0,g3,Fm],dn,rW,dn,[0,rW,Fm],dn,sW,dn,[0,Zl,-3,Xn,_a],dn,[0,Zl,-3,Xn],dn,[0,rn,Zl,-2,Xn,yr,Xn,-1,2,Zl,Fm],dn,iW,dn,[0,iW,Fm],Zl,Fm,rn,dn,[0,Zl,-3,Xn,Fm,-1],dn,[0,Jr,sW]],rn,[0,rn,yr,-1,Xn]]);var Ic=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new P9,this.s=new Pde,Ze(this.h,0,3,this.s),Ze(e=this.h,0,1,t=new Qn)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){return"outputCategoryMask"in e&&(this.outputCategoryMask=e.outputCategoryMask??!1),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=e.outputConfidenceMasks??!0),super.l(e)}segment(e,t,n,r){const i="function"!=typeof n?n:{};this.j="function"==typeof n?n:r,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.B+1,r=new Jde;const o=new oW;var s=new WWe;if(sl(s,1,255),Ze(o,0,12,s),t.keypoint&&t.scribble)throw Error("Cannot provide both keypoint and scribble.");if(t.keypoint){var a=new jx;Vb(a,3,!0),Ge(a,1,t.keypoint.x),Ge(a,2,t.keypoint.y),Vy(o,5,iP,a)}else{if(!t.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(s=new YWe,t.scribble))Vb(t=new jx,3,!0),Ge(t,1,a.x),Ge(t,2,a.y),f3(s,1,jx,t);Vy(o,15,iP,s)}f3(r,1,oW,o),this.g.addProtoToStream(r.g(),"drishti.RenderData","roi_in",n),wa(this,e,i);e:{try{const e=new rP(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=e;break e}this.j(e)}finally{RR(this)}l=void 0}return l}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"roi_in"),Vn(e,"norm_rect_in");const t=new Io;dc(t,Mde,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),Un(n,"IMAGE:image_in"),Un(n,"ROI:roi_in"),Un(n,"NORM_RECT:norm_rect_in"),n.o(t),Po(e,n),TR(this,e),this.outputConfidenceMasks&&(Wt(e,"confidence_masks"),jt(n,"CONFIDENCE_MASKS:confidence_masks"),Cv(this,"confidence_masks"),this.g.ca("confidence_masks",(e,t)=>{this.confidenceMasks=e.map(e=>Iv(this,e,!0,!this.j)),$e(this,t)}),this.g.attachEmptyPacketListener("confidence_masks",e=>{this.confidenceMasks=[],$e(this,e)})),this.outputCategoryMask&&(Wt(e,"category_mask"),jt(n,"CATEGORY_MASK:category_mask"),Cv(this,"category_mask"),this.g.U("category_mask",(e,t)=>{this.categoryMask=Iv(this,e,!1,!this.j),$e(this,t)}),this.g.attachEmptyPacketListener("category_mask",e=>{this.categoryMask=void 0,$e(this,e)})),Wt(e,"quality_scores"),jt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(e,t)=>{this.qualityScores=e,$e(this,t)}),this.g.attachEmptyPacketListener("quality_scores",e=>{this.categoryMask=void 0,$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Ic.prototype.segment=Ic.prototype.segment,Ic.prototype.setOptions=Ic.prototype.o,Ic.createFromModelPath=function(e,t){return Nt(Ic,e,{baseOptions:{modelAssetPath:t}})},Ic.createFromModelBuffer=function(e,t){return Nt(Ic,e,{baseOptions:{modelAssetBuffer:t}})},Ic.createFromOptions=function(e,t){return Nt(Ic,e,t)};var Xo=class extends Ws{constructor(e,t){super(new Ea(e,t),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},Ze(e=this.h=new Dde,0,1,t=new Qn)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){return void 0!==e.displayNamesLocale?Nn(this.h,2,r1(e.displayNamesLocale)):"displayNamesLocale"in e&&Nn(this.h,2),void 0!==e.maxResults?sl(this.h,3,e.maxResults):"maxResults"in e&&Nn(this.h,3),void 0!==e.scoreThreshold?Ge(this.h,4,e.scoreThreshold):"scoreThreshold"in e&&Nn(this.h,4),void 0!==e.categoryAllowlist?h3(this.h,5,e.categoryAllowlist):"categoryAllowlist"in e&&Nn(this.h,5),void 0!==e.categoryDenylist?h3(this.h,6,e.categoryDenylist):"categoryDenylist"in e&&Nn(this.h,6),this.l(e)}D(e,t){return this.j={detections:[]},wa(this,e,t),this.j}F(e,t,n){return this.j={detections:[]},gl(this,e,n,t),this.j}m(){var e=new Js;Vn(e,"input_frame_gpu"),Vn(e,"norm_rect"),Wt(e,"detections");const t=new Io;dc(t,HWe,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),Un(n,"IMAGE:input_frame_gpu"),Un(n,"NORM_RECT:norm_rect"),jt(n,"DETECTIONS:detections"),n.o(t),Po(e,n),this.g.attachProtoVectorListener("detections",(e,t)=>{for(const t of e)e=dde(t),this.j.detections.push(Ude(e));$e(this,t)}),this.g.attachEmptyPacketListener("detections",e=>{$e(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Xo.prototype.detectForVideo=Xo.prototype.F,Xo.prototype.detect=Xo.prototype.D,Xo.prototype.setOptions=Xo.prototype.o,Xo.createFromModelPath=async function(e,t){return Nt(Xo,e,{baseOptions:{modelAssetPath:t}})},Xo.createFromModelBuffer=function(e,t){return Nt(Xo,e,{baseOptions:{modelAssetBuffer:t}})},Xo.createFromOptions=function(e,t){return Nt(Xo,e,t)};var sP=class{constructor(e,t,n){this.landmarks=e,this.worldLandmarks=t,this.segmentationMasks=n}close(){var e;null==(e=this.segmentationMasks)||e.forEach(e=>{e.close()})}};function aW(e){e.landmarks=[],e.worldLandmarks=[],e.segmentationMasks=void 0}function cW(e){try{const t=new sP(e.landmarks,e.worldLandmarks,e.segmentationMasks);if(!e.s)return t;e.s(t)}finally{RR(e)}}sP.prototype.close=sP.prototype.close;var fo=class extends Ws{constructor(e,t){super(new Ea(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,Ze(e=this.h=new Nde,0,1,t=new Qn),this.v=new kde,Ze(this.h,0,3,this.v),this.j=new Ide,Ze(this.h,0,2,this.j),sl(this.j,4,1),Ge(this.j,2,.5),Ge(this.v,2,.5),Ge(this.h,4,.5)}get baseOptions(){return Gt(this.h,Qn,1)}set baseOptions(e){Ze(this.h,0,1,e)}o(e){return"numPoses"in e&&sl(this.j,4,e.numPoses??1),"minPoseDetectionConfidence"in e&&Ge(this.j,2,e.minPoseDetectionConfidence??.5),"minTrackingConfidence"in e&&Ge(this.h,4,e.minTrackingConfidence??.5),"minPosePresenceConfidence"in e&&Ge(this.v,2,e.minPosePresenceConfidence??.5),"outputSegmentationMasks"in e&&(this.outputSegmentationMasks=e.outputSegmentationMasks??!1),this.l(e)}D(e,t,n){const r="function"!=typeof t?t:{};return this.s="function"==typeof t?t:n,aW(this),wa(this,e,r),cW(this)}F(e,t,n,r){const i="function"!=typeof n?n:{};return this.s="function"==typeof n?n:r,aW(this),gl(this,e,i,t),cW(this)}m(){var e=new Js;Vn(e,"image_in"),Vn(e,"norm_rect"),Wt(e,"normalized_landmarks"),Wt(e,"world_landmarks"),Wt(e,"segmentation_masks");const t=new Io;dc(t,VWe,this.h);const n=new gs;Lo(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),Un(n,"IMAGE:image_in"),Un(n,"NORM_RECT:norm_rect"),jt(n,"NORM_LANDMARKS:normalized_landmarks"),jt(n,"WORLD_LANDMARKS:world_landmarks"),n.o(t),Po(e,n),TR(this,e),this.g.attachProtoVectorListener("normalized_landmarks",(e,t)=>{this.landmarks=[];for(const t of e)e=B_(t),this.landmarks.push(CR(e));$e(this,t)}),this.g.attachEmptyPacketListener("normalized_landmarks",e=>{this.landmarks=[],$e(this,e)}),this.g.attachProtoVectorListener("world_landmarks",(e,t)=>{this.worldLandmarks=[];for(const t of e)e=Hg(t),this.worldLandmarks.push(Gy(e));$e(this,t)}),this.g.attachEmptyPacketListener("world_landmarks",e=>{this.worldLandmarks=[],$e(this,e)}),this.outputSegmentationMasks&&(jt(n,"SEGMENTATION_MASK:segmentation_masks"),Cv(this,"segmentation_masks"),this.g.ca("segmentation_masks",(e,t)=>{this.segmentationMasks=e.map(e=>Iv(this,e,!0,!this.s)),$e(this,t)}),this.g.attachEmptyPacketListener("segmentation_masks",e=>{this.segmentationMasks=[],$e(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};fo.prototype.detectForVideo=fo.prototype.F,fo.prototype.detect=fo.prototype.D,fo.prototype.setOptions=fo.prototype.o,fo.createFromModelPath=function(e,t){return Nt(fo,e,{baseOptions:{modelAssetPath:t}})},fo.createFromModelBuffer=function(e,t){return Nt(fo,e,{baseOptions:{modelAssetBuffer:t}})},fo.createFromOptions=function(e,t){return Nt(fo,e,t)},fo.POSE_CONNECTIONS=Xde;var XWe=()=>typeof OffscreenCanvas<"u";async function lW(e){return new Promise(t=>setTimeout(t,e))}async function JWe(e){await lW(10);const t=Date.now();for(;Date.now()-t<500;){const{width:t,height:n}=e.getSettings();if(t&&n)return{width:t,height:n};await lW(50)}return{width:void 0,height:void 0}}function v3(e,t){if(XWe())return new OffscreenCanvas(e,t);const n=document.createElement("canvas");return n.width=e,n.height=t,n}var bh,Qde=class e{constructor(e,t,n={}){var r;this.useStreamFallback=!1,this.processingEnabled=!1,this.name=t,this.transformer=e,this.maxFps=null!=(r=n.maxFps)?r:30}static get isSupported(){const e=typeof MediaStreamTrackGenerator<"u"&&typeof MediaStreamTrackProcessor<"u",t=typeof HTMLCanvasElement<"u"&&typeof VideoFrame<"u"&&"captureStream"in HTMLCanvasElement.prototype;return e||t}static get hasModernApiSupport(){return typeof MediaStreamTrackGenerator<"u"&&typeof MediaStreamTrackProcessor<"u"}async setup(t){this.source=t.track;const{width:n,height:r}=await JWe(this.source);if(this.sourceDummy=t.element,!(this.sourceDummy instanceof HTMLVideoElement))throw TypeError("Currently only video transformers are supported");if(this.sourceDummy instanceof HTMLVideoElement&&(this.sourceDummy.height=r??300,this.sourceDummy.width=n??300),this.useStreamFallback=!e.hasModernApiSupport,this.useStreamFallback){const e=document.querySelector('canvas[data-livekit-processor="'+this.name+'"]');e?(this.displayCanvas=e,this.displayCanvas.width=n??300,this.displayCanvas.height=r??300):(this.displayCanvas=document.createElement("canvas"),this.displayCanvas.width=n??300,this.displayCanvas.height=r??300,this.displayCanvas.style.display="none",this.displayCanvas.dataset.livekitProcessor=this.name,document.body.appendChild(this.displayCanvas)),this.renderContext=this.displayCanvas.getContext("2d"),this.capturedStream=this.displayCanvas.captureStream(),this.canvas=v3(n??300,r??300)}else this.processor=new MediaStreamTrackProcessor({track:this.source}),this.trackGenerator=new MediaStreamTrackGenerator({kind:"video",signalTarget:this.source}),this.canvas=v3(n??300,r??300)}async init(e){if(await this.setup(e),!this.canvas)throw new TypeError("Expected canvas to be defined after setup");await this.transformer.init({outputCanvas:this.canvas,inputElement:this.sourceDummy}),this.useStreamFallback?this.initFallbackPath():this.initStreamProcessorPath()}initStreamProcessorPath(){if(!this.processor||!this.trackGenerator)throw new TypeError("Expected processor and trackGenerator to be defined for stream processor path");const e=this.processor.readable.pipeThrough(this.transformer.transformer),t=Symbol("stream");this.symbol=t,e.pipeTo(this.trackGenerator.writable).then(()=>this.destroy(t)).catch(e=>{e instanceof DOMException&&"AbortError"===e.name?console.log("stream processor path aborted"):(console.error("error when trying to pipe",e),this.destroy(t))}),this.processedTrack=this.trackGenerator}initFallbackPath(){if(!(this.capturedStream&&this.source&&this.canvas&&this.renderContext))throw new TypeError("Missing required components for fallback implementation");this.processedTrack=this.capturedStream.getVideoTracks()[0],this.processingEnabled=!0,this.frameCallback=e=>{if(!this.processingEnabled||!e)return void e.close();const t={enqueue:e=>{this.renderContext&&this.displayCanvas&&(this.renderContext.drawImage(e,0,0,this.displayCanvas.width,this.displayCanvas.height),e.close())}};try{this.transformer.transform(e,t)}catch(t){console.error("Error in transform:",t),e.close()}},this.startRenderLoop()}startRenderLoop(){if(!(this.sourceDummy&&this.sourceDummy instanceof HTMLVideoElement))return;let e=-1,t=0;const n=this.sourceDummy,r=1e3/this.maxFps;let i=this.maxFps,o=[],s=0,a=0,l=0;const c=()=>{if(!(this.processingEnabled&&this.sourceDummy&&this.sourceDummy instanceof HTMLVideoElement))return;if(this.sourceDummy.paused)return console.warn("Video is paused, trying to play"),void this.sourceDummy.play();const u=n.currentTime,d=performance.now(),h=d-t,p=u!==e;if(p){if(s>0){const e=d-s;o.push(e),o.length>10&&o.shift(),o.length>2&&(i=1e3/(o.reduce((e,t)=>e+t,0)/o.length),(typeof window<"u"&&"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)&&d-l>5e3&&(console.debug(`[${this.name}] Estimated video FPS: ${i.toFixed(1)}, Processing at: ${(a/5).toFixed(1)} FPS`),a=0,l=d))}s=d}if(p&&h>=r){e=u,t=d,a++;try{if(n.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA){const e=new VideoFrame(n);this.frameCallback?this.frameCallback(e):e.close()}}catch(e){console.error("Error in render loop:",e)}}this.animationFrameId=requestAnimationFrame(c)};this.animationFrameId=requestAnimationFrame(c)}async restart(e){await this.destroy(),await this.init(e)}async restartTransformer(...e){await this.transformer.restart(e[0])}async updateTransformerOptions(...e){await this.transformer.update(e[0])}async destroy(e){var t,n,r,i;e&&this.symbol!==e||(this.useStreamFallback?(this.processingEnabled=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0),this.displayCanvas&&this.displayCanvas.parentNode&&this.displayCanvas.parentNode.removeChild(this.displayCanvas),null==(t=this.capturedStream)||t.getTracks().forEach(e=>e.stop())):(await(null==(r=null==(n=this.processor)?void 0:n.writableControl)?void 0:r.close()),null==(i=this.trackGenerator)||i.stop()),await this.transformer.destroy())}},QWe={"@mediapipe/tasks-vision":"0.10.14"};function yh(e,t){const n=e.TEXTURE0+t;e.activeTexture(n);const r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,r),r}function If(e,t,n){const r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw console.error("Shader compile failed:",e.getShaderInfoLog(r)),e.deleteShader(r),new Error("Shader compile failed");return r}function AR(e,t,n){const r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw console.error("Program link failed:",e.getProgramInfoLog(r)),new Error("Program link failed");return r}function G0(e,t,n,r){const i=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer not complete");return e.bindFramebuffer(e.FRAMEBUFFER,null),i}function ZWe(e){const t=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),e.STATIC_DRAW),t}async function eYe(e,t,n){const r=e.width/e.height,i=t/n;let o=0,s=0,a=e.width,l=e.height;return r>i?(a=Math.round(e.height*i),o=Math.round((e.width-a)/2)):r<i&&(l=Math.round(e.width/i),s=Math.round((e.height-l)/2)),createImageBitmap(e,o,s,a,l,{resizeWidth:t,resizeHeight:n,resizeQuality:"medium"})}function Fx(){return bh||((bh=new ImageData(2,2)).data[0]=0,bh.data[1]=0,bh.data[2]=0,bh.data[3]=0),bh}var K9=e=>e,z9=(e=!0)=>`#version 300 es\n  in vec2 position;\n  out vec2 texCoords;\n\n  void main() {\n    texCoords = (position + 1.0) / 2.0;\n    texCoords.y = ${e?"1.0 - texCoords.y":"texCoords.y"};\n    gl_Position = vec4(position, 0, 1.0);\n  }\n`,tYe=K9`#version 300 es
  precision mediump float;
  in vec2 texCoords;
  uniform sampler2D u_texture;
  uniform vec2 u_texelSize;
  uniform vec2 u_direction;
  uniform float u_radius;
  out vec4 fragColor;

  void main() {
    float sigma = u_radius;
    float twoSigmaSq = 2.0 * sigma * sigma;
    float totalWeight = 0.0;
    vec3 result = vec3(0.0);
    const int MAX_SAMPLES = 16;
    int radius = int(min(float(MAX_SAMPLES), ceil(u_radius)));

    for (int i = -MAX_SAMPLES; i <= MAX_SAMPLES; ++i) {
      float offset = float(i);
      if (abs(offset) > float(radius)) continue;
      float weight = exp(-(offset * offset) / twoSigmaSq);
      vec2 sampleCoord = texCoords + u_direction * u_texelSize * offset;
      result += texture(u_texture, sampleCoord).rgb * weight;
      totalWeight += weight;
    }

    fragColor = vec4(result / totalWeight, 1.0);
  }
`;function nYe(e){const t=If(e,e.VERTEX_SHADER,z9()),n=If(e,e.FRAGMENT_SHADER,tYe),r=AR(e,t,n);return{program:r,shader:n,vertexShader:t,uniforms:{position:e.getAttribLocation(r,"position"),texture:e.getUniformLocation(r,"u_texture"),texelSize:e.getUniformLocation(r,"u_texelSize"),direction:e.getUniformLocation(r,"u_direction"),radius:e.getUniformLocation(r,"u_radius")}}}function uW(e,t,n,r,i,o,s,a,l,c){e.useProgram(o),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(s.position,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.position);const u=1/n,d=1/r;return e.bindFramebuffer(e.FRAMEBUFFER,l[0]),e.viewport(0,0,n,r),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(s.texture,0),e.uniform2f(s.texelSize,u,d),e.uniform2f(s.direction,1,0),e.uniform1f(s.radius,i),e.drawArrays(e.TRIANGLES,0,6),e.bindFramebuffer(e.FRAMEBUFFER,l[1]),e.viewport(0,0,n,r),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,c[0]),e.uniform1i(s.texture,0),e.uniform2f(s.direction,0,1),e.drawArrays(e.TRIANGLES,0,6),e.bindFramebuffer(e.FRAMEBUFFER,null),c[1]}var rYe=K9`#version 300 es
precision mediump float;

in vec2 texCoords;

uniform sampler2D u_texture;
uniform vec2 u_texelSize;    // 1.0 / texture size
uniform vec2 u_direction;    // (1.0, 0.0) for horizontal, (0.0, 1.0) for vertical
uniform float u_radius;      // blur radius in texels

out vec4 fragColor;

void main() {
    vec3 sum = vec3(0.0);
    float count = 0.0;

    // Limit radius to avoid excessive loop cost
    const int MAX_RADIUS = 16;
    int radius = int(min(float(MAX_RADIUS), u_radius));

    for (int i = -MAX_RADIUS; i <= MAX_RADIUS; ++i) {
        if (abs(i) > radius) continue;

        vec2 offset = u_direction * u_texelSize * float(i);
        sum += texture(u_texture, texCoords + offset).rgb;
        count += 1.0;
  }

  fragColor = vec4(sum / count, 1.0);
}
`;function iYe(e){const t=If(e,e.VERTEX_SHADER,z9()),n=If(e,e.FRAGMENT_SHADER,rYe),r=AR(e,t,n);return{program:r,vertexShader:t,fragmentShader:n,uniforms:{position:e.getAttribLocation(r,"position"),texture:e.getUniformLocation(r,"u_texture"),texelSize:e.getUniformLocation(r,"u_texelSize"),direction:e.getUniformLocation(r,"u_direction"),radius:e.getUniformLocation(r,"u_radius")}}}var sYe=K9`#version 300 es
  precision mediump float;
  in vec2 texCoords;
  uniform sampler2D background;
  uniform sampler2D frame;
  uniform sampler2D mask;
  out vec4 fragColor;
  
  void main() {
      
    vec4 frameTex = texture(frame, texCoords);
    vec4 bgTex = texture(background, texCoords);

    float maskVal = texture(mask, texCoords).r;

    // Compute screen-space gradient to detect edge sharpness
    float grad = length(vec2(dFdx(maskVal), dFdy(maskVal)));

    float edgeSoftness = 2.0; // higher = softer
    
    // Create a smooth edge around binary transition
    float smoothAlpha = smoothstep(0.5 - grad * edgeSoftness, 0.5 + grad * edgeSoftness, maskVal);

    // Optional: preserve frame alpha, or override as fully opaque
    vec4 blended = mix(bgTex, vec4(frameTex.rgb, 1.0), 1.0 - smoothAlpha);
    
    fragColor = blended;
  
  }
`;function oYe(e){const t=If(e,e.VERTEX_SHADER,z9()),n=If(e,e.FRAGMENT_SHADER,sYe),r=AR(e,t,n);return{program:r,vertexShader:t,fragmentShader:n,attribLocations:{position:e.getAttribLocation(r,"position")},uniformLocations:{mask:e.getUniformLocation(r,"mask"),frame:e.getUniformLocation(r,"frame"),background:e.getUniformLocation(r,"background"),stepWidth:e.getUniformLocation(r,"u_stepWidth")}}}function aYe(e,t,n){const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const o=AR(e,If(e,e.VERTEX_SHADER,"\n      attribute vec2 position;\n      varying vec2 v_uv;\n      void main() {\n        v_uv = (position + 1.0) * 0.5;\n        gl_Position = vec4(position, 0.0, 1.0);\n      }\n    "),If(e,e.FRAGMENT_SHADER,"\n      precision mediump float;\n      varying vec2 v_uv;\n      uniform sampler2D u_texture;\n      void main() {\n        gl_FragColor = texture2D(u_texture, v_uv);\n      }\n    "));return{framebuffer:i,texture:r,program:o,uniforms:{texture:e.getUniformLocation(o,"u_texture"),position:e.getAttribLocation(o,"position")}}}function cYe(e,t,n,r,i,o){return e.useProgram(n.program),e.bindFramebuffer(e.FRAMEBUFFER,n.framebuffer),e.viewport(0,0,i,o),e.bindBuffer(e.ARRAY_BUFFER,r),e.enableVertexAttribArray(n.uniforms.position),e.vertexAttribPointer(n.uniforms.position,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(n.uniforms.texture,0),e.drawArrays(e.TRIANGLES,0,6),e.bindFramebuffer(e.FRAMEBUFFER,null),n.texture}var dW=e=>{const t=e.getContext("webgl2",{antialias:!0,premultipliedAlpha:!0});let n=null;if(!t)return void console.error("Failed to create WebGL context");t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);const r=oYe(t),i=r.program,o=r.attribLocations.position,{mask:s,frame:a,background:l}=r.uniformLocations,c=nYe(t),u=c.program,d=c.uniforms,h=iYe(t),p=h.program,f=h.uniforms,m=yh(t,0),v=yh(t,1),g=ZWe(t);if(!g)throw new Error("Failed to create vertex buffer");let y=[],b=[],w=[],_=0,S=1;y.push(yh(t,3)),y.push(yh(t,4));const E=Math.floor(e.width/4),C=Math.floor(e.height/4),k=aYe(t,E,C);b.push(G0(t,y[0],E,C)),b.push(G0(t,y[1],E,C));const T=yh(t,5),R=G0(t,T,e.width,e.height);w.push(yh(t,6)),w.push(yh(t,7));const I=[G0(t,w[0],e.width,e.height),G0(t,w[1],e.width,e.height)];t.useProgram(i),t.uniform1i(l,0),t.uniform1i(a,1),t.uniform1i(s,2);let x=Fx();async function P(n){if(x=Fx(),n)try{x=await eYe(n,e.width,e.height)}catch(e){console.error("Error processing background image, falling back to black background:",e)}t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,m),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,x)}return{renderFrame:function(e){if(0===e.codedWidth||0===w.length)return;const r=e.displayWidth,c=e.displayHeight;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,v),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);let h=m;if(n){const e=cYe(t,v,k,g,E,C);h=uW(t,e,E,C,n,u,d,g,b,y)}else t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,m),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,x),h=m;t.viewport(0,0,r,c),t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(i),t.bindBuffer(t.ARRAY_BUFFER,g),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h),t.uniform1i(l,0),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,v),t.uniform1i(a,1),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,w[_]),t.uniform1i(s,2),t.drawArrays(t.TRIANGLES,0,6)},updateMask:function(n){const r=[R,I[S]],i=[T,w[S]];uW(t,n,e.width,e.height,8,p,f,g,r,i),_=S,S=1-S},setBackgroundImage:P,setBlurRadius:function(e){n=e?Math.max(1,Math.floor(e/4)):null,P(null)},cleanup:function(){t.deleteProgram(i),t.deleteProgram(u),t.deleteProgram(p),t.deleteTexture(m),t.deleteTexture(v),t.deleteTexture(T),t.deleteFramebuffer(R);for(const e of y)t.deleteTexture(e);for(const e of b)t.deleteFramebuffer(e);for(const e of w)t.deleteTexture(e);for(const e of I)t.deleteFramebuffer(e);t.deleteBuffer(g),k&&(t.deleteTexture(k.texture),t.deleteFramebuffer(k.framebuffer),t.deleteProgram(k.program)),x&&(x instanceof ImageBitmap&&x.close(),x=Fx()),y=[],b=[],w=[]}}},efe=class{constructor(){this.isDisabled=!1}async init({outputCanvas:e,inputElement:t}){if(!(t instanceof HTMLVideoElement))throw TypeError("Video transformer needs a HTMLVideoElement as input");this.transformer=new TransformStream({transform:(e,t)=>this.transform(e,t)}),this.canvas=e||null,e&&(this.gl=dW(this.canvas||v3(t.videoWidth,t.videoHeight))),this.inputVideo=t,this.isDisabled=!1}async restart({outputCanvas:e,inputElement:t}){var n;this.canvas=e||null,null==(n=this.gl)||n.cleanup(),this.gl=dW(this.canvas||v3(t.videoWidth,t.videoHeight)),this.inputVideo=t,this.isDisabled=!1}async destroy(){var e;this.isDisabled=!0,this.canvas=void 0,null==(e=this.gl)||e.cleanup(),this.gl=void 0}},tfe=class extends efe{constructor(e){super(),this.backgroundImage=null,this.segmentationTimeMs=0,this.options=e,this.update(e)}static get isSupported(){return typeof OffscreenCanvas<"u"&&typeof VideoFrame<"u"&&typeof createImageBitmap<"u"&&!!document.createElement("canvas").getContext("webgl2")}async init({outputCanvas:e,inputElement:t}){var n,r,i,o,s,a;await super.init({outputCanvas:e,inputElement:t});const l=await Rh.forVisionTasks(null!=(r=null==(n=this.options.assetPaths)?void 0:n.tasksVisionFileSet)?r:`https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@${QWe["@mediapipe/tasks-vision"]}/wasm`);this.imageSegmenter=await Wi.createFromOptions(l,{baseOptions:{modelAssetPath:null!=(o=null==(i=this.options.assetPaths)?void 0:i.modelAssetPath)?o:"https://storage.googleapis.com/mediapipe-models/image_segmenter/selfie_segmenter/float16/latest/selfie_segmenter.tflite",delegate:"GPU",...this.options.segmenterOptions},canvas:this.canvas,runningMode:"VIDEO",outputCategoryMask:!0,outputConfidenceMasks:!1}),null!=(s=this.options)&&s.imagePath&&!this.backgroundImage&&await this.loadBackground(this.options.imagePath).catch(e=>console.error("Error while loading processor background image: ",e)),this.options.blurRadius&&(null==(a=this.gl)||a.setBlurRadius(this.options.blurRadius))}async destroy(){var e;await super.destroy(),await(null==(e=this.imageSegmenter)?void 0:e.close()),this.backgroundImage=null}async loadBackground(e){var t;const n=new Image;await new Promise((t,r)=>{n.crossOrigin="Anonymous",n.onload=()=>t(n),n.onerror=e=>r(e),n.src=e});const r=await createImageBitmap(n);null==(t=this.gl)||t.setBackgroundImage(r)}async transform(e,t){var n,r;try{if(!(e instanceof VideoFrame)||0===e.codedWidth||0===e.codedHeight)return void console.debug("empty frame detected, ignoring");if(this.isDisabled)return void t.enqueue(e);const i=Date.now();if(!this.canvas)throw TypeError("Canvas needs to be initialized first");this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight;const o=new Promise((t,n)=>{var r;try{let n=performance.now();null==(r=this.imageSegmenter)||r.segmentForVideo(e,n,e=>{this.segmentationTimeMs=performance.now()-n,this.segmentationResults=e,this.updateMask(e.categoryMask),e.close(),t()})}catch(e){n(e)}}),s=performance.now();if(this.drawFrame(e),this.canvas&&this.canvas.width>0&&this.canvas.height>0){const o=new VideoFrame(this.canvas,{timestamp:e.timestamp||i});t.enqueue(o);const a=performance.now()-s,l={processingTimeMs:this.segmentationTimeMs+a,segmentationTimeMs:this.segmentationTimeMs,filterTimeMs:a};null==(r=(n=this.options).onFrameProcessed)||r.call(n,l)}else t.enqueue(e);await o}catch(e){console.error("Error while processing frame: ",e)}finally{e.close()}}async update(e){var t;this.options={...this.options,...e},e.blurRadius?null==(t=this.gl)||t.setBlurRadius(e.blurRadius):e.imagePath&&await this.loadBackground(e.imagePath)}async drawFrame(e){var t;this.gl&&(null==(t=this.gl)||t.renderFrame(e))}async updateMask(e){var t;e&&(null==(t=this.gl)||t.updateMask(e.getAsWebGLTexture()))}},lYe=()=>tfe.isSupported&&Qde.isSupported;const uYe=""+new URL("selfie_segmenter-DF05sdL4.tflite",import.meta.url).href,dYe={wasmLoaderPath:new URL(""+new URL("vision_wasm_internal-CEyeacG0.js",import.meta.url).href,import.meta.url).href,wasmBinaryPath:new URL(""+new URL("vision_wasm_internal-TmjHuG4I.wasm",import.meta.url).href,import.meta.url).href};class fYe extends tfe{async init({outputCanvas:e,inputElement:t}){var n;await efe.prototype.init.call(this,{outputCanvas:e,inputElement:t}),this.imageSegmenter=await Wi.createFromOptions(dYe,{baseOptions:{modelAssetPath:uYe,delegate:"GPU",...this.options.segmenterOptions},canvas:this.canvas,runningMode:"VIDEO",outputCategoryMask:!0,outputConfidenceMasks:!1}),this.options.blurRadius&&(null==(n=this.gl)||n.setBlurRadius(this.options.blurRadius))}}const nfe=_.createContext(void 0);function LR(){const e=_.use(nfe);if(void 0===e)throw new Error("useTrackProcessor must be used within a ProcessorProvider");return e}const rfe=e=>{const{processor:t}=LR();_.useEffect(()=>{e&&(t&&!e.getProcessor()&&e.setProcessor(t),!t&&e.getProcessor()&&e.stopProcessor())},[t,e])},hYe=({children:e})=>{const[t]=Bn(fle),n=_.useMemo(()=>lYe(),[]),r=_.useMemo(()=>new Qde(new fYe({blurRadius:15}),"background-blur"),[]),i=_.useMemo(()=>({supported:n,processor:n&&t?r:void 0}),[n,t,r]);return w.jsx(nfe,{value:i,children:e})},pYe={},mYe={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"embedded-v0.15.0",VITE_PACKAGE:"embedded"},gYe=({client:e,livekitRoom:t})=>{var n;const{t:r}=Je(),[i,o]=Bn(ule),[s,a]=Bn(R8),[l,c]=Bn(dle),[u,d]=Bn(jb),[h,p]=Bn(gle),[f,m]=Bn(yle),[v,g]=Bn(k8),[y,b]=Bn(vle),S=Xs(),E=_.useMemo(()=>{var e;if(null!=(e=null==t?void 0:t.engine.client.ws)&&e.url){const e=new URL(t.engine.client.ws.url);return e.search="",e}return null},[t]);return w.jsxs(w.Fragment,{children:[w.jsx("p",{children:r("developer_mode.hostname",{hostname:window.location.hostname||"unknown"})}),w.jsx("p",{children:r("version",{productName:"Element Call",version:"embedded-v0.15.0"})}),w.jsx("p",{children:r("developer_mode.crypto_version",{version:(null==(n=e.getCrypto())?void 0:n.getVersion())||"unknown"})}),w.jsx("p",{children:r("developer_mode.matrix_id",{id:e.getUserId()||"unknown"})}),w.jsx("p",{children:r("developer_mode.device_id",{id:e.getDeviceId()||"unknown"})}),w.jsx(St,{children:w.jsx(Sn,{id:"duplicateTiles",type:"number",label:r("developer_mode.duplicate_tiles_label"),value:i.toString(),min:0,onChange:_.useCallback(e=>{const t=e.target.valueAsNumber;t<0||o(Number.isNaN(t)?0:t)},[o])})}),w.jsx(St,{children:w.jsx(Sn,{id:"debugTileLayout",type:"checkbox",checked:s,label:r("developer_mode.debug_tile_layout_label"),onChange:e=>a(e.target.checked)})}),w.jsx(St,{children:w.jsx(Sn,{id:"showNonMemberTiles",type:"checkbox",label:r("developer_mode.show_non_member_tiles"),checked:!!l,onChange:_.useCallback(e=>{c(e.target.checked)},[c])})}),w.jsx(St,{children:w.jsx(Sn,{id:"showConnectionStats",type:"checkbox",label:r("developer_mode.show_connection_stats"),checked:!!u,onChange:_.useCallback(e=>{d(e.target.checked)},[d])})}),w.jsx(St,{children:w.jsx(Sn,{id:"useNewMembershipManager",type:"checkbox",label:r("developer_mode.use_new_membership_manager"),checked:!!h,onChange:_.useCallback(e=>{p(e.target.checked)},[p])})}),w.jsx(St,{children:w.jsx(Sn,{id:"useToDeviceKeyTransport",type:"checkbox",label:r("developer_mode.use_to_device_key_transport"),checked:!!v,onChange:_.useCallback(e=>{g(e.target.checked)},[g])})}),w.jsx(St,{children:w.jsx(Sn,{id:"muteAllAudio",type:"checkbox",label:r("developer_mode.mute_all_audio"),checked:y,onChange:_.useCallback(e=>{b(e.target.checked)},[b])})})," ",w.jsxs(St,{children:[w.jsx(Sn,{id:"alwaysShowIphoneEarpiece",type:"checkbox",label:r("developer_mode.always_show_iphone_earpiece"),checked:f,onChange:_.useCallback(e=>{m(e.target.checked)},[m])})," "]}),t?w.jsxs(w.Fragment,{children:[w.jsx("p",{children:r("developer_mode.livekit_sfu",{url:(null==E?void 0:E.href)||"unknown"})}),w.jsx("p",{children:r("developer_mode.livekit_server_info")}),w.jsxs("pre",{className:pYe.pre,children:[t.serverInfo?JSON.stringify(t.serverInfo,null,2):"undefined",t.metadata]})]}):null,w.jsx("p",{children:r("developer_mode.environment_variables")}),w.jsx("pre",{children:JSON.stringify(mYe,null,2)}),w.jsx("p",{children:r("developer_mode.url_params")}),w.jsx("pre",{children:JSON.stringify(S,null,2)})]})},W9="audio",Y9=({open:e,onDismiss:t,tab:n,onTabChange:r,client:i,roomId:o,livekitRoom:s})=>{const{t:a}=Je(),l=Gu();_.useEffect(()=>{e&&l.requestDeviceNames()},[e,l]);const[c,u]=Bn(mle),[d,h]=_.useState(c),[p]=Bn(T8),{available:f}=ZT(),{controlledAudioDevices:m}=Xs(),v=ct(Ule),g={key:"audio",name:a("common.audio"),content:w.jsx(w.Fragment,{children:w.jsxs(Oq,{children:[!m&&w.jsx(Cx,{device:l.audioInput,title:a("settings.devices.microphone"),numberedLabel:e=>a("settings.devices.microphone_numbered",{n:e})}),v&&m&&w.jsx(Ft,{onClick:e=>{var t,n,r,i;e.preventDefault(),null==(n=(t=window.controls).showNativeAudioDevicePicker)||n.call(t),null==(i=(r=window.controls).showNativeOutputDevicePicker)||i.call(r)},children:a("settings.devices.change_device_button")}),w.jsx(Cx,{device:l.audioOutput,title:a("settings.devices.speaker"),numberedLabel:e=>a("settings.devices.speaker_numbered",{n:e})}),w.jsxs("div",{className:BK.volumeSlider,children:[w.jsx("label",{children:a("settings.audio_tab.effect_volume_label")}),w.jsx("p",{children:a("settings.audio_tab.effect_volume_description")}),w.jsx(iue,{label:a("video_tile.volume"),value:d,onValueChange:h,onValueCommit:u,min:0,max:1,step:.01})]})]})})},y={key:"video",name:a("common.video"),content:w.jsxs(w.Fragment,{children:[w.jsx(Oq,{children:w.jsx(Cx,{device:l.videoInput,title:a("settings.devices.camera"),numberedLabel:e=>a("settings.devices.camera_numbered",{n:e})})}),w.jsx(UM,{}),w.jsx(()=>{const{supported:e}=LR(),[t,n]=Bn(fle);return w.jsxs(w.Fragment,{children:[w.jsx("h4",{children:a("settings.background_blur_header")}),w.jsx(St,{children:w.jsx(Sn,{id:"activateBackgroundBlur",label:a("settings.background_blur_label"),description:e?"":a("settings.blur_not_supported_by_browser"),type:"checkbox",checked:!!t,onChange:e=>n(e.target.checked),disabled:!e})})]})},{})]})},b={key:"preferences",name:a("common.preferences"),content:w.jsx(DKe,{})},S={key:"profile",name:a("common.profile"),content:w.jsx(eKe,{client:i})},E={key:"feedback",name:a("settings.feedback_tab_title"),content:w.jsx(nKe,{roomId:o})},C={key:"developer",name:a("settings.developer_tab_title"),content:w.jsx(gYe,{client:i,livekitRoom:s})},k=[g,y];return null===Qe&&k.push(S),k.push(b),f&&k.push(E),p&&k.push(C),w.jsx(Lp,{title:a("common.settings"),className:BK.settingsModal,open:e,onDismiss:t,tabbed:!0,children:w.jsx(PGe,{label:a("common.settings"),tab:n,onTabChange:r,tabs:k})})},vYe=(e,t)=>_.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("mask",{id:"path-1-inside-1_898_2641",fill:"white"},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z"})),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z",fill:"white"}),_.createElement("path",{d:"M17.1502 20.1214L17.9339 21.2814L17.1502 20.1214ZM4.4 19.8008L3.55919 20.9202H3.55919L4.4 19.8008ZM17.1197 17.3237L18.0934 18.3296L18.7717 17.6731L18.4173 16.7981L17.1197 17.3237ZM4.88028 17.3237L3.58268 16.7981L3.22829 17.6731L3.90659 18.3296L4.88028 17.3237ZM11 23.4C13.5662 23.4 15.9541 22.619 17.9339 21.2814L16.3665 18.9613C14.835 19.9959 12.9902 20.6 11 20.6V23.4ZM3.55919 20.9202C5.63176 22.477 8.21011 23.4 11 23.4V20.6C8.83723 20.6 6.84514 19.8865 5.24081 18.6814L3.55919 20.9202ZM-1.4 11C-1.4 15.0577 0.55052 18.6603 3.55919 20.9202L5.24081 18.6814C2.90591 16.9276 1.4 14.1399 1.4 11H-1.4ZM11 -1.4C4.15167 -1.4 -1.4 4.15167 -1.4 11H1.4C1.4 5.69807 5.69807 1.4 11 1.4V-1.4ZM23.4 11C23.4 4.15167 17.8483 -1.4 11 -1.4V1.4C16.3019 1.4 20.6 5.69807 20.6 11H23.4ZM17.9339 21.2814C21.2288 19.0554 23.4 15.2815 23.4 11H20.6C20.6 14.3124 18.9236 17.2337 16.3665 18.9613L17.9339 21.2814ZM12.9 7.975C12.9 9.28384 11.9459 10.15 11 10.15V12.95C13.6991 12.95 15.7 10.615 15.7 7.975H12.9ZM11 5.8C11.9459 5.8 12.9 6.66616 12.9 7.975H15.7C15.7 5.335 13.6991 3 11 3V5.8ZM9.1 7.975C9.1 6.66616 10.0541 5.8 11 5.8V3C8.30086 3 6.3 5.335 6.3 7.975H9.1ZM11 10.15C10.0541 10.15 9.1 9.28384 9.1 7.975H6.3C6.3 10.615 8.30086 12.95 11 12.95V10.15ZM16.146 16.3178C14.8129 17.6081 13.0004 18.4 11 18.4V21.2C13.756 21.2 16.2591 20.1051 18.0934 18.3296L16.146 16.3178ZM11 14.6C13.1797 14.6 15.0494 15.9415 15.8221 17.8493L18.4173 16.7981C17.2312 13.8697 14.359 11.8 11 11.8V14.6ZM6.17788 17.8493C6.95058 15.9415 8.8203 14.6 11 14.6V11.8C7.64102 11.8 4.7688 13.8697 3.58268 16.7981L6.17788 17.8493ZM11 18.4C8.99963 18.4 7.18709 17.6081 5.85397 16.3178L3.90659 18.3296C5.74088 20.1051 8.24402 21.2 11 21.2V18.4Z",fill:"white",mask:"url(#path-1-inside-1_898_2641)"})),fW=_.forwardRef(vYe),yYe=(e,t)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.0988 9.01625C20.3188 9.59375 20.8825 9.97875 21.5013 9.97875C22.3263 9.97875 23 10.6525 23 11.4775V12.5225C23 13.3475 22.3263 14.0213 21.5013 14.0213C20.8825 14.0213 20.3188 14.4062 20.0988 14.9838C20.0806 15.0292 20.0624 15.0753 20.0441 15.1218C19.9792 15.2863 19.9125 15.4555 19.8375 15.6163C19.5763 16.18 19.7 16.84 20.14 17.28C20.7313 17.8575 20.7313 18.8062 20.14 19.3975L19.3975 20.14C18.82 20.7313 17.8713 20.7313 17.28 20.14C16.8538 19.7 16.18 19.5763 15.6163 19.8375C15.41 19.9338 15.2037 20.0163 14.9838 20.0988C14.4062 20.3188 14.0213 20.8825 14.0213 21.5013C14.0213 22.3263 13.3475 23 12.5225 23H11.4775C10.6525 23 9.97875 22.3263 9.97875 21.5013C9.97875 20.8825 9.59375 20.3188 9.01625 20.0988C8.97079 20.0806 8.92466 20.0624 8.87815 20.044C8.71368 19.9792 8.54454 19.9125 8.38375 19.8375C7.82 19.5763 7.16 19.7 6.72 20.14C6.1425 20.7313 5.19375 20.7313 4.6025 20.14L3.86 19.3975C3.26875 18.82 3.26875 17.8713 3.86 17.28C4.3 16.8538 4.42375 16.18 4.1625 15.6163C4.06625 15.41 3.98375 15.2037 3.90125 14.9838C3.68125 14.4062 3.1175 14.0213 2.49875 14.0213C1.67375 14.0213 1 13.3475 1 12.5225V11.4775C1 10.6525 1.67375 9.97875 2.49875 9.97875C3.1175 9.97875 3.68125 9.59375 3.90125 9.01625C3.94464 8.87742 3.99897 8.74406 4.0539 8.60926C4.086 8.53046 4.11831 8.45117 4.14875 8.37C4.41 7.80625 4.28625 7.14625 3.84625 6.70625C3.255 6.12875 3.255 5.18 3.84625 4.58875L4.6025 3.86C5.18 3.26875 6.12875 3.26875 6.72 3.86C7.14625 4.3 7.82 4.42375 8.38375 4.1625C8.59 4.06625 8.79625 3.97 9.01625 3.90125C9.59375 3.68125 9.97875 3.1175 9.97875 2.49875C9.97875 1.67375 10.6525 1 11.4775 1H12.5225C13.3475 1 14.0213 1.67375 14.0213 2.49875C14.0213 3.13125 14.4062 3.68125 14.9838 3.90125C15.0292 3.91943 15.0753 3.93762 15.1218 3.95595C15.2863 4.02079 15.4555 4.08746 15.6163 4.1625C16.18 4.42375 16.84 4.3 17.28 3.86C17.8575 3.26875 18.8062 3.26875 19.3975 3.86L20.14 4.6025C20.7313 5.18 20.7313 6.12875 20.14 6.72C19.7 7.14625 19.5763 7.82 19.8375 8.38375C19.9338 8.59 20.0163 8.79625 20.0988 9.01625ZM12 17.5C8.96125 17.5 6.5 15.0387 6.5 12C6.5 8.96125 8.96125 6.5 12 6.5C15.0387 6.5 17.5 8.96125 17.5 12C17.5 15.0387 15.0387 17.5 12 17.5Z",fill:"#ffffff"})),bYe=_.forwardRef(yYe),_Ye=(e,t)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.49966 2.38889C7.49966 1.89797 7.89763 1.5 8.38855 1.5H20.1108C20.6017 1.5 20.9997 1.89797 20.9997 2.38889V21.6111C20.9997 22.102 20.6017 22.5 20.1108 22.5H8.38855C7.89763 22.5 7.49966 22.102 7.49966 21.6111V12.6667H7.49089H7.4821H7.47331H7.46452H7.45573H7.44694H7.43815H7.42936H7.42057H7.41178H7.403H7.39421H7.38542H7.37663H7.36784H7.35905H7.35026H7.34147H7.33268H7.32389H7.3151H7.30632H7.29753H7.28874H7.27995H7.27116H7.26237H7.25358H7.24479H7.236H7.22721H7.21842H7.20964H7.20085H7.19206H7.18327H7.17448H7.16569H7.1569H7.14811H7.13932H7.13053H7.12175H7.11296H7.10417H7.09538H7.08659H7.0778H7.06901H7.06022H7.05143H7.04264H7.03385H7.02507H7.01628H7.00749H6.9987H6.98991H6.98112H6.97233H6.96354H6.95475H6.94596H6.93717H6.92839H6.9196H6.91081H6.90202H6.89323H6.88444H6.87565H6.86686H6.85807H6.84928H6.8405H6.83171H6.82292H6.81413H6.80534H6.79655H6.78776H6.77897H6.77018H6.76139H6.7526H6.74382H6.73503H6.72624H6.71745H6.70866H6.69987H6.69108H6.68229H6.6735H6.66471H6.65592H6.64714H6.63835H6.62956H6.62077H6.61198H6.60319H6.5944H6.58561H6.57682H6.56803H6.55925H6.55046H6.54167H6.53288H6.52409H6.5153H6.50651H6.49772H6.48893H6.48014H6.47135H6.46257H6.45378H6.44499H6.4362H6.42741H6.41862H6.40983H6.40104H6.39225H6.38346H6.37467H6.36589H6.3571H6.34831H6.33952H6.33073H6.32194H6.31315H6.30436H6.29557H6.28678H6.27799H6.26921H6.26042H6.25163H6.24284H6.23405H6.22526H6.21647H6.20768H6.19889H6.1901H6.18132H6.17253H6.16374H6.15495H6.14616H6.13737H6.12858H6.11979H6.111H6.10221H6.09342H6.08464H6.07585H6.06706H6.05827H6.04948H6.04069H6.0319H6.02311H6.01432H6.00553H5.99674H5.98796H5.97917H5.97038H5.96159H5.9528H5.94401H5.93522H5.92643H5.91764H5.90885H5.90007H5.89128H5.88249H5.8737H5.86491H5.85612H5.84733H5.83854H5.82975H5.82096H5.81217H5.80339H5.7946H5.78581H5.77702H5.76823H5.75944H5.75065H5.74186H5.73307H5.72428H5.71549H5.70671H5.69792H5.68913H5.68034H5.67155H5.66276H5.65397H5.64518H5.63639H5.6276H5.61882H5.61003H5.60124H5.59245H5.58366H5.57487H5.56608H5.55729H5.5485H5.53971H5.53092H5.52214H5.51335H5.50456H5.49577H5.48698H5.47819H5.4694H5.46061H5.45182H5.44303H5.43424H5.42546H5.41667H5.40788H5.39909H5.3903H5.38151H5.37272H5.36393H5.35514H5.34635H5.33757H5.32878H5.31999H5.3112H5.30241H5.29362H5.28483H5.27604H5.26725H5.25846H5.24967H5.24089H5.2321H5.22331H5.21452H5.20573H5.19694H5.18815H5.17936H5.17057H5.16178H5.15299H5.14421H5.13542H5.12663H5.11784H5.10905H5.10026H5.09147H5.08268H5.07389H5.0651H5.05632H5.04753H5.03874H5.02995H5.02116H5.01237H5.00358H4.99479H4.986H4.97721H4.96842H4.95964H4.95085H4.94206H4.93327H4.92448H4.91569H4.9069H4.89811H4.88932H4.88053H4.87174H4.86296H4.85417H4.84538H4.83659H4.8278H4.81901H4.81022H4.80143H4.79264H4.78385H4.77507H4.76628H4.75749H4.7487H4.73991H4.73112H4.72233H4.71354H4.70475H4.69596H4.68717H4.67839H4.6696H4.66081H4.65202H4.64323H4.63444H4.62565H4.61686H4.60807H4.59928H4.59049H4.58171H4.57292H4.56413H4.55534H4.54655H4.53776H4.52897H4.52018H4.51139H4.5026H4.49382H4.48503H4.47624H4.46745H4.45866H4.44987H4.44108H4.43229H4.4235H4.41471H4.40592H4.39714H4.38835H4.37956H4.37077H4.36198H4.35319H4.3444H4.33561H4.32682H4.31803H4.30924H4.30046H4.29167H4.28288H4.27409H4.2653H4.25651H4.24772H4.23893H4.23014H4.22135H4.21257H4.20378H4.19499H4.1862H4.17741H4.16862H4.15983H4.15104H4.14225H4.13346H4.12467H4.11589H4.1071H4.09831H4.08952H4.08073H4.07194H4.06315H4.05436H4.04557H4.03678H4.02799H4.01921H4.01042H4.00163H3.99284H3.98405H3.97526H3.96647H3.95768H3.94889H3.9401H3.93132H3.92253H3.91374H3.90495H3.89616H3.88737H3.87858H3.86979H3.861H3.85221H3.84342H3.83464H3.82585H3.81706H3.80827H3.79948H3.79069H3.7819H3.77311H3.76432H3.75553H3.74674H3.73796H3.72917H3.72038H3.71159H3.7028H3.69401H3.68522H3.67643H3.66764H3.65885H3.65007H3.64128H3.63249H3.6237H3.61491H3.60612H3.59733H3.58854H3.57975H3.57096H3.56217H3.55339H3.5446H3.53581H3.52702H3.51823H3.50944H3.50065H3.49186H3.48307H3.47428H3.46549H3.45671H3.44792H3.43913H3.43034H3.42155H3.41276H3.40397H3.39518H3.38639H3.3776H3.36882H3.36003H3.35124H3.34245H3.33366H3.32487H3.31608H3.30729H3.2985H3.28971H3.28092H3.27214H3.26335H3.25456H3.24577H3.23698H3.22819H3.2194H3.21061H3.20182H3.19303H3.18424H3.17546H3.16667H3.15788H3.14909H3.1403H3.13151H3.12272H3.11393H3.10514H3.09635H3.08757H3.07878H3.06999H3.0612H3.05241H3.04362H3.03483H3.02604H3.01725H3.00846H2.99967C2.63148 12.6667 2.33301 12.3682 2.33301 12C2.33301 11.6318 2.63148 11.3333 2.99967 11.3333H3.00846H3.01725H3.02604H3.03483H3.04362H3.05241H3.0612H3.06999H3.07878H3.08757H3.09635H3.10514H3.11393H3.12272H3.13151H3.1403H3.14909H3.15788H3.16667H3.17546H3.18424H3.19303H3.20182H3.21061H3.2194H3.22819H3.23698H3.24577H3.25456H3.26335H3.27214H3.28092H3.28971H3.2985H3.30729H3.31608H3.32487H3.33366H3.34245H3.35124H3.36003H3.36882H3.3776H3.38639H3.39518H3.40397H3.41276H3.42155H3.43034H3.43913H3.44792H3.45671H3.46549H3.47428H3.48307H3.49186H3.50065H3.50944H3.51823H3.52702H3.53581H3.5446H3.55339H3.56217H3.57096H3.57975H3.58854H3.59733H3.60612H3.61491H3.6237H3.63249H3.64128H3.65007H3.65885H3.66764H3.67643H3.68522H3.69401H3.7028H3.71159H3.72038H3.72917H3.73796H3.74674H3.75553H3.76432H3.77311H3.7819H3.79069H3.79948H3.80827H3.81706H3.82585H3.83464H3.84342H3.85221H3.861H3.86979H3.87858H3.88737H3.89616H3.90495H3.91374H3.92253H3.93132H3.9401H3.94889H3.95768H3.96647H3.97526H3.98405H3.99284H4.00163H4.01042H4.01921H4.02799H4.03678H4.04557H4.05436H4.06315H4.07194H4.08073H4.08952H4.09831H4.1071H4.11589H4.12467H4.13346H4.14225H4.15104H4.15983H4.16862H4.17741H4.1862H4.19499H4.20378H4.21257H4.22135H4.23014H4.23893H4.24772H4.25651H4.2653H4.27409H4.28288H4.29167H4.30046H4.30924H4.31803H4.32682H4.33561H4.3444H4.35319H4.36198H4.37077H4.37956H4.38835H4.39714H4.40592H4.41471H4.4235H4.43229H4.44108H4.44987H4.45866H4.46745H4.47624H4.48503H4.49382H4.5026H4.51139H4.52018H4.52897H4.53776H4.54655H4.55534H4.56413H4.57292H4.58171H4.59049H4.59928H4.60807H4.61686H4.62565H4.63444H4.64323H4.65202H4.66081H4.6696H4.67839H4.68717H4.69596H4.70475H4.71354H4.72233H4.73112H4.73991H4.7487H4.75749H4.76628H4.77507H4.78385H4.79264H4.80143H4.81022H4.81901H4.8278H4.83659H4.84538H4.85417H4.86296H4.87174H4.88053H4.88932H4.89811H4.9069H4.91569H4.92448H4.93327H4.94206H4.95085H4.95964H4.96842H4.97721H4.986H4.99479H5.00358H5.01237H5.02116H5.02995H5.03874H5.04753H5.05631H5.0651H5.07389H5.08268H5.09147H5.10026H5.10905H5.11784H5.12663H5.13542H5.14421H5.15299H5.16178H5.17057H5.17936H5.18815H5.19694H5.20573H5.21452H5.22331H5.2321H5.24089H5.24967H5.25846H5.26725H5.27604H5.28483H5.29362H5.30241H5.3112H5.31999H5.32878H5.33757H5.34635H5.35514H5.36393H5.37272H5.38151H5.3903H5.39909H5.40788H5.41667H5.42546H5.43424H5.44303H5.45182H5.46061H5.4694H5.47819H5.48698H5.49577H5.50456H5.51335H5.52214H5.53092H5.53971H5.5485H5.55729H5.56608H5.57487H5.58366H5.59245H5.60124H5.61003H5.61882H5.6276H5.63639H5.64518H5.65397H5.66276H5.67155H5.68034H5.68913H5.69792H5.70671H5.71549H5.72428H5.73307H5.74186H5.75065H5.75944H5.76823H5.77702H5.78581H5.7946H5.80339H5.81217H5.82096H5.82975H5.83854H5.84733H5.85612H5.86491H5.8737H5.88249H5.89128H5.90007H5.90885H5.91764H5.92643H5.93522H5.94401H5.9528H5.96159H5.97038H5.97917H5.98796H5.99674H6.00553H6.01432H6.02311H6.0319H6.04069H6.04948H6.05827H6.06706H6.07585H6.08464H6.09342H6.10221H6.111H6.11979H6.12858H6.13737H6.14616H6.15495H6.16374H6.17253H6.18132H6.1901H6.19889H6.20768H6.21647H6.22526H6.23405H6.24284H6.25163H6.26042H6.26921H6.27799H6.28678H6.29557H6.30436H6.31315H6.32194H6.33073H6.33952H6.34831H6.3571H6.36589H6.37467H6.38346H6.39225H6.40104H6.40983H6.41862H6.42741H6.4362H6.44499H6.45378H6.46257H6.47135H6.48014H6.48893H6.49772H6.50651H6.5153H6.52409H6.53288H6.54167H6.55046H6.55925H6.56803H6.57682H6.58561H6.5944H6.60319H6.61198H6.62077H6.62956H6.63835H6.64714H6.65592H6.66471H6.6735H6.68229H6.69108H6.69987H6.70866H6.71745H6.72624H6.73503H6.74382H6.7526H6.76139H6.77018H6.77897H6.78776H6.79655H6.80534H6.81413H6.82292H6.83171H6.8405H6.84928H6.85807H6.86686H6.87565H6.88444H6.89323H6.90202H6.91081H6.9196H6.92839H6.93717H6.94596H6.95475H6.96354H6.97233H6.98112H6.98991H6.9987H7.00749H7.01628H7.02507H7.03385H7.04264H7.05143H7.06022H7.06901H7.0778H7.08659H7.09538H7.10417H7.11296H7.12175H7.13053H7.13932H7.14811H7.1569H7.16569H7.17448H7.18327H7.19206H7.20085H7.20964H7.21842H7.22721H7.236H7.24479H7.25358H7.26237H7.27116H7.27995H7.28874H7.29753H7.30632H7.3151H7.32389H7.33268H7.34147H7.35026H7.35905H7.36784H7.37663H7.38542H7.39421H7.403H7.41178H7.42057H7.42936H7.43815H7.44694H7.45573H7.46452H7.47331H7.4821H7.49089H7.49966V2.38889ZM13.3687 6.24853C13.1172 5.9796 12.7095 5.9796 12.458 6.24853C12.2065 6.51747 12.2065 6.9535 12.458 7.22243L16.3022 11.3336L16.2894 11.3336L16.2726 11.3336L16.2558 11.3336L16.239 11.3335L16.2223 11.3335L16.2055 11.3335L16.1887 11.3335L16.1719 11.3335L16.1552 11.3334L16.1384 11.3334L16.1216 11.3334L16.1048 11.3334L16.088 11.3334L16.0713 11.3333L16.0545 11.3333L16.0377 11.3333L16.0209 11.3333L16.0041 11.3333L15.9874 11.3332L15.9706 11.3332L15.9538 11.3332L15.937 11.3332L15.9202 11.3332L15.9035 11.3331L15.8867 11.3331L15.8699 11.3331L15.8531 11.3331L15.8364 11.3331L15.8196 11.333L15.8028 11.333L15.786 11.333L15.7692 11.333L15.7525 11.333L15.7357 11.3329L15.7189 11.3329L15.7021 11.3329L15.6853 11.3329L15.6686 11.3329L15.6518 11.3328L15.635 11.3328L15.6182 11.3328L15.6014 11.3328L15.5847 11.3328L15.5679 11.3327L15.5511 11.3327L15.5343 11.3327L15.5175 11.3327L15.5008 11.3327L15.484 11.3326L15.4672 11.3326L15.4504 11.3326L15.4337 11.3326L15.4169 11.3326L15.4001 11.3325L15.3833 11.3325L15.3665 11.3325L15.3498 11.3325L15.333 11.3324L15.3162 11.3324L15.2994 11.3324L15.2826 11.3324L15.2659 11.3324L15.2491 11.3323L15.2323 11.3323L15.2155 11.3323L15.1987 11.3323L15.182 11.3323L15.1652 11.3322L15.1484 11.3322L15.1316 11.3322L15.1148 11.3322L15.0981 11.3322L15.0813 11.3321L15.0645 11.3321L15.0477 11.3321L15.031 11.3321L15.0142 11.3321L14.9974 11.332L14.9806 11.332L14.9638 11.332L14.9471 11.332L14.9303 11.332L14.9135 11.3319L14.8967 11.3319L14.8799 11.3319L14.8632 11.3319L14.8464 11.3319L14.8296 11.3318L14.8128 11.3318L14.796 11.3318L14.7793 11.3318L14.7625 11.3318L14.7457 11.3317L14.7289 11.3317L14.7122 11.3317L14.6954 11.3317L14.6786 11.3317L14.6618 11.3316L14.645 11.3316L14.6283 11.3316L14.6115 11.3316L14.5947 11.3316L14.5779 11.3315L14.5611 11.3315L14.5444 11.3315L14.5276 11.3315L14.5108 11.3315L14.494 11.3314L14.4772 11.3314L14.4605 11.3314L14.4437 11.3314L14.4269 11.3314L14.4101 11.3313L14.3933 11.3313L14.3766 11.3313L14.3598 11.3313L14.343 11.3313L14.3262 11.3312L14.3095 11.3312L14.2927 11.3312L14.2759 11.3312L14.2591 11.3312L14.2423 11.3311L14.2256 11.3311L14.2088 11.3311L14.192 11.3311L14.1752 11.3311L14.1584 11.331L14.1417 11.331L14.1249 11.331L14.1081 11.331L14.0913 11.331L14.0745 11.3309L14.0578 11.3309L14.041 11.3309L14.0242 11.3309L14.0074 11.3309L13.9906 11.3308L13.9739 11.3308L13.9571 11.3308L13.9403 11.3308L13.9235 11.3308L13.9068 11.3307L13.89 11.3307L13.8732 11.3307L13.8564 11.3307L13.8396 11.3307L13.8229 11.3306L13.8061 11.3306L13.7893 11.3306L13.7725 11.3306L13.7557 11.3306L13.739 11.3305L13.7222 11.3305L13.7054 11.3305L13.6886 11.3305L13.6718 11.3305L13.6551 11.3304L13.6383 11.3304L13.6215 11.3304L13.6047 11.3304L13.5879 11.3304L13.5712 11.3303L13.5544 11.3303L13.5376 11.3303L13.5208 11.3303L13.5041 11.3303L13.4873 11.3302L13.4705 11.3302L13.4537 11.3302L13.4369 11.3302L13.4202 11.3302L13.4034 11.3301L13.3866 11.3301L13.3698 11.3301L13.353 11.3301L13.3363 11.33L13.3195 11.33L13.3027 11.33L13.2859 11.33L13.2691 11.33L13.2524 11.3299L13.2356 11.3299L13.2188 11.3299L13.202 11.3299L13.1853 11.3299L13.1685 11.3298L13.1517 11.3298L13.1349 11.3298L13.1181 11.3298L13.1014 11.3298L13.0846 11.3297L13.0678 11.3297L13.051 11.3297L13.0342 11.3297L13.0175 11.3297L13.0007 11.3296L12.9839 11.3296L12.9671 11.3296L12.9503 11.3296L12.9336 11.3296L12.9168 11.3295L12.9 11.3295L12.8832 11.3295L12.8664 11.3295L12.8497 11.3295L12.8329 11.3294L12.8161 11.3294L12.7993 11.3294L12.7826 11.3294L12.7658 11.3294L12.749 11.3293L12.7322 11.3293L12.7154 11.3293L12.6987 11.3293L12.6819 11.3293L12.6651 11.3292L12.6483 11.3292L12.6315 11.3292L12.6148 11.3292L12.598 11.3292L12.5812 11.3291L12.5644 11.3291L12.5476 11.3291L12.5309 11.3291L12.5141 11.3291L12.4973 11.329L12.4805 11.329L12.4637 11.329L12.447 11.329L12.4302 11.329L12.4134 11.3289L12.3966 11.3289L12.3799 11.3289L12.3631 11.3289L12.3463 11.3289L12.3295 11.3288L12.3127 11.3288L12.296 11.3288L12.2792 11.3288L12.2624 11.3288L12.2456 11.3287L12.2288 11.3287L12.2121 11.3287L12.1953 11.3287L12.1785 11.3287L12.1617 11.3286L12.1449 11.3286L12.1282 11.3286L12.1114 11.3286L12.0946 11.3286L12.0778 11.3285L12.0611 11.3285L12.0443 11.3285L12.0275 11.3285L12.0107 11.3285L11.9939 11.3284L11.9772 11.3284L11.9604 11.3284L11.9436 11.3284L11.9268 11.3284L11.91 11.3283L11.8933 11.3283L11.8765 11.3283L11.8597 11.3283L11.8429 11.3283L11.8261 11.3282L11.8094 11.3282L11.7926 11.3282L11.7758 11.3282L11.759 11.3282L11.7422 11.3281L11.7255 11.3281L11.7087 11.3281L11.6919 11.3281L11.6751 11.3281L11.6583 11.328L11.6416 11.328L11.6248 11.328L11.608 11.328L11.5912 11.328L11.5745 11.3279L11.5577 11.3279L11.5409 11.3279L11.5241 11.3279L11.5073 11.3279L11.4906 11.3278L11.4738 11.3278L11.457 11.3278L11.4402 11.3278L11.4234 11.3278L11.4067 11.3277L11.3899 11.3277L11.3731 11.3277L11.3563 11.3277L11.3395 11.3277L11.3228 11.3276L11.306 11.3276L11.2892 11.3276L11.2724 11.3276L11.2557 11.3275L11.2389 11.3275L11.2221 11.3275L11.2053 11.3275L11.1885 11.3275L11.1718 11.3274L11.155 11.3274L11.1382 11.3274L11.1214 11.3274L11.1046 11.3274L11.0879 11.3273L11.0711 11.3273L11.0543 11.3273L11.0375 11.3273L11.0207 11.3273L11.004 11.3272L10.9872 11.3272L10.9704 11.3272L10.9536 11.3272L10.9368 11.3272L10.9201 11.3271L10.9033 11.3271L10.8865 11.3271L10.8697 11.3271L10.853 11.3271L10.8362 11.327L10.8194 11.327L10.8026 11.327L10.7858 11.327L10.7691 11.327L10.7523 11.3269L10.7355 11.3269L10.7187 11.3269L10.7019 11.3269L10.6852 11.3269L10.6684 11.3268L10.6516 11.3268L10.6348 11.3268L10.618 11.3268L10.6013 11.3268L10.5845 11.3267L10.5677 11.3267L10.5509 11.3267L10.5341 11.3267L10.5174 11.3267L10.5006 11.3266L10.4838 11.3266L10.467 11.3266L10.4503 11.3266L10.4335 11.3266L10.4167 11.3265L10.3999 11.3265L10.3831 11.3265L10.3664 11.3265L10.3496 11.3265L10.3328 11.3264L10.316 11.3264L10.2992 11.3264L10.2825 11.3264L10.2657 11.3264L10.2489 11.3263L10.2321 11.3263L10.2153 11.3263L10.1986 11.3263L10.1818 11.3263L10.165 11.3262L10.1482 11.3262L10.1315 11.3262L10.1147 11.3262L10.0979 11.3262L10.0811 11.3261L10.0643 11.3261L10.0476 11.3261L10.0308 11.3261L10.014 11.3261L9.99722 11.326L9.98044 11.326L9.96366 11.326L9.94688 11.326L9.9301 11.326L9.91332 11.3259L9.89654 11.3259L9.87977 11.3259L9.86299 11.3259L9.84621 11.3259L9.82943 11.3258L9.81265 11.3258L9.79587 11.3258L9.77909 11.3258L9.76231 11.3258L9.74553 11.3257L9.72875 11.3257L9.71197 11.3257L9.69519 11.3257L9.67841 11.3257L9.66163 11.3256L9.64486 11.3256L9.62808 11.3256L9.6113 11.3256L9.59452 11.3256L9.57774 11.3255L9.56096 11.3255L9.54418 11.3255L9.5274 11.3255L9.51062 11.3255L9.49384 11.3254L9.47706 11.3254L9.46029 11.3254L9.44351 11.3254L9.42673 11.3254L9.40995 11.3253L9.39317 11.3253L9.37639 11.3253L9.35961 11.3253L9.34283 11.3253L9.32605 11.3252L9.30927 11.3252L9.29249 11.3252L9.27572 11.3252L9.25894 11.3252L9.24216 11.3251L9.22538 11.3251L9.2086 11.3251L9.19182 11.3251L9.17504 11.325L9.15826 11.325L9.14148 11.325L9.1247 11.325L9.10792 11.325L9.09115 11.3249L9.07437 11.3249L9.05759 11.3249L9.04081 11.3249L9.02403 11.3249L9.00725 11.3248L8.99047 11.3248L8.97369 11.3248L8.95691 11.3248L8.94013 11.3248L8.92335 11.3247L8.90658 11.3247L8.8898 11.3247L8.87302 11.3247L8.85624 11.3247L8.83946 11.3246L8.82268 11.3246L8.8059 11.3246L8.78912 11.3246L8.77234 11.3246L8.75556 11.3245L8.73878 11.3245L8.722 11.3245L8.70523 11.3245L8.68845 11.3245L8.67167 11.3244L8.65489 11.3244L8.63811 11.3244L8.62133 11.3244L8.60455 11.3244L8.58777 11.3243L8.57099 11.3243L8.55421 11.3243L8.53743 11.3243L8.52066 11.3243L8.50388 11.3242L8.4871 11.3242L8.47032 11.3242L8.45354 11.3242L8.43676 11.3242L8.41998 11.3241L8.4032 11.3241L8.38642 11.3241L8.36964 11.3241L8.35286 11.3241L8.33608 11.324L8.31931 11.324L8.30253 11.324L8.28575 11.324L8.26897 11.324L8.25219 11.3239L8.23541 11.3239L8.21863 11.3239L8.20185 11.3239L8.18507 11.3239L8.16829 11.3238L8.15151 11.3238L8.13474 11.3238L8.11796 11.3238L8.10118 11.3238L8.0844 11.3237L8.06762 11.3237L8.05084 11.3237L8.03406 11.3237L8.01728 11.3237L8.0005 11.3236L7.99885 12.657L8.01563 12.657L8.03241 12.657L8.04919 12.657L8.06597 12.6571L8.08274 12.6571L8.09952 12.6571L8.1163 12.6571L8.13308 12.6571L8.14986 12.6572L8.16664 12.6572L8.18342 12.6572L8.2002 12.6572L8.21698 12.6572L8.23376 12.6573L8.25054 12.6573L8.26731 12.6573L8.28409 12.6573L8.30087 12.6573L8.31765 12.6574L8.33443 12.6574L8.35121 12.6574L8.36799 12.6574L8.38477 12.6574L8.40155 12.6575L8.41833 12.6575L8.43511 12.6575L8.45189 12.6575L8.46866 12.6575L8.48544 12.6576L8.50222 12.6576L8.519 12.6576L8.53578 12.6576L8.55256 12.6576L8.56934 12.6577L8.58612 12.6577L8.6029 12.6577L8.61968 12.6577L8.63646 12.6577L8.65323 12.6578L8.67001 12.6578L8.68679 12.6578L8.70357 12.6578L8.72035 12.6578L8.73713 12.6579L8.75391 12.6579L8.77069 12.6579L8.78747 12.6579L8.80425 12.6579L8.82103 12.658L8.83781 12.658L8.85458 12.658L8.87136 12.658L8.88814 12.658L8.90492 12.6581L8.9217 12.6581L8.93848 12.6581L8.95526 12.6581L8.97204 12.6581L8.98882 12.6582L9.0056 12.6582L9.02238 12.6582L9.03915 12.6582L9.05593 12.6582L9.07271 12.6583L9.08949 12.6583L9.10627 12.6583L9.12305 12.6583L9.13983 12.6583L9.15661 12.6584L9.17339 12.6584L9.19017 12.6584L9.20695 12.6584L9.22373 12.6584L9.2405 12.6585L9.25728 12.6585L9.27406 12.6585L9.29084 12.6585L9.30762 12.6585L9.3244 12.6586L9.34118 12.6586L9.35796 12.6586L9.37474 12.6586L9.39152 12.6586L9.4083 12.6587L9.42507 12.6587L9.44185 12.6587L9.45863 12.6587L9.47541 12.6587L9.49219 12.6588L9.50897 12.6588L9.52575 12.6588L9.54253 12.6588L9.55931 12.6588L9.57609 12.6589L9.59287 12.6589L9.60964 12.6589L9.62642 12.6589L9.6432 12.6589L9.65998 12.659L9.67676 12.659L9.69354 12.659L9.71032 12.659L9.7271 12.659L9.74388 12.6591L9.76066 12.6591L9.77744 12.6591L9.79421 12.6591L9.81099 12.6591L9.82777 12.6592L9.84455 12.6592L9.86133 12.6592L9.87811 12.6592L9.89489 12.6592L9.91167 12.6593L9.92845 12.6593L9.94523 12.6593L9.96201 12.6593L9.97879 12.6594L9.99556 12.6594L10.0123 12.6594L10.0291 12.6594L10.0459 12.6594L10.0627 12.6595L10.0795 12.6595L10.0962 12.6595L10.113 12.6595L10.1298 12.6595L10.1466 12.6596L10.1634 12.6596L10.1801 12.6596L10.1969 12.6596L10.2137 12.6596L10.2305 12.6597L10.2473 12.6597L10.264 12.6597L10.2808 12.6597L10.2976 12.6597L10.3144 12.6598L10.3311 12.6598L10.3479 12.6598L10.3647 12.6598L10.3815 12.6598L10.3983 12.6599L10.415 12.6599L10.4318 12.6599L10.4486 12.6599L10.4654 12.6599L10.4822 12.66L10.4989 12.66L10.5157 12.66L10.5325 12.66L10.5493 12.66L10.5661 12.6601L10.5828 12.6601L10.5996 12.6601L10.6164 12.6601L10.6332 12.6601L10.65 12.6602L10.6667 12.6602L10.6835 12.6602L10.7003 12.6602L10.7171 12.6602L10.7338 12.6603L10.7506 12.6603L10.7674 12.6603L10.7842 12.6603L10.801 12.6603L10.8177 12.6604L10.8345 12.6604L10.8513 12.6604L10.8681 12.6604L10.8849 12.6604L10.9016 12.6605L10.9184 12.6605L10.9352 12.6605L10.952 12.6605L10.9688 12.6605L10.9855 12.6606L11.0023 12.6606L11.0191 12.6606L11.0359 12.6606L11.0526 12.6606L11.0694 12.6607L11.0862 12.6607L11.103 12.6607L11.1198 12.6607L11.1365 12.6607L11.1533 12.6608L11.1701 12.6608L11.1869 12.6608L11.2037 12.6608L11.2204 12.6608L11.2372 12.6609L11.254 12.6609L11.2708 12.6609L11.2876 12.6609L11.3043 12.6609L11.3211 12.661L11.3379 12.661L11.3547 12.661L11.3715 12.661L11.3882 12.661L11.405 12.6611L11.4218 12.6611L11.4386 12.6611L11.4553 12.6611L11.4721 12.6611L11.4889 12.6612L11.5057 12.6612L11.5225 12.6612L11.5392 12.6612L11.556 12.6612L11.5728 12.6613L11.5896 12.6613L11.6064 12.6613L11.6231 12.6613L11.6399 12.6613L11.6567 12.6614L11.6735 12.6614L11.6903 12.6614L11.707 12.6614L11.7238 12.6614L11.7406 12.6615L11.7574 12.6615L11.7742 12.6615L11.7909 12.6615L11.8077 12.6615L11.8245 12.6616L11.8413 12.6616L11.858 12.6616L11.8748 12.6616L11.8916 12.6616L11.9084 12.6617L11.9252 12.6617L11.9419 12.6617L11.9587 12.6617L11.9755 12.6617L11.9923 12.6618L12.0091 12.6618L12.0258 12.6618L12.0426 12.6618L12.0594 12.6618L12.0762 12.6619L12.093 12.6619L12.1097 12.6619L12.1265 12.6619L12.1433 12.662L12.1601 12.662L12.1768 12.662L12.1936 12.662L12.2104 12.662L12.2272 12.6621L12.244 12.6621L12.2607 12.6621L12.2775 12.6621L12.2943 12.6621L12.3111 12.6622L12.3279 12.6622L12.3446 12.6622L12.3614 12.6622L12.3782 12.6622L12.395 12.6623L12.4118 12.6623L12.4285 12.6623L12.4453 12.6623L12.4621 12.6623L12.4789 12.6624L12.4957 12.6624L12.5124 12.6624L12.5292 12.6624L12.546 12.6624L12.5628 12.6625L12.5795 12.6625L12.5963 12.6625L12.6131 12.6625L12.6299 12.6625L12.6467 12.6626L12.6634 12.6626L12.6802 12.6626L12.697 12.6626L12.7138 12.6626L12.7306 12.6627L12.7473 12.6627L12.7641 12.6627L12.7809 12.6627L12.7977 12.6627L12.8145 12.6628L12.8312 12.6628L12.848 12.6628L12.8648 12.6628L12.8816 12.6628L12.8984 12.6629L12.9151 12.6629L12.9319 12.6629L12.9487 12.6629L12.9655 12.6629L12.9822 12.663L12.999 12.663L13.0158 12.663L13.0326 12.663L13.0494 12.663L13.0661 12.6631L13.0829 12.6631L13.0997 12.6631L13.1165 12.6631L13.1333 12.6631L13.15 12.6632L13.1668 12.6632L13.1836 12.6632L13.2004 12.6632L13.2172 12.6632L13.2339 12.6633L13.2507 12.6633L13.2675 12.6633L13.2843 12.6633L13.3011 12.6633L13.3178 12.6634L13.3346 12.6634L13.3514 12.6634L13.3682 12.6634L13.3849 12.6634L13.4017 12.6635L13.4185 12.6635L13.4353 12.6635L13.4521 12.6635L13.4688 12.6635L13.4856 12.6636L13.5024 12.6636L13.5192 12.6636L13.536 12.6636L13.5527 12.6636L13.5695 12.6637L13.5863 12.6637L13.6031 12.6637L13.6199 12.6637L13.6366 12.6637L13.6534 12.6638L13.6702 12.6638L13.687 12.6638L13.7038 12.6638L13.7205 12.6638L13.7373 12.6639L13.7541 12.6639L13.7709 12.6639L13.7876 12.6639L13.8044 12.6639L13.8212 12.664L13.838 12.664L13.8548 12.664L13.8715 12.664L13.8883 12.664L13.9051 12.6641L13.9219 12.6641L13.9387 12.6641L13.9554 12.6641L13.9722 12.6641L13.989 12.6642L14.0058 12.6642L14.0226 12.6642L14.0393 12.6642L14.0561 12.6642L14.0729 12.6643L14.0897 12.6643L14.1064 12.6643L14.1232 12.6643L14.14 12.6644L14.1568 12.6644L14.1736 12.6644L14.1903 12.6644L14.2071 12.6644L14.2239 12.6645L14.2407 12.6645L14.2575 12.6645L14.2742 12.6645L14.291 12.6645L14.3078 12.6646L14.3246 12.6646L14.3414 12.6646L14.3581 12.6646L14.3749 12.6646L14.3917 12.6647L14.4085 12.6647L14.4253 12.6647L14.442 12.6647L14.4588 12.6647L14.4756 12.6648L14.4924 12.6648L14.5091 12.6648L14.5259 12.6648L14.5427 12.6648L14.5595 12.6649L14.5763 12.6649L14.593 12.6649L14.6098 12.6649L14.6266 12.6649L14.6434 12.665L14.6602 12.665L14.6769 12.665L14.6937 12.665L14.7105 12.665L14.7273 12.6651L14.7441 12.6651L14.7608 12.6651L14.7776 12.6651L14.7944 12.6651L14.8112 12.6652L14.828 12.6652L14.8447 12.6652L14.8615 12.6652L14.8783 12.6652L14.8951 12.6653L14.9118 12.6653L14.9286 12.6653L14.9454 12.6653L14.9622 12.6653L14.979 12.6654L14.9957 12.6654L15.0125 12.6654L15.0293 12.6654L15.0461 12.6654L15.0629 12.6655L15.0796 12.6655L15.0964 12.6655L15.1132 12.6655L15.13 12.6655L15.1468 12.6656L15.1635 12.6656L15.1803 12.6656L15.1971 12.6656L15.2139 12.6656L15.2306 12.6657L15.2474 12.6657L15.2642 12.6657L15.281 12.6657L15.2978 12.6657L15.3145 12.6658L15.3313 12.6658L15.3481 12.6658L15.3649 12.6658L15.3817 12.6658L15.3984 12.6659L15.4152 12.6659L15.432 12.6659L15.4488 12.6659L15.4656 12.6659L15.4823 12.666L15.4991 12.666L15.5159 12.666L15.5327 12.666L15.5495 12.666L15.5662 12.6661L15.583 12.6661L15.5998 12.6661L15.6166 12.6661L15.6333 12.6661L15.6501 12.6662L15.6669 12.6662L15.6837 12.6662L15.7005 12.6662L15.7172 12.6662L15.734 12.6663L15.7508 12.6663L15.7676 12.6663L15.7844 12.6663L15.8011 12.6663L15.8179 12.6664L15.8347 12.6664L15.8515 12.6664L15.8683 12.6664L15.885 12.6664L15.9018 12.6665L15.9186 12.6665L15.9354 12.6665L15.9522 12.6665L15.9689 12.6665L15.9857 12.6666L16.0025 12.6666L16.0193 12.6666L16.036 12.6666L16.0528 12.6666L16.0696 12.6667L16.0864 12.6667L16.1032 12.6667L16.1199 12.6667L16.1367 12.6667L16.1535 12.6668L16.1703 12.6668L16.1871 12.6668L16.2038 12.6668L16.2206 12.6669L16.2374 12.6669L16.2542 12.6669L16.271 12.6669L16.2836 12.6669L12.458 16.7581C12.2065 17.0271 12.2065 17.4631 12.458 17.732C12.7095 18.001 13.1172 18.001 13.3687 17.732L18.2822 12.4772C18.5337 12.2083 18.5337 11.7723 18.2822 11.5033L13.3687 6.24853Z",fill:"white"})),SYe=_.forwardRef(_Ye),EYe=(e,t)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.2139 2.44646L12 3.99992H5.4375C4.64359 3.99992 4 4.64352 4 5.43742V18.5624C4 19.3563 4.64359 19.9999 5.4375 19.9999H12L18.2139 21.5534C19.1211 21.7802 20 21.094 20 20.1588V3.84104C20 2.90584 19.1211 2.21964 18.2139 2.44646ZM12 17.9999V5.99992H6V17.9999H12Z",fill:"white"})),wYe=_.forwardRef(EYe),CYe="_userButton_t5z8t_15",TYe={userButton:CYe},RYe=({preventNavigation:e,isAuthenticated:t,isPasswordlessUser:n,userId:r,displayName:i,avatarUrl:o,onAction:s})=>{const{t:a}=Je(),l=ts(),c=_.useMemo(()=>{const r=[];return t&&(r.push({key:"user",icon:fW,label:i,dataTestid:"usermenu_user"}),r.push({key:"settings",icon:bYe,label:a("common.settings")}),n&&!e&&r.push({key:"login",label:a("action.sign_in"),icon:SYe,dataTestid:"usermenu_login"}),!n&&!e&&r.push({key:"logout",label:a("action.sign_out"),icon:wYe,dataTestid:"usermenu_logout"})),r},[t,n,i,e,a]),[u,d]=_.useState(!1);return t?w.jsx(xM,{title:a("a11y.user_menu"),showTitle:!1,align:"end",open:u,onOpenChange:d,trigger:w.jsx("button",{"aria-label":a("common.profile"),className:TYe.userButton,"data-testid":"usermenu_open",children:!t||n&&!o?w.jsx(fW,{}):w.jsx(Qv,{id:r,name:i,size:Jv.SM,src:o})}),children:c.map(({key:e,icon:t,label:n,dataTestid:r})=>w.jsx(fv,{Icon:t,label:n,"data-testid":r,onSelect:()=>s(e)},e))}):w.jsx(x8,{to:{pathname:"/login"},state:{from:l},children:a("log_in")})},X9=({preventNavigation:e=!1})=>{const t=ts(),n=fl(),{client:r,logout:i,authenticated:o,passwordlessUser:s}=O8(),{displayName:a,avatarUrl:l}=D_(r),[c,u]=_.useState(!1),d=_.useCallback(()=>u(!1),[u]),[h,p]=_.useState(W9),f=_.useCallback(e=>{var r;switch(e){case"user":p("profile"),u(!0);break;case"settings":p("audio"),u(!0);break;case"logout":null==i||i();break;case"login":null==(r=n("/login",{state:{from:t}}))||r.catch(e=>M.error("Failed to navigate to login",e))}},[n,t,i,u]),m=(null==r?void 0:r.getUserIdLocalpart())??"";return w.jsxs(w.Fragment,{children:[w.jsx(RYe,{preventNavigation:e,isAuthenticated:o,isPasswordlessUser:s,avatarUrl:l,onAction:f,userId:(null==r?void 0:r.getUserId())??"",displayName:a||(m?m.replace("@",""):"")}),r&&w.jsx(Y9,{client:r,open:c,onDismiss:d,tab:h,onTabChange:p})]})};function IYe(e){return new Worker(""+new URL("IndexedDBWorker-k_3vZa8J.js",import.meta.url).href,{name:null==e?void 0:e.name})}const ife=new Pn;function kYe(e){return[dp(ife,e,_.useCallback(()=>localStorage.getItem(e),[e])),_.useCallback(t=>sfe(e,t),[e])]}const sfe=(e,t)=>{localStorage.setItem(e,t),ife.emit(e)};function ofe(e,t){localStorage.getItem(Gb(e))!==t&&sfe(Gb(e),t)}const Gb=e=>`room-shared-key-${e}`,xYe=(e,t)=>{const[n,r]=kYe(Gb(e));return _.useEffect(()=>{t&&r(t)},[t,r]),[t??n,r]};function afe(e){const{roomId:t,password:n}=Fr();return e!==t&&M.warn("requested key for a roomId which is not the current call room id (from the URL)",e,t),n??localStorage.getItem(Gb(e))}function H_(e){const{client:t}=Pp(),[n]=xYe(Gb(e),afe(e)??void 0),r=null==t?void 0:t.getRoom(e);return _.useMemo(()=>r?n?{kind:sn.SHARED_KEY,secret:n}:r.hasEncryptionStateEvent()?{kind:sn.PER_PARTICIPANT}:{kind:sn.NONE}:{kind:sn.NONE},[r,n])}const hW=!1,AYe="element-call-sync";async function LYe(e){let t=!!await e.store.getSavedSyncToken();return new Promise((n,r)=>{const i=(o,s,a)=>{"PREPARED"===o?t?t=!1:(e.removeListener(Le.Sync,i),n()):"ERROR"===o&&(e.removeListener(Le.Sync,i),r(null==a?void 0:a.error))};e.on(Le.Sync,i)})}async function cfe(e,t){var n;let r;try{r=window.indexedDB}catch(e){M.warn("Could not get indexDB from window.",e)}const i={fallbackICEServerAllowed:hW,isVoipWithNoMediaAllowed:null==(n=Zt.get().features)?void 0:n.feature_group_calls_without_video_and_audio};r&&localStorage?i.store=new mQ({indexedDB:window.indexedDB,localStorage,dbName:AYe,workerFactory:()=>new IYe}):localStorage&&(i.store=new ub({localStorage}));const{e2eEnabled:o}=Fr();o||M.info("Disabling E2E: group call signalling will NOT be encrypted.");const s=Y3({...i,...e,useAuthorizationHeader:!0,localTimeoutMs:5e3,useE2eForGroupCall:o,fallbackICEServerAllowed:hW});t||await s.clearStores();try{await s.store.startup()}catch(e){M.error("Error starting matrix client indexDB store. Falling back to memory store.",e),s.store=new ub({localStorage}),await s.store.startup()}try{await s.initRustCrypto()}catch(e){M.warn(e,"Make sure to clear client stores before initializing the rust crypto.")}const a=LYe(s);return await s.startClient({clientWellKnownPollPeriod:600}),await a,s}function V_(e){return e.trim().replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase()}function PYe(e,t){return`#${V_(e)}:${t.getDomain()}`}function lfe(e){const t=e.split(":",2);if(2===t.length&&"#"===t[0][0]){if(t[1]===Zt.defaultServerName())return t[0];throw new Error("Unsupported remote room alias")}return e}async function ufe(e,t,n){M.log("Creating room for group call");const r=e.createRoom({visibility:xJ.Private,preset:q3.PublicChat,name:t,room_alias_name:n?void 0:V_(t),power_level_content_override:{invite:100,kick:100,ban:100,redact:50,state_default:0,events_default:0,users_default:0,events:{"m.room.power_levels":100,"m.room.history_visibility":100,"m.room.tombstone":100,"m.room.encryption":100,"m.room.name":50,"m.room.message":0,"m.room.encrypted":50,"m.sticker":50,"org.matrix.msc3401.call.member":0},users:{[e.getUserId()]:100}}}),i=await new Promise((t,n)=>{r.catch(e=>{n(e),o()});const i=e=>{r.then(n=>{e.roomId===n.room_id&&(t(e.roomId),o())},e=>{M.error("Failed to wait for the room to arrive",e)})},o=()=>{e.off(Le.Room,i)};e.on(Le.Room,i)});let o;return n==sn.SHARED_KEY&&(o=TJ(16),ofe(i,o)),{roomId:i,alias:n?void 0:PYe(t,e),password:o}}function dfe(e,t,n,r){return`${window.location.protocol}//${window.location.host}${PR(e,t,n)}`}function PR(e,t,n,r){return`/room/#${n?"/"+V_(n):""}?${OUe(e,t).toString()}`}async function OYe(e){let t=0;for(;;)try{return await e()}catch(e){t++;const n=NP(e,t,!0);if(n<0)throw e;await mp(n)}}const J9=e=>{const[t,n]=_.useState(void 0),[r,i]=_.useState(void 0),o=_.useRef(void 0);o.current||(o.current=Y3({baseUrl:Zt.defaultHomeserverUrl()})),_.useEffect(()=>{Qe||o.current.registerRequest({}).catch(e=>{var t,r,o,s,a,l,c;n(null==(a=null==(s=null==(o=null==(r=null==(t=e.data)?void 0:t.params["m.login.terms"])?void 0:r.policies)?void 0:o.privacy_policy)?void 0:s.en)?void 0:a.url),i(null==(c=null==(l=e.data)?void 0:l.params["m.login.recaptcha"])?void 0:c.public_key)})},[]);return{privacyPolicyUrl:t,recaptchaKey:r,register:_.useCallback(async(t,n,r,i,s)=>{const a=new eO({matrixClient:o.current,doRequest:async e=>o.current.registerRequest({username:t,password:n,auth:e||void 0}),stateUpdated:(e,t)=>{if(t.error)throw new Error(t.error);"m.login.terms"===e?a.submitAuthDict({type:"m.login.terms"}).catch(e=>{M.error(e)}):"m.login.recaptcha"===e&&a.submitAuthDict({type:"m.login.recaptcha",response:i}).catch(e=>{M.error(e)})},requestEmailToken:async()=>Promise.resolve({sid:"dummy"})}),{user_id:l,access_token:c,device_id:u}=await a.attemptAuth();await(null==e?void 0:e.logout(!0));const d=await cfe({baseUrl:Zt.defaultHomeserverUrl(),accessToken:c,userId:l,deviceId:u},!1);await d.setDisplayName(r);const h={user_id:l,device_id:u,access_token:c,passwordlessUser:s};s&&(h.tempPassword=n);const p=d.getUser(d.getUserId());return p.setRawDisplayName(r),p.setDisplayName(r),[d,h]},[e])}},MYe="_buttons_1arp2_8",DYe={buttons:MYe},ffe=({onJoin:e,open:t,onDismiss:n})=>{const{t:r}=Je();return w.jsxs(Lp,{title:r("join_existing_call_modal.title"),open:t,onDismiss:n,children:[w.jsx("p",{children:r("join_existing_call_modal.text")}),w.jsxs(St,{rightAlign:!0,className:DYe.buttons,children:[w.jsx(Ft,{onClick:n,children:r("action.no")}),w.jsx(Ft,{onClick:e,"data-testid":"home_joinExistingRoom",children:r("join_existing_call_modal.join_button")})]})]})},pW="https://www.recaptcha.net/recaptcha/api.js?onload=mxOnRecaptchaLoaded&render=explicit";function Q9(e){const{t}=Je(),[n]=_.useState(()=>Eo(16)),r=_.useRef(void 0);_.useEffect(()=>{var t;if(!e)return;const i=()=>{document.getElementById(n)&&window.grecaptcha.render(n,{sitekey:e,size:"invisible",callback:e=>{var t;return null==(t=r.current)?void 0:t.resolve(e)},"error-callback":()=>{var e;return null==(e=r.current)?void 0:e.reject(new Error)}})};if("function"==typeof(null==(t=window.grecaptcha)?void 0:t.render))i();else if(window.mxOnRecaptchaLoaded=i,!document.querySelector(`script[src="${pW}"]`)){const e=document.createElement("script");e.src=pW,e.async=!0,document.body.appendChild(e)}},[n,e]);return{execute:_.useCallback(async()=>e?window.grecaptcha?new Promise((e,n)=>{var i,o;const s=new MutationObserver(e=>{var r,i;for(const o of e)if("visible"!==(null==(i=null==(r=o.target)?void 0:r.style)?void 0:i.visibility))return n(VK("recaptcha_dismissed",t)),void s.disconnect()});r.current={resolve:t=>{e(t),s.disconnect()},reject:e=>{n(e),s.disconnect()}},window.grecaptcha.execute().then(()=>{},e=>{M.error("Recaptcha execution failed",e)});const a=document.querySelector('iframe[src*="recaptcha/api2/bframe"]');null!=(i=null==a?void 0:a.parentNode)&&i.parentNode&&s.observe(null==(o=null==a?void 0:a.parentNode)?void 0:o.parentNode,{attributes:!0})}):(M.log("Recaptcha not loaded"),Promise.reject(VK("recaptcha_not_loaded",t))):Promise.resolve(""),[e,t]),reset:_.useCallback(()=>{var e;null==(e=window.grecaptcha)||e.reset()},[]),recaptchaId:n}}const NYe="_form_jcuzc_8",UYe={form:NYe},OR=({ref:e,children:t,className:n,onSubmit:r})=>w.jsx("form",{onSubmit:r,className:Ne(UYe.form,n),ref:e,children:t});OR.displayName="Form";const jYe="_footer_106jg_8",FYe="_mobileLoginLink_106jg_19",$Ye="_form_106jg_24",BYe="_notice_106jg_40",K0={footer:jYe,mobileLoginLink:FYe,form:$Ye,notice:BYe},HYe="_container_dwllg_8",VYe="_main_dwllg_15",qYe="_logo_dwllg_23",Vg={container:HYe,main:VYe,logo:qYe},mW=e=>{e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296};class GYe{constructor(e){this.dictionaries=void 0,this.length=void 0,this.separator=void 0,this.style=void 0,this.seed=void 0;const{length:t,separator:n,dictionaries:r,style:i,seed:o}=e;this.dictionaries=r,this.separator=n,this.length=t,this.style=i,this.seed=o}generate(){if(!this.dictionaries)throw new Error('Cannot find any dictionary. Please provide at least one, or leave the "dictionary" field empty in the config object');if(this.length<=0)throw new Error("Invalid length provided");if(this.length>this.dictionaries.length)throw new Error(`The length cannot be bigger than the number of dictionaries.\nLength provided: ${this.length}. Number of dictionaries provided: ${this.dictionaries.length}`);let e=this.seed;return this.dictionaries.slice(0,this.length).reduce((t,n)=>{let r;e?(r=(e=>{if("string"==typeof e){const t=e.split("").map(e=>e.charCodeAt(0)).reduce((e,t)=>e+t,1),n=Math.floor(Number(t));return mW(n)}return mW(e)})(e),e=4294967296*r):r=Math.random();let i=n[Math.floor(r*n.length)]||"";if("lowerCase"===this.style)i=i.toLowerCase();else if("capital"===this.style){const[e,...t]=i.split("");i=e.toUpperCase()+t.join("")}else"upperCase"===this.style&&(i=i.toUpperCase());return t?`${t}${this.separator}${i}`:`${i}`},"")}}const gW={separator:"_",dictionaries:[]},KYe=e=>{const t=[...e&&e.dictionaries||gW.dictionaries],n={...gW,...e,length:e&&e.length||t.length,dictionaries:t};if(!e||!e.dictionaries||!e.dictionaries.length)throw new Error('A "dictionaries" array must be provided. This is a breaking change introduced starting from Unique Name Generator v4. Read more about the breaking change here: https://github.com/andreasonny83/unique-names-generator#migration-guide');return new GYe(n).generate()};var zYe=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","amused","ancient","angry","annoyed","annual","anonymous","anxious","appalling","apparent","applicable","appropriate","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","asleep","assistant","associated","atomic","attractive","automatic","autonomous","available","average","awake","aware","awful","awkward","back","bad","balanced","bare","basic","beautiful","beneficial","better","bewildered","big","binding","biological","bitter","bizarre","blank","blind","blonde","bloody","blushing","boiling","bold","bored","boring","bottom","brainy","brave","breakable","breezy","brief","bright","brilliant","broad","broken","bumpy","burning","busy","calm","capable","capitalist","careful","casual","causal","cautious","central","certain","changing","characteristic","charming","cheap","cheerful","chemical","chief","chilly","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clear","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concrete","condemned","confident","confidential","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","creative","creepy","criminal","critical","crooked","crowded","crucial","crude","cruel","cuddly","cultural","curious","curly","current","curved","cute","daily","damaged","damp","dangerous","dark","dead","deaf","deafening","dear","decent","decisive","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delighted","delightful","democratic","dependent","depressed","desirable","desperate","detailed","determined","developed","developing","devoted","different","difficult","digital","diplomatic","direct","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dual","due","dull","dusty","dutch","dying","dynamic","eager","early","eastern","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","eligible","embarrassed","embarrassing","emotional","empirical","empty","enchanting","encouraging","endless","energetic","enormous","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","eventual","everyday","evident","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","fair","faithful","familiar","famous","fancy","fantastic","far","fascinating","fashionable","fast","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","filthy","final","financial","fine","firm","fiscal","fit","fixed","flaky","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","frequent","fresh","friendly","frightened","front","frozen","full","fun","functional","fundamental","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","genuine","geographical","giant","gigantic","given","glad","glamorous","gleaming","global","glorious","golden","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","happy","hard","harsh","head","healthy","heavy","helpful","helpless","hidden","high","hilarious","hissing","historic","historical","hollow","holy","homeless","homely","hon","honest","horizontal","horrible","hostile","hot","huge","human","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","illegal","imaginative","immediate","immense","imperial","implicit","important","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","irrelevant","isolated","itchy","jealous","jittery","joint","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","known","labour","large","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","like","likely","limited","linear","linguistic","liquid","literary","little","live","lively","living","local","logical","lonely","long","loose","lost","loud","lovely","low","loyal","ltd","lucky","mad","magic","magnetic","magnificent","main","major","male","mammoth","managerial","managing","manual","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","naked","narrow","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","net","neutral","new","nice","noble","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","official","ok","okay","old","olympic","only","open","operational","opposite","optimistic","oral","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","overall","overseas","overwhelming","painful","pale","panicky","parallel","parental","parliamentary","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","permanent","persistent","personal","petite","philosophical","physical","plain","planned","plastic","pleasant","pleased","poised","polite","political","poor","popular","positive","possible","potential","powerful","practical","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","previous","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","provincial","psychiatric","psychological","public","puny","pure","purring","puzzled","quaint","qualified","quarrelsome","querulous","quick","quickest","quiet","quintessential","quixotic","racial","radical","rainy","random","rapid","rare","raspy","rational","ratty","raw","ready","real","realistic","rear","reasonable","recent","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","romantic","rotten","rough","round","royal","rubber","rude","ruling","running","rural","sacred","sad","safe","salty","satisfactory","satisfied","scared","scary","scattered","scientific","scornful","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shared","sharp","sheer","shiny","shivering","shocked","short","shrill","shy","sick","significant","silent","silky","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","small","smart","smiling","smoggy","smooth","social","socialist","soft","solar","sole","solid","sophisticated","sore","sorry","sound","sour","southern","soviet","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","spontaneous","sporting","spotless","spotty","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steep","sticky","stiff","still","stingy","stormy","straight","straightforward","strange","strategic","strict","striking","striped","strong","structural","stuck","stupid","subjective","subsequent","substantial","subtle","successful","successive","sudden","sufficient","suitable","sunny","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","swift","symbolic","sympathetic","systematic","tall","tame","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tense","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tiny","tired","top","tory","total","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","typical","ugliest","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unwilling","upper","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","verbal","vertical","very","vicarious","vicious","victorious","violent","visible","visiting","visual","vital","vitreous","vivacious","vivid","vocal","vocational","voiceless","voluminous","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","wealthy","weary","wee","weekly","weird","welcome","well","western","wet","whispering","whole","wicked","wide","widespread","wild","wilful","willing","willowy","wily","wise","wispy","wittering","witty","wonderful","wooden","working","worldwide","worried","worrying","worthwhile","worthy","written","wrong","xenacious","xenial","xenogeneic","xenophobic","xeric","xerothermic","yabbering","yammering","yappiest","yappy","yawning","yearling","yearning","yeasty","yelling","yelping","yielding","yodelling","young","youngest","youthful","ytterbic","yucky","yummy","zany","zealous","zeroth","zestful","zesty","zippy","zonal","zoophagous","zygomorphic","zygotic"],WYe=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"],YYe=["amaranth","amber","amethyst","apricot","aqua","aquamarine","azure","beige","black","blue","blush","bronze","brown","chocolate","coffee","copper","coral","crimson","cyan","emerald","fuchsia","gold","gray","green","harlequin","indigo","ivory","jade","lavender","lime","magenta","maroon","moccasin","olive","orange","peach","pink","plum","purple","red","rose","salmon","sapphire","scarlet","silver","tan","teal","tomato","turquoise","violet","white","yellow"];const XYe=["hydrogen","helium","lithium","beryllium","boron","carbon","nitrogen","oxygen","fluorine","neon","sodium","magnesium","aluminum","silicon","phosphorus","sulfur","chlorine","argon","potassium","calcium","scandium","titanium","vanadium","chromium","manganese","iron","cobalt","nickel","copper","zinc","gallium","germanium","arsenic","selenium","bromine","krypton","rubidium","strontium","yttrium","zirconium","niobium","molybdenum","technetium","ruthenium","rhodium","palladium","silver","cadmium","indium","tin","antimony","tellurium","iodine","xenon","cesium","barium","lanthanum","cerium","praseodymium","neodymium","promethium","samarium","europium","gadolinium","terbium","dysprosium","holmium","erbium","thulium","ytterbium","lutetium","hafnium","tantalum","wolfram","rhenium","osmium","iridium","platinum","gold","mercury","thallium","lead","bismuth","polonium","astatine","radon","francium","radium","actinium","thorium","protactinium","uranium","neptunium","plutonium","americium","curium","berkelium","californium","einsteinium","fermium","mendelevium","nobelium","lawrencium","rutherfordium","dubnium","seaborgium","bohrium","hassium","meitnerium","darmstadtium","roentgenium","copernicium","nihonium","flerovium","moscovium","livermorium","tennessine","oganesson"];function hfe(){return KYe({dictionaries:[YYe,zYe,WYe,XYe],style:"lowerCase",length:3,separator:"-"})}const JYe=()=>{const{setClient:e}=Pp(),{header:t}=Xs(),[n,r]=_.useState(!1),[i,o]=_.useState(),[s]=XT(),{recaptchaKey:a,register:l}=J9(),{execute:c,reset:u,recaptchaId:d}=Q9(a),[h,p]=_.useState(!1),f=_.useCallback(()=>p(!1),[p]),[m,v]=_.useState(),g=fl(),{t:y}=Je(),b=_.useCallback(t=>{t.preventDefault();const n=new FormData(t.target),i=lfe(n.get("callName")),s=n.get("displayName");(async function(){o(void 0),r(!0);const t=await c(),n=hfe(),[a,u]=await l(n,Eo(16),s,t,!0);let d;try{d=await ufe(a,i,sn.SHARED_KEY)}catch(t){if(!e)throw t;if("M_ROOM_IN_USE"===t.errcode)return v(()=>{var t;e(a,u);const n=V_(i);null==(t=g(`/${n}`))||t.catch(e=>{M.error("Failed to navigate to alias localpart",e)})}),r(!1),void p(!0);throw t}if(!e)throw new Error("setClient is undefined");if(!d.password)throw new Error("Failed to create room with shared secret");e(a,u),await g(PR(d.roomId,{kind:sn.SHARED_KEY,secret:d.password},i))})().catch(e=>{M.error(e),r(!1),o(e),u()})},[l,u,c,g,p,e]);return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:Vg.container,children:["standard"===t&&w.jsxs(Bu,{children:[w.jsx(Df,{children:w.jsx(cp,{})}),w.jsx(Nf,{hideMobile:!0,children:w.jsx(X9,{})})]}),w.jsxs("main",{className:Vg.main,children:[w.jsx(cp,{className:Vg.logo}),w.jsx(ml,{size:"lg",weight:"semibold",children:y("start_new_call")}),w.jsxs(OR,{className:K0.form,onSubmit:b,children:[w.jsx(St,{children:w.jsx(Sn,{id:"callName",name:"callName",label:y("call_name"),placeholder:y("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"})}),w.jsx(St,{children:w.jsx(Sn,{id:"displayName",name:"displayName",label:y("common.display_name"),placeholder:y("common.display_name"),type:"text",required:!0,"data-testid":"home_displayName",autoComplete:"off"})}),null===s&&w.jsx(on,{size:"sm",className:K0.notice,children:w.jsx(Ole,{})}),w.jsx(on,{size:"sm",className:K0.notice,children:w.jsxs(Vs,{i18nKey:"unauthenticated_view_ssla_caption",children:['By clicking "Go", you agree to our'," ",w.jsx(zh,{href:Zt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),i&&w.jsx(St,{children:w.jsx(jf,{error:i})}),w.jsx(Ft,{type:"submit",size:"lg",disabled:n,"data-testid":"home_go",children:y(n?"common.loading":"action.go")}),w.jsx("div",{id:d})]})]}),w.jsxs("footer",{className:K0.footer,children:[w.jsx(on,{className:K0.mobileLoginLink,children:w.jsx(il,{to:"/login","data-testid":"home_login",children:y("unauthenticated_view_login_button")})}),w.jsx(on,{children:w.jsxs(Vs,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",w.jsx(il,{to:"/register","data-testid":"home_register",children:"Create an account"})]})})]})]}),m&&w.jsx(ffe,{onJoin:m,open:h,onDismiss:f})]})},$m={};function vW(e,t){if($m[t.roomId])return $m[t.roomId];if(!t||!t.timeline){const e=Number.MAX_SAFE_INTEGER;return $m[t.roomId]=e,e}const n=e.getUserId();if(t.getMyMembership()!==Ve.Join){const e=t.currentState.getStateEvents("m.room.member",n);if(e&&!Array.isArray(e)){const n=e.getTs();return $m[t.roomId]=n,n}}for(let e=t.timeline.length-1;e>=0;--e){const n=t.timeline[e].getTs();if(n)return $m[t.roomId]=n,n}const r=Number.MAX_SAFE_INTEGER;return $m[t.roomId]=r,r}function QYe(e,t){return t.sort((t,n)=>vW(e,n)-vW(e,t))}const ZYe=e=>{var t,n;const r=afe(e.roomId);if(!e.hasEncryptionStateEvent()&&!r)return!1;switch(e.getJoinRule()){case ef.Public:return!0;case ef.Knock:switch(e.getMyMembership()){case Ve.Join:case Ve.Knock:return!0;case Ve.Invite:return(null==(n=null==(t=e.getLiveTimeline().getState(Me.FORWARDS))?void 0:t.getStateEvents(ee.RoomMember,e.myUserId))?void 0:n.getPrevContent().membership)===ef.Knock;default:return!1}default:return e.getMyMembership()===Ve.Join}},eXe=e=>{var t,n;switch(e.getMyMembership()){case Ve.Join:return!(null==(n=null==(t=e.getLiveTimeline().getState(Me.FORWARDS))?void 0:t.events)||!n.get(ee.GroupCallMemberPrefix));case Ve.Knock:return!0;default:return!1}};function tXe(e){const[t,n]=_.useState([]);return _.useEffect(()=>{function t(){const t=e.getRooms().filter(eXe).filter(ZYe),r=QYe(e,t).map(t=>{const n=e.matrixRTC.getRoomSession(t);return{roomAlias:t.getCanonicalAlias()??void 0,roomName:t.name,avatarUrl:t.getMxcAvatarUrl(),room:t,session:n,participants:n.memberships.filter(e=>e.sender).map(e=>t.getMember(e.sender)).filter(e=>e)}});n(r)}return t(),e.matrixRTC.on(nC.SessionStarted,t),e.on(xe.MyMembership,t),()=>{e.matrixRTC.off(nC.SessionStarted,t),e.off(xe.MyMembership,t)}},[e]),t}const nXe="_form_1vjc2_8",rXe="_fieldRow_1vjc2_16",iXe="_button_1vjc2_24",sXe="_notice_1vjc2_32",z0={form:nXe,fieldRow:rXe,button:iXe,notice:sXe},oXe="_callTileSpacer_l4ywf_8",aXe="_callTile_l4ywf_8",cXe="_callTileLink_l4ywf_28",lXe="_callInfo_l4ywf_40",uXe="_callName_l4ywf_53",dXe="_callList_l4ywf_63",fXe="_disabled_l4ywf_74",eu={callTileSpacer:oXe,callTile:aXe,callTileLink:cXe,callInfo:lXe,callName:uXe,callList:dXe,disabled:fXe},hXe=({rooms:e,client:t})=>w.jsx(w.Fragment,{children:w.jsxs("div",{className:eu.callList,children:[e.map(({room:e,roomName:n,avatarUrl:r,participants:i})=>w.jsx(pXe,{client:t,name:n,avatarUrl:r,room:e,participants:i},e.roomId)),e.length>3&&w.jsxs(w.Fragment,{children:[w.jsx("div",{className:eu.callTileSpacer}),w.jsx("div",{className:eu.callTileSpacer})]})]})}),pXe=({name:e,avatarUrl:t,room:n,client:r})=>{const{t:i}=Je(),o=H_(n.roomId),[s,a]=_.useState(!1),l=_.useCallback(e=>{e.stopPropagation(),e.preventDefault(),a(!0),r.leave(n.roomId).catch(()=>a(!1))},[n,r]),c=w.jsxs(w.Fragment,{children:[w.jsx(Qv,{id:n.roomId,name:e,size:Jv.LG,src:t}),w.jsx("div",{className:eu.callInfo,children:w.jsx(on,{weight:"semibold",className:eu.callName,children:e})}),w.jsx(wT,{onClick:l,disabled:s,"aria-label":i("action.remove"),children:w.jsx(yT,{})})]});return w.jsx("div",{className:eu.callTile,children:s?w.jsx("span",{className:Ne(eu.callTileLink,eu.disabled),children:c}):w.jsx(iT,{to:PR(n.roomId,o,n.name),className:eu.callTileLink,children:c})})},mXe=({client:e})=>{const{header:t}=Xs(),[n,r]=_.useState(!1),[i,o]=_.useState(),[s]=XT(),a=fl(),{t:l}=Je(),[c,u]=_.useState(!1),d=_.useCallback(()=>u(!1),[u]),h=_.useCallback(t=>{t.preventDefault();const n=new FormData(t.target).get("callName"),i="string"==typeof n?lfe(n):"";(async function(){o(void 0),r(!0);const t=await ufe(e,i,sn.SHARED_KEY);if(!t.password)throw new Error("Failed to create room with shared secret");await a(PR(t.roomId,{kind:sn.SHARED_KEY,secret:t.password},i))})().catch(e=>{"M_ROOM_IN_USE"===e.errcode?(m(V_(i)),r(!1),o(void 0),u(!0)):(M.error(e),r(!1),o(e))})},[e,a,u]),p=tXe(e),[f,m]=_.useState(),v=_.useCallback(()=>{var e;null==(e=a(`/${f}`))||e.catch(e=>{M.error("Failed to navigate to existing alias",e)})},[a,f]);return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:Vg.container,children:["standard"===t&&w.jsxs(Bu,{children:[w.jsx(Df,{children:w.jsx(cp,{})}),w.jsx(Nf,{children:w.jsx(X9,{})})]}),w.jsxs("main",{className:Vg.main,children:[w.jsx(cp,{className:Vg.logo}),w.jsx(ml,{size:"lg",weight:"semibold",children:l("start_new_call")}),w.jsxs(OR,{className:z0.form,onSubmit:h,children:[w.jsxs(St,{className:z0.fieldRow,children:[w.jsx(Sn,{id:"callName",name:"callName",label:l("call_name"),placeholder:l("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"}),w.jsx(Ft,{type:"submit",size:"lg",className:z0.button,disabled:n,"data-testid":"home_go",children:l(n?"common.loading":"action.go")})]}),null===s&&w.jsx(on,{size:"sm",className:z0.notice,children:w.jsx(Ole,{})}),i&&w.jsx(St,{className:z0.fieldRow,children:w.jsx(jf,{error:i})})]}),p.length>0&&w.jsx(hXe,{rooms:p,client:e})]})]}),w.jsx(ffe,{onJoin:v,open:c,onDismiss:d})]})};function q_(e){_.useEffect(()=>{const t="Element Call";document.title=e?`${t} | ${e}`:t},[e])}const pfe=()=>{const{t:e}=Je();q_(e("common.home"));const t=Zv();return t?"error"===t.state?w.jsx($b,{widget:Qe,error:t.error}):t.authenticated?w.jsx(mXe,{client:t.authenticated.client}):w.jsx(JYe,{}):w.jsx(eR,{})},gXe=(e,t)=>_.createElement("svg",{width:300,height:66,viewBox:"0 0 300 66",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("circle",{cx:32.6901,cy:32.6904,r:23.496,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.6137 65.2274C50.6257 65.2274 65.2274 50.6257 65.2274 32.6137C65.2274 14.6016 50.6257 0 32.6137 0C14.6016 0 0 14.6016 0 32.6137C0 50.6257 14.6016 65.2274 32.6137 65.2274ZM26.6511 15.1961C26.6511 13.8796 27.7205 12.8124 29.0397 12.8124C37.9808 12.8124 45.2291 20.0456 45.2291 28.9681C45.2291 30.2846 44.1596 31.3518 42.8405 31.3518C41.5213 31.3518 40.4519 30.2846 40.4519 28.9681C40.4519 22.6785 35.3425 17.5797 29.0397 17.5797C27.7205 17.5797 26.6511 16.5125 26.6511 15.1961ZM52.4139 28.9683C52.4139 27.6518 51.3445 26.5846 50.0253 26.5846C48.7061 26.5846 47.6367 27.6518 47.6367 28.9683C47.6367 35.2579 42.5274 40.3567 36.2246 40.3567C34.9054 40.3567 33.836 41.4239 33.836 42.7404C33.836 44.0568 34.9054 45.124 36.2246 45.124C45.1657 45.124 52.4139 37.8909 52.4139 28.9683ZM38.6134 50.031C38.6134 51.3475 37.544 52.4146 36.2248 52.4146C27.2837 52.4146 20.0355 45.1815 20.0355 36.2589C20.0355 34.9425 21.1049 33.8753 22.4241 33.8753C23.7432 33.8753 24.8127 34.9425 24.8127 36.2589C24.8127 42.5486 29.922 47.6474 36.2248 47.6474C37.544 47.6474 38.6134 48.7146 38.6134 50.031ZM12.8113 36.2589C12.8113 37.5754 13.8808 38.6426 15.1999 38.6426C16.5191 38.6426 17.5885 37.5754 17.5885 36.2589C17.5885 29.9693 22.6979 24.8705 29.0007 24.8705C30.3198 24.8705 31.3893 23.8033 31.3893 22.4869C31.3893 21.1704 30.3198 20.1032 29.0007 20.1032C20.0595 20.1032 12.8113 27.3364 12.8113 36.2589Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M114.73 36.9816H91.7256C91.9974 39.3888 92.871 41.3107 94.3464 42.7472C95.8217 44.1449 97.763 44.8438 100.17 44.8438C101.762 44.8438 103.199 44.4555 104.48 43.679C105.761 42.9025 106.674 41.8542 107.217 40.5341H114.206C113.274 43.6014 111.527 46.0862 108.964 47.9887C106.441 49.8523 103.451 50.7842 99.9955 50.7842C95.4917 50.7842 91.8421 49.2894 89.0466 46.2998C86.29 43.3102 84.9117 39.5247 84.9117 34.9432C84.9117 30.4783 86.3094 26.7316 89.1049 23.7032C91.9003 20.6747 95.5111 19.1605 99.9373 19.1605C104.363 19.1605 107.935 20.6553 110.653 23.6449C113.41 26.5957 114.788 30.323 114.788 34.8267L114.73 36.9816ZM99.9373 24.8097C97.763 24.8097 95.9576 25.4503 94.5211 26.7316C93.0845 28.0128 92.1915 29.7212 91.8421 31.8566H107.916C107.605 29.7212 106.751 28.0128 105.353 26.7316C103.956 25.4503 102.15 24.8097 99.9373 24.8097Z",fill:"white"}),_.createElement("path",{d:"M119.557 41.0583V6.40625H126.488V41.1748C126.488 42.7278 127.342 43.5043 129.05 43.5043L130.273 43.4461V50.0271C129.613 50.1435 128.914 50.2018 128.177 50.2018C125.187 50.2018 122.993 49.4447 121.596 47.9305C120.237 46.4163 119.557 44.1255 119.557 41.0583Z",fill:"white"}),_.createElement("path",{d:"M162.549 36.9816H139.545C139.817 39.3888 140.69 41.3107 142.166 42.7472C143.641 44.1449 145.582 44.8438 147.99 44.8438C149.582 44.8438 151.018 44.4555 152.299 43.679C153.581 42.9025 154.493 41.8542 155.037 40.5341H162.025C161.093 43.6014 159.346 46.0862 156.784 47.9887C154.26 49.8523 151.27 50.7842 147.815 50.7842C143.311 50.7842 139.662 49.2894 136.866 46.2998C134.109 43.3102 132.731 39.5247 132.731 34.9432C132.731 30.4783 134.129 26.7316 136.924 23.7032C139.72 20.6747 143.331 19.1605 147.757 19.1605C152.183 19.1605 155.755 20.6553 158.473 23.6449C161.229 26.5957 162.608 30.323 162.608 34.8267L162.549 36.9816ZM147.757 24.8097C145.582 24.8097 143.777 25.4503 142.341 26.7316C140.904 28.0128 140.011 29.7212 139.662 31.8566H155.735C155.425 29.7212 154.571 28.0128 153.173 26.7316C151.775 25.4503 149.97 24.8097 147.757 24.8097Z",fill:"white"}),_.createElement("path",{d:"M193.817 32.7302V50.0853H186.887V31.973C186.887 27.3916 184.984 25.1009 181.179 25.1009C179.122 25.1009 177.471 25.7609 176.229 27.081C175.025 28.4011 174.424 30.2065 174.424 32.4972V50.0853H167.493V19.8594H173.9V23.8779C174.637 22.519 175.763 21.393 177.277 20.5C178.792 19.607 180.675 19.1605 182.927 19.1605C187.12 19.1605 190.148 20.7524 192.012 23.9361C194.574 20.7524 197.991 19.1605 202.262 19.1605C205.795 19.1605 208.513 20.2671 210.415 22.4801C212.318 24.6544 213.269 27.5275 213.269 31.0995V50.0853H206.338V31.973C206.338 27.3916 204.436 25.1009 200.631 25.1009C198.535 25.1009 196.865 25.7803 195.623 27.1392C194.419 28.4593 193.817 30.323 193.817 32.7302Z",fill:"white"}),_.createElement("path",{d:"M247.735 36.9816H224.731C225.002 39.3888 225.876 41.3107 227.351 42.7472C228.827 44.1449 230.768 44.8438 233.175 44.8438C234.767 44.8438 236.204 44.4555 237.485 43.679C238.766 42.9025 239.678 41.8542 240.222 40.5341H247.211C246.279 43.6014 244.532 46.0862 241.969 47.9887C239.446 49.8523 236.456 50.7842 233 50.7842C228.497 50.7842 224.847 49.2894 222.052 46.2998C219.295 43.3102 217.917 39.5247 217.917 34.9432C217.917 30.4783 219.314 26.7316 222.11 23.7032C224.905 20.6747 228.516 19.1605 232.942 19.1605C237.368 19.1605 240.94 20.6553 243.658 23.6449C246.415 26.5957 247.793 30.323 247.793 34.8267L247.735 36.9816ZM232.942 24.8097C230.768 24.8097 228.963 25.4503 227.526 26.7316C226.089 28.0128 225.196 29.7212 224.847 31.8566H240.921C240.61 29.7212 239.756 28.0128 238.358 26.7316C236.961 25.4503 235.155 24.8097 232.942 24.8097Z",fill:"white"}),_.createElement("path",{d:"M259.085 19.8594V23.8779C259.784 22.5578 260.929 21.4513 262.521 20.5583C264.152 19.6264 266.113 19.1605 268.403 19.1605C271.975 19.1605 274.732 20.2477 276.673 22.4219C278.653 24.5961 279.643 27.4887 279.643 31.0995V50.0853H272.713V31.973C272.713 29.8376 272.208 28.1681 271.199 26.9645C270.228 25.7221 268.733 25.1009 266.714 25.1009C264.501 25.1009 262.754 25.7609 261.473 27.081C260.23 28.4011 259.609 30.2259 259.609 32.5554V50.0853H252.679V19.8594H259.085Z",fill:"white"}),_.createElement("path",{d:"M299.884 43.912V49.9106C299.029 50.1435 297.826 50.26 296.273 50.26C290.371 50.26 287.42 47.2898 287.42 41.3495V25.3921H282.82V19.8594H287.42V11.9972H294.351V19.8594H300V25.3921H294.351V40.6506C294.351 43.019 295.477 44.2032 297.729 44.2032L299.884 43.912Z",fill:"white"})),mfe=_.forwardRef(gXe),vXe="_logo_1gx2r_8",yXe="_container_1gx2r_14",bXe="_content_1gx2r_22",_Xe="_formContainer_1gx2r_30",SXe="_authLinks_1gx2r_62",Gc={logo:vXe,container:yXe,content:bXe,formContainer:_Xe,authLinks:SXe};function EXe(e){return _.useCallback(async(t,n,r)=>{const i=Y3({baseUrl:t}),o=new eO({matrixClient:i,doRequest:async()=>i.login("m.login.password",{identifier:{type:"m.id.user",user:n},password:r}),stateUpdated:()=>{},requestEmailToken:async()=>Promise.resolve({sid:""})}),{user_id:s,access_token:a,device_id:l}=await o.attemptAuth(),c={user_id:s,access_token:a,device_id:l,passwordlessUser:!1};return await(null==e?void 0:e.logout(!0)),[await cfe({baseUrl:t,accessToken:a,userId:s,deviceId:l},!1),c]},[e])}const wXe=()=>{var e,t;const{t:n}=Je();q_(n("login_title"));const{client:r,setClient:i}=Pp(),o=EXe(r),s=Zt.defaultHomeserverUrl(),a=_.useRef(null),l=_.useRef(null),c=fl(),u=ts(),[d,h]=_.useState(!1),[p,f]=_.useState(),m=_.useCallback(e=>{if(e.preventDefault(),h(!0),!s||!a.current||!l.current)return f(Error("Login parameters are undefined")),void h(!1);o(s,a.current.value,l.current.value).then(async([e,t])=>{if(!i)return;i(e,t);const n=u.state;n&&n.from?await c(n.from):await c("/"),Dt.instance.eventLogin.track()}).catch(e=>{f(e),h(!1)})},[o,u,c,s,i]);let v=null==(e=Zt.defaultServerName())?void 0:e.slice(0,25);return v=(null==v?void 0:v.length)!==(null==(t=Zt.defaultServerName())?void 0:t.length)?v+"...":v,w.jsx(w.Fragment,{children:w.jsx("div",{className:Gc.container,children:w.jsxs("div",{className:Gc.content,children:[w.jsxs("div",{className:Gc.formContainer,children:[w.jsx(mfe,{width:"auto",height:"auto",className:Gc.logo}),w.jsx("h2",{children:n("log_in")}),w.jsx("h4",{children:n("login_subheading")}),w.jsxs("form",{onSubmit:m,children:[w.jsx(St,{children:w.jsx(Sn,{type:"text",ref:a,placeholder:n("common.username"),label:n("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${v}`,"data-testid":"login_username"})}),w.jsx(St,{children:w.jsx(Sn,{type:"password",ref:l,placeholder:n("common.password"),label:n("common.password"),"data-testid":"login_password"})}),p&&w.jsx(St,{children:w.jsx(jf,{error:p})}),w.jsx(St,{children:w.jsx(Ft,{type:"submit",disabled:d,"data-testid":"login_login",children:n(d?"logging_in":"login_title")})})]})]}),w.jsxs("div",{className:Gc.authLinks,children:[w.jsx("p",{children:n("login_auth_links_prompt")}),w.jsx("p",{children:w.jsxs(Vs,{i18nKey:"login_auth_links",children:[w.jsx(il,{to:"/register",children:"Create an account"})," Or ",w.jsx(il,{to:"/",children:"Access as a guest"})]})})]})]})})})},CXe=()=>{const{t:e}=Je();q_(e("action.register"));const{loading:t,authenticated:n,passwordlessUser:r,client:i,setClient:o}=O8(),s=_.useRef(null),a=fl(),l=ts(),[c,u]=_.useState(!1),[d,h]=_.useState(),[p,f]=_.useState(""),[m,v]=_.useState(""),{recaptchaKey:g,register:y}=J9(i),{execute:b,reset:S,recaptchaId:E}=Q9(g),C=_.useCallback(e=>{e.preventDefault();const t=new FormData(e.target),n=t.get("userName"),s=t.get("password"),c=t.get("passwordConfirmation");s===c&&(async()=>{u(!0);const e=await b(),[t,a]=await y(n,s,n,e,r);if(i&&null!=i&&i.groupCallEventHandler&&r)for(const e of i.groupCallEventHandler.groupCalls.values()){const n=e.room.roomId;try{await t.joinRoom(n)}catch(e){"M_LIMIT_EXCEEDED"===e.errcode?(await mp(e.data.retry_after_ms),await t.joinRoom(n)):(hT(e),M.error(`Couldn't join room ${n}`,e))}}null==o||o(t,a),Dt.instance.eventSignup.cacheSignupEnd(new Date)})().then(async()=>{var e,t;null!=(e=l.state)&&e.from?await a(null==(t=l.state)?void 0:t.from):await a("/")}).catch(e=>{h(e),u(!1),S()})},[y,l,a,r,S,b,i,o]);return _.useEffect(()=>{var t,n;p&&m&&p!==m?null==(t=s.current)||t.setCustomValidity(e("register.passwords_must_match")):null==(n=s.current)||n.setCustomValidity("")},[p,m,e]),_.useEffect(()=>{var e;!t&&n&&!r&&!c&&(null==(e=a("/"))||e.catch(e=>{M.error("Failed to navigate to /",e)}))},[t,a,n,r,c]),t?w.jsx(eR,{}):(Dt.instance.eventSignup.cacheSignupStart(new Date),w.jsx(w.Fragment,{children:w.jsx("div",{className:Gc.container,children:w.jsxs("div",{className:Gc.content,children:[w.jsxs("div",{className:Gc.formContainer,children:[w.jsx(mfe,{width:"auto",height:"auto",className:Gc.logo}),w.jsx("h2",{children:e("register_heading")}),w.jsxs("form",{onSubmit:C,children:[w.jsx(St,{children:w.jsx(Sn,{type:"text",name:"userName",placeholder:e("common.username"),label:e("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${Zt.defaultServerName()}`,"data-testid":"register_username"})}),w.jsx(St,{children:w.jsx(Sn,{required:!0,name:"password",type:"password",onChange:e=>f(e.target.value),value:p,placeholder:e("common.password"),label:e("common.password"),"data-testid":"register_password"})}),w.jsx(St,{children:w.jsx(Sn,{required:!0,type:"password",name:"passwordConfirmation",onChange:e=>v(e.target.value),value:m,placeholder:e("register_confirm_password_label"),label:e("register_confirm_password_label"),ref:s,"data-testid":"register_confirm_password"})}),w.jsx(on,{size:"sm",children:w.jsxs(Vs,{i18nKey:"recaptcha_ssla_caption",children:["This site is protected by ReCAPTCHA and the Google"," ",w.jsx(zh,{href:"https://www.google.com/policies/privacy/",children:"Privacy Policy"})," ","and"," ",w.jsx(zh,{href:"https://policies.google.com/terms",children:"Terms of Service"})," ","apply.",w.jsx("br",{}),'By clicking "Register", you agree to our'," ",w.jsx(zh,{href:Zt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),d&&w.jsx(St,{children:w.jsx(jf,{error:d})}),w.jsx(St,{children:w.jsx(Ft,{type:"submit",disabled:c,"data-testid":"register_register",children:e(c?"register.registering":"action.register")})}),w.jsx("div",{id:E})]})]}),w.jsx("div",{className:Gc.authLinks,children:w.jsxs(Vs,{i18nKey:"register_auth_links",children:[w.jsx("p",{children:"Already have an account?"}),w.jsxs("p",{children:[w.jsx(il,{to:"/login",children:"Log in"})," Or ",w.jsx(il,{to:"/",children:"Access as a guest"})]})]})})]})})}))},TXe="_form_1wfyo_8",RXe="_headline_1wfyo_18",IXe="_container_1wfyo_37",kXe="_main_1wfyo_45",xXe="_footer_1wfyo_62",W0={form:TXe,headline:RXe,container:IXe,main:kXe,footer:xXe};function gfe(){const{setClient:e}=Pp(),{privacyPolicyUrl:t,recaptchaKey:n,register:r}=J9(),{execute:i,reset:o,recaptchaId:s}=Q9(n);return{privacyPolicyUrl:t,registerPasswordlessUser:_.useCallback(async t=>{if(!e)throw new Error("No client context");if(Qe)throw new Error("Registration was skipped: We should never try to register password-less user in embedded mode.");try{const n=await i(),o=hfe(),[s,a]=await r(o,Eo(16),t,n,!0);e(s,a)}catch(e){throw o(),e}},[i,o,r,e]),recaptchaId:s}}const AXe=()=>{const{header:e}=Xs(),[t,n]=_.useState(!1),[r,i]=_.useState(),{registerPasswordlessUser:o,recaptchaId:s}=gfe(),a=_.useCallback(e=>{e.preventDefault(),n(!0);const t=new FormData(e.target).get("displayName");o("string"==typeof t?t:"").catch(t=>{M.error("Failed to register passwordless user",e),n(!1),i(t)})},[o]),{t:l}=Je(),c=ts();return w.jsxs(w.Fragment,{children:["standard"===e&&w.jsxs(Bu,{children:[w.jsx(Df,{children:w.jsx(cp,{})}),w.jsx(Nf,{children:w.jsx(X9,{preventNavigation:!0})})]}),w.jsxs("div",{className:W0.container,children:[w.jsxs("main",{className:W0.main,children:[w.jsx(ml,{size:"xl",weight:"semibold",className:W0.headline,children:l("lobby.join_as_guest")}),w.jsxs(OR,{className:W0.form,onSubmit:a,children:[w.jsx(St,{children:w.jsx(Sn,{id:"displayName",name:"displayName",label:l("common.display_name"),placeholder:l("common.display_name"),"data-testid":"joincall_displayName",type:"text",required:!0,autoComplete:"off"})}),w.jsx(on,{size:"sm",children:w.jsxs(Vs,{i18nKey:"room_auth_view_ssla_caption",children:['By clicking "Join call now", you agree to our'," ",w.jsx(zh,{href:Zt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),r&&w.jsx(St,{children:w.jsx(jf,{error:r})}),w.jsx(Ft,{type:"submit",size:"lg",disabled:t,"data-testid":"joincall_joincall",children:l(t?"common.loading":"room_auth_view_continue_button")}),w.jsx("div",{id:s})]})]}),w.jsx(on,{className:W0.footer,children:w.jsxs(Vs,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",w.jsx(il,{to:"/register",state:{from:c},children:"Create an account"})]})})]})]})};var yE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vfe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var yW,oP={exports:{}},LXe=oP.exports;function PXe(){return yW||(yW=1,t=LXe,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return c??a??s},d.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=f(o.getLevel())),l.call(d),o===d)for(var e in i)i[e].rebuild()},s=f(o?o.getLevel():"WARN");var m=p();null!=m&&(c=f(m)),l.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},(e=oP).exports?e.exports=n():t.log=n()),oP.exports;var e,t,n}var OXe=PXe();const MXe=vfe(OXe);var aP=function(e,t){return(aP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function zu(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}aP(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function DXe(e,t,n,r){return new(n||(n=Promise))(function(t,i){function o(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?t(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,s)}a((r=r.apply(e,[])).next())})}function yfe(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function kv(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y3(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function b3(e,t,n){if(2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function qg(e){return this instanceof qg?(this.v=e,this):new qg(e)}function NXe(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{!function(e){e.value instanceof qg?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(i[e](t))}catch(e){u(o[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function UXe(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof kv?kv(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,i,(t=e[n](t)).done,t.value)})}}}function ti(e){return"function"==typeof e}function Z9(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var $x=Z9(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function _3(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var G_=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=kv(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(ti(l))try{l()}catch(e){i=e instanceof $x?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=kv(c),d=u.next();!d.done;d=u.next()){var h=d.value;try{bW(h)}catch(e){i=i??[],e instanceof $x?i=b3(b3([],y3(i)),y3(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new $x(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)bW(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&_3(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&_3(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),bfe=G_.EMPTY;function _fe(e){return e instanceof G_||e&&"closed"in e&&ti(e.remove)&&ti(e.add)&&ti(e.unsubscribe)}function bW(e){ti(e)?e():e.unsubscribe()}var jXe={Promise:void 0},FXe={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,b3([e,t],y3(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function Sfe(e){FXe.setTimeout(function(){throw e})}function _W(){}function Uw(e){e()}var eD=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,_fe(t)&&t.add(n)):n.destination=HXe,n}return zu(t,e),t.create=function(e,t,n){return new cP(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(G_),$Xe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){bE(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){bE(e)}else bE(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){bE(e)}},e}(),cP=function(e){function t(t,n,r){var i,o=e.call(this)||this;return i=ti(t)||!t?{next:t??void 0,error:n??void 0,complete:r??void 0}:t,o.destination=new $Xe(i),o}return zu(t,e),t}(eD);function bE(e){Sfe(e)}function BXe(e){throw e}var HXe={closed:!0,next:_W,error:BXe,complete:_W},tD="function"==typeof Symbol&&Symbol.observable||"@@observable";function Efe(e){return e}function VXe(e){return 0===e.length?Efe:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}var ko=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=GXe(e)?e:new cP(e,t,n);return Uw(function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))}),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=SW(t))(function(t,r){var i=new cP({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[tD]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return VXe(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=SW(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function SW(e){var t;return null!==(t=e??jXe.Promise)&&void 0!==t?t:Promise}function qXe(e){return e&&ti(e.next)&&ti(e.error)&&ti(e.complete)}function GXe(e){return e&&e instanceof eD||qXe(e)&&_fe(e)}function KXe(e){return ti(null==e?void 0:e.lift)}function K_(e){return function(t){if(KXe(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw new TypeError("Unable to lift unknown Observable type")}}function S3(e,t,n,r,i){return new zXe(e,t,n,r,i)}var zXe=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return zu(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(eD),WXe=Z9(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),wfe=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return zu(t,e),t.prototype.lift=function(e){var t=new EW(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new WXe},t.prototype.next=function(e){var t=this;Uw(function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=kv(t.currentObservers),o=i.next();!o.done;o=i.next()){o.value.next(e)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;Uw(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;Uw(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?bfe:(this.currentObservers=null,o.push(e),new G_(function(){t.currentObservers=null,_3(o,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new ko;return e.source=this,e},t.create=function(e,t){return new EW(e,t)},t}(ko),EW=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return zu(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:bfe},t}(wfe);!function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}zu(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)}}(wfe);var YXe={now:function(){return Date.now()}},XXe=function(e){function t(t,n){return e.call(this)||this}return zu(t,e),t.prototype.schedule=function(e,t){return this},t}(G_),wW={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,b3([e,t],y3(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},JXe=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return zu(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),wW.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&wW.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,_3(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(XXe),CW=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=YXe.now,e}(),QXe=function(e){function t(t,n){void 0===n&&(n=CW.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return zu(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(CW);function ZXe(e){return e&&ti(e.schedule)}function eJe(e){return e[e.length-1]}function Cfe(e){return ZXe(eJe(e))?e.pop():void 0}new QXe(JXe);var Tfe=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Rfe(e){return ti(null==e?void 0:e.then)}function Ife(e){return ti(e[tD])}function kfe(e){return Symbol.asyncIterator&&ti(null==e?void 0:e[Symbol.asyncIterator])}function xfe(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function tJe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var Afe=tJe();function Lfe(e){return ti(null==e?void 0:e[Afe])}function Pfe(e){return NXe(this,arguments,function(){var t,n,r;return yfe(this,function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,qg(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,qg(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,qg(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Ofe(e){return ti(null==e?void 0:e.getReader)}function z_(e){if(e instanceof ko)return e;if(null!=e){if(Ife(e))return nJe(e);if(Tfe(e))return rJe(e);if(Rfe(e))return iJe(e);if(kfe(e))return Mfe(e);if(Lfe(e))return sJe(e);if(Ofe(e))return oJe(e)}throw xfe(e)}function nJe(e){return new ko(function(t){var n=e[tD]();if(ti(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function rJe(e){return new ko(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function iJe(e){return new ko(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,Sfe)})}function sJe(e){return new ko(function(t){var n,r;try{for(var i=kv(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()})}function Mfe(e){return new ko(function(t){aJe(e,t).catch(function(e){return t.error(e)})})}function oJe(e){return Mfe(Pfe(e))}function aJe(e,t){var n,r,i,o;return DXe(this,void 0,void 0,function(){var s,a;return yfe(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=UXe(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Yh(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function Dfe(e,t){return void 0===t&&(t=0),K_(function(n,r){n.subscribe(S3(r,function(n){return Yh(r,e,function(){return r.next(n)},t)},function(){return Yh(r,e,function(){return r.complete()},t)},function(n){return Yh(r,e,function(){return r.error(n)},t)}))})}function Nfe(e,t){return void 0===t&&(t=0),K_(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function cJe(e,t){return z_(e).pipe(Nfe(t),Dfe(t))}function lJe(e,t){return z_(e).pipe(Nfe(t),Dfe(t))}function uJe(e,t){return new ko(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function dJe(e,t){return new ko(function(n){var r;return Yh(n,t,function(){r=e[Afe](),Yh(n,t,function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)},0,!0)}),function(){return ti(null==r?void 0:r.return)&&r.return()}})}function Ufe(e,t){if(!e)throw new Error("Iterable cannot be null");return new ko(function(n){Yh(n,t,function(){var r=e[Symbol.asyncIterator]();Yh(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function fJe(e,t){return Ufe(Pfe(e),t)}function hJe(e,t){if(null!=e){if(Ife(e))return cJe(e,t);if(Tfe(e))return uJe(e,t);if(Rfe(e))return lJe(e,t);if(kfe(e))return Ufe(e,t);if(Lfe(e))return dJe(e,t);if(Ofe(e))return fJe(e,t)}throw xfe(e)}function pJe(e,t){return t?hJe(e,t):z_(e)}function MR(e,t){return K_(function(n,r){var i=0;n.subscribe(S3(r,function(n){r.next(e.call(t,n,i++))}))})}function mJe(e,t,n,r,i,o,s,a){var l=[],c=0,u=0,d=!1,h=function(){d&&!l.length&&!c&&t.complete()},p=function(e){c++;var i=!1;z_(n(e,u++)).subscribe(S3(t,function(e){t.next(e)},function(){i=!0},void 0,function(){if(i)try{c--;for(var e=function(){var e=l.shift();s||p(e)};l.length&&c<r;)e();h()}catch(e){t.error(e)}}))};return e.subscribe(S3(t,function(e){return c<r?p(e):l.push(e)},function(){d=!0,h()})),function(){}}function jfe(e,t,n){return void 0===n&&(n=1/0),ti(t)?jfe(function(n,r){return MR(function(e,i){return t(n,e,r,i)})(z_(e(n,r)))},n):("number"==typeof t&&(n=t),K_(function(t,r){return mJe(t,r,e,n)}))}function gJe(e){return jfe(Efe,e)}function vJe(){return gJe(1)}function TW(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vJe()(pJe(e,Cfe(e)))}function DR(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Cfe(e);return K_(function(t,r){(n?TW(e,t,n):TW(e,t)).subscribe(r)})}Z9(function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});var yJe="lk";function Ffe(e){return!(typeof e>"u")&&(bJe(e)||_Je(e))}function bJe(e){var t;return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&typeof(null==(t=e.publication)?void 0:t.track)<"u")}function _Je(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&typeof e.publication<"u")}var SJe=[ue.ConnectionStateChanged,ue.RoomMetadataChanged,ue.ActiveSpeakersChanged,ue.ConnectionQualityChanged,ue.ParticipantConnected,ue.ParticipantDisconnected,ue.ParticipantPermissionsChanged,ue.ParticipantMetadataChanged,ue.ParticipantNameChanged,ue.ParticipantAttributesChanged,ue.TrackMuted,ue.TrackUnmuted,ue.TrackPublished,ue.TrackUnpublished,ue.TrackStreamStateChanged,ue.TrackSubscriptionFailed,ue.TrackSubscriptionPermissionChanged,ue.TrackSubscriptionStatusChanged],EJe=[...SJe,ue.LocalTrackPublished,ue.LocalTrackUnpublished];ae.TrackPublished,ae.TrackUnpublished,ae.TrackMuted,ae.TrackUnmuted,ae.TrackStreamStateChanged,ae.TrackSubscribed,ae.TrackUnsubscribed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionFailed,ae.LocalTrackPublished,ae.LocalTrackUnpublished;var wJe=[ae.ConnectionQualityChanged,ae.IsSpeakingChanged,ae.ParticipantMetadataChanged,ae.ParticipantPermissionsChanged,ae.TrackMuted,ae.TrackUnmuted,ae.TrackPublished,ae.TrackUnpublished,ae.TrackStreamStateChanged,ae.TrackSubscriptionFailed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionStatusChanged];ae.LocalTrackPublished,ae.LocalTrackUnpublished;var kf=MXe.getLogger("lk-components-js");function $fe(e){return"object"==typeof e}function Bfe(e){return Array.isArray(e)&&e.filter($fe).length>0}function CJe(e){return`${yJe}-${e}`}function TJe(e){const t=lP(e),n=Hfe(e.participant).pipe(MR(()=>lP(e)),DR(t));return{className:CJe(e.source===he.Source.Camera||e.source===he.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function lP(e){if(Ffe(e))return e.publication;{const{source:t,name:n,participant:r}=e;if(t&&n)return r.getTrackPublications().find(e=>e.source===t&&e.trackName===n);if(n)return r.getTrackPublicationByName(n);if(t)return r.getTrackPublication(t);throw new Error("At least one of source and name needs to be defined")}}function RJe(e,...t){return new ko(n=>{const r=()=>{n.next(e)};return t.forEach(t=>{e.on(t,r)}),()=>{t.forEach(t=>{e.off(t,r)})}}).pipe(DR(e))}function IJe(e,...t){return new ko(n=>{const r=()=>{n.next(e)};return t.forEach(t=>{e.on(t,r)}),()=>{t.forEach(t=>{e.off(t,r)})}}).pipe(DR(e))}function Hfe(e){return IJe(e,ae.TrackMuted,ae.TrackUnmuted,ae.ParticipantPermissionsChanged,ae.TrackPublished,ae.TrackUnpublished,ae.LocalTrackPublished,ae.LocalTrackUnpublished,ae.MediaDevicesError,ae.TrackSubscriptionStatusChanged).pipe(MR(e=>{const{isMicrophoneEnabled:t,isCameraEnabled:n,isScreenShareEnabled:r}=e,i=e.getTrackPublication(he.Source.Microphone);return{isCameraEnabled:n,isMicrophoneEnabled:t,isScreenShareEnabled:r,cameraTrack:e.getTrackPublication(he.Source.Camera),microphoneTrack:i,participant:e}}))}function RW(e,t,n=!0){const r=[e.localParticipant,...Array.from(e.remoteParticipants.values())],i=[];return r.forEach(e=>{t.forEach(t=>{const r=Array.from(e.trackPublications.values()).filter(e=>e.source===t&&(!n||e.track)).map(t=>({participant:e,publication:t,source:t.source}));i.push(...r)})}),{trackReferences:i,participants:r}}function kJe(e,t,n){var r,i;const o=null!=(r=n.additionalRoomEvents)?r:EJe,s=null==(i=n.onlySubscribed)||i;return RJe(e,...Array.from(new Set([ue.ParticipantConnected,ue.ParticipantDisconnected,ue.ConnectionStateChanged,ue.LocalTrackPublished,ue.LocalTrackUnpublished,ue.TrackPublished,ue.TrackUnpublished,ue.TrackSubscriptionStatusChanged,...o]).values())).pipe(MR(e=>{const n=RW(e,t,s);return kf.debug(`TrackReference[] was updated. (length ${n.trackReferences.length})`,n),n}),DR(RW(e,t,s)))}kf.setDefaultLevel("WARN"),_.createContext(void 0);const xJe=_.createContext(void 0);function AJe(){return _.useContext(xJe)}function Vfe(e){const t=AJe(),n=e??t;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}_.createContext(void 0);const qfe=_.createContext(void 0);function LJe(){return _.useContext(qfe)}function Gfe(e){const t=LJe(),n=e??t;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}function Kfe(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=Kfe(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function PJe(){for(var e,t,n=0,r="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=Kfe(e))&&(r&&(r+=" "),r+=t);return r}function OJe(...e){return(...t)=>{for(const n of e)if("function"==typeof n)try{n(...t)}catch(e){console.error(e)}}}function MJe(...e){const t={...e[0]};for(let n=1;n<e.length;n++){const r=e[n];for(const e in r){const n=t[e],i=r[e];"function"==typeof n&&"function"==typeof i&&"o"===e[0]&&"n"===e[1]&&e.charCodeAt(2)>=65&&e.charCodeAt(2)<=90?t[e]=OJe(n,i):t[e]="className"!==e&&"UNSAFE_className"!==e||"string"!=typeof n||"string"!=typeof i?void 0!==i?i:n:PJe(n,i)}}return t}function DJe(e){return void 0!==e}function NJe(...e){return MJe(...e.filter(DJe))}function UJe(e,t){return"processor"===e&&t&&"object"==typeof t&&"name"in t?t.name:"e2ee"===e&&t?"e2ee-enabled":t}function jJe(e={}){const t=Gfe(e.room),[n,r]=_.useState(t.localParticipant),[i,o]=_.useState(n.isMicrophoneEnabled),[s,a]=_.useState(n.isCameraEnabled),[l,c]=_.useState(n.isScreenShareEnabled),[u,d]=_.useState(n.lastMicrophoneError),[h,p]=_.useState(n.lastCameraError),[f,m]=_.useState(void 0),[v,g]=_.useState(void 0),y=e=>{a(e.isCameraEnabled),o(e.isMicrophoneEnabled),c(e.isScreenShareEnabled),g(e.cameraTrack),m(e.microphoneTrack),d(e.participant.lastMicrophoneError),p(e.participant.lastCameraError),r(e.participant)};return _.useEffect(()=>{const e=Hfe(t.localParticipant).subscribe(y);return()=>e.unsubscribe()},[t]),{isMicrophoneEnabled:i,isScreenShareEnabled:l,isCameraEnabled:s,microphoneTrack:f,cameraTrack:v,lastMicrophoneError:u,lastCameraError:h,localParticipant:n}}function FJe(e=[he.Source.Camera,he.Source.Microphone,he.Source.ScreenShare,he.Source.ScreenShareAudio,he.Source.Unknown],t={}){const n=Gfe(t.room),[r,i]=_.useState([]),[o,s]=_.useState([]),a=_.useMemo(()=>e.map(e=>$fe(e)?e.source:e),[JSON.stringify(e)]);return _.useEffect(()=>{const e=kJe(n,a,{additionalRoomEvents:t.updateOnlyOn,onlySubscribed:t.onlySubscribed}).subscribe(({trackReferences:e,participants:t})=>{kf.debug("setting track bundles",e,t),i(e),s(t)});return()=>e.unsubscribe()},[n,JSON.stringify(t.onlySubscribed),JSON.stringify(t.updateOnlyOn),JSON.stringify(e)]),_.useMemo(()=>{if(Bfe(e)){const t=BJe(e,o),n=Array.from(r);return o.forEach(e=>{t.has(e.identity)&&(t.get(e.identity)??[]).forEach(t=>{if(r.find(({participant:n,publication:r})=>e.identity===n.identity&&r.source===t))return;kf.debug(`Add ${t} placeholder for participant ${e.identity}.`);const i={participant:e,source:t};n.push(i)})}),n}return r},[r,o,e])}function $Je(e,t){const n=new Set(e);for(const e of t)n.delete(e);return n}function BJe(e,t){const n=new Map;if(Bfe(e)){const r=e.filter(e=>e.withPlaceholder).map(e=>e.source);t.forEach(e=>{const t=e.getTrackPublications().map(e=>{var t;return null==(t=e.track)?void 0:t.source}).filter(e=>void 0!==e),i=Array.from($Je(new Set(r),new Set(t)));i.length>0&&n.set(e.identity,i)})}return n}function zfe(e,t={}){const[n,r]=_.useState(lP(e)),[i,o]=_.useState(null==n?void 0:n.isMuted),[s,a]=_.useState(null==n?void 0:n.isSubscribed),[l,c]=_.useState(null==n?void 0:n.track),[u,d]=_.useState("landscape"),h=_.useRef(),{className:p,trackObserver:f}=_.useMemo(()=>TJe(e),[e.participant.sid??e.participant.identity,e.source,Ffe(e)&&e.publication.trackSid]);return _.useEffect(()=>{const e=f.subscribe(e=>{kf.debug("update track",e),r(e),o(null==e?void 0:e.isMuted),a(null==e?void 0:e.isSubscribed),c(null==e?void 0:e.track)});return()=>null==e?void 0:e.unsubscribe()},[f]),_.useEffect(()=>{var n,r;return l&&(h.current&&l.detach(h.current),null!=(n=t.element)&&n.current&&!(e.participant.isLocal&&"audio"===(null==l?void 0:l.kind))&&l.attach(t.element.current)),h.current=null==(r=t.element)?void 0:r.current,()=>{h.current&&(null==l||l.detach(h.current))}},[l,t.element]),_.useEffect(()=>{var e,t;if("number"==typeof(null==(e=null==n?void 0:n.dimensions)?void 0:e.width)&&"number"==typeof(null==(t=null==n?void 0:n.dimensions)?void 0:t.height)){const e=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(e)}},[n]),{publication:n,isMuted:i,isSubscribed:s,track:l,elementProps:NJe(t.props,{className:p,"data-lk-local-participant":e.participant.isLocal,"data-lk-source":null==n?void 0:n.source,..."video"===(null==n?void 0:n.kind)&&{"data-lk-orientation":u}})}}var Bx,IW;function HJe(){if(IW)return Bx;IW=1;var e=/^\s+|\s+$/g,t=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,r=/^0o[0-7]+$/i,i=parseInt,o="object"==typeof yE&&yE&&yE.Object===Object&&yE,s="object"==typeof self&&self&&self.Object===Object&&self,a=o||s||Function("return this")(),l=Object.prototype.toString,c=Math.max,u=Math.min,d=function(){return a.Date.now()};function h(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(o){if("number"==typeof o)return o;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==l.call(e)}(o))return NaN;if(h(o)){var s="function"==typeof o.valueOf?o.valueOf():o;o=h(s)?s+"":s}if("string"!=typeof o)return 0===o?o:+o;o=o.replace(e,"");var a=n.test(o);return a||r.test(o)?i(o.slice(2),a?2:8):t.test(o)?NaN:+o}return Bx=function(e,t,n){var r,i,o,s,a,l,f=0,m=!1,v=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=r,o=i;return r=i=void 0,f=t,s=e.apply(o,n)}function b(e){var n=e-l;return void 0===l||n>=t||n<0||v&&e-f>=o}function w(){var e=d();if(b(e))return _(e);a=setTimeout(w,function(e){var n=t-(e-l);return v?u(n,o-(e-f)):n}(e))}function _(e){return a=void 0,g&&r?y(e):(r=i=void 0,s)}function S(){var e=d(),n=b(e);if(r=arguments,i=this,l=e,n){if(void 0===a)return function(e){return f=e,a=setTimeout(w,t),m?y(e):s}(l);if(v)return a=setTimeout(w,t),y(l)}return void 0===a&&(a=setTimeout(w,t)),s}return t=p(t)||0,h(n)&&(m=!!n.leading,o=(v="maxWait"in n)?c(p(n.maxWait)||0,t):o,g="trailing"in n?!!n.trailing:g),S.cancel=function(){void 0!==a&&clearTimeout(a),f=0,r=l=i=a=void 0},S.flush=function(){return void 0===a?s:_(d())},S},Bx}_.createContext(void 0);var VJe=HJe();const kW=vfe(VJe);function qJe(e){const t=_.useRef(e);t.current=e,_.useEffect(()=>()=>{t.current()},[])}function GJe(e,t=500,n){const r=_.useRef();qJe(()=>{r.current&&r.current.cancel()});const i=_.useMemo(()=>{const i=kW(e,t,n),o=(...e)=>i(...e);return o.cancel=()=>{i.cancel()},o.isPending=()=>!!r.current,o.flush=()=>i.flush(),o},[e,t,n]);return _.useEffect(()=>{r.current=kW(e,t,n)},[e,t,n]),i}function KJe(e,t,n){const r=e instanceof Function?e():e,[i,o]=_.useState(r),s=_.useRef(r),a=GJe(o,t,n);return s.current===r||(a(r),s.current=r),[i,a]}function zJe({threshold:e=0,root:t=null,rootMargin:n="0%",freezeOnceVisible:r=!1,initialIsIntersecting:i=!1,onChange:o}={}){var s;const[a,l]=_.useState(null),[c,u]=_.useState(()=>({isIntersecting:i,entry:void 0})),d=_.useRef();d.current=o;const h=(null==(s=c.entry)?void 0:s.isIntersecting)&&r;_.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||h)return;const r=new IntersectionObserver(e=>{const t=Array.isArray(r.thresholds)?r.thresholds:[r.thresholds];e.forEach(e=>{const n=e.isIntersecting&&t.some(t=>e.intersectionRatio>=t);u({isIntersecting:n,entry:e}),d.current&&d.current(n,e)})},{threshold:e,root:t,rootMargin:n});return r.observe(a),()=>{r.disconnect()}},[a,JSON.stringify(e),t,n,h,r]);const p=_.useRef(null);_.useEffect(()=>{var e;!a&&null!=(e=c.entry)&&e.target&&!r&&!h&&p.current!==c.entry.target&&(p.current=c.entry.target,u({isIntersecting:i,entry:void 0}))},[a,c.entry,r,h,i]);const f=[l,!!c.isIntersecting,c.entry];return f.ref=f[0],f.isIntersecting=f[1],f.entry=f[2],f}const WJe=_.forwardRef(function({onTrackClick:e,onClick:t,onSubscriptionStatusChanged:n,trackRef:r,manageSubscription:i,...o},s){const a=Vfe(r),l=_.useRef(null);_.useImperativeHandle(s,()=>l.current);const c=zJe({root:l.current}),[u]=KJe(c,3e3);_.useEffect(()=>{i&&a.publication instanceof gC&&!1===(null==u?void 0:u.isIntersecting)&&!1===(null==c?void 0:c.isIntersecting)&&a.publication.setSubscribed(!1)},[u,a,i]),_.useEffect(()=>{i&&a.publication instanceof gC&&!0===(null==c?void 0:c.isIntersecting)&&a.publication.setSubscribed(!0)},[c,a,i]);const{elementProps:d,publication:h,isSubscribed:p}=zfe(a,{element:l,props:o});_.useEffect(()=>{null==n||n(!!p)},[p,n]);return _.createElement("video",{ref:l,...d,muted:!0,onClick:n=>{null==t||t(n),null==e||e({participant:null==a?void 0:a.participant,track:h})}})}),YJe=_.forwardRef(function({trackRef:e,onSubscriptionStatusChanged:t,volume:n,...r},i){const o=Vfe(e),s=_.useRef(null);_.useImperativeHandle(i,()=>s.current);const{elementProps:a,isSubscribed:l,track:c,publication:u}=zfe(o,{element:s,props:r});return _.useEffect(()=>{null==t||t(!!l)},[l,t]),_.useEffect(()=>{void 0===c||void 0===n||(c instanceof fee?c.setVolume(n):kf.warn("Volume can only be set on remote audio tracks."))},[n,c]),_.useEffect(()=>{void 0===u||void 0===r.muted||(u instanceof gC?u.setEnabled(!r.muted):kf.warn("Can only call setEnabled on remote track publications."))},[r.muted,u,c]),_.createElement("audio",{ref:s,...a})});function XJe(e,t){const[n,r]=_.useState(),i=_.useMemo(()=>new ds,[]);return _.useEffect(()=>{let n=!1,o=[];return i.lock().then(async i=>{try{(e.audio||e.video)&&(o=await u_(e),n?o.forEach(e=>e.stop()):r(o))}catch(e){t&&e instanceof Error?t(e):kf.error(e)}finally{i()}}),()=>{n=!0,o.forEach(e=>{e.stop()})}},[JSON.stringify(e,UJe),t,i]),n}const JJe="_inRoom_pife7_8",QJe="_header_pife7_17",ZJe="_filler_pife7_29",eQe="_footer_pife7_34",tQe="_hidden_pife7_53",nQe="_overlay_pife7_57",rQe="_logo_pife7_75",iQe="_buttons_pife7_84",sQe="_layout_pife7_91",oQe="_raiseHand_pife7_111",aQe="_invite_pife7_117",cQe="_shareScreen_pife7_118",lQe="_fixedGrid_pife7_147",uQe="_scrollingGrid_pife7_153",dQe="_tile_pife7_172",fQe="_maximised_pife7_177",fr={inRoom:JJe,header:QJe,filler:ZJe,footer:eQe,hidden:tQe,overlay:nQe,logo:rQe,buttons:iQe,layout:sQe,raiseHand:oQe,invite:aQe,shareScreen:cQe,fixedGrid:lQe,scrollingGrid:uQe,tile:dQe,maximised:fQe},hQe="_content_1cy0f_8",pQe="_wait_1cy0f_19",mQe="_join_1cy0f_32",Y0={content:hQe,wait:pQe,join:mQe};function xW(e,t){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>e(...r),t)}}function Ky({debounce:e,scroll:t,polyfill:n,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,s]=_.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=_.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),l=e?"number"==typeof e?e:e.scroll:null,c=e?"number"==typeof e?e:e.resize:null,u=_.useRef(!1);_.useEffect(()=>(u.current=!0,()=>{u.current=!1}));const[d,h,p]=_.useMemo(()=>{const e=()=>{if(!a.current.element)return;const{left:e,top:t,width:n,height:i,bottom:o,right:l,x:c,y:d}=a.current.element.getBoundingClientRect(),h={left:e,top:t,width:n,height:i,bottom:o,right:l,x:c,y:d};a.current.element instanceof HTMLElement&&r&&(h.height=a.current.element.offsetHeight,h.width=a.current.element.offsetWidth),Object.freeze(h),u.current&&!bQe(a.current.lastBounds,h)&&s(a.current.lastBounds=h)};return[e,c?xW(e,c):e,l?xW(e,l):e]},[s,r,l,c]);function f(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",p,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function m(){a.current.element&&(a.current.resizeObserver=new i(p),a.current.resizeObserver.observe(a.current.element),t&&a.current.scrollContainers&&a.current.scrollContainers.forEach(e=>e.addEventListener("scroll",p,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}return vQe(p,!!t),gQe(h),_.useEffect(()=>{f(),m()},[t,p,h]),_.useEffect(()=>f,[]),[e=>{!e||e===a.current.element||(f(),a.current.element=e,a.current.scrollContainers=Wfe(e),m())},o,d]}function gQe(e){_.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}function vQe(e,t){_.useEffect(()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,t])}function Wfe(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(e);return[n,r,i].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...Wfe(e.parentElement)]}const yQe=["x","y","top","bottom","left","right","width","height"],bQe=(e,t)=>yQe.every(n=>e[n]===t[n]),_Qe="_loading_14w06_8",SQe={loading:_Qe},EQe=({size:e,loading:t,...n})=>w.jsxs("div",{children:[t&&w.jsx("div",{className:SQe.loading,children:w.jsx(FOe,{size:e/3})}),w.jsx(Qv,{size:e,...n})]}),wQe="_preview_1jjvr_8",CQe="_mirror_1jjvr_24",TQe="_cameraStarting_1jjvr_28",RQe="_avatarContainer_1jjvr_39",IQe="_buttonBar_1jjvr_51",X0={preview:wQe,mirror:CQe,cameraStarting:TQe,avatarContainer:RQe,buttonBar:IQe},kQe=({matrixInfo:e,muteStates:t,videoTrack:n,children:r})=>{const{t:i}=Je(),[o,s]=Ky(),a=_.useRef(null);_.useEffect(()=>(a.current&&(null==n||n.attach(a.current)),()=>{null==n||n.detach()}),[n]);const l=_.useMemo(()=>t.video.enabled&&!n,[t.video.enabled,n]);return w.jsxs("div",{className:Ne(X0.preview),ref:o,children:[w.jsx("video",{className:n&&"user"===YA(n).facingMode?X0.mirror:void 0,ref:a,muted:!0,playsInline:!0,tabIndex:-1,disablePictureInPicture:!0}),(!t.video.enabled||l)&&w.jsx(w.Fragment,{children:w.jsxs("div",{className:X0.avatarContainer,children:[l&&w.jsx("div",{className:X0.cameraStarting,role:"status",children:i("video_tile.camera_starting")}),w.jsx(EQe,{id:e.userId,name:e.displayName,size:Math.min(s.width,s.height)/2,src:e.avatarUrl,loading:l})]})}),w.jsx("div",{className:X0.buttonBar,children:r})]})},Yfe=e=>{const{t}=Je();return w.jsx(Ft,{kind:"secondary",size:"sm",Icon:qMe,...e,children:t("action.invite")})};function el(e){const t=_.useRef(void 0);return t.current??(t.current={value:e()}),t.current.value}function xf(e){const t=_.useRef(e);return t.current=e,t}const Xfe=({client:e,matrixInfo:t,muteStates:n,onEnter:r,enterLabel:i,confineToRoom:o,hideHeader:s,participantCount:a,onShareClick:l,waitingForInvite:c})=>{var u;_.useEffect(()=>(M.info("[Lifecycle] GroupCallView Component mounted"),()=>{M.info("[Lifecycle] GroupCallView Component unmounted")}),[]);const{t:d}=Je();q_(t.roomName);const h=_.useCallback(()=>{var e,t;return null==(t=(e=n.audio).setEnabled)?void 0:t.call(e,e=>!e)},[n]),p=_.useCallback(()=>{var e,t;return null==(t=(e=n.video).setEnabled)?void 0:t.call(e,e=>!e)},[n]),[f,m]=_.useState(!1),[v,g]=_.useState(W9),y=_.useCallback(()=>m(!0),[m]),b=_.useCallback(()=>m(!1),[m]),S=fl(),E=_.useCallback(()=>{var e;null==(e=S("/"))||e.catch(e=>{M.error("Failed to navigate to /",e)})},[S]),C=DT("(max-height: 500px)"),k=!o&&w.jsx(il,{className:Y0.recents,to:"/",children:d("lobby.leave_button")}),T=Gu(),R=null==(u=Ci(T.videoInput.selected$))?void 0:u.id,I=el(()=>{var e;return n.audio.enabled&&{deviceId:null==(e=Aw(T.audioInput.selected$))?void 0:e.id}}),{processor:x}=LR(),P=el(()=>x),L=_.useMemo(()=>({audio:Object.assign({},I),video:n.video.enabled&&{deviceId:R,processor:P}}),[I,n.video.enabled,R,P]),O=xf(n),A=XJe(L,_.useCallback(e=>{var t,n,r,i;M.error("Error while creating preview Tracks:",e),null==(n=(t=O.current.audio).setEnabled)||n.call(t,!1),null==(i=(r=O.current.video).setEnabled)||i.call(r,!1)},[O])),D=_.useMemo(()=>(null==A?void 0:A.find(e=>e.kind===he.Kind.Video))??null,[A]);return _.useEffect(()=>{D&&void 0===R&&T.requestDeviceNames()},[T,R,D]),rfe(D),w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:Ne(Y0.room,fr.inRoom),children:[!s&&w.jsxs(Bu,{children:[w.jsx(Df,{children:w.jsx(tae,{id:t.roomId,name:t.roomName,avatarUrl:t.roomAvatar,encrypted:t.e2eeSystem.kind!==sn.NONE,participantCount:a})}),w.jsx(Nf,{children:null!==l&&w.jsx(Yfe,{onClick:l})})]}),w.jsxs("div",{className:Y0.content,children:[w.jsx(kQe,{matrixInfo:t,muteStates:n,videoTrack:D,children:w.jsx(Ft,{className:Ne(Y0.join,{[Y0.wait]:c}),size:c?"sm":"lg",onClick:()=>{c||r()},"data-testid":"lobby_joinCall",children:i??d("lobby.join_button")})}),!C&&k]}),w.jsxs("div",{className:fr.footer,children:[C&&k,w.jsxs("div",{className:fr.buttons,children:[w.jsx(_le,{muted:!n.audio.enabled,onClick:h,disabled:null===n.audio.setEnabled}),w.jsx(Sle,{muted:!n.video.enabled,onClick:p,disabled:null===n.video.setEnabled}),w.jsx(wle,{onClick:y}),!o&&w.jsx(Ele,{onClick:E})]})]})]}),e&&w.jsx(Y9,{client:e,open:f,onDismiss:b,tab:v,onTabChange:g})]})},xQe="_headline_1em2y_8",AQe="_callEndedContent_1em2y_15",LQe="_callEndedButton_1em2y_35",PQe="_submitButton_1em2y_40",OQe="_container_1em2y_47",MQe="_main_1em2y_55",DQe="_footer_1em2y_72",wd={headline:xQe,callEndedContent:AQe,callEndedButton:LQe,submitButton:PQe,container:OQe,main:MQe,footer:DQe},NQe="_starIcon_1m09w_8",UQe="_starRating_1m09w_12",jQe="_inputContainer_1m09w_18",FQe="_hideElement_1m09w_22",J0={starIcon:NQe,starRating:UQe,inputContainer:jQe,hideElement:FQe},$Qe=(e,t)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{d:"M14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267Z",fill:"white"})),BQe=_.forwardRef($Qe),HQe=(e,t)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{id:"Vector",d:"M14 7.50675L15.2933 10.5601L15.92 12.0401L17.52 12.1734L20.8133 12.4534L18.3066 14.6267L17.0933 15.6801L17.4533 17.2534L18.2 20.4667L15.3733 18.7601L14 17.9067L12.6266 18.7334L9.79996 20.4401L10.5466 17.2267L10.9066 15.6534L9.69329 14.6001L7.18663 12.4267L10.48 12.1467L12.08 12.0134L12.7066 10.5334L14 7.50675M14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748Z",fill:"white"})),VQe=_.forwardRef(HQe);function qQe({starCount:e,onChange:t,required:n}){const[r,i]=_.useState(0),[o,s]=_.useState(0),{t:a}=Je();return w.jsx("div",{className:J0.starRating,children:[...Array(e)].map((e,n)=>(n+=1,w.jsxs("div",{className:J0.inputContainer,onMouseEnter:()=>s(n),onMouseLeave:()=>s(r),children:[w.jsx("input",{className:J0.hideElement,type:"radio",id:"starInput"+String(n),value:String(n)+"Star",name:"star rating",onChange:e=>{i(n),t(n)},required:!0}),w.jsx("label",{className:J0.hideElement,id:"starInvisibleLabel"+String(n),htmlFor:"starInput"+String(n),children:a("star_rating_input_label",{count:n})}),w.jsx("label",{className:J0.starIcon,id:"starIcon"+String(n),htmlFor:"starInput"+String(n),children:n<=(o||r)?w.jsx(BQe,{}):w.jsx(VQe,{})})]},n)))})}const GQe=({client:e,isPasswordlessUser:t,hideHeader:n,confineToRoom:r,endedCallId:i})=>{const{t:o}=Je(),s=fl(),{displayName:a}=D_(e),[l,c]=_.useState(!1),[u,d]=_.useState(0),[h,p]=_.useState(!1),[f,m]=_.useState(!1),v=_.useCallback(e=>{e.preventDefault();const n=new FormData(e.target).get("feedbackText");Dt.instance.eventQualitySurvey.track(i,n,u),p(!0),setTimeout(()=>{m(!0),setTimeout(()=>{var e;t?c(!0):r||null==(e=s("/"))||e.catch(e=>{M.error("Failed to navigate to /",e)})},1e3)},1e3)},[i,s,t,r,u]),g=t&&w.jsxs("div",{className:wd.callEndedContent,children:[w.jsxs(Vs,{i18nKey:"call_ended_view.create_account_prompt",children:[w.jsx("p",{children:"Why not finish by setting up a password to keep your account?"}),w.jsx("p",{children:"You'll be able to keep your name and set an avatar for use on future calls"})]}),w.jsx(x8,{className:wd.callEndedButton,to:"/register",children:o("call_ended_view.create_account_button")})]}),y=w.jsxs("div",{className:wd.callEndedContent,children:[w.jsx(Vs,{i18nKey:"call_ended_view.feedback_prompt",children:w.jsx("p",{children:"We'd love to hear your feedback so we can improve your experience."})}),w.jsxs("form",{onSubmit:v,children:[w.jsx(St,{children:w.jsx(qQe,{starCount:5,onChange:d,required:!0})}),w.jsx(St,{children:w.jsx(Sn,{className:Ple.feedback,id:"feedbackText",name:"feedbackText",label:o("settings.feedback_tab_description_label"),placeholder:o("settings.feedback_tab_description_label"),type:"textarea"})})," ",w.jsx(St,{children:f?w.jsx(Vs,{i18nKey:"call_ended_view.feedback_done",children:w.jsx("p",{children:"Thanks for your feedback!"})}):w.jsx(Ft,{type:"submit",className:wd.submitButton,"data-testid":"home_go",children:o(h?"submitting":"action.submit")})})]})]});return w.jsxs(w.Fragment,{children:[!n&&w.jsxs(Bu,{children:[w.jsx(Df,{children:!r&&w.jsx(cp,{})}),w.jsx(Nf,{})]}),w.jsxs("div",{className:wd.container,children:[w.jsxs("main",{className:wd.main,children:[w.jsx(ml,{size:"xl",weight:"semibold",className:wd.headline,children:l?o("call_ended_view.headline",{displayName:a}):o("call_ended_view.headline",{displayName:a})+"\n"+o("call_ended_view.survey_prompt")}),l&&!r||!Dt.instance.isEnabled()?g:y]}),!r&&w.jsx(on,{className:wd.footer,children:w.jsxs(il,{to:"/",children:[" ",o("call_ended_view.not_now_button")," "]})})]})]})};function AW(e,t,n){const r=n.find(n=>n.kind===t&&n.label===e);return null==r?void 0:r.deviceId}const KQe=(e,t)=>_.createElement("svg",{width:48,height:48,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("g",{id:"Logo Mark"},_.createElement("rect",{width:47.86,height:48,rx:23.93,fill:"#0DBD8B"}),_.createElement("g",{id:"Union"},_.createElement("path",{d:"M21.3075 9.42871C20.3396 9.42871 19.5549 10.214 19.5549 11.1828C19.5549 12.1516 20.3396 12.9369 21.3075 12.9369C25.9321 12.9369 29.6811 16.689 29.6811 21.3175C29.6811 22.2863 30.4657 23.0716 31.4337 23.0716C32.4016 23.0716 33.1863 22.2863 33.1863 21.3175C33.1863 14.7515 27.868 9.42871 21.3075 9.42871Z",fill:"white"}),_.createElement("path",{d:"M38.4591 21.3174C38.4591 20.3486 37.6745 19.5633 36.7065 19.5633C35.7386 19.5633 34.9539 20.3486 34.9539 21.3174C34.9539 25.9459 31.2049 29.698 26.5804 29.698C25.6124 29.698 24.8277 30.4833 24.8277 31.4521C24.8277 32.4209 25.6124 33.2062 26.5804 33.2062C33.1408 33.2062 38.4591 27.8834 38.4591 21.3174Z",fill:"white"}),_.createElement("path",{d:"M28.3329 36.8173C28.3329 37.786 27.5482 38.5714 26.5803 38.5714C20.0198 38.5714 14.7015 33.2486 14.7015 26.6826C14.7015 25.7138 15.4862 24.9285 16.4541 24.9285C17.4221 24.9285 18.2067 25.7138 18.2067 26.6826C18.2067 31.3111 21.9557 35.0632 26.5803 35.0632C27.5482 35.0632 28.3329 35.8485 28.3329 36.8173Z",fill:"white"}),_.createElement("path",{d:"M9.40112 26.6827C9.40112 27.6514 10.1858 28.4368 11.1537 28.4368C12.1217 28.4368 12.9064 27.6514 12.9064 26.6827C12.9064 22.0542 16.6553 18.3021 21.2799 18.3021C22.2478 18.3021 23.0325 17.5167 23.0325 16.548C23.0325 15.5792 22.2478 14.7939 21.2799 14.7939C14.7194 14.7939 9.40112 20.1167 9.40112 26.6827Z",fill:"white"})))),zQe=_.forwardRef(KQe),WQe=(e,t)=>_.createElement("svg",{width:160,height:22,viewBox:"0 0 160 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("g",{id:"Logo Type"},_.createElement("g",{id:"Vector"},_.createElement("path",{d:"M14.8673 15.1575H3.39742C3.53293 16.3508 3.96849 17.3036 4.70411 18.0157C5.43974 18.7087 6.40766 19.0551 7.60789 19.0551C8.40159 19.0551 9.11785 18.8626 9.75668 18.4777C10.3955 18.0927 10.8504 17.5731 11.1215 16.9186H14.606C14.1414 18.4392 13.2702 19.671 11.9926 20.6142C10.7343 21.5381 9.24368 22 7.52078 22C5.27519 22 3.45549 21.259 2.06168 19.7769C0.687227 18.2948 0 16.4182 0 14.147C0 11.9335 0.696906 10.0761 2.09072 8.5748C3.48453 7.07349 5.28487 6.32283 7.49174 6.32283C9.69861 6.32283 11.4796 7.06387 12.8347 8.54593C14.2091 10.0087 14.8964 11.8565 14.8964 14.0892L14.8673 15.1575ZM7.49174 9.12336C6.40766 9.12336 5.50749 9.44095 4.79123 10.0761C4.07496 10.7113 3.62972 11.5582 3.45549 12.6168H11.4699C11.315 11.5582 10.8892 10.7113 10.1922 10.0761C9.49534 9.44095 8.59517 9.12336 7.49174 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M17.2743 17.1785V0H20.7298V17.2362C20.7298 18.0061 21.1557 18.3911 22.0074 18.3911L22.6172 18.3622V21.6247C22.2881 21.6824 21.9397 21.7113 21.5719 21.7113C20.0813 21.7113 18.9875 21.336 18.2906 20.5853C17.6131 19.8346 17.2743 18.699 17.2743 17.1785Z",fill:"currentColor"}),_.createElement("path",{d:"M38.71 15.1575H27.2401C27.3756 16.3508 27.8112 17.3036 28.5468 18.0157C29.2824 18.7087 30.2504 19.0551 31.4506 19.0551C32.2443 19.0551 32.9606 18.8626 33.5994 18.4777C34.2382 18.0927 34.6931 17.5731 34.9642 16.9186H38.4487C37.9841 18.4392 37.113 19.671 35.8353 20.6142C34.577 21.5381 33.0864 22 31.3635 22C29.1179 22 27.2982 21.259 25.9044 19.7769C24.5299 18.2948 23.8427 16.4182 23.8427 14.147C23.8427 11.9335 24.5396 10.0761 25.9334 8.5748C27.3272 7.07349 29.1276 6.32283 31.3344 6.32283C33.5413 6.32283 35.3223 7.06387 36.6774 8.54593C38.0518 10.0087 38.7391 11.8565 38.7391 14.0892L38.71 15.1575ZM31.3344 9.12336C30.2504 9.12336 29.3502 9.44095 28.6339 10.0761C27.9177 10.7113 27.4724 11.5582 27.2982 12.6168H35.3126C35.1577 11.5582 34.7319 10.7113 34.035 10.0761C33.3381 9.44095 32.4379 9.12336 31.3344 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M54.3001 13.0499V21.6535H50.8446V12.6745C50.8446 10.4033 49.8961 9.26772 47.9989 9.26772C46.9729 9.26772 46.1502 9.59493 45.5307 10.2493C44.9306 10.9038 44.6306 11.7988 44.6306 12.9344V21.6535H41.1751V6.66929H44.3692V8.66142C44.737 7.98775 45.2984 7.42957 46.0534 6.98688C46.8084 6.54418 47.7473 6.32283 48.8701 6.32283C50.9608 6.32283 52.4707 7.11199 53.4 8.69029C54.6776 7.11199 56.3812 6.32283 58.5106 6.32283C60.2722 6.32283 61.6273 6.87139 62.5759 7.9685C63.5244 9.04637 63.9987 10.4707 63.9987 12.2415V21.6535H60.5432V12.6745C60.5432 10.4033 59.5947 9.26772 57.6975 9.26772C56.6522 9.26772 55.8198 9.60455 55.2003 10.2782C54.6002 10.9326 54.3001 11.8565 54.3001 13.0499Z",fill:"currentColor"}),_.createElement("path",{d:"M81.1834 15.1575H69.7135C69.849 16.3508 70.2846 17.3036 71.0202 18.0157C71.7558 18.7087 72.7237 19.0551 73.924 19.0551C74.7177 19.0551 75.4339 18.8626 76.0728 18.4777C76.7116 18.0927 77.1665 17.5731 77.4375 16.9186H80.9221C80.4575 18.4392 79.5863 19.671 78.3087 20.6142C77.0504 21.5381 75.5598 22 73.8369 22C71.5913 22 69.7716 21.259 68.3778 19.7769C67.0033 18.2948 66.3161 16.4182 66.3161 14.147C66.3161 11.9335 67.013 10.0761 68.4068 8.5748C69.8006 7.07349 71.601 6.32283 73.8078 6.32283C76.0147 6.32283 77.7957 7.06387 79.1508 8.54593C80.5252 10.0087 81.2124 11.8565 81.2124 14.0892L81.1834 15.1575ZM73.8078 9.12336C72.7237 9.12336 71.8236 9.44095 71.1073 10.0761C70.391 10.7113 69.9458 11.5582 69.7716 12.6168H77.786C77.6311 11.5582 77.2052 10.7113 76.5083 10.0761C75.8114 9.44095 74.9113 9.12336 73.8078 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M86.8426 6.66929V8.66142C87.191 8.007 87.7621 7.45844 88.5558 7.01575C89.3689 6.55381 90.3465 6.32283 91.4886 6.32283C93.2696 6.32283 94.6441 6.86177 95.612 7.93963C96.5993 9.0175 97.0929 10.4514 97.0929 12.2415V21.6535H93.6374V12.6745C93.6374 11.6159 93.3858 10.7883 92.8824 10.1916C92.3985 9.57568 91.6532 9.26772 90.6465 9.26772C89.5431 9.26772 88.672 9.59493 88.0331 10.2493C87.4137 10.9038 87.1039 11.8084 87.1039 12.9633V21.6535H83.6484V6.66929H86.8426Z",fill:"currentColor"}),_.createElement("path",{d:"M107.185 18.5932V21.5669C106.759 21.6824 106.159 21.7402 105.384 21.7402C102.442 21.7402 100.971 20.2677 100.971 17.3228V9.41208H98.6766V6.66929H100.971V2.77165H104.426V6.66929H107.243V9.41208H104.426V16.9764C104.426 18.1505 104.987 18.7375 106.11 18.7375L107.185 18.5932Z",fill:"currentColor"}),_.createElement("path",{d:"M116.115 18.9881C114.474 17.2035 113.653 14.9429 113.653 12.2064C113.653 9.4699 114.474 7.21782 116.115 5.45015C117.773 3.66548 119.953 2.77314 122.654 2.77314C124.876 2.77314 126.756 3.38503 128.295 4.6088C129.833 5.83258 130.816 7.47277 131.244 9.52939H129.269C128.91 7.99967 128.132 6.7844 126.936 5.88357C125.739 4.98273 124.312 4.53232 122.654 4.53232C120.534 4.53232 118.824 5.23769 117.525 6.64842C116.243 8.05916 115.602 9.91182 115.602 12.2064C115.602 14.501 116.243 16.3536 117.525 17.7644C118.824 19.1751 120.534 19.8805 122.654 19.8805C124.312 19.8805 125.739 19.4301 126.936 18.5292C128.132 17.6284 128.91 16.4131 129.269 14.8834H131.244C130.816 16.94 129.833 18.5802 128.295 19.804C126.756 21.0278 124.876 21.6397 122.654 21.6397C119.953 21.6397 117.773 20.7558 116.115 18.9881Z",fill:"currentColor"}),_.createElement("path",{d:"M143.174 15.0874C140.832 15.0874 139.233 15.1384 138.379 15.2403C137.541 15.3253 136.926 15.4698 136.532 15.6738C135.831 16.0647 135.481 16.6936 135.481 17.5604C135.481 19.2261 136.473 20.0589 138.456 20.0589C139.977 20.0589 141.139 19.719 141.943 19.0391C142.763 18.3593 143.174 17.4499 143.174 16.3111V15.0874ZM138.25 21.5632C136.763 21.5632 135.626 21.2062 134.84 20.4924C134.071 19.7615 133.686 18.8012 133.686 17.6114C133.686 16.8295 133.891 16.1327 134.301 15.5208C134.729 14.9089 135.31 14.4585 136.045 14.1695C136.661 13.9316 137.455 13.7786 138.43 13.7106C139.404 13.6256 140.986 13.5831 143.174 13.5831V12.7418C143.174 10.6002 141.943 9.52939 139.481 9.52939C137.361 9.52939 136.131 10.3877 135.789 12.1044H134.019C134.207 10.8466 134.746 9.84383 135.635 9.09597C136.541 8.34811 137.849 7.97418 139.558 7.97418C141.387 7.97418 142.746 8.3991 143.635 9.24894C144.541 10.0988 144.994 11.2716 144.994 12.7673V21.2572H143.251V19.3706C142.345 20.8323 140.678 21.5632 138.25 21.5632Z",fill:"currentColor"}),_.createElement("path",{d:"M149.358 18.4018V2.13576H151.178V18.1978C151.178 18.7247 151.264 19.0901 151.435 19.2941C151.623 19.498 151.956 19.6 152.435 19.6L152.948 19.549V21.2062C152.657 21.2572 152.341 21.2827 151.999 21.2827C150.238 21.2827 149.358 20.3224 149.358 18.4018Z",fill:"currentColor"}),_.createElement("path",{d:"M155.944 18.4018V2.13576H157.764V18.1978C157.764 18.7247 157.85 19.0901 158.021 19.2941C158.209 19.498 158.542 19.6 159.021 19.6L159.534 19.549V21.2062C159.243 21.2572 158.927 21.2827 158.585 21.2827C156.824 21.2827 155.944 20.3224 155.944 18.4018Z",fill:"currentColor"})))),YQe=_.forwardRef(WQe),LW=e=>{const t=document.activeElement;return null!==t&&t.contains(e)},PW=Object.fromEntries(Db.slice(0,5).map((e,t)=>[(t+1).toString(),e]));function XQe(e,t,n,r,i,o){const s=_.useRef(!1);kw(window,"keydown",_.useCallback(a=>{null!==e.current&&LW(e.current)&&(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||("m"===a.key?(a.preventDefault(),t()):"v"==a.key?(a.preventDefault(),n()):" "===a.key?(a.preventDefault(),s.current||(s.current=!0,r(!1))):"h"===a.key?(a.preventDefault(),o()):PW[a.key]&&(a.preventDefault(),i(PW[a.key]))))},[e,n,t,r,i,o]),_.useMemo(()=>({capture:!0}),[])),kw(window,"keyup",_.useCallback(t=>{null!==e.current&&LW(e.current)&&" "===t.key&&(s.current=!1,r(!0))},[e,r])),kw(window,"blur",_.useCallback(()=>{s.current&&(s.current=!1,r(!0))},[r,s]))}const JQe="_tile_31vx3_8",QQe="_speaking_31vx3_28",ZQe="_handRaised_31vx3_48",eZe="_muteIcon_31vx3_75",tZe="_volumeSlider_31vx3_83",nZe="_switchCamera_31vx3_87",hg={tile:JQe,speaking:QQe,handRaised:ZQe,muteIcon:eZe,volumeSlider:tZe,switchCamera:nZe},OW=Symbol("nothing");class NR{constructor(){this.ended$=new Zr,this.bindImpl=Sqe(this.ended$)}bind(){return this.bindImpl}behavior(e,t=OW){const n=new ms(t);if(e.pipe(this.bind(),Qo()).subscribe({next(e){n.next(e)},error(e){n.error(e)}}),n.value===OW)throw new Error("Behavior failed to synchronously emit an initial value");return n}end(){this.ended$.next(),this.ended$.complete()}}const rZe=new NR;class W_{constructor(){this.scope=new NR}destroy(){this.scope.end()}}function nD(e,t){return D8(e).pipe(ke(()=>({participant:e,publication:e.getTrackPublication(t),source:t})),mqe("publication"))}function Jfe(e,t,n){return ln([nD(e,t),P7(1e3).pipe(un(0))]).pipe(Mt(async([e])=>{var t;const r=null==(t=null==e?void 0:e.publication)?void 0:t.track;if(!r||!(r instanceof SO||r instanceof _O))return;const i=await r.getRTCStatsReport();if(i)for(const e of i.values())if(e.type===n)return e}),un(void 0))}function uP(e,t){return Jfe(e,t,"inbound-rtp").pipe(ke(e=>e))}function MW(e,t){return Jfe(e,t,"outbound-rtp").pipe(ke(e=>e))}function _E(e,t){let n={framesDecoded:void 0,framesReceived:void 0};return uP(e,t).pipe(ke(e=>{if(!e)return;const{framesDecoded:t,framesDropped:n,framesReceived:r}=e;return{framesDecoded:t,framesDropped:n,framesReceived:r}}),$s(e=>!!e),ke(e=>{const t=n;if(n=e,"number"==typeof e.framesReceived&&"number"==typeof t.framesReceived&&"number"==typeof e.framesDecoded&&"number"==typeof t.framesDecoded){const n=e.framesReceived-t.framesReceived,r=e.framesDecoded-t.framesDecoded;if(n>0)return r>0}}),$s(e=>"boolean"==typeof e),un(void 0))}function Hx(e,t,n,r){return yKe(e,ue.EncryptionError).pipe(ke(e=>{const[i]=e;return n.kind===sn.PER_PARTICIPANT?((null==i?void 0:i.message.includes(t.identity))&&(null==i?void 0:i.message.includes(r)))??!1:n.kind===sn.SHARED_KEY&&!(null==i||!i.message.includes(r))}),Cqe(1e3),un(!1))}class Qfe extends W_{constructor(e,t,n,r,i,o,s,a){super(),this.id=e,this.member=t,this.participant$=n,this.displayName$=a;const l=this.observeTrackReference$(i);this.video$=this.observeTrackReference$(o),this.unencryptedWarning$=this.scope.behavior(ln([l,this.video$],(e,t)=>{var n,i;return r.kind!==sn.NONE&&(!1===(null==(n=null==e?void 0:e.publication)?void 0:n.isEncrypted)||!1===(null==(i=null==t?void 0:t.publication)?void 0:i.isEncrypted))})),this.encryptionStatus$=this.scope.behavior(this.participant$.pipe(Mt(e=>e?e.isLocal||r.kind===sn.NONE?Ot(1):r.kind===sn.PER_PARTICIPANT?ln([Hx(s,e,r,"MissingKey"),Hx(s,e,r,"InvalidKey"),_E(e,i),_E(e,o)]).pipe(ke(([e,t,n,r])=>e?2:t?3:n||r?1:void 0),$s(e=>!!e),un(0)):ln([Hx(s,e,r,"InvalidKey"),_E(e,i),_E(e,o)]).pipe(ke(([e,t,n])=>e?4:t||n?1:void 0),$s(e=>!!e),un(0)):Ot(0))))}observeTrackReference$(e){return this.scope.behavior(this.participant$.pipe(Mt(t=>void 0===t?Ot(void 0):nD(t,e))))}}class Zfe extends Qfe{constructor(e,t,n,r,i,o,s,a){super(e,t,n,r,he.Source.Microphone,he.Source.Camera,i,o),this.handRaised$=s,this.reaction$=a,this._speaking$=this.scope.behavior(this.participant$.pipe(Mt(e=>e?M8(e,ae.IsSpeakingChanged).pipe(ke(e=>e.isSpeaking)):Ot(!1)))),this._cropVideo$=new ms(!0),this.cropVideo$=this._cropVideo$;const l=this.scope.behavior(n.pipe(Mt(e=>(e&&D8(e))??Ot(void 0))));this.audioEnabled$=this.scope.behavior(l.pipe(ke(e=>{var t;return!1===(null==(t=null==e?void 0:e.microphoneTrack)?void 0:t.isMuted)}))),this._videoEnabled$=this.scope.behavior(l.pipe(ke(e=>{var t;return!1===(null==(t=null==e?void 0:e.cameraTrack)?void 0:t.isMuted)})))}get speaking$(){return this._speaking$}get videoEnabled$(){return this._videoEnabled$}toggleFitContain(){this._cropVideo$.next(!this._cropVideo$.value)}get local(){return this instanceof xv}}class xv extends Zfe{constructor(e,t,n,r,i,o,s,a,l){super(e,t,n,r,i,s,a,l),this.mediaDevices=o,this.videoTrack$=this.video$.pipe(Mt(e=>{var t;const n=null==(t=null==e?void 0:e.publication)?void 0:t.track;return n instanceof nv?vv(Ba(n,Re.Restarted).pipe(un(null),ke(()=>n)),Ba(n,Re.Muted).pipe(ke(()=>null))):Ot(null)})),this.mirror$=this.scope.behavior(this.videoTrack$.pipe(ke(e=>null!==e&&"user"===YA(e).facingMode))),this.alwaysShow$=NK.value$,this.setAlwaysShow=NK.setValue,this.switchCamera$=this.scope.behavior("desktop"===tc?Ot(null):this.videoTrack$.pipe(ke(e=>{if(null===e)return null;const t=YA(e).facingMode;return"user"!==t&&"environment"!==t?null:()=>{e.restartTrack({facingMode:"user"===t?"environment":"user"}).then(()=>{const t=e.mediaStreamTrack.getSettings().deviceId;void 0!==t&&this.mediaDevices.videoInput.select(t)}).catch(e=>M.error("Failed to switch camera",t,e))}}))),this.audioStreamStats$=ln([this.participant$,jb.value$]).pipe(Mt(([e,t])=>e&&t?MW(e,he.Source.Microphone):Ot(void 0))),this.videoStreamStats$=ln([this.participant$,jb.value$]).pipe(Mt(([e,t])=>e&&t?MW(e,he.Source.Camera):Ot(void 0)))}}class iZe extends Zfe{constructor(e,t,n,r,i,o,s,a,l){super(e,t,n,r,i,s,a,l),this.pretendToBeDisconnected$=o,this.locallyMutedToggle$=new Zr,this.localVolumeAdjustment$=new Zr,this.localVolumeCommit$=new Zr,this.localVolume$=this.scope.behavior(vv(this.locallyMutedToggle$.pipe(ke(()=>"toggle mute")),this.localVolumeAdjustment$,this.localVolumeCommit$.pipe(ke(()=>"commit"))).pipe(U7({volume:1,committedVolume:1},(e,t)=>{switch(t){case"toggle mute":return{...e,volume:0===e.volume?e.committedVolume:0};case"commit":return{...e,committedVolume:0===e.volume?e.committedVolume:e.volume};default:return{...e,volume:t}}}),ke(({volume:e})=>e))),this.locallyMuted$=this.scope.behavior(this.localVolume$.pipe(ke(e=>0===e))),this.audioStreamStats$=ln([this.participant$,jb.value$]).pipe(Mt(([e,t])=>e&&t?uP(e,he.Source.Microphone):Ot(void 0))),this.videoStreamStats$=ln([this.participant$,jb.value$]).pipe(Mt(([e,t])=>e&&t?uP(e,he.Source.Camera):Ot(void 0))),this.__speaking$=this.scope.behavior(o.pipe(Mt(e=>e?Ot(!1):super.speaking$))),this.__videoEnabled$=this.scope.behavior(o.pipe(Mt(e=>e?Ot(!1):super.videoEnabled$))),ln([n,this.pretendToBeDisconnected$.pipe(Mt(e=>e?Ot(0):this.localVolume$),this.scope.bind())]).subscribe(([e,t])=>null==e?void 0:e.setVolume(t))}get speaking$(){return this.__speaking$}get videoEnabled$(){return this.__videoEnabled$}toggleLocallyMuted(){this.locallyMutedToggle$.next()}setLocalVolume(e){this.localVolumeAdjustment$.next(e)}commitLocalVolume(){this.localVolumeCommit$.next()}}class pg extends Qfe{constructor(e,t,n,r,i,o,s,a){super(e,t,n,r,he.Source.ScreenShareAudio,he.Source.ScreenShare,i,s),this.pretendToBeDisconnected$=o,this.local=a,this.videoEnabled$=this.scope.behavior(this.pretendToBeDisconnected$.pipe(ke(e=>!e)))}}var rD=X_(),yt=e=>Y_(e,rD),iD=X_();yt.write=e=>Y_(e,iD);var UR=X_();yt.onStart=e=>Y_(e,UR);var sD=X_();yt.onFrame=e=>Y_(e,sD);var oD=X_();yt.onFinish=e=>Y_(e,oD);var Gg=[];yt.setTimeout=(e,t)=>{const n=yt.now()+t,r=()=>{const e=Gg.findIndex(e=>e.cancel==r);~e&&Gg.splice(e,1),Jd-=~e?1:0},i={time:n,handler:e,cancel:r};return Gg.splice(ehe(n),0,i),Jd+=1,the(),i};var ehe=e=>~(~Gg.findIndex(t=>t.time>e)||~Gg.length);yt.cancel=e=>{UR.delete(e),sD.delete(e),oD.delete(e),rD.delete(e),iD.delete(e)},yt.sync=e=>{dP=!0,yt.batchedUpdates(e),dP=!1},yt.throttle=e=>{let t;function n(){try{e(...t)}finally{t=null}}function r(...e){t=e,yt.onStart(n)}return r.handler=e,r.cancel=()=>{UR.delete(n),t=null},r};var aD=typeof window<"u"?window.requestAnimationFrame:()=>{};yt.use=e=>aD=e,yt.now=typeof performance<"u"?()=>performance.now():Date.now,yt.batchedUpdates=e=>e(),yt.catch=console.error,yt.frameLoop="always",yt.advance=()=>{"demand"!==yt.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):rhe()};var Xd=-1,Jd=0,dP=!1;function Y_(e,t){dP?(t.delete(e),e(0)):(t.add(e),the())}function the(){Xd<0&&(Xd=0,"demand"!==yt.frameLoop&&aD(nhe))}function sZe(){Xd=-1}function nhe(){~Xd&&(aD(nhe),yt.batchedUpdates(rhe))}function rhe(){const e=Xd;Xd=yt.now();const t=ehe(Xd);t&&(ihe(Gg.splice(0,t),e=>e.handler()),Jd-=t),Jd?(UR.flush(),rD.flush(e?Math.min(64,Xd-e):16.667),sD.flush(),iD.flush(),oD.flush()):sZe()}function X_(){let e=new Set,t=e;return{add(n){Jd+=t!=e||e.has(n)?0:1,e.add(n)},delete:n=>(Jd-=t==e&&e.has(n)?1:0,e.delete(n)),flush(n){t.size&&(e=new Set,Jd-=t.size,ihe(t,t=>t(n)&&e.add(t)),Jd+=e.size,t=e)}}}function ihe(e,t){e.forEach(e=>{try{t(e)}catch(e){yt.catch(e)}})}var oZe=Object.defineProperty,aZe=(e,t)=>{for(var n in t)oZe(e,n,{get:t[n],enumerable:!0})},oc={};function fP(){}aZe(oc,{assign:()=>lZe,colors:()=>uf,createStringInterpolator:()=>lD,skipAnimation:()=>ohe,to:()=>she,willAdvance:()=>uD});var cZe=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),Ce={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function Xl(e,t){if(Ce.arr(e)){if(!Ce.arr(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t}var wt=(e,t)=>e.forEach(t);function ol(e,t,n){if(Ce.arr(e))for(let r=0;r<e.length;r++)t.call(n,e[r],`${r}`);else for(const r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r)}var us=e=>Ce.und(e)?[]:Ce.arr(e)?e:[e];function zy(e,t){if(e.size){const n=Array.from(e);e.clear(),wt(n,t)}}var lD,she,my=(e,...t)=>zy(e,e=>e(...t)),cD=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),uf=null,ohe=!1,uD=fP,lZe=e=>{e.to&&(she=e.to),e.now&&(yt.now=e.now),void 0!==e.colors&&(uf=e.colors),null!=e.skipAnimation&&(ohe=e.skipAnimation),e.createStringInterpolator&&(lD=e.createStringInterpolator),e.requestAnimationFrame&&yt.use(e.requestAnimationFrame),e.batchedUpdates&&(yt.batchedUpdates=e.batchedUpdates),e.willAdvance&&(uD=e.willAdvance),e.frameLoop&&(yt.frameLoop=e.frameLoop)},Wy=new Set,sa=[],Vx=[],E3=0,jR={get idle(){return!Wy.size&&!sa.length},start(e){E3>e.priority?(Wy.add(e),yt.onStart(uZe)):(ahe(e),yt(hP))},advance:hP,sort(e){if(E3)yt.onFrame(()=>jR.sort(e));else{const t=sa.indexOf(e);~t&&(sa.splice(t,1),che(e))}},clear(){sa=[],Wy.clear()}};function uZe(){Wy.forEach(ahe),Wy.clear(),yt(hP)}function ahe(e){sa.includes(e)||che(e)}function che(e){sa.splice(dZe(sa,t=>t.priority>e.priority),0,e)}function hP(e){const t=Vx;for(let n=0;n<sa.length;n++){const r=sa[n];E3=r.priority,r.idle||(uD(r),r.advance(e),r.idle||t.push(r))}return E3=0,(Vx=sa).length=0,(sa=t).length>0}function dZe(e,t){const n=e.findIndex(t);return n<0?e.length:n}var fZe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Qa="[-+]?\\d*\\.?\\d+",w3=Qa+"%";function FR(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}var hZe=new RegExp("rgb"+FR(Qa,Qa,Qa)),pZe=new RegExp("rgba"+FR(Qa,Qa,Qa,Qa)),mZe=new RegExp("hsl"+FR(Qa,w3,w3)),gZe=new RegExp("hsla"+FR(Qa,w3,w3,Qa)),vZe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,yZe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,bZe=/^#([0-9a-fA-F]{6})$/,_Ze=/^#([0-9a-fA-F]{8})$/;function SZe(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=bZe.exec(e))?parseInt(t[1]+"ff",16)>>>0:uf&&void 0!==uf[e]?uf[e]:(t=hZe.exec(e))?(Bm(t[1])<<24|Bm(t[2])<<16|Bm(t[3])<<8|255)>>>0:(t=pZe.exec(e))?(Bm(t[1])<<24|Bm(t[2])<<16|Bm(t[3])<<8|UW(t[4]))>>>0:(t=vZe.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=_Ze.exec(e))?parseInt(t[1],16)>>>0:(t=yZe.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=mZe.exec(e))?(255|DW(NW(t[1]),SE(t[2]),SE(t[3])))>>>0:(t=gZe.exec(e))?(DW(NW(t[1]),SE(t[2]),SE(t[3]))|UW(t[4]))>>>0:null}function qx(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function DW(e,t,n){const r=n<.5?n*(1+t):n+t-n*t,i=2*n-r,o=qx(i,r,e+1/3),s=qx(i,r,e),a=qx(i,r,e-1/3);return Math.round(255*o)<<24|Math.round(255*s)<<16|Math.round(255*a)<<8}function Bm(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function NW(e){return(parseFloat(e)%360+360)%360/360}function UW(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function SE(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function jW(e){let t=SZe(e);if(null===t)return e;t=t||0;return`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`}var Kb=(e,t,n)=>{if(Ce.fun(e))return e;if(Ce.arr(e))return Kb({range:e,output:t,extrapolate:n});if(Ce.str(e.output[0]))return lD(e);const r=e,i=r.output,o=r.range||[0,1],s=r.extrapolateLeft||r.extrapolate||"extend",a=r.extrapolateRight||r.extrapolate||"extend",l=r.easing||(e=>e);return e=>{const t=wZe(e,o);return EZe(e,o[t],o[t+1],i[t],i[t+1],l,s,a,r.map)}};function EZe(e,t,n,r,i,o,s,a,l){let c=l?l(e):e;if(c<t){if("identity"===s)return c;"clamp"===s&&(c=t)}if(c>n){if("identity"===a)return c;"clamp"===a&&(c=n)}return r===i?r:t===n?e<=t?r:i:(t===-1/0?c=-c:n===1/0?c-=t:c=(c-t)/(n-t),c=o(c),r===-1/0?c=-c:i===1/0?c+=r:c=c*(i-r)+r,c)}function wZe(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}var CZe={linear:e=>e},zb=Symbol.for("FluidValue.get"),Av=Symbol.for("FluidValue.observers"),ra=e=>!(!e||!e[zb]),Ls=e=>e&&e[zb]?e[zb]():e,FW=e=>e[Av]||null;function TZe(e,t){e.eventObserved?e.eventObserved(t):e(t)}function Wb(e,t){const n=e[Av];n&&n.forEach(e=>{TZe(e,t)})}var lhe=class{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");RZe(this,e)}},RZe=(e,t)=>uhe(e,zb,t);function l1(e,t){if(e[zb]){let n=e[Av];n||uhe(e,Av,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function Yb(e,t){const n=e[Av];if(n&&n.has(t)){const r=n.size-1;r?n.delete(t):e[Av]=null,e.observerRemoved&&e.observerRemoved(r,t)}}var Gx,uhe=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),jw=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,IZe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,$W=new RegExp(`(${jw.source})(%|[a-z]+)`,"i"),kZe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,$R=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,dhe=e=>{const[t,n]=xZe(e);if(!t||cD())return e;const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(r)return r.trim();if(n&&n.startsWith("--")){return window.getComputedStyle(document.documentElement).getPropertyValue(n)||e}return n&&$R.test(n)?dhe(n):n||e},xZe=e=>{const t=$R.exec(e);if(!t)return[,];const[,n,r]=t;return[n,r]},AZe=(e,t,n,r,i)=>`rgba(${Math.round(t)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,fhe=e=>{Gx||(Gx=uf?new RegExp(`(${Object.keys(uf).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map(e=>Ls(e).replace($R,dhe).replace(IZe,jW).replace(Gx,jW)),n=t.map(e=>e.match(jw).map(Number)),r=n[0].map((e,t)=>n.map(e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})).map(t=>Kb({...e,output:t}));return e=>{var n;const i=!$W.test(t[0])&&(null==(n=t.find(e=>$W.test(e)))?void 0:n.replace(jw,""));let o=0;return t[0].replace(jw,()=>`${r[o++](e)}${i||""}`).replace(kZe,AZe)}},dD="react-spring: ",hhe=e=>{const t=e;let n=!1;if("function"!=typeof t)throw new TypeError(`${dD}once requires a function parameter`);return(...e)=>{n||(t(...e),n=!0)}},LZe=hhe(console.warn);function PZe(){LZe(`${dD}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var OZe=hhe(console.warn);function MZe(){OZe(`${dD}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function BR(e){return Ce.str(e)&&("#"==e[0]||/\d/.test(e)||!cD()&&$R.test(e)||e in(uf||{}))}var mg=cD()?_.useEffect:_.useLayoutEffect,DZe=()=>{const e=_.useRef(!1);return mg(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function phe(){const e=_.useState()[1],t=DZe();return()=>{t.current&&e(Math.random())}}var mhe=e=>_.useEffect(e,NZe),NZe=[];function UZe(e){const t=_.useRef(void 0);return _.useEffect(()=>{t.current=e}),t.current}var Xb=Symbol.for("Animated:node"),jZe=e=>!!e&&e[Xb]===e,$c=e=>e&&e[Xb],fD=(e,t)=>cZe(e,Xb,t),HR=e=>e&&e[Xb]&&e[Xb].getPayload(),ghe=class{constructor(){fD(this,this)}getPayload(){return this.payload||[]}},VR=class e extends ghe{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,Ce.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new e(t)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return Ce.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,Ce.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},C3=class e extends VR{constructor(e){super(0),this._string=null,this._toString=Kb({output:[e,e]})}static create(t){return new e(t)}getValue(){return this._string??(this._string=this._toString(this._value))}setValue(e){if(Ce.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=Kb({output:[this.getValue(),e]})),this._value=0,super.reset()}},T3={dependencies:null},qR=class extends ghe{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return ol(this.source,(n,r)=>{jZe(n)?t[r]=n.getValue(e):ra(n)?t[r]=Ls(n):e||(t[r]=n)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&wt(this.payload,e=>e.reset())}_makePayload(e){if(e){const t=new Set;return ol(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){T3.dependencies&&ra(e)&&T3.dependencies.add(e);const t=HR(e);t&&wt(t,e=>this.add(e))}},FZe=class e extends qR{constructor(e){super(e)}static create(t){return new e(t)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const t=this.getPayload();return e.length==t.length?t.map((t,n)=>t.setValue(e[n])).some(Boolean):(super.setValue(e.map($Ze)),!0)}};function $Ze(e){return(BR(e)?C3:VR).create(e)}function pP(e){const t=$c(e);return t?t.constructor:Ce.arr(e)?FZe:BR(e)?C3:VR}var BW=(e,t)=>{const n=!Ce.fun(e)||e.prototype&&e.prototype.isReactComponent;return _.forwardRef((r,i)=>{const o=_.useRef(null),s=n&&_.useCallback(e=>{o.current=VZe(i,e)},[i]),[a,l]=HZe(r,t),c=phe(),u=()=>{const e=o.current;n&&!e||!1===(!!e&&t.applyAnimatedValues(e,a.getValue(!0)))&&c()},d=new BZe(u,l),h=_.useRef(void 0);mg(()=>(h.current=d,wt(l,e=>l1(e,d)),()=>{h.current&&(wt(h.current.deps,e=>Yb(e,h.current)),yt.cancel(h.current.update))})),_.useEffect(u,[]),mhe(()=>()=>{const e=h.current;wt(e.deps,t=>Yb(t,e))});const p=t.getComponentProps(a.getValue());return _.createElement(e,{...p,ref:s})})},BZe=class{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&yt.write(this.update)}};function HZe(e,t){const n=new Set;return T3.dependencies=n,e.style&&(e={...e,style:t.createAnimatedStyle(e.style)}),e=new qR(e),T3.dependencies=null,[e,n]}function VZe(e,t){return e&&(Ce.fun(e)?e(t):e.current=t),t}var HW=Symbol.for("AnimatedComponent"),qZe=(e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:n=e=>new qR(e),getComponentProps:r=e=>e}={})=>{const i={applyAnimatedValues:t,createAnimatedStyle:n,getComponentProps:r},o=e=>{const t=VW(e)||"Anonymous";return(e=Ce.str(e)?o[e]||(o[e]=BW(e,i)):e[HW]||(e[HW]=BW(e,i))).displayName=`Animated(${t})`,e};return ol(e,(t,n)=>{Ce.arr(e)&&(n=VW(t)),o[n]=o(t)}),{animated:o}},VW=e=>Ce.str(e)?e:e&&Ce.str(e.displayName)?e.displayName:Ce.fun(e)&&e.name||null;function Ps(e,...t){return Ce.fun(e)?e(...t):e}var Yy=(e,t)=>!0===e||!!(t&&e&&(Ce.fun(e)?e(t):us(e).includes(t))),_he=(e,t)=>Ce.obj(e)?t&&e[t]:e,She=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,GZe=e=>e,hD=(e,t=GZe)=>{let n=KZe;e.default&&!0!==e.default&&(e=e.default,n=Object.keys(e));const r={};for(const i of n){const n=t(e[i],i);Ce.und(n)||(r[i]=n)}return r},KZe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],zZe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function WZe(e){const t={};let n=0;if(ol(e,(e,r)=>{zZe[r]||(t[r]=e,n++)}),n)return t}function pD(e){const t=WZe(e);if(t){const n={to:t};return ol(e,(e,r)=>r in t||(n[r]=e)),n}return{...e}}function Jb(e){return e=Ls(e),Ce.arr(e)?e.map(Jb):BR(e)?oc.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function YZe(e){for(const t in e)return!0;return!1}function mP(e){return Ce.fun(e)||Ce.arr(e)&&Ce.obj(e[0])}function qW(e,t){var n;null==(n=e.ref)||n.delete(e),null==t||t.delete(e)}function XZe(e,t){var n;t&&e.ref!==t&&(null==(n=e.ref)||n.delete(e),t.add(e),e.ref=t)}var JZe={default:{tension:170,friction:26}},gP={...JZe.default,mass:1,damping:1,easing:CZe.linear,clamp:!1},QZe=class{constructor(){this.velocity=0,Object.assign(this,gP)}};function ZZe(e,t,n){n&&(GW(n={...n},t),t={...n,...t}),GW(e,t),Object.assign(e,t);for(const t in gP)null==e[t]&&(e[t]=gP[t]);let{frequency:r,damping:i}=e;const{mass:o}=e;return Ce.und(r)||(r<.01&&(r=.01),i<0&&(i=0),e.tension=Math.pow(2*Math.PI/r,2)*o,e.friction=4*Math.PI*i*o/r),e}function GW(e,t){if(Ce.und(t.decay)){const n=!Ce.und(t.tension)||!Ce.und(t.friction);(n||!Ce.und(t.frequency)||!Ce.und(t.damping)||!Ce.und(t.mass))&&(e.duration=void 0,e.decay=void 0),n&&(e.frequency=void 0)}else e.duration=void 0}var KW=[],eet=class{constructor(){this.changed=!1,this.values=KW,this.toValues=null,this.fromValues=KW,this.config=new QZe,this.immediate=!1}};function Ehe(e,{key:t,props:n,defaultProps:r,state:i,actions:o}){return new Promise((s,a)=>{let l,c,u=Yy(n.cancel??(null==r?void 0:r.cancel),t);if(u)p();else{Ce.und(n.pause)||(i.paused=Yy(n.pause,t));let e=null==r?void 0:r.pause;!0!==e&&(e=i.paused||Yy(e,t)),l=Ps(n.delay||0,t),e?(i.resumeQueue.add(h),o.pause()):(o.resume(),h())}function d(){i.resumeQueue.add(h),i.timeouts.delete(c),c.cancel(),l=c.time-yt.now()}function h(){l>0&&!oc.skipAnimation?(i.delayed=!0,c=yt.setTimeout(p,l),i.pauseQueue.add(d),i.timeouts.add(c)):p()}function p(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(d),i.timeouts.delete(c),e<=(i.cancelId||0)&&(u=!0);try{o.start({...n,callId:e,cancel:u},s)}catch(e){a(e)}}})}var mD=(e,t)=>1==t.length?t[0]:t.some(e=>e.cancelled)?Kg(e.get()):t.every(e=>e.noop)?whe(e.get()):Ga(e.get(),t.every(e=>e.finished)),whe=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),Ga=(e,t,n=!1)=>({value:e,finished:t,cancelled:n}),Kg=e=>({value:e,cancelled:!0,finished:!1});function Che(e,t,n,r){const{callId:i,parentId:o,onRest:s}=t,{asyncTo:a,promise:l}=n;return o||e!==a||t.reset?n.promise=(async()=>{n.asyncId=i,n.asyncTo=e;const c=hD(t,(e,t)=>"onRest"===t?void 0:e);let u,d;const h=new Promise((e,t)=>(u=e,d=t)),p=e=>{const t=i<=(n.cancelId||0)&&Kg(r)||i!==n.asyncId&&Ga(r,!1);if(t)throw e.result=t,d(e),e},f=(e,t)=>{const o=new zW,s=new WW;return(async()=>{if(oc.skipAnimation)throw Qb(n),s.result=Ga(r,!1),d(s),s;p(o);const a=Ce.obj(e)?{...e}:{...t,to:e};a.parentId=i,ol(c,(e,t)=>{Ce.und(a[t])&&(a[t]=e)});const l=await r.start(a);return p(o),n.paused&&await new Promise(e=>{n.resumeQueue.add(e)}),l})()};let m;if(oc.skipAnimation)return Qb(n),Ga(r,!1);try{let t;t=Ce.arr(e)?(async e=>{for(const t of e)await f(t)})(e):Promise.resolve(e(f,r.stop.bind(r))),await Promise.all([t.then(u),h]),m=Ga(r.get(),!0,!1)}catch(e){if(e instanceof zW)m=e.result;else{if(!(e instanceof WW))throw e;m=e.result}}finally{i==n.asyncId&&(n.asyncId=o,n.asyncTo=o?a:void 0,n.promise=o?l:void 0)}return Ce.fun(s)&&yt.batchedUpdates(()=>{s(m,r,r.item)}),m})():l}function Qb(e,t){zy(e.timeouts,e=>e.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var zW=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},WW=class extends Error{constructor(){super("SkipAnimationSignal")}},vP=e=>e instanceof gD,tet=1,gD=class extends lhe{constructor(){super(...arguments),this.id=tet++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=$c(this);return e&&e.getValue()}to(...e){return oc.to(this,e)}interpolate(...e){return PZe(),oc.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){Wb(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||jR.sort(this),Wb(this,{type:"priority",parent:this,priority:e})}},pp=Symbol.for("SpringPhase"),The=1,Rhe=2,Ihe=4,Kx=e=>(e[pp]&The)>0,Cd=e=>(e[pp]&Rhe)>0,Q0=e=>(e[pp]&Ihe)>0,YW=(e,t)=>t?e[pp]|=Rhe|The:e[pp]&=-3,XW=(e,t)=>t?e[pp]|=Ihe:e[pp]&=-5,net=class extends gD{constructor(e,t){if(super(),this.animation=new eet,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!Ce.und(e)||!Ce.und(t)){const n=Ce.obj(e)?{...e}:{...t,from:e};Ce.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(Cd(this)||this._state.asyncTo)||Q0(this)}get goal(){return Ls(this.animation.to)}get velocity(){const e=$c(this);return e instanceof VR?e.lastVelocity||0:e.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return Kx(this)}get isAnimating(){return Cd(this)}get isPaused(){return Q0(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,n=!1;const r=this.animation;let{toValues:i}=r;const{config:o}=r,s=HR(r.to);!s&&ra(r.to)&&(i=us(Ls(r.to))),r.values.forEach((a,l)=>{if(a.done)return;const c=a.constructor==C3?1:s?s[l].lastPosition:i[l];let u=r.immediate,d=c;if(!u){if(d=a.lastPosition,o.tension<=0)return void(a.done=!0);let t=a.elapsedTime+=e;const n=r.fromValues[l],i=null!=a.v0?a.v0:a.v0=Ce.arr(o.velocity)?o.velocity[l]:o.velocity;let s;const h=o.precision||(n==c?.005:Math.min(1,.001*Math.abs(c-n)));if(Ce.und(o.duration))if(o.decay){const e=!0===o.decay?.998:o.decay,r=Math.exp(-(1-e)*t);d=n+i/(1-e)*(1-r),u=Math.abs(a.lastPosition-d)<=h,s=i*r}else{s=null==a.lastVelocity?i:a.lastVelocity;const t=o.restVelocity||h/10,r=o.clamp?0:o.bounce,l=!Ce.und(r),p=n==c?a.v0>0:n<c;let f,m=!1;const v=1,g=Math.ceil(e/v);for(let e=0;e<g&&(f=Math.abs(s)>t,f||(u=Math.abs(c-d)<=h,!u));++e){l&&(m=d==c||d>c==p,m&&(s=-s*r,d=c));s+=(1e-6*-o.tension*(d-c)+.001*-o.friction*s)/o.mass*v,d+=s*v}}else{let r=1;o.duration>0&&(this._memoizedDuration!==o.duration&&(this._memoizedDuration=o.duration,a.durationProgress>0&&(a.elapsedTime=o.duration*a.durationProgress,t=a.elapsedTime+=e)),r=(o.progress||0)+t/this._memoizedDuration,r=r>1?1:r<0?0:r,a.durationProgress=r),d=n+o.easing(r)*(c-n),s=(d-a.lastPosition)/e,u=1==r}a.lastVelocity=s,Number.isNaN(d)&&(console.warn("Got NaN while animating:",this),u=!0)}s&&!s[l].done&&(u=!1),u?a.done=!0:t=!1,a.setValue(d,o.round)&&(n=!0)});const a=$c(this),l=a.getValue();if(t){const e=Ls(r.to);l===e&&!n||o.decay?n&&o.decay&&this._onChange(l):(a.setValue(e),this._onChange(e)),this._stop()}else n&&this._onChange(l)}set(e){return yt.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Cd(this)){const{to:e,config:t}=this.animation;yt.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let n;return Ce.und(e)?(n=this.queue||[],this.queue=[]):n=[Ce.obj(e)?e:{...t,to:e}],Promise.all(n.map(e=>this._update(e))).then(e=>mD(this,e))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),Qb(this._state,e&&this._lastCallId),yt.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:n,from:r}=e;n=Ce.obj(n)?n[t]:n,(null==n||mP(n))&&(n=void 0),r=Ce.obj(r)?r[t]:r,null==r&&(r=void 0);const i={to:n,from:r};return Kx(this)||(e.reverse&&([n,r]=[r,n]),r=Ls(r),Ce.und(r)?$c(this)||this._set(n):this._set(r)),i}_update({...e},t){const{key:n,defaultProps:r}=this;e.default&&Object.assign(r,hD(e,(e,t)=>/^on/.test(t)?_he(e,n):e)),QW(this,e,"onProps"),ey(this,"onProps",e,this);const i=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const o=this._state;return Ehe(++this._lastCallId,{key:n,props:e,defaultProps:r,state:o,actions:{pause:()=>{Q0(this)||(XW(this,!0),my(o.pauseQueue),ey(this,"onPause",Ga(this,Z0(this,this.animation.to)),this))},resume:()=>{Q0(this)&&(XW(this,!1),Cd(this)&&this._resume(),my(o.resumeQueue),ey(this,"onResume",Ga(this,Z0(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(n=>{if(e.loop&&n.finished&&(!t||!n.noop)){const t=khe(e);if(t)return this._update(t,!0)}return n})}_merge(e,t,n){if(t.cancel)return this.stop(!0),n(Kg(this));const r=!Ce.und(e.to),i=!Ce.und(e.from);if(r||i){if(!(t.callId>this._lastToId))return n(Kg(this));this._lastToId=t.callId}const{key:o,defaultProps:s,animation:a}=this,{to:l,from:c}=a;let{to:u=l,from:d=c}=e;i&&!r&&(!t.default||Ce.und(u))&&(u=d),t.reverse&&([u,d]=[d,u]);const h=!Xl(d,c);h&&(a.from=d),d=Ls(d);const p=!Xl(u,l);p&&this._focus(u);const f=mP(t.to),{config:m}=a,{decay:v,velocity:g}=m;(r||i)&&(m.velocity=0),t.config&&!f&&ZZe(m,Ps(t.config,o),t.config!==s.config?Ps(s.config,o):void 0);let y=$c(this);if(!y||Ce.und(u))return n(Ga(this,!0));const b=Ce.und(t.reset)?i&&!t.default:!Ce.und(d)&&Yy(t.reset,o),w=b?d:this.get(),_=Jb(u),S=Ce.num(_)||Ce.arr(_)||BR(_),E=!f&&(!S||Yy(s.immediate||t.immediate,o));if(p){const e=pP(u);if(e!==y.constructor){if(!E)throw Error(`Cannot animate between ${y.constructor.name} and ${e.name}, as the "to" prop suggests`);y=this._set(_)}}const C=y.constructor;let k=ra(u),T=!1;if(!k){const e=b||!Kx(this)&&h;(p||e)&&(T=Xl(Jb(w),_),k=!T),(!Xl(a.immediate,E)&&!E||!Xl(m.decay,v)||!Xl(m.velocity,g))&&(k=!0)}if(T&&Cd(this)&&(a.changed&&!b?k=!0:k||this._stop(l)),!f&&((k||ra(l))&&(a.values=y.getPayload(),a.toValues=ra(u)?null:C==C3?[1]:us(_)),a.immediate!=E&&(a.immediate=E,!E&&!b&&this._set(l)),k)){const{onRest:e}=a;wt(ret,e=>QW(this,t,e));const r=Ga(this,Z0(this,l));my(this._pendingCalls,r),this._pendingCalls.add(n),a.changed&&yt.batchedUpdates(()=>{var t;a.changed=!b,null==e||e(r,this),b?Ps(s.onRest,r):null==(t=a.onStart)||t.call(a,r,this)})}b&&this._set(w),f?n(Che(t.to,t,this._state,this)):k?this._start():Cd(this)&&!p?this._pendingCalls.add(n):n(whe(w))}_focus(e){const t=this.animation;e!==t.to&&(FW(this)&&this._detach(),t.to=e,FW(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;ra(t)&&(l1(t,this),vP(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;ra(e)&&Yb(e,this)}_set(e,t=!0){const n=Ls(e);if(!Ce.und(n)){const e=$c(this);if(!e||!Xl(n,e.getValue())){const r=pP(n);e&&e.constructor==r?e.setValue(n):fD(this,r.create(n)),e&&yt.batchedUpdates(()=>{this._onChange(n,t)})}}return $c(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,ey(this,"onStart",Ga(this,Z0(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),Ps(this.animation.onChange,e,this)),Ps(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;$c(this).reset(Ls(e.to)),e.immediate||(e.fromValues=e.values.map(e=>e.lastPosition)),Cd(this)||(YW(this,!0),Q0(this)||this._resume())}_resume(){oc.skipAnimation?this.finish():jR.start(this)}_stop(e,t){if(Cd(this)){YW(this,!1);const n=this.animation;wt(n.values,e=>{e.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),Wb(this,{type:"idle",parent:this});const r=t?Kg(this.get()):Ga(this.get(),Z0(this,e??n.to));my(this._pendingCalls,r),n.changed&&(n.changed=!1,ey(this,"onRest",r,this))}}};function Z0(e,t){const n=Jb(t);return Xl(Jb(e.get()),n)}function khe(e,t=e.loop,n=e.to){const r=Ps(t);if(r){const i=!0!==r&&pD(r),o=(i||e).reverse,s=!i||i.reset;return R3({...e,loop:t,default:!1,pause:void 0,to:!o||mP(n)?n:void 0,from:s?e.from:void 0,reset:s,...i})}}function R3(e){const{to:t,from:n}=e=pD(e),r=new Set;return Ce.obj(t)&&JW(t,r),Ce.obj(n)&&JW(n,r),e.keys=r.size?Array.from(r):null,e}function JW(e,t){ol(e,(e,n)=>null!=e&&t.add(n))}var ret=["onStart","onRest","onChange","onPause","onResume"];function QW(e,t,n){e.animation[n]=t[n]!==She(t,n)?_he(t[n],e.key):void 0}function ey(e,t,...n){var r,i,o,s;null==(i=(r=e.animation)[t])||i.call(r,...n),null==(s=(o=e.defaultProps)[t])||s.call(o,...n)}var iet=["onStart","onChange","onRest"],set=1,oet=class{constructor(e,t){this.id=set++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((t,n)=>e[n]=t.get()),e}set(e){for(const t in e){const n=e[t];Ce.und(n)||this.springs[t].set(n)}}update(e){return e&&this.queue.push(R3(e)),this}start(e){let{queue:t}=this;return e?t=us(e).map(R3):this.queue=[],this._flush?this._flush(this,t):(Phe(this,t),aet(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const n=this.springs;wt(us(t),t=>n[t].stop(!!e))}else Qb(this._state,this._lastAsyncId),this.each(t=>t.stop(!!e));return this}pause(e){if(Ce.und(e))this.start({pause:!0});else{const t=this.springs;wt(us(e),e=>t[e].pause())}return this}resume(e){if(Ce.und(e))this.start({pause:!1});else{const t=this.springs;wt(us(e),e=>t[e].resume())}return this}each(e){ol(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:n}=this._events,r=this._active.size>0,i=this._changed.size>0;(r&&!this._started||i&&!this._started)&&(this._started=!0,zy(e,([e,t])=>{t.value=this.get(),e(t,this,this._item)}));const o=!r&&this._started,s=i||o&&n.size?this.get():null;i&&t.size&&zy(t,([e,t])=>{t.value=s,e(t,this,this._item)}),o&&(this._started=!1,zy(n,([e,t])=>{t.value=s,e(t,this,this._item)}))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}yt.onFrame(this._onFrame)}};function aet(e,t){return Promise.all(t.map(t=>xhe(e,t))).then(t=>mD(e,t))}async function xhe(e,t,n){const{keys:r,to:i,from:o,loop:s,onRest:a,onResolve:l}=t,c=Ce.obj(t.default)&&t.default;s&&(t.loop=!1),!1===i&&(t.to=null),!1===o&&(t.from=null);const u=Ce.arr(i)||Ce.fun(i)?i:void 0;u?(t.to=void 0,t.onRest=void 0,c&&(c.onRest=void 0)):wt(iet,n=>{const r=t[n];if(Ce.fun(r)){const i=e._events[n];t[n]=({finished:e,cancelled:t})=>{const n=i.get(r);n?(e||(n.finished=!1),t&&(n.cancelled=!0)):i.set(r,{value:null,finished:e||!1,cancelled:t||!1})},c&&(c[n]=t[n])}});const d=e._state;t.pause===!d.paused?(d.paused=t.pause,my(t.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(t.pause=!0);const h=(r||Object.keys(e.springs)).map(n=>e.springs[n].start(t)),p=!0===t.cancel||!0===She(t,"cancel");(u||p&&d.asyncId)&&h.push(Ehe(++e._lastAsyncId,{props:t,state:d,actions:{pause:fP,resume:fP,start(t,n){p?(Qb(d,e._lastAsyncId),n(Kg(e))):(t.onRest=a,n(Che(u,t,d,e)))}}})),d.paused&&await new Promise(e=>{d.resumeQueue.add(e)});const f=mD(e,await Promise.all(h));if(s&&f.finished&&(!n||!f.noop)){const n=khe(t,s,i);if(n)return Phe(e,[n]),xhe(e,n,!0)}return l&&yt.batchedUpdates(()=>l(f,e,e.item)),f}function cet(e,t){const n={...e.springs};return t&&wt(us(t),e=>{Ce.und(e.keys)&&(e=R3(e)),Ce.obj(e.to)||(e={...e,to:void 0}),Lhe(n,e,e=>Ahe(e))}),uet(e,n),n}function uet(e,t){ol(t,(t,n)=>{e.springs[n]||(e.springs[n]=t,l1(t,e))})}function Ahe(e,t){const n=new net;return n.key=e,t&&l1(n,t),n}function Lhe(e,t,n){t.keys&&wt(t.keys,r=>{(e[r]||(e[r]=n(r)))._prepareNode(t)})}function Phe(e,t){wt(t,t=>{Lhe(e.springs,t,t=>Ahe(t,e))})}var det=_.createContext({pause:!1,immediate:!1}),fet=()=>{const e=[],t=function(t){MZe();const r=[];return wt(e,(e,i)=>{if(Ce.und(t))r.push(e.start());else{const o=n(t,e,i);o&&r.push(e.start(o))}}),r};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const n=e.indexOf(t);~n&&e.splice(n,1)},t.pause=function(){return wt(e,e=>e.pause(...arguments)),this},t.resume=function(){return wt(e,e=>e.resume(...arguments)),this},t.set=function(t){wt(e,(e,n)=>{const r=Ce.fun(t)?t(n,e):t;r&&e.set(r)})},t.start=function(t){const n=[];return wt(e,(e,r)=>{if(Ce.und(t))n.push(e.start());else{const i=this._getProps(t,e,r);i&&n.push(e.start(i))}}),n},t.stop=function(){return wt(e,e=>e.stop(...arguments)),this},t.update=function(t){return wt(e,(e,n)=>e.update(this._getProps(t,e,n))),this};const n=function(e,t,n){return Ce.fun(e)?e(n,t):e};return t._getProps=n,t};function het(e,t,n){const r=Ce.fun(t)&&t,{reset:i,sort:o,trail:s=0,expires:a=!0,exitBeforeEnter:l=!1,onDestroyed:c,ref:u,config:d}=r?r():t,h=_.useMemo(()=>r||3==arguments.length?fet():void 0,[]),p=us(e),f=[],m=_.useRef(null),v=i?null:m.current;mg(()=>{m.current=f}),mhe(()=>(wt(f,e=>{null==h||h.add(e.ctrl),e.ctrl.ref=h}),()=>{wt(m.current,e=>{e.expired&&clearTimeout(e.expirationId),qW(e.ctrl,h),e.ctrl.stop(!0)})}));const g=met(p,r?r():t,v),y=i&&m.current||[];mg(()=>wt(y,({ctrl:e,item:t,key:n})=>{qW(e,h),Ps(c,t,n)}));const b=[];if(v&&wt(v,(e,t)=>{e.expired?(clearTimeout(e.expirationId),y.push(e)):~(t=b[t]=g.indexOf(e.key))&&(f[t]=e)}),wt(p,(e,t)=>{f[t]||(f[t]={key:g[t],item:e,phase:"mount",ctrl:new oet},f[t].ctrl.item=e)}),b.length){let e=-1;const{leave:n}=r?r():t;wt(b,(t,r)=>{const i=v[r];~t?(e=f.indexOf(i),f[e]={...i,item:p[t]}):n&&f.splice(++e,0,i)})}Ce.fun(o)&&f.sort((e,t)=>o(e.item,t.item));let w=-s;const S=phe(),E=hD(t),C=new Map,k=_.useRef(new Map),T=_.useRef(!1);wt(f,(e,n)=>{const i=e.key,o=e.phase,c=r?r():t;let h,p;const f=Ps(c.delay||0,i);if("mount"==o)h=c.enter,p="enter";else{const e=g.indexOf(i)<0;if("leave"!=o)if(e)h=c.leave,p="leave";else{if(!(h=c.update))return;p="update"}else{if(e)return;h=c.enter,p="enter"}}if(h=Ps(h,e.item,n),h=Ce.obj(h)?pD(h):{to:h},!h.config){const t=d||E.config;h.config=Ps(t,e.item,n,p)}w+=s;const y={...E,delay:f+w,ref:u,immediate:c.immediate,reset:!1,...h};if("enter"==p&&Ce.und(y.from)){const i=r?r():t,o=Ce.und(i.initial)||v?i.from:i.initial;y.from=Ps(o,e.item,n)}const{onResolve:b}=y;y.onResolve=e=>{Ps(b,e);const t=m.current,n=t.find(e=>e.key===i);if(n&&(!e.cancelled||"update"==n.phase)&&n.ctrl.idle){const e=t.every(e=>e.ctrl.idle);if("leave"==n.phase){const t=Ps(a,n.item);if(!1!==t){const r=!0===t?0:t;if(n.expired=!0,!e&&r>0)return void(r<=2147483647&&(n.expirationId=setTimeout(S,r)))}}e&&t.some(e=>e.expired)&&(k.current.delete(n),l&&(T.current=!0),S())}};const _=cet(e.ctrl,y);"leave"===p&&l?k.current.set(e,{phase:p,springs:_,payload:y}):C.set(e,{phase:p,springs:_,payload:y})});const R=_.useContext(det),I=UZe(R),x=R!==I&&YZe(R);mg(()=>{x&&wt(f,e=>{e.ctrl.start({default:R})})},[R]),wt(C,(e,t)=>{if(k.current.size){const e=f.findIndex(e=>e.key===t.key);f.splice(e,1)}}),mg(()=>{wt(k.current.size?k.current:C,({phase:e,payload:t},n)=>{const{ctrl:r}=n;n.phase=e,null==h||h.add(r),x&&"enter"==e&&r.start({default:R}),t&&(XZe(r,t.ref),!r.ref&&!h||T.current?(r.start(t),T.current&&(T.current=!1)):r.update(t))})},i?void 0:n);const P=e=>_.createElement(_.Fragment,null,f.map((t,n)=>{const{springs:r}=C.get(t)||t.ctrl,i=e({...r},t.item,t,n);return i&&i.type?_.createElement(i.type,{...i.props,key:Ce.str(t.key)||Ce.num(t.key)?t.key:t.ctrl.id,ref:i.ref}):i}));return h?[P,h]:P}var pet=1;function met(e,{key:t,keys:n=t},r){if(null===n){const t=new Set;return e.map(e=>{const n=r&&r.find(n=>n.item===e&&"leave"!==n.phase&&!t.has(n));return n?(t.add(n),n.key):pet++})}return Ce.und(n)?e:Ce.fun(n)?e.map(n):us(n)}var get=class extends gD{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=Kb(...t);const n=this._get(),r=pP(n);fD(this,r.create(n))}advance(e){const t=this._get();Xl(t,this.get())||($c(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&ZW(this._active)&&zx(this)}_get(){const e=Ce.arr(this.source)?this.source.map(Ls):us(Ls(this.source));return this.calc(...e)}_start(){this.idle&&!ZW(this._active)&&(this.idle=!1,wt(HR(this),e=>{e.done=!1}),oc.skipAnimation?(yt.batchedUpdates(()=>this.advance()),zx(this)):jR.start(this))}_attach(){let e=1;wt(us(this.source),t=>{ra(t)&&l1(t,this),vP(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){wt(us(this.source),e=>{ra(e)&&Yb(e,this)}),this._active.clear(),zx(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=us(this.source).reduce((e,t)=>Math.max(e,(vP(t)?t.priority:0)+1),0))}};function vet(e){return!1!==e.idle}function ZW(e){return!e.size||Array.from(e).every(vet)}function zx(e){e.idle||(e.idle=!0,wt(HR(e),e=>{e.done=!0}),Wb(e,{type:"idle",parent:e}))}oc.assign({createStringInterpolator:fhe,to:(e,t)=>new get(e,t)});var Ohe=/^--/;function yet(e,t){return null==t||"boolean"==typeof t||""===t?"":"number"!=typeof t||0===t||Ohe.test(e)||Xy.hasOwnProperty(e)&&Xy[e]?(""+t).trim():t+"px"}var eY={};function bet(e,t){if(!e.nodeType||!e.setAttribute)return!1;const n="filter"===e.nodeName||e.parentNode&&"filter"===e.parentNode.nodeName,{className:r,style:i,children:o,scrollTop:s,scrollLeft:a,viewBox:l,...c}=t,u=Object.values(c),d=Object.keys(c).map(t=>n||e.hasAttribute(t)?t:eY[t]||(eY[t]=t.replace(/([A-Z])/g,e=>"-"+e.toLowerCase())));void 0!==o&&(e.textContent=o);for(const t in i)if(i.hasOwnProperty(t)){const n=yet(t,i[t]);Ohe.test(t)?e.style.setProperty(t,n):e.style[t]=n}d.forEach((t,n)=>{e.setAttribute(t,u[n])}),void 0!==r&&(e.className=r),void 0!==s&&(e.scrollTop=s),void 0!==a&&(e.scrollLeft=a),void 0!==l&&e.setAttribute("viewBox",l)}var Xy={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_et=(e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1),Eet=["Webkit","Ms","Moz","O"];Xy=Object.keys(Xy).reduce((e,t)=>(Eet.forEach(n=>e[_et(n,t)]=e[t]),e),Xy);var wet=/^(matrix|translate|scale|rotate|skew)/,Cet=/^(translate)/,Tet=/^(rotate|skew)/,Wx=(e,t)=>Ce.num(e)&&0!==e?e+t:e,Fw=(e,t)=>Ce.arr(e)?e.every(e=>Fw(e,t)):Ce.num(e)?e===t:parseFloat(e)===t,Ret=class extends qR{constructor({x:e,y:t,z:n,...r}){const i=[],o=[];(e||t||n)&&(i.push([e||0,t||0,n||0]),o.push(e=>[`translate3d(${e.map(e=>Wx(e,"px")).join(",")})`,Fw(e,0)])),ol(r,(e,t)=>{if("transform"===t)i.push([e||""]),o.push(e=>[e,""===e]);else if(wet.test(t)){if(delete r[t],Ce.und(e))return;const n=Cet.test(t)?"px":Tet.test(t)?"deg":"";i.push(us(e)),o.push("rotate3d"===t?([e,t,r,i])=>[`rotate3d(${e},${t},${r},${Wx(i,n)})`,Fw(i,0)]:e=>[`${t}(${e.map(e=>Wx(e,n)).join(",")})`,Fw(e,t.startsWith("scale")?1:0)])}}),i.length&&(r.transform=new Iet(i,o)),super(r)}},Iet=class extends lhe{constructor(e,t){super(),this.inputs=e,this.transforms=t,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return wt(this.inputs,(n,r)=>{const i=Ls(n[0]),[o,s]=this.transforms[r](Ce.arr(i)?i:n.map(Ls));e+=" "+o,t=t&&s}),t?"none":e}observerAdded(e){1==e&&wt(this.inputs,e=>wt(e,e=>ra(e)&&l1(e,this)))}observerRemoved(e){0==e&&wt(this.inputs,e=>wt(e,e=>ra(e)&&Yb(e,this)))}eventObserved(e){"change"==e.type&&(this._value=null),Wb(this,e)}},ket=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];oc.assign({batchedUpdates:jv.unstable_batchedUpdates,createStringInterpolator:fhe,colors:fZe});var xet=qZe(ket,{applyAnimatedValues:bet,createAnimatedStyle:e=>new Ret(e),getComponentProps:({scrollTop:e,scrollLeft:t,...n})=>n}),Mhe=xet.animated;const Aet="_media_1yzvo_8",Let="_mirror_1yzvo_27",Pet="_bg_1yzvo_39",Oet="_avatar_1yzvo_47",Met="_fg_1yzvo_72",Det="_nameTag_1yzvo_86",Net="_status_1yzvo_103",Uet="_reactions_1yzvo_122",jet="_name_1yzvo_86",Fet="_errorIcon_1yzvo_141",Ma={media:Aet,mirror:Let,bg:Pet,avatar:Oet,fg:Met,nameTag:Det,status:Net,reactions:Uet,name:jet,errorIcon:Fet},$et="_reactionIndicatorWidget_14f9a_1",Bet="_reactionIndicatorWidgetLarge_14f9a_21",Het="_reactionLarge_14f9a_28",Vet="_reaction_14f9a_1",EE={reactionIndicatorWidget:$et,reactionIndicatorWidgetLarge:Bet,reactionLarge:Het,reaction:Vet};function Dhe({emoji:e,miniature:t,children:n}){const{t:r}=Je();return w.jsxs("div",{className:Ne(EE.reactionIndicatorWidget,{[EE.reactionIndicatorWidgetLarge]:!t}),children:[w.jsx("div",{className:Ne(EE.reaction,{[EE.reactionLarge]:!t}),children:w.jsx("span",{role:"img","aria-label":r("common.reaction"),children:e})}),n]})}function qet({raisedHandTime:e,miniature:t,showTimer:n,onClick:r}){const{t:i}=Je(),[o,s]=_.useState(""),a=_.useMemo(()=>new Intl.DurationFormat(void 0,{minutesDisplay:"always",secondsDisplay:"always",hoursDisplay:"auto",style:"digital"}),[]),l=_.useCallback(e=>{r&&(e.preventDefault(),r())},[r]);if(_.useEffect(()=>{if(!e||!n)return;const t=()=>{const t=Math.ceil(((new Date).getTime()-e.getTime())/1e3);s(a.format({seconds:t%60,minutes:Math.floor(t/60)}))};t();const r=setInterval(t,1e3);return()=>clearInterval(r)},[s,e,n,a]),!e)return;const c=w.jsx(Dhe,{emoji:"✋",miniature:t,children:n&&w.jsx("p",{children:o})});return r?w.jsx("button",{"aria-label":i("action.lower_hand"),style:{display:"contents",background:"none"},onClick:l,children:c}):c}const Get="_modal_13thw_8",Ket="_statsPill_13thw_12",tY={modal:Get,statsPill:Ket},zet=({audio:e,video:t,...n})=>{const[r,i]=_.useState(!1),[o,s]=_.useState("none"),a=e=>{i(!0),s(e)};return w.jsxs("div",{className:Ne(Ma.nameTag,tY.statsPill),children:[w.jsx(Lp,{title:"RTC Connection Stats",open:r,onDismiss:()=>{i(!1),s("none")},children:w.jsx("div",{className:tY.modal,children:w.jsx("pre",{children:"none"!==o&&JSON.stringify("video"===o?t:e,null,2)})})}),e&&w.jsx("div",{children:w.jsx(Ft,{onClick:()=>a("audio"),size:"sm",kind:"tertiary",Icon:$M,children:"jitter"in e&&"number"==typeof e.jitter&&w.jsxs(on,{as:"span",size:"xs",title:"jitter",children:[" ",(1e3*e.jitter).toFixed(0),"ms"]})})}),t&&w.jsx("div",{children:w.jsxs(Ft,{onClick:()=>a("video"),size:"sm",kind:"tertiary",Icon:zoe,children:[!(null==t||!t.framesPerSecond)&&w.jsxs(on,{as:"span",size:"xs",title:"frame rate",children:[" ",t.framesPerSecond.toFixed(0),"fps"]}),"jitter"in t&&"number"==typeof t.jitter&&w.jsxs(on,{as:"span",size:"xs",title:"jitter",children:[" ",(1e3*t.jitter).toFixed(0),"ms"]}),"frameHeight"in t&&"number"==typeof t.frameHeight&&"frameWidth"in t&&"number"==typeof t.frameWidth&&w.jsxs(on,{as:"span",size:"xs",title:"frame size",children:[" ",t.frameWidth,"x",t.frameHeight]}),"qualityLimitationReason"in t&&"string"==typeof t.qualityLimitationReason&&"none"!==t.qualityLimitationReason&&w.jsxs(on,{as:"span",size:"xs",title:"quality limitation reason",children:[" ",t.qualityLimitationReason]})]})})]})},J_=({ref:e,className:t,style:n,targetWidth:r,targetHeight:i,video:o,videoFit:s,mirror:a,member:l,videoEnabled:c,unencryptedWarning:u,nameTagLeadingIcon:d,displayName:h,primaryButton:p,encryptionStatus:f,raisedHandTime:m,currentReaction:v,raisedHandOnClick:g,localParticipant:y,audioStreamStats:b,videoStreamStats:_,...S})=>{const{t:E}=Je(),[C]=Bn(hle),k=Math.round(Math.min(r,i)/2);return w.jsxs(Mhe.div,{className:Ne(Ma.media,t,{[Ma.mirror]:a}),style:n,ref:e,"data-testid":"videoTile","data-video-fit":s,...S,children:[w.jsxs("div",{className:Ma.bg,children:[w.jsx(Qv,{id:(null==l?void 0:l.userId)??h,name:h,size:k,src:null==l?void 0:l.getMxcAvatarUrl(),className:Ma.avatar,style:{display:o&&c?"none":"initial"}}),void 0!==(null==o?void 0:o.publication)&&w.jsx(WJe,{trackRef:o,tabIndex:-1,disablePictureInPicture:!0,style:{display:o&&c?"block":"none"},"data-testid":"video"})]}),w.jsxs("div",{className:Ma.fg,children:[w.jsxs("div",{className:Ma.reactions,children:[w.jsx(qet,{raisedHandTime:m,miniature:k<96,showTimer:C,onClick:g}),v&&w.jsx(Dhe,{miniature:k<96,emoji:v.emoji})]}),!o&&!y&&w.jsx("div",{className:Ma.status,children:E("video_tile.waiting_for_media")}),(b||_)&&w.jsx(zet,{audio:b,video:_}),w.jsxs("div",{className:Ma.nameTag,children:[d,w.jsx(on,{as:"span",size:"sm",weight:"medium",className:Ma.name,"data-testid":"name_tag",children:h}),u&&w.jsx(Fi,{label:E("common.unencrypted"),placement:"bottom",isTriggerInteractive:!1,children:w.jsx(vT,{width:20,height:20,className:Ma.errorIcon,role:"img","aria-label":E("common.unencrypted")})})]}),p]})]})};J_.displayName="MediaView";const Q_=(...e)=>_.useCallback(t=>e.forEach(e=>{"function"==typeof e?e(t):e&&(e.current=t)}),e),vD=({ref:e,vm:t,showSpeakingIndicators:n,locallyMuted:r,primaryButton:i,menuStart:o,menuEnd:s,className:a,displayName:l,...c})=>{const{toggleRaisedHand:u}=L8(),{t:d}=Je(),h=ct(t.video$),p=ct(t.unencryptedWarning$),f=ct(t.encryptionStatus$),m=Ci(t.audioStreamStats$),v=Ci(t.videoStreamStats$),g=ct(t.audioEnabled$),y=ct(t.videoEnabled$),b=ct(t.speaking$),S=ct(t.cropVideo$),E=_.useCallback(e=>{e.preventDefault(),t.toggleFitContain()},[t]),C=ct(t.handRaised$),k=ct(t.reaction$),T=r?WMe:g?$M:Roe,R=d(r?"video_tile.muted_for_me":g?"microphone_on":"microphone_off"),[I,x]=_.useState(!1),P=w.jsxs(w.Fragment,{children:[o,w.jsx(jM,{Icon:boe,label:d("video_tile.change_fit_contain"),checked:S,onSelect:E}),s]}),L=t.local?()=>{u()}:void 0,M=n&&b,O=w.jsx(J_,{ref:e,video:h,member:t.member,unencryptedWarning:p,encryptionStatus:f,videoEnabled:y,videoFit:S?"cover":"contain",className:Ne(a,hg.tile,{[hg.speaking]:M,[hg.handRaised]:!M&&C}),nameTagLeadingIcon:w.jsx(T,{width:20,height:20,"aria-label":R,"data-muted":r||!g,className:hg.muteIcon}),displayName:l,primaryButton:i??w.jsx(xM,{open:I,onOpenChange:x,title:l,trigger:w.jsx("button",{"aria-label":d("common.options"),children:w.jsx(NMe,{"aria-hidden":!0,width:20,height:20})}),side:"left",align:"start",children:P}),raisedHandTime:C??void 0,currentReaction:k??void 0,raisedHandOnClick:L,localParticipant:t.local,audioStreamStats:m,videoStreamStats:v,...c});return w.jsx(hPe,{title:l,trigger:O,hasAccessibleAlternative:!0,children:P})};vD.displayName="UserMediaTile";const Nhe=({ref:e,vm:t,onOpenProfile:n,...r})=>{const{t:i}=Je(),o=ct(t.mirror$),s=ct(t.alwaysShow$),a=ct(t.switchCamera$),l=xf(s),c=_.useCallback(e=>{e.preventDefault(),t.setAlwaysShow(!l.current)},[t,l]);return w.jsx(vD,{ref:e,vm:t,locallyMuted:!1,mirror:o,primaryButton:null===a?void 0:w.jsx("button",{className:hg.switchCamera,"aria-label":i("switch_camera"),onClick:a,children:w.jsx(HMe,{"aria-hidden":!0,width:20,height:20})}),menuStart:w.jsx(jM,{Icon:HOe,label:i("video_tile.always_show"),checked:s,onSelect:c}),menuEnd:n&&w.jsx(fv,{Icon:qoe,label:i("common.profile"),onSelect:n}),...r})};Nhe.displayName="LocalUserMediaTile";const Uhe=({ref:e,vm:t,...n})=>{const{t:r}=Je(),i=ct(t.locallyMuted$),o=ct(t.localVolume$),s=_.useCallback(e=>{e.preventDefault(),t.toggleLocallyMuted()},[t]),a=_.useCallback(e=>t.setLocalVolume(e),[t]),l=_.useCallback(()=>t.commitLocalVolume(),[t]),c=i?YMe:JMe;return w.jsx(vD,{ref:e,vm:t,locallyMuted:i,mirror:!1,menuStart:w.jsxs(w.Fragment,{children:[w.jsx(jM,{Icon:MMe,label:r("video_tile.mute_for_me"),checked:i,onSelect:s}),w.jsx(fv,{as:"div",Icon:c,label:null,onSelect:null,children:w.jsx(iue,{className:hg.volumeSlider,label:r("video_tile.volume"),value:o,onValueChange:a,onValueCommit:l,min:0,max:1,step:.01})})]}),...n})};Uhe.displayName="RemoteUserMediaTile";const jhe=({ref:e,vm:t,onOpenProfile:n,...r})=>{const i=_.useRef(null),o=Q_(i,e),s=ct(t.media$),a=ct(s.displayName$);return s instanceof xv?w.jsx(Nhe,{ref:o,vm:s,onOpenProfile:n,displayName:a,...r}):w.jsx(Uhe,{ref:o,vm:s,displayName:a,...r})};jhe.displayName="GridTile";const Wet=({rageshakeRequestId:e,roomId:t,open:n,onDismiss:r})=>{const{t:i}=Je(),{submitRageshake:o,sending:s,sent:a,error:l}=ZT();return _.useEffect(()=>{a&&r()},[a,r]),w.jsxs(Lp,{title:i("rageshake_request_modal.title"),open:n,onDismiss:r,children:[w.jsx(on,{children:i("rageshake_request_modal.body")}),w.jsx(St,{children:w.jsx(Ft,{onClick:()=>{o({sendLogs:!0,rageshakeRequestId:e,roomId:t})},disabled:s,children:i(s?"rageshake_sending_logs":"rageshake_send_logs")})}),l&&w.jsx(St,{children:w.jsx(jf,{error:l})})]})};function nY(e){return new Worker(""+new URL("livekit-client.e2ee.worker-A85U9y1_.js",import.meta.url).href,{name:null==e?void 0:e.name})}const Yet={audioPreset:fC.music,dtx:!0,red:!1,forceStereo:!1,simulcast:!0,videoSimulcastLayers:[zc.h180,zc.h360],screenShareEncoding:eT.h1080fps30.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",videoEncoding:zc.h720.encoding,backupCodec:{codec:"vp8",encoding:zc.h720.encoding}},Yx={adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:zc.h720.resolution},publishDefaults:Yet,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new gZ,disconnectOnPageLeave:!0,webAudioMix:!1};function Xet(e){const t=_.useRef(void 0);return dp(e,yi.MembershipsChanged,_.useCallback(()=>{const n=e.getActiveFocus();if(n&&UJ(n)&&!df(n,t.current)){const r=e.getOldestMembership();M.info(`Got new active focus from membership: ${null==r?void 0:r.sender}/${null==r?void 0:r.deviceId}.\n          Updated focus (focus switch) from ${JSON.stringify(t.current)} to ${JSON.stringify(n)}`),t.current=n}return t.current},[e]))}function Jet(){const[e,t]=_.useState(null),n=_.useMemo(()=>({showErrorBoundary:e=>t(e)}),[]);if(e)throw e;return n}const pt=e=>"string"==typeof e,ty=()=>{let e,t;const n=new Promise((n,r)=>{e=n,t=r});return n.resolve=e,n.reject=t,n},rY=e=>null==e?"":""+e,Qet=(e,t,n)=>{e.forEach(e=>{t[e]&&(n[e]=t[e])})},Zet=/###/g,iY=e=>e&&e.indexOf("###")>-1?e.replace(Zet,"."):e,sY=e=>!e||pt(e),Jy=(e,t,n)=>{const r=pt(t)?t.split("."):t;let i=0;for(;i<r.length-1;){if(sY(e))return{};const t=iY(r[i]);!e[t]&&n&&(e[t]=new n),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++i}return sY(e)?{}:{obj:e,k:iY(r[i])}},oY=(e,t,n)=>{const{obj:r,k:i}=Jy(e,t,Object);if(void 0!==r||1===t.length)return void(r[i]=n);let o=t[t.length-1],s=t.slice(0,t.length-1),a=Jy(e,s,Object);for(;void 0===a.obj&&s.length;)o=`${s[s.length-1]}.${o}`,s=s.slice(0,s.length-1),a=Jy(e,s,Object),null!=a&&a.obj&&typeof a.obj[`${a.k}.${o}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${o}`]=n},ett=(e,t,n,r)=>{const{obj:i,k:o}=Jy(e,t,Object);i[o]=i[o]||[],i[o].push(n)},I3=(e,t)=>{const{obj:n,k:r}=Jy(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,r))return n[r]},ttt=(e,t,n)=>{const r=I3(e,n);return void 0!==r?r:I3(t,n)},Fhe=(e,t,n)=>{for(const r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?pt(e[r])||e[r]instanceof String||pt(t[r])||t[r]instanceof String?n&&(e[r]=t[r]):Fhe(e[r],t[r],n):e[r]=t[r]);return e},Hm=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var ntt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const rtt=e=>pt(e)?e.replace(/[&<>"'\/]/g,e=>ntt[e]):e;class itt{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}const stt=[" ",",","?","!",";"],ott=new itt(20),att=(e,t,n)=>{t=t||"",n=n||"";const r=stt.filter(e=>t.indexOf(e)<0&&n.indexOf(e)<0);if(0===r.length)return!0;const i=ott.getRegExp(`(${r.map(e=>"?"===e?"\\?":e).join("|")})`);let o=!i.test(e);if(!o){const t=e.indexOf(n);t>0&&!i.test(e.substring(0,t))&&(o=!0)}return o},yP=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const r=t.split(n);let i=e;for(let e=0;e<r.length;){if(!i||"object"!=typeof i)return;let t,o="";for(let s=e;s<r.length;++s)if(s!==e&&(o+=n),o+=r[s],t=i[o],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&s<r.length-1)continue;e+=s-e+1;break}i=t}return i},k3=e=>null==e?void 0:e.replace("_","-"),ctt={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var n,r;null==(r=null==(n=null==console?void 0:console[e])?void 0:n.apply)||r.call(n,console,t)}};class x3{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||ctt,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,r){return r&&!this.debug?null:(pt(e[0])&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new x3(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new x3(this.logger,e)}}var Xc=new x3;class GR{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const n=this.observers[e].get(t)||0;this.observers[e].set(t,n+1)}),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(e=>{let[t,r]=e;for(let e=0;e<r;e++)t(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(t=>{let[r,i]=t;for(let t=0;t<i;t++)r.apply(r,[e,...n])})}}class aY extends GR{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n){var r,i;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator,a=void 0!==o.ignoreJSONStructure?o.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],n&&(Array.isArray(n)?l.push(...n):pt(n)&&s?l.push(...n.split(s)):l.push(n)));const c=I3(this.data,l);return!c&&!t&&!n&&e.indexOf(".")>-1&&(e=l[0],t=l[1],n=l.slice(2).join(".")),!c&&a&&pt(n)?yP(null==(i=null==(r=this.data)?void 0:r[e])?void 0:i[t],n,s):c}addResource(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const o=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator;let s=[e,t];n&&(s=s.concat(o?n.split(o):n)),e.indexOf(".")>-1&&(s=e.split("."),r=t,t=s[1]),this.addNamespaces(t),oY(this.data,s,r),i.silent||this.emit("added",e,t,n,r)}addResources(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const r in n)(pt(n[r])||Array.isArray(n[r]))&&this.addResource(e,t,r,n[r],{silent:!0});r.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),r=n,n=t,t=s[1]),this.addNamespaces(t);let a=I3(this.data,s)||{};o.skipCopy||(n=JSON.parse(JSON.stringify(n))),r?Fhe(a,n,i):a={...a,...n},oY(this.data,s,a),o.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var $he={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,r,i){return e.forEach(e=>{var o;t=(null==(o=this.processors[e])?void 0:o.process(t,n,r,i))??t}),t}};const cY={},lY=e=>!pt(e)&&"boolean"!=typeof e&&"number"!=typeof e;class A3 extends GR{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Qet(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=Xc.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const n=this.resolve(e,t);return void 0!==(null==n?void 0:n.res)}extractFromKey(e,t){let n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");const r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const o=n&&e.indexOf(n)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||att(e,n,r));if(o&&!s){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:pt(i)?[i]:i};const o=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(o[0])>-1)&&(i=o.shift()),e=o.join(r)}return{key:e,namespaces:pt(i)?[i]:i}}translate(e,t,n){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const r=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:o,namespaces:s}=this.extractFromKey(e[e.length-1],t),a=s[s.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===(null==l?void 0:l.toLowerCase())){if(c){const e=t.nsSeparator||this.options.nsSeparator;return r?{res:`${a}${e}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:a,usedParams:this.getUsedParamsDetails(t)}:`${a}${e}${o}`}return r?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:a,usedParams:this.getUsedParamsDetails(t)}:o}const u=this.resolve(e,t);let d=null==u?void 0:u.res;const h=(null==u?void 0:u.usedKey)||o,p=(null==u?void 0:u.exactUsedKey)||o,f=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,m=!this.i18nFormat||this.i18nFormat.handleAsObject,v=void 0!==t.count&&!pt(t.count),g=A3.hasDefaultValue(t),y=v?this.pluralResolver.getSuffix(l,t.count,t):"",b=t.ordinal&&v?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",w=v&&!t.ordinal&&0===t.count,_=w&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${y}`]||t[`defaultValue${b}`]||t.defaultValue;let S=d;m&&!d&&g&&(S=_);const E=lY(S),C=Object.prototype.toString.apply(S);if(!(m&&S&&E&&["[object Number]","[object Function]","[object RegExp]"].indexOf(C)<0)||pt(f)&&Array.isArray(S))if(m&&pt(f)&&Array.isArray(d))d=d.join(f),d&&(d=this.extendTranslation(d,e,t,n));else{let r=!1,s=!1;!this.isValidLookup(d)&&g&&(r=!0,d=_),this.isValidLookup(d)||(s=!0,d=o);const c=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&s?void 0:d,h=g&&_!==d&&this.options.updateMissing;if(s||r||h){if(this.logger.log(h?"updateKey":"missingKey",l,a,o,h?_:d),i){const e=this.resolve(o,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const n=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&n&&n[0])for(let t=0;t<n.length;t++)e.push(n[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const r=(e,n,r)=>{var i;const o=g&&r!==d?r:c;this.options.missingKeyHandler?this.options.missingKeyHandler(e,a,n,o,h,t):null!=(i=this.backendConnector)&&i.saveMissing&&this.backendConnector.saveMissing(e,a,n,o,h,t),this.emit("missingKey",e,a,n,d)};this.options.saveMissing&&(this.options.saveMissingPlurals&&v?e.forEach(e=>{const n=this.pluralResolver.getSuffixes(e,t);w&&t[`defaultValue${this.options.pluralSeparator}zero`]&&n.indexOf(`${this.options.pluralSeparator}zero`)<0&&n.push(`${this.options.pluralSeparator}zero`),n.forEach(n=>{r([e],o+n,t[`defaultValue${n}`]||_)})}):r(e,o,_))}d=this.extendTranslation(d,e,t,u,n),s&&d===o&&this.options.appendNamespaceToMissingKey&&(d=`${a}:${o}`),(s||r)&&this.options.parseMissingKeyHandler&&(d=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${a}:${o}`:o,r?d:void 0))}else{if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(h,S,{...t,ns:s}):`key '${o} (${this.language})' returned an object instead of string.`;return r?(u.res=e,u.usedParams=this.getUsedParamsDetails(t),u):e}if(i){const e=Array.isArray(S),n=e?[]:{},r=e?p:h;for(const e in S)if(Object.prototype.hasOwnProperty.call(S,e)){const o=`${r}${i}${e}`;n[e]=g&&!d?this.translate(o,{...t,defaultValue:lY(_)?_[e]:void 0,joinArrays:!1,ns:s}):this.translate(o,{...t,joinArrays:!1,ns:s}),n[e]===o&&(n[e]=S[e])}d=n}}return r?(u.res=d,u.usedParams=this.getUsedParamsDetails(t),u):d}extendTranslation(e,t,n,r,i){var o,s,a=this;if(null!=(o=this.i18nFormat)&&o.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const o=pt(e)&&(void 0!==(null==(s=null==n?void 0:n.interpolation)?void 0:s.skipOnVariables)?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(o){const t=e.match(this.interpolator.nestingRegexp);l=t&&t.length}let c=n.replace&&!pt(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,n.lng||this.language||r.usedLng,n),o){const t=e.match(this.interpolator.nestingRegexp);l<(t&&t.length)&&(n.nest=!1)}!n.lng&&r&&r.res&&(n.lng=this.language||r.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(null==i?void 0:i[0])!==r[0]||n.context?a.translate(...r,t):(a.logger.warn(`It seems you are nesting recursively key: ${r[0]} in key: ${t[0]}`),null)},n)),n.interpolation&&this.interpolator.reset()}const l=n.postProcess||this.options.postProcess,c=pt(l)?[l]:l;return null!=e&&null!=c&&c.length&&!1!==n.applyPostProcessor&&(e=$he.handle(c,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e){let t,n,r,i,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return pt(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(t))return;const a=this.extractFromKey(e,s),l=a.key;n=l;let c=a.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const u=void 0!==s.count&&!pt(s.count),d=u&&!s.ordinal&&0===s.count,h=void 0!==s.context&&(pt(s.context)||"number"==typeof s.context)&&""!==s.context,p=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);c.forEach(e=>{var a,c;this.isValidLookup(t)||(o=e,!cY[`${p[0]}-${e}`]&&null!=(a=this.utils)&&a.hasLoadedNamespace&&!(null!=(c=this.utils)&&c.hasLoadedNamespace(o))&&(cY[`${p[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${p.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(n=>{var o;if(this.isValidLookup(t))return;i=n;const a=[l];if(null!=(o=this.i18nFormat)&&o.addLookupKeys)this.i18nFormat.addLookupKeys(a,l,n,e,s);else{let e;u&&(e=this.pluralResolver.getSuffix(n,s.count,s));const t=`${this.options.pluralSeparator}zero`,r=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(u&&(a.push(l+e),s.ordinal&&0===e.indexOf(r)&&a.push(l+e.replace(r,this.options.pluralSeparator)),d&&a.push(l+t)),h){const n=`${l}${this.options.contextSeparator}${s.context}`;a.push(n),u&&(a.push(n+e),s.ordinal&&0===e.indexOf(r)&&a.push(n+e.replace(r,this.options.pluralSeparator)),d&&a.push(n+t))}}let c;for(;c=a.pop();)this.isValidLookup(t)||(r=c,t=this.getResource(n,e,c,s))}))})}),{res:t,usedKey:n,exactUsedKey:r,usedLng:i,usedNS:o}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,n){var r;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return null!=(r=this.i18nFormat)&&r.getResource?this.i18nFormat.getResource(e,t,n,i):this.resourceStore.getResource(e,t,n,i)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&!pt(e.replace);let r=n?e.replace:e;if(n&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!n){r={...r};for(const e of t)delete r[e]}return r}static hasDefaultValue(e){const t="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}class uY{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Xc.create("languageUtils")}getScriptPartFromCode(e){if(!(e=k3(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=k3(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(pt(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const n=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(n))&&(t=n)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find(e=>e===n?e:e.indexOf("-")<0&&n.indexOf("-")<0||!(e.indexOf("-")>0&&n.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1)?void 0:e)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),pt(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){const n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],i=e=>{e&&(this.isSupportedCode(e)?r.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return pt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):pt(e)&&i(this.formatLanguageCode(e)),n.forEach(e=>{r.indexOf(e)<0&&i(this.formatLanguageCode(e))}),r}}const dY={zero:0,one:1,two:2,few:3,many:4,other:5},fY={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class ltt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Xc.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=k3("dev"===e?"en":e),r=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:n,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(n,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),fY;if(!e.match(/-|_/))return fY;const n=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(n,t)}return this.pluralRulesCache[i]=o,o}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),(null==n?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map(e=>`${t}${e}`)}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),n?n.resolvedOptions().pluralCategories.sort((e,t)=>dY[e]-dY[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=this.getRule(e,n);return r?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,n))}}const hY=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=ttt(e,t,n);return!o&&i&&pt(n)&&(o=yP(e,n,r),void 0===o&&(o=yP(t,n,r))),o},Xx=e=>e.replace(/\$/g,"$$$$");class utt{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=Xc.create("interpolator"),this.options=t,this.format=(null==(e=null==t?void 0:t.interpolation)?void 0:e.format)||(e=>e),this.init(t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:n,useRawValueToEscape:r,prefix:i,prefixEscaped:o,suffix:s,suffixEscaped:a,formatSeparator:l,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:d,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:f,nestingOptionsSeparator:m,maxReplaces:v,alwaysFormat:g}=e.interpolation;this.escape=void 0!==t?t:rtt,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==r&&r,this.prefix=i?Hm(i):o||"{{",this.suffix=s?Hm(s):a||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=d?Hm(d):h||Hm("$t("),this.nestingSuffix=p?Hm(p):f||Hm(")"),this.nestingOptionsSeparator=m||",",this.maxReplaces=v||1e3,this.alwaysFormat=void 0!==g&&g,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>(null==e?void 0:e.source)===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,n,r){var i;let o,s,a;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const i=hY(t,l,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(i,void 0,n,{...r,...t,interpolationkey:e}):i}const i=e.split(this.formatSeparator),o=i.shift().trim(),s=i.join(this.formatSeparator).trim();return this.format(hY(t,l,o,this.options.keySeparator,this.options.ignoreJSONStructure),s,n,{...r,...t,interpolationkey:o})};this.resetRegExp();const u=(null==r?void 0:r.missingInterpolationHandler)||this.options.missingInterpolationHandler,d=void 0!==(null==(i=null==r?void 0:r.interpolation)?void 0:i.skipOnVariables)?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>Xx(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?Xx(this.escape(e)):Xx(e)}].forEach(t=>{for(a=0;o=t.regex.exec(e);){const n=o[1].trim();if(s=c(n),void 0===s)if("function"==typeof u){const t=u(e,o,r);s=pt(t)?t:""}else if(r&&Object.prototype.hasOwnProperty.call(r,n))s="";else{if(d){s=o[0];continue}this.logger.warn(`missed to pass in variable ${n} for interpolating ${e}`),s=""}else!pt(s)&&!this.useRawValueToEscape&&(s=rY(s));const i=t.safeValue(s);if(e=e.replace(o[0],i),d?(t.regex.lastIndex+=s.length,t.regex.lastIndex-=o[0].length):t.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,t){let n,r,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=(e,t)=>{const n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;const r=e.split(new RegExp(`${n}[ ]*{`));let o=`{${r[1]}`;e=r[0],o=this.interpolate(o,i);const s=o.match(/'/g),a=o.match(/"/g);(((null==s?void 0:s.length)??0)%2==0&&!a||a.length%2!=0)&&(o=o.replace(/'/g,'"'));try{i=JSON.parse(o),t&&(i={...t,...i})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${n}${o}`}return i.defaultValue&&i.defaultValue.indexOf(this.prefix)>-1&&delete i.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let a=[];i={...o},i=i.replace&&!pt(i.replace)?i.replace:i,i.applyPostProcessor=!1,delete i.defaultValue;let l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){const e=n[1].split(this.formatSeparator).map(e=>e.trim());n[1]=e.shift(),a=e,l=!0}if(r=t(s.call(this,n[1].trim(),i),i),r&&n[0]===e&&!pt(r))return r;pt(r)||(r=rY(r)),r||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),r=""),l&&(r=a.reduce((e,t)=>this.format(e,t,o.lng,{...o,interpolationkey:n[1].trim()}),r.trim())),e=e.replace(n[0],r),this.regexp.lastIndex=0}return e}}const dtt=e=>{let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const r=e.split("(");t=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);"currency"===t&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):"relativetime"===t&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(e=>{if(e){const[t,...r]=e.split(":"),i=r.join(":").trim().replace(/^'+|'+$/g,""),o=t.trim();n[o]||(n[o]=i),"false"===i&&(n[o]=!1),"true"===i&&(n[o]=!0),isNaN(i)||(n[o]=parseInt(i,10))}})}return{formatName:t,formatOptions:n}},Vm=e=>{const t={};return(n,r,i)=>{let o=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(o={...o,[i.interpolationkey]:void 0});const s=r+JSON.stringify(o);let a=t[s];return a||(a=e(k3(r),i),t[s]=a),a(n)}};class ftt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=Xc.create("formatter"),this.options=e,this.formats={number:Vm((e,t)=>{const n=new Intl.NumberFormat(e,{...t});return e=>n.format(e)}),currency:Vm((e,t)=>{const n=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>n.format(e)}),datetime:Vm((e,t)=>{const n=new Intl.DateTimeFormat(e,{...t});return e=>n.format(e)}),relativetime:Vm((e,t)=>{const n=new Intl.RelativeTimeFormat(e,{...t});return e=>n.format(e,t.range||"day")}),list:Vm((e,t)=>{const n=new Intl.ListFormat(e,{...t});return e=>n.format(e)})},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Vm(t)}format(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(e=>e.indexOf(")")>-1)){const e=i.findIndex(e=>e.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,e)].join(this.formatSeparator)}return i.reduce((e,t)=>{var i;const{formatName:o,formatOptions:s}=dtt(t);if(this.formats[o]){let t=e;try{const a=(null==(i=null==r?void 0:r.formatParams)?void 0:i[r.interpolationkey])||{},l=a.locale||a.lng||r.locale||r.lng||n;t=this.formats[o](e,l,{...s,...r,...a})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${o}`),e},e)}}const htt=(e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)};class ptt extends GR{constructor(e,t,n){var r,i;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=o,this.logger=Xc.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=o.maxParallelReads||10,this.readingCalls=0,this.maxRetries=o.maxRetries>=0?o.maxRetries:5,this.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,this.state={},this.queue=[],null==(i=null==(r=this.backend)?void 0:r.init)||i.call(r,n,o.backend,o)}queueLoad(e,t,n,r){const i={},o={},s={},a={};return e.forEach(e=>{let r=!0;t.forEach(t=>{const s=`${e}|${t}`;!n.reload&&this.store.hasResourceBundle(e,t)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===o[s]&&(o[s]=!0):(this.state[s]=1,r=!1,void 0===o[s]&&(o[s]=!0),void 0===i[s]&&(i[s]=!0),void 0===a[t]&&(a[t]=!0)))}),r||(s[e]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(a)}}loaded(e,t,n){const r=e.split("|"),i=r[0],o=r[1];t&&this.emit("failedLoading",i,o,t),!t&&n&&this.store.addResourceBundle(i,o,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&n&&(this.state[e]=0);const s={};this.queue.forEach(n=>{ett(n.loaded,[i],o),htt(n,e),t&&n.errors.push(t),0===n.pendingCount&&!n.done&&(Object.keys(n.loaded).forEach(e=>{s[e]||(s[e]={});const t=n.loaded[e];t.length&&t.forEach(t=>{void 0===s[e][t]&&(s[e][t]=!0)})}),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(e=>!e.done)}read(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:r,wait:i,callback:o});this.readingCalls++;const s=(s,a)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}s&&a&&r<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,n,r+1,2*i,o)},i):o(s,a)},a=this.backend[n].bind(this.backend);if(2!==a.length)return a(e,t,s);try{const n=a(e,t);n&&"function"==typeof n.then?n.then(e=>s(null,e)).catch(s):s(null,n)}catch(e){s(e)}}prepareLoading(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();pt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),pt(t)&&(t=[t]);const i=this.queueLoad(e,t,n,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split("|"),r=n[0],i=n[1];this.read(r,i,"read",void 0,void 0,(n,o)=>{n&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,n),!n&&o&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,o),this.loaded(e,n,o)})}saveMissing(e,t,n,r,i){var o,s,a,l,c;let u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(null==(s=null==(o=this.services)?void 0:o.utils)||!s.hasLoadedNamespace||null!=(l=null==(a=this.services)?void 0:a.utils)&&l.hasLoadedNamespace(t)){if(null!=n&&""!==n){if(null!=(c=this.backend)&&c.create){const o={...u,isUpdate:i},s=this.backend.create.bind(this.backend);if(s.length<6)try{let i;i=5===s.length?s(e,t,n,r,o):s(e,t,n,r),i&&"function"==typeof i.then?i.then(e=>d(null,e)).catch(d):d(null,i)}catch(e){d(e)}else s(e,t,n,r,d,o)}!e||!e[0]||this.store.addResource(e[0],t,n,r)}}else this.logger.warn(`did not save key "${n}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const pY=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),pt(e[1])&&(t.defaultValue=e[1]),pt(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const n=e[3]||e[2];Object.keys(n).forEach(e=>{t[e]=n[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),mY=e=>{var t,n;return pt(e.ns)&&(e.ns=[e.ns]),pt(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),pt(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),(null==(n=null==(t=e.supportedLngs)?void 0:t.indexOf)?void 0:n.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e},wE=()=>{},mtt=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(t=>{"function"==typeof e[t]&&(e[t]=e[t].bind(e))})};class Zb extends GR{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=mY(e),this.services={},this.logger=Xc,this.modules={external:[]},mtt(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(n=t,t={}),null==t.defaultNS&&t.ns&&(pt(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=pY();this.options={...r,...this.options,...mY(t)},this.options.interpolation={...r.interpolation,...this.options.interpolation},void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const i=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?Xc.init(i(this.modules.logger),this.options):Xc.init(null,this.options),t=this.modules.formatter?this.modules.formatter:ftt;const n=new uY(this.options);this.store=new aY(this.options.resources,this.options);const o=this.services;o.logger=Xc,o.resourceStore=this.store,o.languageUtils=n,o.pluralResolver=new ltt(n,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),t&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(o.formatter=i(t),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new utt(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new ptt(i(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit(t,...r)}),this.modules.languageDetector&&(o.languageDetector=i(this.modules.languageDetector),o.languageDetector.init&&o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=i(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new A3(this.services,this.options),this.translator.on("*",function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit(t,...r)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,n||(n=wE),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=function(){return e.store[t](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=function(){return e.store[t](...arguments),e}});const o=ty(),s=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(t),n(e,t)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?s():setTimeout(s,0),o}loadResources(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wE;const i=pt(e)?e:this.language;if("function"==typeof e&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===(null==i?void 0:i.toLowerCase())&&(!this.options.preload||0===this.options.preload.length))return r();const e=[],o=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};i?o(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>o(e)),null==(n=null==(t=this.options.preload)?void 0:t.forEach)||n.call(t,e=>o(e)),this.services.backendConnector.load(e,this.options.ns,e=>{!e&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(e)})}else r(null)}reloadResources(e,t,n){const r=ty();return"function"==typeof e&&(n=e,e=void 0),"function"==typeof t&&(n=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),n||(n=wE),this.services.backendConnector.reload(e,t,e=>{r.resolve(),n(e)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&$he.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,t){var n=this;this.isLanguageChangingTo=e;const r=ty();this.emit("languageChanging",e);const i=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},o=(e,o)=>{o?(i(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,r.resolve(function(){return n.t(...arguments)}),t&&t(e,function(){return n.t(...arguments)})},s=t=>{var n,r;!e&&!t&&this.services.languageDetector&&(t=[]);const s=pt(t)?t:this.services.languageUtils.getBestMatchFromCodes(t);s&&(this.language||i(s),this.translator.language||this.translator.changeLanguage(s),null==(r=null==(n=this.services.languageDetector)?void 0:n.cacheUserLanguage)||r.call(n,s)),this.loadResources(s,e=>{o(e,s)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e):s(this.services.languageDetector.detect()),r}getFixedT(e,t,n){var r=this;const i=function(e,t){let o;if("object"!=typeof t){for(var s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];o=r.options.overloadTranslationOptionHandler([e,t].concat(a))}else o={...t};o.lng=o.lng||i.lng,o.lngs=o.lngs||i.lngs,o.ns=o.ns||i.ns,""!==o.keyPrefix&&(o.keyPrefix=o.keyPrefix||n||i.keyPrefix);const c=r.options.keySeparator||".";let u;return u=o.keyPrefix&&Array.isArray(e)?e.map(e=>`${o.keyPrefix}${c}${e}`):o.keyPrefix?`${o.keyPrefix}${c}${e}`:e,r.t(u,o)};return pt(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=n,i}t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==(e=this.translator)?void 0:e.translate(...n)}exists(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==(e=this.translator)?void 0:e.exists(...n)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=t.lng||this.resolvedLanguage||this.languages[0],r=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;const o=(e,t)=>{const n=this.services.backendConnector.state[`${e}|${t}`];return-1===n||0===n||2===n};if(t.precheck){const e=t.precheck(this,o);if(void 0!==e)return e}return!!(this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(n,e)&&(!r||o(i,e)))}loadNamespaces(e,t){const n=ty();return this.options.ns?(pt(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){const n=ty();pt(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter(e=>r.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return i.length?(this.options.preload=r.concat(i),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}dir(e){var t,n;if(e||(e=this.resolvedLanguage||((null==(t=this.languages)?void 0:t.length)>0?this.languages[0]:this.language)),!e)return"rtl";const r=(null==(n=this.services)?void 0:n.languageUtils)||new uY(pY());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new Zb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wE;const n=e.forkResourceStore;n&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new Zb(r);if((void 0!==e.debug||void 0!==e.prefix)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(e=>{i[e]=this[e]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},n){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},Object.keys(e[t]).reduce((n,r)=>(n[r]={...e[t][r]},n),{})),{});i.store=new aY(e,r),i.services.resourceStore=i.store}return i.translator=new A3(i.services,r),i.translator.on("*",function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit(e,...n)}),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const $i=Zb.createInstance();$i.createInstance=Zb.createInstance,$i.createInstance,$i.dir,$i.init,$i.loadResources,$i.reloadResources,$i.use,$i.changeLanguage,$i.getFixedT;const xo=$i.t;$i.exists,$i.setDefaultNamespace,$i.hasLoadedNamespace,$i.loadNamespaces,$i.loadLanguages;var Bhe=(e=>(e.MISSING_MATRIX_RTC_FOCUS="MISSING_MATRIX_RTC_FOCUS",e.CONNECTION_LOST_ERROR="CONNECTION_LOST_ERROR",e.INSUFFICIENT_CAPACITY_ERROR="INSUFFICIENT_CAPACITY_ERROR",e.E2EE_NOT_SUPPORTED="E2EE_NOT_SUPPORTED",e.OPEN_ID_ERROR="OPEN_ID_ERROR",e.SFU_ERROR="SFU_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e))(Bhe||{}),$w=(e=>(e.CONFIGURATION_ISSUE="CONFIGURATION_ISSUE",e.NETWORK_CONNECTIVITY="NETWORK_CONNECTIVITY",e.CLIENT_CONFIGURATION="CLIENT_CONFIGURATION",e.UNKNOWN="UNKNOWN",e))($w||{});class vl extends Error{constructor(e,t,n,r,i){super(e,{cause:i}),this.localisedTitle=e,this.localisedMessage=r,this.category=n,this.code=t}}class gtt extends vl{constructor(e){super(xo("error.call_is_not_supported"),"MISSING_MATRIX_RTC_FOCUS","CONFIGURATION_ISSUE",xo("error.matrix_rtc_focus_missing",{domain:e,brand:"Element Call",errorCode:"MISSING_MATRIX_RTC_FOCUS"})),this.domain=e}}class yD extends vl{constructor(){super(xo("error.connection_lost"),"CONNECTION_LOST_ERROR","NETWORK_CONNECTIVITY",xo("error.connection_lost_description"))}}class vtt extends vl{constructor(){super(xo("error.e2ee_unsupported"),"E2EE_NOT_SUPPORTED","CLIENT_CONFIGURATION",xo("error.e2ee_unsupported_description"))}}class bD extends vl{constructor(e){super(xo("error.generic"),"UNKNOWN_ERROR","UNKNOWN",void 0,e)}}class Hhe extends vl{constructor(e){super(xo("error.generic"),"OPEN_ID_ERROR","CONFIGURATION_ISSUE",void 0,e)}}class ytt extends vl{constructor(){super(xo("error.insufficient_capacity"),"INSUFFICIENT_CAPACITY_ERROR","UNKNOWN",xo("error.insufficient_capacity_description"))}}class btt extends vl{constructor(){super(xo("error.room_creation_restricted"),"SFU_ERROR","CONFIGURATION_ISSUE",xo("error.room_creation_restricted_description"))}}function _tt(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&(e.jwt===t.jwt&&e.url===t.url)}function Stt(e,t){const[n,r]=_.useState(void 0),i=Xet(t),{showErrorBoundary:o}=Jet();return _.useEffect(()=>{i?Vhe(e,i).then(e=>{r(e)},e=>{o(new Hhe(e)),M.error("Failed to get SFU config",e)}):r(void 0)},[e,i,o]),n}async function Vhe(e,t){let n;try{n=await OYe(async()=>e.getOpenIdToken())}catch(e){throw new Hhe(e instanceof Error?e:new Error("Unknown error"))}M.debug("Got openID token",n);try{M.info(`Trying to get JWT from call's active focus URL of ${t.livekit_service_url}...`);const r=await Ett(e,t.livekit_service_url,t.livekit_alias,n);return M.info("Got JWT from call's active focus URL."),r}catch(e){return void M.warn(`Failed to get JWT from RTC session's active focus URL of ${t.livekit_service_url}.`,e)}}async function Ett(e,t,n,r){try{const i=await fetch(t+"/sfu/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room:n,openid_token:r,device_id:e.getDeviceId()})});if(!i.ok)throw new Error("SFU Config fetch failed with status code "+i.status);return await i.json()}catch(e){throw new Error("SFU Config fetch failed with exception "+e)}}class wtt{constructor(e=!1){this.aborted=e}abort(){this.aborted=!0}isAborted(){return this.aborted}}var bP=(e=>(e.ECSwitchingFocus="ec_switching_focus",e.ECWaiting="ec_waiting",e))(bP||{});function CE(e){return!(null==e||!e.url||null==e||!e.jwt)}async function Ctt(e,t,n,r,i){if(e.localParticipant.getTrackPublication(he.Source.Microphone))return M.warn("Pre-creating audio track but participant already appears to have an microphone track: this shouldn't happen!"),void R3e("Pre-creating audio track but participant already appears to have an microphone track!");let o;M.info("Pre-creating microphone track");try{const t=await e.localParticipant.createTracks({audio:{deviceId:r}});if(t.length<1?M.info("Tried to pre-create local audio track but got no tracks"):o=t[0],i.isAborted())return M.info("[Lifecycle] Signal Aborted: Pre-created audio track but connection aborted"),void(null==o||o.stop());M.info("Pre-created microphone track")}catch(e){M.error("Failed to pre-create microphone track",e)}if(!n&&(await(null==o?void 0:o.mute()),i.isAborted()))return M.info("[Lifecycle] Signal Aborted: Pre-created audio track but connection aborted"),void(null==o||o.stop());if(e.localParticipant.getTrackPublication(he.Source.Microphone))return M.warn("Pre-created audio track but participant already appears to have an microphone track: this shouldn't happen!"),void(null==o||o.stop());M.info("[Lifecycle] Connecting & publishing");try{if(await qhe(e,t,o,[]),i.isAborted())return M.info("[Lifecycle] Signal Aborted: Connected but operation was cancelled. Force disconnect"),void(null==e||e.disconnect().catch(e=>{M.error("Failed to disconnect from SFU",e)}))}catch(e){throw null==o||o.stop(),M.debug("Stopped precreated audio tracks."),e}}async function qhe(e,t,n,r){const i=Dt.instance.eventCallConnectDuration;i.cacheConnectStart(),e.once(ue.SignalConnected,i.cacheWsConnect);try{M.info(`[Lifecycle] Connecting to livekit room ${t.url} ...`),await e.connect(t.url,t.jwt),M.info("[Lifecycle] ... connected to livekit room")}catch(e){if(M.error("[Lifecycle] Failed to connect",e),e instanceof _n){if(503===e.status||200===e.status||429===e.status)throw new ytt;if(404===e.status)throw new btt}throw e}e.off(ue.SignalConnected,i.cacheWsConnect),i.track({log:!0}),n&&(M.info("Publishing precreated mic track"),await e.localParticipant.publishTrack(n,{source:he.Source.Microphone})),M.info(`Publishing ${r.length} precreated screenshare tracks`);for(const t of r)e.localParticipant.publishTrack(t,{source:he.Source.ScreenShare}).catch(e=>{M.error("Failed to publish screenshare track",e)})}function Ttt(e,t,n,r){const[i,o]=_.useState(r&&n?n.state:"ec_waiting"),[s,a]=_.useState(!1),[l,c]=_.useState(!1),[u,d]=_.useState(null);if(null!==u)throw u;const h=_.useCallback(e=>{e==Pt.Connected&&a(!1),o(e)},[]);_.useEffect(()=>{const e=n;return n&&n.on(ue.ConnectionStateChanged,h),()=>{e&&e.off(ue.ConnectionStateChanged,h)}},[n,h]);const p=_.useCallback(async()=>{const e=[];for(const t of n.localParticipant.videoTrackPublications.values())if(t.track&&t.source==he.Source.ScreenShare){const n=t.track.mediaStreamTrack.clone();n.enabled=!0,e.push(n)}a(!0),await(null==n?void 0:n.disconnect()),c(!0);try{await qhe(n,r,void 0,e)}finally{c(!1)}},[n,r]),f=_.useRef(Object.assign({},r)),m=_.useRef(new Set);return _.useEffect(()=>{const e=m.current;return()=>{e.forEach(e=>{e.abort()})}},[]),_.useEffect(()=>{var i;if(CE(r)&&CE(f.current)&&!_tt(f.current,r))M.info(`SFU config changed! URL was ${null==(i=f.current)?void 0:i.url} now ${null==r?void 0:r.url}`),p().catch(e=>{M.error("Failed to switch focus",e)});else if(!CE(f.current)&&CE(r)){c(!0);const i=new wtt;m.current.add(i),Ctt(n,r,t,e,i).catch(e=>{e instanceof vl?d(e):e instanceof Error?d(new bD(e)):M.error("Failed to connect to SFU",e)}).finally(()=>{m.current.delete(i),c(!1)})}f.current=Object.assign({},r)},[r,n,e,t,p]),s?"ec_switching_focus":l?Pt.Connecting:i}class Rtt extends XZ{constructor(){super({ratchetWindowSize:10,keyringSize:256}),this.onEncryptionKeyChanged=(e,t,n)=>{crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"]).then(e=>{var r;this.onSetEncryptionKey(e,n,t),M.debug(`Sent new key to livekit room=${null==(r=this.rtcSession)?void 0:r.room.roomId} participantId=${n} encryptionKeyIndex=${t}`)},e=>{var r;M.error(`Failed to create key material from buffer for livekit room=${null==(r=this.rtcSession)?void 0:r.room.roomId} participantId=${n} encryptionKeyIndex=${t}`,e)})}}setRTCSession(e){this.rtcSession&&this.rtcSession.off(yi.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession=e,this.rtcSession.on(yi.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession.reemitEncryptionKeys()}}function Itt(e,t,n,r){const{controlledAudioDevices:i}=Xs(),o=el(()=>t),s=Gu(),a=el(()=>{var e;return null==(e=Aw(s.audioInput.selected$))?void 0:e.id}),l=_.useRef(!1),c=_.useRef(!1),u=_.useRef({audio:o.audio.enabled,video:o.video.enabled}),{processor:d}=LR(),h=el(()=>{var e,t;let n;M.info("[LivekitRoom] Create LiveKit room"),r.kind===sn.PER_PARTICIPANT?(M.info("Created MatrixKeyProvider (per participant)"),n={keyProvider:new Rtt,worker:new nY}):r.kind===sn.SHARED_KEY&&r.secret&&(M.info("Created ExternalE2EEKeyProvider (shared key)"),n={keyProvider:new hSe,worker:new nY});const o={...Yx,videoCaptureDefaults:{...Yx.videoCaptureDefaults,deviceId:null==(e=Aw(s.videoInput.selected$))?void 0:e.id,processor:d},audioCaptureDefaults:{...Yx.audioCaptureDefaults,deviceId:a},audioOutput:{deviceId:i||null==(t=Aw(s.audioOutput.selected$))?void 0:t.id},e2ee:n},l=new Ru(o);return l.setE2EEEnabled(r.kind!==sn.NONE).catch(e=>{M.error("Failed to set E2EE enabled on room",e)}),l});_.useEffect(()=>{const t=h.options.e2ee;r.kind===sn.NONE||!t||!("keyProvider"in t)||(r.kind===sn.PER_PARTICIPANT?t.keyProvider.setRTCSession(e):r.kind===sn.SHARED_KEY&&r.secret&&t.keyProvider.setKey(r.secret).catch(e=>{M.error("Failed to set shared key for E2EE",e)}))},[h.options.e2ee,r,e]),rfe(Ci(j8(e=>e.pipe(Mt(([e])=>nD(e.localParticipant,he.Source.Camera)),ke(e=>{var t;const n=null==(t=null==e?void 0:e.publication)?void 0:t.track;return n instanceof nv?n:null})),[h])));const p=Ttt(a,o.audio.enabled,h,n);return _.useEffect(()=>{if(void 0!==h&&p===Pt.Connected){const n=h.localParticipant;let r;u.current={audio:t.audio.enabled,video:t.video.enabled},(e=r||(r={}))[e.Microphone=0]="Microphone",e[e.Camera=1]="Camera";const i=async(e,o)=>{var s,a,d,p;if(e>10)return void M.error("Stop trying to sync the input device with current mute state after 10 failed tries");let f,m,v;switch(o){case 0:f=n.isMicrophoneEnabled,m=u.current.audio,v=l.current;break;case 1:f=n.isCameraEnabled,m=u.current.video,v=c.current}if(f!==m&&!v)try{let t;switch(o){case 0:l.current=!0,t=await n.setMicrophoneEnabled(u.current.audio,h.options.audioCaptureDefaults),l.current=!1;break;case 1:c.current=!0,t=await n.setCameraEnabled(u.current.video,h.options.videoCaptureDefaults),c.current=!1}if(!t)throw new Error("track with new mute state could not be published");await new Promise(e=>setTimeout(e,100)),await i(e+1,o)}catch(n){"NotAllowedError"===n.name?(M.error("Fatal error while syncing mute state: resetting",n),0===o?(l.current=!1,null==(a=(s=t.audio).setEnabled)||a.call(s,!1)):(c.current=!1,null==(p=(d=t.video).setEnabled)||p.call(d,!1))):(M.error("Failed to sync audio mute state with LiveKit (will retry to sync in 1s):",n),setTimeout(()=>{i(e+1,o).catch(t=>{M.error(`Failed to sync ${r[o]} mute state with LiveKit iterCount=${e+1}`,t)})},1e3))}};i(0,0).catch(e=>{M.error("Failed to sync audio mute state with LiveKit",e)}),i(0,1).catch(e=>{M.error("Failed to sync video mute state with LiveKit",e)})}var e},[h,t,p]),_.useEffect(()=>{if(void 0!==h&&p===Pt.Connected){const e=(e,t)=>t.subscribe(t=>{M.info("[LivekitRoom] syncDevice room.getActiveDevice(kind) !== d.id :",h.getActiveDevice(e)," !== ",null==t?void 0:t.id),void 0!==t&&h.getActiveDevice(e)!==t.id&&h.switchActiveDevice(e,t.id).catch(t=>M.error(`Failed to sync ${e} device with LiveKit`,t))}),t=[e("audioinput",s.audioInput.selected$),i?void 0:e("audiooutput",s.audioOutput.selected$),e("videoinput",s.videoInput.selected$),s.audioInput.selected$.pipe(Mt(e=>(null==e?void 0:e.hardwareDeviceChange$)??sqe)).subscribe(()=>{var e,t,n;const r=null==(e=Array.from(h.localParticipant.audioTrackPublications.values()).find(e=>e.source===he.Source.Microphone))?void 0:e.track;r&&"ended"!==r.mediaStreamTrack.readyState&&(null==(n=null==(t=h.localParticipant.getTrackPublication(he.Source.Microphone))?void 0:t.audioTrack)||n.restartTrack().catch(e=>{M.error("Failed to restart audio device track",e)}))})];return()=>{for(const e of t)null==e||e.unsubscribe()}}},[h,s,p,i]),{connState:p,livekitRoom:h}}function ktt(){_.useEffect(()=>{if("wakeLock"in navigator){let e=!0,t=null;const n=()=>{"visible"===document.visibilityState&&navigator.wakeLock.request("screen").then(n=>{t=n,e||t.release().catch(e=>M.warn("Can't release wake lock",e))},e=>{M.warn("Can't acquire wake lock",e)})};return n(),document.addEventListener("visibilitychange",n),()=>{e=!1,null!==t&&t.release().catch(e=>M.warn("Can't release wake lock",e)),document.removeEventListener("visibilitychange",n)}}},[])}const xtt="_toggle_z1rxf_8",Att={toggle:xtt},Ltt=({layout:e,setLayout:t,className:n,onTouchEnd:r})=>{const{t:i}=Je(),o=_.useCallback(e=>t(e.target.value),[t]);return w.jsxs("div",{className:Ne(Att.toggle,n),children:[w.jsx(Fi,{label:i("layout_spotlight_label"),children:w.jsx("input",{type:"radio",name:"layout",value:"spotlight",checked:"spotlight"===e,onChange:o,onTouchEnd:r})}),w.jsx(BMe,{"aria-hidden":!0,width:24,height:24}),w.jsx(Fi,{label:i("layout_grid_label"),children:w.jsx("input",{type:"radio",name:"layout",value:"grid",checked:"grid"===e,onChange:o,onTouchEnd:r})}),w.jsx(xMe,{"aria-hidden":!0,width:24,height:24})]})};let Ptt=0;function Ott(){return(Ptt++).toString()}class Ghe extends W_{constructor(e){super(),this.media$=e,this.id=Ott()}}class Mtt extends W_{constructor(e,t){super(),this.media$=e,this.maximised$=t}}function Dtt(e,t){return{[Symbol.iterator](){const n=e[Symbol.iterator](),r=t[Symbol.iterator]();return{next(){let e;do{if(e=n.next(),!e.done&&void 0!==e.value)return e;const t=r.next();if(!t.done)return t}while(!e.done);return e}}}}}function TE(e){return e.map(e=>{var t;return(null==(t=e.media.member)?void 0:t.rawDisplayName)??"[👻]"})}let Bw=!1;R8.value$.subscribe(e=>Bw=e);class Ntt{get media(){return this.media$.value}set media(e){this.media$.next(e)}get maximised(){return this.maximised$.value}set maximised(e){this.maximised$.next(e)}constructor(e,t){this.media$=new ms(e),this.maximised$=new ms(t),this.vm=new Mtt(this.media$,this.maximised$)}destroy(){this.vm.destroy()}}class gY{get media(){return this.media$.value}set media(e){this.media$.next(e)}constructor(e){this.media$=new ms(e),this.vm=new Ghe(this.media$)}destroy(){this.vm.destroy()}}class L3{constructor(e,t,n){var r;this.spotlight=e,this.grid=t,this.generation=n,this.spotlightTile=null==(r=this.spotlight)?void 0:r.vm,this.gridTiles=this.grid.map(({vm:e})=>e),this.gridTilesByMedia=new Map(this.grid.map(({vm:e,media:t})=>[t,e]))}static empty(){return new L3(null,[],0)}from(e){return new Utt(this.spotlight,this.grid,(e,t)=>new L3(e,t,this.generation+1),e,this.generation)}}class Utt{constructor(e,t,n,r,i){var o;this.prevSpotlight=e,this.prevGrid=t,this.construct=n,this.visibleTiles=r,this.generation=i,this.spotlight=null,this.prevSpotlightSpeaker=1===(null==(o=this.prevSpotlight)?void 0:o.media.length)&&"speaking"in this.prevSpotlight.media[0]&&this.prevSpotlight.media[0],this.prevGridByMedia=new Map(this.prevGrid.map((e,t)=>[e.media,[e,t]])),this.numGridEntries=0,this.stationaryGridEntries=new Array(this.prevGrid.length),this.visibleGridEntries=[],this.invisibleGridEntries=[]}registerSpotlight(e,t){if(Bw&&M.debug(`[TileStore, ${this.generation}] register spotlight: ${e.map(e=>{var t;return(null==(t=e.member)?void 0:t.rawDisplayName)??"[👻]"})}`),null!==this.spotlight)throw new Error("Spotlight already set");if(this.numGridEntries>0)throw new Error("Spotlight must be registered before grid tiles");null===this.prevSpotlight?this.spotlight=new Ntt(e,t):(this.spotlight=this.prevSpotlight,this.spotlight.media=e,this.spotlight.maximised=t)}registerGridTile(e){var t;if(Bw&&M.debug(`[TileStore, ${this.generation}] register grid tile: ${(null==(t=e.member)?void 0:t.rawDisplayName)??"[👻]"}`),null!==this.spotlight){if(!e.local&&this.spotlight.media.includes(e))return;if(e===this.prevSpotlightSpeaker&&1===this.spotlight.media.length&&"speaking"in this.spotlight.media[0]&&this.prevSpotlightSpeaker!==this.spotlight.media[0]){const t=this.prevGridByMedia.get(this.spotlight.media[0]);if(void 0!==t){const[n,r]=t,i=r<this.visibleTiles,o=this.numGridEntries<this.visibleTiles;return i===o?(this.stationaryGridEntries[r]=n,n.media=e,this.prevGridByMedia.delete(this.spotlight.media[0]),this.prevGridByMedia.set(e,t)):(o?this.visibleGridEntries:this.invisibleGridEntries).push(new gY(e)),void this.numGridEntries++}}}const n=this.prevGridByMedia.get(e);if(void 0===n)(this.numGridEntries<this.visibleTiles?this.visibleGridEntries:this.invisibleGridEntries).push(new gY(e));else{const[e,t]=n,r=t<this.visibleTiles,i=this.numGridEntries<this.visibleTiles;r===i?this.stationaryGridEntries[t]=e:(i?this.visibleGridEntries:this.invisibleGridEntries).push(e)}this.numGridEntries++}build(){const e=[...Dtt(this.stationaryGridEntries,[...this.visibleGridEntries,...this.invisibleGridEntries])];Bw&&(M.debug(`[TileStore, ${this.generation}] stationary: ${TE(this.stationaryGridEntries)}`),M.debug(`[TileStore, ${this.generation}] visible: ${TE(this.visibleGridEntries)}`),M.debug(`[TileStore, ${this.generation}] invisible: ${TE(this.invisibleGridEntries)}`),M.debug(`[TileStore, ${this.generation}] result: ${TE(e)}`)),null===this.spotlight&&null!==this.prevSpotlight&&this.prevSpotlight.destroy();const t=new Set(e);for(const e of this.prevGrid)t.has(e)||e.destroy();return this.construct(this.spotlight,e)}}function jtt(e,t,n,r){const i=r.from(t);void 0!==e.spotlight&&i.registerSpotlight(e.spotlight,"spotlight-portrait"===e.type);for(const t of e.grid)i.registerGridTile(t);const o=i.build();return[{type:e.type,spotlight:o.spotlightTile,grid:o.gridTiles,setVisibleTiles:n},o]}function Ftt(e,t){const n=t.from(1);n.registerSpotlight(e.spotlight,!0),void 0!==e.pip&&n.registerGridTile(e.pip);const r=n.build();return[{type:e.type,spotlight:r.spotlightTile,pip:r.gridTiles[0]},r]}function $tt(e,t){const n=t.from(2);n.registerGridTile(e.local),n.registerGridTile(e.remote);const r=n.build();return[{type:e.type,local:r.gridTilesByMedia.get(e.local),remote:r.gridTilesByMedia.get(e.remote)},r]}function Btt(e,t){const n=t.from(0);n.registerSpotlight(e.spotlight,!0);const r=n.build();return[{type:e.type,spotlight:r.spotlightTile},r]}function Htt(e){const t=e.pipe(Qo());return t.pipe(ale(e=>vv(Yd(e?1e3:6e4),t.pipe($s(t=>t!==e)))),un(!1),Qo())}function vY(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const ny=new Map;function _P(e){if(ny.has(e))return ny.get(e);const t=Qd(e);return ny.size>500&&ny.clear(),ny.set(e,t),t}function Vtt(e,t,n){const{rawDisplayName:r,userId:i}=e;if(!r||r===i)return!1;const o=_P(r);return!!o&&(!(!/@.+:.+/.test(r)&&!/[\u200E\u200F\u202A-\u202F]/.test(r))||t.map(e=>e.sender&&n.getMember(e.sender)).filter(e=>!!e).filter(e=>e.userId!==i).some(e=>_P(Khe(e,!1))===o))}function Khe(e,t){const{rawDisplayName:n,userId:r}=e;if(!n||n===r)return r;const i=Gw(n);return t?i+" ("+r+")":_P(n)?i:r}const qtt=3e3,Gtt=3,Jx=4e3;class RE{constructor(e,t,n,r,i,o,s,a,l,c){this.id=e,this.scope=new NR,this.participant$=new ms(n),null!=n&&n.isLocal?this.vm=new xv(this.id,t,this.participant$,r,i,o,this.scope.behavior(a),this.scope.behavior(l),this.scope.behavior(c)):this.vm=new iZe(e,t,this.participant$.asObservable(),r,i,s,this.scope.behavior(a),this.scope.behavior(l),this.scope.behavior(c)),this.speaker$=this.scope.behavior(Htt(this.vm.speaking$)),this.presenter$=this.scope.behavior(this.participant$.pipe(Mt(e=>(e&&M8(e,ae.TrackPublished,ae.TrackUnpublished,ae.LocalTrackPublished,ae.LocalTrackUnpublished).pipe(ke(e=>e.isScreenShareEnabled)))??Ot(!1))))}updateParticipant(e){this.participant$.value!==e&&this.participant$.next(e)}destroy(){this.scope.end(),this.vm.destroy()}}class yY{constructor(e,t,n,r,i,o,s){this.scope=new NR,this.participant$=new ms(n),this.vm=new pg(e,t,this.participant$.asObservable(),r,i,o,this.scope.behavior(s),n.isLocal)}destroy(){this.scope.end(),this.vm.destroy()}}function bY(e,t){let n=e.sender+":"+e.deviceId;if(!e.sender)return{id:n,member:void 0};e.sender===t.client.getUserId()&&e.deviceId===t.client.getDeviceId()&&(n="local");return{id:n,member:t.getMember(e.sender)??void 0}}class Ktt extends W_{constructor(e,t,n,r,i,o,s,a){super(),this.matrixRTCSession=e,this.matrixRoom=t,this.livekitRoom=n,this.mediaDevices=r,this.options=i,this.livekitConnectionState$=o,this.handsRaisedSubject$=s,this.reactionsSubject$=a,this.userId=this.matrixRoom.client.getUserId(),this.matrixConnected$=this.scope.behavior(YK(Ba(this.matrixRoom.client,Le.Sync).pipe(un([this.matrixRoom.client.getSyncState()]),ke(([e])=>e===Vt.Syncing)),Ba(this.matrixRTCSession,Uh.StatusChanged).pipe(un(null),ke(()=>this.matrixRTCSession.membershipStatus===kd.Connected)),Ba(this.matrixRTCSession,Uh.ProbablyLeft).pipe(un(null),ke(()=>!0!==this.matrixRTCSession.probablyLeft)))),this.connected$=this.scope.behavior(YK(this.matrixConnected$,this.livekitConnectionState$.pipe(ke(e=>e===Pt.Connected)))),this.reconnecting$=this.scope.behavior(this.connected$.pipe(Oa(({connectedPreviously:e,reconnecting:t},n)=>({connectedPreviously:e||n,reconnecting:e&&!n}),{connectedPreviously:!1,reconnecting:!1}),ke(({reconnecting:e})=>e))),this.pretendToBeDisconnected$=this.reconnecting$,this.rawRemoteParticipants$=this.scope.behavior(bKe(this.livekitRoom),[]),this.remoteParticipantHolds$=this.scope.behavior(this.livekitConnectionState$.pipe(cle(this.rawRemoteParticipants$),M_(([e,t])=>e===bP.ECSwitchingFocus?Ub(Ot({hold:t}),QVe([Yd(qtt),this.livekitConnectionState$.pipe($s(e=>e!==bP.ECSwitchingFocus),O7(1))]).pipe(ke(()=>({unhold:t})))):o3),U7([],(e,t)=>"hold"in t?[t.hold,...e]:e.filter(e=>e!==t.unhold)))),this.remoteParticipants$=this.scope.behavior(ln([this.rawRemoteParticipants$,this.remoteParticipantHolds$],(e,t)=>{const n=[...e],r=new Set(n.map(e=>e.identity));for(const e of t)for(const t of e)r.has(t.identity)||(n.push(t),r.add(t.identity));return n})).pipe(B0(this.pretendToBeDisconnected$)),this.memberDisplaynames$=this.scope.behavior(vv(Ba(this.matrixRTCSession,yi.MembershipsChanged),Ba(this.matrixRoom,vt.Members)).pipe(un(null),ke(()=>{const e=this.matrixRTCSession.memberships,t=new Map,n=this.matrixRoom;for(const r of e){const i=`${r.sender}:${r.deviceId}`,{member:o}=bY(r,n);if(!o){M.error("Could not find member for media id:",i);continue}const s=Vtt(o,e,n);t.set(i,Khe(o,s))}return t}),B0(this.pretendToBeDisconnected$))),this.handsRaised$=this.scope.behavior(this.handsRaisedSubject$.pipe(B0(this.pretendToBeDisconnected$))),this.reactions$=this.scope.behavior(this.reactionsSubject$.pipe(ke(e=>Object.fromEntries(Object.entries(e).map(([e,{reactionOption:t}])=>[e,t]))),B0(this.pretendToBeDisconnected$))),this.mediaItems$=this.scope.behavior(ln([this.remoteParticipants$,D8(this.livekitRoom.localParticipant),ule.value$,Ba(this.matrixRTCSession,yi.MembershipsChanged).pipe(un(null),B0(this.pretendToBeDisconnected$)),dle.value$]).pipe(Oa((e,[t,{participant:n},r,i,o])=>{const s=new Map(function*(){const i=this.matrixRoom;for(const o of this.matrixRTCSession.memberships){const{member:s,id:a}=bY(o,i),l=`${o.sender}:${o.deviceId}`;let c;c="local"===a?n:t.find(e=>e.identity===a),s||M.error("Could not find member for media id: ",a);for(let t=0;t<1+r;t++){const n=`${a}:${t}`;let r=e.get(n);if(r&&r instanceof RE&&(r.updateParticipant(c),void 0===r.vm.member&&(r=void 0)),yield[n,r??new RE(n,s,c,this.options.encryptionSystem,this.livekitRoom,this.mediaDevices,this.pretendToBeDisconnected$,this.memberDisplaynames$.pipe(ke(e=>e.get(l)??"[👻]")),this.handsRaised$.pipe(ke(e=>{var t;return(null==(t=e[l])?void 0:t.time)??null})),this.reactions$.pipe(ke(e=>e[l]??void 0)))],null!=c&&c.isScreenShareEnabled){const t=`${n}:screen-share`;yield[t,e.get(t)??new yY(t,s,c,this.options.encryptionSystem,this.livekitRoom,this.pretendToBeDisconnected$,this.memberDisplaynames$.pipe(ke(e=>e.get(l)??"[👻]")))]}}}}.bind(this)()),a=o?new Map(function*(){for(const n of t)for(let t=0;t<1+r;t++){const r=n.identity+":"+t;if(!s.has(r)){const t=r;yield[t,e.get(t)??new RE(t,void 0,n,this.options.encryptionSystem,this.livekitRoom,this.mediaDevices,this.pretendToBeDisconnected$,this.memberDisplaynames$.pipe(ke(e=>e.get(n.identity)??"[👻]")),Ot(null),Ot(null))]}}}.bind(this)()):new Map;a.size>0&&M.debug("Added NonMember items: ",a);const l=new Map([...a.entries(),...s.entries()]);for(const[t,n]of e)l.has(t)||n.destroy();return l},new Map),ke(e=>[...e.values()]),_Ke(e=>{for(const t of e)t.destroy()}))),this.userMedia$=this.scope.behavior(this.mediaItems$.pipe(ke(e=>e.filter(e=>e instanceof RE)))),this.participantChanges$=this.userMedia$.pipe(ke(e=>e.map(e=>e.id)),Oa((e,t)=>{const n=e.ids.filter(e=>!t.includes(e)),r=t.filter(t=>!e.ids.includes(t));return{ids:t,joined:r,left:n}},{ids:[],joined:[],left:[]})),this.matrixUserChanges$=this.userMedia$.pipe(ke(e=>new Set(e.map(e=>{var t;return null==(t=e.vm.member)?void 0:t.userId}).filter(e=>void 0!==e))),Oa((e,t)=>{const n=new Set([...e.userIds].filter(e=>!t.has(e))),r=new Set([...t].filter(t=>!e.userIds.has(t)));return{userIds:t,joinedUserIds:r,leftUserIds:n}},{userIds:new Set,joinedUserIds:new Set,leftUserIds:new Set})),this.allOthersLeft$=this.matrixUserChanges$.pipe(ke(({userIds:e,leftUserIds:t})=>this.userId?1===e.size&&e.has(this.userId)&&t.size>0:(M.warn("Could not access user ID to compute allOthersLeft"),!1)),un(!1),Qo()),this.autoLeaveWhenOthersLeft$=this.allOthersLeft$.pipe(Qo(),$s(e=>(e&&this.options.autoLeaveWhenOthersLeft)??!1),ke(()=>{})),this.screenShares$=this.scope.behavior(this.mediaItems$.pipe(ke(e=>e.filter(e=>e instanceof yY)))),this.spotlightSpeaker$=this.scope.behavior(this.userMedia$.pipe(Mt(e=>0===e.length?Ot([]):ln(e.map(e=>e.vm.speaking$.pipe(ke(t=>[e,t]))))),Oa((e,t)=>{var n,r,i;const[o,s]=!(null!=e&&e.vm.local)&&t.find(([t])=>t===e)||[];return s?o:(null==(n=t.find(([e,t])=>!e.vm.local&&t))?void 0:n[0])??o??(null==(r=t.find(([e])=>!e.vm.local))?void 0:r[0])??(null==(i=t.find(([e])=>e.vm.local))?void 0:i[0])},null),ke(e=>(null==e?void 0:e.vm)??null))),this.grid$=this.scope.behavior(this.userMedia$.pipe(Mt(e=>{const t=e.map(e=>ln([e.speaker$,e.presenter$,e.vm.videoEnabled$,e.vm.handRaised$,e.vm instanceof xv?e.vm.alwaysShow$:Ot(!1)],(t,n,r,i,o)=>{let s;return s=e.vm.local?o?0:6:n?1:t?2:i?3:r?4:5,[e,s]}));return 0===t.length?Ot([]):ln(t,(...e)=>e.sort(([,e],[,t])=>e-t).map(([e])=>e.vm))}),Qo(vY))),this.spotlight$=this.scope.behavior(this.screenShares$.pipe(Mt(e=>e.length>0?Ot(e.map(e=>e.vm)):this.spotlightSpeaker$.pipe(ke(e=>e?[e]:[]))),Qo(vY))),this.pip$=this.scope.behavior(ln([this.screenShares$,this.spotlightSpeaker$,this.mediaItems$]).pipe(Mt(([e,t,n])=>{if(e.length>0)return this.spotlightSpeaker$;if(!t||t.local)return Ot(null);const r=n.find(e=>e.vm instanceof xv),i=null==r?void 0:r.vm;return i?i.alwaysShow$.pipe(ke(e=>e?i:null)):Ot(null)}))),this.hasRemoteScreenShares$=this.spotlight$.pipe(ke(e=>e.some(e=>!e.local&&e instanceof pg)),Qo()),this.pipEnabled$=this.scope.behavior(eg,!1),this.naturalWindowMode$=this.scope.behavior(Ba(window,"resize").pipe(un(null),ke(()=>{const e=window.innerHeight,t=window.innerWidth;return e<=400&&t<=340?"pip":e<=600?"flat":t<=600?"narrow":"normal"}))),this.windowMode$=this.scope.behavior(this.pipEnabled$.pipe(Mt(e=>e?Ot("pip"):this.naturalWindowMode$))),this.spotlightExpandedToggle$=new Zr,this.spotlightExpanded$=this.scope.behavior(this.spotlightExpandedToggle$.pipe(U7(!1,e=>!e))),this.gridModeUserSelection$=new Zr,this.gridMode$=this.scope.behavior(this.gridModeUserSelection$.pipe(un(null),Mt(e=>("spotlight"===e?o3:ln([this.hasRemoteScreenShares$,this.windowMode$]).pipe(yqe(null===e?0:1),ke(([e,t])=>e||"flat"===t?"spotlight":"grid"))).pipe(un(e??"grid"))))),this.gridLayoutMedia$=ln([this.grid$,this.spotlight$],(e,t)=>({type:"grid",spotlight:t.some(e=>e instanceof pg)?t:void 0,grid:e})),this.spotlightLandscapeLayoutMedia$=ln([this.grid$,this.spotlight$],(e,t)=>({type:"spotlight-landscape",spotlight:t,grid:e})),this.spotlightPortraitLayoutMedia$=ln([this.grid$,this.spotlight$],(e,t)=>({type:"spotlight-portrait",spotlight:t,grid:e})),this.spotlightExpandedLayoutMedia$=ln([this.spotlight$,this.pip$],(e,t)=>({type:"spotlight-expanded",spotlight:e,pip:t??void 0})),this.oneOnOneLayoutMedia$=this.mediaItems$.pipe(ke(e=>{var t,n;if(2!==e.length)return null;const r=null==(t=e.find(e=>e.vm.local))?void 0:t.vm,i=null==(n=e.find(e=>!e.vm.local))?void 0:n.vm;return i&&r?{type:"one-on-one",local:r,remote:i}:null})),this.pipLayoutMedia$=this.spotlight$.pipe(ke(e=>({type:"pip",spotlight:e}))),this.layoutMedia$=this.scope.behavior(this.windowMode$.pipe(Mt(e=>{switch(e){case"normal":return this.gridMode$.pipe(Mt(e=>{switch(e){case"grid":return this.oneOnOneLayoutMedia$.pipe(Mt(e=>null===e?this.gridLayoutMedia$:Ot(e)));case"spotlight":return this.spotlightExpanded$.pipe(Mt(e=>e?this.spotlightExpandedLayoutMedia$:this.spotlightLandscapeLayoutMedia$))}}));case"narrow":return this.oneOnOneLayoutMedia$.pipe(Mt(e=>null===e?ln([this.grid$,this.spotlight$],(e,t)=>e.length>3||t.some(e=>e instanceof pg)?this.spotlightPortraitLayoutMedia$:this.gridLayoutMedia$).pipe(bqe()):this.spotlightExpandedLayoutMedia$));case"flat":return this.gridMode$.pipe(Mt(e=>{switch(e){case"grid":return this.spotlightLandscapeLayoutMedia$;case"spotlight":return this.spotlightExpandedLayoutMedia$}}));case"pip":return this.pipLayoutMedia$}}))),this.visibleTiles$=new Zr,this.setVisibleTiles=e=>this.visibleTiles$.next(e),this.layoutInternals$=this.scope.behavior(ln([this.layoutMedia$,this.visibleTiles$.pipe(un(0),Qo())]).pipe(Oa(({tiles:e},[t,n])=>{let r,i;switch(t.type){case"grid":case"spotlight-landscape":case"spotlight-portrait":[r,i]=jtt(t,n,this.setVisibleTiles,e);break;case"spotlight-expanded":[r,i]=Ftt(t,e);break;case"one-on-one":[r,i]=$tt(t,e);break;case"pip":[r,i]=Btt(t,e)}return{layout:r,tiles:i}},{layout:null,tiles:L3.empty()}))),this.layout$=this.scope.behavior(this.layoutInternals$.pipe(ke(({layout:e})=>e))),this.tileStoreGeneration$=this.scope.behavior(this.layoutInternals$.pipe(ke(({tiles:e})=>e.generation))),this.showSpotlightIndicators$=this.scope.behavior(this.layout$.pipe(ke(e=>"grid"!==e.type))),this.showSpeakingIndicators$=this.scope.behavior(this.layout$.pipe(Mt(e=>{switch(e.type){case"spotlight-landscape":case"spotlight-portrait":return e.spotlight.media$.pipe(ke(e=>e.some(e=>e instanceof pg)));case"spotlight-expanded":case"one-on-one":return Ot(!1);default:return Ot(!0)}}))),this.toggleSpotlightExpanded$=this.scope.behavior(this.windowMode$.pipe(Mt(e=>"normal"===e?this.layout$.pipe(ke(e=>"spotlight-landscape"===e.type||"spotlight-expanded"===e.type)):Ot(!1)),Qo(),ke(e=>e?()=>this.spotlightExpandedToggle$.next():null))),this.screenTap$=new Zr,this.controlsTap$=new Zr,this.screenHover$=new Zr,this.screenUnhover$=new Zr,this.showHeader$=this.scope.behavior(this.windowMode$.pipe(ke(e=>"pip"!==e&&"flat"!==e))),this.showFooter$=this.scope.behavior(this.windowMode$.pipe(Mt(e=>{switch(e){case"pip":return Ot(!1);case"normal":case"narrow":return Ot(!0);case"flat":return xUe()?Ot(!0):vv(this.screenTap$.pipe(ke(()=>"tap screen")),this.controlsTap$.pipe(ke(()=>"tap controls")),this.screenHover$.pipe(ke(()=>"hover"))).pipe(_qe((e,t)=>{switch(t){case"tap screen":return e?Ot(!1):Yd(Jx).pipe(ke(()=>!1),un(!0));case"tap controls":return Yd(Jx).pipe(ke(()=>!1),un(!0));case"hover":return cqe(Yd(Jx),this.screenUnhover$.pipe(O7(1))).pipe(ke(()=>!1),un(!0))}},!1),un(!1))}}))),this.earpieceMode$=this.scope.behavior(ln([this.mediaDevices.audioOutput.available$,this.mediaDevices.audioOutput.selected$],(e,t)=>{var n;return void 0!==t&&"earpiece"===(null==(n=e.get(t.id))?void 0:n.type)})),this.audioOutputSwitcher$=this.scope.behavior(ln([this.mediaDevices.audioOutput.available$,this.mediaDevices.audioOutput.selected$],(e,t)=>{var n;const r="speaker"===(t&&(null==(n=e.get(t.id))?void 0:n.type))?"earpiece":"speaker",i=[...e].find(([,e])=>e.type===r);if(void 0===i)return null;const[o]=i;return{targetOutput:r,switch:()=>this.mediaDevices.audioOutput.select(o)}})),this.visibleReactions$=this.scope.behavior(ple.value$.pipe(Mt(e=>e?this.reactions$:Ot({})),Oa((e,t)=>{var n;const r=[];for(const[i,o]of Object.entries(t)){const t=(null==(n=e.find(e=>e.sender===i&&e.emoji))?void 0:n.startX)??Math.ceil(80*Math.random())+10;r.push({sender:i,emoji:o.emoji,startX:t})}return r},[]))),this.audibleReactions$=I8.value$.pipe(Mt(e=>e?this.reactions$:Ot({})),ke(e=>Object.values(e).map(e=>e.name)),Oa((e,t)=>({playing:t.filter(t=>e.playing.includes(t)||e.newSounds.includes(t)),newSounds:t.filter(t=>!e.playing.includes(t)&&!e.newSounds.includes(t))}),{playing:[],newSounds:[]}),ke(e=>e.newSounds)),this.newHandRaised$=this.handsRaised$.pipe(ke(e=>Object.keys(e).length),Oa((e,t)=>({value:t,playSounds:t>e.value}),{value:0,playSounds:!1}),$s(e=>e.playSounds)),this.newScreenShare$=this.screenShares$.pipe(ke(e=>e.length),Oa((e,t)=>({value:t,playSounds:t>e.value}),{value:0,playSounds:!1}),$s(e=>e.playSounds)),this.matrixConnected$.pipe(this.scope.bind()).subscribe(e=>{var t,n;const r=this.livekitRoom.localParticipant.trackPublications.values();if(e){for(const e of r)if(!0===(null==(t=e.track)?void 0:t.isUpstreamPaused)){const t=e.track.kind;M.log(`Resumming ${t} track (MatrixRTC connection present)`),e.track.resumeUpstream().catch(e=>M.error(`Failed to resume ${t} track after MatrixRTC reconnection`,e))}}else for(const e of r)if(!1===(null==(n=e.track)?void 0:n.isUpstreamPaused)){const t=e.track.kind;M.log(`Pausing ${t} track (no MatrixRTC connection)`),e.track.pauseUpstream().catch(e=>M.error(`Failed to pause ${t} track after MatrixRTC connection loss`,e))}})}setGridMode(e){this.gridModeUserSelection$.next(e)}tapScreen(){this.screenTap$.next()}tapControls(){this.controlsTap$.next()}hoverScreen(){this.screenHover$.next()}unhoverScreen(){this.screenUnhover$.next()}}function ztt(e,t,n){return Math.max(t,Math.min(e,n))}const wi={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function _Y(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function SY(e,t,n,r=.15){return 0===r?ztt(e,t,n):e<t?-_Y(t-e,n-t,r)+t:e>n?+_Y(e-n,n-t,r)+n:e}function Wtt(e,[t,n],[r,i]){const[[o,s],[a,l]]=e;return[SY(t,o,s,r),SY(n,a,l,i)]}function Ytt(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Xtt(e){var t=Ytt(e,"string");return"symbol"==typeof t?t:String(t)}function ss(e,t,n){return(t=Xtt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function EY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?EY(Object(n),!0).forEach(function(t){ss(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const zhe={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function wY(e){return e?e[0].toUpperCase()+e.slice(1):""}const Jtt=["enter","leave"];function Qtt(e=!1,t){return e&&!Jtt.includes(t)}function Ztt(e,t="",n=!1){const r=zhe[e],i=r&&r[t]||t;return"on"+wY(e)+wY(i)+(Qtt(n,i)?"Capture":"")}const ent=["gotpointercapture","lostpointercapture"];function tnt(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=ent.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}function nnt(e,t=""){const n=zhe[e];return e+(n&&n[t]||t)}function KR(e){return"touches"in e}function Whe(e){return KR(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function rnt(e){return Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))})}function int(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}function Yhe(e){return KR(e)?int(e)[0]:e}function snt(e){return rnt(e).map(e=>e.identifier)}function Qx(e){const t=Yhe(e);return KR(e)?t.identifier:t.pointerId}function CY(e){const t=Yhe(e);return[t.clientX,t.clientY]}function ont(e){var t,n;const{scrollX:r,scrollY:i,scrollLeft:o,scrollTop:s}=e.currentTarget;return[null!==(t=r??o)&&void 0!==t?t:0,null!==(n=i??s)&&void 0!==n?n:0]}function ant(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}function P3(e,...t){return"function"==typeof e?e(...t):e}function cnt(){}function lnt(...e){return 0===e.length?cnt:1===e.length?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function TY(e,t){return Object.assign({},t,e||{})}const unt=32;class dnt{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?P3(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,ant(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);wi.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[o,s]=t._movement,[a,l]=n.threshold,{_step:c,values:u}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=a&&u[0]),!1===c[1]&&(c[1]=Math.abs(s)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===c[1]&&(c[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;const d=[0,0];if(n.hasCustomTransform){const[e,t]=u;d[0]=!1!==c[0]?e-c[0]:0,d[1]=!1!==c[1]?t-c[1]:0}else d[0]=!1!==c[0]?o-c[0]:0,d[1]=!1!==c[1]?s-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(d);const h=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=P3(n.bounds,t)),this.setup&&this.setup()),t.movement=d,this.computeOffset()));const[f,m]=t.offset,[[v,g],[y,b]]=t._bounds;t.overflow=[f<v?-1:f>g?1:0,m<y?-1:m>b?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const w=t._active&&n.rubberband||[0,0];if(t.offset=Wtt(t._bounds,t.offset,w),t.delta=wi.sub(t.offset,h),this.computeMovement(),p&&(!t.last||i>32)){t.delta=wi.sub(t.offset,h);const e=t.delta.map(Math.abs);wi.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const r=this.handler(rr(rr(rr({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function fnt([e,t],n){const r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}class Xhe extends dnt{constructor(...e){super(...e),ss(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=wi.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=wi.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const r="object"==typeof n.axisThreshold?n.axisThreshold[Whe(e)]:n.axisThreshold;t.axis=fnt(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const hnt=e=>e,RY=.15,Jhe={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>rr(rr({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[RY,RY];case!1:return[0,0];default:return wi.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?wi.toVector(e):void 0,transform(e,t,n){const r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||hnt},threshold:e=>wi.toVector(e,0)},pnt=0,u1=rr(rr({},Jhe),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=0)=>e,bounds(e={}){if("function"==typeof e)return t=>u1.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),IY={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class mnt extends Xhe{constructor(...e){super(...e),ss(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),r={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=u1.bounds(r)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;const r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(r&&r.size>1&&n._pointerActive)&&(this.start(e),this.setupPointer(e),n._pointerId=Qx(e),n._pointerActive=!0,this.computeValues(CY(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==Whe(e)?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;const r=Qx(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;const i=CY(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=wi.sub(i,t._values),this.computeValues(i)),wi.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):n.preventScrollAxis&&!t._preventScroll?t.axis?t.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const r=Qx(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[i,o]=t._distance;if(t.tap=i<=n.tapsThreshold&&o<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[e,r]=t._delta,[i,o]=t._movement,[s,a]=n.swipe.velocity,[l,c]=n.swipe.distance,u=n.swipe.duration;if(t.elapsedTime<u){const n=Math.abs(e/t.timeDelta),u=Math.abs(r/t.timeDelta);n>s&&Math.abs(i)>l&&(t.swipe[0]=Math.sign(e)),u>a&&Math.abs(o)>c&&(t.swipe[1]=Math.sign(r))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,gnt(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=IY[e.key];if(t){const n=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,r),n._keyboardActive=!0,wi.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in IY&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function gnt(e){"persist"in e&&"function"==typeof e.persist&&e.persist()}const Z_=typeof window<"u"&&window.document&&window.document.createElement;function Qhe(){return Z_&&"ontouchstart"in window}function vnt(){return Qhe()||Z_&&window.navigator.maxTouchPoints>1}function ynt(){return Z_&&"onpointerdown"in window}function bnt(){return Z_&&"exitPointerLock"in window.document}function _nt(){try{return"constructor"in GestureEvent}catch{return!1}}const ia={isBrowser:Z_,gesture:_nt(),touch:Qhe(),touchscreen:vnt(),pointer:ynt(),pointerLock:bnt()},Snt=250,Ent=180,wnt=.5,Cnt=50,Tnt=250,Rnt=10,kY={mouse:0,touch:0,pen:8},Int=rr(rr({},u1),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&ia.pointerLock,ia.touch&&n?"touch":this.pointerLock?"mouse":ia.pointer&&!i?"pointer":ia.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,ia.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){const o=wi.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(wi.toVector(e)),distance:this.transform(wi.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?rr(rr({},kY),e):kY,keyboardDisplacement:(e=10)=>e});rr(rr({},Jhe),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!ia.touch&&ia.gesture)return"gesture";if(ia.touch&&r)return"touch";if(ia.touchscreen){if(ia.pointer)return"pointer";if(ia.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){const i=e=>{const t=TY(P3(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{const t=TY(P3(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof r?[i(),o()]:e=>[i(e),o(e)]},threshold(e,t,n){return this.lockDirection="lock"===n.axis,wi.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e}),rr(rr({},u1),{},{mouseOnly:(e=!0)=>e});class knt extends Xhe{constructor(...e){super(...e),ss(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const t=this.state,n=ont(e);t._delta=wi.sub(n,t._values),wi.addTo(t._movement,t._delta),this.computeValues(n),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const xnt=u1;rr(rr({},u1),{},{mouseOnly:(e=!0)=>e});const Zhe=new Map,SP=new Map;function epe(e){Zhe.set(e.key,e.engine),SP.set(e.key,e.resolver)}const Ant={key:"drag",engine:mnt,resolver:Int},Lnt={key:"scroll",engine:knt,resolver:xnt};function Pnt(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}function Ont(e,t){if(null==e)return{};var n,r,i=Pnt(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const Mnt={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(ia.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},Dnt=["target","eventOptions","window","enabled","transform"];function Hw(e={},t){const n={};for(const[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=Hw(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}function Nnt(e,t,n={}){const r=e,{target:i,eventOptions:o,window:s,enabled:a,transform:l}=r,c=Ont(r,Dnt);if(n.shared=Hw({target:i,eventOptions:o,window:s,enabled:a,transform:l},Mnt),t){const e=SP.get(t);n[t]=Hw(rr({shared:n.shared},c),e)}else for(const e in c){const t=SP.get(e);t&&(n[e]=Hw(rr({shared:n.shared},c[e]),t))}return n}class tpe{constructor(e,t){ss(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){const o=this._listeners,s=nnt(t,n),a=rr(rr({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(s,r,a);const l=()=>{e.removeEventListener(s,r,a),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class Unt{constructor(){ss(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>{window.clearTimeout(e)}),this._timeouts.clear()}}class jnt{constructor(e){ss(this,"gestures",new Set),ss(this,"_targetEventStore",new tpe(this)),ss(this,"gestureEventStores",{}),ss(this,"gestureTimeoutStores",{}),ss(this,"handlers",{}),ss(this,"config",{}),ss(this,"pointerIds",new Set),ss(this,"touchIds",new Set),ss(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Fnt(this,e)}setEventIds(e){return KR(e)?(this.touchIds=new Set(snt(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=Nnt(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let r;if(!t.target||(r=t.target(),r)){if(t.enabled){for(const t of this.gestures){const i=this.config[t],o=xY(n,i.eventOptions,!!r);if(i.enabled){new(Zhe.get(t))(this,e,t).bind(o)}}const i=xY(n,t.eventOptions,!!r);for(const t in this.nativeHandlers)i(t,"",n=>this.nativeHandlers[t](rr(rr({},this.state.shared),{},{event:n,args:e})),void 0,!0)}for(const e in n)n[e]=lnt(...n[e]);if(!r)return n;for(const e in n){const{device:t,capture:i,passive:o}=tnt(e);this._targetEventStore.add(r,t,"",n[e],{capture:i,passive:o})}}}}function qm(e,t){e.gestures.add(t),e.gestureEventStores[t]=new tpe(e,t),e.gestureTimeoutStores[t]=new Unt}function Fnt(e,t){t.drag&&qm(e,"drag"),t.wheel&&qm(e,"wheel"),t.scroll&&qm(e,"scroll"),t.move&&qm(e,"move"),t.pinch&&qm(e,"pinch"),t.hover&&qm(e,"hover")}const xY=(e,t,n)=>(r,i,o,s={},a=!1)=>{var l,c;const u=null!==(l=s.capture)&&void 0!==l?l:t.capture,d=null!==(c=s.passive)&&void 0!==c?c:t.passive;let h=a?r:Ztt(r,i,u);n&&d&&(h+="Passive"),e[h]=e[h]||[],e[h].push(o)};function npe(e,t={},n,r){const i=Te.useMemo(()=>new jnt(e),[]);if(i.applyHandlers(e,r),i.applyConfig(t,n),Te.useEffect(i.effect.bind(i)),Te.useEffect(()=>i.clean.bind(i),[]),void 0===t.target)return i.bind.bind(i)}function $nt(e,t){return epe(Ant),npe({drag:e},t||{},"drag")}function Bnt(e,t){return epe(Lnt),npe({scroll:e},t||{},"scroll")}const Hnt="_grid_19qx5_8",Vnt="_slot_19qx5_12",Zx={grid:Hnt,slot:Vnt},qnt="_tile_lwkx2_8",Gnt="_draggable_lwkx2_8",AY={tile:qnt,draggable:Gnt},rpe=_.memo(({id:e,onDrag:t,targetWidth:n,targetHeight:r,model:i,Tile:o,opacity:s,scale:a,zIndex:l,x:c,y:u,width:d,height:h})=>{const p=_.useRef(null);return $nt(n=>null==t?void 0:t.current(e,n),{target:p,filterTaps:!0}),w.jsx(o,{ref:p,className:Ne(AY.tile,{[AY.draggable]:t}),style:{opacity:s,scale:a,zIndex:l,x:c,y:u,width:d,height:h},targetWidth:n,targetHeight:r,model:i})});rpe.displayName="TileWrapper";const Knt=rpe,znt=()=>DT("(prefers-reduced-motion)");function ipe(e,t){if(!(e.offsetParent instanceof HTMLElement)||e.offsetParent===t)return{x:e.offsetLeft,y:e.offsetTop};{const n=ipe(e.offsetParent,t);return n.x+=e.offsetLeft,n.y+=e.offsetTop,n}}const spe=_.createContext(null);function ope(){const e=_.use(spe);if(null===e)throw new Error("useUpdateLayout called outside a Grid layout context");return e}function al(){const{setGeneration:e}=ope();_.useEffect(()=>e(e=>null===e?0:e+1))}function _D(e){const{setVisibleTilesCallback:t}=ope();_.useEffect(()=>t(()=>e),[e,t]),_.useEffect(()=>()=>t(null),[t])}function LY({model:e,Layout:t,Tile:n,className:r,style:i}){const[o,s]=Ky(),[a,l]=_.useState(null),c=Q_(o,l),u=_.useSyncExternalStore(_.useCallback(e=>(window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)),[]),_.useCallback(()=>window.innerHeight,[])),[d,h]=_.useState(null),[p,f]=_.useState(null),[m,v]=_.useState(null),g=el(()=>new Map),y=znt(),b=_.useMemo(()=>function({id:e,model:t,onDrag:n,style:r,className:i,...o}){const s=_.useRef(null);return _.useEffect(()=>(g.set(e,{id:e,model:t,onDrag:n}),()=>{g.delete(e)}),[e,t,n]),w.jsx("div",{ref:s,className:Ne(i,Zx.slot),"data-id":e,style:r,...o})},[g]),S=_.useMemo(()=>_.memo(function({ref:e,Layout:t,...n}){return w.jsx(t,{...n,ref:e})}),[]),E=_.useMemo(()=>({setGeneration:f,setVisibleTilesCallback:v}),[v]),C=_.useMemo(()=>{const e=[];if(null!==a&&null!==d){const t=d.getElementsByClassName(Zx.slot);for(const n of t){const t=n.getAttribute("data-id");n.offsetWidth>0&&n.offsetHeight>0&&e.push({...g.get(t),...ipe(n,a),width:n.offsetWidth,height:n.offsetHeight})}}return e},[a,d,g,s,p]),k=_.useMemo(()=>Math.min(s.bottom,u)-s.top,[s,u]);_.useEffect(()=>{null==m||m(C.filter(e=>e.y+e.height<=k).length)},[C,m,k]);const T=_.useRef(null),[R,I]=het(C,()=>({key:({id:e})=>e,from:({x:e,y:t,width:n,height:r})=>({opacity:0,scale:0,zIndex:1,x:e,y:t,width:n,height:r,immediate:y}),enter:{opacity:1,scale:1,immediate:y},update:({id:e,x:t,y:n,width:r,height:i})=>{var o;return e===(null==(o=T.current)?void 0:o.tileId)?null:{x:t,y:n,width:r,height:i,immediate:y}},leave:{opacity:0,scale:0,immediate:y},config:{mass:.7,tension:252,friction:25}}));_.useEffect(()=>{I.start().forEach(e=>{e.catch(M.error)})},[C,I]);const x=(e,t)=>{var n;const{tileId:r,tileX:i,tileY:o}=T.current,a=C.find(e=>e.id===r);null==(n=I.current.find(e=>e.item.id===r))||n.start(e?{scale:1,zIndex:1,x:a.x,y:a.y,width:a.width,height:a.height,immediate:y||(e=>"zIndex"===e),delay:e=>"zIndex"===e?500:0}:{scale:1.1,zIndex:2,x:i,y:o,immediate:y||(e=>"zIndex"===e||"x"===e||"y"===e)}).catch(M.error),e&&t({x:i,y:o,xRatio:i/(s.width-a.width),yRatio:o/(s.height-a.height)})},P=(e,{tap:t,initial:[n,r],delta:[i,o],last:a})=>{if(!t){const t=I.current.find(t=>t.item.id===e),l=g.get(t.item.id).onDrag;if(null!=l){if(null===T.current){const i=t.get();T.current={tileId:e,tileX:i.x,tileY:i.y,cursorX:n-s.x,cursorY:r-s.y+O.current}}T.current.tileX+=i,T.current.tileY+=o,T.current.cursorX+=i,T.current.cursorY+=o,x(a,l),a&&(T.current=null)}}},L=_.useRef(P);L.current=P;const O=_.useRef(0);return Bnt(({xy:[,e],delta:[,t]})=>{O.current=e,null!==T.current&&(T.current.tileY+=t,T.current.cursorY+=t,x(!1,g.get(T.current.tileId).onDrag))},{target:a??void 0}),w.jsxs("div",{ref:c,className:Ne(r,Zx.grid),style:i,children:[w.jsx(spe,{value:E,children:w.jsx(S,{ref:h,Layout:t,model:e,Slot:b})}),R((e,{id:t,model:r,onDrag:i,width:o,height:s})=>w.jsx(Knt,{id:t,onDrag:i?L:null,targetWidth:o,targetHeight:s,model:r,Tile:n,...e},t))]})}const Wnt=(e,t)=>_.createElement("svg",{width:24,height:24,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{d:"M4 14C4.55228 14 5 14.4477 5 15V19H9C9.55228 19 10 19.4477 10 20C10 20.5523 9.55228 21 9 21H3V15C3 14.4477 3.44772 14 4 14Z"}),_.createElement("path",{d:"M20 14C20.5523 14 21 14.4477 21 15V21H15C14.4477 21 14 20.5523 14 20C14 19.4477 14.4477 19 15 19H19V15C19 14.4477 19.4477 14 20 14Z"}),_.createElement("path",{d:"M9 3C9.55228 3 10 3.44772 10 4C10 4.55228 9.55228 5 9 5H5V9C5 9.55228 4.55228 10 4 10C3.44772 10 3 9.55228 3 9V3H9Z"}),_.createElement("path",{d:"M21 9C21 9.55228 20.5523 10 20 10C19.4477 10 19 9.55228 19 9V5H15C14.4477 5 14 4.55228 14 4C14 3.44772 14.4477 3 15 3H21V9Z"})),Ynt=_.forwardRef(Wnt),Xnt=(e,t)=>_.createElement("svg",{width:24,height:24,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{d:"M10 20C10 20.5523 9.55228 21 9 21C8.44772 21 8 20.5523 8 20V16H4C3.44772 16 3 15.5523 3 15C3 14.4477 3.44772 14 4 14H10V20Z"}),_.createElement("path",{d:"M20 14C20.5523 14 21 14.4477 21 15C21 15.5523 20.5523 16 20 16H16V20C16 20.5523 15.5523 21 15 21C14.4477 21 14 20.5523 14 20V14H20Z"}),_.createElement("path",{d:"M9 3C9.55228 3 10 3.44772 10 4V10H4C3.44772 10 3 9.55228 3 9C3 8.44772 3.44772 8 4 8H8V4C8 3.44772 8.44772 3 9 3Z"}),_.createElement("path",{d:"M15 3C15.5523 3 16 3.44772 16 4V8H20C20.5523 8 21 8.44772 21 9C21 9.55228 20.5523 10 20 10H14V4C14 3.44772 14.4477 3 15 3Z"})),Jnt=_.forwardRef(Xnt),Qnt="_contents_18q5h_8",Znt="_tile_18q5h_25",ert="_maximised_18q5h_25",trt="_item_18q5h_29",nrt="_snap_18q5h_36",rrt="_advance_18q5h_40",irt="_back_18q5h_76",srt="_next_18q5h_80",ort="_expand_18q5h_84",art="_bottomRightButtons_18q5h_102",crt="_indicators_18q5h_136",lrt="_show_18q5h_148",is={contents:Qnt,tile:Znt,maximised:ert,item:trt,snap:nrt,advance:rrt,back:irt,next:srt,expand:ort,bottomRightButtons:art,indicators:crt,show:lrt},SD=(e,t)=>{const n=_.useRef(void 0);void 0===n.current&&(n.current=e());const r=_.useRef(void 0),[,i]=_.useState(0);return(void 0===r.current||t.length!==r.current.length||t.some((e,t)=>!Object.is(e,r.current[t])))&&(n.current=e(n.current)),r.current=t,[n.current,_.useCallback(e=>{n.current="function"==typeof e?e(n.current):e,i(e=>e+1)},[i])]},ape=({vm:e,...t})=>{const n=ct(e.mirror$);return w.jsx(J_,{mirror:n,...t})};ape.displayName="SpotlightLocalUserMediaItem";const cpe=({vm:e,...t})=>{const n={videoFit:ct(e.cropVideo$)?"cover":"contain",...t};return e instanceof xv?w.jsx(ape,{vm:e,...n}):w.jsx(J_,{mirror:!1,...n})};cpe.displayName="SpotlightUserMediaItem";const lpe=({ref:e,vm:t,targetWidth:n,targetHeight:r,intersectionObserver$:i,snap:o,"aria-hidden":s})=>{const a=_.useRef(null),l=Q_(a,e),c=ct(t.displayName$),u=ct(t.video$),d=ct(t.videoEnabled$),h=ct(t.unencryptedWarning$),p=ct(t.encryptionStatus$);_.useEffect(()=>{const e=a.current;let t=null;const n=i.subscribe(n=>{null==t||t.unobserve(e),n.observe(e),t=n});return()=>{n.unsubscribe(),null==t||t.unobserve(e)}},[i]);const f={ref:l,"data-id":t.id,className:Ne(is.item,{[is.snap]:o}),targetWidth:n,targetHeight:r,video:u,videoEnabled:d,member:t.member,unencryptedWarning:h,displayName:c,encryptionStatus:p,"aria-hidden":s,localParticipant:t.local};return t instanceof pg?w.jsx(J_,{videoFit:"contain",mirror:!1,...f}):w.jsx(cpe,{vm:t,...f})};lpe.displayName="SpotlightItem";const EP=({ref:e,vm:t,expanded:n,onToggleExpanded:r,targetWidth:i,targetHeight:o,showIndicators:s,className:a,style:l})=>{var c;const{t:u}=Je(),[d,h]=OKe(null),p=Q_(d,e),f=ct(t.maximised$),m=ct(t.media$),[v,g]=_.useState(null==(c=m[0])?void 0:c.id),y=xf(m),b=xf(v),S=m.findIndex(e=>e.id===v),E=S>0,C=-1!==S&&S<m.length-1,k=_.useCallback(()=>!(!document.body||!document.fullscreenElement),[]),T=k()?Jnt:Ynt,R=_.useCallback(()=>{const e=document.body;e&&(k()?null==document||document.exitFullscreen():e.requestFullscreen())},[k]),I=el(()=>h.pipe(ke(e=>new IntersectionObserver(e=>{const t=e.find(e=>e.isIntersecting);void 0!==t&&g(t.target.getAttribute("data-id"))},{root:e,threshold:.5})))),[x,P]=SD(e=>null==e||e===v||m.every(t=>t.id!==e)?null:e,[v]),L=_.useCallback(()=>{const e=y.current,t=e.findIndex(e=>e.id===b.current);t>0&&P(e[t-1].id)},[b,y,P]),M=_.useCallback(()=>{const e=y.current,t=e.findIndex(e=>e.id===b.current);-1!==t&&t!==e.length-1&&P(e[t+1].id)},[b,y,P]),O=n?hoe:boe;return w.jsxs(Mhe.div,{ref:p,className:Ne(a,is.tile,{[is.maximised]:f}),style:l,children:[E&&w.jsx("button",{className:Ne(is.advance,is.back),"aria-label":u("common.back"),onClick:L,children:w.jsx(QOe,{"aria-hidden":!0,width:24,height:24})}),w.jsx("div",{className:is.contents,children:m.map(e=>w.jsx(lpe,{vm:e,targetWidth:i,targetHeight:o,intersectionObserver$:I,snap:null===x||x===e.id,"aria-hidden":(x??v)!==e.id},e.id))}),w.jsxs("div",{className:is.bottomRightButtons,children:[w.jsx("button",{className:Ne(is.expand),"aria-label":"maximise",onClick:R,children:w.jsx(T,{"aria-hidden":!0,width:20,height:20})}),r&&w.jsx("button",{className:Ne(is.expand),"aria-label":u(n?"video_tile.collapse":"video_tile.expand"),onClick:r,children:w.jsx(O,{"aria-hidden":!0,width:20,height:20})})]}),C&&w.jsx("button",{className:Ne(is.advance,is.next),"aria-label":u("common.next"),onClick:M,children:w.jsx(Use,{"aria-hidden":!0,width:24,height:24})}),!n&&w.jsx("div",{className:Ne(is.indicators,{[is.show]:s&&m.length>1}),children:m.map(e=>w.jsx("div",{className:is.item,"data-visible":e.id===v},e.id))})]})};EP.displayName="SpotlightTile";const urt="_fixed_r39jt_8",drt="_scrolling_r39jt_9",frt="_slot_r39jt_21",IE={fixed:urt,scrolling:drt,slot:frt},hrt={inline:"end",block:"end"},prt={inline:"end",block:"start"},PY=17/9,e5=4/3;function ED(e,t,n){const r=e<800?16:20,i=e*t,o=Math.pow(Math.sqrt(i)/8+125,2),s=Math.min(n,i/o);let a=Math.min(s,Math.round(Math.sqrt(e/t/e5*s))),l=s/a;s===n&&(l=Math.ceil(l),a=Math.ceil(n/l));let c=(e-(a+1)*r)/a,u=(t-(l-1)*r)/l;const d=c/u;return d>PY?c=u*PY:d<e5&&(u=c/e5),{tileWidth:c,tileHeight:u,gap:r,columns:a}}const mrt=({minBounds$:e,spotlightAlignment$:t})=>({scrollingOnTop:!1,fixed:function({ref:e,model:n,Slot:r}){al();const i=Ci(el(()=>t.pipe(Qo((e,t)=>e.block===t.block&&e.inline===t.inline)))),o=_.useCallback(({xRatio:e,yRatio:n})=>t.next({block:n<.5?"start":"end",inline:e<.5?"start":"end"}),[]);return w.jsx("div",{ref:e,className:IE.fixed,children:n.spotlight&&w.jsx(r,{className:IE.slot,id:"spotlight",model:n.spotlight,onDrag:o,"data-block-alignment":i.block,"data-inline-alignment":i.inline})})},scrolling:function({ref:t,model:n,Slot:r}){al(),_D(n.setVisibleTiles);const{width:i,height:o}=Ci(e),{gap:s,tileWidth:a,tileHeight:l}=_.useMemo(()=>ED(i,o,n.grid.length),[i,o,n.grid.length]);return w.jsx("div",{ref:t,className:IE.scrolling,style:{width:i,"--gap":`${s}px`,"--width":`${Math.floor(a)}px`,"--height":`${Math.floor(l)}px`},children:n.grid.map(e=>w.jsx(r,{className:IE.slot,id:e.id,model:e},e.id))})}}),grt="_layer_mc5gk_8",vrt="_container_mc5gk_14",yrt="_local_mc5gk_18",brt="_slot_mc5gk_31",kE={layer:grt,container:vrt,local:yrt,slot:brt},_rt=({minBounds$:e,pipAlignment$:t})=>({scrollingOnTop:!1,fixed:function({ref:e}){return al(),w.jsx("div",{ref:e})},scrolling:function({ref:n,model:r,Slot:i}){al();const{width:o,height:s}=Ci(e),a=ct(t),{tileWidth:l,tileHeight:c}=_.useMemo(()=>ED(o,s,1),[o,s]),u=_.useCallback(({xRatio:e,yRatio:n})=>t.next({block:n<.5?"start":"end",inline:e<.5?"start":"end"}),[]);return w.jsx("div",{ref:n,className:kE.layer,children:w.jsx(i,{id:r.remote.id,model:r.remote,className:kE.container,style:{width:l,height:c},children:w.jsx(i,{className:Ne(kE.slot,kE.local),id:r.local.id,model:r.local,onDrag:u,"data-block-alignment":a.block,"data-inline-alignment":a.inline})})})}}),Srt="_layer_1swii_8",Ert="_spotlight_1swii_12",wrt="_pip_1swii_17",xE={layer:Srt,spotlight:Ert,pip:wrt},Crt=({pipAlignment$:e})=>({scrollingOnTop:!0,fixed:function({ref:e,model:t,Slot:n}){return al(),w.jsx("div",{ref:e,className:xE.layer,children:w.jsx(n,{className:xE.spotlight,id:"spotlight",model:t.spotlight})})},scrolling:function({ref:t,model:n,Slot:r}){al();const i=ct(e),o=_.useCallback(({xRatio:t,yRatio:n})=>e.next({block:n<.5?"start":"end",inline:t<.5?"start":"end"}),[]);return w.jsx("div",{ref:t,className:xE.layer,children:n.pip&&w.jsx(r,{className:xE.pip,id:n.pip.id,model:n.pip,onDrag:o,"data-block-alignment":i.block,"data-inline-alignment":i.inline})})}}),Trt="_layer_jsvx2_8",Rrt="_spotlight_jsvx2_19",Irt="_slot_jsvx2_28",krt="_grid_jsvx2_34",jl={layer:Trt,spotlight:Rrt,slot:Irt,grid:krt},xrt=({minBounds$:e})=>({scrollingOnTop:!1,fixed:function({ref:t,model:n,Slot:r}){return al(),Ci(e),w.jsxs("div",{ref:t,className:jl.layer,children:[w.jsx("div",{className:jl.spotlight,children:w.jsx(r,{className:jl.slot,id:"spotlight",model:n.spotlight})}),w.jsx("div",{className:jl.grid})]})},scrolling:function({ref:t,model:n,Slot:r}){al(),_D(n.setVisibleTiles),Ci(e);const i=Ci(n.spotlight.media$).length>1;return w.jsxs("div",{ref:t,className:jl.layer,children:[w.jsx("div",{className:Ne(jl.spotlight,{[jl.withIndicators]:i})}),w.jsx("div",{className:jl.grid,children:n.grid.map(e=>w.jsx(r,{className:jl.slot,id:e.id,model:e},e.id))})]})}}),Art="_layer_1q32d_8",Lrt="_spotlight_1q32d_17",Prt="_withIndicators_1q32d_26",Ort="_slot_1q32d_30",Mrt="_grid_1q32d_35",Td={layer:Art,spotlight:Lrt,withIndicators:Prt,slot:Ort,grid:Mrt},Drt=({minBounds$:e})=>({scrollingOnTop:!1,fixed:function({ref:e,model:t,Slot:n}){return al(),w.jsx("div",{ref:e,className:Td.layer,children:w.jsx("div",{className:Td.spotlight,children:w.jsx(n,{className:Td.slot,id:"spotlight",model:t.spotlight})})})},scrolling:function({ref:t,model:n,Slot:r}){al(),_D(n.setVisibleTiles);const{width:i}=Ci(e),{gap:o,tileWidth:s,tileHeight:a}=ED(i,i,n.grid.length),l=ct(n.spotlight.media$).length>1;return w.jsxs("div",{ref:t,className:Td.layer,style:{"--grid-gap":`${o}px`,"--grid-tile-width":`${Math.floor(s)}px`,"--grid-tile-height":`${Math.floor(a)}px`},children:[w.jsx("div",{className:Ne(Td.spotlight,{[Td.withIndicators]:l})}),w.jsx("div",{className:Td.grid,children:n.grid.map(e=>w.jsx(r,{className:Td.slot,id:e.id,model:e},e.id))})]})}});async function Nrt(e,t,n,r){const i=e.createGain();i.gain.setValueAtTime(n,0);const o=e.createStereoPanner();o.pan.setValueAtTime(r,0);const s=e.createBufferSource();s.buffer=t,s.connect(i).connect(o).connect(e.destination);const a=new Promise(e=>s.addEventListener("ended",()=>e()));return Nle(),s.start(),a}function wD(e){var t;const[n]=Bn(mle),[r,i]=_.useState(),[o,s]=_.useState();_.useEffect(()=>{const t=e.sounds;if(!t)return;const n=new AudioContext({latencyHint:e.latencyHint});return(async()=>{const e={};for(const[r,i]of Object.entries(await t)){const t=await n.decodeAudioData(i.slice(0));e[r]=t}s(e)})().catch(e=>{M.debug("Failed to setup audio context",e)}),i(n),()=>{n.close().catch(e=>{M.debug("Failed to close audio engine",e)}),i(void 0)}},[e.sounds,e.latencyHint]);const a=null==(t=Ci(Gu().audioOutput.selected$))?void 0:t.id,{controlledAudioDevices:l}=Xs();_.useEffect(()=>{r&&"setSinkId"in r&&!l&&r.setSinkId(a).catch(e=>{M.warn("Unable to change sink for audio context",e)})},[r,a,l]);const{pan:c,volume:u}=$le();return r&&o&&!e.muted?{playSound:async e=>{if(o[e])return Nrt(r,o[e],n*u,c);M.debug(`Tried to play a sound that wasn't buffered (${e})`)}}:null}function Urt(){return"maybe"===document.createElement("audio").canPlayType("audio/ogg")?"ogg":"mp3"}const jrt=Urt();async function upe(e){const t={};return await Promise.all(Object.entries(e).map(async([e,n])=>{const{mp3:r,ogg:i}=n,o=await fetch("ogg"===jrt?i:r??i);ZM(o)?M.warn(`Could not load sound ${e}, response was not okay`):t[e]=await o.arrayBuffer()})),t}const OY=Object.fromEntries([...Db.filter(e=>void 0!==e.sound).map(e=>[e.name,e.sound]),[x7.name,x7.sound]]);function Frt({vm:e,muted:t}){const[n]=Bn(I8),[r,i]=_.useState(null),o=xf(wD({sounds:r,latencyHint:"interactive",muted:t}));return _.useEffect(()=>{!n||r||i(upe(OY))},[r,n]),_.useEffect(()=>{const t=e.audibleReactions$.subscribe(e=>{var t,n;for(const r of e)OY[r]?null==(t=o.current)||t.playSound(r):null==(n=o.current)||n.playSound("generic")});return()=>{t.unsubscribe()}},[e,o]),null}const $rt="_container_1ux8r_1",Brt="_reaction_1ux8r_12",MY={container:$rt,reaction:Brt};function Hrt({vm:e}){const t=ct(e.visibleReactions$);return w.jsx("div",{className:MY.container,children:t.map(({sender:e,emoji:t,startX:n})=>w.jsx("span",{role:"presentation",style:{left:`${n}vw`},className:MY.reaction,children:t},e))})}const Vrt=""+new URL("join_call-dEJCP2wD.mp3",import.meta.url).href,qrt=""+new URL("join_call-DlMV9nHk.ogg",import.meta.url).href,Grt=""+new URL("left_call-BbqmRgnC.mp3",import.meta.url).href,Krt=""+new URL("left_call-C7NMl6WI.ogg",import.meta.url).href,zrt=""+new URL("raise_hand-CUbxEnt9.ogg",import.meta.url).href,Wrt=""+new URL("raise_hand-Bzqn65WB.mp3",import.meta.url).href,Yrt=""+new URL("screen_share_started-IZDL-kAw.ogg",import.meta.url).href,Xrt=""+new URL("screen_share_started-DH3qxml5.mp3",import.meta.url).href,DY=8,NY=500,dpe=upe({join:{mp3:Vrt,ogg:qrt},left:{mp3:Grt,ogg:Krt},raiseHand:{mp3:Wrt,ogg:zrt},screenshareStarted:{mp3:Xrt,ogg:Yrt}});function Jrt({vm:e,muted:t}){const n=xf(wD({sounds:dpe,latencyHint:"interactive",muted:t}));return _.useEffect(()=>{const t=e.participantChanges$.pipe($s(({joined:e,ids:t})=>t.length<=8&&e.length>0),M7(()=>P7(NY))).subscribe(()=>{var e;null==(e=n.current)||e.playSound("join")}),r=e.participantChanges$.pipe($s(({ids:e,left:t})=>e.length<=8&&t.length>0),M7(()=>P7(NY))).subscribe(()=>{var e;null==(e=n.current)||e.playSound("left")}),i=e.newHandRaised$.subscribe(()=>{var e;null==(e=n.current)||e.playSound("raiseHand")}),o=e.newScreenShare$.subscribe(()=>{var e;null==(e=n.current)||e.playSound("screenshareStarted")});return()=>{t.unsubscribe(),r.unsubscribe(),i.unsubscribe(),o.unsubscribe()}},[n,e]),w.jsx(w.Fragment,{})}const UY=3e3;class Qrt{constructor(e){this.rtcSession=e,this.raisedHandsSubject$=new ms({}),this.reactionsSubject$=new ms({}),this.raisedHands$=this.raisedHandsSubject$.asObservable(),this.reactions$=this.reactionsSubject$.asObservable(),this.onMembershipsChanged=e=>{for(const t of Object.keys(this.raisedHandsSubject$.value).filter(t=>e.find(e=>e.sender==t)))this.removeRaisedHand(t);for(const e of this.rtcSession.memberships){if(!e.sender||!e.eventId)continue;const t=`${e.sender}:${e.deviceId}`;this.raisedHandsSubject$.value[t]&&this.raisedHandsSubject$.value[t].membershipEventId!==e.eventId&&this.removeRaisedHand(t);const n=this.getLastReactionEvent(e.eventId,e.sender);if(n){const t=null==n?void 0:n.getId();if(!t)continue;this.addRaisedHand(`${e.sender}:${e.deviceId}`,{membershipEventId:e.eventId,reactionEventId:t,time:new Date(n.localTimestamp)})}}},this.handleReactionEvent=e=>{var t,n,r;const i=this.rtcSession.room;if(e.getRoomId()!==i.roomId||e.isSending())return;const o=e.getSender(),s=e.getId();if(o&&s&&(i.client.decryptEventIfNeeded(e).catch(t=>M.warn(`Failed to decrypt ${e.getId()}`,t)),!e.isBeingDecrypted()&&!e.isDecryptionFailure()))if(e.getType()===y8){const r=e.getContent(),i=null==(t=null==r?void 0:r["m.relates_to"])?void 0:t.event_id,a=this.rtcSession.memberships.find(e=>e.eventId===i&&e.sender===o);if(!a)return void M.warn(`Reaction target was not a membership event for ${o}, ignoring`);const l=`${a.sender}:${a.deviceId}`;if(!r.emoji)return void M.warn(`Reaction had no emoji from ${s}`);const c=null==(n=new Intl.Segmenter(void 0,{granularity:"grapheme"}).segment(r.emoji)[Symbol.iterator]().next().value)?void 0:n.segment;if(null==c||!c.trim())return void M.warn(`Reaction had no emoji from ${s} after splitting`);const u={...x7,emoji:c,...Db.find(e=>e.name===r.name)},d=this.reactionsSubject$.value;if(d[l])return void M.warn(`Got reaction from ${l} but one is still playing`);this.reactionsSubject$.next({...d,[l]:{reactionOption:u,expireAfter:new Date(Date.now()+UY)}})}else if(e.getType()===ee.Reaction){const t=e.getContent(),n=t["m.relates_to"].event_id,r=this.rtcSession.memberships.find(e=>e.eventId===n&&e.sender===o);if(!r)return void M.warn(`Reaction target was not a membership event for ${o}, ignoring`);"🖐️"===(null==t?void 0:t["m.relates_to"].key)&&this.addRaisedHand(`${r.sender}:${r.deviceId}`,{reactionEventId:s,membershipEventId:n,time:new Date(e.localTimestamp)})}else if(e.getType()===ee.RoomRedaction){const t=e.event.redacts,n=null==(r=Object.entries(this.raisedHandsSubject$.value).find(([e,n])=>n.reactionEventId===t))?void 0:r[0];if(!n)return;this.removeRaisedHand(n)}},this.reactionsSub=this.reactionsSubject$.pipe(hqe(UY)).subscribe(e=>{const t=new Date,n=Object.fromEntries(Object.entries(e).filter(([e,n])=>n.expireAfter>t));Object.keys(e).length!==Object.keys(n).length&&this.reactionsSubject$.next(n)}),this.rtcSession.room.on(xe.Timeline,this.handleReactionEvent),this.rtcSession.room.on(xe.Redaction,this.handleReactionEvent),this.rtcSession.room.client.on(qt.Decrypted,this.handleReactionEvent),this.rtcSession.room.on(xe.LocalEchoUpdated,this.handleReactionEvent),e.on(yi.MembershipsChanged,this.onMembershipsChanged),this.onMembershipsChanged([])}getLastReactionEvent(e,t){const n=this.rtcSession.room.relations.getChildEventsForEvent(e,kn.Annotation,ee.Reaction);return((null==n?void 0:n.getRelations())??[]).find(e=>{var n,r;return e.event.sender===t&&e.getType()===ee.Reaction&&"🖐️"===(null==(r=null==(n=e.getContent())?void 0:n["m.relates_to"])?void 0:r.key)})}addRaisedHand(e,t){this.raisedHandsSubject$.next({...this.raisedHandsSubject$.value,[e]:t})}removeRaisedHand(e){this.raisedHandsSubject$.next(Object.fromEntries(Object.entries(this.raisedHandsSubject$.value).filter(([t])=>t!==e)))}destroy(){this.rtcSession.off(yi.MembershipsChanged,this.onMembershipsChanged),this.rtcSession.room.off(xe.Timeline,this.handleReactionEvent),this.rtcSession.room.off(xe.Redaction,this.handleReactionEvent),this.rtcSession.room.client.off(qt.Decrypted,this.handleReactionEvent),this.rtcSession.room.off(xe.LocalEchoUpdated,this.handleReactionEvent),this.reactionsSub.unsubscribe()}}function Zrt({members:e,muted:t}){const n=_.useMemo(()=>new Set(null==e?void 0:e.map(e=>`${e.sender}:${e.deviceId}`)),[e]),r=_.useRef(new Set),i=FJe([he.Source.Microphone,he.Source.ScreenShareAudio,he.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(e=>{const t=null==n?void 0:n.has(e.participant.identity);return!t&&!e.participant.isLocal&&((e,t)=>{r.current.has(e)||(M.warn(`[MatrixAudioRenderer] Audio track ${e} has no matching matrix call member`,`current members: ${Array.from(t.values())}`,"track will not get rendered"),r.current.add(e))})(e.participant.identity,n),!e.participant.isLocal&&e.publication.kind===he.Kind.Audio&&t});_.useEffect(()=>{i.some(e=>!n.has(e.participant.identity))||(M.debug("[MatrixAudioRenderer] All audio tracks have a matching matrix call member identity."),r.current.clear())},[i,n]);const{pan:o,volume:s}=$le(),a=0!==o,[l,c]=_.useState(void 0);_.useEffect(()=>{const e=new AudioContext;return c(e),()=>{e.close()}},[]);const u=_.useMemo(()=>({gain:null==l?void 0:l.createGain(),pan:null==l?void 0:l.createStereoPanner()}),[l]);return _.useEffect(()=>{u.pan&&(u.pan.pan.value=o)},[u.pan,o]),_.useEffect(()=>{u.gain&&(u.gain.gain.value=s)},[u.gain,s]),w.jsx("div",{style:{display:"none"},children:i.map(e=>w.jsx(eit,{trackRef:e,muted:t,audioContext:a?l:void 0,audioNodes:u},fKe(e)))})}function eit({trackRef:e,muted:t,audioContext:n,audioNodes:r,...i}){const[o,s]=SD(()=>!1,[n&&r]);return _.useEffect(()=>{if(!e||o)return;const t=e.publication.track,i=n&&r.gain&&r.pan;t.setAudioContext(i?n:void 0),t.setWebAudioPlugins(i?[r.gain,r.pan]:[]),s(!0),Nle()},[n,r,s,o,e]),o&&w.jsx(YJe,{trackRef:e,muted:t,...i})}const fpe=rZe.behavior(ln([N7.pipe(un(!0)),vle.value$],(e,t)=>!e||t)),tit="_overlay_1rwu2_1",nit="_icon_1rwu2_50",rit="_spacer_1rwu2_65",t5={overlay:tit,icon:nit,spacer:rit},iit=({show:e,onBackToVideoPressed:t})=>{const{t:n}=Je();return w.jsxs("div",{className:t5.overlay,"data-show":e,children:[w.jsx(Zse,{className:t5.icon,children:w.jsx(zMe,{"aria-hidden":!0})}),w.jsx(ml,{as:"h2",weight:"semibold",size:"md",children:n("handset.overlay_title")}),w.jsx(on,{children:n("handset.overlay_description")}),w.jsx(Ft,{kind:"primary",size:"sm",onClick:()=>{null==t||t()},children:n("handset.overlay_back_button")}),w.jsx("div",{className:t5.spacer})]})},sit="_bar_32sbm_1",oit={bar:sit},zR=_.createContext(null),ait=({children:e})=>{const{t}=Je(),n=_.useCallback(e=>{var t,n;e.preventDefault(),null==(n=(t=window.controls).onBackButtonPressed)||n.call(t)},[]),[r,i]=_.useState(""),[o,s]=_.useState(!1),[a,l]=_.useState(null),c=_.useMemo(()=>({setTitle:i,setSecondaryButton:l,setHidden:s}),[i,s,l]);return w.jsxs(w.Fragment,{children:[w.jsx("div",{style:{display:o?"none":"block"},className:oit.bar,children:w.jsxs(Bu,{disconnectedBanner:!1,children:[w.jsx(Df,{children:w.jsx(Fi,{label:t("common.back"),children:w.jsx(wT,{onClick:n,children:w.jsx(hoe,{})})})}),r&&w.jsx(ml,{type:"body",size:"lg",weight:"android"===tc?"medium":"semibold",children:r}),w.jsx(Nf,{children:a})]})}),w.jsx(zR,{value:c,children:e})]})};function cit(e){var t;const n=null==(t=_.use(zR))?void 0:t.setTitle;_.useEffect(()=>{if(void 0!==n)return n(e),()=>n("")},[e,n])}function lit(e){var t;const n=null==(t=_.use(zR))?void 0:t.setHidden;_.useEffect(()=>{if(void 0!==n)return n(e),()=>n(!1)},[n,e])}function uit(e){var t;const n=null==(t=_.use(zR))?void 0:t.setSecondaryButton;_.useEffect(()=>{if(void 0!==n)return n(e),()=>n("")},[e,n])}const dit="_toast_z5w27_8",fit={toast:dit},hpe=({open:e,onDismiss:t,autoDismiss:n,children:r,Icon:i,portal:o=!0})=>{const s=_.useCallback(e=>{e||t()},[t]);_.useEffect(()=>{if(e&&void 0!==n){const e=setTimeout(t,n);return()=>clearTimeout(e)}},[e,n,t]);const a=w.jsxs(w.Fragment,{children:[w.jsx(SM,{className:Ne(Hc.bg,Hc.animate)}),w.jsx(EM,{"aria-describedby":void 0,asChild:!0,children:w.jsxs(mse,{className:Ne(Hc.overlay,Hc.animate,fit.toast),children:[w.jsx(wM,{asChild:!0,children:w.jsx(on,{as:"h3",size:"sm",weight:"semibold",children:r})}),i&&w.jsx(i,{width:20,height:20,"aria-hidden":!0})]})})]});return w.jsx(bM,{open:e,onOpenChange:s,children:o?w.jsx(_M,{children:a}):a})},hit="getDisplayMedia"in(navigator.mediaDevices??{}),pit=400,mit=e=>{const t=Gu(),n=Stt(e.client,e.rtcSession),{livekitRoom:r,connState:i}=Itt(e.rtcSession,e.muteStates,n,e.e2eeSystem),o=j8(e=>e.pipe(ke(([e])=>e)),[i]),[s,a]=_.useState(null);_.useEffect(()=>(M.info(`[Lifecycle] InCallView Component mounted, livekit room state ${null==r?void 0:r.state}`),()=>{M.info(`[Lifecycle] InCallView Component unmounted, livekit room state ${null==r?void 0:r.state}`),null==r||r.disconnect().then(()=>{M.info(`[Lifecycle] Disconnected from livekit room, state:${null==r?void 0:r.state}`)}).catch(e=>{M.error("[Lifecycle] Failed to disconnect from livekit room",e)})}),[r]);const{autoLeaveWhenOthersLeft:l}=Xs();return _.useEffect(()=>{if(void 0!==r){const n=new Qrt(e.rtcSession),i=new Ktt(e.rtcSession,e.matrixRoom,r,t,{encryptionSystem:e.e2eeSystem,autoLeaveWhenOthersLeft:l},o,n.raisedHands$,n.reactions$);return a(i),()=>{i.destroy(),n.destroy()}}},[e.rtcSession,e.matrixRoom,r,t,e.e2eeSystem,o,l]),void 0===r||null===s?null:w.jsx(qfe,{value:r,children:w.jsx(Bqe,{vm:s,rtcSession:e.rtcSession,children:w.jsx(git,{...e,vm:s,livekitRoom:r,connState:i})})})},git=({client:e,vm:t,matrixInfo:n,rtcSession:r,matrixRoom:i,livekitRoom:o,muteStates:s,participantCount:a,onLeave:l,header:c,connState:u,onShareClick:d})=>{const{t:h}=Je(),{supportsReactions:p,sendReaction:f,toggleRaisedHand:m}=L8();if(ktt(),u===Pt.Disconnected)throw new yD;const v=_.useRef(null),[g,y]=Ky(),b=Q_(v,g),{hideScreensharing:S,showControls:E}=Xs(),{isScreenShareEnabled:C,localParticipant:k}=jJe({room:o}),T=ct(fpe),[R,I]=_.useState(!1);Tle(r,a_.EnabledTransportsChanged,e=>I(e.room));const[x]=Bn(T8),[P]=Bn(k8),L=H_(i.roomId),O=A8(r),A=_.useMemo(()=>x&&P&&L.kind===sn.PER_PARTICIPANT&&!R,[x,P,L.kind,R]),D=_.useCallback(()=>{var e,t;return null==(t=(e=s.audio).setEnabled)?void 0:t.call(e,e=>!e)},[s]),N=_.useCallback(()=>{var e,t;return null==(t=(e=s.video).setEnabled)?void 0:t.call(e,e=>!e)},[s]);XQe(v,D,N,e=>{var t,n;return null==(n=(t=s.audio).setEnabled)?void 0:n.call(t,!e)},e=>{f(e)},()=>{m()});const j=ct(t.reconnecting$),F=ct(t.windowMode$),U=ct(t.layout$),B=ct(t.tileStoreGeneration$),[H]=Bn(R8),$=ct(t.gridMode$),V=ct(t.showHeader$),q=ct(t.showFooter$),G=ct(t.earpieceMode$),z=ct(t.audioOutputSwitcher$);PKe(t.autoLeaveWhenOthersLeft$,l);const K=_.useRef(null),W=_.useCallback(()=>K.current=Date.now(),[]),J=_.useCallback(()=>{const e=K.current;null!==e&&Date.now()-e<=400&&t.tapScreen(),K.current=null},[t]),Y=_.useCallback(()=>K.current=null,[]),X=_.useCallback(e=>{q?(e.stopPropagation(),t.tapControls()):e.preventDefault()},[t,q]),Q=_.useCallback(e=>{"mouse"===e.pointerType&&t.hoverScreen()},[t]),Z=_.useCallback(()=>t.unhoverScreen(),[t]),[ee,te]=_.useState(!1),[ne,re]=_.useState(W9),ie=_.useCallback(()=>te(!0),[te]),oe=_.useCallback(()=>te(!1),[te]),se=_.useMemo(()=>null===Qe?()=>{re("profile"),te(!0)}:null,[re,te]),[ae,le]=Ky(),[ce,ue]=Ky(),de=_.useMemo(()=>({width:y.width,height:y.height-le.height-("flat"===F?0:ue.height)}),[y.width,y.height,le.height,ue.height,F]),he=j8(e=>e.pipe(ke(([e])=>e)),[de]),pe=el(()=>new ms(hrt)),fe=el(()=>new ms(prt)),me=_.useCallback(e=>t.setGridMode(e),[t]);_.useEffect(()=>{null==Qe||Qe.api.transport.send("grid"===$?Si.TileLayout:Si.SpotlightLayout,{}).catch(e=>{M.error("Failed to send layout change to widget API",e)})},[$]),_.useEffect(()=>{if(Qe){const e=e=>{me("grid"),Qe.api.transport.reply(e.detail,{})},t=e=>{me("spotlight"),Qe.api.transport.reply(e.detail,{})};return Qe.lazyActions.on(Si.TileLayout,e),Qe.lazyActions.on(Si.SpotlightLayout,t),()=>{Qe.lazyActions.off(Si.TileLayout,e),Qe.lazyActions.off(Si.SpotlightLayout,t)}}},[me]),uit(_.useMemo(()=>{if(null===z)return null;const e="earpiece"===z.targetOutput,t=e?KMe:XMe,n=h(e?"settings.devices.handset":"settings.devices.loudspeaker");return w.jsx(Fi,{label:n,children:w.jsx(wT,{onClick:e=>{e.preventDefault(),z.switch()},children:w.jsx(t,{})})})},[h,z])),lit(!V);let ve=null;if(V)switch(c){case"none":ve=w.jsx("div",{className:Ne(fr.header,fr.filler),ref:ae});break;case"standard":ve=w.jsxs(Bu,{className:fr.header,ref:ae,disconnectedBanner:!1,children:[w.jsx(Df,{children:w.jsx(tae,{id:n.roomId,name:n.roomName,avatarUrl:n.roomAvatar,encrypted:n.e2eeSystem.kind!==sn.NONE,participantCount:a})}),w.jsx(Nf,{children:E&&null!==d&&w.jsx(Yfe,{className:fr.invite,onClick:d})})]})}const ge=_.useMemo(()=>function({ref:e,className:n,style:r,targetWidth:i,targetHeight:o,model:s}){const a=ct(t.spotlightExpanded$),l=ct(t.toggleSpotlightExpanded$),c=ct(t.showSpeakingIndicators$),u=ct(t.showSpotlightIndicators$);return s instanceof Ghe?w.jsx(jhe,{ref:e,vm:s,onOpenProfile:se,targetWidth:i,targetHeight:o,className:Ne(n,fr.tile),style:r,showSpeakingIndicators:c}):w.jsx(EP,{ref:e,vm:s,expanded:a,onToggleExpanded:l,targetWidth:i,targetHeight:o,showIndicators:u,className:Ne(n,fr.tile),style:r})},[t,se]),ye=_.useMemo(()=>{const e={minBounds$:he,spotlightAlignment$:pe,pipAlignment$:fe};return{grid:mrt(e),"spotlight-landscape":xrt(e),"spotlight-portrait":Drt(e),"spotlight-expanded":Crt(e),"one-on-one":_rt(e)}},[he,pe,fe]),be=Pqe(i.roomId),we=_.useCallback(()=>{k.setScreenShareEnabled(!C,{audio:!0,selfBrowserSurface:"include",surfaceSwitching:"include",systemAudio:"include"}).catch(M.error)},[k,C]),_e=[];_e.push(w.jsx(_le,{muted:!s.audio.enabled,onClick:D,onTouchEnd:X,disabled:null===s.audio.setEnabled,"data-testid":"incall_mute"},"audio"),w.jsx(Sle,{muted:!s.video.enabled,onClick:N,onTouchEnd:X,disabled:null===s.video.setEnabled,"data-testid":"incall_videomute"},"video")),hit&&!S&&_e.push(w.jsx(jqe,{className:fr.shareScreen,enabled:C,onClick:we,onTouchEnd:X,"data-testid":"incall_screenshare"},"share_screen")),p&&_e.push(w.jsx(EGe,{vm:t,className:fr.raiseHand,identifier:`${e.getUserId()}:${e.getDeviceId()}`,onTouchEnd:X},"raise_hand")),"pip"!==U.type&&_e.push(w.jsx(wle,{onClick:ie,onTouchEnd:X},"settings")),_e.push(w.jsx(Ele,{onClick:function(){l()},onTouchEnd:X,"data-testid":"incall_leave"},"end_call"));const Se=w.jsxs("div",{ref:ce,className:Ne(fr.footer,{[fr.overlay]:"flat"===F,[fr.hidden]:!q||!E&&"none"===c}),children:["none"!==c&&w.jsxs("div",{className:fr.logo,children:[w.jsx(zQe,{width:24,height:24,"aria-hidden":!0}),w.jsx(YQe,{width:80,height:11,"aria-label":"Element Call"}),H?`Tiles generation: ${B}`:void 0]}),E&&w.jsx("div",{className:fr.buttons,children:_e}),E&&w.jsx(Ltt,{className:fr.layout,layout:$,setLayout:me,onTouchEnd:X})]}),Ee=_.useCallback(()=>{},[]);return w.jsxs("div",{className:fr.inRoom,ref:b,onTouchStart:W,onTouchEnd:J,onTouchCancel:Y,onPointerMove:Q,onPointerOut:Z,children:[ve,A&&w.jsx(on,{style:{height:0,zIndex:1,alignSelf:"center",margin:0},size:"sm",children:"using to Device key transport"}),w.jsx(Zrt,{members:O,muted:T}),(()=>{if("pip"===U.type)return w.jsx(EP,{className:Ne(fr.tile,fr.maximised),vm:U.spotlight,expanded:!0,onToggleExpanded:null,targetWidth:de.height,targetHeight:de.width,showIndicators:!1});const e=ye[U.type],t=w.jsx(LY,{className:fr.fixedGrid,style:{insetBlockStart:le.height>0?le.bottom:y.top,height:de.height},model:U,Layout:e.fixed,Tile:ge},"fixed"),n=w.jsx(LY,{className:fr.scrollingGrid,model:U,Layout:e.scrolling,Tile:ge},"scrolling");return"spotlight-expanded"===U.type?w.jsxs(w.Fragment,{children:[t,n]}):w.jsxs(w.Fragment,{children:[n,t]})})(),w.jsx(Jrt,{vm:t,muted:T}),w.jsx(Frt,{vm:t,muted:T}),w.jsx(hpe,{onDismiss:Ee,open:j,portal:!1,children:h("common.reconnecting")}),w.jsx(iit,{show:G&&!j,onBackToVideoPressed:null==z?void 0:z.switch}),w.jsx(Hrt,{vm:t}),Se,"pip"!==U.type&&w.jsxs(w.Fragment,{children:[w.jsx(Wet,{...be}),w.jsx(Y9,{client:e,roomId:i.roomId,open:ee,onDismiss:oe,tab:ne,onTabChange:re,livekitRoom:o})]})]})},vit=8,yit={enabled:!1,setEnabled:null};function jY(e,t,n=!1){const r=Ci(e.available$),[i,o]=SD(e=>e??(r.size>0?t():void 0),[r.size]);return _.useMemo(()=>0===r.size||n?yit:{enabled:i??!1,setEnabled:o},[r.size,i,n,o])}function bit(e){const t=Gu(),{skipLobby:n}=Xs(),r=jY(t.audioInput,()=>Zt.get().media_devices.enable_audio&&!n&&!e);_.useEffect(()=>{r.enabled&&t.requestDeviceNames()},[r.enabled,t]);const i=MKe(),o=jY(t.videoInput,()=>Zt.get().media_devices.enable_video&&!n&&!e,i);_.useEffect(()=>{null==Qe||Qe.api.transport.send(Si.DeviceMute,{audio_enabled:r.enabled,video_enabled:o.enabled}).catch(e=>M.warn("Could not send DeviceMute action to widget",e))},[r,o]);const s=_.useCallback(e=>{var t,n;const i={audio_enabled:r.enabled,video_enabled:o.enabled};null!=e.detail.data.audio_enabled&&"boolean"==typeof e.detail.data.audio_enabled&&(null==(t=r.setEnabled)||t.call(r,e.detail.data.audio_enabled),i.audio_enabled=e.detail.data.audio_enabled),null!=e.detail.data.video_enabled&&"boolean"==typeof e.detail.data.video_enabled&&(null==(n=o.setEnabled)||n.call(o,e.detail.data.video_enabled),i.video_enabled=e.detail.data.video_enabled),Qe.api.transport.reply(e.detail,i)},[r,o]);return _.useEffect(()=>{if(Qe)return Qe.lazyActions.on(Si.DeviceMute,s),()=>{null==Qe||Qe.lazyActions.off(Si.DeviceMute,s)}},[s]),_.useMemo(()=>({audio:r,video:o}),[r,o])}const _it="org.matrix.msc4143.rtc_foci";function Sit(){return{type:"livekit",focus_selection:"oldest_membership"}}async function Eit(e,t){var n,r;M.log("Start building foci_preferred list: ",e.room.roomId);const i=[],o=e.getFocusInUse();let s;o&&UJ(o)&&(M.log("Adding livekit focus from oldest member: ",o),i.push(o));const a=e.room.client.getDomain();if(a){const e=null==(n=await ht.getRawClientConfig(a))?void 0:n[_it];if(Array.isArray(e)){const n=e.filter(e=>!!e).filter(NJ).map(e=>(M.log("Adding livekit focus from well known: ",e),{...e,livekit_alias:t}));n.length>0&&(s=n[0]),i.push(...n)}}const l=null==(r=Zt.get().livekit)?void 0:r.livekit_service_url;if(l){const e={type:"livekit",livekit_service_url:l,livekit_alias:t};s=s??e,M.log("Adding livekit focus from config: ",e),i.push(e)}if(s&&await Vhe(e.room.client,s),0===i.length)throw new gtt(a??"");return Promise.resolve(i)}async function wit(e,t,n=!0,r=!1){Dt.instance.eventCallEnded.cacheStartCall(new Date),Dt.instance.eventCallStarted.track(e.room.roomId);const i=e.room.roomId,{features:o,matrix_rtc_session:s}=Zt.get(),a=null==o?void 0:o.feature_use_device_session_member_events;if(e.joinRoomSession(await Eit(e,i),Sit(),{notificationType:Fr().sendNotificationType,useNewMembershipManager:n,manageMediaKeys:t,...void 0!==a&&{useLegacyMemberEvents:!a},delayedLeaveEventRestartMs:null==s?void 0:s.delayed_leave_event_restart_ms,delayedLeaveEventDelayMs:null==s?void 0:s.delayed_leave_event_delay_ms,delayedLeaveEventRestartLocalTimeoutMs:null==s?void 0:s.delayed_leave_event_restart_local_timeout_ms,networkErrorRetryMs:null==s?void 0:s.network_error_retry_ms,makeKeyDelay:null==s?void 0:s.wait_for_key_rotation_ms,membershipEventExpiryMs:null==s?void 0:s.membership_event_expiry_ms,useExperimentalToDeviceTransport:r}),Qe)try{await Qe.api.transport.send(Si.JoinCall,{})}catch(e){M.error("Failed to send join action",e)}}const Cit=async(e,t,n)=>{try{await e.api.setAlwaysOnScreen(!1)}catch(e){M.error("Failed to set call widget `alwaysOnScreen` to false",e)}await n;try{await e.api.transport.send(Si.HangupCall,{})}catch(e){M.error("Failed to send hangup action",e)}if("user"===t&&!Fr().returnToLobby){try{await e.api.transport.send(Si.Close,{})}catch(e){M.error("Failed to send close action",e)}e.api.transport.stop()}};async function FY(e,t,n){await e.leaveRoomSession(),Qe?await Cit(Qe,t,n):await n}function ppe(e,t){const n=dp(e,xe.CurrentStateUpdated,_.useCallback(()=>e.currentState,[e]));return dp(n,vt.Update,_.useCallback(()=>t(n),[t,n]))}function Tit(e){return ppe(e,_.useCallback(()=>e.getMxcAvatarUrl(),[e]))}function Rit(e){return dp(e,xe.Name,_.useCallback(()=>e.name,[e]))}function Iit(e){return ppe(e,_.useCallback(e=>e.getJoinRule(),[]))}var n5,$Y,r5,BY;function kit(){return $Y||($Y=1,n5=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],r=0;r<e.rangeCount;r++)n.push(e.getRangeAt(r));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach(function(t){e.addRange(t)}),t&&t.focus()}}),n5}function xit(){if(BY)return r5;BY=1;var e=kit(),t={"text/plain":"Text","text/html":"Url",default:"Text"};return r5=function(n,r){var i,o,s,a,l,c,u=!1;r||(r={}),i=r.debug||!1;try{if(s=e(),a=document.createRange(),l=document.getSelection(),(c=document.createElement("span")).textContent=n,c.ariaHidden="true",c.style.all="unset",c.style.position="fixed",c.style.top=0,c.style.clip="rect(0, 0, 0, 0)",c.style.whiteSpace="pre",c.style.webkitUserSelect="text",c.style.MozUserSelect="text",c.style.msUserSelect="text",c.style.userSelect="text",c.addEventListener("copy",function(e){if(e.stopPropagation(),r.format)if(e.preventDefault(),typeof e.clipboardData>"u"){i&&console.warn("unable to use e.clipboardData"),i&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var o=t[r.format]||t.default;window.clipboardData.setData(o,n)}else e.clipboardData.clearData(),e.clipboardData.setData(r.format,n);r.onCopy&&(e.preventDefault(),r.onCopy(e.clipboardData))}),document.body.appendChild(c),a.selectNodeContents(c),l.addRange(a),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");u=!0}catch(e){i&&console.error("unable to copy using execCommand: ",e),i&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(r.format||"text",n),r.onCopy&&r.onCopy(window.clipboardData),u=!0}catch(e){i&&console.error("unable to copy using clipboardData: ",e),i&&console.error("falling back to prompt"),o=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in r?r.message:"Copy to clipboard: #{key}, Enter"),window.prompt(o,n)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(a):l.removeAllRanges()),c&&document.body.removeChild(c),s()}return u}}var Ait=xit();const Lit=ac(Ait),Pit="_url_1ibuh_8",Oit="_button_1ibuh_15",Mit="_qrCode_1ibuh_19",i5={url:Pit,button:Oit,qrCode:Mit};var s5,HY,Gm={};function Dit(){return HY||(HY=1,s5=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}),s5}var VY,o5={},Rd={};function Mp(){if(VY)return Rd;let e;VY=1;const t=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Rd.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},Rd.getSymbolTotalCodewords=function(e){return t[e]},Rd.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},Rd.setToSJISFunction=function(t){if("function"!=typeof t)throw new Error('"toSJISFunc" is not a valid function.');e=t},Rd.isKanjiModeEnabled=function(){return typeof e<"u"},Rd.toSJIS=function(t){return e(t)},Rd}var qY,c5,GY,l5,KY,a5={};function CD(){return qY||(qY=1,(e=a5).L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2},e.isValid=function(e){return e&&typeof e.bit<"u"&&e.bit>=0&&e.bit<4},e.from=function(t,n){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+t)}}(t)}catch{return n}}),a5;var e}function Nit(){if(GY)return c5;function e(){this.buffer=[],this.length=0}return GY=1,e.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},c5=e}function Uit(){if(KY)return l5;function e(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return KY=1,e.prototype.set=function(e,t,n,r){const i=e*this.size+t;this.data[i]=n,r&&(this.reservedBit[i]=!0)},e.prototype.get=function(e,t){return this.data[e*this.size+t]},e.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n},e.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},l5=e}var zY,u5={};function jit(){return zY||(zY=1,function(e){const t=Mp().getSymbolSize;e.getRowColCoords=function(e){if(1===e)return[];const n=Math.floor(e/7)+2,r=t(e),i=145===r?26:2*Math.ceil((r-13)/(2*n-2)),o=[r-7];for(let e=1;e<n-1;e++)o[e]=o[e-1]-i;return o.push(6),o.reverse()},e.getPositions=function(t){const n=[],r=e.getRowColCoords(t),i=r.length;for(let e=0;e<i;e++)for(let t=0;t<i;t++)0===e&&0===t||0===e&&t===i-1||e===i-1&&0===t||n.push([r[e],r[t]]);return n}}(u5)),u5}var WY,d5={};function Fit(){if(WY)return d5;WY=1;const e=Mp().getSymbolSize;return d5.getPositions=function(t){const n=e(t);return[[0,0],[n-7,0],[0,n-7]]},d5}var YY,f5={};function $it(){return YY||(YY=1,function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t=3,n=3,r=40,i=10;function o(t,n,r){switch(t){case e.Patterns.PATTERN000:return(n+r)%2==0;case e.Patterns.PATTERN001:return n%2==0;case e.Patterns.PATTERN010:return r%3==0;case e.Patterns.PATTERN011:return(n+r)%3==0;case e.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2==0;case e.Patterns.PATTERN101:return n*r%2+n*r%3==0;case e.Patterns.PATTERN110:return(n*r%2+n*r%3)%2==0;case e.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}}e.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(e){const n=e.size;let r=0,i=0,o=0,s=null,a=null;for(let l=0;l<n;l++){i=o=0,s=a=null;for(let c=0;c<n;c++){let n=e.get(l,c);n===s?i++:(i>=5&&(r+=t+(i-5)),s=n,i=1),n=e.get(c,l),n===a?o++:(o>=5&&(r+=t+(o-5)),a=n,o=1)}i>=5&&(r+=t+(i-5)),o>=5&&(r+=t+(o-5))}return r},e.getPenaltyN2=function(e){const t=e.size;let r=0;for(let n=0;n<t-1;n++)for(let i=0;i<t-1;i++){const t=e.get(n,i)+e.get(n,i+1)+e.get(n+1,i)+e.get(n+1,i+1);(4===t||0===t)&&r++}return r*n},e.getPenaltyN3=function(e){const t=e.size;let n=0,i=0,o=0;for(let r=0;r<t;r++){i=o=0;for(let s=0;s<t;s++)i=i<<1&2047|e.get(r,s),s>=10&&(1488===i||93===i)&&n++,o=o<<1&2047|e.get(s,r),s>=10&&(1488===o||93===o)&&n++}return n*r},e.getPenaltyN4=function(e){let t=0;const n=e.data.length;for(let r=0;r<n;r++)t+=e.data[r];return Math.abs(Math.ceil(100*t/n/5)-10)*i},e.applyMask=function(e,t){const n=t.size;for(let r=0;r<n;r++)for(let i=0;i<n;i++)t.isReserved(i,r)||t.xor(i,r,o(e,i,r))},e.getBestMask=function(t,n){const r=Object.keys(e.Patterns).length;let i=0,o=1/0;for(let s=0;s<r;s++){n(s),e.applyMask(s,t);const r=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(s,t),r<o&&(o=r,i=s)}return i}}(f5)),f5}var XY,AE={};function mpe(){if(XY)return AE;XY=1;const e=CD(),t=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],n=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return AE.getBlocksCount=function(n,r){switch(r){case e.L:return t[4*(n-1)+0];case e.M:return t[4*(n-1)+1];case e.Q:return t[4*(n-1)+2];case e.H:return t[4*(n-1)+3];default:return}},AE.getTotalCodewordsCount=function(t,r){switch(r){case e.L:return n[4*(t-1)+0];case e.M:return n[4*(t-1)+1];case e.Q:return n[4*(t-1)+2];case e.H:return n[4*(t-1)+3];default:return}},AE}var JY,QY,p5,ZY,h5={},ry={};function Bit(){if(JY)return ry;JY=1;const e=new Uint8Array(512),t=new Uint8Array(256);return function(){let n=1;for(let r=0;r<255;r++)e[r]=n,t[n]=r,n<<=1,256&n&&(n^=285);for(let t=255;t<512;t++)e[t]=e[t-255]}(),ry.log=function(e){if(e<1)throw new Error("log("+e+")");return t[e]},ry.exp=function(t){return e[t]},ry.mul=function(n,r){return 0===n||0===r?0:e[t[n]+t[r]]},ry}function Hit(){return QY||(QY=1,function(e){const t=Bit();e.mul=function(e,n){const r=new Uint8Array(e.length+n.length-1);for(let i=0;i<e.length;i++)for(let o=0;o<n.length;o++)r[i+o]^=t.mul(e[i],n[o]);return r},e.mod=function(e,n){let r=new Uint8Array(e);for(;r.length-n.length>=0;){const e=r[0];for(let i=0;i<n.length;i++)r[i]^=t.mul(n[i],e);let i=0;for(;i<r.length&&0===r[i];)i++;r=r.slice(i)}return r},e.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let i=0;i<n;i++)r=e.mul(r,new Uint8Array([1,t.exp(i)]));return r}}(h5)),h5}function Vit(){if(ZY)return p5;ZY=1;const e=Hit();function t(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}return t.prototype.initialize=function(t){this.degree=t,this.genPoly=e.generateECPolynomial(this.degree)},t.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(t.length+this.degree);n.set(t);const r=e.mod(n,this.genPoly),i=this.degree-r.length;if(i>0){const e=new Uint8Array(this.degree);return e.set(r,i),e}return r},p5=t}var eX,m5={},g5={},v5={};function gpe(){return eX||(eX=1,v5.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),v5}var tX,nX,rX,kc={};function vpe(){if(tX)return kc;tX=1;const e="[0-9]+";let t="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";t=t.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+t+")(?:.|[\r\n]))+";kc.KANJI=new RegExp(t,"g"),kc.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),kc.BYTE=new RegExp(n,"g"),kc.NUMERIC=new RegExp(e,"g"),kc.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const r=new RegExp("^"+t+"$"),i=new RegExp("^"+e+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return kc.testKanji=function(e){return r.test(e)},kc.testNumeric=function(e){return i.test(e)},kc.testAlphanumeric=function(e){return o.test(e)},kc}function Dp(){return nX||(nX=1,function(e){const t=gpe(),n=vpe();e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(e,n){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!t.isValid(n))throw new Error("Invalid version: "+n);return n>=1&&n<10?e.ccBits[0]:n<27?e.ccBits[1]:e.ccBits[2]},e.getBestModeForData=function(t){return n.testNumeric(t)?e.NUMERIC:n.testAlphanumeric(t)?e.ALPHANUMERIC:n.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},e.isValid=function(e){return e&&e.bit&&e.ccBits},e.from=function(t,n){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+t)}}(t)}catch{return n}}}(g5)),g5}function qit(){return rX||(rX=1,function(e){const t=Mp(),n=mpe(),r=CD(),i=Dp(),o=gpe(),s=t.getBCHDigit(7973);function a(e,t){return i.getCharCountIndicator(e,t)+4}function l(e,t){let n=0;return e.forEach(function(e){const r=a(e.mode,t);n+=r+e.getBitsLength()}),n}e.from=function(e,t){return o.isValid(e)?parseInt(e,10):t},e.getCapacity=function(e,r,s){if(!o.isValid(e))throw new Error("Invalid QR Code version");typeof s>"u"&&(s=i.BYTE);const l=8*(t.getSymbolTotalCodewords(e)-n.getTotalCodewordsCount(e,r));if(s===i.MIXED)return l;const c=l-a(s,e);switch(s){case i.NUMERIC:return Math.floor(c/10*3);case i.ALPHANUMERIC:return Math.floor(c/11*2);case i.KANJI:return Math.floor(c/13);case i.BYTE:default:return Math.floor(c/8)}},e.getBestVersionForData=function(t,n){let o;const s=r.from(n,r.M);if(Array.isArray(t)){if(t.length>1)return function(t,n){for(let r=1;r<=40;r++)if(l(t,r)<=e.getCapacity(r,n,i.MIXED))return r}(t,s);if(0===t.length)return 1;o=t[0]}else o=t;return function(t,n,r){for(let i=1;i<=40;i++)if(n<=e.getCapacity(i,r,t))return i}(o.mode,o.getLength(),s)},e.getEncodedBits=function(e){if(!o.isValid(e)||e<7)throw new Error("Invalid QR Code version");let n=e<<12;for(;t.getBCHDigit(n)-s>=0;)n^=7973<<t.getBCHDigit(n)-s;return e<<12|n}}(m5)),m5}var iX,y5={};function Git(){if(iX)return y5;iX=1;const e=Mp(),t=e.getBCHDigit(1335);return y5.getEncodedBits=function(n,r){const i=n.bit<<3|r;let o=i<<10;for(;e.getBCHDigit(o)-t>=0;)o^=1335<<e.getBCHDigit(o)-t;return 21522^(i<<10|o)},y5}var _5,sX,S5,oX,E5,aX,w5,cX,b5={};function Kit(){if(sX)return _5;sX=1;const e=Dp();function t(t){this.mode=e.NUMERIC,this.data=t.toString()}return t.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);const i=this.data.length-t;i>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,3*i+1))},_5=t}function zit(){if(oX)return S5;oX=1;const e=Dp(),t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function n(t){this.mode=e.ALPHANUMERIC,this.data=t}return n.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(e){let n;for(n=0;n+2<=this.data.length;n+=2){let r=45*t.indexOf(this.data[n]);r+=t.indexOf(this.data[n+1]),e.put(r,11)}this.data.length%2&&e.put(t.indexOf(this.data[n]),6)},S5=n}function Wit(){if(aX)return E5;aX=1;const e=Dp();function t(t){this.mode=e.BYTE,this.data="string"==typeof t?(new TextEncoder).encode(t):new Uint8Array(t)}return t.getBitsLength=function(e){return 8*e},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)},E5=t}function Yit(){if(cX)return w5;cX=1;const e=Dp(),t=Mp();function n(t){this.mode=e.KANJI,this.data=t}return n.getBitsLength=function(e){return 13*e},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(e){let n;for(n=0;n<this.data.length;n++){let r=t.toSJIS(this.data[n]);if(r>=33088&&r<=40956)r-=33088;else{if(!(r>=57408&&r<=60351))throw new Error("Invalid SJIS character: "+this.data[n]+"\nMake sure your charset is UTF-8");r-=49472}r=192*(r>>>8&255)+(255&r),e.put(r,13)}},w5=n}var lX,uX,dX,C5={exports:{}};function Xit(){return lX||(lX=1,e={single_source_shortest_paths:function(t,n,r){var i={},o={};o[n]=0;var s,a,l,c,u,d,h,p=e.PriorityQueue.make();for(p.push(n,0);!p.empty();)for(l in a=(s=p.pop()).value,c=s.cost,u=t[a]||{})u.hasOwnProperty(l)&&(d=c+u[l],h=o[l],(typeof o[l]>"u"||h>d)&&(o[l]=d,p.push(l,d),i[l]=a));if(typeof r<"u"&&typeof o[r]>"u"){var f=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(f)}return i},extract_shortest_path_from_predecessor_list:function(e,t){for(var n=[],r=t;r;)n.push(r),e[r],r=e[r];return n.reverse(),n},find_path:function(t,n,r){var i=e.single_source_shortest_paths(t,n,r);return e.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(t){var n,r=e.PriorityQueue,i={};for(n in t=t||{},r)r.hasOwnProperty(n)&&(i[n]=r[n]);return i.queue=[],i.sorter=t.sorter||r.default_sorter,i},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var n={value:e,cost:t};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}},C5.exports=e),C5.exports;var e}function Jit(){return uX||(uX=1,function(e){const t=Dp(),n=Kit(),r=zit(),i=Wit(),o=Yit(),s=vpe(),a=Mp(),l=Xit();function c(e){return unescape(encodeURIComponent(e)).length}function u(e,t,n){const r=[];let i;for(;null!==(i=e.exec(n));)r.push({data:i[0],index:i.index,mode:t,length:i[0].length});return r}function d(e){const n=u(s.NUMERIC,t.NUMERIC,e),r=u(s.ALPHANUMERIC,t.ALPHANUMERIC,e);let i,o;return a.isKanjiModeEnabled()?(i=u(s.BYTE,t.BYTE,e),o=u(s.KANJI,t.KANJI,e)):(i=u(s.BYTE_KANJI,t.BYTE,e),o=[]),n.concat(r,i,o).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function h(e,s){switch(s){case t.NUMERIC:return n.getBitsLength(e);case t.ALPHANUMERIC:return r.getBitsLength(e);case t.KANJI:return o.getBitsLength(e);case t.BYTE:return i.getBitsLength(e)}}function p(e,s){let l;const c=t.getBestModeForData(e);if(l=t.from(s,c),l!==t.BYTE&&l.bit<c.bit)throw new Error('"'+e+'" cannot be encoded with mode '+t.toString(l)+".\n Suggested mode is: "+t.toString(c));switch(l===t.KANJI&&!a.isKanjiModeEnabled()&&(l=t.BYTE),l){case t.NUMERIC:return new n(e);case t.ALPHANUMERIC:return new r(e);case t.KANJI:return new o(e);case t.BYTE:return new i(e)}}e.fromArray=function(e){return e.reduce(function(e,t){return"string"==typeof t?e.push(p(t,null)):t.data&&e.push(p(t.data,t.mode)),e},[])},e.fromString=function(n,r){const i=function(e){const n=[];for(let r=0;r<e.length;r++){const i=e[r];switch(i.mode){case t.NUMERIC:n.push([i,{data:i.data,mode:t.ALPHANUMERIC,length:i.length},{data:i.data,mode:t.BYTE,length:i.length}]);break;case t.ALPHANUMERIC:n.push([i,{data:i.data,mode:t.BYTE,length:i.length}]);break;case t.KANJI:n.push([i,{data:i.data,mode:t.BYTE,length:c(i.data)}]);break;case t.BYTE:n.push([{data:i.data,mode:t.BYTE,length:c(i.data)}])}}return n}(d(n,a.isKanjiModeEnabled())),o=function(e,n){const r={},i={start:{}};let o=["start"];for(let s=0;s<e.length;s++){const a=e[s],l=[];for(let e=0;e<a.length;e++){const c=a[e],u=""+s+e;l.push(u),r[u]={node:c,lastCount:0},i[u]={};for(let e=0;e<o.length;e++){const s=o[e];r[s]&&r[s].node.mode===c.mode?(i[s][u]=h(r[s].lastCount+c.length,c.mode)-h(r[s].lastCount,c.mode),r[s].lastCount+=c.length):(r[s]&&(r[s].lastCount=c.length),i[s][u]=h(c.length,c.mode)+4+t.getCharCountIndicator(c.mode,n))}}o=l}for(let e=0;e<o.length;e++)i[o[e]].end=0;return{map:i,table:r}}(i,r),s=l.find_path(o.map,"start","end"),u=[];for(let e=1;e<s.length-1;e++)u.push(o.table[s[e]].node);return e.fromArray(u.reduce(function(e,t){const n=e.length-1>=0?e[e.length-1]:null;return n&&n.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[]))},e.rawSplit=function(t){return e.fromArray(d(t,a.isKanjiModeEnabled()))}}(b5)),b5}function Qit(){if(dX)return o5;dX=1;const e=Mp(),t=CD(),n=Nit(),r=Uit(),i=jit(),o=Fit(),s=$it(),a=mpe(),l=Vit(),c=qit(),u=Git(),d=Dp(),h=Jit();function p(e,t,n){const r=e.size,i=u.getEncodedBits(t,n);let o,s;for(o=0;o<15;o++)s=1==(i>>o&1),o<6?e.set(o,8,s,!0):o<8?e.set(o+1,8,s,!0):e.set(r-15+o,8,s,!0),o<8?e.set(8,r-o-1,s,!0):o<9?e.set(8,15-o-1+1,s,!0):e.set(8,15-o-1,s,!0);e.set(r-8,8,1,!0)}function f(t,r,i){const o=new n;i.forEach(function(e){o.put(e.mode.bit,4),o.put(e.getLength(),d.getCharCountIndicator(e.mode,t)),e.write(o)});const s=8*(e.getSymbolTotalCodewords(t)-a.getTotalCodewordsCount(t,r));for(o.getLengthInBits()+4<=s&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(0);const c=(s-o.getLengthInBits())/8;for(let e=0;e<c;e++)o.put(e%2?17:236,8);return function(t,n,r){const i=e.getSymbolTotalCodewords(n),o=a.getTotalCodewordsCount(n,r),s=i-o,c=a.getBlocksCount(n,r),u=i%c,d=c-u,h=Math.floor(i/c),p=Math.floor(s/c),f=p+1,m=h-p,v=new l(m);let g=0;const y=new Array(c),b=new Array(c);let w=0;const _=new Uint8Array(t.buffer);for(let e=0;e<c;e++){const t=e<d?p:f;y[e]=_.slice(g,g+t),b[e]=v.encode(y[e]),g+=t,w=Math.max(w,t)}const S=new Uint8Array(i);let E,C,k=0;for(E=0;E<w;E++)for(C=0;C<c;C++)E<y[C].length&&(S[k++]=y[C][E]);for(E=0;E<m;E++)for(C=0;C<c;C++)S[k++]=b[C][E];return S}(o,t,r)}function m(t,n,a,l){let u;if(Array.isArray(t))u=h.fromArray(t);else{if("string"!=typeof t)throw new Error("Invalid data");{let e=n;if(!e){const n=h.rawSplit(t);e=c.getBestVersionForData(n,a)}u=h.fromString(t,e||40)}}const d=c.getBestVersionForData(u,a);if(!d)throw new Error("The amount of data is too big to be stored in a QR Code");if(n){if(n<d)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+d+".\n")}else n=d;const m=f(n,a,u),v=e.getSymbolSize(n),g=new r(v);return function(e,t){const n=e.size,r=o.getPositions(t);for(let t=0;t<r.length;t++){const i=r[t][0],o=r[t][1];for(let t=-1;t<=7;t++)if(!(i+t<=-1||n<=i+t))for(let r=-1;r<=7;r++)o+r<=-1||n<=o+r||(t>=0&&t<=6&&(0===r||6===r)||r>=0&&r<=6&&(0===t||6===t)||t>=2&&t<=4&&r>=2&&r<=4?e.set(i+t,o+r,!0,!0):e.set(i+t,o+r,!1,!0))}}(g,n),function(e){const t=e.size;for(let n=8;n<t-8;n++){const t=n%2==0;e.set(n,6,t,!0),e.set(6,n,t,!0)}}(g),function(e,t){const n=i.getPositions(t);for(let t=0;t<n.length;t++){const r=n[t][0],i=n[t][1];for(let t=-2;t<=2;t++)for(let n=-2;n<=2;n++)-2===t||2===t||-2===n||2===n||0===t&&0===n?e.set(r+t,i+n,!0,!0):e.set(r+t,i+n,!1,!0)}}(g,n),p(g,a,0),n>=7&&function(e,t){const n=e.size,r=c.getEncodedBits(t);let i,o,s;for(let t=0;t<18;t++)i=Math.floor(t/3),o=t%3+n-8-3,s=1==(r>>t&1),e.set(i,o,s,!0),e.set(o,i,s,!0)}(g,n),function(e,t){const n=e.size;let r=-1,i=n-1,o=7,s=0;for(let a=n-1;a>0;a-=2)for(6===a&&a--;;){for(let n=0;n<2;n++)if(!e.isReserved(i,a-n)){let r=!1;s<t.length&&(r=1==(t[s]>>>o&1)),e.set(i,a-n,r),o--,-1===o&&(s++,o=7)}if(i+=r,i<0||n<=i){i-=r,r=-r;break}}}(g,m),isNaN(l)&&(l=s.getBestMask(g,p.bind(null,g,a))),s.applyMask(l,g),p(g,a,l),{modules:g,version:n,errorCorrectionLevel:a,maskPattern:l,segments:u}}return o5.create=function(n,r){if(typeof n>"u"||""===n)throw new Error("No input text");let i,o,a=t.M;return typeof r<"u"&&(a=t.from(r.errorCorrectionLevel,t.M),i=c.from(r.version),o=s.from(r.maskPattern),r.toSJISFunc&&e.setToSJISFunction(r.toSJISFunc)),m(n,i,a,o)},o5}var fX,hX,T5={},R5={};function ype(){return fX||(fX=1,function(e){function t(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);(3===t.length||4===t.length)&&(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),6===t.length&&t.push("F","F");const n=parseInt(t.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:255&n,hex:"#"+t.slice(0,6).join("")}}e.getOptions=function(e){e||(e={}),e.color||(e.color={});const n=typeof e.margin>"u"||null===e.margin||e.margin<0?4:e.margin,r=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:r,scale:r?4:i,margin:n,color:{dark:t(e.color.dark||"#000000ff"),light:t(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},e.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},e.getImageWidth=function(t,n){const r=e.getScale(t,n);return Math.floor((t+2*n.margin)*r)},e.qrToImageData=function(t,n,r){const i=n.modules.size,o=n.modules.data,s=e.getScale(i,r),a=Math.floor((i+2*r.margin)*s),l=r.margin*s,c=[r.color.light,r.color.dark];for(let e=0;e<a;e++)for(let n=0;n<a;n++){let u=4*(e*a+n),d=r.color.light;if(e>=l&&n>=l&&e<a-l&&n<a-l){d=c[o[Math.floor((e-l)/s)*i+Math.floor((n-l)/s)]?1:0]}t[u++]=d.r,t[u++]=d.g,t[u++]=d.b,t[u]=d.a}}}(R5)),R5}function Zit(){return hX||(hX=1,function(e){const t=ype();e.render=function(e,n,r){let i=r,o=n;typeof i>"u"&&(!n||!n.getContext)&&(i=n,n=void 0),n||(o=function(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}()),i=t.getOptions(i);const s=t.getImageWidth(e.modules.size,i),a=o.getContext("2d"),l=a.createImageData(s,s);return t.qrToImageData(l.data,e,i),function(e,t,n){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=n,t.width=n,t.style.height=n+"px",t.style.width=n+"px"}(a,o,s),a.putImageData(l,0,0),o},e.renderToDataURL=function(t,n,r){let i=r;typeof i>"u"&&(!n||!n.getContext)&&(i=n,n=void 0),i||(i={});const o=e.render(t,n,i),s=i.type||"image/png",a=i.rendererOpts||{};return o.toDataURL(s,a.quality)}}(T5)),T5}var pX,mX,I5={};function est(){if(pX)return I5;pX=1;const e=ype();function t(e,t){const n=e.a/255,r=t+'="'+e.hex+'"';return n<1?r+" "+t+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function n(e,t,n){let r=e+t;return typeof n<"u"&&(r+=" "+n),r}return I5.render=function(r,i,o){const s=e.getOptions(i),a=r.modules.size,l=r.modules.data,c=a+2*s.margin,u=s.color.light.a?"<path "+t(s.color.light,"fill")+' d="M0 0h'+c+"v"+c+'H0z"/>':"",d="<path "+t(s.color.dark,"stroke")+' d="'+function(e,t,r){let i="",o=0,s=!1,a=0;for(let l=0;l<e.length;l++){const c=Math.floor(l%t),u=Math.floor(l/t);!c&&!s&&(s=!0),e[l]?(a++,l>0&&c>0&&e[l-1]||(i+=s?n("M",c+r,.5+u+r):n("m",o,0),o=0,s=!1),c+1<t&&e[l+1]||(i+=n("h",a),a=0)):o++}return i}(l,a,s.margin)+'"/>',h='viewBox="0 0 '+c+" "+c+'"',p='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+h+' shape-rendering="crispEdges">'+u+d+"</svg>\n";return"function"==typeof o&&o(null,p),p},I5}function tst(){if(mX)return Gm;mX=1;const e=Dit(),t=Qit(),n=Zit(),r=est();function i(n,r,i,o,s){const a=[].slice.call(arguments,1),l=a.length,c="function"==typeof a[l-1];if(!c&&!e())throw new Error("Callback required as last argument");if(!c){if(l<1)throw new Error("Too few arguments provided");return 1===l?(i=r,r=o=void 0):2===l&&!r.getContext&&(o=i,i=r,r=void 0),new Promise(function(e,s){try{const s=t.create(i,o);e(n(s,r,o))}catch(e){s(e)}})}if(l<2)throw new Error("Too few arguments provided");2===l?(s=i,i=r,r=o=void 0):3===l&&(r.getContext&&typeof s>"u"?(s=o,o=void 0):(s=o,o=i,i=r,r=void 0));try{const e=t.create(i,o);s(null,n(e,r,o))}catch(e){s(e)}}return Gm.create=t.create,Gm.toCanvas=i.bind(null,n.render),Gm.toDataURL=i.bind(null,n.renderToDataURL),Gm.toString=i.bind(null,function(e,t,n){return r.render(e,n)}),Gm}var nst=tst();const rst="_qrCode_h54ia_8",ist={qrCode:rst},sst=({data:e,className:t})=>{const[n,r]=_.useState(null);return _.useEffect(()=>{let t=!1;return nst.toDataURL(e,{errorCorrectionLevel:"L"}).then(e=>{t||r(e)}).catch(e=>{t||r(null)}),()=>{t=!0}},[e]),w.jsx("div",{className:Ne(ist.qrCode,t),children:n&&w.jsx("img",{src:n,alt:xo("qr_code")})})},ost=({room:e,open:t,onDismiss:n})=>{const{t:r}=Je(),i=H_(e.roomId),o=_.useMemo(()=>dfe(e.roomId,i,e.name),[i,e.name,e.roomId]),[s,a]=_.useState(!1),l=_.useCallback(()=>a(!1),[a]),c=_.useCallback(e=>{e.stopPropagation(),Lit(o),n(),a(!0)},[o,n]);return w.jsxs(w.Fragment,{children:[w.jsxs(Lp,{title:r("invite_modal.title"),open:t,onDismiss:n,children:[w.jsx(sst,{className:i5.qrCode,data:o}),w.jsx(on,{className:i5.url,size:"sm",weight:"semibold",children:o}),w.jsx(Ft,{className:i5.button,Icon:LMe,onClick:c,"data-testid":"modal_inviteLink",children:r("action.copy_link")})]}),w.jsx(hpe,{open:s,onDismiss:l,autoDismiss:2e3,Icon:Xse,children:r("invite_modal.link_copied_toast")})]})},ast=({error:e,recoveryActionHandler:t,widget:n})=>{const{t:r}=Je();let i;switch(e.category){case $w.CONFIGURATION_ISSUE:i=AMe;break;case $w.NETWORK_CONNECTIVITY:i=DMe;break;case $w.CLIENT_CONFIGURATION:i=QMe;break;default:i=vT}const o=[];return e instanceof yD&&o.push({label:r("call_ended_view.reconnect_button"),onClick:()=>t("reconnect")}),w.jsx(Ug,{children:w.jsxs(Fb,{Icon:i,title:e.localisedTitle,rageshake:e.code==Bhe.UNKNOWN_ERROR,widget:n,children:[w.jsx("p",{children:e.localisedMessage??w.jsx(Vs,{i18nKey:"error.unexpected_ec_error",components:[w.jsx("b",{}),w.jsx("code",{})],values:{errorCode:e.code}})}),o&&o.map((e,t)=>w.jsx(Ft,{kind:"secondary",onClick:e.onClick,children:e.label},`action${t}`))]})})},cst=({recoveryActionHandler:e,onError:t,children:n,widget:r})=>{const i=_.useCallback(({error:t,resetError:n})=>{const i=t instanceof vl?t:new bD(t instanceof Error?t:new Error);return w.jsx(ast,{widget:r??null,error:i,resetError:n,recoveryActionHandler:t=>{n(),e(t)}})},[e,r]);return w.jsx(gT,{fallback:i,onError:e=>null==t?void 0:t(e),children:n})},lst=({client:e,isPasswordlessUser:t,confineToRoom:n,preload:r,skipLobby:i,header:o,rtcSession:s,isJoined:a,muteStates:l,widget:c})=>{const[u,d]=_.useState(null),h=A8(s),p=ct(fpe),f=xf(wD({sounds:dpe,latencyHint:"interactive",muted:p}));_.useEffect(()=>{var e,t;h.length>=8&&(null==(t=(e=l.audio).setEnabled)||t.call(e,!1))},[]),_.useEffect(()=>(M.info("[Lifecycle] GroupCallView Component mounted"),()=>{M.info("[Lifecycle] GroupCallView Component unmounted")}),[]),_.useEffect(()=>(document.body.classList.add("no-scroll-body"),()=>{document.body.classList.remove("no-scroll-body")}),[]),_.useEffect(()=>(window.rtcSession=s,()=>{delete window.rtcSession}),[s]),Tle(s,yi.MembershipManagerError,e=>d(new yD)),_.useEffect(()=>{e.getRoom(s.room.roomId)!==s.room&&M.warn(`We've ended up with multiple rooms for the same ID (${s.room.roomId}). This indicates a bug in the group call loading code, and may lead to incomplete room state.`)},[e,s.room]);const m=s.room,{displayName:v,avatarUrl:g}=D_(e),y=Rit(m),b=Tit(m),{perParticipantE2EE:S,returnToLobby:E,password:C}=Xs(),k=H_(m.roomId),[T]=Bn(gle),[R]=Bn(k8);_.useEffect(()=>{C&&ofe(m.roomId,C)},[C,m.roomId]),q_(y),cit(y);const I=_.useMemo(()=>({userId:e.getUserId(),displayName:v,avatarUrl:g,roomId:m.roomId,roomName:y,roomAlias:m.getCanonicalAlias(),roomAvatar:b,e2eeSystem:k}),[e,v,g,y,m,b,k]),x=_.useMemo(()=>new Set(h.map(e=>e.sender)).size,[h]),P=Gu(),L=xf(l),O=_.useCallback(async e=>{try{await wit(e,S,T,R)}catch(e){if(e instanceof vl)d(e);else{M.error("Unknown Error while entering RTC session",e);const t=new bD(e instanceof Error?e:new Error("Unknown error",{cause:e}));d(t)}}},[S,R,T]);_.useEffect(()=>{if(i)if(c){if(r){const e=e=>{(async()=>{await(async({audioInput:e,videoInput:t})=>{var n,r,i,o;const s=await Ru.getLocalDevices(void 0,!0);if(e){const t=AW(e,"audioinput",s);t?(M.debug(`Found audio input ID ${t} for name ${e}`),P.audioInput.select(t)):(M.warn("Unknown audio input: "+e),null==(r=(n=L.current.audio).setEnabled)||r.call(n,!1))}if(t){const e=AW(t,"videoinput",s);e?(M.debug(`Found video input ID ${e} for name ${t}`),P.videoInput.select(e)):(M.warn("Unknown video input: "+t),null==(o=(i=L.current.video).setEnabled)||o.call(i,!1))}})(e.detail.data),await O(s),c.api.transport.reply(e.detail,{})})().catch(e=>{M.error("Error joining RTC session",e)})};return c.lazyActions.on(Si.JoinCall,e),()=>{c.lazyActions.off(Si.JoinCall,e)}}(async()=>{await O(s)})().catch(e=>{M.error("Error joining RTC session",e)})}else O(s)},[c,s,r,i,S,P,L,O,T]);const[A,D]=_.useState(!1),N=fl(),j=_.useCallback((e="user")=>{var r;const i=null==(r=f.current)?void 0:r.playSound("left"),o=!!c;D(!0);const a=new Promise(e=>{Dt.instance.eventCallEnded.track(m.roomId,s.memberships.length,o,s),window.setTimeout(e,10)});FY(s,e,Promise.all([i,a])).then(async()=>{!t&&!n&&!Dt.instance.isEnabled()&&await N("/")}).catch(e=>{M.error("Error leaving RTC session",e)})},[f,c,s,m.roomId,t,n,N]);_.useEffect(()=>{if(c&&a){c.api.setAlwaysOnScreen(!0).catch(e=>{M.error("Error calling setAlwaysOnScreen(true)",e)});const e=e=>{c.api.transport.reply(e.detail,{}),FY(s,"user").catch(e=>{M.error("Failed to leave RTC session",e)})};return c.lazyActions.once(Si.HangupCall,e),()=>{c.lazyActions.off(Si.HangupCall,e)}}},[c,a,s]);const F=Iit(m),[U,B]=_.useState(!1),H=_.useCallback(()=>B(!1),[B]),$=_.useCallback(()=>B(!0),[B]),V=F===ef.Public?$:null;if(!YZ()&&k.kind!==sn.NONE)throw new vtt;const q=w.jsx(ost,{room:m,open:U,onDismiss:H}),G=w.jsxs(w.Fragment,{children:[q,w.jsx(Xfe,{client:e,matrixInfo:I,muteStates:l,onEnter:()=>{O(s)},confineToRoom:n,hideHeader:o===Ib.None,participantCount:x,onShareClick:V})]});let z;if(u){const e=()=>{throw u};z=w.jsx(e,{})}else z=a?w.jsxs(w.Fragment,{children:[q,w.jsx(mit,{client:e,matrixInfo:I,rtcSession:s,matrixRoom:m,participantCount:x,onLeave:j,header:o,muteStates:l,e2eeSystem:k,onShareClick:V})]}):A&&null===c?t||Dt.instance.isEnabled()&&null===c?w.jsx(GQe,{endedCallId:s.room.roomId,client:e,isPasswordlessUser:t,hideHeader:o===Ib.None,confineToRoom:n}):null:A&&null!==c?E?G:null:r||i?null:G;return w.jsx(cst,{widget:c,recoveryActionHandler:e=>{"reconnect"==e&&(D(!1),O(s).catch(e=>{M.error("Error re-entering RTC session",e)}))},onError:()=>{s.isJoined()&&j("error")},children:z})},ust="_modal_1tnec_8",dst={modal:ust},fst=({roomId:e})=>{const{t}=Je(),[n,r]=_.useState(!0),i=_.useCallback(e=>{e.preventDefault(),e.stopPropagation(),r(!1)},[r]),o=H_(e);o.kind===sn.NONE&&M.error("Generating app redirect URL for encrypted room but don't have key available!");const s=_.useMemo(()=>{const t=new URL(null===e?window.location.href:dfe(e,o));t.hash=AUe(t.hash,e=>(e.set("appPrompt","false"),e.set("confineToRoom","true"),e));const n=new URL("io.element.call:/");return n.searchParams.set("url",t.toString()),n.toString()},[o,e]);return w.jsxs(Lp,{className:dst.modal,title:t("app_selection_modal.title"),open:n,children:[w.jsx(on,{size:"md",weight:"semibold",children:t("app_selection_modal.text")}),w.jsx(Ft,{kind:"secondary",onClick:i,children:t("app_selection_modal.continue_in_browser")}),w.jsx(Ft,{as:"a",href:s,Icon:Poe,children:t("app_selection_modal.open_in_app")})]})},hst=3,pst=3e3;async function bpe(e,t=0,...n){try{return await e.joinRoom(...n)}catch(r){if(r instanceof nr&&"M_FORBIDDEN"===r.errcode&&t<3)return await new Promise(e=>setTimeout(e,pst)),bpe(e,t+1,...n);throw r}}class Vw extends Error{constructor(e,t,n,r){super(t),this.icon=e,this.messageBody=n,this.reason=r}}const mst=(e,t,n)=>{const[r,i]=_.useState({kind:"loading"}),o=_.useRef(void 0),{t:s}=Je(),a=_.useCallback(()=>new Vw(RMe,s("group_call_loader.banned_heading"),s("group_call_loader.banned_body"),u()),[s]),l=_.useCallback(()=>new Vw(yT,s("group_call_loader.knock_reject_heading"),s("group_call_loader.knock_reject_body"),u()),[s]),c=_.useCallback(()=>new Vw(voe,s("group_call_loader.call_ended_heading"),s("group_call_loader.call_ended_body"),u()),[s]),u=()=>{var e,t,n;return null==(n=null==(t=o.current)?void 0:t.currentState.getStateEvents(ee.RoomMember,null==(e=o.current)?void 0:e.myUserId))?void 0:n.getContent().reason};return _.useEffect(()=>{if(!e||!t)return;const s=async()=>{let r=null;if("#"===t[0])r=await(async t=>{let n=null;const r=await e.getRoomIdForAlias(t.toLowerCase());return M.info(`${t} resolved to ${r.room_id}`),n=e.getRoom(r.room_id),n?M.info(`Already in room ${r.room_id}, not rejoining.`):(M.info(`Room ${r.room_id} not found, joining.`),n=await e.joinRoom(r.room_id,{viaServers:r.servers})),n})(t),o.current=r;else{const s=t;r=e.getRoom(s),o.current=r??void 0;const c=null==r?void 0:r.getMyMembership();if(c===Ve.Join)return r;if(Qe)throw new Error("Room not found. The widget-api did not pass over the relevant room events/information.");if(c===Ve.Ban)throw a();if(c===Ve.Invite)r=await e.joinRoom(s,{viaServers:n});else{let t;try{t=await e.getRoomSummary(s,n)}catch(e){M.warn("Could not load room summary to decide whether we want to join or knock.\n              EC will fallback to join as if this would be a public room.\n              Reach out to your homeserver admin to ask them about supporting the `/summary` endpoint (im.nheko.summary):",e)}if(void 0===t||t.join_rule===ef.Public)r=await e.joinRoom(s,{viaServers:n});else{if(t.join_rule!==ef.Knock)throw new Error(`Room ${t.room_id} is not joinable. This likely means, that the conference owner has changed the room settings to private.`);{const s=t;let c=()=>{};const u=new Promise(e=>{s.membership!==Ve.Knock?c=e:e()});i({kind:"canKnock",roomSummary:s,knock:c}),await u,r=await(async(t,n,r)=>(await e.knockRoom(t,{viaServers:n}),r(),await new Promise((r,i)=>{e.on(xe.MyMembership,(s,c,u)=>{t===s.roomId&&(o.current=s,c===Ve.Invite&&u===Ve.Knock&&bpe(e,0,s.roomId,{viaServers:n}).then(e=>{M.log("Auto-joined %s",e.roomId),r(e)},i),c===Ve.Ban&&i(a()),c===Ve.Leave&&i(l()))})})))(t.room_id,n,()=>i({kind:"waitForInvite",roomSummary:s}))}}}}return M.info(`Joined ${t}, waiting room to be ready for group calls`),await e.waitUntilRoomReadyForGroupCalls(r.roomId),M.info(`${t}, is ready for group calls`),r};"loading"===r.kind&&(M.log("Start loading group call"),(async()=>{e.getSyncState()!==Vt.Syncing&&(M.debug("useLoadGroupCall: waiting for client to start syncing..."),await new Promise(t=>{const n=()=>{if(e.getSyncState()===Vt.Syncing)return e.off(Le.Sync,n),t()};e.on(Le.Sync,n)}),M.debug("useLoadGroupCall: client is now syncing."))})().then(async()=>{const n=await s();return o.current=n,M.debug(`Fetched / joined room ${t}`),e.matrixRTC.getRoomSession(n)}).then(e=>i({kind:"loaded",rtcSession:e})).then(async()=>{await new Promise((t,n)=>{e.on(xe.MyMembership,(e,t)=>{t===Ve.Leave&&n(c()),t===Ve.Ban&&n(a())})})}).catch(e=>i({kind:"failed",error:e})))},[a,e,l,c,t,r,s,n]),r},gst=new Pn;function vst(e){const t=dp(e??gst,yi.JoinStateChanged,_.useCallback(()=>(null==e?void 0:e.isJoined())??!1,[e]));return _.useEffect(()=>{M.info(`Session in room ${null==e?void 0:e.room.roomId} changed to ${t?"joined":"left"}`)},[e,t]),t}const yst=()=>{const{confineToRoom:e,appPrompt:t,preload:n,header:r,displayName:i,skipLobby:o}=Xs(),{t:s}=Je(),{roomAlias:a,roomId:l,viaServers:c}=PUe(),u=l??a;u||M.error("No room specified");const{registerPasswordlessUser:d}=gfe(),[h,p]=_.useState(!1),{loading:f,authenticated:m,client:v,error:g,passwordlessUser:y}=O8(),{avatarUrl:b,displayName:S}=D_(v),E=mst(v,u,c),C=vst("loaded"===E.kind?E.rtcSession:void 0),k=bit(C);_.useEffect(()=>{!f&&!m&&i&&!Qe&&(p(!0),d(i).catch(e=>{M.error("Failed to register passwordless user",e)}).finally(()=>{p(!1)}))},[f,m,i,p,d]);const[T,R]=XT();_.useEffect(()=>{null===T&&R&&R(!0)},[T,R]);const I=_.useRef(!1);_.useEffect(()=>{"loaded"===E.kind&&I.current&&M.log("Play join sound 'Not yet implemented'")},[E.kind]);let x;return x=f||h?w.jsx(eR,{}):g?w.jsx($b,{widget:Qe,error:g}):v?u?(()=>{switch(E.kind){case"loaded":return w.jsx(lst,{widget:Qe,client:v,rtcSession:E.rtcSession,isJoined:C,isPasswordlessUser:y,confineToRoom:e,preload:n,skipLobby:o||I.current,header:r,muteStates:k});case"waitForInvite":case"canKnock":{I.current=I.current||"waitForInvite"===E.kind;const t="canKnock"===E.kind?E.knock:null,n="canKnock"===E.kind?s("lobby.ask_to_join"):w.jsxs(w.Fragment,{children:[s("lobby.waiting_for_invite"),w.jsx(Xse,{})]});return w.jsx(Xfe,{client:v,matrixInfo:{userId:v.getUserId()??"",displayName:S??"",avatarUrl:b??"",roomAlias:null,roomId:E.roomSummary.room_id,roomName:E.roomSummary.name??"",roomAvatar:E.roomSummary.avatar_url??null,e2eeSystem:{kind:E.roomSummary["im.nheko.summary.encryption"]?sn.PER_PARTICIPANT:sn.NONE}},onEnter:()=>null==t?void 0:t(),enterLabel:n,waitingForInvite:"waitForInvite"===E.kind,confineToRoom:e,hideHeader:"standard"!==r,participantCount:null,muteStates:k,onShareClick:null})}case"loading":return w.jsx(Ug,{children:w.jsx("h1",{children:s("common.loading")})});case"failed":return I.current=!1,"M_NOT_FOUND"===E.error.errcode?w.jsx(Ug,{children:w.jsx(Fb,{Icon:VMe,title:s("error.call_not_found"),widget:Qe,children:w.jsx(Vs,{i18nKey:"error.call_not_found_description",children:w.jsxs("p",{children:["That link doesn't appear to belong to any existing call. Check that you have the right link, or"," ",w.jsx(il,{to:"/",children:"create a new one"}),"."]})})})}):E.error instanceof Vw?w.jsx(Ug,{children:w.jsxs(Fb,{Icon:E.error.icon,title:E.error.message,widget:Qe,children:[w.jsx("p",{children:E.error.messageBody}),E.error.reason&&w.jsx("p",{children:s("group_call_loader.reason",{reason:E.error.reason})})]})}):w.jsx($b,{widget:Qe,error:E.error});default:return w.jsx(w.Fragment,{children:" "})}})():w.jsx(pfe,{}):w.jsx(AXe,{}),w.jsxs(w.Fragment,{children:[x,t&&Zt.get().app_prompt&&("android"===tc||"ios"===tc)&&l&&w.jsx(fst,{roomId:l})]})},bst="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLQn9C+0YLRgNC10LHQuNGC0LXQu9GB0LrQviDQvNC10L3RjiIKICB9LAogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAi0JfQsNGC0LLQvtGA0LgiLAogICAgImNvcHlfbGluayI6ICLQmtC+0L/QuNGA0LDQvdC1INC90LAg0LLRgNGK0LfQutCw0YLQsCIsCiAgICAiZ28iOiAi0J3QsNC/0YDQtdC0IiwKICAgICJpbnZpdGUiOiAi0J/QvtC60LDQvdCwIiwKICAgICJubyI6ICLQndC1IiwKICAgICJyZWdpc3RlciI6ICLQoNC10LPQuNGB0YLRgNCw0YbQuNGPIiwKICAgICJyZW1vdmUiOiAi0J/RgNC10LzQsNGF0L3QuCIsCiAgICAic2lnbl9pbiI6ICLQktC70LXQtyIsCiAgICAic2lnbl9vdXQiOiAi0JjQt9C70LXQtyIKICB9LAogICJjYWxsX2VuZGVkX3ZpZXciOiB7CiAgICAiY3JlYXRlX2FjY291bnRfYnV0dG9uIjogItCh0YrQt9C00LDQuSDQsNC60LDRg9C90YIiLAogICAgImNyZWF0ZV9hY2NvdW50X3Byb21wdCI6ICI8MD7Ql9Cw0YnQviDQvdC1INC90LDRgdGC0YDQvtC50YLQtSDQv9Cw0YDQvtC70LAg0LfQsCDQtNCwINC30LDQv9Cw0LfQuNGC0LUg0LDQutCw0YPQvdGC0LAg0YHQuD88LzA+PDE+0KnQtSDQvNC+0LbQtdGC0LUg0LTQsCDQt9Cw0L/QsNC30LjRgtC1INC40LzQtdGC0L4g0Lgg0LDQstCw0YLQsNGA0LAg0YHQuCDQt9CwINCx0YrQtNC10YnQuCDRgNCw0LfQs9C+0LLQvtGA0Lg8LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLQndC1INGB0LXQs9CwLCDQstGK0YDQvdC4INGB0LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iCiAgfSwKICAiY29tbW9uIjogewogICAgImF1ZGlvIjogItCX0LLRg9C6IiwKICAgICJhdmF0YXIiOiAi0JDQstCw0YLQsNGAIiwKICAgICJkaXNwbGF5X25hbWUiOiAi0JjQvNC1L9C/0YHQtdCy0LTQvtC90LjQvCIsCiAgICAiaG9tZSI6ICLQndCw0YfQsNC70L4iLAogICAgImxvYWRpbmciOiAi0JfQsNGA0LXQttC00LDQvdC14oCmIiwKICAgICJwYXNzd29yZCI6ICLQn9Cw0YDQvtC70LAiLAogICAgInByb2ZpbGUiOiAi0J/RgNC+0YTQuNC7IiwKICAgICJzZXR0aW5ncyI6ICLQndCw0YHRgtGA0L7QudC60LgiLAogICAgInVzZXJuYW1lIjogItCf0L7RgtGA0LXQsdC40YLQtdC70YHQutC+INC40LzQtSIsCiAgICAidmlkZW8iOiAi0JLQuNC00LXQviIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi0JTQsCwg0L/RgNC40YHRitC10LTQuNC90Lgg0YHQtSIsCiAgICAidGV4dCI6ICLQotC+0LfQuCDRgNCw0LfQs9C+0LLQvtGAINCy0LXRh9C1INGB0YrRidC10YHRgtCy0YPQstCwLCDQuNGB0LrQsNGC0LUg0LvQuCDQtNCwINGB0LUg0L/RgNC40YHRitC10LTQuNC90LjRgtC1PyIsCiAgICAidGl0bGUiOiAi0J/RgNC40YHRitC10LTQuNC90Y/QstCw0L3QtSDQutGK0Lwg0YHRitGJ0LXRgdGC0LLRg9Cy0LDRiSDRgNCw0LfQs9C+0LLQvtGAPyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItCf0YDQvtC20LXQutGC0L7RgCIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItCS0LvQtdC3INCyINGA0LDQt9Cz0L7QstC+0YDQsCIKICB9LAogICJsb2dnaW5nX2luIjogItCS0LvQuNC30LDQvdC14oCmIiwKICAibG9naW5fYXV0aF9saW5rcyI6ICI8MD7QodGK0LfQtNCw0LnRgtC1INCw0LrQsNGD0L3RgjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLQktC70LXQtyIsCiAgInJhZ2VzaGFrZV9yZXF1ZXN0X21vZGFsIjogewogICAgImJvZHkiOiAi0JTRgNGD0LMg0L/QvtGC0YDQtdCx0LjRgtC10Lsg0LIg0YLQvtC30Lgg0YDQsNC30LPQvtCy0L7RgCDQuNC80LAg0L/RgNC+0LHQu9C10LwuINCX0LAg0LTQsCDQtNC40LDQs9C90L7RgdGC0LjRhtC40YDQsNC80LUg0YLQvtC30Lgg0L/RgNC+0LHQu9C10Lwg0L/Qvi3QtNC+0LHRgNC1INC90Lgg0YHQtSDQuNGB0LrQsCDQtNCwINGB0YrQsdC10YDQtdC8IGRlYnVnINC70L7Qs9C+0LLQtS4iLAogICAgInRpdGxlIjogItCX0LDRj9Cy0LrQsCDQt9CwIGRlYnVnINC70L7Qs9C+0LLQtSIKICB9LAogICJyYWdlc2hha2Vfc2VuZF9sb2dzIjogItCY0LfQv9GA0LDRgtC10YLQtSBkZWJ1ZyDQu9C+0LPQvtCy0LUiLAogICJyYWdlc2hha2Vfc2VuZGluZyI6ICLQmNC30L/RgNCw0YnQsNC90LXigKYiLAogICJyZWNhcHRjaGFfZGlzbWlzc2VkIjogIlJlY2FwdGNoYSDQvtGC0YXQstGK0YDQu9C10L3QsCIsCiAgInJlY2FwdGNoYV9ub3RfbG9hZGVkIjogIlJlY2FwdGNoYSDQvdC1INC1INC30LDRgNC10LTQtdC90LAiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICLQn9Cw0YDQvtC70LjRgtC1INC90LUg0YHRitCy0L/QsNC00LDRgiIsCiAgICAicmVnaXN0ZXJpbmciOiAi0KDQtdCz0LjRgdGC0YDQuNGA0LDQvdC14oCmIgogIH0sCiAgInJlZ2lzdGVyX2F1dGhfbGlua3MiOiAiPDA+0JLQtdGH0LUg0LjQvNCw0YLQtSDQsNC60LDRg9C90YI/PC8wPjwxPjwwPtCS0LvQtdC30YLQtSDRgSDQvdC10LPQvjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLQn9C+0YLQstGK0YDQtNC4INC/0LDRgNC+0LvQsNGC0LAiLAogICJyZXR1cm5faG9tZV9idXR0b24iOiAi0JLRgNGK0YnQsNC90LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iLAogICJzY3JlZW5zaGFyZV9idXR0b25fbGFiZWwiOiAi0KHQv9C+0LTQtdC70Lgg0LXQutGA0LDQvdCwIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLQoNCw0LfRgNCw0LHQvtGC0YfQuNC6IiwKICAgICJmZWVkYmFja190YWJfaDQiOiAi0JjQt9C/0YDQsNGC0Lgg0L7QsdGA0LDRgtC90LAg0LLRgNGK0LfQutCwIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogItCS0LrQu9GO0YfQuCBkZWJ1ZyDQu9C+0LPQvtCy0LUiCiAgfSwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfYm9keSI6ICLQktGB0LUg0L7RidC1INC90LUg0YHRgtC1INGA0LXQs9C40YHRgtGA0LjRgNCw0L3QuD8gPDI+0KHRitC30LTQsNC50YLQtSDQsNC60LDRg9C90YI8LzI+IiwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfbG9naW5fYnV0dG9uIjogItCS0LvQtdC30YLQtSDQsiDQsNC60LDRg9C90YLQsCDRgdC4IiwKICAidmVyc2lvbiI6ICLQktC10YDRgdC40Y86IHt7dmVyc2lvbn19Igp9Cg==",_st=""+new URL("cs-app-Du_5mVg3.json",import.meta.url).href,Sst=""+new URL("da-app-BBz-lePm.json",import.meta.url).href,Est=""+new URL("de-app-DjOuqT-j.json",import.meta.url).href,wst=""+new URL("el-app-BBr3LLTK.json",import.meta.url).href,Cst=""+new URL("en-app-I8blcx-e.json",import.meta.url).href,Tst=""+new URL("es-app-Q3c7lmEj.json",import.meta.url).href,Rst=""+new URL("et-app-DLvuR7m2.json",import.meta.url).href,Ist="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLZgdmH2LHYs9iqINqp2KfYsdio2LEiCiAgfSwKICAiYWN0aW9uIjogewogICAgImNsb3NlIjogItio2LPYqtmGIiwKICAgICJnbyI6ICLYsdmB2KrZhiIsCiAgICAibm8iOiAi2K7bjNixIiwKICAgICJyZWdpc3RlciI6ICLYq9io2KrigIzZhtin2YUiLAogICAgInJlbW92ZSI6ICLYrdiw2YEiLAogICAgInNpZ25faW4iOiAi2YjYsdmI2K8iLAogICAgInNpZ25fb3V0IjogItiu2LHZiNisIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAi2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+2obYsdinINuM2qkg2LHZhdiyINi52KjZiNixINio2LHYp9uMINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2KrZhti424zZhSDZhtmF24zigIzaqdmG24zYr9ifPC8wPjwxPti02YXYpyDZhduM4oCM2KrZiNin2YbbjNivINmG2KfZhSDYrtmI2K8g2LHYpyDYrdmB2Lgg2qnZhtuM2K8g2Ygg24zaqSDYotmI2KfYqtin2LEg2KjYsdin24wg2KrZhdin2LPigIzZh9in24wg2KLbjNmG2K/ZhyDYqNiz2KfYstuM2K88LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLYp9mE2KfZhiDZhtmH2Iwg2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCDYqNix2q/Ysdiv24zYryIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAi2LXYr9inIiwKICAgICJhdmF0YXIiOiAi2KLZiNin2KrYp9ixIiwKICAgICJkaXNwbGF5X25hbWUiOiAi2YbYp9mFINmG2YXYp9uM2LTbjCIsCiAgICAiaG9tZSI6ICLYrtin2YbZhyIsCiAgICAibG9hZGluZyI6ICLYqNin2LHar9iy2KfYsduM4oCmIiwKICAgICJwYXNzd29yZCI6ICLYsdmF2LIg2LnYqNmI2LEiLAogICAgInByb2ZpbGUiOiAi2b7YsdmI2YHYp9uM2YQiLAogICAgInNldHRpbmdzIjogItiq2YbYuNuM2YXYp9iqIiwKICAgICJ1c2VybmFtZSI6ICLZhtin2YUg2qnYp9ix2KjYsduMIiwKICAgICJ2aWRlbyI6ICLZiNuM2K/bjNmIIgogIH0sCiAgImhlYWRlcl9sYWJlbCI6ICLYrtin2YbZh9mUINiq2YXYp9izINin2YTZhdmG2KoiLAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi2KjZhNmH2Iwg2KjZhyDYqtmF2KfYsyDYqNm+24zZiNmG2K/bjNivIiwKICAgICJ0ZXh0IjogItin24zZhiDYqtmF2KfYsyDYp9iyINmC2KjZhCDZiNis2YjYryDYr9in2LHYr9iMINmF24zigIzYrtmI2KfZh9uM2K8g2KjZvtuM2YjZhtiv24zYr9ifIiwKICAgICJ0aXRsZSI6ICLZvtuM2YjYs9iqINio2Ycg2KrZhdin2LPYnyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItmG2YjYsSDYp9mB2qnZhiIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItm+24zZiNiz2KrZhiDYqNmHINiq2YXYp9izIgogIH0sCiAgImxvZ2dpbmdfaW4iOiAi2YjYsdmI2K/igKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPtiz2KfYrtiqINit2LPYp9ioINqp2KfYsdio2LHbjDwvMD4gT3IgPDI+2K/Ys9iq2LHYs9uMINio2Ycg2LnZhtmI2KfZhiDZhduM2YfZhdin2YY8LzI+IiwKICAibG9naW5fdGl0bGUiOiAi2YjYsdmI2K8iLAogICJyYWdlc2hha2VfcmVxdWVzdF9tb2RhbCI6IHsKICAgICJib2R5IjogItqp2KfYsdio2LEg2K/bjNqv2LHbjCDYr9ixINin24zZhiDYqtmF2KfYsyDZhdi02qnZhNuMINiv2KfYsdivLiDYqNix2KfbjCDYqti02K7bjNi1INio2YfYqtixINmF2LTaqdmE2Iwg2KjZh9iq2LEg2KfYs9iqINmF2Kcg2YTYp9qvINi524zYqOKAjNuM2KfYqNuMINix2Kcg2KzZhdi54oCM2KLZiNix24wg2qnZhtuM2YUuIiwKICAgICJ0aXRsZSI6ICLYr9ix2K7ZiNin2LPYqiDZhNin2q8g2LnbjNio4oCM24zYp9io24wiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRfbG9ncyI6ICLYp9ix2LPYp9mEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YTigKYiLAogICJyYWdlc2hha2Vfc2VuZGluZ19sb2dzIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YQg2KjYp9qv4oCM2YfYp9uMINi524zYqOKAjNuM2KfYqNuM4oCmIiwKICAicmVjYXB0Y2hhX2Rpc21pc3NlZCI6ICLYsduM2qnZvtqG2Kcg2LHYryDYtNivIiwKICAicmVjYXB0Y2hhX25vdF9sb2FkZWQiOiAi2qnZvtqG2Kcg2KjYp9ix2q/bjNix24wg2YbYtNivIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAi2LHZhdiyINi52KjZiNixINio2KfbjNivINmH2YXYrtmI2KfZhtuMINiv2KfYtNiq2Ycg2KjYp9i02K8iLAogICAgInJlZ2lzdGVyaW5nIjogItir2KjYquKAjNmG2KfZheKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPtin2LIg2YLYqNmEINit2LPYp9ioINqp2KfYsdio2LHbjCDYr9in2LHbjNiv2J88LzA+PDE+PDA+2YjYsdmI2K88LzA+IE9yIDwyPtio2Ycg2LnZhtmI2KfZhiDbjNqpINmF24zZh9mF2KfZhiDZiNin2LHYryDYtNmI24zYrzwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLYqtin24zbjNivINix2YXYsti52KjZiNixIiwKICAicmV0dXJuX2hvbWVfYnV0dG9uIjogItio2LHar9i02Kog2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCIsCiAgInNjcmVlbnNoYXJlX2J1dHRvbl9sYWJlbCI6ICLYp9i02KrYsdin2qkg2q/YsNin2LHbjCDYtdmB2K3ZhyDZhtmF2KfbjNi0IiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLYqtmI2LPYudmHINiv2YfZhtiv2YciLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICLYqNin2LLYrtmI2LHYryDYp9ix2KfYptmHINiv2YfbjNivIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogIti02KfZhdmEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIKICB9LAogICJ1bmF1dGhlbnRpY2F0ZWRfdmlld19ib2R5IjogItmH2YbZiNiyINir2KjYquKAjNmG2KfZhSDZhtqp2LHYr9mH4oCM2KfbjNiv2J8gPDI+2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLYqNmHINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2YjYp9ix2K8g2LTZiNuM2K8iLAogICJ2ZXJzaW9uIjogItmG2LPYrtmHOiB7e9mG2LPYrtmHfX0iCn0K",kst=""+new URL("fi-app-tnO3DMdi.json",import.meta.url).href,xst=""+new URL("fr-app-BxTYbDfK.json",import.meta.url).href,Ast=""+new URL("id-app-BEz8ptLJ.json",import.meta.url).href,Lst=""+new URL("it-app-Cik25Qgd.json",import.meta.url).href,Pst=""+new URL("ja-app-Cp_00ujI.json",import.meta.url).href,Ost=""+new URL("lv-app-D-ZV3Ytk.json",import.meta.url).href,Mst=""+new URL("pl-app-CUkXVSZk.json",import.meta.url).href,Dst=""+new URL("ro-app-CdYgKCOW.json",import.meta.url).href,Nst=""+new URL("ru-app-CIijOjFj.json",import.meta.url).href,Ust=""+new URL("sk-app-DaVEeQWZ.json",import.meta.url).href,jst=""+new URL("sv-app-DHLBEOTp.json",import.meta.url).href,Fst=""+new URL("tr-app-Dk--6BpP.json",import.meta.url).href,$st=""+new URL("uk-app-DZD01h76.json",import.meta.url).href,Bst="data:application/json;base64,ewogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAixJDDs25nIiwKICAgICJubyI6ICJLaMO0bmciLAogICAgInJlZ2lzdGVyIjogIsSQxINuZyBrw70iLAogICAgInNpZ25faW4iOiAixJDEg25nIG5o4bqtcCIsCiAgICAic2lnbl9vdXQiOiAixJDEg25nIHh14bqldCIsCiAgICAic3VibWl0IjogIkfhu61pIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAiVOG6oW8gdMOgaSBraG/huqNuIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+VOG6oWkgc2FvIGzhuqFpIGtow7RuZyBob8OgbiB0aGnhu4duIGLhurFuZyBjw6FjaCDEkeG6t3QgbeG6rXQga2jhuql1IMSR4buDIGdp4buvIHTDoGkga2hv4bqjbiBj4bunYSBi4bqhbj88LzA+PDE+QuG6oW4gc+G6vSBjw7MgdGjhu4MgZ2nhu68gdMOqbiB2w6AgxJHhurd0IOG6o25oIMSR4bqhaSBkaeG7h24gY2hvIG5o4buvbmcgY3Xhu5ljIGfhu41pIHRp4bq/cCB0aGVvLjwvMT4iLAogICAgImZlZWRiYWNrX2RvbmUiOiAiPDA+Q+G6o20gaMahbiB2w6wgxJHDoyBwaOG6o24gaOG7k2khPC8wPiIsCiAgICAiZmVlZGJhY2tfcHJvbXB0IjogIjwwPkNow7puZyB0w7RpIG114buRbiBuZ2hlIHBo4bqjbiBo4buTaSBj4bunYSBi4bqhbiDEkeG7gyBjw7JuIGPhuqNpIHRoaeG7h24gdHLhuqNpIG5naGnhu4dtIGNobyBi4bqhbi48LzA+IiwKICAgICJoZWFkbGluZSI6ICJ7e2Rpc3BsYXlOYW1lfX0sIGN14buZYyBn4buNaSDEkcOjIGvhur90IHRow7pjLiIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAiw4JtIHRoYW5oIiwKICAgICJhdmF0YXIiOiAi4bqibmggxJHhuqFpIGRp4buHbiIsCiAgICAiZGlzcGxheV9uYW1lIjogIlTDqm4gaGnhu4NuIHRo4buLIiwKICAgICJsb2FkaW5nIjogIsSQYW5nIHThuqNp4oCmIiwKICAgICJwYXNzd29yZCI6ICJN4bqtdCBraOG6qXUiLAogICAgInByb2ZpbGUiOiAiSOG7kyBzxqEiLAogICAgInNldHRpbmdzIjogIkPDoGkgxJHhurd0IiwKICAgICJ1c2VybmFtZSI6ICJUw6puIG5nxrDhu51pIGTDuW5nIiwKICAgICJ2aWRlbyI6ICJUcnV54buBbiBow6xuaCIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAiVsOibmcsIHRoYW0gZ2lhIGN14buZYyBn4buNaSIsCiAgICAidGV4dCI6ICJDdeG7mWMgZ+G7jWkgxJHDoyB04buTbiB04bqhaSwgYuG6oW4gY8OzIG114buRbiB0aGFtIGdpYSBraMO0bmc/IiwKICAgICJ0aXRsZSI6ICJUaGFtIGdpYSBjdeG7mWMgZ+G7jWk/IgogIH0sCiAgImxheW91dF9zcG90bGlnaHRfbGFiZWwiOiAiVGnDqnUgxJFp4buDbSIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogIlRoYW0gZ2lhIGN14buZYyBn4buNaSIKICB9LAogICJsb2dnaW5nX2luIjogIsSQYW5nIMSRxINuZyBuaOG6rXDigKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPlThuqFvIHTDoGkga2hv4bqjbjwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBraMOhYzwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLEkMSDbmcgbmjhuq1wIiwKICAicmFnZXNoYWtlX3JlcXVlc3RfbW9kYWwiOiB7CiAgICAiYm9keSI6ICJN4buZdCBuZ8aw4budaSBkw7luZyBraMOhYyB0cm9uZyBjdeG7mWMgZ+G7jWkgxJFhbmcgZ+G6t3AgduG6pW4gxJHhu4EuIMSQ4buDIGPDsyB0aOG7gyBjaOG6qW4gxJFvw6FuIHThu5F0IGjGoW4gY2jDum5nIHTDtGkgbXXhu5FuIHRodSB0aOG6rXAgbmjhuq10IGvDvSBn4buhIGzhu5dpLiIsCiAgICAidGl0bGUiOiAiWcOqdSBj4bqndSBuaOG6rXQga8O9IGfhu6EgbOG7l2kiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRpbmciOiAixJBhbmcgZ+G7rWnigKYiLAogICJyZWNhcHRjaGFfbm90X2xvYWRlZCI6ICJDaMawYSB04bqjaSDEkcaw4bujYyBSZWNhcHRjaGEiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICJN4bqtdCBraOG6qXUgcGjhuqNpIGto4bubcCIsCiAgICAicmVnaXN0ZXJpbmciOiAixJBhbmcgxJHEg25nIGvDveKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPsSQw6MgY8OzIHTDoGkga2hv4bqjbj88LzA+PDE+PDA+xJDEg25nIG5o4bqtcDwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBLaMOhY2g8LzI+PC8xPiIsCiAgInJlZ2lzdGVyX2NvbmZpcm1fcGFzc3dvcmRfbGFiZWwiOiAiWMOhYyBuaOG6rW4gbeG6rXQga2jhuql1IiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIkNoaWEgc+G6uyBtw6BuIGjDrG5oIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICJOaMOgIHBow6F0IHRyaeG7g24iLAogICAgImZlZWRiYWNrX3RhYl9kZXNjcmlwdGlvbl9sYWJlbCI6ICJQaOG6o24gaOG7k2kgY+G7p2EgYuG6oW4iLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICJH4butaSBwaOG6o24gaOG7k2kiLAogICAgImZlZWRiYWNrX3RhYl9zZW5kX2xvZ3NfbGFiZWwiOiAiS8OobSB0aGVvIG5o4bqtdCBrw70gZ+G7oSBs4buXaSIsCiAgICAiZmVlZGJhY2tfdGFiX3RoYW5rX3lvdSI6ICJD4bqjbSDGoW4sIGNow7puZyB0w7RpIMSRw6Mgbmjhuq1uIMSRxrDhu6NjIHBo4bqjbiBo4buTaSEiLAogICAgImZlZWRiYWNrX3RhYl90aXRsZSI6ICJQaOG6o24gaOG7k2kiCiAgfSwKICAic3VibWl0dGluZyI6ICLEkGFuZyBn4butaeKApiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2JvZHkiOiAiQ2jGsGEgxJHEg25nIGvDvT8gPDI+VOG6oW8gdMOgaSBraG/huqNuPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLEkMSDbmcgbmjhuq1wIHbDoG8gdMOgaSBraG/huqNuIGPhu6dhIGLhuqFuIiwKICAidmVyc2lvbiI6ICJQaGnDqm4gYuG6o246IHt7dmVyc2lvbn19Igp9Cg==",Hst=""+new URL("zh-Hans-app-BY5jJGyr.json",import.meta.url).href,Vst=""+new URL("zh-Hant-app-BV1LKS_j.json",import.meta.url).href,{slice:qst,forEach:Gst}=[];function Kst(e){return Gst.call(qst.call(arguments,1),t=>{if(t)for(const n in t)void 0===e[n]&&(e[n]=t[n])}),e}function zst(e){return"string"==typeof e&&[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(t=>t.test(e))}const gX=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Wst=function(e,t){const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"};let r=`${e}=${encodeURIComponent(t)}`;if(n.maxAge>0){const e=n.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");r+=`; Max-Age=${Math.floor(e)}`}if(n.domain){if(!gX.test(n.domain))throw new TypeError("option domain is invalid");r+=`; Domain=${n.domain}`}if(n.path){if(!gX.test(n.path))throw new TypeError("option path is invalid");r+=`; Path=${n.path}`}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");r+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(r+="; Partitioned"),r},vX={create(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};n&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+60*n*1e3)),r&&(i.domain=r),document.cookie=Wst(e,t,i)},read(e){const t=`${e}=`,n=document.cookie.split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var Yst={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return vX.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:n,cookieMinutes:r,cookieDomain:i,cookieOptions:o}=t;n&&typeof document<"u"&&vX.create(n,e,r,i,o)}},Xst={name:"querystring",lookup(e){var t;let n,{lookupQuerystring:r}=e;if(typeof window<"u"){let{search:e}=window.location;!window.location.search&&(null==(t=window.location.hash)?void 0:t.indexOf("?"))>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const i=e.substring(1).split("&");for(let e=0;e<i.length;e++){const t=i[e].indexOf("=");t>0&&i[e].substring(0,t)===r&&(n=i[e].substring(t+1))}}return n}},Jst={name:"hash",lookup(e){var t;let n,{lookupHash:r,lookupFromHashIndex:i}=e;if(typeof window<"u"){const{hash:e}=window.location;if(e&&e.length>2){const o=e.substring(1);if(r){const e=o.split("&");for(let t=0;t<e.length;t++){const i=e[t].indexOf("=");i>0&&e[t].substring(0,i)===r&&(n=e[t].substring(i+1))}}if(n)return n;if(!n&&i>-1){const n=e.match(/\/([a-zA-Z-]*)/g);return Array.isArray(n)?null==(t=n["number"==typeof i?i:0])?void 0:t.replace("/",""):void 0}}}return n}};let Km=null;const yX=()=>{if(null!==Km)return Km;try{if(Km=typeof window<"u"&&null!==window.localStorage,!Km)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{Km=!1}return Km};var Qst={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&yX())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:n}=t;n&&yX()&&window.localStorage.setItem(n,e)}};let zm=null;const bX=()=>{if(null!==zm)return zm;try{if(zm=typeof window<"u"&&null!==window.sessionStorage,!zm)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{zm=!1}return zm};var Zst={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&bX())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:n}=t;n&&bX()&&window.sessionStorage.setItem(n,e)}},eot={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:e,userLanguage:n,language:r}=navigator;if(e)for(let n=0;n<e.length;n++)t.push(e[n]);n&&t.push(n),r&&t.push(r)}return t.length>0?t:void 0}},tot={name:"htmlTag",lookup(e){let t,{htmlTag:n}=e;const r=n||(typeof document<"u"?document.documentElement:null);return r&&"function"==typeof r.getAttribute&&(t=r.getAttribute("lang")),t}},not={name:"path",lookup(e){var t;let{lookupFromPathIndex:n}=e;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?null==(t=r["number"==typeof n?n:0])?void 0:t.replace("/",""):void 0}},rot={name:"subdomain",lookup(e){var t,n;let{lookupFromSubdomainIndex:r}=e;const i="number"==typeof r?r+1:1,o=typeof window<"u"&&(null==(n=null==(t=window.location)?void 0:t.hostname)?void 0:n.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(o)return o[i]}};let _pe=!1;try{document.cookie,_pe=!0}catch{}const Spe=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];_pe||Spe.splice(1,1);const iot=()=>({order:Spe,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class Epe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=Kst(t,this.options||{},iot()),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(Yst),this.addDetector(Xst),this.addDetector(Qst),this.addDetector(Zst),this.addDetector(eot),this.addDetector(tot),this.addDetector(not),this.addDetector(rot),this.addDetector(Jst)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach(e=>{if(this.detectors[e]){let n=this.detectors[e].lookup(this.options);n&&"string"==typeof n&&(n=[n]),n&&(t=t.concat(n))}}),t=t.filter(e=>null!=e&&!zst(e)).map(e=>this.options.convertDetectedLanguage(e)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)}))}}Epe.type="languageDetector";var _X,LE={};function sot(){if(_X)return LE;return _X=1,Object.defineProperty(LE,"__esModule",{value:!0}),LE.shouldPolyfill=function(){return!Intl.Segmenter},LE}var SX,oot=sot(),PE={};function aot(){if(SX)return PE;return SX=1,Object.defineProperty(PE,"__esModule",{value:!0}),PE.shouldPolyfill=function(){return typeof Intl>"u"||!("DurationFormat"in Intl)},PE}var cot=aot();const wpe=Object.assign({"../locales/bg/app.json":bst,"../locales/cs/app.json":_st,"../locales/da/app.json":Sst,"../locales/de/app.json":Est,"../locales/el/app.json":wst,"../locales/en/app.json":Cst,"../locales/es/app.json":Tst,"../locales/et/app.json":Rst,"../locales/fa/app.json":Ist,"../locales/fi/app.json":kst,"../locales/fr/app.json":xst,"../locales/id/app.json":Ast,"../locales/it/app.json":Lst,"../locales/ja/app.json":Pst,"../locales/lv/app.json":Ost,"../locales/pl/app.json":Mst,"../locales/ro/app.json":Dst,"../locales/ru/app.json":Nst,"../locales/sk/app.json":Ust,"../locales/sv/app.json":jst,"../locales/tr/app.json":Fst,"../locales/uk/app.json":$st,"../locales/vi/app.json":Bst,"../locales/zh-Hans/app.json":Hst,"../locales/zh-Hant/app.json":Vst}),lot=(e,t)=>wpe[`../locales/${e}/${t}.json`],uot=[...new Set(Object.keys(wpe).map(e=>{var t;const n=null==(t=e.match(/\/([^/]+)\/[^/]+\.json$/))?void 0:t[1];if(!n)throw new Error(`Could not parse locale URL ${e}`);return n}))],dot={type:"backend",init(){},read(e,t,n){(async()=>{const n=lot(e,t);if(!n)throw new Error(`Namespace ${t} for locale ${e} not found`);const r=await fetch(n,{credentials:"omit",headers:{Accept:"application/json"}});if(ZM(r))throw Error(`Failed to fetch ${n}`);return await r.json()})().then(e=>n(null,e),e=>n(e,null))}};class fot{constructor(){this.config=0,this.sentry=0,this.openTelemetry=0}allDepsAreLoaded(){return!Object.values(this).some(e=>2!==e)}}class mo{constructor(){this.isInitialized=!1,this.loadStates=new fot}static isInitialized(){var e;return!(null==(e=mo.internalInstance)||!e.isInitialized)}static async initBeforeReact(){const e=[];oot.shouldPolyfill()&&e.push(nb(()=>import("./polyfill-force-BvayG45o.js").then(e=>e.p),__vite__mapDeps([2,3]),import.meta.url)),cot.shouldPolyfill()&&e.push(nb(()=>import("./polyfill-force-CyUv_FTa.js").then(e=>e.p),__vite__mapDeps([4,3]),import.meta.url)),await Promise.all(e);const t=new Epe;t.addDetector({name:"urlFragment",lookup:()=>Fr().lang??void 0}),$i.on("languageChanged",e=>{document.documentElement.lang=e}),await $i.use(dot).use(t).use(EMe).init({fallbackLng:"en",defaultNS:"app",keySeparator:".",nsSeparator:!1,pluralSeparator:"_",contextSeparator:"|",supportedLngs:uot,interpolation:{escapeValue:!1},detection:{order:["urlFragment","navigator"],caches:[]}});const{fonts:n,fontScale:r}=Fr();null!==r&&document.documentElement.style.setProperty("--font-scale",r.toString()),n.length>0&&document.documentElement.style.setProperty("--font-family",n.map(e=>`"${e}"`).join(", ")),document.body.setAttribute("data-platform",tc)}static init(){var e;return null!=(e=null==mo?void 0:mo.internalInstance)&&e.initPromise?null:(mo.internalInstance=new mo,mo.internalInstance.initPromise=new Promise(e=>{var t;null==(t=mo.internalInstance)||t.initStep(e)}),mo.internalInstance.initPromise)}static reset(){mo.internalInstance=void 0}initStep(e){if(0===this.loadStates.config&&(this.loadStates.config=1,Zt.init().then(()=>{this.loadStates.config=2,this.initStep(e)},e=>{M.error("Failed to load config",e)})),0===this.loadStates.sentry&&2===this.loadStates.config){let e,t;e=Fr().sentryDsn??void 0,t=Fr().sentryEnvironment??void 0,e&&kIe({dsn:e,environment:t,integrations:[zIe({useEffect:Te.useEffect,useLocation:ts,useNavigationType:UEe,createRoutesFromChildren:bC,matchRoutes:EO})],tracesSampleRate:1}),this.loadStates.sentry=2}0===this.loadStates.openTelemetry&&2===this.loadStates.config&&(QT.globalInit(),this.loadStates.openTelemetry=2),this.loadStates.allDepsAreLoaded()&&(e(),this.isInitialized=!0)}}const hot=()=>{const[e,t]=_.useState(()=>Fr().theme),n=_.useRef(document.body.classList.item(0));_.useEffect(()=>{if(Qe){const e=e=>{e.preventDefault(),"name"in e.detail.data&&"string"==typeof e.detail.data.name&&t(e.detail.data.name),Qe.api.transport.reply(e.detail,{})};return Qe.lazyActions.on(hr.ThemeChange,e),()=>{Qe.lazyActions.off(hr.ThemeChange,e)}}},[]),_.useLayoutEffect(()=>{const t="cpd-theme-"+(null!=e&&e.includes("light")?"light":"dark")+(null!=e&&e.includes("high-contrast")?"-hc":"");t!==n.current&&(document.body.classList.remove("cpd-theme-light","cpd-theme-dark","cpd-theme-light-hc","cpd-theme-dark-hc"),document.body.classList.add(t),n.current=t),document.body.classList.remove("no-theme")},[n,e])},OE=WIe(Ree),pot=({children:e})=>{const{pathname:t}=ts();return _.useEffect(()=>{let e="";!["/login","/register"].includes(t)&&!Qe&&(e="var(--background-gradient)"),document.getElementsByTagName("body")[0].style.backgroundImage=e},[t]),w.jsx(w.Fragment,{children:e})},mot=({children:e})=>(hot(),e),got=({vm:e})=>{const[t,n]=_.useState(!1);_.useEffect(()=>{var e;null==(e=mo.init())||e.then(async()=>{t||(n(!0),await(null==Qe?void 0:Qe.api.sendContentLoaded()))}).catch(M.error)});const{header:r}=_.useMemo(Fr,[]),i=t?w.jsx(TGe,{children:w.jsx(Fle,{value:e.mediaDevices,children:w.jsx(hYe,{children:w.jsx(gT,{fallback:e=>w.jsx($b,{error:e,widget:Qe}),children:w.jsxs(ZEe,{children:[w.jsx(OE,{path:"/",element:w.jsx(pfe,{})}),w.jsx(OE,{path:"/login",element:w.jsx(wXe,{})}),w.jsx(OE,{path:"/register",element:w.jsx(CXe,{})}),w.jsx(OE,{path:"*",element:w.jsx(yst,{})})]})})})})}):w.jsx(eR,{});return w.jsx(Ewe,{children:w.jsx(pot,{children:w.jsx(mot,{children:w.jsx(Vne,{children:w.jsx(_.Suspense,{fallback:null,children:r===Ib.AppBar?w.jsx(ait,{children:i}):i})})})})})};class vot extends W_{constructor(){super(...arguments),this.mediaDevices=new IKe(this.scope)}}window.setLKLogLevel=mZ,$Ue().catch(e=>{M.error("Failed to initialize rageshake",e)}),mZ("info"),W_e((e,t,n)=>{global.mx_rage_logger.log(e,"livekit",t,n)}),M.info("Element Call embedded-v0.15.0");const wP=gbe.createRoot(document.getElementById("root"));let Qy=null;if(window.isSecureContext?navigator.mediaDevices||(Qy=new Error("Your browser does not support WebRTC.")):Qy=new Error("This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.\nhttps://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts"),null!==Qy)throw wP.render(Qy.message),Qy;mo.initBeforeReact().then(()=>{wP.render(w.jsx(_.StrictMode,{children:w.jsx(got,{vm:new vot})}))}).catch(e=>{M.error("Failed to initialize app",e),wP.render(e.message)});export{Iot as A,N3 as B,Zt as C,k0e as D,ee as E,xot as F,Lot as G,VP as H,Aot as I,Eo as J,Ve as K,wot as L,nr as M,qt as N,pu as O,Z$ as P,$$ as Q,Pot as R,wh as S,Pn as T,kot as U,Oot as V,Ht as W,Wg as X,A0e as Y,ic as _,_ot as a,cc as b,bot as c,Rot as d,B as e,hW as f,ac as g,P as h,cfe as i,Eot as j,ui as k,M as l,le as m,Nh as n,Ae as o,j3 as p,NP as q,uQ as r,mp as s,jot as t,jye as u,Mv as v,cl as w,Kr as x,D0e as y,yy as z};