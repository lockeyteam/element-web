"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[1188],{"./node_modules/@vector-im/compound-design-tokens/assets/web/icons/lock-off.js":(e,t,n)=>{n.d(t,{A:()=>i});var o=n("./node_modules/react/index.js"),s=n("./node_modules/react/jsx-runtime.js");function r(e,t){return(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,s.jsx)("path",{d:"M6 22q-.825 0-1.412-.587A1.93 1.93 0 0 1 4 20V10q0-.825.588-1.412a2 2 0 0 1 .702-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 1 1-1.414 1.414l-.896-.896A1.94 1.94 0 0 1 18 22zm14-4.834V10q0-.825-.587-1.412A1.93 1.93 0 0 0 18 8h-1V6q0-2.075-1.463-3.537Q14.075 1 12 1T8.463 2.463a4.9 4.9 0 0 0-1.22 1.946L9 6.166V6q0-1.25.875-2.125A2.9 2.9 0 0 1 12 3q1.25 0 2.125.875T15 6v2h-4.166z"})})}r.displayName="LockOffIcon";const i=(0,o.forwardRef)(r)},"./src/components/views/rooms/wysiwyg_composer/SendWysiwygComposer.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var o=n("./node_modules/@babel/runtime/helpers/esm/extends.js"),s=n("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),r=n("./node_modules/react/index.js"),i=n("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/lock-off.js"),l=n("./src/dispatcher/dispatcher.ts"),c=n("./src/dispatcher/actions.ts"),a=n("./src/contexts/RoomContext.ts"),u=n("./src/hooks/useDispatcher.ts"),d=n("./src/components/views/rooms/wysiwyg_composer/hooks/utils.ts"),m=n("./src/dispatcher/payloads/ComposerInsertPayload.ts"),p=n("./src/components/views/rooms/wysiwyg_composer/ComposerContext.ts"),f=n("./src/components/views/rooms/wysiwyg_composer/utils/selection.ts"),g=n("./src/contexts/ScopedRoomContext.tsx");var h=n("./src/components/views/rooms/wysiwyg_composer/components/WysiwygComposer.tsx"),v=n("./node_modules/classnames/index.js"),y=n.n(v);var C=n("./src/components/views/rooms/wysiwyg_composer/hooks/useIsFocused.ts");var x=n("./src/hooks/useSettings.ts"),w=n("./src/Keyboard.ts"),E=n("./node_modules/@matrix-org/emojibase-bindings/build/emoji.js"),b=n("./node_modules/matrix-js-sdk/src/logger.ts"),S=n("./src/Typeguards.ts");function T(e,t,n){var o;const[s,i]=(0,r.useState)(null),l=e=>{b.vF.log(`## 26037 ## wysiwyg useSuggestion hook setting suggestion data to ${null===e||e instanceof Function?e:e.mappedSuggestion.keyChar+e.mappedSuggestion.text}`),i(e)};return{suggestion:null!==(o=null==s?void 0:s.mappedSuggestion)&&void 0!==o?o:null,handleCommand:e=>function(e,t,n,o){var s;if(null===t)return;const{node:r}=t,i=`${e} `;r.textContent=i,null===(s=document.getSelection())||void 0===s||s.setBaseAndExtent(r,i.length,r,i.length),o(i),n(null)}(e,s,l,t),handleMention:(e,n,o)=>k(e,n,o,s,l,t),handleAtRoomMention:e=>k("#","@room",e,s,l,t),handleEmojiSuggestion:e=>R(e,s,l,t),handleEmojiReplacement:()=>function(e,t,n){var o;if("custom"!==(null==e||null===(o=e.mappedSuggestion)||void 0===o?void 0:o.type))return;R(e.mappedSuggestion.text,e,t,n)}(s,l,t),onSelect:()=>function(e,t,n){var o;const s=document.getSelection();if(null===e.current||null===s||!s.isCollapsed||"#text"!==(null===(o=s.anchorNode)||void 0===o?void 0:o.nodeName))return void t(null);const{anchorNode:r,anchorOffset:i}=s;if(null===r.textContent)return void t(null);const l=document.createNodeIterator(e.current,NodeFilter.SHOW_TEXT).nextNode(),c=r===l,a=function(e,t,n,o){if(t<0||t>e.length)return null;let s=t,r=t;for(;M(e,s);)s--;for(;j(e,r);)r++;const i=e.slice(s,r),l=function(e,t){if(t){const t=E.EMOTICON_TO_EMOJI.get(e);if(null!=t&&t.unicode)return{keyChar:"",text:t.unicode,type:"custom"}}const n=e.charAt(0),o=e.slice(1);switch(n){case"/":return{keyChar:n,text:o,type:"command"};case"#":case"@":return{keyChar:n,text:o,type:"mention"};case":":return{keyChar:n,text:o,type:"emoji"};default:return null}}(i,o);if(null===l||"command"===l.type&&(!n||0!==s||r!==e.length))return null;return{mappedSuggestion:l,startOffset:s,endOffset:s+i.length}}(r.textContent,i,c,n);if(null===a)return void t(null);t({mappedSuggestion:a.mappedSuggestion,node:r,startOffset:a.startOffset,endOffset:a.endOffset})}(e,l,n)}}function k(e,t,n,o,s,r){var i,l,c,a;if(null===o)return;const{node:u}=o,d=document.createElement("a"),m=document.createTextNode(t);d.setAttribute("href",e),d.setAttribute("contenteditable","false");for(const[e,t]of n.entries())d.setAttribute(e,t);d.appendChild(m);const p=document.createTextNode((null===(i=u.textContent)||void 0===i?void 0:i.slice(0,o.startOffset))||"â€‹"),f=document.createTextNode(` ${null!==(l=null===(c=u.textContent)||void 0===c?void 0:c.slice(o.endOffset))&&void 0!==l?l:""}`),g=u.parentNode;(0,S.P)(g)&&(g.insertBefore(p,u),g.insertBefore(d,u),g.insertBefore(f,u),g.removeChild(u)),null===(a=document.getSelection())||void 0===a||a.setBaseAndExtent(f,1,f,1),r(),s(null)}function R(e,t,n,o){var s;if(null===t)return;const{node:r}=t,i=r.textContent;if(null==i)return;const l=i.slice(0,t.startOffset)+e+i.slice(t.endOffset);r.textContent=l,null===(s=document.getSelection())||void 0===s||s.setBaseAndExtent(r,l.length,r,l.length),o(l),n(null)}function M(e,t){return!(t<=0)&&!/\s/.test(e[t-1])}function j(e,t){return!(t>=e.length)&&!/\s/.test(e[t])}var A=n("./src/contexts/MatrixClientContext.tsx");function _(e,t,n,o,s){const i=(0,g.ME)("room","timelineRenderingType","replyToEvent"),l=(0,A.nH)(),c=(0,r.useRef)(null),a=(0,r.useRef)(null),[u,m]=(0,r.useState)(e),p=(0,r.useCallback)(()=>{c.current&&(c.current.innerHTML=""),null==n||n()},[c,n]),f=(0,r.useCallback)(e=>{if((0,S.E)(e))m(e),null==t||t(e);else if((0,S.P)(c)&&(0,S.P)(c.current)){const e=c.current.innerHTML;m(e),null==t||t(e)}},[t,c]),{suggestion:h,onSelect:v,handleCommand:y,handleMention:C,handleAtRoomMention:E,handleEmojiSuggestion:b,handleEmojiReplacement:k}=T(c,f,s),R=(0,r.useCallback)(e=>{e.target instanceof HTMLDivElement&&f(e.target.innerHTML)},[f]),M=(0,r.useCallback)(e=>{const{nativeEvent:t}=e;let n=!1;if((0,d.wg)(t)){const e=t instanceof ClipboardEvent?t.clipboardData:t.dataTransfer;n=(0,d.VI)(t,e,i,l,o)}n?e.preventDefault():R(e)},[o,l,R,i]),j=!(0,x.ti)("MessageComposerInput.ctrlEnterToSend"),_=(0,r.useCallback)(e=>{if(!(0,d.hi)(a,e)&&(e.key!=w.Uz.ENTER&&e.key!=w.Uz.SPACE||k(),e.key===w.Uz.ENTER)){const t=w.vL?e.metaKey:e.ctrlKey;j&&!e.shiftKey&&(e.preventDefault(),e.stopPropagation(),p()),!j&&t&&(e.preventDefault(),e.stopPropagation(),p())}},[a,j,p,k]);return{ref:c,autocompleteRef:a,onBeforeInput:M,onInput:R,onPaste:M,onKeyDown:_,content:u,setContent:f,suggestion:h,onSelect:v,handleCommand:y,handleMention:C,handleAtRoomMention:E,handleEmoji:b}}var N=n("./src/components/views/rooms/wysiwyg_composer/hooks/useSetCursorPosition.ts"),O=n("./src/components/views/rooms/wysiwyg_composer/components/Editor.tsx"),I=n("./src/components/views/rooms/wysiwyg_composer/components/WysiwygAutocomplete.tsx");function P({className:e,disabled:t=!1,onSend:n,onChange:o,children:s,placeholder:i,initialContent:l,leftComponent:c,rightComponent:a,eventRelation:u}){const d=(0,x.ti)("MessageComposerInput.autoReplaceEmoji"),{ref:m,autocompleteRef:p,onBeforeInput:g,onInput:h,onPaste:v,onKeyDown:w,content:E,setContent:b,suggestion:S,onSelect:T,handleCommand:k,handleMention:R,handleAtRoomMention:M,handleEmoji:j}=_(l,o,n,u,d),A=function(e,t){return(0,r.useMemo)(()=>({clear:()=>{e.current&&(e.current.innerHTML="")},insertText:n=>{const o=document.getSelection();if(e.current&&o){const s=e.current.innerHTML,{anchorOffset:r,focusOffset:i}=o;e.current.innerHTML=`${s.slice(0,r)}${n}${s.slice(i)}`,(0,f.td)({anchorNode:e.current.firstChild,anchorOffset:r+n.length,focusNode:e.current.firstChild,focusOffset:i+n.length,isForward:!0}),t(e.current.innerHTML)}}}),[e,t])}(m,b);!function(e="",t){(0,r.useEffect)(()=>{t.current&&(t.current.innerHTML=e)},[t,e])}(l,m),(0,N.V)(t,m);const{isFocused:P,onFocus:F}=(0,C.j)(),H=!E&&i||void 0;return r.createElement("div",{className:y()(e,{[`${e}-focused`]:P}),onFocus:F,onBlur:F,onBeforeInput:g,onInput:h,onPaste:v,onKeyDown:w,onSelect:T},r.createElement(I.W,{ref:p,suggestion:S,handleMention:R,handleCommand:k,handleAtRoomMention:M,handleEmoji:j}),r.createElement(O.K,{ref:m,disabled:t,leftComponent:c,rightComponent:a,placeholder:H}),null==s?void 0:s(m,A))}var F=n("./src/utils/ShieldUtils.ts"),H=n("./src/components/views/rooms/E2EIcon.tsx"),L=n("./src/components/views/rooms/EmojiButton.tsx");function B({menuPosition:e}){const t=(0,g.ME)("timelineRenderingType");return r.createElement(L.h,{menuPosition:e,addEmoji:e=>(l.A.dispatch({action:c.r.ComposerInsert,text:e,timelineRenderingType:t.timelineRenderingType}),!0)})}const D=["isRichTextEnabled","e2eStatus","menuPosition"],K=function({disabled:e=!1,composerFunctions:t,ref:n}){return function(e,t,n){const o=(0,g.ME)("timelineRenderingType"),s=(0,p.Hx)(),i=(0,r.useRef)(null),h=(0,r.useCallback)(r=>{var l;if(e||null==t||!t.current)return;const u=null!==(l=r.context)&&void 0!==l?l:a.Ae.Room;switch(r.action){case"reply_to_event":case c.r.FocusAComposer:case c.r.FocusSendMessageComposer:(0,d.Hj)(t,u,o,i);break;case c.r.ClearAndFocusSendMessageComposer:if(r.timelineRenderingType!==o.timelineRenderingType)break;n.clear(),(0,d.Hj)(t,u,o,i);break;case c.r.ComposerInsert:if(r.timelineRenderingType!==o.timelineRenderingType)break;if(r.composerType!==m.D.Send)break;r.userId||r.event||r.text&&(0,f.td)(s.selection).then(()=>n.insertText(r.text))}},[e,t,o,n,s]);(0,u.F)(l.A,h)}(e,n,t),null};function W(e){let{isRichTextEnabled:t,e2eStatus:n,menuPosition:l}=e,c=(0,s.A)(e,D);const a=t?h.k:P,u=(0,r.useMemo)(()=>(0,p.AP)({eventRelation:c.eventRelation}),[c.eventRelation]);let d=!1;return n?n!==F.z.Normal&&(d=r.createElement(H.A,{status:n,size:12})):d=r.createElement(i.A,{width:12,height:12,color:"var(--cpd-color-icon-info-primary)",className:"mx_E2EIcon"}),r.createElement(p.EW.Provider,{value:u},r.createElement(a,(0,o.A)({className:"mx_SendWysiwygComposer",leftComponent:d,rightComponent:r.createElement(B,{menuPosition:l})},c),(e,t)=>r.createElement(K,{disabled:c.disabled,ref:e,composerFunctions:t})))}}}]);
//# sourceMappingURL=1188.js.map